import{C as y,b as Yt,a as Gn,O as F,c as It,d as Ot,i as Ar}from"./constants-cefe2a81.js";var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Cr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),t}function Dr(i){return i.type==="CURVE"}function Ri(i){return i.type==="IMAGE"}function pi(i,e){return Math.round(i/e)*e}function hi(i,e){return Math.floor(i/e)*e}function Rn(i){return i*(Math.PI/180)}function Pr(i){return i*(180/Math.PI)}function gi(i,e,t){return i*(1-t)+e*t}class Ut{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const o=Math.cos(Rn(n)),r=Math.sin(Rn(n)),l=this.subtract(e,t);return{x:t.x+o*l.x-r*l.y,y:t.y+r*l.x+o*l.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:pi(e.x,t.x),y:pi(e.y,t.y)}}static floorTo(e,t){return{x:hi(e.x,t.x),y:hi(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let g of e)t=g.x<t?g.x:t,n=g.x>n?g.x:n,o=g.y<o?g.y:o,r=g.y>r?g.y:r;let l=n-t,h=r-o,w={x:(t+n)/2,y:(o+r)/2};return{min:{x:t,y:o},max:{x:n,y:r},width:l,height:h,center:w}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let o=!1;for(let r=0,l=t.length-1;r<t.length;l=r++){const h=t[r].y>e.y,w=t[l].y>e.y;h!==w&&e.x<(t[l].x-t[r].x)*(e.y-t[r].y)/(t[l].y-t[r].y)+t[r].x&&(o=!o)}return o}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:gi(e.x,t.x,n),y:gi(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Xe{static inverse(e){const[t,n,o,r,l,h,w,g,S]=e,A=t*(l*S-g*h)-n*(r*S-h*w)+o*(r*g-l*w);if(Math.abs(A)<1e-14)return e;const k=1/A,q=(l*S-g*h)*k,O=(o*g-n*S)*k,B=(n*h-o*l)*k,T=(h*w-r*S)*k,P=(t*S-o*w)*k,C=(r*o-t*h)*k,V=(r*g-w*l)*k,R=(w*n-t*g)*k,Q=(t*l-r*n)*k;return[q,O,B,T,P,C,V,R,Q]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Rn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Xe.fromPosition(e.position),n=Xe.fromScale(e.scale),o=Xe.fromRotation(e.rotation);return Xe.multiply(Xe.multiply(t,o),n)}static decompose(e){const[t,n,o,r,l,h]=e,w=t*l-r*n,g={position:{x:o,y:h},rotation:0,scale:{x:1,y:1}};if(t!=0||r!=0){var S=Math.sqrt(t*t+r*r);g.rotation=r>0?Math.acos(t/S):-Math.acos(t/S),g.scale={x:S,y:w/S}}else if(n!=0||l!=0){var A=Math.sqrt(n*n+l*l);g.rotation=Math.PI/2-(l>0?Math.acos(-n/A):-Math.acos(n/A)),g.scale={x:w/A,y:A}}return g.rotation=Pr(g.rotation),g}}class $r{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const X=new $r;function Lr(i){return i.layer=="MAP"&&(i.metadata[`${y.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${y.ARMINDOID}/isBackgroundImage`])}function mt(i){return i.metadata[`${y.EXTENSIONID}/isVisionFog`]||i.metadata[`${y.ARMINDOID}/isVisionFog`]}function Mr(i){return i.metadata[`${y.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${y.ARMINDOID}/isIndicatorRing`]}function Fr(i){return i.metadata[`${y.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${y.EXTENSIONID}/disabled`]||i.metadata[`${y.ARMINDOID}/isVisionLine`]&&!i.metadata[`${y.ARMINDOID}/disabled`]}function Bi(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${y.EXTENSIONID}/hasVision`]||i.metadata[`${y.ARMINDOID}/hasVision`])}function Rr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${y.EXTENSIONID}/hasVision`]||i.metadata[`${y.ARMINDOID}/hasVision`])&&!i.metadata[`${y.EXTENSIONID}/visionBlind`]}function Br(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&i.createdUserId==X.userId&&(i.metadata[`${y.EXTENSIONID}/hasVision`]||i.metadata[`${y.ARMINDOID}/hasVision`])&&!i.metadata[`${y.EXTENSIONID}/visionBlind`]}function Xi(i){return i.layer=="DRAWING"&&(i.metadata[`${y.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${y.ARMINDOID}/isBackgroundImage`])}function Ht(i){return i.metadata[`${y.EXTENSIONID}/isTrailingFog`]}function Bn(i){return i.metadata[`${y.EXTENSIONID}/isTrailingFog`]||i.metadata[`${y.EXTENSIONID}/isVisionFog`]||i.metadata[`${y.ARMINDOID}/isVisionFog`]||i.metadata[`${y.EXTENSIONID}/isIndicatorRing`]}function At(i){return i.metadata[`${y.EXTENSIONID}/visionTorch`]}function Vi(i){return i.layer=="CHARACTER"&&!Bi(i)&&i.metadata[`${y.EXTENSIONID}/hasAutohide`]===!0}var ji={exports:{}};const Xr={},Vr=Object.freeze(Object.defineProperty({__proto__:null,default:Xr},Symbol.toStringTag,{value:"Module"})),Tn=Cr(Vr);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var l=Object.assign,h,w;r.ready=new Promise(function(s,a){h=s,w=a}),function(s){var a={};s.loadCmdsTypedArray=function(j){for(var Y=0,J=0;J<j.length;J++)Y+=j[J].length;if(a[Y])var ee=a[Y];else ee=new Float32Array(Y),a[Y]=ee;var ie=0;for(J=0;J<j.length;J++)for(var _e=0;_e<j[J].length;_e++){var ke=j[J][_e];typeof ke=="string"&&(ke=s.SkBits2FloatUnsigned(parseInt(ke))),ee[ie]=ke,ie++}return j=s._malloc(ee.length*ee.BYTES_PER_ELEMENT),s.HEAPF32.set(ee,j/ee.BYTES_PER_ELEMENT),[j,Y]},s.FromCmds=function(j){j=s.loadCmdsTypedArray(j);var Y=s._FromCmds(j[0],j[1]);return s._free(j[0]),Y};var u,v,N,M,K;s.cubicYFromX=function(j,Y,J,ee,ie){return u&&v===j&&N===Y&&M===J&&K===ee||(u&&u.delete(),u=new s._SkCubicMap([j,Y],[J,ee]),v=j,N=Y,M=J,K=ee),u.computeYFromX(ie)},s.cubicPtFromT=function(j,Y,J,ee,ie){return u&&v===j&&N===Y&&M===J&&K===ee||(u&&u.delete(),u=new s._SkCubicMap([j,Y],[J,ee]),v=j,N=Y,M=J,K=ee),u.computePtFromT(ie)}}(r),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var a=arguments[0];if(arguments.length===1)this._addPath(a,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var u=arguments[1];this._addPath(a,u.a,u.c,u.e,u.b,u.d,u.f,0,0,1)}else if(arguments.length===7)u=arguments,this._addPath(a,u[1],u[3],u[5],u[2],u[4],u[6],0,0,1);else if(arguments.length===10)u=arguments,this._addPath(a,u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(a,u,v,N,M,K){return this._arc(a,u,v,N,M,!!K),this},s.SkPath.prototype.arcTo=function(a,u,v,N,M){return this._arcTo(a,u,v,N,M),this},s.SkPath.prototype.bezierCurveTo=function(a,u,v,N,M,K){return this._cubicTo(a,u,v,N,M,K),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(a,u,v,N,M){return this._conicTo(a,u,v,N,M),this},s.SkPath.prototype.cubicTo=function(a,u,v,N,M,K){return this._cubicTo(a,u,v,N,M,K),this},s.SkPath.prototype.dash=function(a,u,v){return this._dash(a,u,v)?this:null},s.SkPath.prototype.ellipse=function(a,u,v,N,M,K,j,Y){return this._ellipse(a,u,v,N,M,K,j,!!Y),this},s.SkPath.prototype.lineTo=function(a,u){return this._lineTo(a,u),this},s.SkPath.prototype.moveTo=function(a,u){return this._moveTo(a,u),this},s.SkPath.prototype.op=function(a,u){return this._op(a,u)?this:null},s.SkPath.prototype.quadraticCurveTo=function(a,u,v,N){return this._quadTo(a,u,v,N),this},s.SkPath.prototype.quadTo=function(a,u,v,N){return this._quadTo(a,u,v,N),this},s.SkPath.prototype.rect=function(a,u,v,N){return this._rect(a,u,v,N),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(a){return a=a||{},a.width=a.width||1,a.miter_limit=a.miter_limit||4,a.cap=a.cap||s.StrokeCap.BUTT,a.join=a.join||s.StrokeJoin.MITER,this._stroke(a)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var a=arguments;this._transform(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(a,u,v){return this._trim(a,u,!!v)?this:null}}}(r);var g=l({},r),S=typeof window=="object",A=typeof importScripts=="function",k="",q,O,B,T,P,C;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(k=A?Tn.dirname(k)+"/":__dirname+"/",C=()=>{P||(T=Tn,P=Tn)},q=function(s,a){return C(),s=P.normalize(s),T.readFileSync(s,a?null:"utf8")},B=s=>(s=q(s,!0),s.buffer||(s=new Uint8Array(s)),s),O=(s,a,u)=>{C(),s=P.normalize(s),T.readFile(s,function(v,N){v?u(v):a(N.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),r.inspect=function(){return"[Emscripten Module object]"}):(S||A)&&(A?k=self.location.href:typeof document<"u"&&document.currentScript&&(k=document.currentScript.src),n&&(k=n),k.indexOf("blob:")!==0?k=k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1):k="",q=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},A&&(B=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),O=(s,a,u)=>{var v=new XMLHttpRequest;v.open("GET",s,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):u()},v.onerror=u,v.send(null)});var V=r.print||console.log.bind(console),R=r.printErr||console.warn.bind(console);l(r,g),g=null;var Q;r.wasmBinary&&(Q=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ne("no native wasm support detected");var b,p=!1,d=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function I(s,a,u){var v=a+u;for(u=a;s[u]&&!(u>=v);)++u;if(16<u-a&&s.subarray&&d)return d.decode(s.subarray(a,u));for(v="";a<u;){var N=s[a++];if(N&128){var M=s[a++]&63;if((N&224)==192)v+=String.fromCharCode((N&31)<<6|M);else{var K=s[a++]&63;N=(N&240)==224?(N&15)<<12|M<<6|K:(N&7)<<18|M<<12|K<<6|s[a++]&63,65536>N?v+=String.fromCharCode(N):(N-=65536,v+=String.fromCharCode(55296|N>>10,56320|N&1023))}}else v+=String.fromCharCode(N)}return v}function f(s,a,u){var v=se;if(0<u){u=a+u-1;for(var N=0;N<s.length;++N){var M=s.charCodeAt(N);if(55296<=M&&57343>=M){var K=s.charCodeAt(++N);M=65536+((M&1023)<<10)|K&1023}if(127>=M){if(a>=u)break;v[a++]=M}else{if(2047>=M){if(a+1>=u)break;v[a++]=192|M>>6}else{if(65535>=M){if(a+2>=u)break;v[a++]=224|M>>12}else{if(a+3>=u)break;v[a++]=240|M>>18,v[a++]=128|M>>12&63}v[a++]=128|M>>6&63}v[a++]=128|M&63}}v[a]=0}}var x=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function L(s,a){for(var u=s>>1,v=u+a/2;!(u>=v)&&Ve[u];)++u;if(u<<=1,32<u-s&&x)return x.decode(se.subarray(s,u));for(u="",v=0;!(v>=a/2);++v){var N=Ie[s+2*v>>1];if(N==0)break;u+=String.fromCharCode(N)}return u}function re(s,a,u){if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var v=a;u=u<2*s.length?u/2:s.length;for(var N=0;N<u;++N)Ie[a>>1]=s.charCodeAt(N),a+=2;return Ie[a>>1]=0,a-v}function oe(s){return 2*s.length}function ae(s,a){for(var u=0,v="";!(u>=a/4);){var N=le[s+4*u>>2];if(N==0)break;++u,65536<=N?(N-=65536,v+=String.fromCharCode(55296|N>>10,56320|N&1023)):v+=String.fromCharCode(N)}return v}function Z(s,a,u){if(u===void 0&&(u=2147483647),4>u)return 0;var v=a;u=v+u-4;for(var N=0;N<s.length;++N){var M=s.charCodeAt(N);if(55296<=M&&57343>=M){var K=s.charCodeAt(++N);M=65536+((M&1023)<<10)|K&1023}if(le[a>>2]=M,a+=4,a+4>u)break}return le[a>>2]=0,a-v}function me(s){for(var a=0,u=0;u<s.length;++u){var v=s.charCodeAt(u);55296<=v&&57343>=v&&++u,a+=4}return a}var be,fe,se,Ie,Ve,le,Te,Ye,ze;function Le(){var s=b.buffer;be=s,r.HEAP8=fe=new Int8Array(s),r.HEAP16=Ie=new Int16Array(s),r.HEAP32=le=new Int32Array(s),r.HEAPU8=se=new Uint8Array(s),r.HEAPU16=Ve=new Uint16Array(s),r.HEAPU32=Te=new Uint32Array(s),r.HEAPF32=Ye=new Float32Array(s),r.HEAPF64=ze=new Float64Array(s)}var D,c=[],m=[],_=[];function H(){var s=r.preRun.shift();c.unshift(s)}var W=0,G=null;r.preloadedImages={},r.preloadedAudios={};function ne(s){throw r.onAbort&&r.onAbort(s),s="Aborted("+s+")",R(s),p=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),w(s),s}function ue(){return pe.startsWith("data:application/octet-stream;base64,")}var pe;if(pe="pathkit.wasm",!ue()){var Ae=pe;pe=r.locateFile?r.locateFile(Ae,k):k+Ae}function De(){var s=pe;try{if(s==pe&&Q)return new Uint8Array(Q);if(B)return B(s);throw"both async and sync fetching of the wasm failed"}catch(a){ne(a)}}function Re(){if(!Q&&(S||A)){if(typeof fetch=="function"&&!pe.startsWith("file://"))return fetch(pe,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+pe+"'";return s.arrayBuffer()}).catch(function(){return De()});if(O)return new Promise(function(s,a){O(pe,function(u){s(new Uint8Array(u))},a)})}return Promise.resolve().then(function(){return De()})}function Ce(s){for(;0<s.length;){var a=s.shift();if(typeof a=="function")a(r);else{var u=a.Wa;typeof u=="number"?a.xa===void 0?D.get(u)():D.get(u)(a.xa):u(a.xa===void 0?null:a.xa)}}}var he={};function we(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function Ke(s){return this.fromWireType(Te[s>>2])}var lt={},tt={},E={};function U(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?"_"+s:s}function z(s,a){return s=U(s),function(){return a.apply(this,arguments)}}function te(s){var a=Error,u=z(s,function(v){this.name=s,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(a.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},u}var ce=void 0;function ge(s){throw new ce(s)}function de(s,a,u){function v(j){j=u(j),j.length!==s.length&&ge("Mismatched type converter count");for(var Y=0;Y<s.length;++Y)it(s[Y],j[Y])}s.forEach(function(j){E[j]=a});var N=Array(a.length),M=[],K=0;a.forEach(function(j,Y){tt.hasOwnProperty(j)?N[Y]=tt[j]:(M.push(j),lt.hasOwnProperty(j)||(lt[j]=[]),lt[j].push(function(){N[Y]=tt[j],++K,K===M.length&&v(N)}))}),M.length===0&&v(N)}var Ne={};function ve(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Me=void 0;function Ee(s){for(var a="";se[s];)a+=Me[se[s++]];return a}var Fe=void 0;function ye(s){throw new Fe(s)}function it(s,a,u={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var v=a.name;if(s||ye('type "'+v+'" must have a positive integer typeid pointer'),tt.hasOwnProperty(s)){if(u.Qa)return;ye("Cannot register type '"+v+"' twice")}tt[s]=a,delete E[s],lt.hasOwnProperty(s)&&(a=lt[s],delete lt[s],a.forEach(function(N){N()}))}function un(s){ye(s.ea.ha.fa.name+" instance already deleted")}var dn=!1;function Zn(){}function Jn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function wt(s){return typeof FinalizationGroup>"u"?(wt=a=>a,s):(dn=new FinalizationGroup(function(a){for(var u=a.next();!u.done;u=a.next())u=u.value,u.ga?Jn(u):console.warn("object already deleted: "+u.ga)}),wt=a=>(dn.register(a,a.ea,a.ea),a),Zn=a=>{dn.unregister(a.ea)},wt(s))}var bt=void 0,Et=[];function fn(){for(;Et.length;){var s=Et.pop();s.ea.pa=!1,s.delete()}}function ct(){}var Qn={};function ei(s,a,u){if(s[a].ia===void 0){var v=s[a];s[a]=function(){return s[a].ia.hasOwnProperty(arguments.length)||ye("Function '"+u+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].ia+")!"),s[a].ia[arguments.length].apply(this,arguments)},s[a].ia=[],s[a].ia[v.ua]=v}}function pn(s,a,u){r.hasOwnProperty(s)?((u===void 0||r[s].ia!==void 0&&r[s].ia[u]!==void 0)&&ye("Cannot register public name '"+s+"' twice"),ei(r,s,s),r.hasOwnProperty(u)&&ye("Cannot register multiple overloads of a function with the same number of arguments ("+u+")!"),r[s].ia[u]=a):(r[s]=a,u!==void 0&&(r[s].Xa=u))}function gr(s,a,u,v,N,M,K,j){this.name=s,this.constructor=a,this.qa=u,this.la=v,this.na=N,this.Oa=M,this.ta=K,this.La=j,this.Ta=[]}function hn(s,a,u){for(;a!==u;)a.ta||ye("Expected null or instance of "+u.name+", got an instance of "+a.name),s=a.ta(s),a=a.na;return s}function mr(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),hn(a.ea.ga,a.ea.ha.fa,this.fa))}function vr(s,a){if(a===null){if(this.Ba&&ye("null is not a valid "+this.name),this.wa){var u=this.sa();return s!==null&&s.push(this.la,u),u}return 0}if(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&a.ea.ha.va&&ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name),u=hn(a.ea.ga,a.ea.ha.fa,this.fa),this.wa)switch(a.ea.ka===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:a.ea.ma===this?u=a.ea.ka:ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name);break;case 1:u=a.ea.ka;break;case 2:if(a.ea.ma===this)u=a.ea.ka;else{var v=a.clone();u=this.Ua(u,ut(function(){v.delete()})),s!==null&&s.push(this.la,u)}break;default:ye("Unsupporting sharing policy")}return u}function yr(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),a.ea.ha.va&&ye("Cannot convert argument of type "+a.ea.ha.name+" to parameter type "+this.name),hn(a.ea.ga,a.ea.ha.fa,this.fa))}function ti(s,a,u){return a===u?s:u.na===void 0?null:(s=ti(s,a,u.na),s===null?null:u.La(s))}var _t={};function Ir(s,a){for(a===void 0&&ye("ptr should not be undefined");s.na;)a=s.ta(a),s=s.na;return _t[a]}function Dt(s,a){return a.ha&&a.ga||ge("makeClassHandle requires ptr and ptrType"),!!a.ma!=!!a.ka&&ge("Both smartPtrType and smartPtr must be specified"),a.count={value:1},wt(Object.create(s,{ea:{value:a}}))}function ot(s,a,u,v){this.name=s,this.fa=a,this.Ba=u,this.va=v,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,a.na!==void 0?this.toWireType=vr:(this.toWireType=v?mr:yr,this.ja=null)}function ni(s,a,u){r.hasOwnProperty(s)||ge("Replacing nonexistant public symbol"),r[s].ia!==void 0&&u!==void 0?r[s].ia[u]=a:(r[s]=a,r[s].ua=u)}function wr(s,a){var u=[];return function(){u.length=arguments.length;for(var v=0;v<arguments.length;v++)u[v]=arguments[v];return s.includes("j")?(v=r["dynCall_"+s],v=u&&u.length?v.apply(null,[a].concat(u)):v.call(null,a)):v=D.get(a).apply(null,u),v}}function je(s,a){s=Ee(s);var u=s.includes("j")?wr(s,a):D.get(a);return typeof u!="function"&&ye("unknown function pointer with signature "+s+": "+a),u}var ii=void 0;function ri(s){s=ui(s);var a=Ee(s);return at(s),a}function Pt(s,a){function u(M){N[M]||tt[M]||(E[M]?E[M].forEach(u):(v.push(M),N[M]=!0))}var v=[],N={};throw a.forEach(u),new ii(s+": "+v.map(ri).join([", "]))}function gn(s,a){for(var u=[],v=0;v<s;v++)u.push(le[(a>>2)+v]);return u}function mn(s,a,u,v,N){var M=a.length;2>M&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");var K=a[1]!==null&&u!==null,j=!1;for(u=1;u<a.length;++u)if(a[u]!==null&&a[u].ja===void 0){j=!0;break}var Y=a[0].name!=="void",J=M-2,ee=Array(J),ie=[],_e=[];return function(){if(arguments.length!==J&&ye("function "+s+" called with "+arguments.length+" arguments, expected "+J+" args!"),_e.length=0,ie.length=K?2:1,ie[0]=N,K){var ke=a[1].toWireType(_e,this);ie[1]=ke}for(var Se=0;Se<J;++Se)ee[Se]=a[Se+2].toWireType(_e,arguments[Se]),ie.push(ee[Se]);if(Se=v.apply(null,ie),j)we(_e);else for(var Ue=K?1:2;Ue<a.length;Ue++){var He=Ue===1?ke:ee[Ue-2];a[Ue].ja!==null&&a[Ue].ja(He)}return ke=Y?a[0].fromWireType(Se):void 0,ke}}var vn=[],nt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function oi(s){4<s&&--nt[s].Ca===0&&(nt[s]=void 0,vn.push(s))}function yn(s){return s||ye("Cannot use deleted val. handle = "+s),nt[s].value}function ut(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var a=vn.length?vn.pop():nt.length;return nt[a]={Ca:1,value:s},a}}function br(s,a,u){switch(a){case 0:return function(v){return this.fromWireType((u?fe:se)[v])};case 1:return function(v){return this.fromWireType((u?Ie:Ve)[v>>1])};case 2:return function(v){return this.fromWireType((u?le:Te)[v>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function $t(s,a){var u=tt[s];return u===void 0&&ye(a+" has unknown type "+ri(s)),u}function In(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Er(s,a){switch(a){case 2:return function(u){return this.fromWireType(Ye[u>>2])};case 3:return function(u){return this.fromWireType(ze[u>>3])};default:throw new TypeError("Unknown float type: "+s)}}function _r(s,a,u){switch(a){case 0:return u?function(v){return fe[v]}:function(v){return se[v]};case 1:return u?function(v){return Ie[v>>1]}:function(v){return Ve[v>>1]};case 2:return u?function(v){return le[v>>2]}:function(v){return Te[v>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Sr={};function wn(s){var a=Sr[s];return a===void 0?Ee(s):a}var bn=[];function ai(){function s(a){a.$$$embind_global$$$=a;var u=typeof $$$embind_global$$$=="object"&&a.$$$embind_global$$$===a;return u||delete a.$$$embind_global$$$,u}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof Sn=="object"&&s(Sn)?$$$embind_global$$$=Sn:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Tr(s){var a=bn.length;return bn.push(s),a}function Or(s,a){for(var u=Array(s),v=0;v<s;++v)u[v]=$t(le[(a>>2)+v],"parameter "+v);return u}var si=[];function Nr(s){var a=Array(s+1);return function(u,v,N){a[0]=u;for(var M=0;M<s;++M){var K=$t(le[(v>>2)+M],"parameter "+M);a[M+1]=K.readValueFromPointer(N),N+=K.argPackAdvance}return u=new(u.bind.apply(u,a)),ut(u)}}var li={},kr=[null,[],[]];ce=r.InternalError=te("InternalError");for(var ci=Array(256),Lt=0;256>Lt;++Lt)ci[Lt]=String.fromCharCode(Lt);Me=ci,Fe=r.BindingError=te("BindingError"),ct.prototype.isAliasOf=function(s){if(!(this instanceof ct&&s instanceof ct))return!1;var a=this.ea.ha.fa,u=this.ea.ga,v=s.ea.ha.fa;for(s=s.ea.ga;a.na;)u=a.ta(u),a=a.na;for(;v.na;)s=v.ta(s),v=v.na;return a===v&&u===s},ct.prototype.clone=function(){if(this.ea.ga||un(this),this.ea.ra)return this.ea.count.value+=1,this;var s=wt,a=Object,u=a.create,v=Object.getPrototypeOf(this),N=this.ea;return s=s(u.call(a,v,{ea:{value:{count:N.count,pa:N.pa,ra:N.ra,ga:N.ga,ha:N.ha,ka:N.ka,ma:N.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},ct.prototype.delete=function(){this.ea.ga||un(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),Zn(this),Jn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},ct.prototype.isDeleted=function(){return!this.ea.ga},ct.prototype.deleteLater=function(){return this.ea.ga||un(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),Et.push(this),Et.length===1&&bt&&bt(fn),this.ea.pa=!0,this},ot.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},ot.prototype.Ga=function(s){this.la&&this.la(s)},ot.prototype.argPackAdvance=8,ot.prototype.readValueFromPointer=Ke,ot.prototype.deleteObject=function(s){s!==null&&s.delete()},ot.prototype.fromWireType=function(s){function a(){return this.wa?Dt(this.fa.qa,{ha:this.Sa,ga:u,ma:this,ka:s}):Dt(this.fa.qa,{ha:this,ga:s})}var u=this.Pa(s);if(!u)return this.Ga(s),null;var v=Ir(this.fa,u);if(v!==void 0)return v.ea.count.value===0?(v.ea.ga=u,v.ea.ka=s,v.clone()):(v=v.clone(),this.Ga(s),v);if(v=this.fa.Oa(u),v=Qn[v],!v)return a.call(this);v=this.va?v.Ja:v.pointerType;var N=ti(u,this.fa,v.fa);return N===null?a.call(this):this.wa?Dt(v.fa.qa,{ha:v,ga:N,ma:this,ka:s}):Dt(v.fa.qa,{ha:v,ga:N})},r.getInheritedInstanceCount=function(){return Object.keys(_t).length},r.getLiveInheritedInstances=function(){var s=[],a;for(a in _t)_t.hasOwnProperty(a)&&s.push(_t[a]);return s},r.flushPendingDeletes=fn,r.setDelayFunction=function(s){bt=s,Et.length&&bt&&bt(fn)},ii=r.UnboundTypeError=te("UnboundTypeError"),r.count_emval_handles=function(){for(var s=0,a=5;a<nt.length;++a)nt[a]!==void 0&&++s;return s},r.get_first_emval=function(){for(var s=5;s<nt.length;++s)if(nt[s]!==void 0)return nt[s];return null};var xr={r:function(s){var a=he[s];delete he[s];var u=a.elements,v=u.length,N=u.map(function(j){return j.Aa}).concat(u.map(function(j){return j.Ea})),M=a.sa,K=a.la;de([s],N,function(j){return u.forEach(function(Y,J){var ee=j[J],ie=Y.ya,_e=Y.za,ke=j[J+v],Se=Y.Da,Ue=Y.Fa;Y.read=He=>ee.fromWireType(ie(_e,He)),Y.write=(He,ft)=>{var Ze=[];Se(Ue,He,ke.toWireType(Ze,ft)),we(Ze)}}),[{name:a.name,fromWireType:function(Y){for(var J=Array(v),ee=0;ee<v;++ee)J[ee]=u[ee].read(Y);return K(Y),J},toWireType:function(Y,J){if(v!==J.length)throw new TypeError("Incorrect number of tuple elements for "+a.name+": expected="+v+", actual="+J.length);for(var ee=M(),ie=0;ie<v;++ie)u[ie].write(ee,J[ie]);return Y!==null&&Y.push(K,ee),ee},argPackAdvance:8,readValueFromPointer:Ke,ja:K}]})},u:function(s){var a=Ne[s];delete Ne[s];var u=a.sa,v=a.la,N=a.Ha,M=N.map(function(K){return K.Aa}).concat(N.map(function(K){return K.Ea}));de([s],M,function(K){var j={};return N.forEach(function(Y,J){var ee=K[J],ie=Y.ya,_e=Y.za,ke=K[J+N.length],Se=Y.Da,Ue=Y.Fa;j[Y.Na]={read:function(He){return ee.fromWireType(ie(_e,He))},write:function(He,ft){var Ze=[];Se(Ue,He,ke.toWireType(Ze,ft)),we(Ze)}}}),[{name:a.name,fromWireType:function(Y){var J={},ee;for(ee in j)J[ee]=j[ee].read(Y);return v(Y),J},toWireType:function(Y,J){for(var ee in j)if(!(ee in J))throw new TypeError('Missing field:  "'+ee+'"');var ie=u();for(ee in j)j[ee].write(ie,J[ee]);return Y!==null&&Y.push(v,ie),ie},argPackAdvance:8,readValueFromPointer:Ke,ja:v}]})},z:function(){},F:function(s,a,u,v,N){var M=ve(u);a=Ee(a),it(s,{name:a,fromWireType:function(K){return!!K},toWireType:function(K,j){return j?v:N},argPackAdvance:8,readValueFromPointer:function(K){if(u===1)var j=fe;else if(u===2)j=Ie;else if(u===4)j=le;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(j[K>>M])},ja:null})},l:function(s,a,u,v,N,M,K,j,Y,J,ee,ie,_e){ee=Ee(ee),M=je(N,M),j&&(j=je(K,j)),J&&(J=je(Y,J)),_e=je(ie,_e);var ke=U(ee);pn(ke,function(){Pt("Cannot construct "+ee+" due to unbound types",[v])}),de([s,a,u],v?[v]:[],function(Se){if(Se=Se[0],v)var Ue=Se.fa,He=Ue.qa;else He=ct.prototype;Se=z(ke,function(){if(Object.getPrototypeOf(this)!==ft)throw new Fe("Use 'new' to construct "+ee);if(Ze.oa===void 0)throw new Fe(ee+" has no accessible constructor");var fi=Ze.oa[arguments.length];if(fi===void 0)throw new Fe("Tried to invoke ctor of "+ee+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ze.oa).toString()+") parameters instead!");return fi.apply(this,arguments)});var ft=Object.create(He,{constructor:{value:Se}});Se.prototype=ft;var Ze=new gr(ee,Se,ft,_e,Ue,M,j,J);Ue=new ot(ee,Ze,!0,!1),He=new ot(ee+"*",Ze,!1,!1);var di=new ot(ee+" const*",Ze,!1,!0);return Qn[s]={pointerType:He,Ja:di},ni(ke,Se),[Ue,He,di]})},i:function(s,a,u,v,N,M){0<a||ne(void 0);var K=gn(a,u);N=je(v,N),de([],[s],function(j){j=j[0];var Y="constructor "+j.name;if(j.fa.oa===void 0&&(j.fa.oa=[]),j.fa.oa[a-1]!==void 0)throw new Fe("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+j.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return j.fa.oa[a-1]=()=>{Pt("Cannot construct "+j.name+" due to unbound types",K)},de([],K,function(J){return J.splice(1,0,null),j.fa.oa[a-1]=mn(Y,J,null,N,M),[]}),[]})},a:function(s,a,u,v,N,M,K,j){var Y=gn(u,v);a=Ee(a),M=je(N,M),de([],[s],function(J){function ee(){Pt("Cannot call "+ie+" due to unbound types",Y)}J=J[0];var ie=J.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),j&&J.fa.Ta.push(a);var _e=J.fa.qa,ke=_e[a];return ke===void 0||ke.ia===void 0&&ke.className!==J.name&&ke.ua===u-2?(ee.ua=u-2,ee.className=J.name,_e[a]=ee):(ei(_e,a,ie),_e[a].ia[u-2]=ee),de([],Y,function(Se){return Se=mn(ie,Se,J,M,K),_e[a].ia===void 0?(Se.ua=u-2,_e[a]=Se):_e[a].ia[u-2]=Se,[]}),[]})},I:function(s,a,u){s=Ee(s),de([],[a],function(v){return v=v[0],r[s]=v.fromWireType(u),[]})},E:function(s,a){a=Ee(a),it(s,{name:a,fromWireType:function(u){var v=yn(u);return oi(u),v},toWireType:function(u,v){return ut(v)},argPackAdvance:8,readValueFromPointer:Ke,ja:null})},h:function(s,a,u,v){function N(){}u=ve(u),a=Ee(a),N.values={},it(s,{name:a,constructor:N,fromWireType:function(M){return this.constructor.values[M]},toWireType:function(M,K){return K.value},argPackAdvance:8,readValueFromPointer:br(a,u,v),ja:null}),pn(a,N)},k:function(s,a,u){var v=$t(s,"enum");a=Ee(a),s=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:u},constructor:{value:z(v.name+"_"+a,function(){})}}),s.values[u]=v,s[a]=v},q:function(s,a,u){u=ve(u),a=Ee(a),it(s,{name:a,fromWireType:function(v){return v},toWireType:function(v,N){return N},argPackAdvance:8,readValueFromPointer:Er(a,u),ja:null})},f:function(s,a,u,v,N,M){var K=gn(a,u);s=Ee(s),N=je(v,N),pn(s,function(){Pt("Cannot call "+s+" due to unbound types",K)},a-1),de([],K,function(j){return j=[j[0],null].concat(j.slice(1)),ni(s,mn(s,j,null,N,M),a-1),[]})},e:function(s,a,u,v,N){a=Ee(a),N===-1&&(N=4294967295),N=ve(u);var M=j=>j;if(v===0){var K=32-8*u;M=j=>j<<K>>>K}u=a.includes("unsigned")?function(j,Y){return Y>>>0}:function(j,Y){return Y},it(s,{name:a,fromWireType:M,toWireType:u,argPackAdvance:8,readValueFromPointer:_r(a,N,v!==0),ja:null})},b:function(s,a,u){function v(M){M>>=2;var K=Te;return new N(be,K[M+1],K[M])}var N=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];u=Ee(u),it(s,{name:u,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{Qa:!0})},p:function(s,a){a=Ee(a);var u=a==="std::string";it(s,{name:a,fromWireType:function(v){var N=Te[v>>2];if(u)for(var M=v+4,K=0;K<=N;++K){var j=v+4+K;if(K==N||se[j]==0){if(M=M?I(se,M,j-M):"",Y===void 0)var Y=M;else Y+=String.fromCharCode(0),Y+=M;M=j+1}}else{for(Y=Array(N),K=0;K<N;++K)Y[K]=String.fromCharCode(se[v+4+K]);Y=Y.join("")}return at(v),Y},toWireType:function(v,N){N instanceof ArrayBuffer&&(N=new Uint8Array(N));var M=typeof N=="string";M||N instanceof Uint8Array||N instanceof Uint8ClampedArray||N instanceof Int8Array||ye("Cannot pass non-string to std::string");var K=(u&&M?()=>{for(var J=0,ee=0;ee<N.length;++ee){var ie=N.charCodeAt(ee);55296<=ie&&57343>=ie&&(ie=65536+((ie&1023)<<10)|N.charCodeAt(++ee)&1023),127>=ie?++J:J=2047>=ie?J+2:65535>=ie?J+3:J+4}return J}:()=>N.length)(),j=En(4+K+1);if(Te[j>>2]=K,u&&M)f(N,j+4,K+1);else if(M)for(M=0;M<K;++M){var Y=N.charCodeAt(M);255<Y&&(at(j),ye("String has UTF-16 code units that do not fit in 8 bits")),se[j+4+M]=Y}else for(M=0;M<K;++M)se[j+4+M]=N[M];return v!==null&&v.push(at,j),j},argPackAdvance:8,readValueFromPointer:Ke,ja:function(v){at(v)}})},m:function(s,a,u){if(u=Ee(u),a===2)var v=L,N=re,M=oe,K=()=>Ve,j=1;else a===4&&(v=ae,N=Z,M=me,K=()=>Te,j=2);it(s,{name:u,fromWireType:function(Y){for(var J=Te[Y>>2],ee=K(),ie,_e=Y+4,ke=0;ke<=J;++ke){var Se=Y+4+ke*a;(ke==J||ee[Se>>j]==0)&&(_e=v(_e,Se-_e),ie===void 0?ie=_e:(ie+=String.fromCharCode(0),ie+=_e),_e=Se+a)}return at(Y),ie},toWireType:function(Y,J){typeof J!="string"&&ye("Cannot pass non-string to C++ string type "+u);var ee=M(J),ie=En(4+ee+a);return Te[ie>>2]=ee>>j,N(J,ie+4,ee+a),Y!==null&&Y.push(at,ie),ie},argPackAdvance:8,readValueFromPointer:Ke,ja:function(Y){at(Y)}})},t:function(s,a,u,v,N,M){he[s]={name:Ee(a),sa:je(u,v),la:je(N,M),elements:[]}},s:function(s,a,u,v,N,M,K,j,Y){he[s].elements.push({Aa:a,ya:je(u,v),za:N,Ea:M,Da:je(K,j),Fa:Y})},v:function(s,a,u,v,N,M){Ne[s]={name:Ee(a),sa:je(u,v),la:je(N,M),Ha:[]}},j:function(s,a,u,v,N,M,K,j,Y,J){Ne[s].Ha.push({Na:Ee(a),Aa:u,ya:je(v,N),za:M,Ea:K,Da:je(j,Y),Fa:J})},G:function(s,a){a=Ee(a),it(s,{Ra:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,a,u,v){s=bn[s],a=yn(a),u=wn(u),s(a,u,null,v)},J:oi,x:function(s){return s===0?ut(ai()):(s=wn(s),ut(ai()[s]))},c:function(s,a){var u=Or(s,a),v=u[0];a=v.name+"_$"+u.slice(1).map(function(K){return K.name}).join("_")+"$";var N=si[a];if(N!==void 0)return N;var M=Array(s-1);return N=Tr((K,j,Y,J)=>{for(var ee=0,ie=0;ie<s-1;++ie)M[ie]=u[ie+1].readValueFromPointer(J+ee),ee+=u[ie+1].argPackAdvance;for(K=K[j].apply(K,M),ie=0;ie<s-1;++ie)u[ie+1].Ka&&u[ie+1].Ka(M[ie]);if(!v.Ra)return v.toWireType(Y,K)}),si[a]=N},n:function(s){4<s&&(nt[s].Ca+=1)},w:function(s,a,u,v){s=yn(s);var N=li[a];return N||(N=Nr(a),li[a]=N),N(s,u,v)},K:function(){return ut([])},D:function(s){return ut(wn(s))},H:function(s,a){return s=$t(s,"_emval_take_value"),s=s.readValueFromPointer(a),ut(s)},g:function(){ne("")},B:function(s){var a=se.length;if(s>>>=0,2147483648<s)return!1;for(var u=1;4>=u;u*=2){var v=a*(1+.2/u);v=Math.min(v,s+100663296),v=Math.max(s,v),0<v%65536&&(v+=65536-v%65536);e:{try{b.grow(Math.min(2147483648,v)-be.byteLength+65535>>>16),Le();var N=1;break e}catch{}N=void 0}if(N)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,a,u,v){for(var N=0,M=0;M<u;M++){var K=le[a>>2],j=le[a+4>>2];a+=8;for(var Y=0;Y<j;Y++){var J=se[K+Y],ee=kr[s];J===0||J===10?((s===1?V:R)(I(ee,0)),ee.length=0):ee.push(J)}N+=j}return le[v>>2]=N,0},A:function(){}};(function(){function s(N){r.asm=N.exports,b=r.asm.L,Le(),D=r.asm._,m.unshift(r.asm.M),W--,r.monitorRunDependencies&&r.monitorRunDependencies(W),W==0&&G&&(N=G,G=null,N())}function a(N){s(N.instance)}function u(N){return Re().then(function(M){return WebAssembly.instantiate(M,v)}).then(function(M){return M}).then(N,function(M){R("failed to asynchronously prepare wasm: "+M),ne(M)})}var v={a:xr};if(W++,r.monitorRunDependencies&&r.monitorRunDependencies(W),r.instantiateWasm)try{return r.instantiateWasm(v,s)}catch(N){return R("Module.instantiateWasm callback failed with error: "+N),!1}return function(){return Q||typeof WebAssembly.instantiateStreaming!="function"||ue()||pe.startsWith("file://")||typeof fetch!="function"?u(a):fetch(pe,{credentials:"same-origin"}).then(function(N){return WebAssembly.instantiateStreaming(N,v).then(a,function(M){return R("wasm streaming compile failed: "+M),R("falling back to ArrayBuffer instantiation"),u(a)})})}().catch(w),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var at=r._free=function(){return(at=r._free=r.asm.$).apply(null,arguments)},En=r._malloc=function(){return(En=r._malloc=r.asm.aa).apply(null,arguments)},ui=r.___getTypeName=function(){return(ui=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Mt;G=function s(){Mt||_n(),Mt||(G=s)};function _n(){function s(){if(!Mt&&(Mt=!0,r.calledRun=!0,!p)){if(Ce(m),h(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var a=r.postRun.shift();_.unshift(a)}Ce(_)}}if(!(0<W)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)H();Ce(c),0<W||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),s()},1)):s())}}if(r.run=_n,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return _n(),o.ready}})();i.exports=t})(ji);var jr=ji.exports;const Ur=qn(jr),Hr="/assets/pathkit-1356ccfa.wasm";let Qe=null,Zt="",Jt="",Qt="",en="";async function Ui(){await F.scene.local.deleteItems([en,Zt,Jt,Qt]),Zt="",Jt="",en="",Qt="",await F.popover.close(y.POLYTOOLID)}async function Hi(){if(!Qe)return;const[i,e]=Qe;e(),Qe=null,Ui()}async function Wi(){if(!Qe)return;const[i,e]=Qe,t=i(n=>{n.visible=!1,n.metadata[`${y.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&F.scene.items.addItems([t]),e(),Qe=null,Ui()}async function Wr(i,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===Zt||e.target.id===Jt))Wi();else if(e.target&&(e.target.id===en||e.target.id===Qt))Hi();else{const[t]=Qe;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Yt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Gn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Qe=await F.interaction.startItemInteraction(n);const o=It().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=It().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Yt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await F.scene.local.addItems([t,o,r,l]),Zt=t.id,Jt=o.id,en=l.id,Qt=r.id,await F.popover.open({id:y.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function Gr(i,e){if(!Qe||e.transformer)return;const[t]=Qe,n=Math.round(X.gridDpi/X.gridSnap),o=Math.round(e.pointerPosition.x/X.gridDpi)*X.gridDpi,r=Math.round(e.pointerPosition.y/X.gridDpi)*X.gridDpi,l=Math.abs(o-e.pointerPosition.x),h=Math.abs(r-e.pointerPosition.y);let w,g;l<=n?w=o:w=e.pointerPosition.x,h<=n?g=r:g=e.pointerPosition.y,t(S=>{S.points[S.points.length-1]=X.snap?{x:w,y:g}:e.pointerPosition})}function qr(i,e){Qe&&(e.key=="Escape"?Hi():e.key=="Enter"&&Wi())}const On={onToolClick:Wr,onToolMove:Gr,onKeyDown:qr};let et=null,Nt="",kt="",tn="",nn="";async function Gi(){await F.scene.local.deleteItems([nn,Nt,kt,tn]),Nt="",kt="",nn="",tn="",await F.popover.close(y.LINETOOLID)}async function qi(){if(!et)return;const[i,e]=et;e(),et=null,await Gi()}async function zi(){if(!et)return;const[i,e]=et,t=i(n=>{n.visible=!1,n.metadata[`${y.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await F.scene.items.addItems([t]),e(),et=null,await Gi()}async function zr(i,e){if(!e.transformer)if(et)if(e.target&&(e.target.id===Nt||e.target.id===kt))await zi();else if(e.target&&(e.target.id===nn||e.target.id===tn))await qi();else{const[t]=et;t(n=>{n.points.push(e.pointerPosition)}),await F.scene.local.updateItems(n=>n.id==kt||n.id==Nt,n=>{for(const o of n)o.position=e.pointerPosition})}else{const t=Yt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Gn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();et=await F.interaction.startItemInteraction(n);const o=It().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=It().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Yt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await F.scene.local.addItems([t,o,r,l]),Nt=t.id,kt=o.id,nn=l.id,tn=r.id,await F.popover.open({id:y.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function Kr(i,e){if(!et||e.transformer)return;const[t]=et,n=Math.round(X.gridDpi/X.gridSnap),o=Math.round(e.pointerPosition.x/X.gridDpi)*X.gridDpi,r=Math.round(e.pointerPosition.y/X.gridDpi)*X.gridDpi,l=Math.abs(o-e.pointerPosition.x),h=Math.abs(r-e.pointerPosition.y);let w,g;l<=n?w=o:w=e.pointerPosition.x,h<=n?g=r:g=e.pointerPosition.y,t(S=>{S.points[S.points.length-1]=X.snap?{x:w,y:g}:e.pointerPosition})}function Yr(i,e){et&&(e.key=="Escape"?qi():e.key=="Enter"&&zi())}const Nn={onToolClick:zr,onToolMove:Kr,onKeyDown:Yr};class Xn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Ft(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ki={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,o,r){function l(g,S){if(!o[g]){if(!n[g]){var A=typeof Ft=="function"&&Ft;if(!S&&A)return A(g,!0);if(h)return h(g,!0);throw new Error("Cannot find module '"+g+"'")}S=o[g]={exports:{}},n[g][0].call(S.exports,function(k){var q=n[g][1][k];return l(q||k)},S,S.exports,t,n,o,r)}return o[g].exports}for(var h=typeof Ft=="function"&&Ft,w=0;w<r.length;w++)l(r[w]);return l}({1:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){var O=t("crypto");function B(b,p){p=C(b,p);var d;return(d=p.algorithm!=="passthrough"?O.createHash(p.algorithm):new Q).write===void 0&&(d.write=d.update,d.end=d.update),R(p,d).dispatch(b),d.update||d.end(""),d.digest?d.digest(p.encoding==="buffer"?void 0:p.encoding):(b=d.read(),p.encoding!=="buffer"?b.toString(p.encoding):b)}(o=n.exports=B).sha1=function(b){return B(b)},o.keys=function(b){return B(b,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(b){return B(b,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(b){return B(b,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var T=O.getHashes?O.getHashes().slice():["sha1","md5"],P=(T.push("passthrough"),["buffer","hex","binary","base64"]);function C(b,p){var d={};if(d.algorithm=(p=p||{}).algorithm||"sha1",d.encoding=p.encoding||"hex",d.excludeValues=!!p.excludeValues,d.algorithm=d.algorithm.toLowerCase(),d.encoding=d.encoding.toLowerCase(),d.ignoreUnknown=p.ignoreUnknown===!0,d.respectType=p.respectType!==!1,d.respectFunctionNames=p.respectFunctionNames!==!1,d.respectFunctionProperties=p.respectFunctionProperties!==!1,d.unorderedArrays=p.unorderedArrays===!0,d.unorderedSets=p.unorderedSets!==!1,d.unorderedObjects=p.unorderedObjects!==!1,d.replacer=p.replacer||void 0,d.excludeKeys=p.excludeKeys||void 0,b===void 0)throw new Error("Object argument required.");for(var I=0;I<T.length;++I)T[I].toLowerCase()===d.algorithm.toLowerCase()&&(d.algorithm=T[I]);if(T.indexOf(d.algorithm)===-1)throw new Error('Algorithm "'+d.algorithm+'"  not supported. supported values: '+T.join(", "));if(P.indexOf(d.encoding)===-1&&d.algorithm!=="passthrough")throw new Error('Encoding "'+d.encoding+'"  not supported. supported values: '+P.join(", "));return d}function V(b){if(typeof b=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(b))!=null}function R(b,p,d){d=d||[];function I(f){return p.update?p.update(f,"utf8"):p.write(f,"utf8")}return{dispatch:function(f){return this["_"+((f=b.replacer?b.replacer(f):f)===null?"null":typeof f)](f)},_object:function(f){var x,L=Object.prototype.toString.call(f),re=/\[object (.*)\]/i.exec(L);if(re=(re=re?re[1]:"unknown:["+L+"]").toLowerCase(),0<=(L=d.indexOf(f)))return this.dispatch("[CIRCULAR:"+L+"]");if(d.push(f),h!==void 0&&h.isBuffer&&h.isBuffer(f))return I("buffer:"),I(f);if(re==="object"||re==="function"||re==="asyncfunction")return L=Object.keys(f),b.unorderedObjects&&(L=L.sort()),b.respectType===!1||V(f)||L.splice(0,0,"prototype","__proto__","constructor"),b.excludeKeys&&(L=L.filter(function(oe){return!b.excludeKeys(oe)})),I("object:"+L.length+":"),x=this,L.forEach(function(oe){x.dispatch(oe),I(":"),b.excludeValues||x.dispatch(f[oe]),I(",")});if(!this["_"+re]){if(b.ignoreUnknown)return I("["+re+"]");throw new Error('Unknown object type "'+re+'"')}this["_"+re](f)},_array:function(f,oe){oe=oe!==void 0?oe:b.unorderedArrays!==!1;var L=this;if(I("array:"+f.length+":"),!oe||f.length<=1)return f.forEach(function(ae){return L.dispatch(ae)});var re=[],oe=f.map(function(ae){var Z=new Q,me=d.slice();return R(b,Z,me).dispatch(ae),re=re.concat(me.slice(d.length)),Z.read().toString()});return d=d.concat(re),oe.sort(),this._array(oe,!1)},_date:function(f){return I("date:"+f.toJSON())},_symbol:function(f){return I("symbol:"+f.toString())},_error:function(f){return I("error:"+f.toString())},_boolean:function(f){return I("bool:"+f.toString())},_string:function(f){I("string:"+f.length+":"),I(f.toString())},_function:function(f){I("fn:"),V(f)?this.dispatch("[native]"):this.dispatch(f.toString()),b.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(f.name)),b.respectFunctionProperties&&this._object(f)},_number:function(f){return I("number:"+f.toString())},_xml:function(f){return I("xml:"+f.toString())},_null:function(){return I("Null")},_undefined:function(){return I("Undefined")},_regexp:function(f){return I("regex:"+f.toString())},_uint8array:function(f){return I("uint8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint8clampedarray:function(f){return I("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(f))},_int8array:function(f){return I("int8array:"),this.dispatch(Array.prototype.slice.call(f))},_uint16array:function(f){return I("uint16array:"),this.dispatch(Array.prototype.slice.call(f))},_int16array:function(f){return I("int16array:"),this.dispatch(Array.prototype.slice.call(f))},_uint32array:function(f){return I("uint32array:"),this.dispatch(Array.prototype.slice.call(f))},_int32array:function(f){return I("int32array:"),this.dispatch(Array.prototype.slice.call(f))},_float32array:function(f){return I("float32array:"),this.dispatch(Array.prototype.slice.call(f))},_float64array:function(f){return I("float64array:"),this.dispatch(Array.prototype.slice.call(f))},_arraybuffer:function(f){return I("arraybuffer:"),this.dispatch(new Uint8Array(f))},_url:function(f){return I("url:"+f.toString())},_map:function(f){return I("map:"),f=Array.from(f),this._array(f,b.unorderedSets!==!1)},_set:function(f){return I("set:"),f=Array.from(f),this._array(f,b.unorderedSets!==!1)},_file:function(f){return I("file:"),this.dispatch([f.name,f.size,f.type,f.lastModfied])},_blob:function(){if(b.ignoreUnknown)return I("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return I("domwindow")},_bigint:function(f){return I("bigint:"+f.toString())},_process:function(){return I("process")},_timer:function(){return I("timer")},_pipe:function(){return I("pipe")},_tcp:function(){return I("tcp")},_udp:function(){return I("udp")},_tty:function(){return I("tty")},_statwatcher:function(){return I("statwatcher")},_securecontext:function(){return I("securecontext")},_connection:function(){return I("connection")},_zlib:function(){return I("zlib")},_context:function(){return I("context")},_nodescript:function(){return I("nodescript")},_httpparser:function(){return I("httpparser")},_dataview:function(){return I("dataview")},_signal:function(){return I("signal")},_fsevent:function(){return I("fsevent")},_tlswrap:function(){return I("tlswrap")}}}function Q(){return{buf:"",write:function(b){this.buf+=b},end:function(b){this.buf+=b},read:function(){return this.buf}}}o.writeToStream=function(b,p,d){return d===void 0&&(d=p,p={}),R(p=C(b,p),d).dispatch(b)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){(function(O){var B=typeof Uint8Array<"u"?Uint8Array:Array,T="+".charCodeAt(0),P="/".charCodeAt(0),C="0".charCodeAt(0),V="a".charCodeAt(0),R="A".charCodeAt(0),Q="-".charCodeAt(0),b="_".charCodeAt(0);function p(d){return d=d.charCodeAt(0),d===T||d===Q?62:d===P||d===b?63:d<C?-1:d<C+10?d-C+26+26:d<R+26?d-R:d<V+26?d-V+26:void 0}O.toByteArray=function(d){var I,f;if(0<d.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var x=d.length,x=d.charAt(x-2)==="="?2:d.charAt(x-1)==="="?1:0,L=new B(3*d.length/4-x),re=0<x?d.length-4:d.length,oe=0;function ae(Z){L[oe++]=Z}for(I=0;I<re;I+=4,0)ae((16711680&(f=p(d.charAt(I))<<18|p(d.charAt(I+1))<<12|p(d.charAt(I+2))<<6|p(d.charAt(I+3))))>>16),ae((65280&f)>>8),ae(255&f);return x==2?ae(255&(f=p(d.charAt(I))<<2|p(d.charAt(I+1))>>4)):x==1&&(ae((f=p(d.charAt(I))<<10|p(d.charAt(I+1))<<4|p(d.charAt(I+2))>>2)>>8&255),ae(255&f)),L},O.fromByteArray=function(d){var I,f,x,L,re=d.length%3,oe="";function ae(Z){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Z)}for(I=0,x=d.length-re;I<x;I+=3)f=(d[I]<<16)+(d[I+1]<<8)+d[I+2],oe+=ae((L=f)>>18&63)+ae(L>>12&63)+ae(L>>6&63)+ae(63&L);switch(re){case 1:oe=(oe+=ae((f=d[d.length-1])>>2))+ae(f<<4&63)+"==";break;case 2:oe=(oe=(oe+=ae((f=(d[d.length-2]<<8)+d[d.length-1])>>10))+ae(f>>4&63))+ae(f<<2&63)+"="}return oe}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,o){(function(r,l,T,w,g,S,A,k,q){var O=t("base64-js"),B=t("ieee754");function T(c,m,_){if(!(this instanceof T))return new T(c,m,_);var H,W,G,ne,ue=typeof c;if(m==="base64"&&ue=="string")for(c=(ne=c).trim?ne.trim():ne.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(ue=="number")H=be(c);else if(ue=="string")H=T.byteLength(c,m);else{if(ue!="object")throw new Error("First argument needs to be a number, array or string.");H=be(c.length)}if(T._useTypedArrays?W=T._augment(new Uint8Array(H)):((W=this).length=H,W._isBuffer=!0),T._useTypedArrays&&typeof c.byteLength=="number")W._set(c);else if(fe(ne=c)||T.isBuffer(ne)||ne&&typeof ne=="object"&&typeof ne.length=="number")for(G=0;G<H;G++)T.isBuffer(c)?W[G]=c.readUInt8(G):W[G]=c[G];else if(ue=="string")W.write(c,0,m);else if(ue=="number"&&!T._useTypedArrays&&!_)for(G=0;G<H;G++)W[G]=0;return W}function P(c,m,_,H){return T._charsWritten=le(function(W){for(var G=[],ne=0;ne<W.length;ne++)G.push(255&W.charCodeAt(ne));return G}(m),c,_,H)}function C(c,m,_,H){return T._charsWritten=le(function(W){for(var G,ne,ue=[],pe=0;pe<W.length;pe++)ne=W.charCodeAt(pe),G=ne>>8,ne=ne%256,ue.push(ne),ue.push(G);return ue}(m),c,_,H)}function V(c,m,_){var H="";_=Math.min(c.length,_);for(var W=m;W<_;W++)H+=String.fromCharCode(c[W]);return H}function R(c,m,_,G){G||(D(typeof _=="boolean","missing or invalid endian"),D(m!=null,"missing offset"),D(m+1<c.length,"Trying to read beyond buffer length"));var W,G=c.length;if(!(G<=m))return _?(W=c[m],m+1<G&&(W|=c[m+1]<<8)):(W=c[m]<<8,m+1<G&&(W|=c[m+1])),W}function Q(c,m,_,G){G||(D(typeof _=="boolean","missing or invalid endian"),D(m!=null,"missing offset"),D(m+3<c.length,"Trying to read beyond buffer length"));var W,G=c.length;if(!(G<=m))return _?(m+2<G&&(W=c[m+2]<<16),m+1<G&&(W|=c[m+1]<<8),W|=c[m],m+3<G&&(W+=c[m+3]<<24>>>0)):(m+1<G&&(W=c[m+1]<<16),m+2<G&&(W|=c[m+2]<<8),m+3<G&&(W|=c[m+3]),W+=c[m]<<24>>>0),W}function b(c,m,_,H){if(H||(D(typeof _=="boolean","missing or invalid endian"),D(m!=null,"missing offset"),D(m+1<c.length,"Trying to read beyond buffer length")),!(c.length<=m))return H=R(c,m,_,!0),32768&H?-1*(65535-H+1):H}function p(c,m,_,H){if(H||(D(typeof _=="boolean","missing or invalid endian"),D(m!=null,"missing offset"),D(m+3<c.length,"Trying to read beyond buffer length")),!(c.length<=m))return H=Q(c,m,_,!0),2147483648&H?-1*(4294967295-H+1):H}function d(c,m,_,H){return H||(D(typeof _=="boolean","missing or invalid endian"),D(m+3<c.length,"Trying to read beyond buffer length")),B.read(c,m,_,23,4)}function I(c,m,_,H){return H||(D(typeof _=="boolean","missing or invalid endian"),D(m+7<c.length,"Trying to read beyond buffer length")),B.read(c,m,_,52,8)}function f(c,m,_,H,W){if(W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+1<c.length,"trying to write beyond buffer length"),Ye(m,65535)),W=c.length,!(W<=_))for(var G=0,ne=Math.min(W-_,2);G<ne;G++)c[_+G]=(m&255<<8*(H?G:1-G))>>>8*(H?G:1-G)}function x(c,m,_,H,W){if(W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+3<c.length,"trying to write beyond buffer length"),Ye(m,4294967295)),W=c.length,!(W<=_))for(var G=0,ne=Math.min(W-_,4);G<ne;G++)c[_+G]=m>>>8*(H?G:3-G)&255}function L(c,m,_,H,W){W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+1<c.length,"Trying to write beyond buffer length"),ze(m,32767,-32768)),c.length<=_||f(c,0<=m?m:65535+m+1,_,H,W)}function re(c,m,_,H,W){W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+3<c.length,"Trying to write beyond buffer length"),ze(m,2147483647,-2147483648)),c.length<=_||x(c,0<=m?m:4294967295+m+1,_,H,W)}function oe(c,m,_,H,W){W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+3<c.length,"Trying to write beyond buffer length"),Le(m,34028234663852886e22,-34028234663852886e22)),c.length<=_||B.write(c,m,_,H,23,4)}function ae(c,m,_,H,W){W||(D(m!=null,"missing value"),D(typeof H=="boolean","missing or invalid endian"),D(_!=null,"missing offset"),D(_+7<c.length,"Trying to write beyond buffer length"),Le(m,17976931348623157e292,-17976931348623157e292)),c.length<=_||B.write(c,m,_,H,52,8)}o.Buffer=T,o.SlowBuffer=T,o.INSPECT_MAX_BYTES=50,T.poolSize=8192,T._useTypedArrays=function(){try{var c=new ArrayBuffer(0),m=new Uint8Array(c);return m.foo=function(){return 42},m.foo()===42&&typeof m.subarray=="function"}catch{return!1}}(),T.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},T.isBuffer=function(c){return!(c==null||!c._isBuffer)},T.byteLength=function(c,m){var _;switch(c+="",m||"utf8"){case"hex":_=c.length/2;break;case"utf8":case"utf-8":_=Ie(c).length;break;case"ascii":case"binary":case"raw":_=c.length;break;case"base64":_=Ve(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":_=2*c.length;break;default:throw new Error("Unknown encoding")}return _},T.concat=function(c,m){if(D(fe(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new T(0);if(c.length===1)return c[0];if(typeof m!="number")for(W=m=0;W<c.length;W++)m+=c[W].length;for(var _=new T(m),H=0,W=0;W<c.length;W++){var G=c[W];G.copy(_,H),H+=G.length}return _},T.prototype.write=function(c,m,_,H){isFinite(m)?isFinite(_)||(H=_,_=void 0):(pe=H,H=m,m=_,_=pe),m=Number(m)||0;var W,G,ne,ue,pe=this.length-m;switch((!_||pe<(_=Number(_)))&&(_=pe),H=String(H||"utf8").toLowerCase()){case"hex":W=function(Ae,De,Re,Ce){Re=Number(Re)||0;var he=Ae.length-Re;(!Ce||he<(Ce=Number(Ce)))&&(Ce=he),D((he=De.length)%2==0,"Invalid hex string"),he/2<Ce&&(Ce=he/2);for(var we=0;we<Ce;we++){var Ke=parseInt(De.substr(2*we,2),16);D(!isNaN(Ke),"Invalid hex string"),Ae[Re+we]=Ke}return T._charsWritten=2*we,we}(this,c,m,_);break;case"utf8":case"utf-8":G=this,ne=m,ue=_,W=T._charsWritten=le(Ie(c),G,ne,ue);break;case"ascii":case"binary":W=P(this,c,m,_);break;case"base64":G=this,ne=m,ue=_,W=T._charsWritten=le(Ve(c),G,ne,ue);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":W=C(this,c,m,_);break;default:throw new Error("Unknown encoding")}return W},T.prototype.toString=function(c,m,_){var H,W,G,ne,ue=this;if(c=String(c||"utf8").toLowerCase(),m=Number(m)||0,(_=_!==void 0?Number(_):ue.length)===m)return"";switch(c){case"hex":H=function(pe,Ae,De){var Re=pe.length;(!Ae||Ae<0)&&(Ae=0),(!De||De<0||Re<De)&&(De=Re);for(var Ce="",he=Ae;he<De;he++)Ce+=se(pe[he]);return Ce}(ue,m,_);break;case"utf8":case"utf-8":H=function(pe,Ae,De){var Re="",Ce="";De=Math.min(pe.length,De);for(var he=Ae;he<De;he++)pe[he]<=127?(Re+=Te(Ce)+String.fromCharCode(pe[he]),Ce=""):Ce+="%"+pe[he].toString(16);return Re+Te(Ce)}(ue,m,_);break;case"ascii":case"binary":H=V(ue,m,_);break;case"base64":W=ue,ne=_,H=(G=m)===0&&ne===W.length?O.fromByteArray(W):O.fromByteArray(W.slice(G,ne));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":H=function(pe,Ae,De){for(var Re=pe.slice(Ae,De),Ce="",he=0;he<Re.length;he+=2)Ce+=String.fromCharCode(Re[he]+256*Re[he+1]);return Ce}(ue,m,_);break;default:throw new Error("Unknown encoding")}return H},T.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},T.prototype.copy=function(c,m,_,H){if(m=m||0,(H=H||H===0?H:this.length)!==(_=_||0)&&c.length!==0&&this.length!==0){D(_<=H,"sourceEnd < sourceStart"),D(0<=m&&m<c.length,"targetStart out of bounds"),D(0<=_&&_<this.length,"sourceStart out of bounds"),D(0<=H&&H<=this.length,"sourceEnd out of bounds"),H>this.length&&(H=this.length);var W=(H=c.length-m<H-_?c.length-m+_:H)-_;if(W<100||!T._useTypedArrays)for(var G=0;G<W;G++)c[G+m]=this[G+_];else c._set(this.subarray(_,_+W),m)}},T.prototype.slice=function(c,m){var _=this.length;if(c=me(c,_,0),m=me(m,_,_),T._useTypedArrays)return T._augment(this.subarray(c,m));for(var H=m-c,W=new T(H,void 0,!0),G=0;G<H;G++)W[G]=this[G+c];return W},T.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},T.prototype.set=function(c,m){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,m)},T.prototype.readUInt8=function(c,m){if(m||(D(c!=null,"missing offset"),D(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},T.prototype.readUInt16LE=function(c,m){return R(this,c,!0,m)},T.prototype.readUInt16BE=function(c,m){return R(this,c,!1,m)},T.prototype.readUInt32LE=function(c,m){return Q(this,c,!0,m)},T.prototype.readUInt32BE=function(c,m){return Q(this,c,!1,m)},T.prototype.readInt8=function(c,m){if(m||(D(c!=null,"missing offset"),D(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},T.prototype.readInt16LE=function(c,m){return b(this,c,!0,m)},T.prototype.readInt16BE=function(c,m){return b(this,c,!1,m)},T.prototype.readInt32LE=function(c,m){return p(this,c,!0,m)},T.prototype.readInt32BE=function(c,m){return p(this,c,!1,m)},T.prototype.readFloatLE=function(c,m){return d(this,c,!0,m)},T.prototype.readFloatBE=function(c,m){return d(this,c,!1,m)},T.prototype.readDoubleLE=function(c,m){return I(this,c,!0,m)},T.prototype.readDoubleBE=function(c,m){return I(this,c,!1,m)},T.prototype.writeUInt8=function(c,m,_){_||(D(c!=null,"missing value"),D(m!=null,"missing offset"),D(m<this.length,"trying to write beyond buffer length"),Ye(c,255)),m>=this.length||(this[m]=c)},T.prototype.writeUInt16LE=function(c,m,_){f(this,c,m,!0,_)},T.prototype.writeUInt16BE=function(c,m,_){f(this,c,m,!1,_)},T.prototype.writeUInt32LE=function(c,m,_){x(this,c,m,!0,_)},T.prototype.writeUInt32BE=function(c,m,_){x(this,c,m,!1,_)},T.prototype.writeInt8=function(c,m,_){_||(D(c!=null,"missing value"),D(m!=null,"missing offset"),D(m<this.length,"Trying to write beyond buffer length"),ze(c,127,-128)),m>=this.length||(0<=c?this.writeUInt8(c,m,_):this.writeUInt8(255+c+1,m,_))},T.prototype.writeInt16LE=function(c,m,_){L(this,c,m,!0,_)},T.prototype.writeInt16BE=function(c,m,_){L(this,c,m,!1,_)},T.prototype.writeInt32LE=function(c,m,_){re(this,c,m,!0,_)},T.prototype.writeInt32BE=function(c,m,_){re(this,c,m,!1,_)},T.prototype.writeFloatLE=function(c,m,_){oe(this,c,m,!0,_)},T.prototype.writeFloatBE=function(c,m,_){oe(this,c,m,!1,_)},T.prototype.writeDoubleLE=function(c,m,_){ae(this,c,m,!0,_)},T.prototype.writeDoubleBE=function(c,m,_){ae(this,c,m,!1,_)},T.prototype.fill=function(c,m,_){if(m=m||0,_=_||this.length,D(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),D(m<=_,"end < start"),_!==m&&this.length!==0){D(0<=m&&m<this.length,"start out of bounds"),D(0<=_&&_<=this.length,"end out of bounds");for(var H=m;H<_;H++)this[H]=c}},T.prototype.inspect=function(){for(var c=[],m=this.length,_=0;_<m;_++)if(c[_]=se(this[_]),_===o.INSPECT_MAX_BYTES){c[_+1]="...";break}return"<Buffer "+c.join(" ")+">"},T.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(T._useTypedArrays)return new T(this).buffer;for(var c=new Uint8Array(this.length),m=0,_=c.length;m<_;m+=1)c[m]=this[m];return c.buffer};var Z=T.prototype;function me(c,m,_){return typeof c!="number"?_:m<=(c=~~c)?m:0<=c||0<=(c+=m)?c:0}function be(c){return(c=~~Math.ceil(+c))<0?0:c}function fe(c){return(Array.isArray||function(m){return Object.prototype.toString.call(m)==="[object Array]"})(c)}function se(c){return c<16?"0"+c.toString(16):c.toString(16)}function Ie(c){for(var m=[],_=0;_<c.length;_++){var H=c.charCodeAt(_);if(H<=127)m.push(c.charCodeAt(_));else for(var W=_,G=(55296<=H&&H<=57343&&_++,encodeURIComponent(c.slice(W,_+1)).substr(1).split("%")),ne=0;ne<G.length;ne++)m.push(parseInt(G[ne],16))}return m}function Ve(c){return O.toByteArray(c)}function le(c,m,_,H){for(var W=0;W<H&&!(W+_>=m.length||W>=c.length);W++)m[W+_]=c[W];return W}function Te(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function Ye(c,m){D(typeof c=="number","cannot write a non-number as a number"),D(0<=c,"specified a negative value for writing an unsigned value"),D(c<=m,"value is larger than maximum value for type"),D(Math.floor(c)===c,"value has a fractional component")}function ze(c,m,_){D(typeof c=="number","cannot write a non-number as a number"),D(c<=m,"value larger than maximum allowed value"),D(_<=c,"value smaller than minimum allowed value"),D(Math.floor(c)===c,"value has a fractional component")}function Le(c,m,_){D(typeof c=="number","cannot write a non-number as a number"),D(c<=m,"value larger than maximum allowed value"),D(_<=c,"value smaller than minimum allowed value")}function D(c,m){if(!c)throw new Error(m||"Failed assertion")}T._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=Z.get,c.set=Z.set,c.write=Z.write,c.toString=Z.toString,c.toLocaleString=Z.toString,c.toJSON=Z.toJSON,c.copy=Z.copy,c.slice=Z.slice,c.readUInt8=Z.readUInt8,c.readUInt16LE=Z.readUInt16LE,c.readUInt16BE=Z.readUInt16BE,c.readUInt32LE=Z.readUInt32LE,c.readUInt32BE=Z.readUInt32BE,c.readInt8=Z.readInt8,c.readInt16LE=Z.readInt16LE,c.readInt16BE=Z.readInt16BE,c.readInt32LE=Z.readInt32LE,c.readInt32BE=Z.readInt32BE,c.readFloatLE=Z.readFloatLE,c.readFloatBE=Z.readFloatBE,c.readDoubleLE=Z.readDoubleLE,c.readDoubleBE=Z.readDoubleBE,c.writeUInt8=Z.writeUInt8,c.writeUInt16LE=Z.writeUInt16LE,c.writeUInt16BE=Z.writeUInt16BE,c.writeUInt32LE=Z.writeUInt32LE,c.writeUInt32BE=Z.writeUInt32BE,c.writeInt8=Z.writeInt8,c.writeInt16LE=Z.writeInt16LE,c.writeInt16BE=Z.writeInt16BE,c.writeInt32LE=Z.writeInt32LE,c.writeInt32BE=Z.writeInt32BE,c.writeFloatLE=Z.writeFloatLE,c.writeFloatBE=Z.writeFloatBE,c.writeDoubleLE=Z.writeDoubleLE,c.writeDoubleBE=Z.writeDoubleBE,c.fill=Z.fill,c.inspect=Z.inspect,c.toArrayBuffer=Z.toArrayBuffer,c}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,o){(function(r,l,O,w,g,S,A,k,q){var O=t("buffer").Buffer,B=4,T=new O(B);T.fill(0),n.exports={hash:function(P,C,V,R){for(var Q=C(function(f,x){f.length%B!=0&&(L=f.length+(B-f.length%B),f=O.concat([f,T],L));for(var L,re=[],oe=x?f.readInt32BE:f.readInt32LE,ae=0;ae<f.length;ae+=B)re.push(oe.call(f,ae));return re}(P=O.isBuffer(P)?P:new O(P),R),8*P.length),C=R,b=new O(V),p=C?b.writeInt32BE:b.writeInt32LE,d=0;d<Q.length;d++)p.call(b,Q[d],4*d,!0);return b}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,o){(function(r,l,O,w,g,S,A,k,q){var O=t("buffer").Buffer,B=t("./sha"),T=t("./sha256"),P=t("./rng"),C={sha1:B,sha256:T,md5:t("./md5")},V=64,R=new O(V);function Q(f,x){var L=C[f=f||"sha1"],re=[];return L||b("algorithm:",f,"is not yet supported"),{update:function(oe){return O.isBuffer(oe)||(oe=new O(oe)),re.push(oe),oe.length,this},digest:function(oe){var ae=O.concat(re),ae=x?function(Z,me,be){O.isBuffer(me)||(me=new O(me)),O.isBuffer(be)||(be=new O(be)),me.length>V?me=Z(me):me.length<V&&(me=O.concat([me,R],V));for(var fe=new O(V),se=new O(V),Ie=0;Ie<V;Ie++)fe[Ie]=54^me[Ie],se[Ie]=92^me[Ie];return be=Z(O.concat([fe,be])),Z(O.concat([se,be]))}(L,x,ae):L(ae);return re=null,oe?ae.toString(oe):ae}}}function b(){var f=[].slice.call(arguments).join(" ");throw new Error([f,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}R.fill(0),o.createHash=function(f){return Q(f)},o.createHmac=Q,o.randomBytes=function(f,x){if(!x||!x.call)return new O(P(f));try{x.call(this,void 0,new O(P(f)))}catch(L){x(L)}};var p,d=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],I=function(f){o[f]=function(){b("sorry,",f,"is not implemented yet")}};for(p in d)I(d[p])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){var O=t("./helpers");function B(b,p){b[p>>5]|=128<<p%32,b[14+(p+64>>>9<<4)]=p;for(var d=1732584193,I=-271733879,f=-1732584194,x=271733878,L=0;L<b.length;L+=16){var re=d,oe=I,ae=f,Z=x,d=P(d,I,f,x,b[L+0],7,-680876936),x=P(x,d,I,f,b[L+1],12,-389564586),f=P(f,x,d,I,b[L+2],17,606105819),I=P(I,f,x,d,b[L+3],22,-1044525330);d=P(d,I,f,x,b[L+4],7,-176418897),x=P(x,d,I,f,b[L+5],12,1200080426),f=P(f,x,d,I,b[L+6],17,-1473231341),I=P(I,f,x,d,b[L+7],22,-45705983),d=P(d,I,f,x,b[L+8],7,1770035416),x=P(x,d,I,f,b[L+9],12,-1958414417),f=P(f,x,d,I,b[L+10],17,-42063),I=P(I,f,x,d,b[L+11],22,-1990404162),d=P(d,I,f,x,b[L+12],7,1804603682),x=P(x,d,I,f,b[L+13],12,-40341101),f=P(f,x,d,I,b[L+14],17,-1502002290),d=C(d,I=P(I,f,x,d,b[L+15],22,1236535329),f,x,b[L+1],5,-165796510),x=C(x,d,I,f,b[L+6],9,-1069501632),f=C(f,x,d,I,b[L+11],14,643717713),I=C(I,f,x,d,b[L+0],20,-373897302),d=C(d,I,f,x,b[L+5],5,-701558691),x=C(x,d,I,f,b[L+10],9,38016083),f=C(f,x,d,I,b[L+15],14,-660478335),I=C(I,f,x,d,b[L+4],20,-405537848),d=C(d,I,f,x,b[L+9],5,568446438),x=C(x,d,I,f,b[L+14],9,-1019803690),f=C(f,x,d,I,b[L+3],14,-187363961),I=C(I,f,x,d,b[L+8],20,1163531501),d=C(d,I,f,x,b[L+13],5,-1444681467),x=C(x,d,I,f,b[L+2],9,-51403784),f=C(f,x,d,I,b[L+7],14,1735328473),d=V(d,I=C(I,f,x,d,b[L+12],20,-1926607734),f,x,b[L+5],4,-378558),x=V(x,d,I,f,b[L+8],11,-2022574463),f=V(f,x,d,I,b[L+11],16,1839030562),I=V(I,f,x,d,b[L+14],23,-35309556),d=V(d,I,f,x,b[L+1],4,-1530992060),x=V(x,d,I,f,b[L+4],11,1272893353),f=V(f,x,d,I,b[L+7],16,-155497632),I=V(I,f,x,d,b[L+10],23,-1094730640),d=V(d,I,f,x,b[L+13],4,681279174),x=V(x,d,I,f,b[L+0],11,-358537222),f=V(f,x,d,I,b[L+3],16,-722521979),I=V(I,f,x,d,b[L+6],23,76029189),d=V(d,I,f,x,b[L+9],4,-640364487),x=V(x,d,I,f,b[L+12],11,-421815835),f=V(f,x,d,I,b[L+15],16,530742520),d=R(d,I=V(I,f,x,d,b[L+2],23,-995338651),f,x,b[L+0],6,-198630844),x=R(x,d,I,f,b[L+7],10,1126891415),f=R(f,x,d,I,b[L+14],15,-1416354905),I=R(I,f,x,d,b[L+5],21,-57434055),d=R(d,I,f,x,b[L+12],6,1700485571),x=R(x,d,I,f,b[L+3],10,-1894986606),f=R(f,x,d,I,b[L+10],15,-1051523),I=R(I,f,x,d,b[L+1],21,-2054922799),d=R(d,I,f,x,b[L+8],6,1873313359),x=R(x,d,I,f,b[L+15],10,-30611744),f=R(f,x,d,I,b[L+6],15,-1560198380),I=R(I,f,x,d,b[L+13],21,1309151649),d=R(d,I,f,x,b[L+4],6,-145523070),x=R(x,d,I,f,b[L+11],10,-1120210379),f=R(f,x,d,I,b[L+2],15,718787259),I=R(I,f,x,d,b[L+9],21,-343485551),d=Q(d,re),I=Q(I,oe),f=Q(f,ae),x=Q(x,Z)}return Array(d,I,f,x)}function T(b,p,d,I,f,x){return Q((p=Q(Q(p,b),Q(I,x)))<<f|p>>>32-f,d)}function P(b,p,d,I,f,x,L){return T(p&d|~p&I,b,p,f,x,L)}function C(b,p,d,I,f,x,L){return T(p&I|d&~I,b,p,f,x,L)}function V(b,p,d,I,f,x,L){return T(p^d^I,b,p,f,x,L)}function R(b,p,d,I,f,x,L){return T(d^(p|~I),b,p,f,x,L)}function Q(b,p){var d=(65535&b)+(65535&p);return(b>>16)+(p>>16)+(d>>16)<<16|65535&d}n.exports=function(b){return O.hash(b,B,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){n.exports=function(O){for(var B,T=new Array(O),P=0;P<O;P++)!(3&P)&&(B=4294967296*Math.random()),T[P]=B>>>((3&P)<<3)&255;return T}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){var O=t("./helpers");function B(C,V){C[V>>5]|=128<<24-V%32,C[15+(V+64>>9<<4)]=V;for(var R,Q,b,p=Array(80),d=1732584193,I=-271733879,f=-1732584194,x=271733878,L=-1009589776,re=0;re<C.length;re+=16){for(var oe=d,ae=I,Z=f,me=x,be=L,fe=0;fe<80;fe++){p[fe]=fe<16?C[re+fe]:P(p[fe-3]^p[fe-8]^p[fe-14]^p[fe-16],1);var se=T(T(P(d,5),(se=I,Q=f,b=x,(R=fe)<20?se&Q|~se&b:!(R<40)&&R<60?se&Q|se&b|Q&b:se^Q^b)),T(T(L,p[fe]),(R=fe)<20?1518500249:R<40?1859775393:R<60?-1894007588:-899497514)),L=x,x=f,f=P(I,30),I=d,d=se}d=T(d,oe),I=T(I,ae),f=T(f,Z),x=T(x,me),L=T(L,be)}return Array(d,I,f,x,L)}function T(C,V){var R=(65535&C)+(65535&V);return(C>>16)+(V>>16)+(R>>16)<<16|65535&R}function P(C,V){return C<<V|C>>>32-V}n.exports=function(C){return O.hash(C,B,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){function O(V,R){var Q=(65535&V)+(65535&R);return(V>>16)+(R>>16)+(Q>>16)<<16|65535&Q}function B(V,R){var Q,b=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),p=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),d=new Array(64);V[R>>5]|=128<<24-R%32,V[15+(R+64>>9<<4)]=R;for(var I,f,x=0;x<V.length;x+=16){for(var L=p[0],re=p[1],oe=p[2],ae=p[3],Z=p[4],me=p[5],be=p[6],fe=p[7],se=0;se<64;se++)d[se]=se<16?V[se+x]:O(O(O((f=d[se-2],P(f,17)^P(f,19)^C(f,10)),d[se-7]),(f=d[se-15],P(f,7)^P(f,18)^C(f,3))),d[se-16]),Q=O(O(O(O(fe,P(f=Z,6)^P(f,11)^P(f,25)),Z&me^~Z&be),b[se]),d[se]),I=O(P(I=L,2)^P(I,13)^P(I,22),L&re^L&oe^re&oe),fe=be,be=me,me=Z,Z=O(ae,Q),ae=oe,oe=re,re=L,L=O(Q,I);p[0]=O(L,p[0]),p[1]=O(re,p[1]),p[2]=O(oe,p[2]),p[3]=O(ae,p[3]),p[4]=O(Z,p[4]),p[5]=O(me,p[5]),p[6]=O(be,p[6]),p[7]=O(fe,p[7])}return p}var T=t("./helpers"),P=function(V,R){return V>>>R|V<<32-R},C=function(V,R){return V>>>R};n.exports=function(V){return T.hash(V,B,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){o.read=function(O,B,T,P,x){var V,R,Q=8*x-P-1,b=(1<<Q)-1,p=b>>1,d=-7,I=T?x-1:0,f=T?-1:1,x=O[B+I];for(I+=f,V=x&(1<<-d)-1,x>>=-d,d+=Q;0<d;V=256*V+O[B+I],I+=f,d-=8);for(R=V&(1<<-d)-1,V>>=-d,d+=P;0<d;R=256*R+O[B+I],I+=f,d-=8);if(V===0)V=1-p;else{if(V===b)return R?NaN:1/0*(x?-1:1);R+=Math.pow(2,P),V-=p}return(x?-1:1)*R*Math.pow(2,V-P)},o.write=function(O,B,T,P,C,L){var R,Q,b=8*L-C-1,p=(1<<b)-1,d=p>>1,I=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=P?0:L-1,x=P?1:-1,L=B<0||B===0&&1/B<0?1:0;for(B=Math.abs(B),isNaN(B)||B===1/0?(Q=isNaN(B)?1:0,R=p):(R=Math.floor(Math.log(B)/Math.LN2),B*(P=Math.pow(2,-R))<1&&(R--,P*=2),2<=(B+=1<=R+d?I/P:I*Math.pow(2,1-d))*P&&(R++,P/=2),p<=R+d?(Q=0,R=p):1<=R+d?(Q=(B*P-1)*Math.pow(2,C),R+=d):(Q=B*Math.pow(2,d-1)*Math.pow(2,C),R=0));8<=C;O[T+f]=255&Q,f+=x,Q/=256,C-=8);for(R=R<<C|Q,b+=C;0<b;O[T+f]=255&R,f+=x,R/=256,b-=8);O[T+f-x]|=128*L}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,o){(function(r,l,h,w,g,S,A,k,q){var O,B,T;function P(){}(r=n.exports={}).nextTick=(B=typeof window<"u"&&window.setImmediate,T=typeof window<"u"&&window.postMessage&&window.addEventListener,B?function(C){return window.setImmediate(C)}:T?(O=[],window.addEventListener("message",function(C){var V=C.source;V!==window&&V!==null||C.data!=="process-tick"||(C.stopPropagation(),0<O.length&&O.shift()())},!0),function(C){O.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=P,r.addListener=P,r.once=P,r.off=P,r.removeListener=P,r.removeAllListeners=P,r.emit=P,r.binding=function(C){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Ki);var Zr=Ki.exports;const Rt=qn(Zr);class Jr{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Rt(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Rt(e):String(e)]}getValue(e){return this.cache[this.useHash?Rt(e):String(e)]}isCached(e){return(this.useHash?Rt(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Bt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Yi(i,e){return i.x==e.x&&i.y==e.y}function Xt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function kn(i,e){return(i%e+e)%e}async function Qr(i){i?await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${y.EXTENSIONID}/hasAutohide`],value:void 0}],roles:["GM"]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"}],roles:["GM"]}}],async onClick(e){const t=e.items.every(n=>n.metadata[`${y.EXTENSIONID}/hasAutohide`]===void 0);await F.scene.items.updateItems(e.items,n=>{for(const o of n)t?o.metadata[`${y.EXTENSIONID}/hasAutohide`]=!0:delete o.metadata[`${y.EXTENSIONID}/hasAutohide`]})}}):await F.contextMenu.remove(`${y.EXTENSIONID}/toggle-autohide-menu`)}async function eo(){await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"&&"},{key:["metadata",`${y.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"||"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${y.EXTENSIONID}/hasVision`]===void 0);await F.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${y.EXTENSIONID}/hasVision`]=!0,n.metadata[`${y.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${y.EXTENSIONID}/visionRange`]=y.VISIONDEFAULT)):delete n.metadata[`${y.EXTENSIONID}/hasVision`]})}}),await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${y.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await F.scene.items.getItemAttachments(e);await F.scene.items.updateItems(t,n=>{for(const o of n)e.includes(o.attachedTo)&&(o.metadata[`${y.EXTENSIONID}/hasVision`]&&(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")?delete o.metadata[`${y.EXTENSIONID}/hasVision`]:(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")&&(o.metadata[`${y.EXTENSIONID}/hasVision`]=!0,o.metadata[`${y.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${y.EXTENSIONID}/visionRange`]=y.VISIONDEFAULT)))})}}}),await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${y.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${y.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${y.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${y.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await F.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${y.EXTENSIONID}/isVisionLine`]&&t.metadata[`${y.EXTENSIONID}/disabled`]?delete t.metadata[`${y.EXTENSIONID}/disabled`]:t.metadata[`${y.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${y.EXTENSIONID}/disabled`]=!0)})}}),await F.contextMenu.create({id:`${y.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${y.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${y.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${y.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${y.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${y.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${y.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${y.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await F.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${y.EXTENSIONID}/isVisionLine`]||t.metadata[`${y.ARMINDOID}/isVisionLine`])&&(t.metadata[`${y.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${y.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${y.EXTENSIONID}/oneSided`],delete t.metadata[`${y.ARMINDOID}/oneSided`]):(t.metadata[`${y.EXTENSIONID}/isVisionLine`]||t.metadata[`${y.ARMINDOID}/isVisionLine`])&&(t.metadata[`${y.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${y.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${y.EXTENSIONID}/oneSided`]="right",t.metadata[`${y.ARMINDOID}/oneSided`]="right"):(t.metadata[`${y.EXTENSIONID}/isVisionLine`]||t.metadata[`${y.ARMINDOID}/isVisionLine`])&&(t.metadata[`${y.EXTENSIONID}/oneSided`]="left",t.metadata[`${y.ARMINDOID}/oneSided`]="left")})}}),await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"}]}}],async onClick(i){i.items.length>0&&await F.scene.items.updateItems(i.items,e=>{for(let t=0;t<e.length;t++)e[t].zIndex=1,e[t].layer="FOG",e[t].disableHit=!0,e[t].locked=!1,e[t].visible=!1,e[t].metadata[`${y.EXTENSIONID}/isBackgroundMap`]=!0})}})}async function to(){await F.tool.create({id:`${y.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await F.tool.activateTool(`${y.EXTENSIONID}/vision-tool`)}})}async function no(){await F.tool.createMode({id:`${y.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${y.EXTENSIONID}/vision-tool`]}}],onToolClick:On.onToolClick,onToolMove:On.onToolMove,onKeyDown:On.onKeyDown}),await F.tool.createMode({id:`${y.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${y.EXTENSIONID}/vision-tool`]}}],onToolClick:Nn.onToolClick,onToolMove:Nn.onToolMove,onKeyDown:Nn.onKeyDown})}function io(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function ro(i){let e=[];for(const t of i)for(let n=0;n<t.points.length-1;n++){let o,r;const l=Xe.fromItem(t),h=Xe.fromPosition(t.points[n]),w=Xe.fromPosition(t.points[n+1]);o=Xe.decompose(Xe.multiply(l,h)).position,r=Xe.decompose(Xe.multiply(l,w)).position,e.push({startPosition:o,endPosition:r,originalShape:t,oneSided:t.metadata[`${y.EXTENSIONID}/oneSided`]})}return e}function oo(i,e,t,n,o,r){let l=[],h=[t,n];const w=X.players.filter(P=>P.role=="GM"),g=X.metadata[`${y.EXTENSIONID}/quality`]!="accurate",S=e.some(At);for(const P of e){const C=X.userId===P.createdUserId,V=w.some(p=>p.id==P.createdUserId);if(!C&&X.role!=="GM"&&!V)continue;const R=P.metadata[`${y.EXTENSIONID}/visionRange`],Q=vt.getValue(P.id);if(l.push([]),Q!==void 0&&Yi(Q.player.position,P.position)&&Q.player.metadata[`${y.EXTENSIONID}/visionRange`]===R)continue;let b=1e3*X.gridDpi;R&&(b=X.gridDpi*(R/X.gridScale+.5));for(const p of i){const d=(P.position.x-p.startPosition.x)*(p.endPosition.y-p.startPosition.y)-(P.position.y-p.startPosition.y)*(p.endPosition.x-p.startPosition.x);if(p.oneSided!==void 0&&(p.oneSided=="right"&&d>0||p.oneSided=="left"&&d<0))continue;let I=p.startPosition.x,f=p.startPosition.y,x=p.endPosition.x,L=p.endPosition.y;if(I<o[0]||f<o[1]||I>o[0]+h[0]||f>o[1]+h[1]||x<o[0]||L<o[1]||x>o[0]+h[0]||L>o[1]+h[1])continue;if(g&&(!S||At(P))){const le=[p.startPosition,p.endPosition],Te=Ut.distance(p.startPosition,p.endPosition),ze=Math.floor(Te/(b/3));for(let D=1;D<ze;D++)le.push(Ut.lerp(p.startPosition,p.endPosition,D/ze));let Le=!0;for(const D of le)Ut.compare(P.position,D,b)&&(Le=!1);if(Le)continue}const re={x:p.startPosition.x-P.position.x,y:p.startPosition.y-P.position.y},oe={x:p.endPosition.x-P.position.x,y:p.endPosition.y-P.position.y};var A={x:0,y:0},k={x:0,y:0},q=0,O=0,B=0,T=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
re.x<0?q=o[0]*r[0]:q=(t+o[0])*r[0],re.y<0?O=o[1]*r[1]:O=(n+o[1])*r[1],oe.x<0?B=o[0]*r[0]:B=(t+o[0])*r[0],oe.y<0?T=o[1]*r[1]:T=(n+o[1])*r[1];const ae=[],Z=[];if(re.x!=0){const le=re.y/re.x,Te=p.startPosition.y-le*p.startPosition.x;ae.push({x:q,y:le*q+Te})}if(re.y!=0){const le=re.x/re.y,Te=le*p.startPosition.y-p.startPosition.x;ae.push({x:le*O-Te,y:O})}if(oe.x!=0){const le=oe.y/oe.x,Te=p.endPosition.y-le*p.endPosition.x;Z.push({x:B,y:le*B+Te})}if(oe.y!=0){const le=oe.x/oe.y,Te=le*p.endPosition.y-p.endPosition.x;Z.push({x:le*T-Te,y:T})}ae.length==1||Bt(ae[0],p.startPosition)<Bt(ae[1],p.startPosition)?A=ae[0]:A=ae[1],Z.length==1||Bt(Z[0],p.endPosition)<Bt(Z[1],p.endPosition)?k=Z[0]:k=Z[1];const me=[{x:p.startPosition.x,y:p.startPosition.y},A,k,{x:p.endPosition.x,y:p.endPosition.y}],be=[{x:(t+o[0])*r[0],y:o[1]*r[1]},{x:(t+o[0])*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:o[1]*r[1]}],fe=[0,0];let se=0;for(const le of[A,k])Xt(le.y,o[1]*r[1])?fe[se]=0:Xt(le.y,(n+o[1])*r[1])?fe[se]=2:Xt(le.x,o[0]*r[0])?fe[se]=3:Xt(le.x,(t+o[0])*r[0])&&(fe[se]=1),se++;let Ie=Math.sign(d);Ie=Ie==0?1:-Ie;const Ve=Ie==1?fe[1]:kn(fe[1]-1,4);for(let le=fe[0]+(Ie==1?0:-1);kn(le,4)!=Ve;le+=Ie)me.splice(me.length-2,0,be[kn(le,4)]);l[l.length-1].push({pointset:me,fromShape:p.originalShape})}}return l}var xe,dt=!1;const vt=new Jr(!1);async function ao(i){if(dt=!0,xe||(xe=await Ur({locateFile:()=>Hr})),!await F.scene.isReady()){vt.invalidate((D,c)=>c.shadowPath.delete()),dt=!1;return}const e=[];for(let D=0;D<=6;D++)e.push(new Xn);e[1].start();const{awaitTimer:t,computeTimer:n,metadata:o,visionShapes:r,tokensWithVision:l,invalidateCache:h}=i.detail;let w=i.detail.size,g=i.detail.offset,S=i.detail.scale,[A,k]=w;if(X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]===!0){const D=await F.scene.items.getItems(m=>m.layer==="MAP"&&Ri(m));let c=[];for(let m of D){let _=X.gridDpi/m.grid.dpi,H=m.position.x-_*m.grid.offset.x*m.scale.x,W=m.position.y-_*m.grid.offset.y*m.scale.y,G=H+_*m.image.width*m.scale.x,ne=W+_*m.image.height*m.scale.y;c.length?(H<c[0]&&(c[0]=H),W<c[1]&&(c[1]=W),G>c[2]&&(c[2]=G),ne>c[3]&&(c[3]=ne)):(c[0]=H,c[1]=W,c[2]=G,c[3]=ne)}g=[c[0],c[1]],w=[c[2]-c[0],c[3]-c[1]],S=[1,1],[A,k]=w}let O=0,B=0;if(h&&vt.invalidate((D,c)=>c.shadowPath.delete()),n.resume(),!(o[`${y.EXTENSIONID}/visionEnabled`]===!0)||l.length==0){const D=await F.scene.local.getItems(Bn);await F.scene.local.deleteItems(D.map(c=>c.id)),dt=!1;return}const P=ro(r),C=oo(P,l,A,k,g,S);if(C.length==0){dt=!1;return}const V=[];e[1].pause(),e[2].start();const R={};for(let D=0;D<C.length;D++){const c=l[D];let m=vt.getValue(c.id);if(m!==void 0&&Yi(m.player.position,c.position)&&m.player.metadata[`${y.EXTENSIONID}/visionRange`]===c.metadata[`${y.EXTENSIONID}/visionRange`]){R[D]=m.shadowPath.copy(),O++;continue}B++;const _=C[D],H=new xe.SkOpBuilder,W=xe.NewPath().rect(g[0],g[1],w[0],w[1]);H.add(W,xe.PathOp.UNION),W.delete();for(const ne of _){const ue=ne.fromShape,pe=xe.NewPath();pe.moveTo(ne.pointset[0].x,ne.pointset[0].y);for(let Ae=1;Ae<ne.pointset.length;Ae++)pe.lineTo(ne.pointset[Ae].x,ne.pointset[Ae].y);if(ue.style.closed!=!1){const Ae=xe.NewPath();Ae.moveTo(ue.points[0].x*ue.scale.x+ue.position.x,ue.points[0].y*ue.scale.y+ue.position.y);for(let De=1;De<ue.points.length-1;De++)Ae.lineTo(ue.points[De].x*ue.scale.x+ue.position.x,ue.points[De].y*ue.scale.y+ue.position.y);pe.op(Ae,xe.PathOp.DIFFERENCE),Ae.delete()}H.add(pe,xe.PathOp.DIFFERENCE),pe.delete()}const G=H.resolve();if(!G){console.error("Couldn't compute fog"),dt=!1;return}if(H.delete(),G!==void 0){G.simplify(),R[D]=G;let ne=vt.getValue(c.id);ne!==void 0&&ne.shadowPath.delete(),vt.cacheValue(c.id,{shadowPath:G.copy(),player:c})}}e[2].pause(),e[3].start();const Q=[],b=xe.NewPath();for(let D=0;D<l.length;D++){const c=l[D],m=c.metadata[`${y.EXTENSIONID}/visionRange`],_=X.players.filter(G=>G.role=="GM"),H=X.userId===l[D].createdUserId,W=_.some(G=>G.id==l[D].createdUserId);if(At(c)?Q[D]=!0:b.op(R[D],xe.PathOp.UNION),m){if(!H&&X.role!=="GM"&&!W)continue;const G=X.gridDpi*(m/X.gridScale+.5),ne=xe.NewPath().ellipse(c.position.x,c.position.y,G,G,0,0,2*Math.PI);R[D]?.op(ne,xe.PathOp.INTERSECT),ne.delete();const ue=X.players.find(pe=>pe.id===c.createdUserId);if(ue&&X.role==="GM"&&!At(c)){const pe=It().strokeColor(ue.color).fillOpacity(0).position({x:c.position.x,y:c.position.y}).width(G*2).height(G*2).shapeType("CIRCLE").metadata({[`${y.EXTENSIONID}/isIndicatorRing`]:!0}).build();V.push(pe)}}}b.simplify();for(let D=0;D<Q.length;D++)Q[D]===!0&&(R[D].op(b,xe.PathOp.INTERSECT),R[D].simplify());b.delete(),e[3].pause(),e[4].start();const p=[],d=[],I=X.metadata[`${y.EXTENSIONID}/persistenceEnabled`]===!0,f=X.metadata[`${y.EXTENSIONID}/fowEnabled`]===!0,x=xe.NewPath(),L={},re=await F.scene.local.getItems(Bn),oe=await F.scene.local.getItems(Mr);f&&x.rect(g[0],g[1],w[0],w[1]);let ae=I&&X.metadata[`${y.EXTENSIONID}/quality`]!="accurate",Z=[],me;if(ae)if(Z=await F.scene.local.getItems(mt),me=new xe.SkOpBuilder,L.reuse=!0,Z.length===0){const D=Ot().commands([]).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${y.EXTENSIONID}/isVisionFog`]:!0,[`${y.EXTENSIONID}/digest`]:"reuse"}).build();D.zIndex=3,await F.scene.local.addItems([D]),Z=await F.scene.local.getItems(mt)}else{let D=xe.FromCmds(Z[0].commands);me.add(D,xe.PathOp.UNION),D.delete()}const be=new xe.SkOpBuilder;let fe=!1;for(const D of Object.keys(R)){const c=R[D],_=new TextEncoder().encode(c.toCmds().toString()),H=await crypto.subtle.digest("SHA-1",_).then(G=>[...new Uint8Array(G)].map(ne=>ne.toString(16).padStart(2,"0")).join(""));re.filter(G=>mt(G)&&G.metadata[`${y.EXTENSIONID}/digest`]===H).length===0?ae?me.add(c,xe.PathOp.UNION):p.push({cmds:c.toCmds(),visible:!1,zIndex:3,playerId:l[D].id,digest:H}):L[H]=!0,f&&(x.op(c,xe.PathOp.DIFFERENCE),X.role==="GM"&&(fe=!0,be.add(c,xe.PathOp.UNION))),c.delete()}const se=X.metadata[`${y.EXTENSIONID}/sceneId`];if(ae){const D=me.resolve();D.setFillType(xe.FillType.EVENODD);const c=D.toCmds();await F.scene.local.updateItems([Z[0].id],m=>{m[0].commands=c});try{localStorage.setItem(`${y.EXTENSIONID}/fogCache/${X.userId}/${se}`,JSON.stringify([{digest:"reuse",commands:c}]))}catch{}D.delete(),me.delete()}else if(I){const D=re.filter(mt);try{localStorage.setItem(`${y.EXTENSIONID}/fogCache/${X.userId}/${se}`,JSON.stringify(D.map(c=>({digest:c.metadata[`${y.EXTENSIONID}/digest`],commands:c.commands}))))}catch{}}let Ie;fe&&(Ie=be.resolve()),be.delete();const Ve=re.filter(Ht),le=re.filter(D=>{const c=D.metadata[`${y.EXTENSIONID}/digest`];return mt(D)&&L[c]===void 0});if(f){let D=X.metadata[`${y.EXTENSIONID}/fowColor`]?X.metadata[`${y.EXTENSIONID}/fowColor`]:"#00000088",c=.5;D.length==9&&(c=Number.parseInt(D.substring(7),16)/255,D=D.substring(0,7));const m=Ot().commands(x.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(D).fillOpacity(c).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${y.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();m.disableHit=!0,Ve.length>0?F.scene.local.updateItems(Ht,_=>{for(const H of _)H.commands=m.commands},!1):d.push(F.scene.local.addItems([m]))}else d.push(F.scene.local.deleteItems(re.filter(Ht).map(D=>D.id)));x.delete(),e[4].pause(),e[5].start(),n.pause(),t.resume(),d.push(F.scene.local.deleteItems(oe.map(D=>D.id))),d.push(F.scene.local.addItems(p.map(D=>{const c=Ot().commands(D.cmds).locked(!0).visible(D.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${y.EXTENSIONID}/isVisionFog`]:!0,[`${y.EXTENSIONID}/digest`]:D.digest}).build();return c.zIndex=D.zIndex,c}))),I||d.push(F.scene.local.deleteItems(le.map(D=>D.id))),V.length>0&&d.push(F.scene.local.addItems(V)),X.fog.filled||d.push(F.scene.fog.setFilled(!0)),await Promise.all(d);let Te=0;e[5].pause(),e[6].start(),fe&&(so(Ie),Ie.delete()),e[6].pause();const[Ye,ze]=[t.stop(),n.stop()],Le={compute_time:`${ze} ms`,communication_time:`${Ye} ms`,cache_hits:O.toString(),cache_misses:B.toString(),item_counter:Te.toString()};for(let D=1;D<=6;D++){const c=e[D].stop();Le["stage"+D]=`${c} ms`}io(Le),dt=!1}document.addEventListener("updateVision",ao);async function so(i){const e=[],t=X.items.filter(n=>Vi(n)&&Ri(n));i.simplify();for(const n of t){const o=new xe.SkOpBuilder,r=xe.NewPath(),l=X.gridDpi/n.grid.dpi*(n.image.width/2)*n.scale.x;for(let g=0;g<6;g++){const S=g*60*Math.PI/180,A=n.position.x+l*Math.cos(S),k=n.position.y+l*Math.sin(S);g==0?r.moveTo(A,k):r.lineTo(A,k)}r.closePath(),o.add(r,xe.PathOp.UNION),o.add(i,xe.PathOp.INTERSECT);const h=o.resolve(),w=!h.toCmds().length;n.visible==w&&e.push(n),r.delete(),o.delete(),h.delete()}await F.scene.items.updateItems(e.map(n=>n.id),n=>{for(let o=0;o<n.length;o++)n[o].visible=!n[o].visible})}let xn,lo,mi,St=[],vi,An,yi,Ii,wi,bi;async function gt(i){if(dt||!await F.scene.isReady())return;document.querySelector("#debug_div");const[e,t]=[new Xn,new Xn];e.start(),e.pause(),t.start();const n=X.players.filter(d=>d.role=="GM"),o=X.items.filter(d=>(d.layer=="CHARACTER"||d.layer=="ATTACHMENT")&&n.some(I=>d.createdUserId===I.id)&&(d.metadata[`${y.EXTENSIONID}/hasVision`]||d.metadata[`${y.ARMINDOID}/hasVision`])&&!d.metadata[`${y.EXTENSIONID}/visionBlind`]),l=(X.role=="GM"?X.items.filter(Rr):X.items.filter(Br).concat(o)).filter(d=>!At(d)||d.visible===!0),h=X.items.filter(Fr),w=X.items.filter(Vi),g=X.items.filter(Xi)?.[0],S=X.metadata[`${y.EXTENSIONID}/visionEnabled`]===!0,A=X.metadata[`${y.EXTENSIONID}/persistenceEnabled`]===!0,k=X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]===!0,q=X.metadata[`${y.EXTENSIONID}/fowEnabled`]===!0,O=X.metadata[`${y.EXTENSIONID}/fowColor`],B=[],T=[],P=[];if(g===void 0?(B[0]=0,B[1]=0,T[0]=1,T[1]=1,P[0]=0,P[1]=0):(B[0]=g.width*g.scale.x,B[1]=g.height*g.scale.y,T[0]=g.scale.x,T[1]=g.scale.y,P[0]=g.position.x,P[1]=g.position.y),X.role=="GM"){const d=document.getElementById("mapHeight"),I=document.getElementById("mapWidth");I.value=(Math.round(B[0])/X.gridDpi).toString(),d.value=(Math.round(B[1])/X.gridDpi).toString()}const C=JSON.stringify(h),V=JSON.stringify(w),R=JSON.stringify(l),Q=JSON.stringify(g);if(Q==An&&S==vi&&bi==O&&yi==k&&Ii==q&&wi==A&&xn==C&&lo==V&&mi==R&&B[0]==St[0]&&B[1]==St[1]&&i!==!0)return;let b=!1;(Q!=An||xn!=C||B[0]!=St[0]||B[1]!=St[1])&&(b=!0),An=Q,mi=R,xn=C,St=B,vi=S,yi=k,Ii=q,bi=O,wi=A,t.pause();const p=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:X.items,metadata:X.metadata,size:B,offset:P,scale:T,tokensWithVision:l,visionShapes:h,invalidateCache:b}});dt||document.dispatchEvent(p)}async function co(){await F.contextMenu.create({id:`${y.EXTENSIONID}/toggle-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${y.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${y.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${y.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${y.EXTENSIONID}/isDoor`]===void 0);await F.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${y.EXTENSIONID}/isDoor`]=!0:delete n.metadata[`${y.EXTENSIONID}/isDoor`]}),e?await rn(i.items):await uo(i.items)}})}async function uo(i){const e=await F.scene.local.getItems(n=>n.metadata[`${y.EXTENSIONID}/doorId`]!==void 0),t=[];for(let n of e){let o=!1;for(const r of i)n.metadata[`${y.EXTENSIONID}/doorId`]==r.id&&(o=!0);o&&t.push(n.id)}await F.scene.local.deleteItems(t)}async function rn(i){const e=[],t=await F.scene.local.getItems(n=>n.metadata[`${y.EXTENSIONID}/doorId`]!==void 0);for(const n of i){if(!Dr(n)||t.some(l=>l.metadata[`${y.EXTENSIONID}/doorId`]===n.id))continue;const o=Xe.fromItem(n),r=[];for(let l=0;l<n.points.length;l++){const h=Xe.fromPosition(n.points[l]);r.push(Xe.decompose(Xe.multiply(o,h)).position)}e.push(Ot().locked(!0).commands(Zi(n.metadata[`${y.EXTENSIONID}/disabled`]===!0)).scale({x:.2,y:.2}).name("Door").position(Ut.centroid(r)).metadata({[`${y.EXTENSIONID}/doorId`]:n.id}).build())}F.scene.local.addItems(e)}async function fo(i){const e=await F.scene.local.getItems(t=>t.id===i&&t.metadata[`${y.EXTENSIONID}/doorId`]!==void 0);if(e.length===1){const t=e[0].metadata[`${y.EXTENSIONID}/doorId`],n=X.items.filter(r=>r.id===t);let o=!1;await F.scene.items.updateItems(n,r=>{const l=r[0];l.metadata[`${y.EXTENSIONID}/isVisionLine`]&&l.metadata[`${y.EXTENSIONID}/disabled`]?(delete l.metadata[`${y.EXTENSIONID}/disabled`],o=!1):l.metadata[`${y.EXTENSIONID}/isVisionLine`]&&(l.metadata[`${y.EXTENSIONID}/disabled`]=!0,o=!0)}),await F.scene.local.updateItems([e[0].id],r=>{const l=r[0];Ar(l)&&(l.commands=Zi(o))}),await F.player.deselect([i])}}async function po(){const i=await F.scene.items.getItems(e=>e.metadata[`${y.EXTENSIONID}/isDoor`]===!0);rn(i)}function Zi(i){return i?[[0,-65.35400390625,-250],[1,-65.35400390625,-228.27999877929688],[1,-150.29598999023438,-228.27999877929688],[1,-150.29598999023438,205.0780029296875],[1,-118.89300537109375,205.0780029296875],[1,-118.89300537109375,-196.8769989013672],[1,-65.35400390625,-196.8769989013672],[1,-65.35400390625,242.5],[1,142.79598999023438,205.0780029296875],[1,142.79598999023438,143.84298706054688],[1,142.79598999023438,-212.5],[5],[0,-27.06201171875,13.128997802734375],[4,-34.05900573730469,13.128997802734375,-39.73200988769531,5.7480010986328125,-39.73200988769531,-3.35699462890625],[4,-39.73200988769531,-12.46099853515625,-34.05900573730469,-19.841995239257812,-27.06201171875,-19.841995239257812],[4,-20.065017700195312,-19.841995239257812,-14.392013549804688,-12.46099853515625,-14.392013549804688,-3.35699462890625],[4,-14.392013549804688,5.7480010986328125,-20.065017700195312,13.128997802734375,-27.06201171875,13.128997802734375],[5]]:[[0,-178.44699096679688,-250],[1,-178.44699096679688,228.08499145507812],[1,157.114013671875,228.66598510742188],[1,157.114013671875,-250],[5],[0,-146.8909912109375,196.5830078125],[1,-146.8909912109375,-218.44200134277344],[1,125.55398559570312,-218.44200134277344],[1,125.55398559570312,-161.62899780273438],[1,114.77301025390625,-161.62899780273438],[1,114.77301025390625,-207.91400146484375],[1,-136.10699462890625,-207.91400146484375],[1,-136.10699462890625,186.55398559570312],[1,114.77398681640625,186.55398559570312],[1,114.77398681640625,140.26998901367188],[1,125.55499267578125,140.26998901367188],[1,125.55499267578125,197.05499267578125],[5],[0,114.77301025390625,-112.54100036621094],[1,125.55401611328125,-112.54100036621094],[1,125.55401611328125,91.17999267578125],[1,114.77301025390625,91.17999267578125],[5],[0,-84.21299743652344,-10.67999267578125],[4,-84.21299743652344,-1.5319976806640625,-91.63099670410156,5.8860015869140625,-100.781005859375,5.8860015869140625],[4,-109.93099975585938,5.8860015869140625,-117.3489990234375,-1.5319976806640625,-117.3489990234375,-10.67999267578125],[4,-117.3489990234375,-19.829986572265625,-109.93099975585938,-27.24798583984375,-100.781005859375,-27.24798583984375],[4,-91.63101196289062,-27.24798583984375,-84.2130126953125,-19.829986572265625,-84.2130126953125,-10.67999267578125],[5]]}function Cn(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class ho{constructor(){this._events=void 0,this._events={}}on(e,t){Cn(e,n=>{const o=this._events[n]||[];o.push(t),this._events[n]=o})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}Cn(e,o=>{if(n===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var n=this;Cn(e,o=>{const r=n._events[o];r!==void 0&&r.forEach(l=>{l.apply(n,t)})})}}function go(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const o=this,r=[];if(Array.isArray(e))e.forEach(l=>{typeof l=="string"?r.push(l):(o.plugins.settings[l.name]=l.options,r.push(l.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;n=r.shift();)o.require(n)}loadPlugin(e){var t=this,n=t.plugins,o=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const cn=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":vo(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Ji=i=>{if(!mo(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((o,r)=>{if(o===i[r-1]){t++;return}n(),e+=o,t=1}),n(),e},Qi=i=>{let e=zn(i);return cn(e)},mo=i=>new Set(i).size!==i.length,Ct=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),vo=i=>i.reduce((e,t)=>Math.max(e,yo(t)),0),yo=i=>zn(i).length,zn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const er=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return er(t).forEach(function(o){let r=o.slice(0);r[0]=i.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(i.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Io=[[0,65535]],wo="[̀-ͯ·ʾʼ]";let on,tr;const bo=3,Kn={},Ei={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in Ei){let e=Ei[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Kn[n]=i}}const Eo=new RegExp(Object.keys(Kn).join("|")+"|"+wo,"gu"),_o=i=>{on===void 0&&(on=No(i||Io))},_i=(i,e="NFKD")=>i.normalize(e),an=i=>zn(i).reduce((e,t)=>e+So(t),""),So=i=>(i=_i(i).toLowerCase().replace(Eo,e=>Kn[e]||""),_i(i,"NFC"));function*To(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let o=String.fromCharCode(n),r=an(o);r!=o.toLowerCase()&&(r.length>bo||r.length!=0&&(yield{folded:r,composed:o,code_point:n}))}}const Oo=i=>{const e={},t=(n,o)=>{const r=e[n]||new Set,l=new RegExp("^"+Qi(r)+"$","iu");o.match(l)||(r.add(Ct(o)),e[n]=r)};for(let n of To(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},No=i=>{const e=Oo(i),t={};let n=[];for(let r in e){let l=e[r];l&&(t[r]=Qi(l)),r.length>1&&n.push(Ct(r))}n.sort((r,l)=>l.length-r.length);const o=cn(n);return tr=new RegExp("^"+o,"u"),t},ko=(i,e=1)=>{let t=0;return i=i.map(n=>(on[n]&&(t+=n.length),on[n]||n)),t>=e?Ji(i):""},xo=(i,e=1)=>(e=Math.max(e,i.length-1),cn(er(i).map(t=>ko(t,e)))),Si=(i,e=!0)=>{let t=i.length>1?1:0;return cn(i.map(n=>{let o=[];const r=e?n.length():n.length()-1;for(let l=0;l<r;l++)o.push(xo(n.substrs[l]||"",t));return Ji(o)}))},Ao=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const o=l=>{for(const h of n){if(h.start===l.start&&h.substr===l.substr)return!1;if(!(l.length==1||h.length==1)&&(l.start<h.start&&l.end>h.start||h.start<l.start&&h.end>l.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class sn{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new sn,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const w of o)n.add(w);let l=t.substr.substring(0,e-r.start),h=l.length;return n.add({start:r.start,end:r.start+h,length:h,substr:l}),n}}const Co=i=>{_o(),i=an(i);let e="",t=[new sn];for(let n=0;n<i.length;n++){let r=i.substring(n).match(tr);const l=i.substring(n,n+1),h=r?r[0]:null;let w=[],g=new Set;for(const S of t){const A=S.last();if(!A||A.length==1||A.end<=n)if(h){const k=h.length;S.add({start:n,end:n+k,length:k,substr:h}),g.add("1")}else S.add({start:n,end:n+1,length:1,substr:l}),g.add("2");else if(h){let k=S.clone(n,A);const q=h.length;k.add({start:n,end:n+q,length:q,substr:h}),w.push(k)}else g.add("3")}if(w.length>0){w=w.sort((S,A)=>S.length()-A.length());for(let S of w)Ao(S,t)||t.push(S);continue}if(n>0&&g.size==1&&!g.has("3")){e+=Si(t,!1);let S=new sn;const A=t[0];A&&S.add(A.last()),t=[S]}}return e+=Si(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Do=(i,e)=>{if(i)return i[e]},Po=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},Dn=(i,e,t)=>{var n,o;return!i||(i=i+"",e.regex==null)||(o=i.search(e.regex),o===-1)?0:(n=e.string.length/i.length,o===0&&(n+=.5),n*t)},Pn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},Ge=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},$o=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=an(i+"").toLowerCase(),e=an(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Lo{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var l;return n&&(l=new RegExp("^("+Object.keys(n).map(Ct).join("|")+"):(.*)$")),r.forEach(h=>{let w,g=null,S=null;l&&(w=h.match(l))&&(g=w[1],h=w[2]),h.length>0&&(this.settings.diacritics?S=Co(h)||null:S=Ct(h),S&&t&&(S="\\b"+S)),o.push({string:h,regex:S?new RegExp(S,"iu"):null,field:g})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const o=e.options.fields,r=e.weights,l=o.length,h=e.getAttrFn;if(!l)return function(){return 1};const w=function(){return l===1?function(g,S){const A=o[0].field;return Dn(h(S,A),g,r[A]||1)}:function(g,S){var A=0;if(g.field){const k=h(S,g.field);!g.regex&&k?A+=1/l:A+=Dn(k,g,1)}else Ge(r,(k,q)=>{A+=Dn(h(S,q),g,k)});return A/l}}();return n===1?function(g){return w(t[0],g)}:e.options.conjunction==="and"?function(g){var S,A=0;for(let k of t){if(S=w(k,g),S<=0)return 0;A+=S}return A/n}:function(g){var S=0;return Ge(t,A=>{S+=w(A,g)}),S/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const o=this,r=e.options,l=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof l=="function")return l.bind(this);const h=function(S,A){return S==="$score"?A.score:e.getAttrFn(o.items[A.id],S)};if(l)for(let g of l)(e.query||g.field!=="$score")&&n.push(g);if(e.query){t=!0;for(let g of n)if(g.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(g=>g.field!=="$score");return n.length?function(g,S){var A,k;for(let q of n)if(k=q.field,A=(q.direction==="desc"?-1:1)*$o(h(k,g),h(k,S)),A)return A;return 0}:null}prepareSearch(e,t){const n={};var o=Object.assign({},t);if(Pn(o,"sort"),Pn(o,"sort_empty"),o.fields){Pn(o,"fields");const r=[];o.fields.forEach(l=>{typeof l=="string"&&(l={field:l,weight:1}),r.push(l),n[l.field]="weight"in l?l.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:o.nesting?Po:Do}}search(e,t){var n=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const l=t.score||n._getScoreFunction(r);e.length?Ge(n.items,(w,g)=>{o=l(w),(t.filter===!1||o>0)&&r.items.push({score:o,id:g})}):Ge(n.items,(w,g)=>{r.items.push({score:1,id:g})});const h=n._getSortFunction(r);return h&&r.items.sort(h),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const yt=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Be=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(nr(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},nr=i=>typeof i=="string"&&i.indexOf("<")>-1,Mo=i=>i.replace(/['"\\]/g,"\\$&"),$n=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Vt=(i,e)=>{Object.assign(i.style,e)},We=(i,...e)=>{var t=ir(e);i=rr(i),i.map(n=>{t.map(o=>{n.classList.add(o)})})},st=(i,...e)=>{var t=ir(e);i=rr(i),i.map(n=>{t.map(o=>{n.classList.remove(o)})})},ir=i=>{var e=[];return yt(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},rr=i=>(Array.isArray(i)||(i=[i]),i),Wt=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},Ti=(i,e=0)=>e>0?i[i.length-1]:i[0],Fo=i=>Object.keys(i).length===0,ln=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},Pe=(i,e)=>{yt(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},Vn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Ro=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var l=r.data.match(e);if(l&&r.data.length>0){var h=document.createElement("span");h.className="highlight";var w=r.splitText(l.index);w.splitText(l[0].length);var g=w.cloneNode(!0);return h.appendChild(g),Vn(w,h),1}return 0},n=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(l=>{o(l)})},o=r=>r.nodeType===3?t(r):(n(r),0);o(i)},Bo=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Xo=65,Vo=13,or=27,jn=37,jo=38,ar=39,Uo=40,Oi=8,Ho=46,Un=9,Wo=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),jt=Wo?"metaKey":"ctrlKey";var Ni={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Je=i=>typeof i>"u"||i===null?null:Gt(i),Gt=i=>typeof i=="boolean"?i?"1":"0":i+"",qt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Go=(i,e)=>{var t;return function(n,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[n]=!0,i.call(r,n,o)},e)}},ki=(i,e,t)=>{var n,o=i.trigger,r={};i.trigger=function(){var l=arguments[0];if(e.indexOf(l)!==-1)r[l]=arguments;else return o.apply(i,arguments)},t.apply(i,[]),i.trigger=o;for(n of e)n in r&&o.apply(i,r[n])},qo=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),Oe=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},$e=(i,e,t,n)=>{i.addEventListener(e,t,n)},pt=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Ln=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},xi=i=>i.replace(/[\\"']/g,"\\$&"),ht=(i,e)=>{e&&i.append(e)};function Ai(i,e){var t=Object.assign({},Ni,e),n=t.dataAttr,o=t.labelField,r=t.valueField,l=t.disabledField,h=t.optgroupField,w=t.optgroupLabelField,g=t.optgroupValueField,S=i.tagName.toLowerCase(),A=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!A&&!t.allowEmptyOption){let B=i.querySelector('option[value=""]');B&&(A=B.textContent)}var k={placeholder:A,options:[],optgroups:[],items:[],maxItems:null},q=()=>{var B,T=k.options,P={},C=1,V=b=>{var p=Object.assign({},b.dataset),d=n&&p[n];return typeof d=="string"&&d.length&&(p=Object.assign(p,JSON.parse(d))),p},R=(b,p)=>{var d=Je(b.value);if(d!=null&&!(!d&&!t.allowEmptyOption)){if(P.hasOwnProperty(d)){if(p){var I=P[d][h];I?Array.isArray(I)?I.push(p):P[d][h]=[I,p]:P[d][h]=p}}else{var f=V(b);f[o]=f[o]||b.textContent,f[r]=f[r]||d,f[l]=f[l]||b.disabled,f[h]=f[h]||p,f.$option=b,P[d]=f,T.push(f)}b.selected&&k.items.push(d)}},Q=b=>{var p,d;d=V(b),d[w]=d[w]||b.getAttribute("label")||"",d[g]=d[g]||C++,d[l]=d[l]||b.disabled,k.optgroups.push(d),p=d[g],yt(b.children,I=>{R(I,p)})};k.maxItems=i.hasAttribute("multiple")?null:1,yt(i.children,b=>{B=b.tagName.toLowerCase(),B==="optgroup"?Q(b):B==="option"&&R(b)})},O=()=>{const B=i.getAttribute(n);if(B)k.options=JSON.parse(B),yt(k.options,P=>{k.items.push(P[r])});else{var T=i.value.trim()||"";if(!t.allowEmptyOption&&!T.length)return;const P=T.split(t.delimiter);yt(P,C=>{const V={};V[o]=C,V[r]=C,k.options.push(V)}),k.items=P}};return S==="select"?q():O(),Object.assign({},Ni,k,e)}var Ci=0;class qe extends go(ho){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],Ci++;var n,o=Be(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);n=r.getPropertyValue("direction");const l=Ai(o,t);this.settings=l,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=Ln(o,"tomselect-"+Ci),this.isRequired=o.required,this.sifter=new Lo(this.options,{diacritics:l.diacritics}),l.mode=l.mode||(l.maxItems===1?"single":"multi"),typeof l.hideSelected!="boolean"&&(l.hideSelected=l.mode==="multi"),typeof l.hidePlaceholder!="boolean"&&(l.hidePlaceholder=l.mode!=="multi");var h=l.createFilter;typeof h!="function"&&(typeof h=="string"&&(h=new RegExp(h)),h instanceof RegExp?l.createFilter=T=>h.test(T):l.createFilter=T=>this.settings.duplicates||!this.options[T]),this.initializePlugins(l.plugins),this.setupCallbacks(),this.setupTemplates();const w=Be("<div>"),g=Be("<div>"),S=this._render("dropdown"),A=Be('<div role="listbox" tabindex="-1">'),k=this.input.getAttribute("class")||"",q=l.mode;var O;if(We(w,l.wrapperClass,k,q),We(g,l.controlClass),ht(w,g),We(S,l.dropdownClass,q),l.copyClassesToDropdown&&We(S,k),We(A,l.dropdownContentClass),ht(S,A),Be(l.dropdownParent||w).appendChild(S),nr(l.controlInput)){O=Be(l.controlInput);var B=["autocorrect","autocapitalize","autocomplete"];Ge(B,T=>{o.getAttribute(T)&&Pe(O,{[T]:o.getAttribute(T)})}),O.tabIndex=-1,g.appendChild(O),this.focus_node=O}else l.controlInput?(O=Be(l.controlInput),this.focus_node=O):(O=Be("<input/>"),this.focus_node=g);this.wrapper=w,this.dropdown=S,this.dropdown_content=A,this.control=g,this.control_input=O,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,o=e.dropdown,r=e.dropdown_content,l=e.wrapper,h=e.control,w=e.input,g=e.focus_node,S={passive:!0},A=e.inputId+"-ts-dropdown";Pe(r,{id:A}),Pe(g,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":A});const k=Ln(g,e.inputId+"-ts-control"),q="label[for='"+Mo(e.inputId)+"']",O=document.querySelector(q),B=e.focus.bind(e);if(O){$e(O,"click",B),Pe(O,{for:k});const C=Ln(O,e.inputId+"-ts-label");Pe(g,{"aria-labelledby":C}),Pe(r,{"aria-labelledby":C})}if(l.style.width=w.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");We([l,o],C)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&Pe(w,{multiple:"multiple"}),t.placeholder&&Pe(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Ct(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Go(t.load,t.loadThrottle)),e.control_input.type=w.type,$e(o,"mousemove",()=>{e.ignoreHover=!1}),$e(o,"mouseenter",C=>{var V=Wt(C.target,"[data-selectable]",o);V&&e.onOptionHover(C,V)},{capture:!0}),$e(o,"click",C=>{const V=Wt(C.target,"[data-selectable]");V&&(e.onOptionSelect(C,V),Oe(C,!0))}),$e(h,"click",C=>{var V=Wt(C.target,"[data-ts-item]",h);if(V&&e.onItemSelect(C,V)){Oe(C,!0);return}n.value==""&&(e.onClick(),Oe(C,!0))}),$e(g,"keydown",C=>e.onKeyDown(C)),$e(n,"keypress",C=>e.onKeyPress(C)),$e(n,"input",C=>e.onInput(C)),$e(g,"blur",C=>e.onBlur(C)),$e(g,"focus",C=>e.onFocus(C)),$e(n,"paste",C=>e.onPaste(C));const T=C=>{const V=C.composedPath()[0];if(!l.contains(V)&&!o.contains(V)){e.isFocused&&e.blur(),e.inputState();return}V==n&&e.isOpen?C.stopPropagation():Oe(C,!0)},P=()=>{e.isOpen&&e.positionDropdown()};$e(document,"mousedown",T),$e(window,"scroll",P,S),$e(window,"resize",P,S),this._destroy=()=>{document.removeEventListener("mousedown",T),window.removeEventListener("scroll",P),window.removeEventListener("resize",P),O&&O.removeEventListener("click",B)},this.revertSettings={innerHTML:w.innerHTML,tabIndex:w.tabIndex},w.tabIndex=-1,w.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,$e(w,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,w.disabled?e.disable():e.enable(),e.on("change",this.onChange),We(w,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Ge(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,o={optgroup:r=>{let l=document.createElement("div");return l.className="optgroup",l.appendChild(r.options),l},optgroup_header:(r,l)=>'<div class="optgroup-header">'+l(r[n])+"</div>",option:(r,l)=>"<div>"+l(r[t])+"</div>",item:(r,l)=>"<div>"+l(r[t])+"</div>",option_create:(r,l)=>'<div class="create">Add <strong>'+l(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Ai(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){$n(this.input,"input"),$n(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Oe(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var o=n.trim().split(t.settings.splitOn);Ge(o,r=>{Je(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Oe(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),Oe(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Un&&Oe(e);return}switch(e.keyCode){case Xo:if(pt(jt,e)&&t.control_input.value==""){Oe(e),t.selectAll();return}break;case or:t.isOpen&&(Oe(e,!0),t.close()),t.clearActiveItems();return;case Uo:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}Oe(e);return;case jo:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}Oe(e);return;case Vo:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Oe(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Oe(e);return;case jn:t.advanceSelection(-1,e);return;case ar:t.advanceSelection(1,e);return;case Un:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Oe(e)),t.settings.create&&t.createItem()&&Oe(e));return;case Oi:case Ho:t.deleteSelection(e);return}t.isInputHidden&&!pt(jt,e)&&Oe(e)}onInput(e){var t=this;if(!t.isLocked){var n=t.inputValue();t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled){t.blur(),Oe(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(n=t.dataset.value,typeof n<"u"&&(o.lastQuery=null,o.addItem(n),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(Oe(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;We(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||st(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,$n(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];ki(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,o,r,l,h,w,g;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.showInput();return}if(o=t&&t.type.toLowerCase(),o==="click"&&pt("shiftKey",t)&&n.activeItems.length){for(g=n.getLastActive(),l=Array.prototype.indexOf.call(n.control.children,g),h=Array.prototype.indexOf.call(n.control.children,e),l>h&&(w=l,l=h,h=w),r=l;r<=h;r++)e=n.control.children[r],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);Oe(t)}else o==="click"&&pt(jt,t)||o==="keydown"&&pt("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.hideInput(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&st(n,"last-active"),We(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),st(e,"active")}clearActiveItems(){st(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,Pe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),Pe(e,{"aria-selected":"true"}),We(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,o=n.clientHeight,r=n.scrollTop||0,l=e.offsetHeight,h=e.getBoundingClientRect().top-n.getBoundingClientRect().top+r;h+l>o+r?this.scroll(h-o+l,t):h<r&&this.scroll(h,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(st(this.activeOption,"active"),Pe(this.activeOption,{"aria-selected":null})),this.activeOption=null,Pe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,Ge(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(Pe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&Pe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,o=this,r=this.getSearchOptions();if(o.settings.score&&(n=o.settings.score.call(o,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:n})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(l=>{let h=Je(l.id);return!(h&&o.items.indexOf(h)!==-1)})),t}refreshOptions(e=!0){var t,n,o,r,l,h,w,g,S,A;const k={},q=[];var O=this,B=O.inputValue();const T=B===O.lastQuery||B==""&&O.lastQuery==null;var P=O.search(B),C=null,V=O.settings.shouldOpen||!1,R=O.dropdown_content;for(T&&(C=O.activeOption,C&&(S=C.closest("[data-group]"))),r=P.items.length,typeof O.settings.maxOptions=="number"&&(r=Math.min(r,O.settings.maxOptions)),r>0&&(V=!0),t=0;t<r;t++){let b=P.items[t];if(!b)continue;let p=b.id,d=O.options[p];if(d===void 0)continue;let I=Gt(p),f=O.getOption(I,!0);for(O.settings.hideSelected||f.classList.toggle("selected",O.items.includes(I)),l=d[O.settings.optgroupField]||"",h=Array.isArray(l)?l:[l],n=0,o=h&&h.length;n<o;n++){l=h[n],O.optgroups.hasOwnProperty(l)||(l="");let x=k[l];x===void 0&&(x=document.createDocumentFragment(),q.push(l)),n>0&&(f=f.cloneNode(!0),Pe(f,{id:d.$id+"-clone-"+n,"aria-selected":null}),f.classList.add("ts-cloned"),st(f,"active"),O.activeOption&&O.activeOption.dataset.value==p&&S&&S.dataset.group===l.toString()&&(C=f)),x.appendChild(f),k[l]=x}}O.settings.lockOptgroupOrder&&q.sort((b,p)=>{const d=O.optgroups[b],I=O.optgroups[p],f=d&&d.$order||0,x=I&&I.$order||0;return f-x}),w=document.createDocumentFragment(),Ge(q,b=>{let p=k[b];if(!p||!p.children.length)return;let d=O.optgroups[b];if(d!==void 0){let I=document.createDocumentFragment(),f=O.render("optgroup_header",d);ht(I,f),ht(I,p);let x=O.render("optgroup",{group:d,options:I});ht(w,x)}else ht(w,p)}),R.innerHTML="",ht(R,w),O.settings.highlight&&(Bo(R),P.query.length&&P.tokens.length&&Ge(P.tokens,b=>{Ro(R,b.regex)}));var Q=b=>{let p=O.render(b,{input:B});return p&&(V=!0,R.insertBefore(p,R.firstChild)),p};if(O.loading?Q("loading"):O.settings.shouldLoad.call(O,B)?P.items.length===0&&Q("no_results"):Q("not_loading"),g=O.canCreate(B),g&&(A=Q("option_create")),O.hasOptions=P.items.length>0||g,V){if(P.items.length>0){if(!C&&O.settings.mode==="single"&&O.items[0]!=null&&(C=O.getOption(O.items[0])),!R.contains(C)){let b=0;A&&!O.settings.addPrecedence&&(b=1),C=O.selectable()[b]}}else A&&(C=A);e&&!O.isOpen&&(O.open(),O.scrollToOption(C,"auto")),O.setActiveOption(C)}else O.clearActiveOption(),e&&O.isOpen&&O.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const o=Je(e[n.settings.valueField]);return o===null||n.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[o]=e,n.lastQuery=null,t&&(n.userOptions[o]=t,n.trigger("option_add",o,e)),o)}addOptions(e,t=!1){Ge(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Je(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var o,r;const l=Je(e),h=Je(t[n.settings.valueField]);if(l===null)return;const w=n.options[l];if(w==null)return;if(typeof h!="string")throw new Error("Value must be set in option data");const g=n.getOption(l),S=n.getItem(l);if(t.$order=t.$order||w.$order,delete n.options[l],n.uncacheValue(h),n.options[h]=t,g){if(n.dropdown_content.contains(g)){const A=n._render("option",t);Vn(g,A),n.activeOption===g&&n.setActiveOption(A)}g.remove()}S&&(r=n.items.indexOf(l),r!==-1&&n.items.splice(r,1,h),o=n._render("item",t),S.classList.contains("active")&&We(o,"active"),Vn(S,o)),n.lastQuery=null}removeOption(e,t){const n=this;e=Gt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};Ge(this.options,(o,r)=>{t(o,r)&&(n[r]=o)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Je(e);if(n===null)return null;const o=this.options[n];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,n="option"){var o=this,r;if(!e)return null;n=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let l=0;l<r.length;l++)if(r[l]==e)return t>0?r[l+1]:r[l-1];return null}getItem(e){if(typeof e=="object")return e;var t=Je(e);return t!==null?this.control.querySelector(`[data-value="${xi(t)}"]`):null}addItems(e,t){var n=this,o=Array.isArray(e)?e:[e];o=o.filter(l=>n.items.indexOf(l)===-1);const r=o[o.length-1];o.forEach(l=>{n.isPending=l!==r,n.addItem(l,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];ki(this,n,()=>{var o,r;const l=this,h=l.settings.mode,w=Je(e);if(!(w&&l.items.indexOf(w)!==-1&&(h==="single"&&l.close(),h==="single"||!l.settings.duplicates))&&!(w===null||!l.options.hasOwnProperty(w))&&(h==="single"&&l.clear(t),!(h==="multi"&&l.isFull()))){if(o=l._render("item",l.options[w]),l.control.contains(o)&&(o=o.cloneNode(!0)),r=l.isFull(),l.items.splice(l.caretPos,0,w),l.insertAtCaret(o),l.isSetup){if(!l.isPending&&l.settings.hideSelected){let g=l.getOption(w),S=l.getAdjacent(g,1);S&&l.setActiveOption(S)}!l.isPending&&!l.settings.closeAfterSelect&&l.refreshOptions(l.isFocused&&h!=="single"),l.settings.closeAfterSelect!=!1&&l.isFull()?l.close():l.isPending||l.positionDropdown(),l.trigger("item_add",w,o),l.isPending||l.updateOriginalInput({silent:t})}(!l.isPending||!r&&l.isFull())&&(l.inputState(),l.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var o,r;const l=e.dataset.value;o=ln(e),e.remove(),e.classList.contains("active")&&(r=n.activeItems.indexOf(e),n.activeItems.splice(r,1),st(e,"active")),n.items.splice(o,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(l)&&n.removeOption(l,t),o<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",l,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,o=n.caretPos,r;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var l=!1,h=w=>{if(n.unlock(),!w||typeof w!="object")return t();var g=Je(w[n.settings.valueField]);if(typeof g!="string")return t();n.setTextboxValue(),n.addOption(w,!0),n.setCaret(o),n.addItem(g),t(w),l=!0};return typeof n.settings.create=="function"?r=n.settings.create.call(this,e,h):r={[n.settings.labelField]:e,[n.settings.valueField]:e},l||h(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",n),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",Fo(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let w=function(g,S,A){return g||(g=Be('<option value="'+qt(S)+'">'+qt(A)+"</option>")),g!=r&&t.input.append(g),l.push(g),(g!=r||h>0)&&(g.selected=!0),g};const l=[],h=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(g=>{g.selected=!1}),t.items.length==0&&t.settings.mode=="single"?w(r,"",""):t.items.forEach(g=>{if(n=t.options[g],o=n[t.settings.labelField]||"",l.includes(n.$option)){const S=t.input.querySelector(`option[value="${xi(g)}"]:not(:checked)`);w(S,g,o)}else n.$option=w(n.$option,g,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,Pe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Vt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Vt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.hideInput()),t.isOpen=!1,Pe(t.focus_node,{"aria-expanded":"false"}),Vt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Vt(this.dropdown,{width:t.width+"px",top:n+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();Ge(n,o=>{t.removeItem(o,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,o=t.control;o.insertBefore(e,o.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,o,r,l=this;t=e&&e.keyCode===Oi?-1:1,n=qo(l.control_input);const h=[];if(l.activeItems.length)r=Ti(l.activeItems,t),o=ln(r),t>0&&o++,Ge(l.activeItems,w=>h.push(w));else if((l.isFocused||l.settings.mode==="single")&&l.items.length){const w=l.controlChildren();let g;t<0&&n.start===0&&n.length===0?g=w[l.caretPos-1]:t>0&&n.start===l.inputValue().length&&(g=w[l.caretPos]),g!==void 0&&h.push(g)}if(!l.shouldDelete(h,e))return!1;for(Oe(e,!0),typeof o<"u"&&l.setCaret(o);h.length;)l.removeItem(h.pop());return l.showInput(),l.positionDropdown(),l.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(o=>o.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(pt(jt,t)||pt("shiftKey",t)?(n=r.getLastActive(e),n?n.classList.contains("active")?o=r.getAdjacent(n,e,"item"):o=n:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(n),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Ti(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,st(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,qt),!o))return null;if(o=Be(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?Pe(o,{"aria-disabled":"true"}):Pe(o,{"data-selectable":""}):e==="optgroup"&&(n=t.group[r.settings.optgroupValueField],Pe(o,{"data-group":n}),t.group[r.settings.disabledField]&&Pe(o,{"data-disabled":""})),e==="option"||e==="item"){const l=Gt(t[r.settings.valueField]);Pe(o,{"data-value":l}),e==="item"?(We(o,r.settings.itemClass),Pe(o,{"data-ts-item":""})):(We(o,r.settings.optionClass),Pe(o,{role:"option",id:t.$id}),t.$div=o,r.options[l]=t)}return o}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){Ge(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var o=this,r=o[t];o[t]=function(){var l,h;return e==="after"&&(l=r.apply(o,arguments)),h=n.apply(o,arguments),e==="instead"?h:(e==="before"&&(l=r.apply(o,arguments)),l)}}}function zo(){$e(this.input,"change",()=>{this.sync()})}function Ko(){var i=this,e=i.onOptionSelect;i.settings.hideSelected=!1;var t=function(o){setTimeout(()=>{var r=o.querySelector("input");r instanceof HTMLInputElement&&(o.classList.contains("selected")?r.checked=!0:r.checked=!1)},1)};i.hook("after","setupTemplates",()=>{var n=i.settings.render.option;i.settings.render.option=(o,r)=>{var l=Be(n.call(i,o,r)),h=document.createElement("input");h.addEventListener("click",function(g){Oe(g)}),h.type="checkbox";const w=Je(o[i.settings.valueField]);return w&&i.items.indexOf(w)>-1&&(h.checked=!0),l.prepend(h),l}}),i.on("item_remove",n=>{var o=i.getOption(n);o&&(o.classList.remove("selected"),t(o))}),i.on("item_add",n=>{var o=i.getOption(n);o&&t(o)}),i.hook("instead","onOptionSelect",(n,o)=>{if(o.classList.contains("selected")){o.classList.remove("selected"),i.removeItem(o.dataset.value),i.refreshOptions(),Oe(n,!0);return}e.call(i,n,o),t(o)})}function Yo(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Be(t.html(t));n.addEventListener("click",o=>{e.isDisabled||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(n)})}function Zo(){var i=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(i.settings.mode==="multi"){var e=i.lock,t=i.unlock;i.hook("instead","lock",()=>{var n=$(i.control).data("sortable");return n&&n.disable(),e.call(i)}),i.hook("instead","unlock",()=>{var n=$(i.control).data("sortable");return n&&n.enable(),t.call(i)}),i.on("initialize",()=>{var n=$(i.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:(o,r)=>{r.placeholder.css("width",r.helper.css("width")),n.css({overflow:"visible"})},stop:()=>{n.css({overflow:"hidden"});var o=[];n.children("[data-value]").each(function(){this.dataset.value&&o.push(this.dataset.value)}),i.setValue(o)}})})}}function Jo(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Be(t.html(t)),o=n.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Oe(r,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function Qo(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=ln(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),st(t,"last-active")}else i.setCaret(i.caretPos+e)})}function ea(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,We(i.control_input,"dropdown-input");const e=Be('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Be('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case or:i.isOpen&&(Oe(t,!0),i.close()),i.clearActiveItems();return;case Un:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),$e(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function ta(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of n)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),i.on("update item_add item_remove",o),$e(t,"input",o),$e(t,"keyup",o),$e(t,"blur",o),$e(t,"update",o)})}function na(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function ia(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function ra(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,o,r,l;if(!i.isOpen||!(t.keyCode===jn||t.keyCode===ar))return e.call(i,t);i.ignoreHover=!0,l=Wt(i.activeOption,"[data-group]"),n=ln(i.activeOption,"[data-selectable]"),l&&(t.keyCode===jn?l=l.previousSibling:l=l.nextSibling,l&&(r=l.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,n)],o&&i.setActiveOption(o)))})}function oa(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+qt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,l)=>{var h=Be(o.call(t,r,l)),w=Be(n);return h.appendChild(w),$e(w,"mousedown",g=>{Oe(g,!0)}),$e(w,"click",g=>{Oe(g,!0),!t.isLocked&&t.shouldDelete([h],g)&&(t.removeItem(h),t.refreshOptions(!1),t.inputState())}),h}})}}function aa(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[n];o&&e.setTextboxValue(t.text.call(e,o))}})}function sa(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var o={},r,l=!1,h,w=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(i.activeOption){var k=i.selectable(),q=Array.from(k).indexOf(i.activeOption);if(q>=k.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const g=A=>typeof i.settings.maxOptions=="number"&&r.children.length>=i.settings.maxOptions?!1:!!(A in o&&o[A]),S=(A,k)=>i.items.indexOf(k)>=0||w.indexOf(k)>=0;i.setNextUrl=(A,k)=>{o[A]=k},i.getUrl=A=>{if(A in o){const k=o[A];return o[A]=!1,k}return o={},i.settings.firstUrl.call(i,A)},i.hook("instead","clearActiveOption",()=>{if(!l)return t.call(i)}),i.hook("instead","canLoad",A=>A in o?g(A):e.call(i,A)),i.hook("instead","loadCallback",(A,k)=>{if(!l)i.clearOptions(S);else if(h){const q=A[0];q!==void 0&&(h.dataset.value=q[i.settings.valueField])}n.call(i,A,k),l=!1}),i.hook("after","refreshOptions",()=>{const A=i.lastValue;var k;g(A)?(k=i.render("loading_more",{query:A}),k&&(k.setAttribute("data-selectable",""),h=k)):A in o&&!r.querySelector(".no-results")&&(k=i.render("no_more_results",{query:A})),k&&(We(k,i.settings.optionClass),r.append(k))}),i.on("initialize",()=>{w=Object.keys(i.options),r=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),r.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&g(i.lastValue)&&(l||(l=!0,i.load.call(i,i.lastValue)))})})}qe.define("change_listener",zo);qe.define("checkbox_options",Ko);qe.define("clear_button",Yo);qe.define("drag_drop",Zo);qe.define("dropdown_header",Jo);qe.define("caret_position",Qo);qe.define("dropdown_input",ea);qe.define("input_autogrow",ta);qe.define("no_backspace_delete",na);qe.define("no_active_items",ia);qe.define("optgroup_columns",ra);qe.define("remove_button",oa);qe.define("restore_on_backspace",aa);qe.define("virtual_scroll",sa);async function la(i){if(!await F.scene.isReady())return;const n=(await F.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of i){const l=r.metadata[`${y.EXTENSIONID}/metadata_ghosts`];if(l?.length>0){o=!0;const h=l.map(g=>g.id);for(const g of l){const S=g.metadata[`${y.EXTENSIONID}/viewers`];S&&(S.includes(X.userId)?await F.scene.local.addItems([g]):n.includes(g.id)&&await F.scene.local.deleteItems([g.id]))}const w=n.filter(g=>!h.includes(g));w?.length>0&&await F.scene.local.deleteItems(w)}}o||await F.scene.local.deleteItems(n)}function ca(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const o of X.players)n.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function ua(){F.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${y.EXTENSIONID}/metadata_ghosts`]=e,await F.player.setMetadata(t)}),await F.contextMenu.create({id:`${y.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){document.getElementById("spectreWarning").style.display="none";for(const e of i.items){const t=e,n=t.text?.plainText||t.name;await F.scene.items.deleteItems([t.id]),await F.scene.local.addItems([t]),X.ghosts.push(t);const o=document.getElementById("ghostList"),r=document.createElement("tr");r.id=`tr-${t.id}`,r.className="ghost-table-entry",r.innerHTML=`<td class="token-name">${n}</td>
<td><select id="select-${t.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${t.id}" value="Delete"/></td>`,o.appendChild(r);const l=document.getElementById(`select-${t.id}`);for(const g of X.players){const S=document.createElement("option");S.value=g.id,S.text=g.name,l.appendChild(S)}const h={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:X.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(g,S){const A=S.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await F.scene.local.updateItems([A],k=>{const q=k[0].metadata[`${y.EXTENSIONID}/viewers`],O=q.findIndex(B=>B==g);q.splice(O,1),k[0].metadata[`${y.EXTENSIONID}/viewers`]=q})},onItemAdd:async function(g,S){const A=S.parentElement.parentElement.parentElement.parentElement.id.slice(3);await F.scene.local.updateItems([A],k=>{const q=k[0].metadata[`${y.EXTENSIONID}/viewers`];q?(q.push(g),k[0].metadata[`${y.EXTENSIONID}/viewers`]=q):k[0].metadata[`${y.EXTENSIONID}/viewers`]=[g]})}};new qe(`#select-${t.id}`,h);const w=document.getElementById(`deleteGhost-${t.id}`);w.onclick=async()=>{const g=X.ghosts.findIndex(S=>S.id===t.id);X.ghosts.splice(g,1),r.remove(),await F.scene.local.updateItems([t.id],S=>{S[0].metadata[`${y.EXTENSIONID}/viewers`]=[]}),await F.scene.local.deleteItems([t.id])}}}})}var sr={exports:{}};(function(i){(function(){function e(h,w){var g=h.x-w.x,S=h.y-w.y;return g*g+S*S}function t(h,w,g){var S=w.x,A=w.y,k=g.x-S,q=g.y-A;if(k!==0||q!==0){var O=((h.x-S)*k+(h.y-A)*q)/(k*k+q*q);O>1?(S=g.x,A=g.y):O>0&&(S+=k*O,A+=q*O)}return k=h.x-S,q=h.y-A,k*k+q*q}function n(h,w){for(var g=h[0],S=[g],A,k=1,q=h.length;k<q;k++)A=h[k],e(A,g)>w&&(S.push(A),g=A);return g!==A&&S.push(A),S}function o(h,w,g,S,A){for(var k=S,q,O=w+1;O<g;O++){var B=t(h[O],h[w],h[g]);B>k&&(q=O,k=B)}k>S&&(q-w>1&&o(h,w,q,S,A),A.push(h[q]),g-q>1&&o(h,q,g,S,A))}function r(h,w){var g=h.length-1,S=[h[0]];return o(h,0,g,w,S),S.push(h[g]),S}function l(h,w,g){if(h.length<=2)return h;var S=w!==void 0?w*w:1;return h=g?h:n(h,S),h=r(h,S),h}i.exports=l,i.exports.default=l})()})(sr);var da=sr.exports;const fa=qn(da);async function Di(i){const e=await F.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=i.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,i.appendChild(r)),t[e[o].id]=e[o].name}let n=i.querySelectorAll("option");for(let o=0;o<n.length;o++)t[n[o].value]===void 0&&i.removeChild(n[o])}async function pa(i,e,t,n,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=X.gridDpi/t,l,h=[];if(h[0]=0,h[1]=0,n!==""){let w=await F.scene.items.getItems([n]);if(w.length>0)l=w[0],t===0&&(t=l.grid.dpi),r=X.gridDpi/t,h[0]=l.position.x-l.grid.offset.x*r,h[1]=l.position.y-l.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}i==="foundry"?ga(e,r,h,o):i==="uvtt"&&ha(e,r,h,o)}function lr(i,e,t,n,o){let r=0,l=0,h=0;const w=[];for(let g=0;g<i.length;g++){let S=[],A=!1;for(let k=0;k<i[g].length-1;k++){let q=i[g][k].x*e,O=i[g][k].y*e,B=i[g][k+1].x*e,T=i[g][k+1].y*e;S.push({x:q*t+n[0],y:O*t+n[1]}),S.push({x:B*t+n[0],y:T*t+n[1]}),l++,!A&&i[g][k].door&&(A=!0)}if(S.length>128){let k=S.length;S=fa(S,8,!1),console.log("simplified points from "+k+" to "+S.length)}for(let k=0;k<S.length;k+=256){const q=S.slice(k>0?k-1:0,k+256),O=Gn().tension(0).points(q).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();if(O.visible=!1,O.metadata[`${y.EXTENSIONID}/isVisionLine`]=!0,A&&(O.metadata[`${y.EXTENSIONID}/isDoor`]=!0),w.push(O),h+=q.length,h>512||w.length>64){r+=w.length,F.scene.items.addItems(w);const B=w.filter(T=>T.metadata[`${y.EXTENSIONID}/isDoor`]===!0);rn(B),w.length=0,h=0}}}if(w.length>0){r+=w.length,F.scene.items.addItems(w);const g=w.filter(S=>S.metadata[`${y.EXTENSIONID}/isDoor`]===!0);rn(g)}o.innerText="Finished importing "+r+" walls, "+l+" points."}function ha(i,e,t,n){if(!i.line_of_sight||i.line_of_sight.length===0){n.innerText="No walls / los found";return}if(i.resolution.map_origin!==void 0&&(t[0]-=i.resolution.map_origin.x*i.resolution.pixels_per_grid,t[1]-=i.resolution.map_origin.y*i.resolution.pixels_per_grid),i.portals&&i.portals.length)for(let o=0;o<i.portals.length;o++){let r=i.portals[o].bounds;r[0].door=!0,r[1].door=!0,i.line_of_sight.push(r)}lr(i.line_of_sight,i.resolution.pixels_per_grid,e,t,n)}function ga(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const o=[];for(var r=0;r<i.walls.length;r++)o.push([{x:i.walls[r].c[0],y:i.walls[r].c[1],door:!!i.walls[r].door},{x:i.walls[r].c[2],y:i.walls[r].c[3],door:!!i.walls[r].door}]);lr(o,1,e,t,n)}function Pi(i,e){const t=window.matchMedia("(prefers-color-scheme: dark)");console.log(t.matches);const n=t.matches?"dark":"light",o=t.matches?"light":"dark";for(var r=0;r<e.styleSheets.length;r++)for(var l=0;l<e.styleSheets[r].cssRules.length;l++){let h=e.styleSheets[r].cssRules[l];h&&h.media&&h.media.mediaText.includes("prefers-color-scheme")&&(i.mode=="LIGHT"?(h.media.appendMedium(`(prefers-color-scheme: ${n})`),h.media.mediaText.includes(o)&&h.media.deleteMedium(`(prefers-color-scheme: ${o})`)):i.mode=="DARK"&&(h.media.appendMedium(`(prefers-color-scheme: ${o})`),h.media.mediaText.includes(n)&&h.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}var rt=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(i,e,t,n){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},l,h,w,g,S,A,k,q,O,B,T,P,C,V,R,Q,b={},p={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},d={},I="",f={},x=!1;function L(E){if(typeof E=="object"){var U=function(){switch(z){case"el":me(E.el),E.wrap!==!1&&fe(E.el);break;case"parent":l=e.querySelector(E.parent),l&&(l.appendChild(h),p.parent=E.parent,l===e.body&&(l=n));break;case"themeMode":p.themeMode=E.themeMode,E.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(p.themeMode="dark");case"theme":E.theme&&(p.theme=E.theme),h.className="clr-picker clr-"+p.theme+" clr-"+p.themeMode,p.inline&&be();break;case"rtl":p.rtl=!!E.rtl,e.querySelectorAll(".clr-field").forEach(function(Fe){return Fe.classList.toggle("clr-rtl",p.rtl)});break;case"margin":E.margin*=1,p.margin=isNaN(E.margin)?p.margin:E.margin;break;case"wrap":E.el&&E.wrap&&fe(E.el);break;case"formatToggle":p.formatToggle=!!E.formatToggle,he("clr-format").style.display=p.formatToggle?"block":"none",p.formatToggle&&(p.format="auto");break;case"swatches":if(Array.isArray(E.swatches)){var ce=[];E.swatches.forEach(function(Fe,ye){ce.push('<button type="button" id="clr-swatch-'+ye+'" aria-labelledby="clr-swatch-label clr-swatch-'+ye+'" style="color: '+Fe+';">'+Fe+"</button>")}),he("clr-swatches").innerHTML=ce.length?"<div>"+ce.join("")+"</div>":"",p.swatches=E.swatches.slice()}break;case"swatchesOnly":p.swatchesOnly=!!E.swatchesOnly,h.setAttribute("data-minimal",p.swatchesOnly);break;case"alpha":p.alpha=!!E.alpha,h.setAttribute("data-alpha",p.alpha);break;case"inline":if(p.inline=!!E.inline,h.setAttribute("data-inline",p.inline),p.inline){var ge=E.defaultColor||p.defaultColor;V=Ve(ge),be(),Ie(ge)}break;case"clearButton":typeof E.clearButton=="object"&&(E.clearButton.label&&(p.clearLabel=E.clearButton.label,k.innerHTML=p.clearLabel),E.clearButton=E.clearButton.show),p.clearButton=!!E.clearButton,k.style.display=p.clearButton?"block":"none";break;case"clearLabel":p.clearLabel=E.clearLabel,k.innerHTML=p.clearLabel;break;case"closeButton":p.closeButton=!!E.closeButton,p.closeButton?h.insertBefore(q,S):S.appendChild(q);break;case"closeLabel":p.closeLabel=E.closeLabel,q.innerHTML=p.closeLabel;break;case"a11y":var de=E.a11y,Ne=!1;if(typeof de=="object")for(var ve in de)de[ve]&&p.a11y[ve]&&(p.a11y[ve]=de[ve],Ne=!0);if(Ne){var Me=he("clr-open-label"),Ee=he("clr-swatch-label");Me.innerHTML=p.a11y.open,Ee.innerHTML=p.a11y.swatch,q.setAttribute("aria-label",p.a11y.close),k.setAttribute("aria-label",p.a11y.clear),O.setAttribute("aria-label",p.a11y.hueSlider),T.setAttribute("aria-label",p.a11y.alphaSlider),A.setAttribute("aria-label",p.a11y.input),w.setAttribute("aria-label",p.a11y.instruction)}break;default:p[z]=E[z]}};for(var z in E)U()}}function re(E,U){typeof E=="string"&&typeof U=="object"&&(d[E]=U,x=!0)}function oe(E){delete d[E],Object.keys(d).length===0&&(x=!1,E===I&&Z())}function ae(E){if(x){var U=["el","wrap","rtl","inline","defaultColor","a11y"],z=function(){var de=d[te];if(E.matches(te)){I=te,f={},U.forEach(function(ve){return delete de[ve]});for(var Ne in de)f[Ne]=Array.isArray(p[Ne])?p[Ne].slice():p[Ne];return L(de),"break"}};for(var te in d){var ce=z();if(ce==="break")break}}}function Z(){Object.keys(f).length>0&&(L(f),I="",f={})}function me(E){we(e,"click",E,function(U){p.inline||(ae(U.target),C=U.target,R=C.value,V=Ve(R),h.classList.add("clr-open"),be(),Ie(R),(p.focusInput||p.selectInput)&&(A.focus({preventScroll:!0}),A.setSelectionRange(C.selectionStart,C.selectionEnd)),p.selectInput&&A.select(),(Q||p.swatchesOnly)&&Ce().shift().focus(),C.dispatchEvent(new Event("open",{bubbles:!0})))}),we(e,"input",E,function(U){var z=U.target.parentNode;z.classList.contains("clr-field")&&(z.style.color=U.target.value)})}function be(){if(!(!h||!C&&!p.inline)){var E=l,U=i.scrollY,z=h.offsetWidth,te=h.offsetHeight,ce={left:!1,top:!1},ge,de,Ne,ve={x:0,y:0};if(E&&(ge=i.getComputedStyle(E),de=parseFloat(ge.marginTop),Ne=parseFloat(ge.borderTopWidth),ve=E.getBoundingClientRect(),ve.y+=Ne+U),!p.inline){var Me=C.getBoundingClientRect(),Ee=Me.x,Fe=U+Me.y+Me.height+p.margin;E?(Ee-=ve.x,Fe-=ve.y,Ee+z>E.clientWidth&&(Ee+=Me.width-z,ce.left=!0),Fe+te>E.clientHeight-de&&te+p.margin<=Me.top-(ve.y-U)&&(Fe-=Me.height+te+p.margin*2,ce.top=!0),Fe+=E.scrollTop):(Ee+z>e.documentElement.clientWidth&&(Ee+=Me.width-z,ce.left=!0),Fe+te-U>e.documentElement.clientHeight&&te+p.margin<=Me.top&&(Fe=U+Me.y-te-p.margin,ce.top=!0)),h.classList.toggle("clr-left",ce.left),h.classList.toggle("clr-top",ce.top),h.style.left=Ee+"px",h.style.top=Fe+"px",ve.x+=h.offsetLeft,ve.y+=h.offsetTop}b={width:w.offsetWidth,height:w.offsetHeight,x:w.offsetLeft+ve.x,y:w.offsetTop+ve.y}}}function fe(E){e.querySelectorAll(E).forEach(function(U){var z=U.parentNode;if(!z.classList.contains("clr-field")){var te=e.createElement("div"),ce="clr-field";(p.rtl||U.classList.contains("clr-rtl"))&&(ce+=" clr-rtl"),te.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',z.insertBefore(te,U),te.setAttribute("class",ce),te.style.color=U.value,te.appendChild(U)}})}function se(E){if(C&&!p.inline){var U=C;E&&(C=n,R!==U.value&&(U.value=R,U.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){R!==U.value&&U.dispatchEvent(new Event("change",{bubbles:!0}))}),h.classList.remove("clr-open"),x&&Z(),U.dispatchEvent(new Event("close",{bubbles:!0})),p.focusInput&&U.focus({preventScroll:!0}),C=n}}function Ie(E){var U=ue(E),z=ne(U);Ye(z.s,z.v),m(U,z),O.value=z.h,h.style.color="hsl("+z.h+", 100%, 50%)",B.style.left=z.h/360*100+"%",g.style.left=b.width*z.s/100+"px",g.style.top=b.height-b.height*z.v/100+"px",T.value=z.a*100,P.style.left=z.a*100+"%"}function Ve(E){var U=E.substring(0,3).toLowerCase();return U==="rgb"||U==="hsl"?U:"hex"}function le(E){E=E!==n?E:A.value,C&&(C.value=E,C.dispatchEvent(new Event("input",{bubbles:!0}))),p.onChange&&p.onChange.call(i,E,C),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:E,currentEl:C}}))}function Te(E,U){var z={h:O.value*1,s:E/b.width*100,v:100-U/b.height*100,a:T.value/100},te=W(z);Ye(z.s,z.v),m(te,z),le()}function Ye(E,U){var z=p.a11y.marker;E=E.toFixed(1)*1,U=U.toFixed(1)*1,z=z.replace("{s}",E),z=z.replace("{v}",U),g.setAttribute("aria-label",z)}function ze(E){return{pageX:E.changedTouches?E.changedTouches[0].pageX:E.pageX,pageY:E.changedTouches?E.changedTouches[0].pageY:E.pageY}}function Le(E){var U=ze(E),z=U.pageX-b.x,te=U.pageY-b.y;l&&(te+=l.scrollTop),c(z,te),E.preventDefault(),E.stopPropagation()}function D(E,U){var z=g.style.left.replace("px","")*1+E,te=g.style.top.replace("px","")*1+U;c(z,te)}function c(E,U){E=E<0?0:E>b.width?b.width:E,U=U<0?0:U>b.height?b.height:U,g.style.left=E+"px",g.style.top=U+"px",Te(E,U),g.focus()}function m(E,U){E===void 0&&(E={}),U===void 0&&(U={});var z=p.format;for(var te in E)r[te]=E[te];for(var ce in U)r[ce]=U[ce];var ge=pe(r),de=ge.substring(0,7);switch(g.style.color=de,P.parentNode.style.color=de,P.style.color=ge,S.style.color=ge,w.style.display="none",w.offsetHeight,w.style.display="",P.nextElementSibling.style.display="none",P.nextElementSibling.offsetHeight,P.nextElementSibling.style.display="",z==="mixed"?z=r.a===1?"hex":"rgb":z==="auto"&&(z=V),z){case"hex":A.value=ge;break;case"rgb":A.value=Ae(r);break;case"hsl":A.value=De(G(r));break}e.querySelector('.clr-format [value="'+z+'"]').checked=!0}function _(){var E=O.value*1,U=g.style.left.replace("px","")*1,z=g.style.top.replace("px","")*1;h.style.color="hsl("+E+", 100%, 50%)",B.style.left=E/360*100+"%",Te(U,z)}function H(){var E=T.value/100;P.style.left=E*100+"%",m({a:E}),le()}function W(E){var U=E.s/100,z=E.v/100,te=U*z,ce=E.h/60,ge=te*(1-t.abs(ce%2-1)),de=z-te;te=te+de,ge=ge+de;var Ne=t.floor(ce)%6,ve=[te,ge,de,de,ge,te][Ne],Me=[ge,te,te,ge,de,de][Ne],Ee=[de,de,ge,te,te,ge][Ne];return{r:t.round(ve*255),g:t.round(Me*255),b:t.round(Ee*255),a:E.a}}function G(E){var U=E.v/100,z=U*(1-E.s/100/2),te;return z>0&&z<1&&(te=t.round((U-z)/t.min(z,1-z)*100)),{h:E.h,s:te||0,l:t.round(z*100),a:E.a}}function ne(E){var U=E.r/255,z=E.g/255,te=E.b/255,ce=t.max(U,z,te),ge=t.min(U,z,te),de=ce-ge,Ne=ce,ve=0,Me=0;return de&&(ce===U&&(ve=(z-te)/de),ce===z&&(ve=2+(te-U)/de),ce===te&&(ve=4+(U-z)/de),ce&&(Me=de/ce)),ve=t.floor(ve*60),{h:ve<0?ve+360:ve,s:t.round(Me*100),v:t.round(Ne*100),a:E.a}}function ue(E){var U=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,z,te;return o.fillStyle="#000",o.fillStyle=E,z=U.exec(o.fillStyle),z?(te={r:z[3]*1,g:z[4]*1,b:z[5]*1,a:z[6]*1},te.a=+te.a.toFixed(2)):(z=o.fillStyle.replace("#","").match(/.{2}/g).map(function(ce){return parseInt(ce,16)}),te={r:z[0],g:z[1],b:z[2],a:1}),te}function pe(E){var U=E.r.toString(16),z=E.g.toString(16),te=E.b.toString(16),ce="";if(E.r<16&&(U="0"+U),E.g<16&&(z="0"+z),E.b<16&&(te="0"+te),p.alpha&&(E.a<1||p.forceAlpha)){var ge=E.a*255|0;ce=ge.toString(16),ge<16&&(ce="0"+ce)}return"#"+U+z+te+ce}function Ae(E){return!p.alpha||E.a===1&&!p.forceAlpha?"rgb("+E.r+", "+E.g+", "+E.b+")":"rgba("+E.r+", "+E.g+", "+E.b+", "+E.a+")"}function De(E){return!p.alpha||E.a===1&&!p.forceAlpha?"hsl("+E.h+", "+E.s+"%, "+E.l+"%)":"hsla("+E.h+", "+E.s+"%, "+E.l+"%, "+E.a+")"}function Re(){e.getElementById("clr-picker")||(l=n,h=e.createElement("div"),h.setAttribute("id","clr-picker"),h.className="clr-picker",h.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+p.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+p.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+p.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+p.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+p.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+p.a11y.clear+'">'+p.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+p.a11y.close+'">'+p.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+p.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+p.a11y.swatch+"</span>"),e.body.appendChild(h),w=he("clr-color-area"),g=he("clr-color-marker"),k=he("clr-clear"),q=he("clr-close"),S=he("clr-color-preview"),A=he("clr-color-value"),O=he("clr-hue-slider"),B=he("clr-hue-marker"),T=he("clr-alpha-slider"),P=he("clr-alpha-marker"),me(p.el),fe(p.el),we(h,"mousedown",function(E){h.classList.remove("clr-keyboard-nav"),E.stopPropagation()}),we(w,"mousedown",function(E){we(e,"mousemove",Le)}),we(w,"touchstart",function(E){e.addEventListener("touchmove",Le,{passive:!1})}),we(g,"mousedown",function(E){we(e,"mousemove",Le)}),we(g,"touchstart",function(E){e.addEventListener("touchmove",Le,{passive:!1})}),we(A,"change",function(E){var U=A.value;if(C||p.inline){var z=U===""?U:Ie(U);le(z)}}),we(k,"click",function(E){le(""),se()}),we(q,"click",function(E){le(),se()}),we(he("clr-format"),"click",".clr-format input",function(E){V=E.target.value,m(),le()}),we(h,"click",".clr-swatches button",function(E){Ie(E.target.textContent),le(),p.swatchesOnly&&se()}),we(e,"mouseup",function(E){e.removeEventListener("mousemove",Le)}),we(e,"touchend",function(E){e.removeEventListener("touchmove",Le)}),we(e,"mousedown",function(E){Q=!1,h.classList.remove("clr-keyboard-nav"),se()}),we(e,"keydown",function(E){var U=E.key,z=E.target,te=E.shiftKey,ce=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(U==="Escape"?se(!0):ce.includes(U)&&(Q=!0,h.classList.add("clr-keyboard-nav")),U==="Tab"&&z.matches(".clr-picker *")){var ge=Ce(),de=ge.shift(),Ne=ge.pop();te&&z===de?(Ne.focus(),E.preventDefault()):!te&&z===Ne&&(de.focus(),E.preventDefault())}}),we(e,"click",".clr-field button",function(E){x&&Z(),E.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),we(g,"keydown",function(E){var U={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(U).includes(E.key)&&(D.apply(void 0,U[E.key]),E.preventDefault())}),we(w,"click",Le),we(O,"input",_),we(T,"input",H))}function Ce(){var E=Array.from(h.querySelectorAll("input, button")),U=E.filter(function(z){return!!z.offsetWidth});return U}function he(E){return e.getElementById(E)}function we(E,U,z,te){var ce=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof z=="string"?E.addEventListener(U,function(ge){ce.call(ge.target,z)&&te.call(ge.target,ge)}):(te=z,E.addEventListener(U,te))}function Ke(E,U){U=U!==n?U:[],e.readyState!=="loading"?E.apply(void 0,U):e.addEventListener("DOMContentLoaded",function(){E.apply(void 0,U)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function lt(E,U){C=U,R=C.value,ae(U),V=Ve(E),be(),Ie(E),le(),R!==E&&C.dispatchEvent(new Event("change",{bubbles:!0}))}var tt=function(){var E={init:Re,set:L,wrap:fe,close:se,setInstance:re,setColor:lt,removeInstance:oe,updatePosition:be};function U(ce){Ke(function(){ce&&(typeof ce=="string"?me(ce):L(ce))})}var z=function(ge){U[ge]=function(){for(var de=arguments.length,Ne=new Array(de),ve=0;ve<de;ve++)Ne[ve]=arguments[ve];Ke(E[ge],Ne)}};for(var te in E)z(te);return Ke(function(){i.addEventListener("resize",function(ce){U.updatePosition()}),i.addEventListener("scroll",function(ce){U.updatePosition()})}),U}();return tt.coloris=tt,tt}(window,document,Math)}();rt.coloris;rt.init;rt.set;rt.wrap;rt.close;rt.setInstance;rt.removeInstance;rt.updatePosition;const Yn=document.getElementById("app");Yn.innerHTML=`
<div>
    <div>
        <div id="localStorageWarning"></div>
        <div class="title">
            Smoke! ˣ Dynamic Fog
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings"><svg fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.63 11.08zm.21.41v-.1zm.23.38L1 11.68zM1 11.68l-.11-.19zm-.21-.29c-.06-.1-.11-.21-.16-.31.05.1.1.21.16.31zm.32.54v-.06z"/><path d="m11.26 12.63 1.83 1.09a7.34 7.34 0 0 0 1-.94 7.48 7.48 0 0 0 1.56-2.86l-1.74-1A5.29 5.29 0 0 0 14 8a5.29 5.29 0 0 0-.08-.9l1.74-1a7.45 7.45 0 0 0-1.33-2.58 7.54 7.54 0 0 0-1.24-1.22l-1.83 1.04a6 6 0 0 0-1.11-.53v-2A8.55 8.55 0 0 0 7.94.53a8.39 8.39 0 0 0-2.26.3v2a7.23 7.23 0 0 0-1.12.54L2.78 2.28A7.46 7.46 0 0 0 .2 6.06l1.72 1a5.29 5.29 0 0 0-.08.9 5.29 5.29 0 0 0 .08.9l-1.73 1a8 8 0 0 0 .43 1.15c.05.1.1.21.16.31v.1l.11.19.12.19v.06a7.69 7.69 0 0 0 1.64 1.78l1.81-1.08a7.23 7.23 0 0 0 1.12.54v2a8.39 8.39 0 0 0 2.26.31 8.56 8.56 0 0 0 2.22-.3v-2a6 6 0 0 0 1.2-.48zm-2.39 1.52a7.57 7.57 0 0 1-.95.06 7.73 7.73 0 0 1-1-.06v-1.69a4.92 4.92 0 0 1-2.53-1.27l-1.54.92a6.22 6.22 0 0 1-1.08-1.61l1.56-.93a4.27 4.27 0 0 1 0-3.17l-1.56-.92a6.11 6.11 0 0 1 1.12-1.62l1.56.93A5 5 0 0 1 7 3.53V1.82a7.73 7.73 0 0 1 1-.06 7.57 7.57 0 0 1 .95.06v1.72a4.9 4.9 0 0 1 2.4 1.26l1.59-.94a6.31 6.31 0 0 1 1.11 1.62l-1.6.94a4.35 4.35 0 0 1 .3 1.58 4.44 4.44 0 0 1-.29 1.55l1.56.93a6.43 6.43 0 0 1-1.11 1.61l-1.58-.93a5 5 0 0 1-2.49 1.28z"/><path d="M7.92 5.49A2.59 2.59 0 0 0 5.25 8a2.59 2.59 0 0 0 2.67 2.51A2.6 2.6 0 0 0 10.6 8a2.6 2.6 0 0 0-2.68-2.51zM8 9.2A1.35 1.35 0 0 1 6.55 8 1.35 1.35 0 0 1 8 6.7 1.35 1.35 0 0 1 9.39 8 1.35 1.35 0 0 1 8 9.2z"/></svg></div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
        </div>
        <hr>
        <div id="settings-ui" class="grid-settings" style="display:none;">
            <div class="visionTitle grid-3">Settings</div>

            <div><label for="autodetect_checkbox" title="Automatically detect fog areas based on the current scene's maps">Autodetect Maps</label></div>
            <div style="grid-column: span 2;"><input type="checkbox" id="autodetect_checkbox" checked></div>

            <div id="boundry_options" class="grid-3" style="display:none;">
                <span id="map_size">Boundary Size: 
                    <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
                    <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
                    <input type="button" id="mapSubmit" value="Update"/>
                    &nbsp;&nbsp;&nbsp;
                </span>
            </div>

            <div><label for="snap_checkbox">Grid Snap</label></div>
            <div class="grid-2"><input type="checkbox" id="snap_checkbox"></div>

            <div><label for="persistence_checkbox" title="Enabling fog persistence will retain the previously viewed areas of the map">Persistence</label></div>
            <div><input type="checkbox" id="persistence_checkbox"></div>
            <div><input type="button" id="persistence_reset" value="Reset"></div>

            <div><label for="fow_checkbox" title="Trailing fog shows an opaque layer for previously viewed areas that players cannot currently view">Trailing Fog + Autohide</label></div>
            <div><input type="checkbox" id="fow_checkbox"></div>
            <div><input type="text" style="width: 90px;" maxlength="9" id="fow_color" value="#00000088"></div>

            <div>Render Quality</div>
            <div></div>
            <div><select id="quality"><option value="fast">Fast</option><option value="accurate">Accurate</option></select></div>

            <div>Convert from <i>Dynamic Fog</i></div>
            <div></div>
            <div><input type="button" id="convert_button" value="Convert"></div>

            <div>Unlock Fog Backgrounds</div>
            <div></div>
            <div><input type="button" id="background_button" value="Unlock"></div>

            <div></div>
            <div></div>
            <div><input type="button" id="debug_button" value="Enable Debugging" title="Show debugging and performance data"></div>

            <div class="visionTitle grid-3" style="margin-top: 16px;">Import</div>

            <div class="grid-3" style="margin-bottom: 16px;">Import JSON files with fog data from<br><a href="https://www.dungeonalchemist.com/" target="_blank">Dungeon Alchemist</a> and other tools.</div>

            <div>File Format</div>
            <div></div>
            <div><select id="import_format"><option value="foundry">Foundry</option><option value="uvtt">Universal VTT</option></select></div>

            <div><label for="dpi_autodetect" title="Whether or not to automatically detect the DPI of imported data based">DPI Autodetect</label></div>
            <div><input type="checkbox" id="dpi_autodetect" checked></div>
            <div><input id="import_dpi" disabled type="text" value="150" style="width: 32px;" maxlength="4"></div>

            <div style="margin-bottom: 8px;" title="Which map to align imported lines to">Map Alignment</div>
            <div></div>
            <div><select id="map_align" style="width: 120px;"><option selected>Loading..</option></select></div>

            <div><input id="import_file" style="width: 190px;" type="file"></div>
            <div></div>
            <div><input style="padding: 6px" type="button" id="import_button" value="Import" disabled></div>

            <div id="import_errors" class="grid-3"></div>
        </div>

        <div id="main-ui" class="grid-main">
            <div class="visionTitle grid-3">Vision Radius</div>
            <div class="grid-3"><i>GM-owned tokens give universal vision.</i></div>
            <p class="grid-3" id="no_tokens_message">Enable vision on your character tokens.</p>
            <div id="token_list_div" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <table style="margin: auto; padding: 0;">
                <tbody id="token_list"></tbody>
                </table>
            </div>
            <div class="visionTitle grid-3">Spectres!</div>
            <div id="ghostContainer" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <div id="spectreWarning">
                    Spectre tokens are only visible to specific players.
                    <br>
                    Enable vision here after it's been Spectred.
                    <br>
                    <br>
                    <i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i>
                </div>
                <table style="margin: auto; padding: 0; width: 100%">
                <colgroup>
                    <col style="width: 50%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                </colgroup>
                <tbody id="ghostList">
                </tbody></table>
            </div> 
            <div id="fog_backgrounds" class="grid-3">
                <div class="visionTitle" style="display: block; padding-top:8px;">Fog Backgrounds</div>
                <div id="fog_background_list" class="grid-main" style="border-bottom: 1px solid white; padding-bottom: 8px;">
            </div>
        </div>

        <div id="debug_div" style="display: none;" class="grid-debug">
            <div class="visionTitle grid-2" style="text-align: center; margin-top: 16px">Performance Info</div>
            <div>Stage 1: Fog Shapes</div><div id="stage1">N/A</div>
            <div>Stage 2: Player Vision</div><div id="stage2">N/A</div>
            <div>Stage 3: Vision Ranges</div><div id="stage3">N/A</div>
            <div>Stage 4: Persistence+Trailing</div><div id="stage4">N/A</div>
            <div>Stage 5: OBR Scene</div><div id="stage5">N/A</div>
            <div>Stage 6: Autohide</div><div id="stage6">N/A</div>
            <div>Cache hits/misses</div><div><span id="cache_hits">?</span>/<span id=cache_misses>?</span></div>
        </div>
    </div>
</div>
`;Yn.parentElement.style.placeItems="start";const $i=document.getElementById("main-ui"),Mn=document.getElementById("settings-ui"),cr=document.getElementById("vision_checkbox"),Li=document.getElementById("snap_checkbox"),ma=document.getElementById("token_list"),va=document.getElementById("no_tokens_message"),ya=document.getElementById("mapHeight"),Ia=document.getElementById("mapWidth"),wa=document.getElementById("mapSubmit"),ur=document.getElementById("persistence_checkbox"),xt=document.getElementById("autodetect_checkbox"),Hn=document.getElementById("fow_checkbox"),dr=document.getElementById("fow_color"),fr=document.getElementById("quality"),ba=document.getElementById("persistence_reset"),Ea=document.getElementById("convert_button"),_a=document.getElementById("settings_button"),pr=document.getElementById("boundry_options"),zt=document.getElementById("debug_div"),Sa=document.getElementById("debug_button"),Ta=document.getElementById("background_button"),Fn=document.getElementById("import_button"),Oa=document.getElementById("import_file"),Wn=document.getElementById("map_align"),Tt=document.getElementById("import_errors"),Na=document.getElementById("dpi_autodetect"),ka=document.getElementById("import_dpi"),xa=document.getElementById("import_format");rt.init();async function Aa(){cr.addEventListener("click",async e=>{if(!X.ready||!e.target){e.preventDefault();return}const t=e.target;await F.scene.setMetadata({[`${y.EXTENSIONID}/visionEnabled`]:t.checked})},!1),Li.checked=!0,Li.addEventListener("click",async e=>{if(!X.ready||!e.target){e.preventDefault();return}const t=e.target;X.snap=t.checked},!1),_a.addEventListener("click",async e=>{!e||!e.target||(Mn.style.display==="grid"?(Mn.style.display="none",$i.style.display="grid"):(Mn.style.display="grid",$i.style.display="none"))},!1),ur.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await F.scene.setMetadata({[`${y.EXTENSIONID}/persistenceEnabled`]:t.checked})},!1),xt.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;if(await F.scene.setMetadata({[`${y.EXTENSIONID}/autodetectEnabled`]:t.checked}),pr.style.display=t.checked?"none":"",!t.checked){let n=hr();n&&await F.scene.items.addItems([n])}},!1),Hn.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await F.scene.setMetadata({[`${y.EXTENSIONID}/fowEnabled`]:t.checked})},!1),fr.addEventListener("change",async e=>{if(!e||!e.target)return;const t=e.target;await F.scene.setMetadata({[`${y.EXTENSIONID}/quality`]:t.value})},!1),ba.addEventListener("click",async e=>{!e||!e.target||(F.scene.setMetadata({[`${y.EXTENSIONID}/forceReset`]:!0}),F.scene.setMetadata({[`${y.EXTENSIONID}/forceReset`]:void 0}))},!1),Sa.addEventListener("click",async e=>{!e||!e.target||(e.target,zt.style.display=zt.style.display=="none"?"grid":"none",await F.scene.setMetadata({[`${y.EXTENSIONID}/debug`]:zt.style.display==="grid"}))},!1),Ta.addEventListener("click",async e=>{!e||!e.target||(e.target,await F.scene.items.updateItems(t=>t.layer=="FOG"&&t.metadata[`${y.EXTENSIONID}/isBackgroundMap`]===!0,t=>{for(let n=0;n<t.length;n++)t[n].layer="MAP",t[n].disableHit=!1,t[n].locked=!1,t[n].visible=!0,delete t[n].metadata[`${y.EXTENSIONID}/isBackgroundMap`]}))},!1),dr.addEventListener("input",async e=>{if(!e||!e.target)return;const t=e.target;if(/#[a-f0-9]{8}/.test(t.value)){await F.scene.setMetadata({[`${y.EXTENSIONID}/fowColor`]:t.value});const o=await F.scene.local.getItems(Ht);await F.scene.local.deleteItems(o.map(r=>r.id))}},!1),Ea.addEventListener("click",async e=>{if(!(!e||!e.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const t=await F.scene.getMetadata();for(const o in t)o.substring(0,o.indexOf("/"))==y.ARMINDOID&&F.scene.setMetadata({[`${o}`]:void 0});const n=await F.scene.items.getItems();await F.scene.items.updateItems(n,o=>{for(const r of o)r.metadata[`${y.ARMINDOID}/isVisionLine`]!==void 0&&(r.metadata[`${y.EXTENSIONID}/isVisionLine`]=r.metadata[`${y.ARMINDOID}/isVisionLine`],delete r.metadata[`${y.ARMINDOID}/isVisionLine`]),r.metadata[`${y.ARMINDOID}/disabled`]!==void 0&&(r.metadata[`${y.EXTENSIONID}/disabled`]=r.metadata[`${y.ARMINDOID}/disabled`],delete r.metadata[`${y.ARMINDOID}/disabled`])})}},!1);var i;Oa.addEventListener("change",async e=>{if(Fn.disabled=!0,!e||!e.target)return;const t=e.target;if(!t.files)return;const n=t.files[0];if(n.type!=="text/javascript"&&n.type,n){var o=new FileReader;o.onload=function(r){if(!r||!r.target){Tt.innerText="Invalid import event";return}const l=r.target;if(!l.result){Tt.innerText="Unable to read imported file";return}const h=l.result;i=JSON.parse(h),i&&(i.walls&&i.walls.length||i.line_of_sight&&i.line_of_sight.length)?Fn.disabled=!1:Tt.innerText="Imported file has no walls"},o.readAsText(n)}else Tt.innerText="Failed to load file"}),Fn.addEventListener("click",async e=>{!e||!e.target||(e.target,pa(xa.value,i,Na.checked?0:Number.parseInt(ka.value),Wn.value,Tt))},!1)}function Kt(i){const e=i.filter(Bi);let t=!1;X.metadata&&(cr.checked=X.metadata[`${y.EXTENSIONID}/visionEnabled`]==!0,xt.checked=X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]==!0,ur.checked=X.metadata[`${y.EXTENSIONID}/persistenceEnabled`]==!0,xt.checked=X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]==!0,Hn.checked=X.metadata[`${y.EXTENSIONID}/fowEnabled`]==!0,dr.value=X.metadata[`${y.EXTENSIONID}/fowColor`]?X.metadata[`${y.EXTENSIONID}/fowColor`]:"#00000088",t=X.metadata[`${y.EXTENSIONID}/debug`]==!0,fr.value=X.metadata[`${y.EXTENSIONID}/quality`]),zt.style.display=t?"grid":"none",pr.style.display=xt.checked?"none":"",va.style.display=e.length>0?"none":"block",Qr(Hn.checked),co();const n=X.items.filter(w=>w.layer==="FOG"&&w.metadata[`${y.EXTENSIONID}/isBackgroundMap`]===!0),o=document.querySelectorAll(".fog-background-entry");for(const w of o){const g=w.id.slice(3);n.find(S=>S.id===g)===void 0&&w.remove()}for(const w of n)if(!document.querySelector(`#bg-${w.id}`)){const S=document.createElement("div");S.id=`bg-${w.id}`,S.className="fog-background-entry grid-3 grid-main",S.style.width="300",S.innerHTML=`<div class="token-name grid-2">${w.name}</div>
                <div><label title="Unlock this fog background and turn it back into a map"><input type="button" value="Unlock"></label></div>`,document.querySelector("#fog_background_list").appendChild(S),S.querySelector("input").addEventListener("click",async k=>{if(!k||!k.target)return;const O=k.target.parentElement.parentElement.parentElement.id.slice(3);await F.scene.items.updateItems(B=>B.id===O&&B.layer=="FOG"&&B.metadata[`${y.EXTENSIONID}/isBackgroundMap`]===!0,B=>{for(let T=0;T<B.length;T++)B[T].layer="MAP",B[T].disableHit=!1,B[T].locked=!1,B[T].visible=!0,delete B[T].metadata[`${y.EXTENSIONID}/isBackgroundMap`]})})}const r=document.querySelector("#fog_backgrounds");n.length==0?r.style.display="none":r.style.display="block";const l=document.getElementsByClassName("token-table-entry"),h=[];for(const w of l){const g=w.id.slice(3);e.find(S=>S.id===g)===void 0&&h.push(w)}for(const w of h)w.remove();for(const w of e){const g=document.getElementById(`tr-${w.id}`);if(g){const S=g.getElementsByClassName("token-name")[0],A=g.getElementsByClassName("token-vision-range")[0],k=g.getElementsByClassName("unlimited-vision")[0],q=g.getElementsByClassName("no-vision")[0];S&&(S.innerText=w.name),A&&!k.checked&&!q.checked&&(A.value=w.metadata[`${y.EXTENSIONID}/visionRange`]?w.metadata[`${y.EXTENSIONID}/visionRange`]:y.VISIONDEFAULT),k&&(k.checked=w.metadata[`${y.EXTENSIONID}/visionRange`]===0),q&&(q.checked=w.metadata[`${y.EXTENSIONID}/visionBlind`]),k.checked||q.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled")}else{const S=X.items.find(T=>T.id===w.id),A=document.createElement("tr");A.id=`tr-${S.id}`,A.className="token-table-entry",A.innerHTML=`<td class="token-name">${S.name}</td>
                               <td><input class="token-vision-range" type="number" value=${y.VISIONDEFAULT}><span class="unit">ft</span></td>
                               <td>
                                <div class="cbutton"><label title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span>&infin;</span></label></div>
                                <div class="cbutton"><label title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span>&#128294;</span></label></div>
                                <div class="cbutton"><label title="Disable vision on this token"><input type="checkbox" class="no-vision"><span>None</span></label></div>
                               </td>`,ma.appendChild(A);const k=A.getElementsByClassName("token-vision-range")[0],q=A.getElementsByClassName("unlimited-vision")[0],O=A.getElementsByClassName("torch-vision")[0],B=A.getElementsByClassName("no-vision")[0];k&&!q.checked&&!B.checked&&(k.value=w.metadata[`${y.EXTENSIONID}/visionRange`]?w.metadata[`${y.EXTENSIONID}/visionRange`]:y.VISIONDEFAULT),q&&(q.checked=w.metadata[`${y.EXTENSIONID}/visionRange`]===0),O&&(O.checked=w.metadata[`${y.EXTENSIONID}/visionTorch`]),B&&(B.checked=w.metadata[`${y.EXTENSIONID}/visionBlind`]),q.checked||B.checked?k.setAttribute("disabled","disabled"):k.removeAttribute("disabled"),k.addEventListener("change",async T=>{if(!T||!T.target)return;const P=X.items.find(R=>R.id===w.id),C=T.target,V=parseInt(C.value);V<0&&(C.value="0"),V>999&&(C.value="999"),await F.scene.items.updateItems([P],R=>{R[0].metadata[`${y.EXTENSIONID}/visionRange`]=V})},!1),q.addEventListener("click",async T=>{if(!T||!T.target)return;const P=X.items.find(R=>R.id===w.id);let C=0;T.target.checked?(k.setAttribute("disabled","disabled"),B.checked=!1):(C=parseInt(k.value),k.removeAttribute("disabled")),await F.scene.items.updateItems([P],R=>{R[0].metadata[`${y.EXTENSIONID}/visionRange`]=C})},!1),B.addEventListener("click",async T=>{if(!T||!T.target)return;const P=X.items.find(V=>V.id===w.id),C=T.target;C.checked?k.setAttribute("disabled","disabled"):k.removeAttribute("disabled"),await F.scene.items.updateItems([P],V=>{V[0].metadata[`${y.EXTENSIONID}/visionBlind`]=C.checked})},!1),O.addEventListener("click",async T=>{if(!T||!T.target)return;const P=X.items.find(V=>V.id===w.id),C=T.target;await F.scene.items.updateItems([P],V=>{V[0].metadata[`${y.EXTENSIONID}/visionTorch`]=C.checked})},!1),k.addEventListener("mousewheel",async()=>{})}}}function hr(){let i;return X.items.filter(Xi).length==0&&(i=It().width(X.gridDpi*30).height(X.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),i.metadata[`${y.EXTENSIONID}/isBackgroundImage`]=!0,i.id=y.GRIDID,X.items.push(i)),i}async function Mi(i){let e,t;[X.items,X.metadata,X.gridDpi,X.gridScale,e,t]=await Promise.all([F.scene.items.getItems(),F.scene.getMetadata(),F.scene.grid.getDpi(),F.scene.grid.getScale(),F.scene.fog.getFilled(),F.scene.fog.getColor()]),await F.scene.items.deleteItems(X.items.filter(mt).map(r=>r.id)),X.snap=!0,X.gridScale=X.gridScale.parsed.multiplier,X.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(X.items.filter(Lr).length==0){const r=X.items.filter(h=>h.layer=="MAP"&&h.type=="IMAGE"),l=r.map(h=>h.image.width*h.image.height/Math.pow(h.grid.dpi,2));n=r[l.indexOf(Math.max(...l))]}let o;if(X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]===void 0?(xt.checked=!0,await F.scene.setMetadata({[`${y.EXTENSIONID}/autodetectEnabled`]:!0})):X.metadata[`${y.EXTENSIONID}/autodetectEnabled`]===!1&&(o=hr()),X.metadata[`${y.EXTENSIONID}/sceneId`]===void 0)await F.scene.setMetadata({[`${y.EXTENSIONID}/sceneId`]:crypto.randomUUID()});else try{const r=X.metadata[`${y.EXTENSIONID}/sceneId`],l=localStorage.getItem(`${y.EXTENSIONID}/fogCache/${X.userId}/${r}`);if(l!==null&&X.metadata[`${y.EXTENSIONID}/persistenceEnabled`]===!0){const h=JSON.parse(l);console.log("unfreezing "+h.length+" fog paths from localStorage");const w=[];for(let g=0;g<h.length;g++){const S=Ot().commands(h[g].commands).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${y.EXTENSIONID}/isVisionFog`]:!0,[`${y.EXTENSIONID}/digest`]:h[g].digest}).build();S.zIndex=3,w.push(F.scene.local.addItems([S]))}await Promise.all(w)}}catch{}if(i=="GM"){o&&await F.scene.items.addItems([o]),wa.onclick=async()=>{await F.scene.items.updateItems([y.GRIDID],l=>{for(const h of l){const w=h;w.width=X.gridDpi*+Ia.value,w.height=X.gridDpi*+ya.value,w.scale={x:1,y:1}}})},po();const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await F.modal.open({id:y.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},Kt(X.items),rt({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),n!==void 0&&await F.scene.items.updateItems([n],l=>{l[0].metadata[`${y.EXTENSIONID}/isBackgroundImage`]=!0})}}async function Fi(){try{localStorage.setItem("STORAGECHECK","test")}catch{const e=document.getElementById("localStorageWarning");e.innerText="Local Storage disabled. Some features will not function."}}F.onReady(async()=>{const i=await F.theme.getTheme();Pi(i,document),await F.player.getRole().then(async e=>{e=="GM"?(X.role="GM",await Fi(),await Aa(),await eo(),await to(),await no(),await ua()):(Yn.innerHTML='Configuration is GM-Access only. <div id="localStorageWarning"></div>',await Fi(),await F.action.setHeight(90),await F.action.setWidth(320)),F.scene.fog.onChange(t=>{X.fog=t}),F.player.onChange(async t=>{const n=document.querySelectorAll(".token-table-entry");for(let o of n){let r=o.id.substring(3);t.selection!==void 0&&t.selection.includes(r)?o.classList.add("token-table-selected"):o.classList.remove("token-table-selected")}t.selection!==void 0&&t.selection.length===1&&fo(t.selection[0])}),F.scene.items.onChange(async t=>{const n=t;X.items=n,X.ready&&(e=="GM"&&(Kt(n),await Di(Wn)),await gt())}),X.userId=await F.player.getId(),X.players=await F.party.getPlayers(),F.party.onChange(async t=>{X.players=t,e==="PLAYER"?await la(t):ca()}),F.scene.grid.onChange(async t=>{X.gridDpi=t.dpi,X.gridScale=parseInt(t.scale),X.ready&&await gt()}),F.scene.onMetadataChange(async t=>{if(t[`${y.EXTENSIONID}/forceReset`]===!0){const n=await F.scene.local.getItems(Bn);F.scene.local.deleteItems(n.map(r=>r.id));const o=X.metadata[`${y.EXTENSIONID}/sceneId`];localStorage.removeItem(`${y.EXTENSIONID}/fogCache/${X.userId}/${o}`),gt(!0)}else X.metadata=t,X.ready&&await gt()}),F.scene.onReadyChange(async t=>{X.ready=t,t?(Mi(e),await gt()):e=="GM"&&Kt([])}),X.ready=await F.scene.isReady(),X.ready?(Mi(e),await gt(),e=="GM"&&await Di(Wn)):e=="GM"&&Kt([]),F.theme.onChange(t=>{Pi(t,document)})})});
