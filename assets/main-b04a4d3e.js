import{C as A,b as Lt,a as fi,O as z,c as st,d as zi}from"./constants-4214fcbb.js";var cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Ki(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var a=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return i[n]}})}),t}class Yi{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const H=new Yi;function Zi(i){return i.layer=="MAP"&&(i.metadata[`${A.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${A.ARMINDOID}/isBackgroundImage`])}function bn(i){return i.metadata[`${A.EXTENSIONID}/isVisionFog`]||i.metadata[`${A.ARMINDOID}/isVisionFog`]}function zn(i){return i.metadata[`${A.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${A.ARMINDOID}/isIndicatorRing`]}function Qi(i){return i.metadata[`${A.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${A.EXTENSIONID}/disabled`]||i.metadata[`${A.ARMINDOID}/isVisionLine`]&&!i.metadata[`${A.ARMINDOID}/disabled`]}function Ji(i){return i.layer=="CHARACTER"&&(i.metadata[`${A.EXTENSIONID}/hasVision`]||i.metadata[`${A.ARMINDOID}/hasVision`])}function er(i){return i.layer=="CHARACTER"&&(i.metadata[`${A.EXTENSIONID}/hasVision`]||i.metadata[`${A.ARMINDOID}/hasVision`])&&!i.metadata[`${A.EXTENSIONID}/visionBlind`]}function tr(i){return i.layer=="CHARACTER"&&i.createdUserId==H.userId&&(i.metadata[`${A.EXTENSIONID}/hasVision`]||i.metadata[`${A.ARMINDOID}/hasVision`])&&!i.metadata[`${A.EXTENSIONID}/visionBlind`]}function hi(i){return i.layer=="DRAWING"&&(i.metadata[`${A.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${A.ARMINDOID}/isBackgroundImage`])}var gi={exports:{}};const nr={},ir=Object.freeze(Object.defineProperty({__proto__:null,default:nr},Symbol.toStringTag,{value:"Module"})),dn=Ki(ir);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(a){a=a||{};var o;o||(o=typeof a<"u"?a:{});var u=Object.assign,w,S;o.ready=new Promise(function(s,r){w=s,S=r}),function(s){var r={};s.loadCmdsTypedArray=function(N){for(var U=0,q=0;q<N.length;q++)U+=N[q].length;if(r[U])var Y=r[U];else Y=new Float32Array(U),r[U]=Y;var ee=0;for(q=0;q<N.length;q++)for(var ce=0;ce<N[q].length;ce++){var me=N[q][ce];typeof me=="string"&&(me=s.SkBits2FloatUnsigned(parseInt(me))),Y[ee]=me,ee++}return N=s._malloc(Y.length*Y.BYTES_PER_ELEMENT),s.HEAPF32.set(Y,N/Y.BYTES_PER_ELEMENT),[N,U]},s.FromCmds=function(N){N=s.loadCmdsTypedArray(N);var U=s._FromCmds(N[0],N[1]);return s._free(N[0]),U};var l,p,v,T,j;s.cubicYFromX=function(N,U,q,Y,ee){return l&&p===N&&v===U&&T===q&&j===Y||(l&&l.delete(),l=new s._SkCubicMap([N,U],[q,Y]),p=N,v=U,T=q,j=Y),l.computeYFromX(ee)},s.cubicPtFromT=function(N,U,q,Y,ee){return l&&p===N&&v===U&&T===q&&j===Y||(l&&l.delete(),l=new s._SkCubicMap([N,U],[q,Y]),p=N,v=U,T=q,j=Y),l.computePtFromT(ee)}}(o),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var r=arguments[0];if(arguments.length===1)this._addPath(r,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var l=arguments[1];this._addPath(r,l.a,l.c,l.e,l.b,l.d,l.f,0,0,1)}else if(arguments.length===7)l=arguments,this._addPath(r,l[1],l[3],l[5],l[2],l[4],l[6],0,0,1);else if(arguments.length===10)l=arguments,this._addPath(r,l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(r,l,p,v,T,j){return this._arc(r,l,p,v,T,!!j),this},s.SkPath.prototype.arcTo=function(r,l,p,v,T){return this._arcTo(r,l,p,v,T),this},s.SkPath.prototype.bezierCurveTo=function(r,l,p,v,T,j){return this._cubicTo(r,l,p,v,T,j),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(r,l,p,v,T){return this._conicTo(r,l,p,v,T),this},s.SkPath.prototype.cubicTo=function(r,l,p,v,T,j){return this._cubicTo(r,l,p,v,T,j),this},s.SkPath.prototype.dash=function(r,l,p){return this._dash(r,l,p)?this:null},s.SkPath.prototype.ellipse=function(r,l,p,v,T,j,N,U){return this._ellipse(r,l,p,v,T,j,N,!!U),this},s.SkPath.prototype.lineTo=function(r,l){return this._lineTo(r,l),this},s.SkPath.prototype.moveTo=function(r,l){return this._moveTo(r,l),this},s.SkPath.prototype.op=function(r,l){return this._op(r,l)?this:null},s.SkPath.prototype.quadraticCurveTo=function(r,l,p,v){return this._quadTo(r,l,p,v),this},s.SkPath.prototype.quadTo=function(r,l,p,v){return this._quadTo(r,l,p,v),this},s.SkPath.prototype.rect=function(r,l,p,v){return this._rect(r,l,p,v),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(r){return r=r||{},r.width=r.width||1,r.miter_limit=r.miter_limit||4,r.cap=r.cap||s.StrokeCap.BUTT,r.join=r.join||s.StrokeJoin.MITER,this._stroke(r)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var r=arguments;this._transform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(r,l,p){return this._trim(r,l,!!p)?this:null}}}(o);var I=u({},o),P=typeof window=="object",x=typeof importScripts=="function",L="",Q,b,W,O,D,C;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(L=x?dn.dirname(L)+"/":__dirname+"/",C=()=>{D||(O=dn,D=dn)},Q=function(s,r){return C(),s=D.normalize(s),O.readFileSync(s,r?null:"utf8")},W=s=>(s=Q(s,!0),s.buffer||(s=new Uint8Array(s)),s),b=(s,r,l)=>{C(),s=D.normalize(s),O.readFile(s,function(p,v){p?l(p):r(v.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),o.inspect=function(){return"[Emscripten Module object]"}):(P||x)&&(x?L=self.location.href:typeof document<"u"&&document.currentScript&&(L=document.currentScript.src),n&&(L=n),L.indexOf("blob:")!==0?L=L.substr(0,L.replace(/[?#].*/,"").lastIndexOf("/")+1):L="",Q=s=>{var r=new XMLHttpRequest;return r.open("GET",s,!1),r.send(null),r.responseText},x&&(W=s=>{var r=new XMLHttpRequest;return r.open("GET",s,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),b=(s,r,l)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{p.status==200||p.status==0&&p.response?r(p.response):l()},p.onerror=l,p.send(null)});var F=o.print||console.log.bind(console),M=o.printErr||console.warn.bind(console);u(o,I),I=null;var J;o.wasmBinary&&(J=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&oe("no native wasm support detected");var y,E=!1,f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function g(s,r,l){var p=r+l;for(l=r;s[l]&&!(l>=p);)++l;if(16<l-r&&s.subarray&&f)return f.decode(s.subarray(r,l));for(p="";r<l;){var v=s[r++];if(v&128){var T=s[r++]&63;if((v&224)==192)p+=String.fromCharCode((v&31)<<6|T);else{var j=s[r++]&63;v=(v&240)==224?(v&15)<<12|T<<6|j:(v&7)<<18|T<<12|j<<6|s[r++]&63,65536>v?p+=String.fromCharCode(v):(v-=65536,p+=String.fromCharCode(55296|v>>10,56320|v&1023))}}else p+=String.fromCharCode(v)}return p}function d(s,r,l){var p=te;if(0<l){l=r+l-1;for(var v=0;v<s.length;++v){var T=s.charCodeAt(v);if(55296<=T&&57343>=T){var j=s.charCodeAt(++v);T=65536+((T&1023)<<10)|j&1023}if(127>=T){if(r>=l)break;p[r++]=T}else{if(2047>=T){if(r+1>=l)break;p[r++]=192|T>>6}else{if(65535>=T){if(r+2>=l)break;p[r++]=224|T>>12}else{if(r+3>=l)break;p[r++]=240|T>>18,p[r++]=128|T>>12&63}p[r++]=128|T>>6&63}p[r++]=128|T&63}}p[r]=0}}var _=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function k(s,r){for(var l=s>>1,p=l+r/2;!(l>=p)&&fe[l];)++l;if(l<<=1,32<l-s&&_)return _.decode(te.subarray(s,l));for(l="",p=0;!(p>=r/2);++p){var v=ae[s+2*p>>1];if(v==0)break;l+=String.fromCharCode(v)}return l}function ie(s,r,l){if(l===void 0&&(l=2147483647),2>l)return 0;l-=2;var p=r;l=l<2*s.length?l/2:s.length;for(var v=0;v<l;++v)ae[r>>1]=s.charCodeAt(v),r+=2;return ae[r>>1]=0,r-p}function ne(s){return 2*s.length}function R(s,r){for(var l=0,p="";!(l>=r/4);){var v=re[s+4*l>>2];if(v==0)break;++l,65536<=v?(v-=65536,p+=String.fromCharCode(55296|v>>10,56320|v&1023)):p+=String.fromCharCode(v)}return p}function X(s,r,l){if(l===void 0&&(l=2147483647),4>l)return 0;var p=r;l=p+l-4;for(var v=0;v<s.length;++v){var T=s.charCodeAt(v);if(55296<=T&&57343>=T){var j=s.charCodeAt(++v);T=65536+((T&1023)<<10)|j&1023}if(re[r>>2]=T,r+=4,r+4>l)break}return re[r>>2]=0,r-p}function se(s){for(var r=0,l=0;l<s.length;++l){var p=s.charCodeAt(l);55296<=p&&57343>=p&&++l,r+=4}return r}var he,Z,te,ae,fe,re,ge,be,$e;function Le(){var s=y.buffer;he=s,o.HEAP8=Z=new Int8Array(s),o.HEAP16=ae=new Int16Array(s),o.HEAP32=re=new Int32Array(s),o.HEAPU8=te=new Uint8Array(s),o.HEAPU16=fe=new Uint16Array(s),o.HEAPU32=ge=new Uint32Array(s),o.HEAPF32=be=new Float32Array(s),o.HEAPF64=$e=new Float64Array(s)}var G,c=[],h=[],m=[];function B(){var s=o.preRun.shift();c.unshift(s)}var V=0,K=null;o.preloadedImages={},o.preloadedAudios={};function oe(s){throw o.onAbort&&o.onAbort(s),s="Aborted("+s+")",M(s),E=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),S(s),s}function ye(){return ue.startsWith("data:application/octet-stream;base64,")}var ue;if(ue="pathkit.wasm",!ye()){var De=ue;ue=o.locateFile?o.locateFile(De,L):L+De}function Se(){var s=ue;try{if(s==ue&&J)return new Uint8Array(J);if(W)return W(s);throw"both async and sync fetching of the wasm failed"}catch(r){oe(r)}}function Te(){if(!J&&(P||x)){if(typeof fetch=="function"&&!ue.startsWith("file://"))return fetch(ue,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+ue+"'";return s.arrayBuffer()}).catch(function(){return Se()});if(b)return new Promise(function(s,r){b(ue,function(l){s(new Uint8Array(l))},r)})}return Promise.resolve().then(function(){return Se()})}function _e(s){for(;0<s.length;){var r=s.shift();if(typeof r=="function")r(o);else{var l=r.Wa;typeof l=="number"?r.xa===void 0?G.get(l)():G.get(l)(r.xa):l(r.xa===void 0?null:r.xa)}}}var ve={};function Ue(s){for(;s.length;){var r=s.pop();s.pop()(r)}}function We(s){return this.fromWireType(ge[s>>2])}var nt={},Ze={},mt={};function Cn(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var r=s.charCodeAt(0);return 48<=r&&57>=r?"_"+s:s}function qt(s,r){return s=Cn(s),function(){return r.apply(this,arguments)}}function zt(s){var r=Error,l=qt(s,function(p){this.name=s,this.message=p,p=Error(p).stack,p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(r.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},l}var xn=void 0;function yt(s){throw new xn(s)}function He(s,r,l){function p(N){N=l(N),N.length!==s.length&&yt("Mismatched type converter count");for(var U=0;U<s.length;++U)Xe(s[U],N[U])}s.forEach(function(N){mt[N]=r});var v=Array(r.length),T=[],j=0;r.forEach(function(N,U){Ze.hasOwnProperty(N)?v[U]=Ze[N]:(T.push(N),nt.hasOwnProperty(N)||(nt[N]=[]),nt[N].push(function(){v[U]=Ze[N],++j,j===T.length&&p(v)}))}),T.length===0&&p(v)}var vt={};function wt(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Nn=void 0;function Ee(s){for(var r="";te[s];)r+=Nn[te[s++]];return r}var it=void 0;function le(s){throw new it(s)}function Xe(s,r,l={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=r.name;if(s||le('type "'+p+'" must have a positive integer typeid pointer'),Ze.hasOwnProperty(s)){if(l.Qa)return;le("Cannot register type '"+p+"' twice")}Ze[s]=r,delete mt[s],nt.hasOwnProperty(s)&&(r=nt[s],delete nt[s],r.forEach(function(v){v()}))}function Kt(s){le(s.ea.ha.fa.name+" instance already deleted")}var Yt=!1;function Pn(){}function Dn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function at(s){return typeof FinalizationGroup>"u"?(at=r=>r,s):(Yt=new FinalizationGroup(function(r){for(var l=r.next();!l.done;l=r.next())l=l.value,l.ga?Dn(l):console.warn("object already deleted: "+l.ga)}),at=r=>(Yt.register(r,r.ea,r.ea),r),Pn=r=>{Yt.unregister(r.ea)},at(s))}var lt=void 0,ut=[];function Zt(){for(;ut.length;){var s=ut.pop();s.ea.pa=!1,s.delete()}}function Ke(){}var $n={};function Ln(s,r,l){if(s[r].ia===void 0){var p=s[r];s[r]=function(){return s[r].ia.hasOwnProperty(arguments.length)||le("Function '"+l+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[r].ia+")!"),s[r].ia[arguments.length].apply(this,arguments)},s[r].ia=[],s[r].ia[p.ua]=p}}function Qt(s,r,l){o.hasOwnProperty(s)?((l===void 0||o[s].ia!==void 0&&o[s].ia[l]!==void 0)&&le("Cannot register public name '"+s+"' twice"),Ln(o,s,s),o.hasOwnProperty(l)&&le("Cannot register multiple overloads of a function with the same number of arguments ("+l+")!"),o[s].ia[l]=r):(o[s]=r,l!==void 0&&(o[s].Xa=l))}function Di(s,r,l,p,v,T,j,N){this.name=s,this.constructor=r,this.qa=l,this.la=p,this.na=v,this.Oa=T,this.ta=j,this.La=N,this.Ta=[]}function Jt(s,r,l){for(;r!==l;)r.ta||le("Expected null or instance of "+l.name+", got an instance of "+r.name),s=r.ta(s),r=r.na;return s}function $i(s,r){return r===null?(this.Ba&&le("null is not a valid "+this.name),0):(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),Jt(r.ea.ga,r.ea.ha.fa,this.fa))}function Li(s,r){if(r===null){if(this.Ba&&le("null is not a valid "+this.name),this.wa){var l=this.sa();return s!==null&&s.push(this.la,l),l}return 0}if(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&r.ea.ha.va&&le("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name),l=Jt(r.ea.ga,r.ea.ha.fa,this.fa),this.wa)switch(r.ea.ka===void 0&&le("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:r.ea.ma===this?l=r.ea.ka:le("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name);break;case 1:l=r.ea.ka;break;case 2:if(r.ea.ma===this)l=r.ea.ka;else{var p=r.clone();l=this.Ua(l,Ye(function(){p.delete()})),s!==null&&s.push(this.la,l)}break;default:le("Unsupporting sharing policy")}return l}function Fi(s,r){return r===null?(this.Ba&&le("null is not a valid "+this.name),0):(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),r.ea.ha.va&&le("Cannot convert argument of type "+r.ea.ha.name+" to parameter type "+this.name),Jt(r.ea.ga,r.ea.ha.fa,this.fa))}function Fn(s,r,l){return r===l?s:l.na===void 0?null:(s=Fn(s,r,l.na),s===null?null:l.La(s))}var ct={};function Ri(s,r){for(r===void 0&&le("ptr should not be undefined");s.na;)r=s.ta(r),s=s.na;return ct[r]}function It(s,r){return r.ha&&r.ga||yt("makeClassHandle requires ptr and ptrType"),!!r.ma!=!!r.ka&&yt("Both smartPtrType and smartPtr must be specified"),r.count={value:1},at(Object.create(s,{ea:{value:r}}))}function Ge(s,r,l,p){this.name=s,this.fa=r,this.Ba=l,this.va=p,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,r.na!==void 0?this.toWireType=Li:(this.toWireType=p?$i:Fi,this.ja=null)}function Rn(s,r,l){o.hasOwnProperty(s)||yt("Replacing nonexistant public symbol"),o[s].ia!==void 0&&l!==void 0?o[s].ia[l]=r:(o[s]=r,o[s].ua=l)}function Mi(s,r){var l=[];return function(){l.length=arguments.length;for(var p=0;p<arguments.length;p++)l[p]=arguments[p];return s.includes("j")?(p=o["dynCall_"+s],p=l&&l.length?p.apply(null,[r].concat(l)):p.call(null,r)):p=G.get(r).apply(null,l),p}}function ke(s,r){s=Ee(s);var l=s.includes("j")?Mi(s,r):G.get(r);return typeof l!="function"&&le("unknown function pointer with signature "+s+": "+r),l}var Mn=void 0;function Bn(s){s=Hn(s);var r=Ee(s);return qe(s),r}function _t(s,r){function l(T){v[T]||Ze[T]||(mt[T]?mt[T].forEach(l):(p.push(T),v[T]=!0))}var p=[],v={};throw r.forEach(l),new Mn(s+": "+p.map(Bn).join([", "]))}function en(s,r){for(var l=[],p=0;p<s;p++)l.push(re[(r>>2)+p]);return l}function tn(s,r,l,p,v){var T=r.length;2>T&&le("argTypes array size mismatch! Must at least get return value and 'this' types!");var j=r[1]!==null&&l!==null,N=!1;for(l=1;l<r.length;++l)if(r[l]!==null&&r[l].ja===void 0){N=!0;break}var U=r[0].name!=="void",q=T-2,Y=Array(q),ee=[],ce=[];return function(){if(arguments.length!==q&&le("function "+s+" called with "+arguments.length+" arguments, expected "+q+" args!"),ce.length=0,ee.length=j?2:1,ee[0]=v,j){var me=r[1].toWireType(ce,this);ee[1]=me}for(var de=0;de<q;++de)Y[de]=r[de+2].toWireType(ce,arguments[de]),ee.push(Y[de]);if(de=p.apply(null,ee),N)Ue(ce);else for(var Ae=j?1:2;Ae<r.length;Ae++){var Ce=Ae===1?me:Y[Ae-2];r[Ae].ja!==null&&r[Ae].ja(Ce)}return me=U?r[0].fromWireType(de):void 0,me}}var nn=[],Ve=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Vn(s){4<s&&--Ve[s].Ca===0&&(Ve[s]=void 0,nn.push(s))}function rn(s){return s||le("Cannot use deleted val. handle = "+s),Ve[s].value}function Ye(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var r=nn.length?nn.pop():Ve.length;return Ve[r]={Ca:1,value:s},r}}function Bi(s,r,l){switch(r){case 0:return function(p){return this.fromWireType((l?Z:te)[p])};case 1:return function(p){return this.fromWireType((l?ae:fe)[p>>1])};case 2:return function(p){return this.fromWireType((l?re:ge)[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function bt(s,r){var l=Ze[s];return l===void 0&&le(r+" has unknown type "+Bn(s)),l}function on(s){if(s===null)return"null";var r=typeof s;return r==="object"||r==="array"||r==="function"?s.toString():""+s}function Vi(s,r){switch(r){case 2:return function(l){return this.fromWireType(be[l>>2])};case 3:return function(l){return this.fromWireType($e[l>>3])};default:throw new TypeError("Unknown float type: "+s)}}function ji(s,r,l){switch(r){case 0:return l?function(p){return Z[p]}:function(p){return te[p]};case 1:return l?function(p){return ae[p>>1]}:function(p){return fe[p>>1]};case 2:return l?function(p){return re[p>>2]}:function(p){return ge[p>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Ui={};function sn(s){var r=Ui[s];return r===void 0?Ee(s):r}var an=[];function jn(){function s(r){r.$$$embind_global$$$=r;var l=typeof $$$embind_global$$$=="object"&&r.$$$embind_global$$$===r;return l||delete r.$$$embind_global$$$,l}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof cn=="object"&&s(cn)?$$$embind_global$$$=cn:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Xi(s){var r=an.length;return an.push(s),r}function Wi(s,r){for(var l=Array(s),p=0;p<s;++p)l[p]=bt(re[(r>>2)+p],"parameter "+p);return l}var Un=[];function Hi(s){var r=Array(s+1);return function(l,p,v){r[0]=l;for(var T=0;T<s;++T){var j=bt(re[(p>>2)+T],"parameter "+T);r[T+1]=j.readValueFromPointer(v),v+=j.argPackAdvance}return l=new(l.bind.apply(l,r)),Ye(l)}}var Xn={},Gi=[null,[],[]];xn=o.InternalError=zt("InternalError");for(var Wn=Array(256),Et=0;256>Et;++Et)Wn[Et]=String.fromCharCode(Et);Nn=Wn,it=o.BindingError=zt("BindingError"),Ke.prototype.isAliasOf=function(s){if(!(this instanceof Ke&&s instanceof Ke))return!1;var r=this.ea.ha.fa,l=this.ea.ga,p=s.ea.ha.fa;for(s=s.ea.ga;r.na;)l=r.ta(l),r=r.na;for(;p.na;)s=p.ta(s),p=p.na;return r===p&&l===s},Ke.prototype.clone=function(){if(this.ea.ga||Kt(this),this.ea.ra)return this.ea.count.value+=1,this;var s=at,r=Object,l=r.create,p=Object.getPrototypeOf(this),v=this.ea;return s=s(l.call(r,p,{ea:{value:{count:v.count,pa:v.pa,ra:v.ra,ga:v.ga,ha:v.ha,ka:v.ka,ma:v.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},Ke.prototype.delete=function(){this.ea.ga||Kt(this),this.ea.pa&&!this.ea.ra&&le("Object already scheduled for deletion"),Pn(this),Dn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},Ke.prototype.isDeleted=function(){return!this.ea.ga},Ke.prototype.deleteLater=function(){return this.ea.ga||Kt(this),this.ea.pa&&!this.ea.ra&&le("Object already scheduled for deletion"),ut.push(this),ut.length===1&&lt&&lt(Zt),this.ea.pa=!0,this},Ge.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},Ge.prototype.Ga=function(s){this.la&&this.la(s)},Ge.prototype.argPackAdvance=8,Ge.prototype.readValueFromPointer=We,Ge.prototype.deleteObject=function(s){s!==null&&s.delete()},Ge.prototype.fromWireType=function(s){function r(){return this.wa?It(this.fa.qa,{ha:this.Sa,ga:l,ma:this,ka:s}):It(this.fa.qa,{ha:this,ga:s})}var l=this.Pa(s);if(!l)return this.Ga(s),null;var p=Ri(this.fa,l);if(p!==void 0)return p.ea.count.value===0?(p.ea.ga=l,p.ea.ka=s,p.clone()):(p=p.clone(),this.Ga(s),p);if(p=this.fa.Oa(l),p=$n[p],!p)return r.call(this);p=this.va?p.Ja:p.pointerType;var v=Fn(l,this.fa,p.fa);return v===null?r.call(this):this.wa?It(p.fa.qa,{ha:p,ga:v,ma:this,ka:s}):It(p.fa.qa,{ha:p,ga:v})},o.getInheritedInstanceCount=function(){return Object.keys(ct).length},o.getLiveInheritedInstances=function(){var s=[],r;for(r in ct)ct.hasOwnProperty(r)&&s.push(ct[r]);return s},o.flushPendingDeletes=Zt,o.setDelayFunction=function(s){lt=s,ut.length&&lt&&lt(Zt)},Mn=o.UnboundTypeError=zt("UnboundTypeError"),o.count_emval_handles=function(){for(var s=0,r=5;r<Ve.length;++r)Ve[r]!==void 0&&++s;return s},o.get_first_emval=function(){for(var s=5;s<Ve.length;++s)if(Ve[s]!==void 0)return Ve[s];return null};var qi={r:function(s){var r=ve[s];delete ve[s];var l=r.elements,p=l.length,v=l.map(function(N){return N.Aa}).concat(l.map(function(N){return N.Ea})),T=r.sa,j=r.la;He([s],v,function(N){return l.forEach(function(U,q){var Y=N[q],ee=U.ya,ce=U.za,me=N[q+p],de=U.Da,Ae=U.Fa;U.read=Ce=>Y.fromWireType(ee(ce,Ce)),U.write=(Ce,Qe)=>{var Fe=[];de(Ae,Ce,me.toWireType(Fe,Qe)),Ue(Fe)}}),[{name:r.name,fromWireType:function(U){for(var q=Array(p),Y=0;Y<p;++Y)q[Y]=l[Y].read(U);return j(U),q},toWireType:function(U,q){if(p!==q.length)throw new TypeError("Incorrect number of tuple elements for "+r.name+": expected="+p+", actual="+q.length);for(var Y=T(),ee=0;ee<p;++ee)l[ee].write(Y,q[ee]);return U!==null&&U.push(j,Y),Y},argPackAdvance:8,readValueFromPointer:We,ja:j}]})},u:function(s){var r=vt[s];delete vt[s];var l=r.sa,p=r.la,v=r.Ha,T=v.map(function(j){return j.Aa}).concat(v.map(function(j){return j.Ea}));He([s],T,function(j){var N={};return v.forEach(function(U,q){var Y=j[q],ee=U.ya,ce=U.za,me=j[q+v.length],de=U.Da,Ae=U.Fa;N[U.Na]={read:function(Ce){return Y.fromWireType(ee(ce,Ce))},write:function(Ce,Qe){var Fe=[];de(Ae,Ce,me.toWireType(Fe,Qe)),Ue(Fe)}}}),[{name:r.name,fromWireType:function(U){var q={},Y;for(Y in N)q[Y]=N[Y].read(U);return p(U),q},toWireType:function(U,q){for(var Y in N)if(!(Y in q))throw new TypeError('Missing field:  "'+Y+'"');var ee=l();for(Y in N)N[Y].write(ee,q[Y]);return U!==null&&U.push(p,ee),ee},argPackAdvance:8,readValueFromPointer:We,ja:p}]})},z:function(){},F:function(s,r,l,p,v){var T=wt(l);r=Ee(r),Xe(s,{name:r,fromWireType:function(j){return!!j},toWireType:function(j,N){return N?p:v},argPackAdvance:8,readValueFromPointer:function(j){if(l===1)var N=Z;else if(l===2)N=ae;else if(l===4)N=re;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(N[j>>T])},ja:null})},l:function(s,r,l,p,v,T,j,N,U,q,Y,ee,ce){Y=Ee(Y),T=ke(v,T),N&&(N=ke(j,N)),q&&(q=ke(U,q)),ce=ke(ee,ce);var me=Cn(Y);Qt(me,function(){_t("Cannot construct "+Y+" due to unbound types",[p])}),He([s,r,l],p?[p]:[],function(de){if(de=de[0],p)var Ae=de.fa,Ce=Ae.qa;else Ce=Ke.prototype;de=qt(me,function(){if(Object.getPrototypeOf(this)!==Qe)throw new it("Use 'new' to construct "+Y);if(Fe.oa===void 0)throw new it(Y+" has no accessible constructor");var qn=Fe.oa[arguments.length];if(qn===void 0)throw new it("Tried to invoke ctor of "+Y+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Fe.oa).toString()+") parameters instead!");return qn.apply(this,arguments)});var Qe=Object.create(Ce,{constructor:{value:de}});de.prototype=Qe;var Fe=new Di(Y,de,Qe,ce,Ae,T,N,q);Ae=new Ge(Y,Fe,!0,!1),Ce=new Ge(Y+"*",Fe,!1,!1);var Gn=new Ge(Y+" const*",Fe,!1,!0);return $n[s]={pointerType:Ce,Ja:Gn},Rn(me,de),[Ae,Ce,Gn]})},i:function(s,r,l,p,v,T){0<r||oe(void 0);var j=en(r,l);v=ke(p,v),He([],[s],function(N){N=N[0];var U="constructor "+N.name;if(N.fa.oa===void 0&&(N.fa.oa=[]),N.fa.oa[r-1]!==void 0)throw new it("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+N.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return N.fa.oa[r-1]=()=>{_t("Cannot construct "+N.name+" due to unbound types",j)},He([],j,function(q){return q.splice(1,0,null),N.fa.oa[r-1]=tn(U,q,null,v,T),[]}),[]})},a:function(s,r,l,p,v,T,j,N){var U=en(l,p);r=Ee(r),T=ke(v,T),He([],[s],function(q){function Y(){_t("Cannot call "+ee+" due to unbound types",U)}q=q[0];var ee=q.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),N&&q.fa.Ta.push(r);var ce=q.fa.qa,me=ce[r];return me===void 0||me.ia===void 0&&me.className!==q.name&&me.ua===l-2?(Y.ua=l-2,Y.className=q.name,ce[r]=Y):(Ln(ce,r,ee),ce[r].ia[l-2]=Y),He([],U,function(de){return de=tn(ee,de,q,T,j),ce[r].ia===void 0?(de.ua=l-2,ce[r]=de):ce[r].ia[l-2]=de,[]}),[]})},I:function(s,r,l){s=Ee(s),He([],[r],function(p){return p=p[0],o[s]=p.fromWireType(l),[]})},E:function(s,r){r=Ee(r),Xe(s,{name:r,fromWireType:function(l){var p=rn(l);return Vn(l),p},toWireType:function(l,p){return Ye(p)},argPackAdvance:8,readValueFromPointer:We,ja:null})},h:function(s,r,l,p){function v(){}l=wt(l),r=Ee(r),v.values={},Xe(s,{name:r,constructor:v,fromWireType:function(T){return this.constructor.values[T]},toWireType:function(T,j){return j.value},argPackAdvance:8,readValueFromPointer:Bi(r,l,p),ja:null}),Qt(r,v)},k:function(s,r,l){var p=bt(s,"enum");r=Ee(r),s=p.constructor,p=Object.create(p.constructor.prototype,{value:{value:l},constructor:{value:qt(p.name+"_"+r,function(){})}}),s.values[l]=p,s[r]=p},q:function(s,r,l){l=wt(l),r=Ee(r),Xe(s,{name:r,fromWireType:function(p){return p},toWireType:function(p,v){return v},argPackAdvance:8,readValueFromPointer:Vi(r,l),ja:null})},f:function(s,r,l,p,v,T){var j=en(r,l);s=Ee(s),v=ke(p,v),Qt(s,function(){_t("Cannot call "+s+" due to unbound types",j)},r-1),He([],j,function(N){return N=[N[0],null].concat(N.slice(1)),Rn(s,tn(s,N,null,v,T),r-1),[]})},e:function(s,r,l,p,v){r=Ee(r),v===-1&&(v=4294967295),v=wt(l);var T=N=>N;if(p===0){var j=32-8*l;T=N=>N<<j>>>j}l=r.includes("unsigned")?function(N,U){return U>>>0}:function(N,U){return U},Xe(s,{name:r,fromWireType:T,toWireType:l,argPackAdvance:8,readValueFromPointer:ji(r,v,p!==0),ja:null})},b:function(s,r,l){function p(T){T>>=2;var j=ge;return new v(he,j[T+1],j[T])}var v=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][r];l=Ee(l),Xe(s,{name:l,fromWireType:p,argPackAdvance:8,readValueFromPointer:p},{Qa:!0})},p:function(s,r){r=Ee(r);var l=r==="std::string";Xe(s,{name:r,fromWireType:function(p){var v=ge[p>>2];if(l)for(var T=p+4,j=0;j<=v;++j){var N=p+4+j;if(j==v||te[N]==0){if(T=T?g(te,T,N-T):"",U===void 0)var U=T;else U+=String.fromCharCode(0),U+=T;T=N+1}}else{for(U=Array(v),j=0;j<v;++j)U[j]=String.fromCharCode(te[p+4+j]);U=U.join("")}return qe(p),U},toWireType:function(p,v){v instanceof ArrayBuffer&&(v=new Uint8Array(v));var T=typeof v=="string";T||v instanceof Uint8Array||v instanceof Uint8ClampedArray||v instanceof Int8Array||le("Cannot pass non-string to std::string");var j=(l&&T?()=>{for(var q=0,Y=0;Y<v.length;++Y){var ee=v.charCodeAt(Y);55296<=ee&&57343>=ee&&(ee=65536+((ee&1023)<<10)|v.charCodeAt(++Y)&1023),127>=ee?++q:q=2047>=ee?q+2:65535>=ee?q+3:q+4}return q}:()=>v.length)(),N=ln(4+j+1);if(ge[N>>2]=j,l&&T)d(v,N+4,j+1);else if(T)for(T=0;T<j;++T){var U=v.charCodeAt(T);255<U&&(qe(N),le("String has UTF-16 code units that do not fit in 8 bits")),te[N+4+T]=U}else for(T=0;T<j;++T)te[N+4+T]=v[T];return p!==null&&p.push(qe,N),N},argPackAdvance:8,readValueFromPointer:We,ja:function(p){qe(p)}})},m:function(s,r,l){if(l=Ee(l),r===2)var p=k,v=ie,T=ne,j=()=>fe,N=1;else r===4&&(p=R,v=X,T=se,j=()=>ge,N=2);Xe(s,{name:l,fromWireType:function(U){for(var q=ge[U>>2],Y=j(),ee,ce=U+4,me=0;me<=q;++me){var de=U+4+me*r;(me==q||Y[de>>N]==0)&&(ce=p(ce,de-ce),ee===void 0?ee=ce:(ee+=String.fromCharCode(0),ee+=ce),ce=de+r)}return qe(U),ee},toWireType:function(U,q){typeof q!="string"&&le("Cannot pass non-string to C++ string type "+l);var Y=T(q),ee=ln(4+Y+r);return ge[ee>>2]=Y>>N,v(q,ee+4,Y+r),U!==null&&U.push(qe,ee),ee},argPackAdvance:8,readValueFromPointer:We,ja:function(U){qe(U)}})},t:function(s,r,l,p,v,T){ve[s]={name:Ee(r),sa:ke(l,p),la:ke(v,T),elements:[]}},s:function(s,r,l,p,v,T,j,N,U){ve[s].elements.push({Aa:r,ya:ke(l,p),za:v,Ea:T,Da:ke(j,N),Fa:U})},v:function(s,r,l,p,v,T){vt[s]={name:Ee(r),sa:ke(l,p),la:ke(v,T),Ha:[]}},j:function(s,r,l,p,v,T,j,N,U,q){vt[s].Ha.push({Na:Ee(r),Aa:l,ya:ke(p,v),za:T,Ea:j,Da:ke(N,U),Fa:q})},G:function(s,r){r=Ee(r),Xe(s,{Ra:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,r,l,p){s=an[s],r=rn(r),l=sn(l),s(r,l,null,p)},J:Vn,x:function(s){return s===0?Ye(jn()):(s=sn(s),Ye(jn()[s]))},c:function(s,r){var l=Wi(s,r),p=l[0];r=p.name+"_$"+l.slice(1).map(function(j){return j.name}).join("_")+"$";var v=Un[r];if(v!==void 0)return v;var T=Array(s-1);return v=Xi((j,N,U,q)=>{for(var Y=0,ee=0;ee<s-1;++ee)T[ee]=l[ee+1].readValueFromPointer(q+Y),Y+=l[ee+1].argPackAdvance;for(j=j[N].apply(j,T),ee=0;ee<s-1;++ee)l[ee+1].Ka&&l[ee+1].Ka(T[ee]);if(!p.Ra)return p.toWireType(U,j)}),Un[r]=v},n:function(s){4<s&&(Ve[s].Ca+=1)},w:function(s,r,l,p){s=rn(s);var v=Xn[r];return v||(v=Hi(r),Xn[r]=v),v(s,l,p)},K:function(){return Ye([])},D:function(s){return Ye(sn(s))},H:function(s,r){return s=bt(s,"_emval_take_value"),s=s.readValueFromPointer(r),Ye(s)},g:function(){oe("")},B:function(s){var r=te.length;if(s>>>=0,2147483648<s)return!1;for(var l=1;4>=l;l*=2){var p=r*(1+.2/l);p=Math.min(p,s+100663296),p=Math.max(s,p),0<p%65536&&(p+=65536-p%65536);e:{try{y.grow(Math.min(2147483648,p)-he.byteLength+65535>>>16),Le();var v=1;break e}catch{}v=void 0}if(v)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,r,l,p){for(var v=0,T=0;T<l;T++){var j=re[r>>2],N=re[r+4>>2];r+=8;for(var U=0;U<N;U++){var q=te[j+U],Y=Gi[s];q===0||q===10?((s===1?F:M)(g(Y,0)),Y.length=0):Y.push(q)}v+=N}return re[p>>2]=v,0},A:function(){}};(function(){function s(v){o.asm=v.exports,y=o.asm.L,Le(),G=o.asm._,h.unshift(o.asm.M),V--,o.monitorRunDependencies&&o.monitorRunDependencies(V),V==0&&K&&(v=K,K=null,v())}function r(v){s(v.instance)}function l(v){return Te().then(function(T){return WebAssembly.instantiate(T,p)}).then(function(T){return T}).then(v,function(T){M("failed to asynchronously prepare wasm: "+T),oe(T)})}var p={a:qi};if(V++,o.monitorRunDependencies&&o.monitorRunDependencies(V),o.instantiateWasm)try{return o.instantiateWasm(p,s)}catch(v){return M("Module.instantiateWasm callback failed with error: "+v),!1}return function(){return J||typeof WebAssembly.instantiateStreaming!="function"||ye()||ue.startsWith("file://")||typeof fetch!="function"?l(r):fetch(ue,{credentials:"same-origin"}).then(function(v){return WebAssembly.instantiateStreaming(v,p).then(r,function(T){return M("wasm streaming compile failed: "+T),M("falling back to ArrayBuffer instantiation"),l(r)})})}().catch(S),{}})(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.M).apply(null,arguments)},o.__Z6ToCmdsRK6SkPath=function(){return(o.__Z6ToCmdsRK6SkPath=o.asm.N).apply(null,arguments)},o.__Z8FromCmdsmi=function(){return(o.__Z8FromCmdsmi=o.asm.O).apply(null,arguments)},o.__Z7NewPathv=function(){return(o.__Z7NewPathv=o.asm.P).apply(null,arguments)},o.__Z8CopyPathRK6SkPath=function(){return(o.__Z8CopyPathRK6SkPath=o.asm.Q).apply(null,arguments)},o.__Z6EqualsRK6SkPathS1_=function(){return(o.__Z6EqualsRK6SkPathS1_=o.asm.R).apply(null,arguments)},o.__Z11ToSVGStringRK6SkPath=function(){return(o.__Z11ToSVGStringRK6SkPath=o.asm.S).apply(null,arguments)},o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=o.asm.T).apply(null,arguments)},o.__Z13ApplySimplifyR6SkPath=function(){return(o.__Z13ApplySimplifyR6SkPath=o.asm.U).apply(null,arguments)},o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=o.asm.V).apply(null,arguments)},o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=o.asm.W).apply(null,arguments)},o.__Z14ResolveBuilderR11SkOpBuilder=function(){return(o.__Z14ResolveBuilderR11SkOpBuilder=o.asm.X).apply(null,arguments)},o.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(o.__Z8ToCanvasRK6SkPathN10emscripten3valE=o.asm.Y).apply(null,arguments)},o.__Z8ToPath2DRK6SkPath=function(){return(o.__Z8ToPath2DRK6SkPath=o.asm.Z).apply(null,arguments)};var qe=o._free=function(){return(qe=o._free=o.asm.$).apply(null,arguments)},ln=o._malloc=function(){return(ln=o._malloc=o.asm.aa).apply(null,arguments)},Hn=o.___getTypeName=function(){return(Hn=o.___getTypeName=o.asm.ba).apply(null,arguments)};o.___embind_register_native_and_builtin_types=function(){return(o.___embind_register_native_and_builtin_types=o.asm.ca).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.da).apply(null,arguments)};var St;K=function s(){St||un(),St||(K=s)};function un(){function s(){if(!St&&(St=!0,o.calledRun=!0,!E)){if(_e(h),w(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var r=o.postRun.shift();m.unshift(r)}_e(m)}}if(!(0<V)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)B();_e(c),0<V||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),s()},1)):s())}}if(o.run=un,o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return un(),a.ready}})();i.exports=t})(gi);var rr=gi.exports;const or=pi(rr),sr="/assets/pathkit-1356ccfa.wasm";let Me=null,Ft="",Rt="",Mt="",Bt="";async function mi(){await z.scene.local.deleteItems([Bt,Ft,Rt,Mt]),Ft="",Rt="",Bt="",Mt="",await z.popover.close(A.POLYTOOLID)}async function yi(){if(!Me)return;const[i,e]=Me;e(),Me=null,mi()}async function vi(){if(!Me)return;const[i,e]=Me,t=i(n=>{n.visible=!1,n.metadata[`${A.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&z.scene.items.addItems([t]),e(),Me=null,mi()}async function ar(i,e){if(!e.transformer)if(Me)if(e.target&&(e.target.id===Ft||e.target.id===Rt))vi();else if(e.target&&(e.target.id===Bt||e.target.id===Mt))yi();else{const[t]=Me;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Lt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=fi().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Me=await z.interaction.startItemInteraction(n);const a=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),o=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Lt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await z.scene.local.addItems([t,a,o,u]),Ft=t.id,Rt=a.id,Bt=u.id,Mt=o.id,await z.popover.open({id:A.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function lr(i,e){if(!Me||e.transformer)return;const[t]=Me,n=Math.round(H.gridDpi/H.gridSnap),a=Math.round(e.pointerPosition.x/H.gridDpi)*H.gridDpi,o=Math.round(e.pointerPosition.y/H.gridDpi)*H.gridDpi,u=Math.abs(a-e.pointerPosition.x),w=Math.abs(o-e.pointerPosition.y);let S,I;u<=n?S=a:S=e.pointerPosition.x,w<=n?I=o:I=e.pointerPosition.y,t(P=>{P.points[P.points.length-1]=H.snap?{x:S,y:I}:e.pointerPosition})}function ur(i,e){Me&&(e.key=="Escape"?yi():e.key=="Enter"&&vi())}const fn={onToolClick:ar,onToolMove:lr,onKeyDown:ur};let Be=null,pt="",ht="",Vt="",jt="";async function wi(){await z.scene.local.deleteItems([jt,pt,ht,Vt]),pt="",ht="",jt="",Vt="",await z.popover.close(A.LINETOOLID)}async function Ii(){if(!Be)return;const[i,e]=Be;e(),Be=null,await wi()}async function _i(){if(!Be)return;const[i,e]=Be,t=i(n=>{n.visible=!1,n.metadata[`${A.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await z.scene.items.addItems([t]),e(),Be=null,await wi()}async function cr(i,e){if(!e.transformer)if(Be)if(e.target&&(e.target.id===pt||e.target.id===ht))await _i();else if(e.target&&(e.target.id===jt||e.target.id===Vt))await Ii();else{const[t]=Be;t(n=>{n.points.push(e.pointerPosition)}),await z.scene.local.updateItems(n=>n.id==ht||n.id==pt,n=>{for(const a of n)a.position=e.pointerPosition})}else{const t=Lt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=fi().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Be=await z.interaction.startItemInteraction(n);const a=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),o=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Lt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await z.scene.local.addItems([t,a,o,u]),pt=t.id,ht=a.id,jt=u.id,Vt=o.id,await z.popover.open({id:A.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function dr(i,e){if(!Be||e.transformer)return;const[t]=Be,n=Math.round(H.gridDpi/H.gridSnap),a=Math.round(e.pointerPosition.x/H.gridDpi)*H.gridDpi,o=Math.round(e.pointerPosition.y/H.gridDpi)*H.gridDpi,u=Math.abs(a-e.pointerPosition.x),w=Math.abs(o-e.pointerPosition.y);let S,I;u<=n?S=a:S=e.pointerPosition.x,w<=n?I=o:I=e.pointerPosition.y,t(P=>{P.points[P.points.length-1]=H.snap?{x:S,y:I}:e.pointerPosition})}function fr(i,e){Be&&(e.key=="Escape"?Ii():e.key=="Enter"&&_i())}const pn={onToolClick:cr,onToolMove:dr,onKeyDown:fr};class Kn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Ot(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var bi={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,a,o){function u(I,P){if(!a[I]){if(!n[I]){var x=typeof Ot=="function"&&Ot;if(!P&&x)return x(I,!0);if(w)return w(I,!0);throw new Error("Cannot find module '"+I+"'")}P=a[I]={exports:{}},n[I][0].call(P.exports,function(L){var Q=n[I][1][L];return u(Q||L)},P,P.exports,t,n,a,o)}return a[I].exports}for(var w=typeof Ot=="function"&&Ot,S=0;S<o.length;S++)u(o[S]);return u}({1:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){var b=t("crypto");function W(y,E){E=C(y,E);var f;return(f=E.algorithm!=="passthrough"?b.createHash(E.algorithm):new J).write===void 0&&(f.write=f.update,f.end=f.update),M(E,f).dispatch(y),f.update||f.end(""),f.digest?f.digest(E.encoding==="buffer"?void 0:E.encoding):(y=f.read(),E.encoding!=="buffer"?y.toString(E.encoding):y)}(a=n.exports=W).sha1=function(y){return W(y)},a.keys=function(y){return W(y,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(y){return W(y,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(y){return W(y,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var O=b.getHashes?b.getHashes().slice():["sha1","md5"],D=(O.push("passthrough"),["buffer","hex","binary","base64"]);function C(y,E){var f={};if(f.algorithm=(E=E||{}).algorithm||"sha1",f.encoding=E.encoding||"hex",f.excludeValues=!!E.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=E.ignoreUnknown===!0,f.respectType=E.respectType!==!1,f.respectFunctionNames=E.respectFunctionNames!==!1,f.respectFunctionProperties=E.respectFunctionProperties!==!1,f.unorderedArrays=E.unorderedArrays===!0,f.unorderedSets=E.unorderedSets!==!1,f.unorderedObjects=E.unorderedObjects!==!1,f.replacer=E.replacer||void 0,f.excludeKeys=E.excludeKeys||void 0,y===void 0)throw new Error("Object argument required.");for(var g=0;g<O.length;++g)O[g].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=O[g]);if(O.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+O.join(", "));if(D.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+D.join(", "));return f}function F(y){if(typeof y=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(y))!=null}function M(y,E,f){f=f||[];function g(d){return E.update?E.update(d,"utf8"):E.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=y.replacer?y.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var _,k=Object.prototype.toString.call(d),ie=/\[object (.*)\]/i.exec(k);if(ie=(ie=ie?ie[1]:"unknown:["+k+"]").toLowerCase(),0<=(k=f.indexOf(d)))return this.dispatch("[CIRCULAR:"+k+"]");if(f.push(d),w!==void 0&&w.isBuffer&&w.isBuffer(d))return g("buffer:"),g(d);if(ie==="object"||ie==="function"||ie==="asyncfunction")return k=Object.keys(d),y.unorderedObjects&&(k=k.sort()),y.respectType===!1||F(d)||k.splice(0,0,"prototype","__proto__","constructor"),y.excludeKeys&&(k=k.filter(function(ne){return!y.excludeKeys(ne)})),g("object:"+k.length+":"),_=this,k.forEach(function(ne){_.dispatch(ne),g(":"),y.excludeValues||_.dispatch(d[ne]),g(",")});if(!this["_"+ie]){if(y.ignoreUnknown)return g("["+ie+"]");throw new Error('Unknown object type "'+ie+'"')}this["_"+ie](d)},_array:function(d,ne){ne=ne!==void 0?ne:y.unorderedArrays!==!1;var k=this;if(g("array:"+d.length+":"),!ne||d.length<=1)return d.forEach(function(R){return k.dispatch(R)});var ie=[],ne=d.map(function(R){var X=new J,se=f.slice();return M(y,X,se).dispatch(R),ie=ie.concat(se.slice(f.length)),X.read().toString()});return f=f.concat(ie),ne.sort(),this._array(ne,!1)},_date:function(d){return g("date:"+d.toJSON())},_symbol:function(d){return g("symbol:"+d.toString())},_error:function(d){return g("error:"+d.toString())},_boolean:function(d){return g("bool:"+d.toString())},_string:function(d){g("string:"+d.length+":"),g(d.toString())},_function:function(d){g("fn:"),F(d)?this.dispatch("[native]"):this.dispatch(d.toString()),y.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),y.respectFunctionProperties&&this._object(d)},_number:function(d){return g("number:"+d.toString())},_xml:function(d){return g("xml:"+d.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(d){return g("regex:"+d.toString())},_uint8array:function(d){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return g("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return g("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return g("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return g("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return g("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return g("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return g("url:"+d.toString())},_map:function(d){return g("map:"),d=Array.from(d),this._array(d,y.unorderedSets!==!1)},_set:function(d){return g("set:"),d=Array.from(d),this._array(d,y.unorderedSets!==!1)},_file:function(d){return g("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(y.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(d){return g("bigint:"+d.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function J(){return{buf:"",write:function(y){this.buf+=y},end:function(y){this.buf+=y},read:function(){return this.buf}}}a.writeToStream=function(y,E,f){return f===void 0&&(f=E,E={}),M(E=C(y,E),f).dispatch(y)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){(function(b){var W=typeof Uint8Array<"u"?Uint8Array:Array,O="+".charCodeAt(0),D="/".charCodeAt(0),C="0".charCodeAt(0),F="a".charCodeAt(0),M="A".charCodeAt(0),J="-".charCodeAt(0),y="_".charCodeAt(0);function E(f){return f=f.charCodeAt(0),f===O||f===J?62:f===D||f===y?63:f<C?-1:f<C+10?f-C+26+26:f<M+26?f-M:f<F+26?f-F+26:void 0}b.toByteArray=function(f){var g,d;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var _=f.length,_=f.charAt(_-2)==="="?2:f.charAt(_-1)==="="?1:0,k=new W(3*f.length/4-_),ie=0<_?f.length-4:f.length,ne=0;function R(X){k[ne++]=X}for(g=0;g<ie;g+=4,0)R((16711680&(d=E(f.charAt(g))<<18|E(f.charAt(g+1))<<12|E(f.charAt(g+2))<<6|E(f.charAt(g+3))))>>16),R((65280&d)>>8),R(255&d);return _==2?R(255&(d=E(f.charAt(g))<<2|E(f.charAt(g+1))>>4)):_==1&&(R((d=E(f.charAt(g))<<10|E(f.charAt(g+1))<<4|E(f.charAt(g+2))>>2)>>8&255),R(255&d)),k},b.fromByteArray=function(f){var g,d,_,k,ie=f.length%3,ne="";function R(X){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(X)}for(g=0,_=f.length-ie;g<_;g+=3)d=(f[g]<<16)+(f[g+1]<<8)+f[g+2],ne+=R((k=d)>>18&63)+R(k>>12&63)+R(k>>6&63)+R(63&k);switch(ie){case 1:ne=(ne+=R((d=f[f.length-1])>>2))+R(d<<4&63)+"==";break;case 2:ne=(ne=(ne+=R((d=(f[f.length-2]<<8)+f[f.length-1])>>10))+R(d>>4&63))+R(d<<2&63)+"="}return ne}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,a){(function(o,u,O,S,I,P,x,L,Q){var b=t("base64-js"),W=t("ieee754");function O(c,h,m){if(!(this instanceof O))return new O(c,h,m);var B,V,K,oe,ye=typeof c;if(h==="base64"&&ye=="string")for(c=(oe=c).trim?oe.trim():oe.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(ye=="number")B=he(c);else if(ye=="string")B=O.byteLength(c,h);else{if(ye!="object")throw new Error("First argument needs to be a number, array or string.");B=he(c.length)}if(O._useTypedArrays?V=O._augment(new Uint8Array(B)):((V=this).length=B,V._isBuffer=!0),O._useTypedArrays&&typeof c.byteLength=="number")V._set(c);else if(Z(oe=c)||O.isBuffer(oe)||oe&&typeof oe=="object"&&typeof oe.length=="number")for(K=0;K<B;K++)O.isBuffer(c)?V[K]=c.readUInt8(K):V[K]=c[K];else if(ye=="string")V.write(c,0,h);else if(ye=="number"&&!O._useTypedArrays&&!m)for(K=0;K<B;K++)V[K]=0;return V}function D(c,h,m,B){return O._charsWritten=re(function(V){for(var K=[],oe=0;oe<V.length;oe++)K.push(255&V.charCodeAt(oe));return K}(h),c,m,B)}function C(c,h,m,B){return O._charsWritten=re(function(V){for(var K,oe,ye=[],ue=0;ue<V.length;ue++)oe=V.charCodeAt(ue),K=oe>>8,oe=oe%256,ye.push(oe),ye.push(K);return ye}(h),c,m,B)}function F(c,h,m){var B="";m=Math.min(c.length,m);for(var V=h;V<m;V++)B+=String.fromCharCode(c[V]);return B}function M(c,h,m,K){K||(G(typeof m=="boolean","missing or invalid endian"),G(h!=null,"missing offset"),G(h+1<c.length,"Trying to read beyond buffer length"));var V,K=c.length;if(!(K<=h))return m?(V=c[h],h+1<K&&(V|=c[h+1]<<8)):(V=c[h]<<8,h+1<K&&(V|=c[h+1])),V}function J(c,h,m,K){K||(G(typeof m=="boolean","missing or invalid endian"),G(h!=null,"missing offset"),G(h+3<c.length,"Trying to read beyond buffer length"));var V,K=c.length;if(!(K<=h))return m?(h+2<K&&(V=c[h+2]<<16),h+1<K&&(V|=c[h+1]<<8),V|=c[h],h+3<K&&(V+=c[h+3]<<24>>>0)):(h+1<K&&(V=c[h+1]<<16),h+2<K&&(V|=c[h+2]<<8),h+3<K&&(V|=c[h+3]),V+=c[h]<<24>>>0),V}function y(c,h,m,B){if(B||(G(typeof m=="boolean","missing or invalid endian"),G(h!=null,"missing offset"),G(h+1<c.length,"Trying to read beyond buffer length")),!(c.length<=h))return B=M(c,h,m,!0),32768&B?-1*(65535-B+1):B}function E(c,h,m,B){if(B||(G(typeof m=="boolean","missing or invalid endian"),G(h!=null,"missing offset"),G(h+3<c.length,"Trying to read beyond buffer length")),!(c.length<=h))return B=J(c,h,m,!0),2147483648&B?-1*(4294967295-B+1):B}function f(c,h,m,B){return B||(G(typeof m=="boolean","missing or invalid endian"),G(h+3<c.length,"Trying to read beyond buffer length")),W.read(c,h,m,23,4)}function g(c,h,m,B){return B||(G(typeof m=="boolean","missing or invalid endian"),G(h+7<c.length,"Trying to read beyond buffer length")),W.read(c,h,m,52,8)}function d(c,h,m,B,V){if(V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+1<c.length,"trying to write beyond buffer length"),be(h,65535)),V=c.length,!(V<=m))for(var K=0,oe=Math.min(V-m,2);K<oe;K++)c[m+K]=(h&255<<8*(B?K:1-K))>>>8*(B?K:1-K)}function _(c,h,m,B,V){if(V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+3<c.length,"trying to write beyond buffer length"),be(h,4294967295)),V=c.length,!(V<=m))for(var K=0,oe=Math.min(V-m,4);K<oe;K++)c[m+K]=h>>>8*(B?K:3-K)&255}function k(c,h,m,B,V){V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+1<c.length,"Trying to write beyond buffer length"),$e(h,32767,-32768)),c.length<=m||d(c,0<=h?h:65535+h+1,m,B,V)}function ie(c,h,m,B,V){V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+3<c.length,"Trying to write beyond buffer length"),$e(h,2147483647,-2147483648)),c.length<=m||_(c,0<=h?h:4294967295+h+1,m,B,V)}function ne(c,h,m,B,V){V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+3<c.length,"Trying to write beyond buffer length"),Le(h,34028234663852886e22,-34028234663852886e22)),c.length<=m||W.write(c,h,m,B,23,4)}function R(c,h,m,B,V){V||(G(h!=null,"missing value"),G(typeof B=="boolean","missing or invalid endian"),G(m!=null,"missing offset"),G(m+7<c.length,"Trying to write beyond buffer length"),Le(h,17976931348623157e292,-17976931348623157e292)),c.length<=m||W.write(c,h,m,B,52,8)}a.Buffer=O,a.SlowBuffer=O,a.INSPECT_MAX_BYTES=50,O.poolSize=8192,O._useTypedArrays=function(){try{var c=new ArrayBuffer(0),h=new Uint8Array(c);return h.foo=function(){return 42},h.foo()===42&&typeof h.subarray=="function"}catch{return!1}}(),O.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},O.isBuffer=function(c){return!(c==null||!c._isBuffer)},O.byteLength=function(c,h){var m;switch(c+="",h||"utf8"){case"hex":m=c.length/2;break;case"utf8":case"utf-8":m=ae(c).length;break;case"ascii":case"binary":case"raw":m=c.length;break;case"base64":m=fe(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=2*c.length;break;default:throw new Error("Unknown encoding")}return m},O.concat=function(c,h){if(G(Z(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new O(0);if(c.length===1)return c[0];if(typeof h!="number")for(V=h=0;V<c.length;V++)h+=c[V].length;for(var m=new O(h),B=0,V=0;V<c.length;V++){var K=c[V];K.copy(m,B),B+=K.length}return m},O.prototype.write=function(c,h,m,B){isFinite(h)?isFinite(m)||(B=m,m=void 0):(ue=B,B=h,h=m,m=ue),h=Number(h)||0;var V,K,oe,ye,ue=this.length-h;switch((!m||ue<(m=Number(m)))&&(m=ue),B=String(B||"utf8").toLowerCase()){case"hex":V=function(De,Se,Te,_e){Te=Number(Te)||0;var ve=De.length-Te;(!_e||ve<(_e=Number(_e)))&&(_e=ve),G((ve=Se.length)%2==0,"Invalid hex string"),ve/2<_e&&(_e=ve/2);for(var Ue=0;Ue<_e;Ue++){var We=parseInt(Se.substr(2*Ue,2),16);G(!isNaN(We),"Invalid hex string"),De[Te+Ue]=We}return O._charsWritten=2*Ue,Ue}(this,c,h,m);break;case"utf8":case"utf-8":K=this,oe=h,ye=m,V=O._charsWritten=re(ae(c),K,oe,ye);break;case"ascii":case"binary":V=D(this,c,h,m);break;case"base64":K=this,oe=h,ye=m,V=O._charsWritten=re(fe(c),K,oe,ye);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":V=C(this,c,h,m);break;default:throw new Error("Unknown encoding")}return V},O.prototype.toString=function(c,h,m){var B,V,K,oe,ye=this;if(c=String(c||"utf8").toLowerCase(),h=Number(h)||0,(m=m!==void 0?Number(m):ye.length)===h)return"";switch(c){case"hex":B=function(ue,De,Se){var Te=ue.length;(!De||De<0)&&(De=0),(!Se||Se<0||Te<Se)&&(Se=Te);for(var _e="",ve=De;ve<Se;ve++)_e+=te(ue[ve]);return _e}(ye,h,m);break;case"utf8":case"utf-8":B=function(ue,De,Se){var Te="",_e="";Se=Math.min(ue.length,Se);for(var ve=De;ve<Se;ve++)ue[ve]<=127?(Te+=ge(_e)+String.fromCharCode(ue[ve]),_e=""):_e+="%"+ue[ve].toString(16);return Te+ge(_e)}(ye,h,m);break;case"ascii":case"binary":B=F(ye,h,m);break;case"base64":V=ye,oe=m,B=(K=h)===0&&oe===V.length?b.fromByteArray(V):b.fromByteArray(V.slice(K,oe));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=function(ue,De,Se){for(var Te=ue.slice(De,Se),_e="",ve=0;ve<Te.length;ve+=2)_e+=String.fromCharCode(Te[ve]+256*Te[ve+1]);return _e}(ye,h,m);break;default:throw new Error("Unknown encoding")}return B},O.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},O.prototype.copy=function(c,h,m,B){if(h=h||0,(B=B||B===0?B:this.length)!==(m=m||0)&&c.length!==0&&this.length!==0){G(m<=B,"sourceEnd < sourceStart"),G(0<=h&&h<c.length,"targetStart out of bounds"),G(0<=m&&m<this.length,"sourceStart out of bounds"),G(0<=B&&B<=this.length,"sourceEnd out of bounds"),B>this.length&&(B=this.length);var V=(B=c.length-h<B-m?c.length-h+m:B)-m;if(V<100||!O._useTypedArrays)for(var K=0;K<V;K++)c[K+h]=this[K+m];else c._set(this.subarray(m,m+V),h)}},O.prototype.slice=function(c,h){var m=this.length;if(c=se(c,m,0),h=se(h,m,m),O._useTypedArrays)return O._augment(this.subarray(c,h));for(var B=h-c,V=new O(B,void 0,!0),K=0;K<B;K++)V[K]=this[K+c];return V},O.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},O.prototype.set=function(c,h){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,h)},O.prototype.readUInt8=function(c,h){if(h||(G(c!=null,"missing offset"),G(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},O.prototype.readUInt16LE=function(c,h){return M(this,c,!0,h)},O.prototype.readUInt16BE=function(c,h){return M(this,c,!1,h)},O.prototype.readUInt32LE=function(c,h){return J(this,c,!0,h)},O.prototype.readUInt32BE=function(c,h){return J(this,c,!1,h)},O.prototype.readInt8=function(c,h){if(h||(G(c!=null,"missing offset"),G(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},O.prototype.readInt16LE=function(c,h){return y(this,c,!0,h)},O.prototype.readInt16BE=function(c,h){return y(this,c,!1,h)},O.prototype.readInt32LE=function(c,h){return E(this,c,!0,h)},O.prototype.readInt32BE=function(c,h){return E(this,c,!1,h)},O.prototype.readFloatLE=function(c,h){return f(this,c,!0,h)},O.prototype.readFloatBE=function(c,h){return f(this,c,!1,h)},O.prototype.readDoubleLE=function(c,h){return g(this,c,!0,h)},O.prototype.readDoubleBE=function(c,h){return g(this,c,!1,h)},O.prototype.writeUInt8=function(c,h,m){m||(G(c!=null,"missing value"),G(h!=null,"missing offset"),G(h<this.length,"trying to write beyond buffer length"),be(c,255)),h>=this.length||(this[h]=c)},O.prototype.writeUInt16LE=function(c,h,m){d(this,c,h,!0,m)},O.prototype.writeUInt16BE=function(c,h,m){d(this,c,h,!1,m)},O.prototype.writeUInt32LE=function(c,h,m){_(this,c,h,!0,m)},O.prototype.writeUInt32BE=function(c,h,m){_(this,c,h,!1,m)},O.prototype.writeInt8=function(c,h,m){m||(G(c!=null,"missing value"),G(h!=null,"missing offset"),G(h<this.length,"Trying to write beyond buffer length"),$e(c,127,-128)),h>=this.length||(0<=c?this.writeUInt8(c,h,m):this.writeUInt8(255+c+1,h,m))},O.prototype.writeInt16LE=function(c,h,m){k(this,c,h,!0,m)},O.prototype.writeInt16BE=function(c,h,m){k(this,c,h,!1,m)},O.prototype.writeInt32LE=function(c,h,m){ie(this,c,h,!0,m)},O.prototype.writeInt32BE=function(c,h,m){ie(this,c,h,!1,m)},O.prototype.writeFloatLE=function(c,h,m){ne(this,c,h,!0,m)},O.prototype.writeFloatBE=function(c,h,m){ne(this,c,h,!1,m)},O.prototype.writeDoubleLE=function(c,h,m){R(this,c,h,!0,m)},O.prototype.writeDoubleBE=function(c,h,m){R(this,c,h,!1,m)},O.prototype.fill=function(c,h,m){if(h=h||0,m=m||this.length,G(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),G(h<=m,"end < start"),m!==h&&this.length!==0){G(0<=h&&h<this.length,"start out of bounds"),G(0<=m&&m<=this.length,"end out of bounds");for(var B=h;B<m;B++)this[B]=c}},O.prototype.inspect=function(){for(var c=[],h=this.length,m=0;m<h;m++)if(c[m]=te(this[m]),m===a.INSPECT_MAX_BYTES){c[m+1]="...";break}return"<Buffer "+c.join(" ")+">"},O.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(O._useTypedArrays)return new O(this).buffer;for(var c=new Uint8Array(this.length),h=0,m=c.length;h<m;h+=1)c[h]=this[h];return c.buffer};var X=O.prototype;function se(c,h,m){return typeof c!="number"?m:h<=(c=~~c)?h:0<=c||0<=(c+=h)?c:0}function he(c){return(c=~~Math.ceil(+c))<0?0:c}function Z(c){return(Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"})(c)}function te(c){return c<16?"0"+c.toString(16):c.toString(16)}function ae(c){for(var h=[],m=0;m<c.length;m++){var B=c.charCodeAt(m);if(B<=127)h.push(c.charCodeAt(m));else for(var V=m,K=(55296<=B&&B<=57343&&m++,encodeURIComponent(c.slice(V,m+1)).substr(1).split("%")),oe=0;oe<K.length;oe++)h.push(parseInt(K[oe],16))}return h}function fe(c){return b.toByteArray(c)}function re(c,h,m,B){for(var V=0;V<B&&!(V+m>=h.length||V>=c.length);V++)h[V+m]=c[V];return V}function ge(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function be(c,h){G(typeof c=="number","cannot write a non-number as a number"),G(0<=c,"specified a negative value for writing an unsigned value"),G(c<=h,"value is larger than maximum value for type"),G(Math.floor(c)===c,"value has a fractional component")}function $e(c,h,m){G(typeof c=="number","cannot write a non-number as a number"),G(c<=h,"value larger than maximum allowed value"),G(m<=c,"value smaller than minimum allowed value"),G(Math.floor(c)===c,"value has a fractional component")}function Le(c,h,m){G(typeof c=="number","cannot write a non-number as a number"),G(c<=h,"value larger than maximum allowed value"),G(m<=c,"value smaller than minimum allowed value")}function G(c,h){if(!c)throw new Error(h||"Failed assertion")}O._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=X.get,c.set=X.set,c.write=X.write,c.toString=X.toString,c.toLocaleString=X.toString,c.toJSON=X.toJSON,c.copy=X.copy,c.slice=X.slice,c.readUInt8=X.readUInt8,c.readUInt16LE=X.readUInt16LE,c.readUInt16BE=X.readUInt16BE,c.readUInt32LE=X.readUInt32LE,c.readUInt32BE=X.readUInt32BE,c.readInt8=X.readInt8,c.readInt16LE=X.readInt16LE,c.readInt16BE=X.readInt16BE,c.readInt32LE=X.readInt32LE,c.readInt32BE=X.readInt32BE,c.readFloatLE=X.readFloatLE,c.readFloatBE=X.readFloatBE,c.readDoubleLE=X.readDoubleLE,c.readDoubleBE=X.readDoubleBE,c.writeUInt8=X.writeUInt8,c.writeUInt16LE=X.writeUInt16LE,c.writeUInt16BE=X.writeUInt16BE,c.writeUInt32LE=X.writeUInt32LE,c.writeUInt32BE=X.writeUInt32BE,c.writeInt8=X.writeInt8,c.writeInt16LE=X.writeInt16LE,c.writeInt16BE=X.writeInt16BE,c.writeInt32LE=X.writeInt32LE,c.writeInt32BE=X.writeInt32BE,c.writeFloatLE=X.writeFloatLE,c.writeFloatBE=X.writeFloatBE,c.writeDoubleLE=X.writeDoubleLE,c.writeDoubleBE=X.writeDoubleBE,c.fill=X.fill,c.inspect=X.inspect,c.toArrayBuffer=X.toArrayBuffer,c}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,a){(function(o,u,b,S,I,P,x,L,Q){var b=t("buffer").Buffer,W=4,O=new b(W);O.fill(0),n.exports={hash:function(D,C,F,M){for(var J=C(function(d,_){d.length%W!=0&&(k=d.length+(W-d.length%W),d=b.concat([d,O],k));for(var k,ie=[],ne=_?d.readInt32BE:d.readInt32LE,R=0;R<d.length;R+=W)ie.push(ne.call(d,R));return ie}(D=b.isBuffer(D)?D:new b(D),M),8*D.length),C=M,y=new b(F),E=C?y.writeInt32BE:y.writeInt32LE,f=0;f<J.length;f++)E.call(y,J[f],4*f,!0);return y}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,a){(function(o,u,b,S,I,P,x,L,Q){var b=t("buffer").Buffer,W=t("./sha"),O=t("./sha256"),D=t("./rng"),C={sha1:W,sha256:O,md5:t("./md5")},F=64,M=new b(F);function J(d,_){var k=C[d=d||"sha1"],ie=[];return k||y("algorithm:",d,"is not yet supported"),{update:function(ne){return b.isBuffer(ne)||(ne=new b(ne)),ie.push(ne),ne.length,this},digest:function(ne){var R=b.concat(ie),R=_?function(X,se,he){b.isBuffer(se)||(se=new b(se)),b.isBuffer(he)||(he=new b(he)),se.length>F?se=X(se):se.length<F&&(se=b.concat([se,M],F));for(var Z=new b(F),te=new b(F),ae=0;ae<F;ae++)Z[ae]=54^se[ae],te[ae]=92^se[ae];return he=X(b.concat([Z,he])),X(b.concat([te,he]))}(k,_,R):k(R);return ie=null,ne?R.toString(ne):R}}}function y(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}M.fill(0),a.createHash=function(d){return J(d)},a.createHmac=J,a.randomBytes=function(d,_){if(!_||!_.call)return new b(D(d));try{_.call(this,void 0,new b(D(d)))}catch(k){_(k)}};var E,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(d){a[d]=function(){y("sorry,",d,"is not implemented yet")}};for(E in f)g(f[E])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){var b=t("./helpers");function W(y,E){y[E>>5]|=128<<E%32,y[14+(E+64>>>9<<4)]=E;for(var f=1732584193,g=-271733879,d=-1732584194,_=271733878,k=0;k<y.length;k+=16){var ie=f,ne=g,R=d,X=_,f=D(f,g,d,_,y[k+0],7,-680876936),_=D(_,f,g,d,y[k+1],12,-389564586),d=D(d,_,f,g,y[k+2],17,606105819),g=D(g,d,_,f,y[k+3],22,-1044525330);f=D(f,g,d,_,y[k+4],7,-176418897),_=D(_,f,g,d,y[k+5],12,1200080426),d=D(d,_,f,g,y[k+6],17,-1473231341),g=D(g,d,_,f,y[k+7],22,-45705983),f=D(f,g,d,_,y[k+8],7,1770035416),_=D(_,f,g,d,y[k+9],12,-1958414417),d=D(d,_,f,g,y[k+10],17,-42063),g=D(g,d,_,f,y[k+11],22,-1990404162),f=D(f,g,d,_,y[k+12],7,1804603682),_=D(_,f,g,d,y[k+13],12,-40341101),d=D(d,_,f,g,y[k+14],17,-1502002290),f=C(f,g=D(g,d,_,f,y[k+15],22,1236535329),d,_,y[k+1],5,-165796510),_=C(_,f,g,d,y[k+6],9,-1069501632),d=C(d,_,f,g,y[k+11],14,643717713),g=C(g,d,_,f,y[k+0],20,-373897302),f=C(f,g,d,_,y[k+5],5,-701558691),_=C(_,f,g,d,y[k+10],9,38016083),d=C(d,_,f,g,y[k+15],14,-660478335),g=C(g,d,_,f,y[k+4],20,-405537848),f=C(f,g,d,_,y[k+9],5,568446438),_=C(_,f,g,d,y[k+14],9,-1019803690),d=C(d,_,f,g,y[k+3],14,-187363961),g=C(g,d,_,f,y[k+8],20,1163531501),f=C(f,g,d,_,y[k+13],5,-1444681467),_=C(_,f,g,d,y[k+2],9,-51403784),d=C(d,_,f,g,y[k+7],14,1735328473),f=F(f,g=C(g,d,_,f,y[k+12],20,-1926607734),d,_,y[k+5],4,-378558),_=F(_,f,g,d,y[k+8],11,-2022574463),d=F(d,_,f,g,y[k+11],16,1839030562),g=F(g,d,_,f,y[k+14],23,-35309556),f=F(f,g,d,_,y[k+1],4,-1530992060),_=F(_,f,g,d,y[k+4],11,1272893353),d=F(d,_,f,g,y[k+7],16,-155497632),g=F(g,d,_,f,y[k+10],23,-1094730640),f=F(f,g,d,_,y[k+13],4,681279174),_=F(_,f,g,d,y[k+0],11,-358537222),d=F(d,_,f,g,y[k+3],16,-722521979),g=F(g,d,_,f,y[k+6],23,76029189),f=F(f,g,d,_,y[k+9],4,-640364487),_=F(_,f,g,d,y[k+12],11,-421815835),d=F(d,_,f,g,y[k+15],16,530742520),f=M(f,g=F(g,d,_,f,y[k+2],23,-995338651),d,_,y[k+0],6,-198630844),_=M(_,f,g,d,y[k+7],10,1126891415),d=M(d,_,f,g,y[k+14],15,-1416354905),g=M(g,d,_,f,y[k+5],21,-57434055),f=M(f,g,d,_,y[k+12],6,1700485571),_=M(_,f,g,d,y[k+3],10,-1894986606),d=M(d,_,f,g,y[k+10],15,-1051523),g=M(g,d,_,f,y[k+1],21,-2054922799),f=M(f,g,d,_,y[k+8],6,1873313359),_=M(_,f,g,d,y[k+15],10,-30611744),d=M(d,_,f,g,y[k+6],15,-1560198380),g=M(g,d,_,f,y[k+13],21,1309151649),f=M(f,g,d,_,y[k+4],6,-145523070),_=M(_,f,g,d,y[k+11],10,-1120210379),d=M(d,_,f,g,y[k+2],15,718787259),g=M(g,d,_,f,y[k+9],21,-343485551),f=J(f,ie),g=J(g,ne),d=J(d,R),_=J(_,X)}return Array(f,g,d,_)}function O(y,E,f,g,d,_){return J((E=J(J(E,y),J(g,_)))<<d|E>>>32-d,f)}function D(y,E,f,g,d,_,k){return O(E&f|~E&g,y,E,d,_,k)}function C(y,E,f,g,d,_,k){return O(E&g|f&~g,y,E,d,_,k)}function F(y,E,f,g,d,_,k){return O(E^f^g,y,E,d,_,k)}function M(y,E,f,g,d,_,k){return O(f^(E|~g),y,E,d,_,k)}function J(y,E){var f=(65535&y)+(65535&E);return(y>>16)+(E>>16)+(f>>16)<<16|65535&f}n.exports=function(y){return b.hash(y,W,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){n.exports=function(b){for(var W,O=new Array(b),D=0;D<b;D++)!(3&D)&&(W=4294967296*Math.random()),O[D]=W>>>((3&D)<<3)&255;return O}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){var b=t("./helpers");function W(C,F){C[F>>5]|=128<<24-F%32,C[15+(F+64>>9<<4)]=F;for(var M,J,y,E=Array(80),f=1732584193,g=-271733879,d=-1732584194,_=271733878,k=-1009589776,ie=0;ie<C.length;ie+=16){for(var ne=f,R=g,X=d,se=_,he=k,Z=0;Z<80;Z++){E[Z]=Z<16?C[ie+Z]:D(E[Z-3]^E[Z-8]^E[Z-14]^E[Z-16],1);var te=O(O(D(f,5),(te=g,J=d,y=_,(M=Z)<20?te&J|~te&y:!(M<40)&&M<60?te&J|te&y|J&y:te^J^y)),O(O(k,E[Z]),(M=Z)<20?1518500249:M<40?1859775393:M<60?-1894007588:-899497514)),k=_,_=d,d=D(g,30),g=f,f=te}f=O(f,ne),g=O(g,R),d=O(d,X),_=O(_,se),k=O(k,he)}return Array(f,g,d,_,k)}function O(C,F){var M=(65535&C)+(65535&F);return(C>>16)+(F>>16)+(M>>16)<<16|65535&M}function D(C,F){return C<<F|C>>>32-F}n.exports=function(C){return b.hash(C,W,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){function b(F,M){var J=(65535&F)+(65535&M);return(F>>16)+(M>>16)+(J>>16)<<16|65535&J}function W(F,M){var J,y=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),E=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);F[M>>5]|=128<<24-M%32,F[15+(M+64>>9<<4)]=M;for(var g,d,_=0;_<F.length;_+=16){for(var k=E[0],ie=E[1],ne=E[2],R=E[3],X=E[4],se=E[5],he=E[6],Z=E[7],te=0;te<64;te++)f[te]=te<16?F[te+_]:b(b(b((d=f[te-2],D(d,17)^D(d,19)^C(d,10)),f[te-7]),(d=f[te-15],D(d,7)^D(d,18)^C(d,3))),f[te-16]),J=b(b(b(b(Z,D(d=X,6)^D(d,11)^D(d,25)),X&se^~X&he),y[te]),f[te]),g=b(D(g=k,2)^D(g,13)^D(g,22),k&ie^k&ne^ie&ne),Z=he,he=se,se=X,X=b(R,J),R=ne,ne=ie,ie=k,k=b(J,g);E[0]=b(k,E[0]),E[1]=b(ie,E[1]),E[2]=b(ne,E[2]),E[3]=b(R,E[3]),E[4]=b(X,E[4]),E[5]=b(se,E[5]),E[6]=b(he,E[6]),E[7]=b(Z,E[7])}return E}var O=t("./helpers"),D=function(F,M){return F>>>M|F<<32-M},C=function(F,M){return F>>>M};n.exports=function(F){return O.hash(F,W,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){a.read=function(b,W,O,D,_){var F,M,J=8*_-D-1,y=(1<<J)-1,E=y>>1,f=-7,g=O?_-1:0,d=O?-1:1,_=b[W+g];for(g+=d,F=_&(1<<-f)-1,_>>=-f,f+=J;0<f;F=256*F+b[W+g],g+=d,f-=8);for(M=F&(1<<-f)-1,F>>=-f,f+=D;0<f;M=256*M+b[W+g],g+=d,f-=8);if(F===0)F=1-E;else{if(F===y)return M?NaN:1/0*(_?-1:1);M+=Math.pow(2,D),F-=E}return(_?-1:1)*M*Math.pow(2,F-D)},a.write=function(b,W,O,D,C,k){var M,J,y=8*k-C-1,E=(1<<y)-1,f=E>>1,g=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=D?0:k-1,_=D?1:-1,k=W<0||W===0&&1/W<0?1:0;for(W=Math.abs(W),isNaN(W)||W===1/0?(J=isNaN(W)?1:0,M=E):(M=Math.floor(Math.log(W)/Math.LN2),W*(D=Math.pow(2,-M))<1&&(M--,D*=2),2<=(W+=1<=M+f?g/D:g*Math.pow(2,1-f))*D&&(M++,D/=2),E<=M+f?(J=0,M=E):1<=M+f?(J=(W*D-1)*Math.pow(2,C),M+=f):(J=W*Math.pow(2,f-1)*Math.pow(2,C),M=0));8<=C;b[O+d]=255&J,d+=_,J/=256,C-=8);for(M=M<<C|J,y+=C;0<y;b[O+d]=255&M,d+=_,M/=256,y-=8);b[O+d-_]|=128*k}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,a){(function(o,u,w,S,I,P,x,L,Q){var b,W,O;function D(){}(o=n.exports={}).nextTick=(W=typeof window<"u"&&window.setImmediate,O=typeof window<"u"&&window.postMessage&&window.addEventListener,W?function(C){return window.setImmediate(C)}:O?(b=[],window.addEventListener("message",function(C){var F=C.source;F!==window&&F!==null||C.data!=="process-tick"||(C.stopPropagation(),0<b.length&&b.shift()())},!0),function(C){b.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=D,o.addListener=D,o.once=D,o.off=D,o.removeListener=D,o.removeAllListeners=D,o.emit=D,o.binding=function(C){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(bi);var pr=bi.exports;const Tt=pi(pr);class hr{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Tt(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Tt(e):String(e)]}getValue(e){return this.cache[this.useHash?Tt(e):String(e)]}isCached(e){return(this.useHash?Tt(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function kt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Yn(i,e){return i.x==e.x&&i.y==e.y}function At(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function hn(i,e){return(i%e+e)%e}async function gr(){await z.contextMenu.create({id:`${A.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${A.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${A.EXTENSIONID}/hasVision`]===void 0);await z.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${A.EXTENSIONID}/hasVision`]=!0,n.metadata[`${A.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${A.EXTENSIONID}/visionRange`]=A.VISIONDEFAULT)):delete n.metadata[`${A.EXTENSIONID}/hasVision`]})}}),await z.contextMenu.create({id:`${A.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${A.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await z.scene.items.getItemAttachments(e);await z.scene.items.updateItems(t,n=>{for(const a of n)e.includes(a.attachedTo)&&(a.metadata[`${A.EXTENSIONID}/hasVision`]&&a.layer=="CHARACTER"?delete a.metadata[`${A.EXTENSIONID}/hasVision`]:a.layer=="CHARACTER"&&(a.metadata[`${A.EXTENSIONID}/hasVision`]=!0,a.metadata[`${A.EXTENSIONID}/visionRange`]===void 0&&(a.metadata[`${A.EXTENSIONID}/visionRange`]=A.VISIONDEFAULT)))})}}}),await z.contextMenu.create({id:`${A.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${A.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${A.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${A.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${A.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await z.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${A.EXTENSIONID}/isVisionLine`]&&t.metadata[`${A.EXTENSIONID}/disabled`]?delete t.metadata[`${A.EXTENSIONID}/disabled`]:t.metadata[`${A.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${A.EXTENSIONID}/disabled`]=!0)})}}),await z.contextMenu.create({id:`${A.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${A.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${A.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${A.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${A.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${A.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${A.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${A.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await z.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${A.EXTENSIONID}/isVisionLine`]||t.metadata[`${A.ARMINDOID}/isVisionLine`])&&(t.metadata[`${A.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${A.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${A.EXTENSIONID}/oneSided`],delete t.metadata[`${A.ARMINDOID}/oneSided`]):(t.metadata[`${A.EXTENSIONID}/isVisionLine`]||t.metadata[`${A.ARMINDOID}/isVisionLine`])&&(t.metadata[`${A.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${A.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${A.EXTENSIONID}/oneSided`]="right",t.metadata[`${A.ARMINDOID}/oneSided`]="right"):(t.metadata[`${A.EXTENSIONID}/isVisionLine`]||t.metadata[`${A.ARMINDOID}/isVisionLine`])&&(t.metadata[`${A.EXTENSIONID}/oneSided`]="left",t.metadata[`${A.ARMINDOID}/oneSided`]="left")})}})}async function mr(){await z.tool.create({id:`${A.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await z.tool.activateTool(`${A.EXTENSIONID}/vision-tool`)}})}async function yr(){await z.tool.createMode({id:`${A.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${A.EXTENSIONID}/vision-tool`]}}],onToolClick:fn.onToolClick,onToolMove:fn.onToolMove,onKeyDown:fn.onKeyDown}),await z.tool.createMode({id:`${A.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${A.EXTENSIONID}/vision-tool`]}}],onToolClick:pn.onToolClick,onToolMove:pn.onToolMove,onKeyDown:pn.onKeyDown})}function vr(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);n&&(n.innerText=t)}}var je,tt=!1;const rt=new hr(!1);async function wr(i){if(tt=!0,je||(je=await or({locateFile:()=>sr})),!await z.scene.isReady()){rt.invalidate((R,X)=>X.shadowPath.delete()),tt=!1;return}const e=await z.scene.local.getItems(),{awaitTimer:t,computeTimer:n,metadata:a,size:o,offset:u,scale:w,visionShapes:S,tokensWithVision:I,invalidateCache:P}=i.detail,[x,L]=o;let Q=0,b=0;if(P&&rt.invalidate((R,X)=>X.shadowPath.delete()),n.resume(),!(a[`${A.EXTENSIONID}/visionEnabled`]===!0)||I.length==0){await z.scene.local.deleteItems(e.filter(bn).map(R=>R.id)),await z.scene.local.deleteItems(e.filter(zn).map(R=>R.id)),tt=!1;return}const O=[];for(const R of S)for(let X=0;X<R.points.length-1;X++)O.push({startPosition:{x:R.points[X].x*R.scale.x+R.position.x,y:R.points[X].y*R.scale.y+R.position.y},endPosition:{x:R.points[X+1].x*R.scale.x+R.position.x,y:R.points[X+1].y*R.scale.y+R.position.y},originalShape:R,oneSided:R.metadata[`${A.EXTENSIONID}/oneSided`]});const D=[],C=[],F=H.players.filter(R=>R.role=="GM");for(const R of I){const X=H.userId===R.createdUserId,se=F.some(Z=>Z.id==R.createdUserId);if(!X&&H.role!=="GM"&&!se)continue;const he=rt.getValue(R.id);if(D.push([]),!(he!==void 0&&Yn(he.player.position,R.position)))for(const Z of O){const te=(R.position.x-Z.startPosition.x)*(Z.endPosition.y-Z.startPosition.y)-(R.position.y-Z.startPosition.y)*(Z.endPosition.x-Z.startPosition.x);if(Z.oneSided!==void 0&&(Z.oneSided=="right"&&te>0||Z.oneSided=="left"&&te<0))continue;const ae={x:Z.startPosition.x-R.position.x,y:Z.startPosition.y-R.position.y},fe={x:Z.endPosition.x-R.position.x,y:Z.endPosition.y-R.position.y};var M={x:0,y:0},J={x:0,y:0},y=0,E=0,f=0,g=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ae.x<0?y=u[0]*w[0]:y=(x+u[0])*w[0],ae.y<0?E=u[1]*w[1]:E=(L+u[1])*w[1],fe.x<0?f=u[0]*w[0]:f=(x+u[0])*w[0],fe.y<0?g=u[1]*w[1]:g=(L+u[1])*w[1];const re=[],ge=[];if(ae.x!=0){const m=ae.y/ae.x,B=Z.startPosition.y-m*Z.startPosition.x;re.push({x:y,y:m*y+B})}if(ae.y!=0){const m=ae.x/ae.y,B=m*Z.startPosition.y-Z.startPosition.x;re.push({x:m*E-B,y:E})}if(fe.x!=0){const m=fe.y/fe.x,B=Z.endPosition.y-m*Z.endPosition.x;ge.push({x:f,y:m*f+B})}if(fe.y!=0){const m=fe.x/fe.y,B=m*Z.endPosition.y-Z.endPosition.x;ge.push({x:m*g-B,y:g})}re.length==1||kt(re[0],Z.startPosition)<kt(re[1],Z.startPosition)?M=re[0]:M=re[1],ge.length==1||kt(ge[0],Z.endPosition)<kt(ge[1],Z.endPosition)?J=ge[0]:J=ge[1];const be=[{x:Z.startPosition.x,y:Z.startPosition.y},M,J,{x:Z.endPosition.x,y:Z.endPosition.y}],$e=[{x:(x+u[0])*w[0],y:u[1]*w[1]},{x:(x+u[0])*w[0],y:(L+u[1])*w[1]},{x:u[0]*w[0],y:(L+u[1])*w[1]},{x:u[0]*w[0],y:u[1]*w[1]}],Le=[0,0];let G=0;for(const m of[M,J])At(m.y,u[1]*w[1])?Le[G]=0:At(m.y,(L+u[1])*w[1])?Le[G]=2:At(m.x,u[0]*w[0])?Le[G]=3:At(m.x,(x+u[0])*w[0])&&(Le[G]=1),G++;let c=Math.sign(te);c=c==0?1:-c;const h=c==1?Le[1]:hn(Le[1]-1,4);for(let m=Le[0]+(c==1?0:-1);hn(m,4)!=h;m+=c)be.splice(be.length-2,0,$e[hn(m,4)]);D[D.length-1].push({pointset:be,fromShape:Z.originalShape})}}if(D.length==0){tt=!1;return}const d={};for(let R=0;R<D.length;R++){const X=I[R];let se=rt.getValue(X.id);if(se!==void 0&&Yn(se.player.position,X.position)){d[R]=se.shadowPath.copy(),Q++;continue}b++;const he=D[R],Z=new je.SkOpBuilder,te=je.NewPath().rect(u[0],u[1],o[0],o[1]);Z.add(te,je.PathOp.UNION),te.delete();for(const fe of he){const re=fe.fromShape,ge=je.NewPath();ge.moveTo(fe.pointset[0].x,fe.pointset[0].y);for(let be=1;be<fe.pointset.length;be++)ge.lineTo(fe.pointset[be].x,fe.pointset[be].y);if(re.style.closed!=!1){const be=je.NewPath();be.moveTo(re.points[0].x*re.scale.x+re.position.x,re.points[0].y*re.scale.y+re.position.y);for(let $e=1;$e<re.points.length-1;$e++)be.lineTo(re.points[$e].x*re.scale.x+re.position.x,re.points[$e].y*re.scale.y+re.position.y);ge.op(be,je.PathOp.DIFFERENCE),be.delete()}Z.add(ge,je.PathOp.DIFFERENCE),ge.delete()}const ae=Z.resolve();if(!ae){console.error("Couldn't compute fog");return}if(Z.delete(),ae!==void 0){ae.simplify(),d[R]=ae;let fe=rt.getValue(X.id);fe!==void 0&&fe.shadowPath.delete(),rt.cacheValue(X.id,{shadowPath:ae.copy(),player:X})}}for(let R=0;R<I.length;R++){const X=I[R],se=X.metadata[`${A.EXTENSIONID}/visionRange`],he=H.userId===I[R].createdUserId,Z=F.some(te=>te.id==I[R].createdUserId);if(se){if(!he&&H.role!=="GM"&&!Z)continue;const te=H.gridDpi*(se/H.gridScale+.5),ae=je.NewPath().ellipse(X.position.x,X.position.y,te,te,0,0,2*Math.PI);d[R]?.op(ae,je.PathOp.INTERSECT),ae.delete();const fe=H.players.find(re=>re.id===X.createdUserId);if(fe&&H.role==="GM"){const re=st().strokeColor(fe.color).fillOpacity(0).position({x:X.position.x,y:X.position.y}).width(te*2).height(te*2).shapeType("CIRCLE").metadata({[`${A.EXTENSIONID}/isIndicatorRing`]:!0}).build();C.push(re)}}}const _=[];for(const R of Object.values(d))_.push({cmds:R.toCmds(),visible:!1,zIndex:3}),R.delete();n.pause(),t.resume();const k=[z.scene.local.deleteItems(e.filter(zn).map(R=>R.id)),z.scene.local.addItems(_.map(R=>{const X=zi().commands(R.cmds).locked(!0).visible(R.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${A.EXTENSIONID}/isVisionFog`]:!0}).build();return X.zIndex=R.zIndex,X})),z.scene.local.deleteItems(e.filter(bn).map(R=>R.id))];C.length>0&&k.push(z.scene.local.addItems(C)),H.fog.filled||k.push(z.scene.fog.setFilled(!0)),await Promise.all(k);const[ie,ne]=[t.stop(),n.stop()];vr({compute_time:`${ne} ms`,communication_time:`${ie} ms`,cache_hits:Q,cache_misses:b}),tt=!1}document.addEventListener("updateVision",wr);let gn,Zn,dt=[],Qn,mn;async function ft(){if(tt||!await z.scene.isReady())return;const[i,e]=[new Kn,new Kn];i.start(),i.pause(),e.start();const t=H.players.filter(O=>O.role=="GM"),n=H.items.filter(O=>O.layer=="CHARACTER"&&t.some(D=>O.createdUserId===D.id)&&(O.metadata[`${A.EXTENSIONID}/hasVision`]||O.metadata[`${A.ARMINDOID}/hasVision`])&&!O.metadata[`${A.EXTENSIONID}/visionBlind`]),a=H.role=="GM"?H.items.filter(er):H.items.filter(tr).concat(n),o=H.items.filter(Qi),u=H.items.filter(hi)?.[0],w=H.metadata[`${A.EXTENSIONID}/visionEnabled`]===!0;if(u===void 0)return;const S=[u.width*u.scale.x,u.height*u.scale.y],I=[u.scale.x,u.scale.y],P=[u.position.x,u.position.y];if(H.role=="GM"){const O=document.getElementById("mapHeight"),D=document.getElementById("mapWidth");D.value=(Math.round(S[0])/H.gridDpi).toString(),O.value=(Math.round(S[1])/H.gridDpi).toString()}const x=JSON.stringify(o),L=JSON.stringify(a),Q=JSON.stringify(u);if(Q==mn&&w==Qn&&gn==x&&Zn==L&&S[0]==dt[0]&&S[1]==dt[1])return;let b=!1;(Q!=mn||gn!=x||S[0]!=dt[0]||S[1]!=dt[1])&&(b=!0),mn=Q,Zn=L,gn=x,dt=S,Qn=w,e.pause();const W=new CustomEvent("updateVision",{detail:{awaitTimer:i,computeTimer:e,allItems:H.items,metadata:H.metadata,size:S,offset:P,scale:I,tokensWithVision:a,visionShapes:o,invalidateCache:b}});tt||document.dispatchEvent(W)}function yn(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class Ir{constructor(){this._events=void 0,this._events={}}on(e,t){yn(e,n=>{const a=this._events[n]||[];a.push(t),this._events[n]=a})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}yn(e,a=>{if(n===1){delete this._events[a];return}const o=this._events[a];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[a]=o)})}trigger(e,...t){var n=this;yn(e,a=>{const o=n._events[a];o!==void 0&&o.forEach(u=>{u.apply(n,t)})})}}function _r(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const a=this,o=[];if(Array.isArray(e))e.forEach(u=>{typeof u=="string"?o.push(u):(a.plugins.settings[u.name]=u.options,o.push(u.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(a.plugins.settings[t]=e[t],o.push(t));for(;n=o.shift();)a.require(n)}loadPlugin(e){var t=this,n=t.plugins,a=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=a.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Gt=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Er(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Ei=i=>{if(!br(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((a,o)=>{if(a===i[o-1]){t++;return}n(),e+=a,t=1}),n(),e},Si=i=>{let e=Tn(i);return Gt(e)},br=i=>new Set(i).size!==i.length,gt=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Er=i=>i.reduce((e,t)=>Math.max(e,Sr(t)),0),Sr=i=>Tn(i).length,Tn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Oi=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Oi(t).forEach(function(a){let o=a.slice(0);o[0]=i.charAt(0)+o[0],e.push(o),o=a.slice(0),o.unshift(i.charAt(0)),e.push(o)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Or=[[0,65535]],Tr="[̀-ͯ·ʾʼ]";let Ut,Ti;const kr=3,kn={},Jn={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in Jn){let e=Jn[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);kn[n]=i}}const Ar=new RegExp(Object.keys(kn).join("|")+"|"+Tr,"gu"),Cr=i=>{Ut===void 0&&(Ut=Dr(i||Or))},ei=(i,e="NFKD")=>i.normalize(e),Xt=i=>Tn(i).reduce((e,t)=>e+xr(t),""),xr=i=>(i=ei(i).toLowerCase().replace(Ar,e=>kn[e]||""),ei(i,"NFC"));function*Nr(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let a=String.fromCharCode(n),o=Xt(a);o!=a.toLowerCase()&&(o.length>kr||o.length!=0&&(yield{folded:o,composed:a,code_point:n}))}}const Pr=i=>{const e={},t=(n,a)=>{const o=e[n]||new Set,u=new RegExp("^"+Si(o)+"$","iu");a.match(u)||(o.add(gt(a)),e[n]=o)};for(let n of Nr(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},Dr=i=>{const e=Pr(i),t={};let n=[];for(let o in e){let u=e[o];u&&(t[o]=Si(u)),o.length>1&&n.push(gt(o))}n.sort((o,u)=>u.length-o.length);const a=Gt(n);return Ti=new RegExp("^"+a,"u"),t},$r=(i,e=1)=>{let t=0;return i=i.map(n=>(Ut[n]&&(t+=n.length),Ut[n]||n)),t>=e?Ei(i):""},Lr=(i,e=1)=>(e=Math.max(e,i.length-1),Gt(Oi(i).map(t=>$r(t,e)))),ti=(i,e=!0)=>{let t=i.length>1?1:0;return Gt(i.map(n=>{let a=[];const o=e?n.length():n.length()-1;for(let u=0;u<o;u++)a.push(Lr(n.substrs[u]||"",t));return Ei(a)}))},Fr=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const a=u=>{for(const w of n){if(w.start===u.start&&w.substr===u.substr)return!1;if(!(u.length==1||w.length==1)&&(u.start<w.start&&u.end>w.start||w.start<u.start&&w.end>u.start))return!0}return!1};if(!(t.parts.filter(a).length>0))return!0}return!1};class Wt{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new Wt,a=JSON.parse(JSON.stringify(this.parts)),o=a.pop();for(const S of a)n.add(S);let u=t.substr.substring(0,e-o.start),w=u.length;return n.add({start:o.start,end:o.start+w,length:w,substr:u}),n}}const Rr=i=>{Cr(),i=Xt(i);let e="",t=[new Wt];for(let n=0;n<i.length;n++){let o=i.substring(n).match(Ti);const u=i.substring(n,n+1),w=o?o[0]:null;let S=[],I=new Set;for(const P of t){const x=P.last();if(!x||x.length==1||x.end<=n)if(w){const L=w.length;P.add({start:n,end:n+L,length:L,substr:w}),I.add("1")}else P.add({start:n,end:n+1,length:1,substr:u}),I.add("2");else if(w){let L=P.clone(n,x);const Q=w.length;L.add({start:n,end:n+Q,length:Q,substr:w}),S.push(L)}else I.add("3")}if(S.length>0){S=S.sort((P,x)=>P.length()-x.length());for(let P of S)Fr(P,t)||t.push(P);continue}if(n>0&&I.size==1&&!I.has("3")){e+=ti(t,!1);let P=new Wt;const x=t[0];x&&P.add(x.last()),t=[P]}}return e+=ti(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Mr=(i,e)=>{if(i)return i[e]},Br=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},vn=(i,e,t)=>{var n,a;return!i||(i=i+"",e.regex==null)||(a=i.search(e.regex),a===-1)?0:(n=e.string.length/i.length,a===0&&(n+=.5),n*t)},wn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},Ne=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Vr=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=Xt(i+"").toLowerCase(),e=Xt(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class jr{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const a=[],o=e.split(/\s+/);var u;return n&&(u=new RegExp("^("+Object.keys(n).map(gt).join("|")+"):(.*)$")),o.forEach(w=>{let S,I=null,P=null;u&&(S=w.match(u))&&(I=S[1],w=S[2]),w.length>0&&(this.settings.diacritics?P=Rr(w)||null:P=gt(w),P&&t&&(P="\\b"+P)),a.push({string:w,regex:P?new RegExp(P,"iu"):null,field:I})}),a}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const a=e.options.fields,o=e.weights,u=a.length,w=e.getAttrFn;if(!u)return function(){return 1};const S=function(){return u===1?function(I,P){const x=a[0].field;return vn(w(P,x),I,o[x]||1)}:function(I,P){var x=0;if(I.field){const L=w(P,I.field);!I.regex&&L?x+=1/u:x+=vn(L,I,1)}else Ne(o,(L,Q)=>{x+=vn(w(P,Q),I,L)});return x/u}}();return n===1?function(I){return S(t[0],I)}:e.options.conjunction==="and"?function(I){var P,x=0;for(let L of t){if(P=S(L,I),P<=0)return 0;x+=P}return x/n}:function(I){var P=0;return Ne(t,x=>{P+=S(x,I)}),P/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const a=this,o=e.options,u=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof u=="function")return u.bind(this);const w=function(P,x){return P==="$score"?x.score:e.getAttrFn(a.items[x.id],P)};if(u)for(let I of u)(e.query||I.field!=="$score")&&n.push(I);if(e.query){t=!0;for(let I of n)if(I.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(I=>I.field!=="$score");return n.length?function(I,P){var x,L;for(let Q of n)if(L=Q.field,x=(Q.direction==="desc"?-1:1)*Vr(w(L,I),w(L,P)),x)return x;return 0}:null}prepareSearch(e,t){const n={};var a=Object.assign({},t);if(wn(a,"sort"),wn(a,"sort_empty"),a.fields){wn(a,"fields");const o=[];a.fields.forEach(u=>{typeof u=="string"&&(u={field:u,weight:1}),o.push(u),n[u.field]="weight"in u?u.weight:1}),a.fields=o}return{options:a,query:e.toLowerCase().trim(),tokens:this.tokenize(e,a.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:a.nesting?Br:Mr}}search(e,t){var n=this,a,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const u=t.score||n._getScoreFunction(o);e.length?Ne(n.items,(S,I)=>{a=u(S),(t.filter===!1||a>0)&&o.items.push({score:a,id:I})}):Ne(n.items,(S,I)=>{o.items.push({score:1,id:I})});const w=n._getSortFunction(o);return w&&o.items.sort(w),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const ot=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Oe=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(ki(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},ki=i=>typeof i=="string"&&i.indexOf("<")>-1,Ur=i=>i.replace(/['"\\]/g,"\\$&"),In=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Ct=(i,e)=>{Object.assign(i.style,e)},xe=(i,...e)=>{var t=Ai(e);i=Ci(i),i.map(n=>{t.map(a=>{n.classList.add(a)})})},ze=(i,...e)=>{var t=Ai(e);i=Ci(i),i.map(n=>{t.map(a=>{n.classList.remove(a)})})},Ai=i=>{var e=[];return ot(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ci=i=>(Array.isArray(i)||(i=[i]),i),Nt=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},ni=(i,e=0)=>e>0?i[i.length-1]:i[0],Xr=i=>Object.keys(i).length===0,Ht=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},we=(i,e)=>{ot(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},En=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Wr=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var u=o.data.match(e);if(u&&o.data.length>0){var w=document.createElement("span");w.className="highlight";var S=o.splitText(u.index);S.splitText(u[0].length);var I=S.cloneNode(!0);return w.appendChild(I),En(S,w),1}return 0},n=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(u=>{a(u)})},a=o=>o.nodeType===3?t(o):(n(o),0);a(i)},Hr=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Gr=65,qr=13,xi=27,Sn=37,zr=38,Ni=39,Kr=40,ii=8,Yr=46,On=9,Zr=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),xt=Zr?"metaKey":"ctrlKey";var ri={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Re=i=>typeof i>"u"||i===null?null:Pt(i),Pt=i=>typeof i=="boolean"?i?"1":"0":i+"",Dt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Qr=(i,e)=>{var t;return function(n,a){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[n]=!0,i.call(o,n,a)},e)}},oi=(i,e,t)=>{var n,a=i.trigger,o={};i.trigger=function(){var u=arguments[0];if(e.indexOf(u)!==-1)o[u]=arguments;else return a.apply(i,arguments)},t.apply(i,[]),i.trigger=a;for(n of e)n in o&&a.apply(i,o[n])},Jr=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),pe=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},Ie=(i,e,t,n)=>{i.addEventListener(e,t,n)},Je=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},_n=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},si=i=>i.replace(/[\\"']/g,"\\$&"),et=(i,e)=>{e&&i.append(e)};function ai(i,e){var t=Object.assign({},ri,e),n=t.dataAttr,a=t.labelField,o=t.valueField,u=t.disabledField,w=t.optgroupField,S=t.optgroupLabelField,I=t.optgroupValueField,P=i.tagName.toLowerCase(),x=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!x&&!t.allowEmptyOption){let W=i.querySelector('option[value=""]');W&&(x=W.textContent)}var L={placeholder:x,options:[],optgroups:[],items:[],maxItems:null},Q=()=>{var W,O=L.options,D={},C=1,F=y=>{var E=Object.assign({},y.dataset),f=n&&E[n];return typeof f=="string"&&f.length&&(E=Object.assign(E,JSON.parse(f))),E},M=(y,E)=>{var f=Re(y.value);if(f!=null&&!(!f&&!t.allowEmptyOption)){if(D.hasOwnProperty(f)){if(E){var g=D[f][w];g?Array.isArray(g)?g.push(E):D[f][w]=[g,E]:D[f][w]=E}}else{var d=F(y);d[a]=d[a]||y.textContent,d[o]=d[o]||f,d[u]=d[u]||y.disabled,d[w]=d[w]||E,d.$option=y,D[f]=d,O.push(d)}y.selected&&L.items.push(f)}},J=y=>{var E,f;f=F(y),f[S]=f[S]||y.getAttribute("label")||"",f[I]=f[I]||C++,f[u]=f[u]||y.disabled,L.optgroups.push(f),E=f[I],ot(y.children,g=>{M(g,E)})};L.maxItems=i.hasAttribute("multiple")?null:1,ot(i.children,y=>{W=y.tagName.toLowerCase(),W==="optgroup"?J(y):W==="option"&&M(y)})},b=()=>{const W=i.getAttribute(n);if(W)L.options=JSON.parse(W),ot(L.options,D=>{L.items.push(D[o])});else{var O=i.value.trim()||"";if(!t.allowEmptyOption&&!O.length)return;const D=O.split(t.delimiter);ot(D,C=>{const F={};F[a]=C,F[o]=C,L.options.push(F)}),L.items=D}};return P==="select"?Q():b(),Object.assign({},ri,L,e)}var li=0;class Pe extends _r(Ir){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],li++;var n,a=Oe(e);if(a.tomselect)throw new Error("Tom Select already initialized on this element");a.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(a,null);n=o.getPropertyValue("direction");const u=ai(a,t);this.settings=u,this.input=a,this.tabIndex=a.tabIndex||0,this.is_select_tag=a.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=_n(a,"tomselect-"+li),this.isRequired=a.required,this.sifter=new jr(this.options,{diacritics:u.diacritics}),u.mode=u.mode||(u.maxItems===1?"single":"multi"),typeof u.hideSelected!="boolean"&&(u.hideSelected=u.mode==="multi"),typeof u.hidePlaceholder!="boolean"&&(u.hidePlaceholder=u.mode!=="multi");var w=u.createFilter;typeof w!="function"&&(typeof w=="string"&&(w=new RegExp(w)),w instanceof RegExp?u.createFilter=O=>w.test(O):u.createFilter=O=>this.settings.duplicates||!this.options[O]),this.initializePlugins(u.plugins),this.setupCallbacks(),this.setupTemplates();const S=Oe("<div>"),I=Oe("<div>"),P=this._render("dropdown"),x=Oe('<div role="listbox" tabindex="-1">'),L=this.input.getAttribute("class")||"",Q=u.mode;var b;if(xe(S,u.wrapperClass,L,Q),xe(I,u.controlClass),et(S,I),xe(P,u.dropdownClass,Q),u.copyClassesToDropdown&&xe(P,L),xe(x,u.dropdownContentClass),et(P,x),Oe(u.dropdownParent||S).appendChild(P),ki(u.controlInput)){b=Oe(u.controlInput);var W=["autocorrect","autocapitalize","autocomplete"];Ne(W,O=>{a.getAttribute(O)&&we(b,{[O]:a.getAttribute(O)})}),b.tabIndex=-1,I.appendChild(b),this.focus_node=b}else u.controlInput?(b=Oe(u.controlInput),this.focus_node=b):(b=Oe("<input/>"),this.focus_node=I);this.wrapper=S,this.dropdown=P,this.dropdown_content=x,this.control=I,this.control_input=b,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,a=e.dropdown,o=e.dropdown_content,u=e.wrapper,w=e.control,S=e.input,I=e.focus_node,P={passive:!0},x=e.inputId+"-ts-dropdown";we(o,{id:x}),we(I,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":x});const L=_n(I,e.inputId+"-ts-control"),Q="label[for='"+Ur(e.inputId)+"']",b=document.querySelector(Q),W=e.focus.bind(e);if(b){Ie(b,"click",W),we(b,{for:L});const C=_n(b,e.inputId+"-ts-label");we(I,{"aria-labelledby":C}),we(o,{"aria-labelledby":C})}if(u.style.width=S.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");xe([u,a],C)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&we(S,{multiple:"multiple"}),t.placeholder&&we(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+gt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Qr(t.load,t.loadThrottle)),e.control_input.type=S.type,Ie(a,"mousemove",()=>{e.ignoreHover=!1}),Ie(a,"mouseenter",C=>{var F=Nt(C.target,"[data-selectable]",a);F&&e.onOptionHover(C,F)},{capture:!0}),Ie(a,"click",C=>{const F=Nt(C.target,"[data-selectable]");F&&(e.onOptionSelect(C,F),pe(C,!0))}),Ie(w,"click",C=>{var F=Nt(C.target,"[data-ts-item]",w);if(F&&e.onItemSelect(C,F)){pe(C,!0);return}n.value==""&&(e.onClick(),pe(C,!0))}),Ie(I,"keydown",C=>e.onKeyDown(C)),Ie(n,"keypress",C=>e.onKeyPress(C)),Ie(n,"input",C=>e.onInput(C)),Ie(I,"blur",C=>e.onBlur(C)),Ie(I,"focus",C=>e.onFocus(C)),Ie(n,"paste",C=>e.onPaste(C));const O=C=>{const F=C.composedPath()[0];if(!u.contains(F)&&!a.contains(F)){e.isFocused&&e.blur(),e.inputState();return}F==n&&e.isOpen?C.stopPropagation():pe(C,!0)},D=()=>{e.isOpen&&e.positionDropdown()};Ie(document,"mousedown",O),Ie(window,"scroll",D,P),Ie(window,"resize",D,P),this._destroy=()=>{document.removeEventListener("mousedown",O),window.removeEventListener("scroll",D),window.removeEventListener("resize",D),b&&b.removeEventListener("click",W)},this.revertSettings={innerHTML:S.innerHTML,tabIndex:S.tabIndex},S.tabIndex=-1,S.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Ie(S,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,S.disabled?e.disable():e.enable(),e.on("change",this.onChange),xe(S,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Ne(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,a={optgroup:o=>{let u=document.createElement("div");return u.className="optgroup",u.appendChild(o.options),u},optgroup_header:(o,u)=>'<div class="optgroup-header">'+u(o[n])+"</div>",option:(o,u)=>"<div>"+u(o[t])+"</div>",item:(o,u)=>"<div>"+u(o[t])+"</div>",option_create:(o,u)=>'<div class="create">Add <strong>'+u(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},a,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?ai(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){In(this.input,"input"),In(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){pe(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var a=n.trim().split(t.settings.splitOn);Ne(a,o=>{Re(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){pe(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),pe(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==On&&pe(e);return}switch(e.keyCode){case Gr:if(Je(xt,e)&&t.control_input.value==""){pe(e),t.selectAll();return}break;case xi:t.isOpen&&(pe(e,!0),t.close()),t.clearActiveItems();return;case Kr:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}pe(e);return;case zr:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}pe(e);return;case qr:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),pe(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&pe(e);return;case Sn:t.advanceSelection(-1,e);return;case Ni:t.advanceSelection(1,e);return;case On:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),pe(e)),t.settings.create&&t.createItem()&&pe(e));return;case ii:case Yr:t.deleteSelection(e);return}t.isInputHidden&&!Je(xt,e)&&pe(e)}onInput(e){var t=this;if(!t.isLocked){var n=t.inputValue();t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled){t.blur(),pe(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,a=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?a.createItem(null,()=>{a.settings.closeAfterSelect&&a.close()}):(n=t.dataset.value,typeof n<"u"&&(a.lastQuery=null,a.addItem(n),a.settings.closeAfterSelect&&a.close(),!a.settings.hideSelected&&e.type&&/click/.test(e.type)&&a.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(pe(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;xe(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||ze(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,In(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];oi(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,a,o,u,w,S,I;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.showInput();return}if(a=t&&t.type.toLowerCase(),a==="click"&&Je("shiftKey",t)&&n.activeItems.length){for(I=n.getLastActive(),u=Array.prototype.indexOf.call(n.control.children,I),w=Array.prototype.indexOf.call(n.control.children,e),u>w&&(S=u,u=w,w=S),o=u;o<=w;o++)e=n.control.children[o],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);pe(t)}else a==="click"&&Je(xt,t)||a==="keydown"&&Je("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.hideInput(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&ze(n,"last-active"),xe(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),ze(e,"active")}clearActiveItems(){ze(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,we(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),we(e,{"aria-selected":"true"}),xe(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,a=n.clientHeight,o=n.scrollTop||0,u=e.offsetHeight,w=e.getBoundingClientRect().top-n.getBoundingClientRect().top+o;w+u>a+o?this.scroll(w-a+u,t):w<o&&this.scroll(w,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(ze(this.activeOption,"active"),we(this.activeOption,{"aria-selected":null})),this.activeOption=null,we(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,Ne(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(we(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&we(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,a=this,o=this.getSearchOptions();if(a.settings.score&&(n=a.settings.score.call(a,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==a.lastQuery?(a.lastQuery=e,t=a.sifter.search(e,Object.assign(o,{score:n})),a.currentResults=t):t=Object.assign({},a.currentResults),a.settings.hideSelected&&(t.items=t.items.filter(u=>{let w=Re(u.id);return!(w&&a.items.indexOf(w)!==-1)})),t}refreshOptions(e=!0){var t,n,a,o,u,w,S,I,P,x;const L={},Q=[];var b=this,W=b.inputValue();const O=W===b.lastQuery||W==""&&b.lastQuery==null;var D=b.search(W),C=null,F=b.settings.shouldOpen||!1,M=b.dropdown_content;for(O&&(C=b.activeOption,C&&(P=C.closest("[data-group]"))),o=D.items.length,typeof b.settings.maxOptions=="number"&&(o=Math.min(o,b.settings.maxOptions)),o>0&&(F=!0),t=0;t<o;t++){let y=D.items[t];if(!y)continue;let E=y.id,f=b.options[E];if(f===void 0)continue;let g=Pt(E),d=b.getOption(g,!0);for(b.settings.hideSelected||d.classList.toggle("selected",b.items.includes(g)),u=f[b.settings.optgroupField]||"",w=Array.isArray(u)?u:[u],n=0,a=w&&w.length;n<a;n++){u=w[n],b.optgroups.hasOwnProperty(u)||(u="");let _=L[u];_===void 0&&(_=document.createDocumentFragment(),Q.push(u)),n>0&&(d=d.cloneNode(!0),we(d,{id:f.$id+"-clone-"+n,"aria-selected":null}),d.classList.add("ts-cloned"),ze(d,"active"),b.activeOption&&b.activeOption.dataset.value==E&&P&&P.dataset.group===u.toString()&&(C=d)),_.appendChild(d),L[u]=_}}b.settings.lockOptgroupOrder&&Q.sort((y,E)=>{const f=b.optgroups[y],g=b.optgroups[E],d=f&&f.$order||0,_=g&&g.$order||0;return d-_}),S=document.createDocumentFragment(),Ne(Q,y=>{let E=L[y];if(!E||!E.children.length)return;let f=b.optgroups[y];if(f!==void 0){let g=document.createDocumentFragment(),d=b.render("optgroup_header",f);et(g,d),et(g,E);let _=b.render("optgroup",{group:f,options:g});et(S,_)}else et(S,E)}),M.innerHTML="",et(M,S),b.settings.highlight&&(Hr(M),D.query.length&&D.tokens.length&&Ne(D.tokens,y=>{Wr(M,y.regex)}));var J=y=>{let E=b.render(y,{input:W});return E&&(F=!0,M.insertBefore(E,M.firstChild)),E};if(b.loading?J("loading"):b.settings.shouldLoad.call(b,W)?D.items.length===0&&J("no_results"):J("not_loading"),I=b.canCreate(W),I&&(x=J("option_create")),b.hasOptions=D.items.length>0||I,F){if(D.items.length>0){if(!C&&b.settings.mode==="single"&&b.items[0]!=null&&(C=b.getOption(b.items[0])),!M.contains(C)){let y=0;x&&!b.settings.addPrecedence&&(y=1),C=b.selectable()[y]}}else x&&(C=x);e&&!b.isOpen&&(b.open(),b.scrollToOption(C,"auto")),b.setActiveOption(C)}else b.clearActiveOption(),e&&b.isOpen&&b.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const a=Re(e[n.settings.valueField]);return a===null||n.options.hasOwnProperty(a)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[a]=e,n.lastQuery=null,t&&(n.userOptions[a]=t,n.trigger("option_add",a,e)),a)}addOptions(e,t=!1){Ne(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Re(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var a,o;const u=Re(e),w=Re(t[n.settings.valueField]);if(u===null)return;const S=n.options[u];if(S==null)return;if(typeof w!="string")throw new Error("Value must be set in option data");const I=n.getOption(u),P=n.getItem(u);if(t.$order=t.$order||S.$order,delete n.options[u],n.uncacheValue(w),n.options[w]=t,I){if(n.dropdown_content.contains(I)){const x=n._render("option",t);En(I,x),n.activeOption===I&&n.setActiveOption(x)}I.remove()}P&&(o=n.items.indexOf(u),o!==-1&&n.items.splice(o,1,w),a=n._render("item",t),P.classList.contains("active")&&xe(a,"active"),En(P,a)),n.lastQuery=null}removeOption(e,t){const n=this;e=Pt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};Ne(this.options,(a,o)=>{t(a,o)&&(n[o]=a)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Re(e);if(n===null)return null;const a=this.options[n];if(a!=null){if(a.$div)return a.$div;if(t)return this._render("option",a)}return null}getAdjacent(e,t,n="option"){var a=this,o;if(!e)return null;n=="item"?o=a.controlChildren():o=a.dropdown_content.querySelectorAll("[data-selectable]");for(let u=0;u<o.length;u++)if(o[u]==e)return t>0?o[u+1]:o[u-1];return null}getItem(e){if(typeof e=="object")return e;var t=Re(e);return t!==null?this.control.querySelector(`[data-value="${si(t)}"]`):null}addItems(e,t){var n=this,a=Array.isArray(e)?e:[e];a=a.filter(u=>n.items.indexOf(u)===-1);const o=a[a.length-1];a.forEach(u=>{n.isPending=u!==o,n.addItem(u,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];oi(this,n,()=>{var a,o;const u=this,w=u.settings.mode,S=Re(e);if(!(S&&u.items.indexOf(S)!==-1&&(w==="single"&&u.close(),w==="single"||!u.settings.duplicates))&&!(S===null||!u.options.hasOwnProperty(S))&&(w==="single"&&u.clear(t),!(w==="multi"&&u.isFull()))){if(a=u._render("item",u.options[S]),u.control.contains(a)&&(a=a.cloneNode(!0)),o=u.isFull(),u.items.splice(u.caretPos,0,S),u.insertAtCaret(a),u.isSetup){if(!u.isPending&&u.settings.hideSelected){let I=u.getOption(S),P=u.getAdjacent(I,1);P&&u.setActiveOption(P)}!u.isPending&&!u.settings.closeAfterSelect&&u.refreshOptions(u.isFocused&&w!=="single"),u.settings.closeAfterSelect!=!1&&u.isFull()?u.close():u.isPending||u.positionDropdown(),u.trigger("item_add",S,a),u.isPending||u.updateOriginalInput({silent:t})}(!u.isPending||!o&&u.isFull())&&(u.inputState(),u.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var a,o;const u=e.dataset.value;a=Ht(e),e.remove(),e.classList.contains("active")&&(o=n.activeItems.indexOf(e),n.activeItems.splice(o,1),ze(e,"active")),n.items.splice(a,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(u)&&n.removeOption(u,t),a<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",u,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,a=n.caretPos,o;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var u=!1,w=S=>{if(n.unlock(),!S||typeof S!="object")return t();var I=Re(S[n.settings.valueField]);if(typeof I!="string")return t();n.setTextboxValue(),n.addOption(S,!0),n.setCaret(a),n.addItem(I),t(S),u=!0};return typeof n.settings.create=="function"?o=n.settings.create.call(this,e,w):o={[n.settings.labelField]:e,[n.settings.valueField]:e},u||w(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const a=e.wrapper.classList;a.toggle("focus",e.isFocused),a.toggle("disabled",e.isDisabled),a.toggle("required",e.isRequired),a.toggle("invalid",!e.isValid),a.toggle("locked",n),a.toggle("full",t),a.toggle("input-active",e.isFocused&&!e.isInputHidden),a.toggle("dropdown-active",e.isOpen),a.toggle("has-options",Xr(e.options)),a.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,a;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let S=function(I,P,x){return I||(I=Oe('<option value="'+Dt(P)+'">'+Dt(x)+"</option>")),I!=o&&t.input.append(I),u.push(I),(I!=o||w>0)&&(I.selected=!0),I};const u=[],w=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(I=>{I.selected=!1}),t.items.length==0&&t.settings.mode=="single"?S(o,"",""):t.items.forEach(I=>{if(n=t.options[I],a=n[t.settings.labelField]||"",u.includes(n.$option)){const P=t.input.querySelector(`option[value="${si(I)}"]:not(:checked)`);S(P,I,a)}else n.$option=S(n.$option,I,a)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,we(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Ct(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Ct(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.hideInput()),t.isOpen=!1,we(t.focus_node,{"aria-expanded":"false"}),Ct(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,a=t.left+window.scrollX;Ct(this.dropdown,{width:t.width+"px",top:n+"px",left:a+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();Ne(n,a=>{t.removeItem(a,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,a=t.control;a.insertBefore(e,a.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,a,o,u=this;t=e&&e.keyCode===ii?-1:1,n=Jr(u.control_input);const w=[];if(u.activeItems.length)o=ni(u.activeItems,t),a=Ht(o),t>0&&a++,Ne(u.activeItems,S=>w.push(S));else if((u.isFocused||u.settings.mode==="single")&&u.items.length){const S=u.controlChildren();let I;t<0&&n.start===0&&n.length===0?I=S[u.caretPos-1]:t>0&&n.start===u.inputValue().length&&(I=S[u.caretPos]),I!==void 0&&w.push(I)}if(!u.shouldDelete(w,e))return!1;for(pe(e,!0),typeof a<"u"&&u.setCaret(a);w.length;)u.removeItem(w.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(a=>a.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,a,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(Je(xt,t)||Je("shiftKey",t)?(n=o.getLastActive(e),n?n.classList.contains("active")?a=o.getAdjacent(n,e,"item"):a=n:e>0?a=o.control_input.nextElementSibling:a=o.control_input.previousElementSibling,a&&(a.classList.contains("active")&&o.removeActiveItem(n),o.setActiveItemClass(a))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return ni(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,ze(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,a;const o=this;if(typeof this.settings.render[e]!="function"||(a=o.settings.render[e].call(this,t,Dt),!a))return null;if(a=Oe(a),e==="option"||e==="option_create"?t[o.settings.disabledField]?we(a,{"aria-disabled":"true"}):we(a,{"data-selectable":""}):e==="optgroup"&&(n=t.group[o.settings.optgroupValueField],we(a,{"data-group":n}),t.group[o.settings.disabledField]&&we(a,{"data-disabled":""})),e==="option"||e==="item"){const u=Pt(t[o.settings.valueField]);we(a,{"data-value":u}),e==="item"?(xe(a,o.settings.itemClass),we(a,{"data-ts-item":""})):(xe(a,o.settings.optionClass),we(a,{role:"option",id:t.$id}),t.$div=a,o.options[u]=t)}return a}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){Ne(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var a=this,o=a[t];a[t]=function(){var u,w;return e==="after"&&(u=o.apply(a,arguments)),w=n.apply(a,arguments),e==="instead"?w:(e==="before"&&(u=o.apply(a,arguments)),u)}}}function eo(){Ie(this.input,"change",()=>{this.sync()})}function to(){var i=this,e=i.onOptionSelect;i.settings.hideSelected=!1;var t=function(a){setTimeout(()=>{var o=a.querySelector("input");o instanceof HTMLInputElement&&(a.classList.contains("selected")?o.checked=!0:o.checked=!1)},1)};i.hook("after","setupTemplates",()=>{var n=i.settings.render.option;i.settings.render.option=(a,o)=>{var u=Oe(n.call(i,a,o)),w=document.createElement("input");w.addEventListener("click",function(I){pe(I)}),w.type="checkbox";const S=Re(a[i.settings.valueField]);return S&&i.items.indexOf(S)>-1&&(w.checked=!0),u.prepend(w),u}}),i.on("item_remove",n=>{var a=i.getOption(n);a&&(a.classList.remove("selected"),t(a))}),i.on("item_add",n=>{var a=i.getOption(n);a&&t(a)}),i.hook("instead","onOptionSelect",(n,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),i.removeItem(a.dataset.value),i.refreshOptions(),pe(n,!0);return}e.call(i,n,a),t(a)})}function no(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Oe(t.html(t));n.addEventListener("click",a=>{e.isDisabled||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),a.preventDefault(),a.stopPropagation())}),e.control.appendChild(n)})}function io(){var i=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(i.settings.mode==="multi"){var e=i.lock,t=i.unlock;i.hook("instead","lock",()=>{var n=$(i.control).data("sortable");return n&&n.disable(),e.call(i)}),i.hook("instead","unlock",()=>{var n=$(i.control).data("sortable");return n&&n.enable(),t.call(i)}),i.on("initialize",()=>{var n=$(i.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:(a,o)=>{o.placeholder.css("width",o.helper.css("width")),n.css({overflow:"visible"})},stop:()=>{n.css({overflow:"hidden"});var a=[];n.children("[data-value]").each(function(){this.dataset.value&&a.push(this.dataset.value)}),i.setValue(a)}})})}}function ro(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Oe(t.html(t)),a=n.querySelector("."+t.closeClass);a&&a.addEventListener("click",o=>{pe(o,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function oo(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=Ht(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),ze(t,"last-active")}else i.setCaret(i.caretPos+e)})}function so(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,xe(i.control_input,"dropdown-input");const e=Oe('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Oe('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case xi:i.isOpen&&(pe(t,!0),i.close()),i.clearActiveItems();return;case On:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),Ie(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function ao(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of n)e.style[o]=t.style[o];var a=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};a(),i.on("update item_add item_remove",a),Ie(t,"input",a),Ie(t,"keyup",a),Ie(t,"blur",a),Ie(t,"update",a)})}function lo(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function uo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function co(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,a,o,u;if(!i.isOpen||!(t.keyCode===Sn||t.keyCode===Ni))return e.call(i,t);i.ignoreHover=!0,u=Nt(i.activeOption,"[data-group]"),n=Ht(i.activeOption,"[data-selectable]"),u&&(t.keyCode===Sn?u=u.previousSibling:u=u.nextSibling,u&&(o=u.querySelectorAll("[data-selectable]"),a=o[Math.min(o.length-1,n)],a&&i.setActiveOption(a)))})}function fo(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Dt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var a=t.settings.render.item;t.settings.render.item=(o,u)=>{var w=Oe(a.call(t,o,u)),S=Oe(n);return w.appendChild(S),Ie(S,"mousedown",I=>{pe(I,!0)}),Ie(S,"click",I=>{pe(I,!0),!t.isLocked&&t.shouldDelete([w],I)&&(t.removeItem(w),t.refreshOptions(!1),t.inputState())}),w}})}}function po(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var a=e.options[n];a&&e.setTextboxValue(t.text.call(e,a))}})}function ho(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var a={},o,u=!1,w,S=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(i.activeOption){var L=i.selectable(),Q=Array.from(L).indexOf(i.activeOption);if(Q>=L.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const I=x=>typeof i.settings.maxOptions=="number"&&o.children.length>=i.settings.maxOptions?!1:!!(x in a&&a[x]),P=(x,L)=>i.items.indexOf(L)>=0||S.indexOf(L)>=0;i.setNextUrl=(x,L)=>{a[x]=L},i.getUrl=x=>{if(x in a){const L=a[x];return a[x]=!1,L}return a={},i.settings.firstUrl.call(i,x)},i.hook("instead","clearActiveOption",()=>{if(!u)return t.call(i)}),i.hook("instead","canLoad",x=>x in a?I(x):e.call(i,x)),i.hook("instead","loadCallback",(x,L)=>{if(!u)i.clearOptions(P);else if(w){const Q=x[0];Q!==void 0&&(w.dataset.value=Q[i.settings.valueField])}n.call(i,x,L),u=!1}),i.hook("after","refreshOptions",()=>{const x=i.lastValue;var L;I(x)?(L=i.render("loading_more",{query:x}),L&&(L.setAttribute("data-selectable",""),w=L)):x in a&&!o.querySelector(".no-results")&&(L=i.render("no_more_results",{query:x})),L&&(xe(L,i.settings.optionClass),o.append(L))}),i.on("initialize",()=>{S=Object.keys(i.options),o=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),o.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&I(i.lastValue)&&(u||(u=!0,i.load.call(i,i.lastValue)))})})}Pe.define("change_listener",eo);Pe.define("checkbox_options",to);Pe.define("clear_button",no);Pe.define("drag_drop",io);Pe.define("dropdown_header",ro);Pe.define("caret_position",oo);Pe.define("dropdown_input",so);Pe.define("input_autogrow",ao);Pe.define("no_backspace_delete",lo);Pe.define("no_active_items",uo);Pe.define("optgroup_columns",co);Pe.define("remove_button",fo);Pe.define("restore_on_backspace",po);Pe.define("virtual_scroll",ho);async function go(i){if(!await z.scene.isReady())return;const n=(await z.scene.local.getItems(o=>o.layer==="CHARACTER"))?.map(o=>o.id);let a=!1;for(const o of i){const u=o.metadata[`${A.EXTENSIONID}/metadata_ghosts`];if(u?.length>0){a=!0;const w=u.map(I=>I.id);for(const I of u){const P=I.metadata[`${A.EXTENSIONID}/viewers`];P&&(P.includes(H.userId)?await z.scene.local.addItems([I]):n.includes(I.id)&&await z.scene.local.deleteItems([I.id]))}const S=n.filter(I=>!w.includes(I));S?.length>0&&await z.scene.local.deleteItems(S)}}a||await z.scene.local.deleteItems(n)}function mo(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const a of H.players)n.push({value:a.id,text:a.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function yo(){z.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${A.EXTENSIONID}/metadata_ghosts`]=e,await z.player.setMetadata(t)}),await z.contextMenu.create({id:`${A.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){document.getElementById("spectreWarning").style.display="none";for(const e of i.items){const t=e,n=t.text?.plainText||t.name;await z.scene.items.deleteItems([t.id]),await z.scene.local.addItems([t]),H.ghosts.push(t);const a=document.getElementById("ghostList"),o=document.createElement("tr");o.id=`tr-${t.id}`,o.className="ghost-table-entry",o.innerHTML=`<td class="token-name">${n}</td>
<td><select id="select-${t.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${t.id}" value="Delete"/></td>`,a.appendChild(o);const u=document.getElementById(`select-${t.id}`);for(const I of H.players){const P=document.createElement("option");P.value=I.id,P.text=I.name,u.appendChild(P)}const w={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:H.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(I,P){const x=P.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await z.scene.local.updateItems([x],L=>{const Q=L[0].metadata[`${A.EXTENSIONID}/viewers`],b=Q.findIndex(W=>W==I);Q.splice(b,1),L[0].metadata[`${A.EXTENSIONID}/viewers`]=Q})},onItemAdd:async function(I,P){const x=P.parentElement.parentElement.parentElement.parentElement.id.slice(3);await z.scene.local.updateItems([x],L=>{const Q=L[0].metadata[`${A.EXTENSIONID}/viewers`];Q?(Q.push(I),L[0].metadata[`${A.EXTENSIONID}/viewers`]=Q):L[0].metadata[`${A.EXTENSIONID}/viewers`]=[I]})}};new Pe(`#select-${t.id}`,w);const S=document.getElementById(`deleteGhost-${t.id}`);S.onclick=async()=>{const I=H.ghosts.findIndex(P=>P.id===t.id);H.ghosts.splice(I,1),o.remove(),await z.scene.local.updateItems([t.id],P=>{P[0].metadata[`${A.EXTENSIONID}/viewers`]=[]}),await z.scene.local.deleteItems([t.id])}}}})}const An=document.getElementById("app");An.innerHTML=`
  <div>
    <div>
      <div class="title">Smoke! ˣ Dynamic Fog&nbsp;&nbsp;</div>
      <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
      <div class="tooltip" id="whatsnewbutton" title="Whats New">&#x1F6C8;
    </div>
    <hr>
    <div style="text-align: center;">
      <p><span id="map_size">Boundary Size: 
      <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
      <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
      <input type="button" id="mapSubmit" value="Update"/>
      &nbsp;&nbsp;&nbsp;
      Grid Snap:</span><input type="checkbox" id="snap_checkbox"></p>
      <hr>
      <div class="visionTitle">Vision Radius</div>
      <div><i>GM-owned tokens give universal vision.</i></div>
      <p id="no_tokens_message">Enable vision on your character tokens.</p>
      <div id="token_list_div" style="display: block;">
        <table style="margin: auto; padding: 0;"><tbody id="token_list">
        </tbody></table>
      </div>
      </div>
      <hr>
      <div class="visionTitle">Spectres!</div>
      <div id="ghostContainer" style="display: block;">
      <div id="spectreWarning"><i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i></br>
      Enable vision here after it's been Spectred.</div>
        <table style="margin: auto; padding: 0; width: 100%">
        <colgroup>
            <col style="width: 50%;">
            <col style="width: 25%;">
            <col style="width: 25%;">
        </colgroup>
        <tbody id="ghostList">
        </tbody></table>
    <div id="debug_div" style="display: none;">
      <br><hr><br>
      <h2>Debug</h2>
      <h3>Performance Info</h3>
      <ul>
        <li><p>Compute time: <span id=compute_time>N/A</span></p></li>
        <li><p>Communication time: <span id=communication_time>N/A</span></p></li>
        <li><p>Cache hits/misses: <span id=cache_hits>?</span>/<span id=cache_misses>?</span></p></li>
      </ul>
    </div>
  </div>
`;An.parentElement.style.placeItems="start";const Pi=document.getElementById("vision_checkbox"),ui=document.getElementById("snap_checkbox"),vo=document.getElementById("token_list"),ci=document.getElementById("no_tokens_message"),wo=document.getElementById("mapHeight"),Io=document.getElementById("mapWidth"),_o=document.getElementById("mapSubmit");async function bo(){Pi.addEventListener("click",async i=>{if(!H.ready||!i.target){i.preventDefault();return}const e=i.target;await z.scene.setMetadata({[`${A.EXTENSIONID}/visionEnabled`]:e.checked})},!1),ui.checked=!0,ui.addEventListener("click",async i=>{if(!H.ready||!i.target){i.preventDefault();return}const e=i.target;H.snap=e.checked},!1)}function $t(i){const e=i.filter(Ji);H.metadata&&(Pi.checked=H.metadata[`${A.EXTENSIONID}/visionEnabled`]==!0),e.length>0?ci.style.display="none":ci.style.display="block";const t=document.getElementsByClassName("token-table-entry"),n=[];for(const a of t){const o=a.id.slice(3);e.find(u=>u.id===o)===void 0&&n.push(a)}for(const a of n)a.remove();for(const a of e){const o=document.getElementById(`tr-${a.id}`);if(o){const u=o.getElementsByClassName("token-name")[0],w=o.getElementsByClassName("token-vision-range")[0],S=o.getElementsByClassName("unlimited-vision")[0],I=o.getElementsByClassName("no-vision")[0];u&&(u.innerText=a.name),w&&!S.checked&&!I.checked&&(w.value=a.metadata[`${A.EXTENSIONID}/visionRange`]?a.metadata[`${A.EXTENSIONID}/visionRange`]:A.VISIONDEFAULT),S&&(S.checked=a.metadata[`${A.EXTENSIONID}/visionRange`]===0),I&&(I.checked=a.metadata[`${A.EXTENSIONID}/visionBlind`]),S.checked||I.checked?w.setAttribute("disabled","disabled"):w.removeAttribute("disabled")}else{const u=H.items.find(x=>x.id===a.id),w=document.createElement("tr");w.id=`tr-${u.id}`,w.className="token-table-entry",w.innerHTML=`<td class="token-name">${u.name}</td><td><input class="token-vision-range" type="number" value=${A.VISIONDEFAULT}><span class="unit">ft</span></td><td>&nbsp;&nbsp;&infin;&nbsp<input type="checkbox" class="unlimited-vision">&nbsp;None <input type="checkbox" class="no-vision"></td>`,vo.appendChild(w);const S=w.getElementsByClassName("token-vision-range")[0],I=w.getElementsByClassName("unlimited-vision")[0],P=w.getElementsByClassName("no-vision")[0];S&&!I.checked&&!P.checked&&(S.value=a.metadata[`${A.EXTENSIONID}/visionRange`]?a.metadata[`${A.EXTENSIONID}/visionRange`]:A.VISIONDEFAULT),I&&(I.checked=a.metadata[`${A.EXTENSIONID}/visionRange`]===0),P&&(P.checked=a.metadata[`${A.EXTENSIONID}/visionBlind`]),I.checked||P.checked?S.setAttribute("disabled","disabled"):S.removeAttribute("disabled"),S.addEventListener("change",async x=>{if(!x||!x.target)return;const L=H.items.find(W=>W.id===a.id),Q=x.target,b=parseInt(Q.value);b<0&&(Q.value="0"),b>999&&(Q.value="999"),await z.scene.items.updateItems([L],W=>{W[0].metadata[`${A.EXTENSIONID}/visionRange`]=b})},!1),I.addEventListener("click",async x=>{if(!x||!x.target)return;const L=H.items.find(W=>W.id===a.id);let Q=0;x.target.checked?(S.setAttribute("disabled","disabled"),P.checked=!1):(Q=parseInt(S.value),S.removeAttribute("disabled")),await z.scene.items.updateItems([L],W=>{W[0].metadata[`${A.EXTENSIONID}/visionRange`]=Q})},!1),P.addEventListener("click",async x=>{if(!x||!x.target)return;const L=H.items.find(b=>b.id===a.id),Q=x.target;Q.checked?(S.setAttribute("disabled","disabled"),I.checked=!1):S.removeAttribute("disabled"),await z.scene.items.updateItems([L],b=>{b[0].metadata[`${A.EXTENSIONID}/visionBlind`]=Q.checked})},!1)}}}async function di(i){let e,t;[H.items,H.metadata,H.gridDpi,H.gridScale,e,t]=await Promise.all([z.scene.items.getItems(),z.scene.getMetadata(),z.scene.grid.getDpi(),z.scene.grid.getScale(),z.scene.fog.getFilled(),z.scene.fog.getColor()]),await z.scene.items.deleteItems(H.items.filter(bn).map(o=>o.id)),H.snap=!0,H.gridScale=H.gridScale.parsed.multiplier,H.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(H.items.filter(Zi).length==0){const o=H.items.filter(w=>w.layer=="MAP"&&w.type=="IMAGE"),u=o.map(w=>w.image.width*w.image.height/Math.pow(w.grid.dpi,2));n=o[u.indexOf(Math.max(...u))]}let a;if(H.items.filter(hi).length==0&&(a=st().width(H.gridDpi*30).height(H.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),a.metadata[`${A.EXTENSIONID}/isBackgroundImage`]=!0,a.id=A.GRIDID,H.items.push(a)),i=="GM"){a&&await z.scene.items.addItems([a]),_o.onclick=async()=>{await z.scene.items.updateItems([A.GRIDID],u=>{for(const w of u){const S=w;S.width=H.gridDpi*+Io.value,S.height=H.gridDpi*+wo.value,S.scale={x:1,y:1}}})};const o=document.getElementById("whatsnewbutton");o.onclick=async function(){await z.modal.open({id:A.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},$t(H.items),n!==void 0&&await z.scene.items.updateItems([n],u=>{u[0].metadata[`${A.EXTENSIONID}/isBackgroundImage`]=!0})}}z.onReady(async()=>{await z.player.getRole().then(async i=>{i=="GM"?(H.role="GM",await bo(),await gr(),await mr(),await yr(),await yo()):(An.innerHTML="Configuration is GM-Access only.",await z.action.setHeight(90),await z.action.setWidth(320)),z.scene.fog.onChange(e=>{H.fog=e}),z.scene.items.onChange(async e=>{const t=e;H.items=t,H.ready&&(i=="GM"&&$t(t),await ft())}),H.userId=await z.player.getId(),H.players=await z.party.getPlayers(),z.party.onChange(async e=>{H.players=e,i==="PLAYER"?await go(e):mo()}),z.scene.grid.onChange(async e=>{H.gridDpi=e.dpi,H.gridScale=parseInt(e.scale),H.ready&&await ft()}),z.scene.onMetadataChange(async e=>{H.metadata=e,H.ready&&await ft()}),z.scene.onReadyChange(async e=>{H.ready=e,e?(di(i),await ft()):i=="GM"&&$t([])}),H.ready=await z.scene.isReady(),H.ready?(di(i),await ft()):i=="GM"&&$t([])})});
