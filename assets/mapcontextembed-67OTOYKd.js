import{O as a,C as t,b as u,a as N}from"./bsConstants-CsbWmK8i.js";/* empty css              */import{B as f}from"./smokeMain-I2K_vRUs.js";a.onReady(async()=>{const l=await a.player.getSelection();if(!l)return await a.popover.close(t.CONTEXTID);const s=document.getElementById("mapEffectSelect"),g=(await a.scene.items.getItems(i=>l[0]===i.id))[0];for(const i of t.ENHANCEDFOGEFECTS){const e=document.createElement("option");e.value=i.key,e.textContent=i.value,s.appendChild(e)}const E=g.metadata[`${t.EXTENSIONID}/hasFogBackground`];E?s.value=E:s.value="NONE";const d=document.getElementById("mapStyleSelect");for(const i of t.ENHANCEDFOGSTYLES){const e=document.createElement("option");e.value=i[0],e.textContent=i[1],d.appendChild(e)}const I=g.metadata[`${t.EXTENSIONID}/hasFogBackgroundStyle`];I?d.value=I:d.value="0",d.onchange=async()=>{await r()},s.onchange=async()=>{await r()};async function r(){const e=(await a.scene.items.getItems(o=>l[0]===o.id))[0];if(s.value==="NONE"){const o=e.metadata[`${t.EXTENSIONID}/FogBackgroundId`];o&&(await a.scene.items.deleteItems([o]),await a.scene.items.updateItems([e.id],c=>{for(const n of c)delete n.metadata[`${t.EXTENSIONID}/hasFogBackground`],delete n.metadata[`${t.EXTENSIONID}/hasFogBackgroundStyle`],delete n.metadata[`${t.EXTENSIONID}/FogBackgroundId`]}))}else{let o;const c=e.metadata[`${t.EXTENSIONID}/FogBackgroundId`];if(c&&await a.scene.items.deleteItems([c]),d.value==="0")o=u({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).rotation(e.rotation).scale(e.scale).position(e.position).attachedTo(e.id).layer("FOG").metadata({[`${t.EXTENSIONID}/isFogBackground`]:e.id}).disableHit(!0).zIndex(-1).build();else{const n=await a.scene.items.getItemBounds([e.id]);o=N().fillColor(f.fogColor).fillOpacity(1).height(n.height).width(n.width).rotation(e.rotation).scale(e.scale).position(e.position).attachedTo(e.id).layer("FOG").metadata({[`${t.EXTENSIONID}/isFogBackground`]:e.id}).disableHit(!0).zIndex(-1).build()}await a.broadcast.sendMessage(`${t.EXTENSIONID}/FOGBACKGROUNDEVENT`,{MapId:o.id,FogEffect:s.value,FogStyle:d.value},{destination:"ALL"}),await a.scene.items.addItems([o]),await a.scene.items.updateItems([e.id],n=>{for(const m of n)m.metadata[`${t.EXTENSIONID}/hasFogBackground`]=s.value,m.metadata[`${t.EXTENSIONID}/hasFogBackgroundStyle`]=d.value,m.metadata[`${t.EXTENSIONID}/FogBackgroundId`]=o.id})}}});
