import{C as D,b as Lt,a as di,O as Y,c as st,d as zi}from"./constants-4214fcbb.js";var cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Ki(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var a=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return i[n]}})}),t}class Yi{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const H=new Yi;function Zi(i){return i.layer=="MAP"&&(i.metadata[`${D.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${D.ARMINDOID}/isBackgroundImage`])}function In(i){return i.metadata[`${D.EXTENSIONID}/isVisionFog`]||i.metadata[`${D.ARMINDOID}/isVisionFog`]}function Qi(i){return i.metadata[`${D.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${D.ARMINDOID}/isIndicatorRing`]}function Ji(i){return i.metadata[`${D.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${D.EXTENSIONID}/disabled`]||i.metadata[`${D.ARMINDOID}/isVisionLine`]&&!i.metadata[`${D.ARMINDOID}/disabled`]}function pi(i){return i.layer=="CHARACTER"&&(i.metadata[`${D.EXTENSIONID}/hasVision`]||i.metadata[`${D.ARMINDOID}/hasVision`])}function er(i){return i.layer=="CHARACTER"&&i.createdUserId==H.userId&&(i.metadata[`${D.EXTENSIONID}/hasVision`]||i.metadata[`${D.ARMINDOID}/hasVision`])}function hi(i){return i.layer=="DRAWING"&&(i.metadata[`${D.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${D.ARMINDOID}/isBackgroundImage`])}var gi={exports:{}};const tr={},nr=Object.freeze(Object.defineProperty({__proto__:null,default:tr},Symbol.toStringTag,{value:"Module"})),dn=Ki(nr);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(a){a=a||{};var o;o||(o=typeof a<"u"?a:{});var u=Object.assign,w,A;o.ready=new Promise(function(s,r){w=s,A=r}),function(s){var r={};s.loadCmdsTypedArray=function(C){for(var U=0,q=0;q<C.length;q++)U+=C[q].length;if(r[U])var K=r[U];else K=new Float32Array(U),r[U]=K;var J=0;for(q=0;q<C.length;q++)for(var ce=0;ce<C[q].length;ce++){var me=C[q][ce];typeof me=="string"&&(me=s.SkBits2FloatUnsigned(parseInt(me))),K[J]=me,J++}return C=s._malloc(K.length*K.BYTES_PER_ELEMENT),s.HEAPF32.set(K,C/K.BYTES_PER_ELEMENT),[C,U]},s.FromCmds=function(C){C=s.loadCmdsTypedArray(C);var U=s._FromCmds(C[0],C[1]);return s._free(C[0]),U};var l,p,v,O,j;s.cubicYFromX=function(C,U,q,K,J){return l&&p===C&&v===U&&O===q&&j===K||(l&&l.delete(),l=new s._SkCubicMap([C,U],[q,K]),p=C,v=U,O=q,j=K),l.computeYFromX(J)},s.cubicPtFromT=function(C,U,q,K,J){return l&&p===C&&v===U&&O===q&&j===K||(l&&l.delete(),l=new s._SkCubicMap([C,U],[q,K]),p=C,v=U,O=q,j=K),l.computePtFromT(J)}}(o),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var r=arguments[0];if(arguments.length===1)this._addPath(r,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var l=arguments[1];this._addPath(r,l.a,l.c,l.e,l.b,l.d,l.f,0,0,1)}else if(arguments.length===7)l=arguments,this._addPath(r,l[1],l[3],l[5],l[2],l[4],l[6],0,0,1);else if(arguments.length===10)l=arguments,this._addPath(r,l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8],l[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(r,l,p,v,O,j){return this._arc(r,l,p,v,O,!!j),this},s.SkPath.prototype.arcTo=function(r,l,p,v,O){return this._arcTo(r,l,p,v,O),this},s.SkPath.prototype.bezierCurveTo=function(r,l,p,v,O,j){return this._cubicTo(r,l,p,v,O,j),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(r,l,p,v,O){return this._conicTo(r,l,p,v,O),this},s.SkPath.prototype.cubicTo=function(r,l,p,v,O,j){return this._cubicTo(r,l,p,v,O,j),this},s.SkPath.prototype.dash=function(r,l,p){return this._dash(r,l,p)?this:null},s.SkPath.prototype.ellipse=function(r,l,p,v,O,j,C,U){return this._ellipse(r,l,p,v,O,j,C,!!U),this},s.SkPath.prototype.lineTo=function(r,l){return this._lineTo(r,l),this},s.SkPath.prototype.moveTo=function(r,l){return this._moveTo(r,l),this},s.SkPath.prototype.op=function(r,l){return this._op(r,l)?this:null},s.SkPath.prototype.quadraticCurveTo=function(r,l,p,v){return this._quadTo(r,l,p,v),this},s.SkPath.prototype.quadTo=function(r,l,p,v){return this._quadTo(r,l,p,v),this},s.SkPath.prototype.rect=function(r,l,p,v){return this._rect(r,l,p,v),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(r){return r=r||{},r.width=r.width||1,r.miter_limit=r.miter_limit||4,r.cap=r.cap||s.StrokeCap.BUTT,r.join=r.join||s.StrokeJoin.MITER,this._stroke(r)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var r=arguments;this._transform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(r,l,p){return this._trim(r,l,!!p)?this:null}}}(o);var _=u({},o),x=typeof window=="object",N=typeof importScripts=="function",L="",ee,E,G,S,P,T;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(L=N?dn.dirname(L)+"/":__dirname+"/",T=()=>{P||(S=dn,P=dn)},ee=function(s,r){return T(),s=P.normalize(s),S.readFileSync(s,r?null:"utf8")},G=s=>(s=ee(s,!0),s.buffer||(s=new Uint8Array(s)),s),E=(s,r,l)=>{T(),s=P.normalize(s),S.readFile(s,function(p,v){p?l(p):r(v.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),o.inspect=function(){return"[Emscripten Module object]"}):(x||N)&&(N?L=self.location.href:typeof document<"u"&&document.currentScript&&(L=document.currentScript.src),n&&(L=n),L.indexOf("blob:")!==0?L=L.substr(0,L.replace(/[?#].*/,"").lastIndexOf("/")+1):L="",ee=s=>{var r=new XMLHttpRequest;return r.open("GET",s,!1),r.send(null),r.responseText},N&&(G=s=>{var r=new XMLHttpRequest;return r.open("GET",s,!1),r.responseType="arraybuffer",r.send(null),new Uint8Array(r.response)}),E=(s,r,l)=>{var p=new XMLHttpRequest;p.open("GET",s,!0),p.responseType="arraybuffer",p.onload=()=>{p.status==200||p.status==0&&p.response?r(p.response):l()},p.onerror=l,p.send(null)});var F=o.print||console.log.bind(console),R=o.printErr||console.warn.bind(console);u(o,_),_=null;var Q;o.wasmBinary&&(Q=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&oe("no native wasm support detected");var y,I=!1,f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function g(s,r,l){var p=r+l;for(l=r;s[l]&&!(l>=p);)++l;if(16<l-r&&s.subarray&&f)return f.decode(s.subarray(r,l));for(p="";r<l;){var v=s[r++];if(v&128){var O=s[r++]&63;if((v&224)==192)p+=String.fromCharCode((v&31)<<6|O);else{var j=s[r++]&63;v=(v&240)==224?(v&15)<<12|O<<6|j:(v&7)<<18|O<<12|j<<6|s[r++]&63,65536>v?p+=String.fromCharCode(v):(v-=65536,p+=String.fromCharCode(55296|v>>10,56320|v&1023))}}else p+=String.fromCharCode(v)}return p}function d(s,r,l){var p=te;if(0<l){l=r+l-1;for(var v=0;v<s.length;++v){var O=s.charCodeAt(v);if(55296<=O&&57343>=O){var j=s.charCodeAt(++v);O=65536+((O&1023)<<10)|j&1023}if(127>=O){if(r>=l)break;p[r++]=O}else{if(2047>=O){if(r+1>=l)break;p[r++]=192|O>>6}else{if(65535>=O){if(r+2>=l)break;p[r++]=224|O>>12}else{if(r+3>=l)break;p[r++]=240|O>>18,p[r++]=128|O>>12&63}p[r++]=128|O>>6&63}p[r++]=128|O&63}}p[r]=0}}var b=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function k(s,r){for(var l=s>>1,p=l+r/2;!(l>=p)&&fe[l];)++l;if(l<<=1,32<l-s&&b)return b.decode(te.subarray(s,l));for(l="",p=0;!(p>=r/2);++p){var v=ae[s+2*p>>1];if(v==0)break;l+=String.fromCharCode(v)}return l}function ie(s,r,l){if(l===void 0&&(l=2147483647),2>l)return 0;l-=2;var p=r;l=l<2*s.length?l/2:s.length;for(var v=0;v<l;++v)ae[r>>1]=s.charCodeAt(v),r+=2;return ae[r>>1]=0,r-p}function ne(s){return 2*s.length}function M(s,r){for(var l=0,p="";!(l>=r/4);){var v=re[s+4*l>>2];if(v==0)break;++l,65536<=v?(v-=65536,p+=String.fromCharCode(55296|v>>10,56320|v&1023)):p+=String.fromCharCode(v)}return p}function W(s,r,l){if(l===void 0&&(l=2147483647),4>l)return 0;var p=r;l=p+l-4;for(var v=0;v<s.length;++v){var O=s.charCodeAt(v);if(55296<=O&&57343>=O){var j=s.charCodeAt(++v);O=65536+((O&1023)<<10)|j&1023}if(re[r>>2]=O,r+=4,r+4>l)break}return re[r>>2]=0,r-p}function se(s){for(var r=0,l=0;l<s.length;++l){var p=s.charCodeAt(l);55296<=p&&57343>=p&&++l,r+=4}return r}var he,Z,te,ae,fe,re,ge,Ie,$e;function Le(){var s=y.buffer;he=s,o.HEAP8=Z=new Int8Array(s),o.HEAP16=ae=new Int16Array(s),o.HEAP32=re=new Int32Array(s),o.HEAPU8=te=new Uint8Array(s),o.HEAPU16=fe=new Uint16Array(s),o.HEAPU32=ge=new Uint32Array(s),o.HEAPF32=Ie=new Float32Array(s),o.HEAPF64=$e=new Float64Array(s)}var X,c=[],h=[],m=[];function B(){var s=o.preRun.shift();c.unshift(s)}var V=0,z=null;o.preloadedImages={},o.preloadedAudios={};function oe(s){throw o.onAbort&&o.onAbort(s),s="Aborted("+s+")",R(s),I=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),A(s),s}function ye(){return ue.startsWith("data:application/octet-stream;base64,")}var ue;if(ue="pathkit.wasm",!ye()){var De=ue;ue=o.locateFile?o.locateFile(De,L):L+De}function Se(){var s=ue;try{if(s==ue&&Q)return new Uint8Array(Q);if(G)return G(s);throw"both async and sync fetching of the wasm failed"}catch(r){oe(r)}}function Ae(){if(!Q&&(x||N)){if(typeof fetch=="function"&&!ue.startsWith("file://"))return fetch(ue,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+ue+"'";return s.arrayBuffer()}).catch(function(){return Se()});if(E)return new Promise(function(s,r){E(ue,function(l){s(new Uint8Array(l))},r)})}return Promise.resolve().then(function(){return Se()})}function be(s){for(;0<s.length;){var r=s.shift();if(typeof r=="function")r(o);else{var l=r.Wa;typeof l=="number"?r.xa===void 0?X.get(l)():X.get(l)(r.xa):l(r.xa===void 0?null:r.xa)}}}var ve={};function Ue(s){for(;s.length;){var r=s.pop();s.pop()(r)}}function Xe(s){return this.fromWireType(ge[s>>2])}var nt={},Ze={},mt={};function Cn(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var r=s.charCodeAt(0);return 48<=r&&57>=r?"_"+s:s}function qt(s,r){return s=Cn(s),function(){return r.apply(this,arguments)}}function zt(s){var r=Error,l=qt(s,function(p){this.name=s,this.message=p,p=Error(p).stack,p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(r.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},l}var xn=void 0;function yt(s){throw new xn(s)}function He(s,r,l){function p(C){C=l(C),C.length!==s.length&&yt("Mismatched type converter count");for(var U=0;U<s.length;++U)We(s[U],C[U])}s.forEach(function(C){mt[C]=r});var v=Array(r.length),O=[],j=0;r.forEach(function(C,U){Ze.hasOwnProperty(C)?v[U]=Ze[C]:(O.push(C),nt.hasOwnProperty(C)||(nt[C]=[]),nt[C].push(function(){v[U]=Ze[C],++j,j===O.length&&p(v)}))}),O.length===0&&p(v)}var vt={};function wt(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Pn=void 0;function Ee(s){for(var r="";te[s];)r+=Pn[te[s++]];return r}var it=void 0;function le(s){throw new it(s)}function We(s,r,l={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=r.name;if(s||le('type "'+p+'" must have a positive integer typeid pointer'),Ze.hasOwnProperty(s)){if(l.Qa)return;le("Cannot register type '"+p+"' twice")}Ze[s]=r,delete mt[s],nt.hasOwnProperty(s)&&(r=nt[s],delete nt[s],r.forEach(function(v){v()}))}function Kt(s){le(s.ea.ha.fa.name+" instance already deleted")}var Yt=!1;function Nn(){}function Dn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function at(s){return typeof FinalizationGroup>"u"?(at=r=>r,s):(Yt=new FinalizationGroup(function(r){for(var l=r.next();!l.done;l=r.next())l=l.value,l.ga?Dn(l):console.warn("object already deleted: "+l.ga)}),at=r=>(Yt.register(r,r.ea,r.ea),r),Nn=r=>{Yt.unregister(r.ea)},at(s))}var lt=void 0,ut=[];function Zt(){for(;ut.length;){var s=ut.pop();s.ea.pa=!1,s.delete()}}function Ke(){}var $n={};function Ln(s,r,l){if(s[r].ia===void 0){var p=s[r];s[r]=function(){return s[r].ia.hasOwnProperty(arguments.length)||le("Function '"+l+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[r].ia+")!"),s[r].ia[arguments.length].apply(this,arguments)},s[r].ia=[],s[r].ia[p.ua]=p}}function Qt(s,r,l){o.hasOwnProperty(s)?((l===void 0||o[s].ia!==void 0&&o[s].ia[l]!==void 0)&&le("Cannot register public name '"+s+"' twice"),Ln(o,s,s),o.hasOwnProperty(l)&&le("Cannot register multiple overloads of a function with the same number of arguments ("+l+")!"),o[s].ia[l]=r):(o[s]=r,l!==void 0&&(o[s].Xa=l))}function Di(s,r,l,p,v,O,j,C){this.name=s,this.constructor=r,this.qa=l,this.la=p,this.na=v,this.Oa=O,this.ta=j,this.La=C,this.Ta=[]}function Jt(s,r,l){for(;r!==l;)r.ta||le("Expected null or instance of "+l.name+", got an instance of "+r.name),s=r.ta(s),r=r.na;return s}function $i(s,r){return r===null?(this.Ba&&le("null is not a valid "+this.name),0):(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),Jt(r.ea.ga,r.ea.ha.fa,this.fa))}function Li(s,r){if(r===null){if(this.Ba&&le("null is not a valid "+this.name),this.wa){var l=this.sa();return s!==null&&s.push(this.la,l),l}return 0}if(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&r.ea.ha.va&&le("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name),l=Jt(r.ea.ga,r.ea.ha.fa,this.fa),this.wa)switch(r.ea.ka===void 0&&le("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:r.ea.ma===this?l=r.ea.ka:le("Cannot convert argument of type "+(r.ea.ma?r.ea.ma.name:r.ea.ha.name)+" to parameter type "+this.name);break;case 1:l=r.ea.ka;break;case 2:if(r.ea.ma===this)l=r.ea.ka;else{var p=r.clone();l=this.Ua(l,Ye(function(){p.delete()})),s!==null&&s.push(this.la,l)}break;default:le("Unsupporting sharing policy")}return l}function Fi(s,r){return r===null?(this.Ba&&le("null is not a valid "+this.name),0):(r.ea||le('Cannot pass "'+on(r)+'" as a '+this.name),r.ea.ga||le("Cannot pass deleted object as a pointer of type "+this.name),r.ea.ha.va&&le("Cannot convert argument of type "+r.ea.ha.name+" to parameter type "+this.name),Jt(r.ea.ga,r.ea.ha.fa,this.fa))}function Fn(s,r,l){return r===l?s:l.na===void 0?null:(s=Fn(s,r,l.na),s===null?null:l.La(s))}var ct={};function Ri(s,r){for(r===void 0&&le("ptr should not be undefined");s.na;)r=s.ta(r),s=s.na;return ct[r]}function _t(s,r){return r.ha&&r.ga||yt("makeClassHandle requires ptr and ptrType"),!!r.ma!=!!r.ka&&yt("Both smartPtrType and smartPtr must be specified"),r.count={value:1},at(Object.create(s,{ea:{value:r}}))}function Ge(s,r,l,p){this.name=s,this.fa=r,this.Ba=l,this.va=p,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,r.na!==void 0?this.toWireType=Li:(this.toWireType=p?$i:Fi,this.ja=null)}function Rn(s,r,l){o.hasOwnProperty(s)||yt("Replacing nonexistant public symbol"),o[s].ia!==void 0&&l!==void 0?o[s].ia[l]=r:(o[s]=r,o[s].ua=l)}function Mi(s,r){var l=[];return function(){l.length=arguments.length;for(var p=0;p<arguments.length;p++)l[p]=arguments[p];return s.includes("j")?(p=o["dynCall_"+s],p=l&&l.length?p.apply(null,[r].concat(l)):p.call(null,r)):p=X.get(r).apply(null,l),p}}function ke(s,r){s=Ee(s);var l=s.includes("j")?Mi(s,r):X.get(r);return typeof l!="function"&&le("unknown function pointer with signature "+s+": "+r),l}var Mn=void 0;function Bn(s){s=Hn(s);var r=Ee(s);return qe(s),r}function bt(s,r){function l(O){v[O]||Ze[O]||(mt[O]?mt[O].forEach(l):(p.push(O),v[O]=!0))}var p=[],v={};throw r.forEach(l),new Mn(s+": "+p.map(Bn).join([", "]))}function en(s,r){for(var l=[],p=0;p<s;p++)l.push(re[(r>>2)+p]);return l}function tn(s,r,l,p,v){var O=r.length;2>O&&le("argTypes array size mismatch! Must at least get return value and 'this' types!");var j=r[1]!==null&&l!==null,C=!1;for(l=1;l<r.length;++l)if(r[l]!==null&&r[l].ja===void 0){C=!0;break}var U=r[0].name!=="void",q=O-2,K=Array(q),J=[],ce=[];return function(){if(arguments.length!==q&&le("function "+s+" called with "+arguments.length+" arguments, expected "+q+" args!"),ce.length=0,J.length=j?2:1,J[0]=v,j){var me=r[1].toWireType(ce,this);J[1]=me}for(var de=0;de<q;++de)K[de]=r[de+2].toWireType(ce,arguments[de]),J.push(K[de]);if(de=p.apply(null,J),C)Ue(ce);else for(var Te=j?1:2;Te<r.length;Te++){var Ce=Te===1?me:K[Te-2];r[Te].ja!==null&&r[Te].ja(Ce)}return me=U?r[0].fromWireType(de):void 0,me}}var nn=[],Ve=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Vn(s){4<s&&--Ve[s].Ca===0&&(Ve[s]=void 0,nn.push(s))}function rn(s){return s||le("Cannot use deleted val. handle = "+s),Ve[s].value}function Ye(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var r=nn.length?nn.pop():Ve.length;return Ve[r]={Ca:1,value:s},r}}function Bi(s,r,l){switch(r){case 0:return function(p){return this.fromWireType((l?Z:te)[p])};case 1:return function(p){return this.fromWireType((l?ae:fe)[p>>1])};case 2:return function(p){return this.fromWireType((l?re:ge)[p>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function It(s,r){var l=Ze[s];return l===void 0&&le(r+" has unknown type "+Bn(s)),l}function on(s){if(s===null)return"null";var r=typeof s;return r==="object"||r==="array"||r==="function"?s.toString():""+s}function Vi(s,r){switch(r){case 2:return function(l){return this.fromWireType(Ie[l>>2])};case 3:return function(l){return this.fromWireType($e[l>>3])};default:throw new TypeError("Unknown float type: "+s)}}function ji(s,r,l){switch(r){case 0:return l?function(p){return Z[p]}:function(p){return te[p]};case 1:return l?function(p){return ae[p>>1]}:function(p){return fe[p>>1]};case 2:return l?function(p){return re[p>>2]}:function(p){return ge[p>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Ui={};function sn(s){var r=Ui[s];return r===void 0?Ee(s):r}var an=[];function jn(){function s(r){r.$$$embind_global$$$=r;var l=typeof $$$embind_global$$$=="object"&&r.$$$embind_global$$$===r;return l||delete r.$$$embind_global$$$,l}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof cn=="object"&&s(cn)?$$$embind_global$$$=cn:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Wi(s){var r=an.length;return an.push(s),r}function Xi(s,r){for(var l=Array(s),p=0;p<s;++p)l[p]=It(re[(r>>2)+p],"parameter "+p);return l}var Un=[];function Hi(s){var r=Array(s+1);return function(l,p,v){r[0]=l;for(var O=0;O<s;++O){var j=It(re[(p>>2)+O],"parameter "+O);r[O+1]=j.readValueFromPointer(v),v+=j.argPackAdvance}return l=new(l.bind.apply(l,r)),Ye(l)}}var Wn={},Gi=[null,[],[]];xn=o.InternalError=zt("InternalError");for(var Xn=Array(256),Et=0;256>Et;++Et)Xn[Et]=String.fromCharCode(Et);Pn=Xn,it=o.BindingError=zt("BindingError"),Ke.prototype.isAliasOf=function(s){if(!(this instanceof Ke&&s instanceof Ke))return!1;var r=this.ea.ha.fa,l=this.ea.ga,p=s.ea.ha.fa;for(s=s.ea.ga;r.na;)l=r.ta(l),r=r.na;for(;p.na;)s=p.ta(s),p=p.na;return r===p&&l===s},Ke.prototype.clone=function(){if(this.ea.ga||Kt(this),this.ea.ra)return this.ea.count.value+=1,this;var s=at,r=Object,l=r.create,p=Object.getPrototypeOf(this),v=this.ea;return s=s(l.call(r,p,{ea:{value:{count:v.count,pa:v.pa,ra:v.ra,ga:v.ga,ha:v.ha,ka:v.ka,ma:v.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},Ke.prototype.delete=function(){this.ea.ga||Kt(this),this.ea.pa&&!this.ea.ra&&le("Object already scheduled for deletion"),Nn(this),Dn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},Ke.prototype.isDeleted=function(){return!this.ea.ga},Ke.prototype.deleteLater=function(){return this.ea.ga||Kt(this),this.ea.pa&&!this.ea.ra&&le("Object already scheduled for deletion"),ut.push(this),ut.length===1&&lt&&lt(Zt),this.ea.pa=!0,this},Ge.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},Ge.prototype.Ga=function(s){this.la&&this.la(s)},Ge.prototype.argPackAdvance=8,Ge.prototype.readValueFromPointer=Xe,Ge.prototype.deleteObject=function(s){s!==null&&s.delete()},Ge.prototype.fromWireType=function(s){function r(){return this.wa?_t(this.fa.qa,{ha:this.Sa,ga:l,ma:this,ka:s}):_t(this.fa.qa,{ha:this,ga:s})}var l=this.Pa(s);if(!l)return this.Ga(s),null;var p=Ri(this.fa,l);if(p!==void 0)return p.ea.count.value===0?(p.ea.ga=l,p.ea.ka=s,p.clone()):(p=p.clone(),this.Ga(s),p);if(p=this.fa.Oa(l),p=$n[p],!p)return r.call(this);p=this.va?p.Ja:p.pointerType;var v=Fn(l,this.fa,p.fa);return v===null?r.call(this):this.wa?_t(p.fa.qa,{ha:p,ga:v,ma:this,ka:s}):_t(p.fa.qa,{ha:p,ga:v})},o.getInheritedInstanceCount=function(){return Object.keys(ct).length},o.getLiveInheritedInstances=function(){var s=[],r;for(r in ct)ct.hasOwnProperty(r)&&s.push(ct[r]);return s},o.flushPendingDeletes=Zt,o.setDelayFunction=function(s){lt=s,ut.length&&lt&&lt(Zt)},Mn=o.UnboundTypeError=zt("UnboundTypeError"),o.count_emval_handles=function(){for(var s=0,r=5;r<Ve.length;++r)Ve[r]!==void 0&&++s;return s},o.get_first_emval=function(){for(var s=5;s<Ve.length;++s)if(Ve[s]!==void 0)return Ve[s];return null};var qi={r:function(s){var r=ve[s];delete ve[s];var l=r.elements,p=l.length,v=l.map(function(C){return C.Aa}).concat(l.map(function(C){return C.Ea})),O=r.sa,j=r.la;He([s],v,function(C){return l.forEach(function(U,q){var K=C[q],J=U.ya,ce=U.za,me=C[q+p],de=U.Da,Te=U.Fa;U.read=Ce=>K.fromWireType(J(ce,Ce)),U.write=(Ce,Qe)=>{var Fe=[];de(Te,Ce,me.toWireType(Fe,Qe)),Ue(Fe)}}),[{name:r.name,fromWireType:function(U){for(var q=Array(p),K=0;K<p;++K)q[K]=l[K].read(U);return j(U),q},toWireType:function(U,q){if(p!==q.length)throw new TypeError("Incorrect number of tuple elements for "+r.name+": expected="+p+", actual="+q.length);for(var K=O(),J=0;J<p;++J)l[J].write(K,q[J]);return U!==null&&U.push(j,K),K},argPackAdvance:8,readValueFromPointer:Xe,ja:j}]})},u:function(s){var r=vt[s];delete vt[s];var l=r.sa,p=r.la,v=r.Ha,O=v.map(function(j){return j.Aa}).concat(v.map(function(j){return j.Ea}));He([s],O,function(j){var C={};return v.forEach(function(U,q){var K=j[q],J=U.ya,ce=U.za,me=j[q+v.length],de=U.Da,Te=U.Fa;C[U.Na]={read:function(Ce){return K.fromWireType(J(ce,Ce))},write:function(Ce,Qe){var Fe=[];de(Te,Ce,me.toWireType(Fe,Qe)),Ue(Fe)}}}),[{name:r.name,fromWireType:function(U){var q={},K;for(K in C)q[K]=C[K].read(U);return p(U),q},toWireType:function(U,q){for(var K in C)if(!(K in q))throw new TypeError('Missing field:  "'+K+'"');var J=l();for(K in C)C[K].write(J,q[K]);return U!==null&&U.push(p,J),J},argPackAdvance:8,readValueFromPointer:Xe,ja:p}]})},z:function(){},F:function(s,r,l,p,v){var O=wt(l);r=Ee(r),We(s,{name:r,fromWireType:function(j){return!!j},toWireType:function(j,C){return C?p:v},argPackAdvance:8,readValueFromPointer:function(j){if(l===1)var C=Z;else if(l===2)C=ae;else if(l===4)C=re;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(C[j>>O])},ja:null})},l:function(s,r,l,p,v,O,j,C,U,q,K,J,ce){K=Ee(K),O=ke(v,O),C&&(C=ke(j,C)),q&&(q=ke(U,q)),ce=ke(J,ce);var me=Cn(K);Qt(me,function(){bt("Cannot construct "+K+" due to unbound types",[p])}),He([s,r,l],p?[p]:[],function(de){if(de=de[0],p)var Te=de.fa,Ce=Te.qa;else Ce=Ke.prototype;de=qt(me,function(){if(Object.getPrototypeOf(this)!==Qe)throw new it("Use 'new' to construct "+K);if(Fe.oa===void 0)throw new it(K+" has no accessible constructor");var qn=Fe.oa[arguments.length];if(qn===void 0)throw new it("Tried to invoke ctor of "+K+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Fe.oa).toString()+") parameters instead!");return qn.apply(this,arguments)});var Qe=Object.create(Ce,{constructor:{value:de}});de.prototype=Qe;var Fe=new Di(K,de,Qe,ce,Te,O,C,q);Te=new Ge(K,Fe,!0,!1),Ce=new Ge(K+"*",Fe,!1,!1);var Gn=new Ge(K+" const*",Fe,!1,!0);return $n[s]={pointerType:Ce,Ja:Gn},Rn(me,de),[Te,Ce,Gn]})},i:function(s,r,l,p,v,O){0<r||oe(void 0);var j=en(r,l);v=ke(p,v),He([],[s],function(C){C=C[0];var U="constructor "+C.name;if(C.fa.oa===void 0&&(C.fa.oa=[]),C.fa.oa[r-1]!==void 0)throw new it("Cannot register multiple constructors with identical number of parameters ("+(r-1)+") for class '"+C.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return C.fa.oa[r-1]=()=>{bt("Cannot construct "+C.name+" due to unbound types",j)},He([],j,function(q){return q.splice(1,0,null),C.fa.oa[r-1]=tn(U,q,null,v,O),[]}),[]})},a:function(s,r,l,p,v,O,j,C){var U=en(l,p);r=Ee(r),O=ke(v,O),He([],[s],function(q){function K(){bt("Cannot call "+J+" due to unbound types",U)}q=q[0];var J=q.name+"."+r;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),C&&q.fa.Ta.push(r);var ce=q.fa.qa,me=ce[r];return me===void 0||me.ia===void 0&&me.className!==q.name&&me.ua===l-2?(K.ua=l-2,K.className=q.name,ce[r]=K):(Ln(ce,r,J),ce[r].ia[l-2]=K),He([],U,function(de){return de=tn(J,de,q,O,j),ce[r].ia===void 0?(de.ua=l-2,ce[r]=de):ce[r].ia[l-2]=de,[]}),[]})},I:function(s,r,l){s=Ee(s),He([],[r],function(p){return p=p[0],o[s]=p.fromWireType(l),[]})},E:function(s,r){r=Ee(r),We(s,{name:r,fromWireType:function(l){var p=rn(l);return Vn(l),p},toWireType:function(l,p){return Ye(p)},argPackAdvance:8,readValueFromPointer:Xe,ja:null})},h:function(s,r,l,p){function v(){}l=wt(l),r=Ee(r),v.values={},We(s,{name:r,constructor:v,fromWireType:function(O){return this.constructor.values[O]},toWireType:function(O,j){return j.value},argPackAdvance:8,readValueFromPointer:Bi(r,l,p),ja:null}),Qt(r,v)},k:function(s,r,l){var p=It(s,"enum");r=Ee(r),s=p.constructor,p=Object.create(p.constructor.prototype,{value:{value:l},constructor:{value:qt(p.name+"_"+r,function(){})}}),s.values[l]=p,s[r]=p},q:function(s,r,l){l=wt(l),r=Ee(r),We(s,{name:r,fromWireType:function(p){return p},toWireType:function(p,v){return v},argPackAdvance:8,readValueFromPointer:Vi(r,l),ja:null})},f:function(s,r,l,p,v,O){var j=en(r,l);s=Ee(s),v=ke(p,v),Qt(s,function(){bt("Cannot call "+s+" due to unbound types",j)},r-1),He([],j,function(C){return C=[C[0],null].concat(C.slice(1)),Rn(s,tn(s,C,null,v,O),r-1),[]})},e:function(s,r,l,p,v){r=Ee(r),v===-1&&(v=4294967295),v=wt(l);var O=C=>C;if(p===0){var j=32-8*l;O=C=>C<<j>>>j}l=r.includes("unsigned")?function(C,U){return U>>>0}:function(C,U){return U},We(s,{name:r,fromWireType:O,toWireType:l,argPackAdvance:8,readValueFromPointer:ji(r,v,p!==0),ja:null})},b:function(s,r,l){function p(O){O>>=2;var j=ge;return new v(he,j[O+1],j[O])}var v=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][r];l=Ee(l),We(s,{name:l,fromWireType:p,argPackAdvance:8,readValueFromPointer:p},{Qa:!0})},p:function(s,r){r=Ee(r);var l=r==="std::string";We(s,{name:r,fromWireType:function(p){var v=ge[p>>2];if(l)for(var O=p+4,j=0;j<=v;++j){var C=p+4+j;if(j==v||te[C]==0){if(O=O?g(te,O,C-O):"",U===void 0)var U=O;else U+=String.fromCharCode(0),U+=O;O=C+1}}else{for(U=Array(v),j=0;j<v;++j)U[j]=String.fromCharCode(te[p+4+j]);U=U.join("")}return qe(p),U},toWireType:function(p,v){v instanceof ArrayBuffer&&(v=new Uint8Array(v));var O=typeof v=="string";O||v instanceof Uint8Array||v instanceof Uint8ClampedArray||v instanceof Int8Array||le("Cannot pass non-string to std::string");var j=(l&&O?()=>{for(var q=0,K=0;K<v.length;++K){var J=v.charCodeAt(K);55296<=J&&57343>=J&&(J=65536+((J&1023)<<10)|v.charCodeAt(++K)&1023),127>=J?++q:q=2047>=J?q+2:65535>=J?q+3:q+4}return q}:()=>v.length)(),C=ln(4+j+1);if(ge[C>>2]=j,l&&O)d(v,C+4,j+1);else if(O)for(O=0;O<j;++O){var U=v.charCodeAt(O);255<U&&(qe(C),le("String has UTF-16 code units that do not fit in 8 bits")),te[C+4+O]=U}else for(O=0;O<j;++O)te[C+4+O]=v[O];return p!==null&&p.push(qe,C),C},argPackAdvance:8,readValueFromPointer:Xe,ja:function(p){qe(p)}})},m:function(s,r,l){if(l=Ee(l),r===2)var p=k,v=ie,O=ne,j=()=>fe,C=1;else r===4&&(p=M,v=W,O=se,j=()=>ge,C=2);We(s,{name:l,fromWireType:function(U){for(var q=ge[U>>2],K=j(),J,ce=U+4,me=0;me<=q;++me){var de=U+4+me*r;(me==q||K[de>>C]==0)&&(ce=p(ce,de-ce),J===void 0?J=ce:(J+=String.fromCharCode(0),J+=ce),ce=de+r)}return qe(U),J},toWireType:function(U,q){typeof q!="string"&&le("Cannot pass non-string to C++ string type "+l);var K=O(q),J=ln(4+K+r);return ge[J>>2]=K>>C,v(q,J+4,K+r),U!==null&&U.push(qe,J),J},argPackAdvance:8,readValueFromPointer:Xe,ja:function(U){qe(U)}})},t:function(s,r,l,p,v,O){ve[s]={name:Ee(r),sa:ke(l,p),la:ke(v,O),elements:[]}},s:function(s,r,l,p,v,O,j,C,U){ve[s].elements.push({Aa:r,ya:ke(l,p),za:v,Ea:O,Da:ke(j,C),Fa:U})},v:function(s,r,l,p,v,O){vt[s]={name:Ee(r),sa:ke(l,p),la:ke(v,O),Ha:[]}},j:function(s,r,l,p,v,O,j,C,U,q){vt[s].Ha.push({Na:Ee(r),Aa:l,ya:ke(p,v),za:O,Ea:j,Da:ke(C,U),Fa:q})},G:function(s,r){r=Ee(r),We(s,{Ra:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,r,l,p){s=an[s],r=rn(r),l=sn(l),s(r,l,null,p)},J:Vn,x:function(s){return s===0?Ye(jn()):(s=sn(s),Ye(jn()[s]))},c:function(s,r){var l=Xi(s,r),p=l[0];r=p.name+"_$"+l.slice(1).map(function(j){return j.name}).join("_")+"$";var v=Un[r];if(v!==void 0)return v;var O=Array(s-1);return v=Wi((j,C,U,q)=>{for(var K=0,J=0;J<s-1;++J)O[J]=l[J+1].readValueFromPointer(q+K),K+=l[J+1].argPackAdvance;for(j=j[C].apply(j,O),J=0;J<s-1;++J)l[J+1].Ka&&l[J+1].Ka(O[J]);if(!p.Ra)return p.toWireType(U,j)}),Un[r]=v},n:function(s){4<s&&(Ve[s].Ca+=1)},w:function(s,r,l,p){s=rn(s);var v=Wn[r];return v||(v=Hi(r),Wn[r]=v),v(s,l,p)},K:function(){return Ye([])},D:function(s){return Ye(sn(s))},H:function(s,r){return s=It(s,"_emval_take_value"),s=s.readValueFromPointer(r),Ye(s)},g:function(){oe("")},B:function(s){var r=te.length;if(s>>>=0,2147483648<s)return!1;for(var l=1;4>=l;l*=2){var p=r*(1+.2/l);p=Math.min(p,s+100663296),p=Math.max(s,p),0<p%65536&&(p+=65536-p%65536);e:{try{y.grow(Math.min(2147483648,p)-he.byteLength+65535>>>16),Le();var v=1;break e}catch{}v=void 0}if(v)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,r,l,p){for(var v=0,O=0;O<l;O++){var j=re[r>>2],C=re[r+4>>2];r+=8;for(var U=0;U<C;U++){var q=te[j+U],K=Gi[s];q===0||q===10?((s===1?F:R)(g(K,0)),K.length=0):K.push(q)}v+=C}return re[p>>2]=v,0},A:function(){}};(function(){function s(v){o.asm=v.exports,y=o.asm.L,Le(),X=o.asm._,h.unshift(o.asm.M),V--,o.monitorRunDependencies&&o.monitorRunDependencies(V),V==0&&z&&(v=z,z=null,v())}function r(v){s(v.instance)}function l(v){return Ae().then(function(O){return WebAssembly.instantiate(O,p)}).then(function(O){return O}).then(v,function(O){R("failed to asynchronously prepare wasm: "+O),oe(O)})}var p={a:qi};if(V++,o.monitorRunDependencies&&o.monitorRunDependencies(V),o.instantiateWasm)try{return o.instantiateWasm(p,s)}catch(v){return R("Module.instantiateWasm callback failed with error: "+v),!1}return function(){return Q||typeof WebAssembly.instantiateStreaming!="function"||ye()||ue.startsWith("file://")||typeof fetch!="function"?l(r):fetch(ue,{credentials:"same-origin"}).then(function(v){return WebAssembly.instantiateStreaming(v,p).then(r,function(O){return R("wasm streaming compile failed: "+O),R("falling back to ArrayBuffer instantiation"),l(r)})})}().catch(A),{}})(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.M).apply(null,arguments)},o.__Z6ToCmdsRK6SkPath=function(){return(o.__Z6ToCmdsRK6SkPath=o.asm.N).apply(null,arguments)},o.__Z8FromCmdsmi=function(){return(o.__Z8FromCmdsmi=o.asm.O).apply(null,arguments)},o.__Z7NewPathv=function(){return(o.__Z7NewPathv=o.asm.P).apply(null,arguments)},o.__Z8CopyPathRK6SkPath=function(){return(o.__Z8CopyPathRK6SkPath=o.asm.Q).apply(null,arguments)},o.__Z6EqualsRK6SkPathS1_=function(){return(o.__Z6EqualsRK6SkPathS1_=o.asm.R).apply(null,arguments)},o.__Z11ToSVGStringRK6SkPath=function(){return(o.__Z11ToSVGStringRK6SkPath=o.asm.S).apply(null,arguments)},o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=o.asm.T).apply(null,arguments)},o.__Z13ApplySimplifyR6SkPath=function(){return(o.__Z13ApplySimplifyR6SkPath=o.asm.U).apply(null,arguments)},o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=o.asm.V).apply(null,arguments)},o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=o.asm.W).apply(null,arguments)},o.__Z14ResolveBuilderR11SkOpBuilder=function(){return(o.__Z14ResolveBuilderR11SkOpBuilder=o.asm.X).apply(null,arguments)},o.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(o.__Z8ToCanvasRK6SkPathN10emscripten3valE=o.asm.Y).apply(null,arguments)},o.__Z8ToPath2DRK6SkPath=function(){return(o.__Z8ToPath2DRK6SkPath=o.asm.Z).apply(null,arguments)};var qe=o._free=function(){return(qe=o._free=o.asm.$).apply(null,arguments)},ln=o._malloc=function(){return(ln=o._malloc=o.asm.aa).apply(null,arguments)},Hn=o.___getTypeName=function(){return(Hn=o.___getTypeName=o.asm.ba).apply(null,arguments)};o.___embind_register_native_and_builtin_types=function(){return(o.___embind_register_native_and_builtin_types=o.asm.ca).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.da).apply(null,arguments)};var St;z=function s(){St||un(),St||(z=s)};function un(){function s(){if(!St&&(St=!0,o.calledRun=!0,!I)){if(be(h),w(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var r=o.postRun.shift();m.unshift(r)}be(m)}}if(!(0<V)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)B();be(c),0<V||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),s()},1)):s())}}if(o.run=un,o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return un(),a.ready}})();i.exports=t})(gi);var ir=gi.exports;const rr=fi(ir),or="/assets/pathkit-1356ccfa.wasm";let Me=null,Ft="",Rt="",Mt="",Bt="";async function mi(){await Y.scene.local.deleteItems([Bt,Ft,Rt,Mt]),Ft="",Rt="",Bt="",Mt="",await Y.popover.close(D.POLYTOOLID)}async function yi(){if(!Me)return;const[i,e]=Me;e(),Me=null,mi()}async function vi(){if(!Me)return;const[i,e]=Me,t=i(n=>{n.visible=!1,n.metadata[`${D.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&Y.scene.items.addItems([t]),e(),Me=null,mi()}async function sr(i,e){if(!e.transformer)if(Me)if(e.target&&(e.target.id===Ft||e.target.id===Rt))vi();else if(e.target&&(e.target.id===Bt||e.target.id===Mt))yi();else{const[t]=Me;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Lt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=di().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Me=await Y.interaction.startItemInteraction(n);const a=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),o=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Lt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await Y.scene.local.addItems([t,a,o,u]),Ft=t.id,Rt=a.id,Bt=u.id,Mt=o.id,await Y.popover.open({id:D.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function ar(i,e){if(!Me||e.transformer)return;const[t]=Me,n=Math.round(H.gridDpi/H.gridSnap),a=Math.round(e.pointerPosition.x/H.gridDpi)*H.gridDpi,o=Math.round(e.pointerPosition.y/H.gridDpi)*H.gridDpi,u=Math.abs(a-e.pointerPosition.x),w=Math.abs(o-e.pointerPosition.y);let A,_;u<=n?A=a:A=e.pointerPosition.x,w<=n?_=o:_=e.pointerPosition.y,t(x=>{x.points[x.points.length-1]=H.snap?{x:A,y:_}:e.pointerPosition})}function lr(i,e){Me&&(e.key=="Escape"?yi():e.key=="Enter"&&vi())}const fn={onToolClick:sr,onToolMove:ar,onKeyDown:lr};let Be=null,pt="",ht="",Vt="",jt="";async function wi(){await Y.scene.local.deleteItems([jt,pt,ht,Vt]),pt="",ht="",jt="",Vt="",await Y.popover.close(D.LINETOOLID)}async function _i(){if(!Be)return;const[i,e]=Be;e(),Be=null,await wi()}async function bi(){if(!Be)return;const[i,e]=Be,t=i(n=>{n.visible=!1,n.metadata[`${D.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await Y.scene.items.addItems([t]),e(),Be=null,await wi()}async function ur(i,e){if(!e.transformer)if(Be)if(e.target&&(e.target.id===pt||e.target.id===ht))await bi();else if(e.target&&(e.target.id===jt||e.target.id===Vt))await _i();else{const[t]=Be;t(n=>{n.points.push(e.pointerPosition)}),await Y.scene.local.updateItems(n=>n.id==ht||n.id==pt,n=>{for(const a of n)a.position=e.pointerPosition})}else{const t=Lt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=di().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Be=await Y.interaction.startItemInteraction(n);const a=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),o=st().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Lt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await Y.scene.local.addItems([t,a,o,u]),pt=t.id,ht=a.id,jt=u.id,Vt=o.id,await Y.popover.open({id:D.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function cr(i,e){if(!Be||e.transformer)return;const[t]=Be,n=Math.round(H.gridDpi/H.gridSnap),a=Math.round(e.pointerPosition.x/H.gridDpi)*H.gridDpi,o=Math.round(e.pointerPosition.y/H.gridDpi)*H.gridDpi,u=Math.abs(a-e.pointerPosition.x),w=Math.abs(o-e.pointerPosition.y);let A,_;u<=n?A=a:A=e.pointerPosition.x,w<=n?_=o:_=e.pointerPosition.y,t(x=>{x.points[x.points.length-1]=H.snap?{x:A,y:_}:e.pointerPosition})}function dr(i,e){Be&&(e.key=="Escape"?_i():e.key=="Enter"&&bi())}const pn={onToolClick:ur,onToolMove:cr,onKeyDown:dr};class zn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Ot(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ii={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,a,o){function u(_,x){if(!a[_]){if(!n[_]){var N=typeof Ot=="function"&&Ot;if(!x&&N)return N(_,!0);if(w)return w(_,!0);throw new Error("Cannot find module '"+_+"'")}x=a[_]={exports:{}},n[_][0].call(x.exports,function(L){var ee=n[_][1][L];return u(ee||L)},x,x.exports,t,n,a,o)}return a[_].exports}for(var w=typeof Ot=="function"&&Ot,A=0;A<o.length;A++)u(o[A]);return u}({1:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){var E=t("crypto");function G(y,I){I=T(y,I);var f;return(f=I.algorithm!=="passthrough"?E.createHash(I.algorithm):new Q).write===void 0&&(f.write=f.update,f.end=f.update),R(I,f).dispatch(y),f.update||f.end(""),f.digest?f.digest(I.encoding==="buffer"?void 0:I.encoding):(y=f.read(),I.encoding!=="buffer"?y.toString(I.encoding):y)}(a=n.exports=G).sha1=function(y){return G(y)},a.keys=function(y){return G(y,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},a.MD5=function(y){return G(y,{algorithm:"md5",encoding:"hex"})},a.keysMD5=function(y){return G(y,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var S=E.getHashes?E.getHashes().slice():["sha1","md5"],P=(S.push("passthrough"),["buffer","hex","binary","base64"]);function T(y,I){var f={};if(f.algorithm=(I=I||{}).algorithm||"sha1",f.encoding=I.encoding||"hex",f.excludeValues=!!I.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=I.ignoreUnknown===!0,f.respectType=I.respectType!==!1,f.respectFunctionNames=I.respectFunctionNames!==!1,f.respectFunctionProperties=I.respectFunctionProperties!==!1,f.unorderedArrays=I.unorderedArrays===!0,f.unorderedSets=I.unorderedSets!==!1,f.unorderedObjects=I.unorderedObjects!==!1,f.replacer=I.replacer||void 0,f.excludeKeys=I.excludeKeys||void 0,y===void 0)throw new Error("Object argument required.");for(var g=0;g<S.length;++g)S[g].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=S[g]);if(S.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+S.join(", "));if(P.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+P.join(", "));return f}function F(y){if(typeof y=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(y))!=null}function R(y,I,f){f=f||[];function g(d){return I.update?I.update(d,"utf8"):I.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=y.replacer?y.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var b,k=Object.prototype.toString.call(d),ie=/\[object (.*)\]/i.exec(k);if(ie=(ie=ie?ie[1]:"unknown:["+k+"]").toLowerCase(),0<=(k=f.indexOf(d)))return this.dispatch("[CIRCULAR:"+k+"]");if(f.push(d),w!==void 0&&w.isBuffer&&w.isBuffer(d))return g("buffer:"),g(d);if(ie==="object"||ie==="function"||ie==="asyncfunction")return k=Object.keys(d),y.unorderedObjects&&(k=k.sort()),y.respectType===!1||F(d)||k.splice(0,0,"prototype","__proto__","constructor"),y.excludeKeys&&(k=k.filter(function(ne){return!y.excludeKeys(ne)})),g("object:"+k.length+":"),b=this,k.forEach(function(ne){b.dispatch(ne),g(":"),y.excludeValues||b.dispatch(d[ne]),g(",")});if(!this["_"+ie]){if(y.ignoreUnknown)return g("["+ie+"]");throw new Error('Unknown object type "'+ie+'"')}this["_"+ie](d)},_array:function(d,ne){ne=ne!==void 0?ne:y.unorderedArrays!==!1;var k=this;if(g("array:"+d.length+":"),!ne||d.length<=1)return d.forEach(function(M){return k.dispatch(M)});var ie=[],ne=d.map(function(M){var W=new Q,se=f.slice();return R(y,W,se).dispatch(M),ie=ie.concat(se.slice(f.length)),W.read().toString()});return f=f.concat(ie),ne.sort(),this._array(ne,!1)},_date:function(d){return g("date:"+d.toJSON())},_symbol:function(d){return g("symbol:"+d.toString())},_error:function(d){return g("error:"+d.toString())},_boolean:function(d){return g("bool:"+d.toString())},_string:function(d){g("string:"+d.length+":"),g(d.toString())},_function:function(d){g("fn:"),F(d)?this.dispatch("[native]"):this.dispatch(d.toString()),y.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),y.respectFunctionProperties&&this._object(d)},_number:function(d){return g("number:"+d.toString())},_xml:function(d){return g("xml:"+d.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(d){return g("regex:"+d.toString())},_uint8array:function(d){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return g("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return g("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return g("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return g("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return g("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return g("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return g("url:"+d.toString())},_map:function(d){return g("map:"),d=Array.from(d),this._array(d,y.unorderedSets!==!1)},_set:function(d){return g("set:"),d=Array.from(d),this._array(d,y.unorderedSets!==!1)},_file:function(d){return g("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(y.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(d){return g("bigint:"+d.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function Q(){return{buf:"",write:function(y){this.buf+=y},end:function(y){this.buf+=y},read:function(){return this.buf}}}a.writeToStream=function(y,I,f){return f===void 0&&(f=I,I={}),R(I=T(y,I),f).dispatch(y)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){(function(E){var G=typeof Uint8Array<"u"?Uint8Array:Array,S="+".charCodeAt(0),P="/".charCodeAt(0),T="0".charCodeAt(0),F="a".charCodeAt(0),R="A".charCodeAt(0),Q="-".charCodeAt(0),y="_".charCodeAt(0);function I(f){return f=f.charCodeAt(0),f===S||f===Q?62:f===P||f===y?63:f<T?-1:f<T+10?f-T+26+26:f<R+26?f-R:f<F+26?f-F+26:void 0}E.toByteArray=function(f){var g,d;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var b=f.length,b=f.charAt(b-2)==="="?2:f.charAt(b-1)==="="?1:0,k=new G(3*f.length/4-b),ie=0<b?f.length-4:f.length,ne=0;function M(W){k[ne++]=W}for(g=0;g<ie;g+=4,0)M((16711680&(d=I(f.charAt(g))<<18|I(f.charAt(g+1))<<12|I(f.charAt(g+2))<<6|I(f.charAt(g+3))))>>16),M((65280&d)>>8),M(255&d);return b==2?M(255&(d=I(f.charAt(g))<<2|I(f.charAt(g+1))>>4)):b==1&&(M((d=I(f.charAt(g))<<10|I(f.charAt(g+1))<<4|I(f.charAt(g+2))>>2)>>8&255),M(255&d)),k},E.fromByteArray=function(f){var g,d,b,k,ie=f.length%3,ne="";function M(W){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(W)}for(g=0,b=f.length-ie;g<b;g+=3)d=(f[g]<<16)+(f[g+1]<<8)+f[g+2],ne+=M((k=d)>>18&63)+M(k>>12&63)+M(k>>6&63)+M(63&k);switch(ie){case 1:ne=(ne+=M((d=f[f.length-1])>>2))+M(d<<4&63)+"==";break;case 2:ne=(ne=(ne+=M((d=(f[f.length-2]<<8)+f[f.length-1])>>10))+M(d>>4&63))+M(d<<2&63)+"="}return ne}})(a===void 0?this.base64js={}:a)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,a){(function(o,u,S,A,_,x,N,L,ee){var E=t("base64-js"),G=t("ieee754");function S(c,h,m){if(!(this instanceof S))return new S(c,h,m);var B,V,z,oe,ye=typeof c;if(h==="base64"&&ye=="string")for(c=(oe=c).trim?oe.trim():oe.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(ye=="number")B=he(c);else if(ye=="string")B=S.byteLength(c,h);else{if(ye!="object")throw new Error("First argument needs to be a number, array or string.");B=he(c.length)}if(S._useTypedArrays?V=S._augment(new Uint8Array(B)):((V=this).length=B,V._isBuffer=!0),S._useTypedArrays&&typeof c.byteLength=="number")V._set(c);else if(Z(oe=c)||S.isBuffer(oe)||oe&&typeof oe=="object"&&typeof oe.length=="number")for(z=0;z<B;z++)S.isBuffer(c)?V[z]=c.readUInt8(z):V[z]=c[z];else if(ye=="string")V.write(c,0,h);else if(ye=="number"&&!S._useTypedArrays&&!m)for(z=0;z<B;z++)V[z]=0;return V}function P(c,h,m,B){return S._charsWritten=re(function(V){for(var z=[],oe=0;oe<V.length;oe++)z.push(255&V.charCodeAt(oe));return z}(h),c,m,B)}function T(c,h,m,B){return S._charsWritten=re(function(V){for(var z,oe,ye=[],ue=0;ue<V.length;ue++)oe=V.charCodeAt(ue),z=oe>>8,oe=oe%256,ye.push(oe),ye.push(z);return ye}(h),c,m,B)}function F(c,h,m){var B="";m=Math.min(c.length,m);for(var V=h;V<m;V++)B+=String.fromCharCode(c[V]);return B}function R(c,h,m,z){z||(X(typeof m=="boolean","missing or invalid endian"),X(h!=null,"missing offset"),X(h+1<c.length,"Trying to read beyond buffer length"));var V,z=c.length;if(!(z<=h))return m?(V=c[h],h+1<z&&(V|=c[h+1]<<8)):(V=c[h]<<8,h+1<z&&(V|=c[h+1])),V}function Q(c,h,m,z){z||(X(typeof m=="boolean","missing or invalid endian"),X(h!=null,"missing offset"),X(h+3<c.length,"Trying to read beyond buffer length"));var V,z=c.length;if(!(z<=h))return m?(h+2<z&&(V=c[h+2]<<16),h+1<z&&(V|=c[h+1]<<8),V|=c[h],h+3<z&&(V+=c[h+3]<<24>>>0)):(h+1<z&&(V=c[h+1]<<16),h+2<z&&(V|=c[h+2]<<8),h+3<z&&(V|=c[h+3]),V+=c[h]<<24>>>0),V}function y(c,h,m,B){if(B||(X(typeof m=="boolean","missing or invalid endian"),X(h!=null,"missing offset"),X(h+1<c.length,"Trying to read beyond buffer length")),!(c.length<=h))return B=R(c,h,m,!0),32768&B?-1*(65535-B+1):B}function I(c,h,m,B){if(B||(X(typeof m=="boolean","missing or invalid endian"),X(h!=null,"missing offset"),X(h+3<c.length,"Trying to read beyond buffer length")),!(c.length<=h))return B=Q(c,h,m,!0),2147483648&B?-1*(4294967295-B+1):B}function f(c,h,m,B){return B||(X(typeof m=="boolean","missing or invalid endian"),X(h+3<c.length,"Trying to read beyond buffer length")),G.read(c,h,m,23,4)}function g(c,h,m,B){return B||(X(typeof m=="boolean","missing or invalid endian"),X(h+7<c.length,"Trying to read beyond buffer length")),G.read(c,h,m,52,8)}function d(c,h,m,B,V){if(V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+1<c.length,"trying to write beyond buffer length"),Ie(h,65535)),V=c.length,!(V<=m))for(var z=0,oe=Math.min(V-m,2);z<oe;z++)c[m+z]=(h&255<<8*(B?z:1-z))>>>8*(B?z:1-z)}function b(c,h,m,B,V){if(V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+3<c.length,"trying to write beyond buffer length"),Ie(h,4294967295)),V=c.length,!(V<=m))for(var z=0,oe=Math.min(V-m,4);z<oe;z++)c[m+z]=h>>>8*(B?z:3-z)&255}function k(c,h,m,B,V){V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+1<c.length,"Trying to write beyond buffer length"),$e(h,32767,-32768)),c.length<=m||d(c,0<=h?h:65535+h+1,m,B,V)}function ie(c,h,m,B,V){V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+3<c.length,"Trying to write beyond buffer length"),$e(h,2147483647,-2147483648)),c.length<=m||b(c,0<=h?h:4294967295+h+1,m,B,V)}function ne(c,h,m,B,V){V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+3<c.length,"Trying to write beyond buffer length"),Le(h,34028234663852886e22,-34028234663852886e22)),c.length<=m||G.write(c,h,m,B,23,4)}function M(c,h,m,B,V){V||(X(h!=null,"missing value"),X(typeof B=="boolean","missing or invalid endian"),X(m!=null,"missing offset"),X(m+7<c.length,"Trying to write beyond buffer length"),Le(h,17976931348623157e292,-17976931348623157e292)),c.length<=m||G.write(c,h,m,B,52,8)}a.Buffer=S,a.SlowBuffer=S,a.INSPECT_MAX_BYTES=50,S.poolSize=8192,S._useTypedArrays=function(){try{var c=new ArrayBuffer(0),h=new Uint8Array(c);return h.foo=function(){return 42},h.foo()===42&&typeof h.subarray=="function"}catch{return!1}}(),S.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.isBuffer=function(c){return!(c==null||!c._isBuffer)},S.byteLength=function(c,h){var m;switch(c+="",h||"utf8"){case"hex":m=c.length/2;break;case"utf8":case"utf-8":m=ae(c).length;break;case"ascii":case"binary":case"raw":m=c.length;break;case"base64":m=fe(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=2*c.length;break;default:throw new Error("Unknown encoding")}return m},S.concat=function(c,h){if(X(Z(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new S(0);if(c.length===1)return c[0];if(typeof h!="number")for(V=h=0;V<c.length;V++)h+=c[V].length;for(var m=new S(h),B=0,V=0;V<c.length;V++){var z=c[V];z.copy(m,B),B+=z.length}return m},S.prototype.write=function(c,h,m,B){isFinite(h)?isFinite(m)||(B=m,m=void 0):(ue=B,B=h,h=m,m=ue),h=Number(h)||0;var V,z,oe,ye,ue=this.length-h;switch((!m||ue<(m=Number(m)))&&(m=ue),B=String(B||"utf8").toLowerCase()){case"hex":V=function(De,Se,Ae,be){Ae=Number(Ae)||0;var ve=De.length-Ae;(!be||ve<(be=Number(be)))&&(be=ve),X((ve=Se.length)%2==0,"Invalid hex string"),ve/2<be&&(be=ve/2);for(var Ue=0;Ue<be;Ue++){var Xe=parseInt(Se.substr(2*Ue,2),16);X(!isNaN(Xe),"Invalid hex string"),De[Ae+Ue]=Xe}return S._charsWritten=2*Ue,Ue}(this,c,h,m);break;case"utf8":case"utf-8":z=this,oe=h,ye=m,V=S._charsWritten=re(ae(c),z,oe,ye);break;case"ascii":case"binary":V=P(this,c,h,m);break;case"base64":z=this,oe=h,ye=m,V=S._charsWritten=re(fe(c),z,oe,ye);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":V=T(this,c,h,m);break;default:throw new Error("Unknown encoding")}return V},S.prototype.toString=function(c,h,m){var B,V,z,oe,ye=this;if(c=String(c||"utf8").toLowerCase(),h=Number(h)||0,(m=m!==void 0?Number(m):ye.length)===h)return"";switch(c){case"hex":B=function(ue,De,Se){var Ae=ue.length;(!De||De<0)&&(De=0),(!Se||Se<0||Ae<Se)&&(Se=Ae);for(var be="",ve=De;ve<Se;ve++)be+=te(ue[ve]);return be}(ye,h,m);break;case"utf8":case"utf-8":B=function(ue,De,Se){var Ae="",be="";Se=Math.min(ue.length,Se);for(var ve=De;ve<Se;ve++)ue[ve]<=127?(Ae+=ge(be)+String.fromCharCode(ue[ve]),be=""):be+="%"+ue[ve].toString(16);return Ae+ge(be)}(ye,h,m);break;case"ascii":case"binary":B=F(ye,h,m);break;case"base64":V=ye,oe=m,B=(z=h)===0&&oe===V.length?E.fromByteArray(V):E.fromByteArray(V.slice(z,oe));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":B=function(ue,De,Se){for(var Ae=ue.slice(De,Se),be="",ve=0;ve<Ae.length;ve+=2)be+=String.fromCharCode(Ae[ve]+256*Ae[ve+1]);return be}(ye,h,m);break;default:throw new Error("Unknown encoding")}return B},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},S.prototype.copy=function(c,h,m,B){if(h=h||0,(B=B||B===0?B:this.length)!==(m=m||0)&&c.length!==0&&this.length!==0){X(m<=B,"sourceEnd < sourceStart"),X(0<=h&&h<c.length,"targetStart out of bounds"),X(0<=m&&m<this.length,"sourceStart out of bounds"),X(0<=B&&B<=this.length,"sourceEnd out of bounds"),B>this.length&&(B=this.length);var V=(B=c.length-h<B-m?c.length-h+m:B)-m;if(V<100||!S._useTypedArrays)for(var z=0;z<V;z++)c[z+h]=this[z+m];else c._set(this.subarray(m,m+V),h)}},S.prototype.slice=function(c,h){var m=this.length;if(c=se(c,m,0),h=se(h,m,m),S._useTypedArrays)return S._augment(this.subarray(c,h));for(var B=h-c,V=new S(B,void 0,!0),z=0;z<B;z++)V[z]=this[z+c];return V},S.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},S.prototype.set=function(c,h){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,h)},S.prototype.readUInt8=function(c,h){if(h||(X(c!=null,"missing offset"),X(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},S.prototype.readUInt16LE=function(c,h){return R(this,c,!0,h)},S.prototype.readUInt16BE=function(c,h){return R(this,c,!1,h)},S.prototype.readUInt32LE=function(c,h){return Q(this,c,!0,h)},S.prototype.readUInt32BE=function(c,h){return Q(this,c,!1,h)},S.prototype.readInt8=function(c,h){if(h||(X(c!=null,"missing offset"),X(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},S.prototype.readInt16LE=function(c,h){return y(this,c,!0,h)},S.prototype.readInt16BE=function(c,h){return y(this,c,!1,h)},S.prototype.readInt32LE=function(c,h){return I(this,c,!0,h)},S.prototype.readInt32BE=function(c,h){return I(this,c,!1,h)},S.prototype.readFloatLE=function(c,h){return f(this,c,!0,h)},S.prototype.readFloatBE=function(c,h){return f(this,c,!1,h)},S.prototype.readDoubleLE=function(c,h){return g(this,c,!0,h)},S.prototype.readDoubleBE=function(c,h){return g(this,c,!1,h)},S.prototype.writeUInt8=function(c,h,m){m||(X(c!=null,"missing value"),X(h!=null,"missing offset"),X(h<this.length,"trying to write beyond buffer length"),Ie(c,255)),h>=this.length||(this[h]=c)},S.prototype.writeUInt16LE=function(c,h,m){d(this,c,h,!0,m)},S.prototype.writeUInt16BE=function(c,h,m){d(this,c,h,!1,m)},S.prototype.writeUInt32LE=function(c,h,m){b(this,c,h,!0,m)},S.prototype.writeUInt32BE=function(c,h,m){b(this,c,h,!1,m)},S.prototype.writeInt8=function(c,h,m){m||(X(c!=null,"missing value"),X(h!=null,"missing offset"),X(h<this.length,"Trying to write beyond buffer length"),$e(c,127,-128)),h>=this.length||(0<=c?this.writeUInt8(c,h,m):this.writeUInt8(255+c+1,h,m))},S.prototype.writeInt16LE=function(c,h,m){k(this,c,h,!0,m)},S.prototype.writeInt16BE=function(c,h,m){k(this,c,h,!1,m)},S.prototype.writeInt32LE=function(c,h,m){ie(this,c,h,!0,m)},S.prototype.writeInt32BE=function(c,h,m){ie(this,c,h,!1,m)},S.prototype.writeFloatLE=function(c,h,m){ne(this,c,h,!0,m)},S.prototype.writeFloatBE=function(c,h,m){ne(this,c,h,!1,m)},S.prototype.writeDoubleLE=function(c,h,m){M(this,c,h,!0,m)},S.prototype.writeDoubleBE=function(c,h,m){M(this,c,h,!1,m)},S.prototype.fill=function(c,h,m){if(h=h||0,m=m||this.length,X(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),X(h<=m,"end < start"),m!==h&&this.length!==0){X(0<=h&&h<this.length,"start out of bounds"),X(0<=m&&m<=this.length,"end out of bounds");for(var B=h;B<m;B++)this[B]=c}},S.prototype.inspect=function(){for(var c=[],h=this.length,m=0;m<h;m++)if(c[m]=te(this[m]),m===a.INSPECT_MAX_BYTES){c[m+1]="...";break}return"<Buffer "+c.join(" ")+">"},S.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(S._useTypedArrays)return new S(this).buffer;for(var c=new Uint8Array(this.length),h=0,m=c.length;h<m;h+=1)c[h]=this[h];return c.buffer};var W=S.prototype;function se(c,h,m){return typeof c!="number"?m:h<=(c=~~c)?h:0<=c||0<=(c+=h)?c:0}function he(c){return(c=~~Math.ceil(+c))<0?0:c}function Z(c){return(Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"})(c)}function te(c){return c<16?"0"+c.toString(16):c.toString(16)}function ae(c){for(var h=[],m=0;m<c.length;m++){var B=c.charCodeAt(m);if(B<=127)h.push(c.charCodeAt(m));else for(var V=m,z=(55296<=B&&B<=57343&&m++,encodeURIComponent(c.slice(V,m+1)).substr(1).split("%")),oe=0;oe<z.length;oe++)h.push(parseInt(z[oe],16))}return h}function fe(c){return E.toByteArray(c)}function re(c,h,m,B){for(var V=0;V<B&&!(V+m>=h.length||V>=c.length);V++)h[V+m]=c[V];return V}function ge(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function Ie(c,h){X(typeof c=="number","cannot write a non-number as a number"),X(0<=c,"specified a negative value for writing an unsigned value"),X(c<=h,"value is larger than maximum value for type"),X(Math.floor(c)===c,"value has a fractional component")}function $e(c,h,m){X(typeof c=="number","cannot write a non-number as a number"),X(c<=h,"value larger than maximum allowed value"),X(m<=c,"value smaller than minimum allowed value"),X(Math.floor(c)===c,"value has a fractional component")}function Le(c,h,m){X(typeof c=="number","cannot write a non-number as a number"),X(c<=h,"value larger than maximum allowed value"),X(m<=c,"value smaller than minimum allowed value")}function X(c,h){if(!c)throw new Error(h||"Failed assertion")}S._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=W.get,c.set=W.set,c.write=W.write,c.toString=W.toString,c.toLocaleString=W.toString,c.toJSON=W.toJSON,c.copy=W.copy,c.slice=W.slice,c.readUInt8=W.readUInt8,c.readUInt16LE=W.readUInt16LE,c.readUInt16BE=W.readUInt16BE,c.readUInt32LE=W.readUInt32LE,c.readUInt32BE=W.readUInt32BE,c.readInt8=W.readInt8,c.readInt16LE=W.readInt16LE,c.readInt16BE=W.readInt16BE,c.readInt32LE=W.readInt32LE,c.readInt32BE=W.readInt32BE,c.readFloatLE=W.readFloatLE,c.readFloatBE=W.readFloatBE,c.readDoubleLE=W.readDoubleLE,c.readDoubleBE=W.readDoubleBE,c.writeUInt8=W.writeUInt8,c.writeUInt16LE=W.writeUInt16LE,c.writeUInt16BE=W.writeUInt16BE,c.writeUInt32LE=W.writeUInt32LE,c.writeUInt32BE=W.writeUInt32BE,c.writeInt8=W.writeInt8,c.writeInt16LE=W.writeInt16LE,c.writeInt16BE=W.writeInt16BE,c.writeInt32LE=W.writeInt32LE,c.writeInt32BE=W.writeInt32BE,c.writeFloatLE=W.writeFloatLE,c.writeFloatBE=W.writeFloatBE,c.writeDoubleLE=W.writeDoubleLE,c.writeDoubleBE=W.writeDoubleBE,c.fill=W.fill,c.inspect=W.inspect,c.toArrayBuffer=W.toArrayBuffer,c}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,a){(function(o,u,E,A,_,x,N,L,ee){var E=t("buffer").Buffer,G=4,S=new E(G);S.fill(0),n.exports={hash:function(P,T,F,R){for(var Q=T(function(d,b){d.length%G!=0&&(k=d.length+(G-d.length%G),d=E.concat([d,S],k));for(var k,ie=[],ne=b?d.readInt32BE:d.readInt32LE,M=0;M<d.length;M+=G)ie.push(ne.call(d,M));return ie}(P=E.isBuffer(P)?P:new E(P),R),8*P.length),T=R,y=new E(F),I=T?y.writeInt32BE:y.writeInt32LE,f=0;f<Q.length;f++)I.call(y,Q[f],4*f,!0);return y}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,a){(function(o,u,E,A,_,x,N,L,ee){var E=t("buffer").Buffer,G=t("./sha"),S=t("./sha256"),P=t("./rng"),T={sha1:G,sha256:S,md5:t("./md5")},F=64,R=new E(F);function Q(d,b){var k=T[d=d||"sha1"],ie=[];return k||y("algorithm:",d,"is not yet supported"),{update:function(ne){return E.isBuffer(ne)||(ne=new E(ne)),ie.push(ne),ne.length,this},digest:function(ne){var M=E.concat(ie),M=b?function(W,se,he){E.isBuffer(se)||(se=new E(se)),E.isBuffer(he)||(he=new E(he)),se.length>F?se=W(se):se.length<F&&(se=E.concat([se,R],F));for(var Z=new E(F),te=new E(F),ae=0;ae<F;ae++)Z[ae]=54^se[ae],te[ae]=92^se[ae];return he=W(E.concat([Z,he])),W(E.concat([te,he]))}(k,b,M):k(M);return ie=null,ne?M.toString(ne):M}}}function y(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}R.fill(0),a.createHash=function(d){return Q(d)},a.createHmac=Q,a.randomBytes=function(d,b){if(!b||!b.call)return new E(P(d));try{b.call(this,void 0,new E(P(d)))}catch(k){b(k)}};var I,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(d){a[d]=function(){y("sorry,",d,"is not implemented yet")}};for(I in f)g(f[I])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){var E=t("./helpers");function G(y,I){y[I>>5]|=128<<I%32,y[14+(I+64>>>9<<4)]=I;for(var f=1732584193,g=-271733879,d=-1732584194,b=271733878,k=0;k<y.length;k+=16){var ie=f,ne=g,M=d,W=b,f=P(f,g,d,b,y[k+0],7,-680876936),b=P(b,f,g,d,y[k+1],12,-389564586),d=P(d,b,f,g,y[k+2],17,606105819),g=P(g,d,b,f,y[k+3],22,-1044525330);f=P(f,g,d,b,y[k+4],7,-176418897),b=P(b,f,g,d,y[k+5],12,1200080426),d=P(d,b,f,g,y[k+6],17,-1473231341),g=P(g,d,b,f,y[k+7],22,-45705983),f=P(f,g,d,b,y[k+8],7,1770035416),b=P(b,f,g,d,y[k+9],12,-1958414417),d=P(d,b,f,g,y[k+10],17,-42063),g=P(g,d,b,f,y[k+11],22,-1990404162),f=P(f,g,d,b,y[k+12],7,1804603682),b=P(b,f,g,d,y[k+13],12,-40341101),d=P(d,b,f,g,y[k+14],17,-1502002290),f=T(f,g=P(g,d,b,f,y[k+15],22,1236535329),d,b,y[k+1],5,-165796510),b=T(b,f,g,d,y[k+6],9,-1069501632),d=T(d,b,f,g,y[k+11],14,643717713),g=T(g,d,b,f,y[k+0],20,-373897302),f=T(f,g,d,b,y[k+5],5,-701558691),b=T(b,f,g,d,y[k+10],9,38016083),d=T(d,b,f,g,y[k+15],14,-660478335),g=T(g,d,b,f,y[k+4],20,-405537848),f=T(f,g,d,b,y[k+9],5,568446438),b=T(b,f,g,d,y[k+14],9,-1019803690),d=T(d,b,f,g,y[k+3],14,-187363961),g=T(g,d,b,f,y[k+8],20,1163531501),f=T(f,g,d,b,y[k+13],5,-1444681467),b=T(b,f,g,d,y[k+2],9,-51403784),d=T(d,b,f,g,y[k+7],14,1735328473),f=F(f,g=T(g,d,b,f,y[k+12],20,-1926607734),d,b,y[k+5],4,-378558),b=F(b,f,g,d,y[k+8],11,-2022574463),d=F(d,b,f,g,y[k+11],16,1839030562),g=F(g,d,b,f,y[k+14],23,-35309556),f=F(f,g,d,b,y[k+1],4,-1530992060),b=F(b,f,g,d,y[k+4],11,1272893353),d=F(d,b,f,g,y[k+7],16,-155497632),g=F(g,d,b,f,y[k+10],23,-1094730640),f=F(f,g,d,b,y[k+13],4,681279174),b=F(b,f,g,d,y[k+0],11,-358537222),d=F(d,b,f,g,y[k+3],16,-722521979),g=F(g,d,b,f,y[k+6],23,76029189),f=F(f,g,d,b,y[k+9],4,-640364487),b=F(b,f,g,d,y[k+12],11,-421815835),d=F(d,b,f,g,y[k+15],16,530742520),f=R(f,g=F(g,d,b,f,y[k+2],23,-995338651),d,b,y[k+0],6,-198630844),b=R(b,f,g,d,y[k+7],10,1126891415),d=R(d,b,f,g,y[k+14],15,-1416354905),g=R(g,d,b,f,y[k+5],21,-57434055),f=R(f,g,d,b,y[k+12],6,1700485571),b=R(b,f,g,d,y[k+3],10,-1894986606),d=R(d,b,f,g,y[k+10],15,-1051523),g=R(g,d,b,f,y[k+1],21,-2054922799),f=R(f,g,d,b,y[k+8],6,1873313359),b=R(b,f,g,d,y[k+15],10,-30611744),d=R(d,b,f,g,y[k+6],15,-1560198380),g=R(g,d,b,f,y[k+13],21,1309151649),f=R(f,g,d,b,y[k+4],6,-145523070),b=R(b,f,g,d,y[k+11],10,-1120210379),d=R(d,b,f,g,y[k+2],15,718787259),g=R(g,d,b,f,y[k+9],21,-343485551),f=Q(f,ie),g=Q(g,ne),d=Q(d,M),b=Q(b,W)}return Array(f,g,d,b)}function S(y,I,f,g,d,b){return Q((I=Q(Q(I,y),Q(g,b)))<<d|I>>>32-d,f)}function P(y,I,f,g,d,b,k){return S(I&f|~I&g,y,I,d,b,k)}function T(y,I,f,g,d,b,k){return S(I&g|f&~g,y,I,d,b,k)}function F(y,I,f,g,d,b,k){return S(I^f^g,y,I,d,b,k)}function R(y,I,f,g,d,b,k){return S(f^(I|~g),y,I,d,b,k)}function Q(y,I){var f=(65535&y)+(65535&I);return(y>>16)+(I>>16)+(f>>16)<<16|65535&f}n.exports=function(y){return E.hash(y,G,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){n.exports=function(E){for(var G,S=new Array(E),P=0;P<E;P++)!(3&P)&&(G=4294967296*Math.random()),S[P]=G>>>((3&P)<<3)&255;return S}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){var E=t("./helpers");function G(T,F){T[F>>5]|=128<<24-F%32,T[15+(F+64>>9<<4)]=F;for(var R,Q,y,I=Array(80),f=1732584193,g=-271733879,d=-1732584194,b=271733878,k=-1009589776,ie=0;ie<T.length;ie+=16){for(var ne=f,M=g,W=d,se=b,he=k,Z=0;Z<80;Z++){I[Z]=Z<16?T[ie+Z]:P(I[Z-3]^I[Z-8]^I[Z-14]^I[Z-16],1);var te=S(S(P(f,5),(te=g,Q=d,y=b,(R=Z)<20?te&Q|~te&y:!(R<40)&&R<60?te&Q|te&y|Q&y:te^Q^y)),S(S(k,I[Z]),(R=Z)<20?1518500249:R<40?1859775393:R<60?-1894007588:-899497514)),k=b,b=d,d=P(g,30),g=f,f=te}f=S(f,ne),g=S(g,M),d=S(d,W),b=S(b,se),k=S(k,he)}return Array(f,g,d,b,k)}function S(T,F){var R=(65535&T)+(65535&F);return(T>>16)+(F>>16)+(R>>16)<<16|65535&R}function P(T,F){return T<<F|T>>>32-F}n.exports=function(T){return E.hash(T,G,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){function E(F,R){var Q=(65535&F)+(65535&R);return(F>>16)+(R>>16)+(Q>>16)<<16|65535&Q}function G(F,R){var Q,y=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),I=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);F[R>>5]|=128<<24-R%32,F[15+(R+64>>9<<4)]=R;for(var g,d,b=0;b<F.length;b+=16){for(var k=I[0],ie=I[1],ne=I[2],M=I[3],W=I[4],se=I[5],he=I[6],Z=I[7],te=0;te<64;te++)f[te]=te<16?F[te+b]:E(E(E((d=f[te-2],P(d,17)^P(d,19)^T(d,10)),f[te-7]),(d=f[te-15],P(d,7)^P(d,18)^T(d,3))),f[te-16]),Q=E(E(E(E(Z,P(d=W,6)^P(d,11)^P(d,25)),W&se^~W&he),y[te]),f[te]),g=E(P(g=k,2)^P(g,13)^P(g,22),k&ie^k&ne^ie&ne),Z=he,he=se,se=W,W=E(M,Q),M=ne,ne=ie,ie=k,k=E(Q,g);I[0]=E(k,I[0]),I[1]=E(ie,I[1]),I[2]=E(ne,I[2]),I[3]=E(M,I[3]),I[4]=E(W,I[4]),I[5]=E(se,I[5]),I[6]=E(he,I[6]),I[7]=E(Z,I[7])}return I}var S=t("./helpers"),P=function(F,R){return F>>>R|F<<32-R},T=function(F,R){return F>>>R};n.exports=function(F){return S.hash(F,G,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){a.read=function(E,G,S,P,b){var F,R,Q=8*b-P-1,y=(1<<Q)-1,I=y>>1,f=-7,g=S?b-1:0,d=S?-1:1,b=E[G+g];for(g+=d,F=b&(1<<-f)-1,b>>=-f,f+=Q;0<f;F=256*F+E[G+g],g+=d,f-=8);for(R=F&(1<<-f)-1,F>>=-f,f+=P;0<f;R=256*R+E[G+g],g+=d,f-=8);if(F===0)F=1-I;else{if(F===y)return R?NaN:1/0*(b?-1:1);R+=Math.pow(2,P),F-=I}return(b?-1:1)*R*Math.pow(2,F-P)},a.write=function(E,G,S,P,T,k){var R,Q,y=8*k-T-1,I=(1<<y)-1,f=I>>1,g=T===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=P?0:k-1,b=P?1:-1,k=G<0||G===0&&1/G<0?1:0;for(G=Math.abs(G),isNaN(G)||G===1/0?(Q=isNaN(G)?1:0,R=I):(R=Math.floor(Math.log(G)/Math.LN2),G*(P=Math.pow(2,-R))<1&&(R--,P*=2),2<=(G+=1<=R+f?g/P:g*Math.pow(2,1-f))*P&&(R++,P/=2),I<=R+f?(Q=0,R=I):1<=R+f?(Q=(G*P-1)*Math.pow(2,T),R+=f):(Q=G*Math.pow(2,f-1)*Math.pow(2,T),R=0));8<=T;E[S+d]=255&Q,d+=b,Q/=256,T-=8);for(R=R<<T|Q,y+=T;0<y;E[S+d]=255&R,d+=b,R/=256,y-=8);E[S+d-b]|=128*k}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,a){(function(o,u,w,A,_,x,N,L,ee){var E,G,S;function P(){}(o=n.exports={}).nextTick=(G=typeof window<"u"&&window.setImmediate,S=typeof window<"u"&&window.postMessage&&window.addEventListener,G?function(T){return window.setImmediate(T)}:S?(E=[],window.addEventListener("message",function(T){var F=T.source;F!==window&&F!==null||T.data!=="process-tick"||(T.stopPropagation(),0<E.length&&E.shift()())},!0),function(T){E.push(T),window.postMessage("process-tick","*")}):function(T){setTimeout(T,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=P,o.addListener=P,o.once=P,o.off=P,o.removeListener=P,o.removeAllListeners=P,o.emit=P,o.binding=function(T){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(T){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Ii);var fr=Ii.exports;const At=fi(fr);class pr{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?At(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?At(e):String(e)]}getValue(e){return this.cache[this.useHash?At(e):String(e)]}isCached(e){return(this.useHash?At(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function kt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Kn(i,e){return i.x==e.x&&i.y==e.y}function Tt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function hn(i,e){return(i%e+e)%e}async function hr(){await Y.contextMenu.create({id:`${D.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${D.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){await Y.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${D.EXTENSIONID}/hasVision`]&&t.layer=="CHARACTER"?delete t.metadata[`${D.EXTENSIONID}/hasVision`]:t.layer=="CHARACTER"&&(t.metadata[`${D.EXTENSIONID}/hasVision`]=!0,t.metadata[`${D.EXTENSIONID}/visionRange`]||(t.metadata[`${D.EXTENSIONID}/visionRange`]=D.VISIONDEFAULT))})}}),await Y.contextMenu.create({id:`${D.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${D.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${D.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${D.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${D.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await Y.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${D.EXTENSIONID}/isVisionLine`]&&t.metadata[`${D.EXTENSIONID}/disabled`]?delete t.metadata[`${D.EXTENSIONID}/disabled`]:t.metadata[`${D.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${D.EXTENSIONID}/disabled`]=!0)})}}),await Y.contextMenu.create({id:`${D.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${D.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${D.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${D.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${D.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${D.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${D.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${D.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await Y.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${D.EXTENSIONID}/isVisionLine`]||t.metadata[`${D.ARMINDOID}/isVisionLine`])&&(t.metadata[`${D.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${D.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${D.EXTENSIONID}/oneSided`],delete t.metadata[`${D.ARMINDOID}/oneSided`]):(t.metadata[`${D.EXTENSIONID}/isVisionLine`]||t.metadata[`${D.ARMINDOID}/isVisionLine`])&&(t.metadata[`${D.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${D.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${D.EXTENSIONID}/oneSided`]="right",t.metadata[`${D.ARMINDOID}/oneSided`]="right"):(t.metadata[`${D.EXTENSIONID}/isVisionLine`]||t.metadata[`${D.ARMINDOID}/isVisionLine`])&&(t.metadata[`${D.EXTENSIONID}/oneSided`]="left",t.metadata[`${D.ARMINDOID}/oneSided`]="left")})}})}async function gr(){await Y.tool.create({id:`${D.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await Y.tool.activateTool(`${D.EXTENSIONID}/vision-tool`)}})}async function mr(){await Y.tool.createMode({id:`${D.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${D.EXTENSIONID}/vision-tool`]}}],onToolClick:fn.onToolClick,onToolMove:fn.onToolMove,onKeyDown:fn.onKeyDown}),await Y.tool.createMode({id:`${D.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${D.EXTENSIONID}/vision-tool`]}}],onToolClick:pn.onToolClick,onToolMove:pn.onToolMove,onKeyDown:pn.onKeyDown})}function yr(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);n&&(n.innerText=t)}}var je,tt=!1;const rt=new pr(!1);async function vr(i){if(tt=!0,je||(je=await rr({locateFile:()=>or})),!await Y.scene.isReady()){rt.invalidate((M,W)=>W.shadowPath.delete()),tt=!1;return}const e=await Y.scene.local.getItems(),{awaitTimer:t,computeTimer:n,metadata:a,size:o,offset:u,scale:w,visionShapes:A,tokensWithVision:_,invalidateCache:x}=i.detail,[N,L]=o;let ee=0,E=0;if(x&&rt.invalidate((M,W)=>W.shadowPath.delete()),n.resume(),!(a[`${D.EXTENSIONID}/visionEnabled`]===!0)||_.length==0){await Y.scene.local.deleteItems(e.filter(In).map(M=>M.id)),tt=!1;return}const S=[];for(const M of A)for(let W=0;W<M.points.length-1;W++)S.push({startPosition:{x:M.points[W].x*M.scale.x+M.position.x,y:M.points[W].y*M.scale.y+M.position.y},endPosition:{x:M.points[W+1].x*M.scale.x+M.position.x,y:M.points[W+1].y*M.scale.y+M.position.y},originalShape:M,oneSided:M.metadata[`${D.EXTENSIONID}/oneSided`]});const P=[],T=[],F=H.players.filter(M=>M.role=="GM");for(const M of _){const W=H.userId===M.createdUserId,se=F.some(Z=>Z.id==M.createdUserId);if(!W&&H.role!=="GM"&&!se)continue;const he=rt.getValue(M.id);if(P.push([]),!(he!==void 0&&Kn(he.player.position,M.position)))for(const Z of S){const te=(M.position.x-Z.startPosition.x)*(Z.endPosition.y-Z.startPosition.y)-(M.position.y-Z.startPosition.y)*(Z.endPosition.x-Z.startPosition.x);if(Z.oneSided!==void 0&&(Z.oneSided=="right"&&te>0||Z.oneSided=="left"&&te<0))continue;const ae={x:Z.startPosition.x-M.position.x,y:Z.startPosition.y-M.position.y},fe={x:Z.endPosition.x-M.position.x,y:Z.endPosition.y-M.position.y};var R={x:0,y:0},Q={x:0,y:0},y=0,I=0,f=0,g=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ae.x<0?y=u[0]*w[0]:y=(N+u[0])*w[0],ae.y<0?I=u[1]*w[1]:I=(L+u[1])*w[1],fe.x<0?f=u[0]*w[0]:f=(N+u[0])*w[0],fe.y<0?g=u[1]*w[1]:g=(L+u[1])*w[1];const re=[],ge=[];if(ae.x!=0){const m=ae.y/ae.x,B=Z.startPosition.y-m*Z.startPosition.x;re.push({x:y,y:m*y+B})}if(ae.y!=0){const m=ae.x/ae.y,B=m*Z.startPosition.y-Z.startPosition.x;re.push({x:m*I-B,y:I})}if(fe.x!=0){const m=fe.y/fe.x,B=Z.endPosition.y-m*Z.endPosition.x;ge.push({x:f,y:m*f+B})}if(fe.y!=0){const m=fe.x/fe.y,B=m*Z.endPosition.y-Z.endPosition.x;ge.push({x:m*g-B,y:g})}re.length==1||kt(re[0],Z.startPosition)<kt(re[1],Z.startPosition)?R=re[0]:R=re[1],ge.length==1||kt(ge[0],Z.endPosition)<kt(ge[1],Z.endPosition)?Q=ge[0]:Q=ge[1];const Ie=[{x:Z.startPosition.x,y:Z.startPosition.y},R,Q,{x:Z.endPosition.x,y:Z.endPosition.y}],$e=[{x:(N+u[0])*w[0],y:u[1]*w[1]},{x:(N+u[0])*w[0],y:(L+u[1])*w[1]},{x:u[0]*w[0],y:(L+u[1])*w[1]},{x:u[0]*w[0],y:u[1]*w[1]}],Le=[0,0];let X=0;for(const m of[R,Q])Tt(m.y,u[1]*w[1])?Le[X]=0:Tt(m.y,(L+u[1])*w[1])?Le[X]=2:Tt(m.x,u[0]*w[0])?Le[X]=3:Tt(m.x,(N+u[0])*w[0])&&(Le[X]=1),X++;let c=Math.sign(te);c=c==0?1:-c;const h=c==1?Le[1]:hn(Le[1]-1,4);for(let m=Le[0]+(c==1?0:-1);hn(m,4)!=h;m+=c)Ie.splice(Ie.length-2,0,$e[hn(m,4)]);P[P.length-1].push({pointset:Ie,fromShape:Z.originalShape})}}if(P.length==0){tt=!1;return}const d={};for(let M=0;M<P.length;M++){const W=_[M];let se=rt.getValue(W.id);if(se!==void 0&&Kn(se.player.position,W.position)){d[M]=se.shadowPath.copy(),ee++;continue}E++;const he=P[M],Z=new je.SkOpBuilder,te=je.NewPath().rect(u[0],u[1],o[0],o[1]);Z.add(te,je.PathOp.UNION),te.delete();for(const fe of he){const re=fe.fromShape,ge=je.NewPath();ge.moveTo(fe.pointset[0].x,fe.pointset[0].y);for(let Ie=1;Ie<fe.pointset.length;Ie++)ge.lineTo(fe.pointset[Ie].x,fe.pointset[Ie].y);if(re.style.closed!=!1){const Ie=je.NewPath();Ie.moveTo(re.points[0].x*re.scale.x+re.position.x,re.points[0].y*re.scale.y+re.position.y);for(let $e=1;$e<re.points.length-1;$e++)Ie.lineTo(re.points[$e].x*re.scale.x+re.position.x,re.points[$e].y*re.scale.y+re.position.y);ge.op(Ie,je.PathOp.DIFFERENCE),Ie.delete()}Z.add(ge,je.PathOp.DIFFERENCE),ge.delete()}const ae=Z.resolve();if(!ae){console.error("Couldn't compute fog");return}if(Z.delete(),ae!==void 0){ae.simplify(),d[M]=ae;let fe=rt.getValue(W.id);fe!==void 0&&fe.shadowPath.delete(),rt.cacheValue(W.id,{shadowPath:ae.copy(),player:W})}}for(let M=0;M<_.length;M++){const W=_[M],se=W.metadata[`${D.EXTENSIONID}/visionRange`],he=H.userId===_[M].createdUserId,Z=F.some(te=>te.id==_[M].createdUserId);if(se){if(!he&&H.role!=="GM"&&!Z)continue;const te=H.gridDpi*(se/H.gridScale+.5),ae=je.NewPath().ellipse(W.position.x,W.position.y,te,te,0,0,2*Math.PI);d[M].op(ae,je.PathOp.INTERSECT),ae.delete();const fe=H.players.find(re=>re.id===W.createdUserId);if(fe&&H.role==="GM"){const re=st().strokeColor(fe.color).fillOpacity(0).position({x:W.position.x,y:W.position.y}).width(te*2).height(te*2).shapeType("CIRCLE").metadata({[`${D.EXTENSIONID}/isIndicatorRing`]:!0}).build();T.push(re)}}}const b=[];for(const M of Object.values(d))b.push({cmds:M.toCmds(),visible:!1,zIndex:3}),M.delete();n.pause(),t.resume();const k=[Y.scene.local.deleteItems(e.filter(Qi).map(M=>M.id)),Y.scene.local.addItems(b.map(M=>{const W=zi().commands(M.cmds).locked(!0).visible(M.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${D.EXTENSIONID}/isVisionFog`]:!0}).build();return W.zIndex=M.zIndex,W})),Y.scene.local.deleteItems(e.filter(In).map(M=>M.id))];T.length>0&&k.push(Y.scene.local.addItems(T)),H.fog.filled||k.push(Y.scene.fog.setFilled(!0)),await Promise.all(k);const[ie,ne]=[t.stop(),n.stop()];yr({compute_time:`${ne} ms`,communication_time:`${ie} ms`,cache_hits:ee,cache_misses:E}),tt=!1}document.addEventListener("updateVision",vr);let gn,Yn,dt=[],Zn,mn;async function ft(){if(tt||!await Y.scene.isReady())return;const[i,e]=[new zn,new zn];i.start(),i.pause(),e.start();const t=H.players.filter(S=>S.role=="GM"),n=H.items.filter(S=>S.layer=="CHARACTER"&&t.some(P=>S.createdUserId===P.id)&&(S.metadata[`${D.EXTENSIONID}/hasVision`]||S.metadata[`${D.ARMINDOID}/hasVision`])),a=H.role=="GM"?H.items.filter(pi):H.items.filter(er).concat(n),o=H.items.filter(Ji),u=H.items.filter(hi)?.[0],w=H.metadata[`${D.EXTENSIONID}/visionEnabled`]===!0;if(u===void 0)return;const A=[u.width*u.scale.x,u.height*u.scale.y],_=[u.scale.x,u.scale.y],x=[u.position.x,u.position.y];if(H.role=="GM"){const S=document.getElementById("mapHeight"),P=document.getElementById("mapWidth");P.value=(Math.round(A[0])/H.gridDpi).toString(),S.value=(Math.round(A[1])/H.gridDpi).toString()}const N=JSON.stringify(o),L=JSON.stringify(a),ee=JSON.stringify(u);if(ee==mn&&w==Zn&&gn==N&&Yn==L&&A[0]==dt[0]&&A[1]==dt[1])return;let E=!1;(ee!=mn||gn!=N||A[0]!=dt[0]||A[1]!=dt[1])&&(E=!0),mn=ee,Yn=L,gn=N,dt=A,Zn=w,e.pause();const G=new CustomEvent("updateVision",{detail:{awaitTimer:i,computeTimer:e,allItems:H.items,metadata:H.metadata,size:A,offset:x,scale:_,tokensWithVision:a,visionShapes:o,invalidateCache:E}});tt||document.dispatchEvent(G)}function yn(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class wr{constructor(){this._events=void 0,this._events={}}on(e,t){yn(e,n=>{const a=this._events[n]||[];a.push(t),this._events[n]=a})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}yn(e,a=>{if(n===1){delete this._events[a];return}const o=this._events[a];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[a]=o)})}trigger(e,...t){var n=this;yn(e,a=>{const o=n._events[a];o!==void 0&&o.forEach(u=>{u.apply(n,t)})})}}function _r(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const a=this,o=[];if(Array.isArray(e))e.forEach(u=>{typeof u=="string"?o.push(u):(a.plugins.settings[u.name]=u.options,o.push(u.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(a.plugins.settings[t]=e[t],o.push(t));for(;n=o.shift();)a.require(n)}loadPlugin(e){var t=this,n=t.plugins,a=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=a.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Gt=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Ir(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Ei=i=>{if(!br(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((a,o)=>{if(a===i[o-1]){t++;return}n(),e+=a,t=1}),n(),e},Si=i=>{let e=An(i);return Gt(e)},br=i=>new Set(i).size!==i.length,gt=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Ir=i=>i.reduce((e,t)=>Math.max(e,Er(t)),0),Er=i=>An(i).length,An=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Oi=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Oi(t).forEach(function(a){let o=a.slice(0);o[0]=i.charAt(0)+o[0],e.push(o),o=a.slice(0),o.unshift(i.charAt(0)),e.push(o)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Sr=[[0,65535]],Or="[-]";let Ut,Ai;const Ar=3,kn={},Qn={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let i in Qn){let e=Qn[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);kn[n]=i}}const kr=new RegExp(Object.keys(kn).join("|")+"|"+Or,"gu"),Tr=i=>{Ut===void 0&&(Ut=Nr(i||Sr))},Jn=(i,e="NFKD")=>i.normalize(e),Wt=i=>An(i).reduce((e,t)=>e+Cr(t),""),Cr=i=>(i=Jn(i).toLowerCase().replace(kr,e=>kn[e]||""),Jn(i,"NFC"));function*xr(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let a=String.fromCharCode(n),o=Wt(a);o!=a.toLowerCase()&&(o.length>Ar||o.length!=0&&(yield{folded:o,composed:a,code_point:n}))}}const Pr=i=>{const e={},t=(n,a)=>{const o=e[n]||new Set,u=new RegExp("^"+Si(o)+"$","iu");a.match(u)||(o.add(gt(a)),e[n]=o)};for(let n of xr(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},Nr=i=>{const e=Pr(i),t={};let n=[];for(let o in e){let u=e[o];u&&(t[o]=Si(u)),o.length>1&&n.push(gt(o))}n.sort((o,u)=>u.length-o.length);const a=Gt(n);return Ai=new RegExp("^"+a,"u"),t},Dr=(i,e=1)=>{let t=0;return i=i.map(n=>(Ut[n]&&(t+=n.length),Ut[n]||n)),t>=e?Ei(i):""},$r=(i,e=1)=>(e=Math.max(e,i.length-1),Gt(Oi(i).map(t=>Dr(t,e)))),ei=(i,e=!0)=>{let t=i.length>1?1:0;return Gt(i.map(n=>{let a=[];const o=e?n.length():n.length()-1;for(let u=0;u<o;u++)a.push($r(n.substrs[u]||"",t));return Ei(a)}))},Lr=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const a=u=>{for(const w of n){if(w.start===u.start&&w.substr===u.substr)return!1;if(!(u.length==1||w.length==1)&&(u.start<w.start&&u.end>w.start||w.start<u.start&&w.end>u.start))return!0}return!1};if(!(t.parts.filter(a).length>0))return!0}return!1};class Xt{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new Xt,a=JSON.parse(JSON.stringify(this.parts)),o=a.pop();for(const A of a)n.add(A);let u=t.substr.substring(0,e-o.start),w=u.length;return n.add({start:o.start,end:o.start+w,length:w,substr:u}),n}}const Fr=i=>{Tr(),i=Wt(i);let e="",t=[new Xt];for(let n=0;n<i.length;n++){let o=i.substring(n).match(Ai);const u=i.substring(n,n+1),w=o?o[0]:null;let A=[],_=new Set;for(const x of t){const N=x.last();if(!N||N.length==1||N.end<=n)if(w){const L=w.length;x.add({start:n,end:n+L,length:L,substr:w}),_.add("1")}else x.add({start:n,end:n+1,length:1,substr:u}),_.add("2");else if(w){let L=x.clone(n,N);const ee=w.length;L.add({start:n,end:n+ee,length:ee,substr:w}),A.push(L)}else _.add("3")}if(A.length>0){A=A.sort((x,N)=>x.length()-N.length());for(let x of A)Lr(x,t)||t.push(x);continue}if(n>0&&_.size==1&&!_.has("3")){e+=ei(t,!1);let x=new Xt;const N=t[0];N&&x.add(N.last()),t=[x]}}return e+=ei(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Rr=(i,e)=>{if(i)return i[e]},Mr=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},vn=(i,e,t)=>{var n,a;return!i||(i=i+"",e.regex==null)||(a=i.search(e.regex),a===-1)?0:(n=e.string.length/i.length,a===0&&(n+=.5),n*t)},wn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},Pe=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Br=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=Wt(i+"").toLowerCase(),e=Wt(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Vr{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const a=[],o=e.split(/\s+/);var u;return n&&(u=new RegExp("^("+Object.keys(n).map(gt).join("|")+"):(.*)$")),o.forEach(w=>{let A,_=null,x=null;u&&(A=w.match(u))&&(_=A[1],w=A[2]),w.length>0&&(this.settings.diacritics?x=Fr(w)||null:x=gt(w),x&&t&&(x="\\b"+x)),a.push({string:w,regex:x?new RegExp(x,"iu"):null,field:_})}),a}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const a=e.options.fields,o=e.weights,u=a.length,w=e.getAttrFn;if(!u)return function(){return 1};const A=function(){return u===1?function(_,x){const N=a[0].field;return vn(w(x,N),_,o[N]||1)}:function(_,x){var N=0;if(_.field){const L=w(x,_.field);!_.regex&&L?N+=1/u:N+=vn(L,_,1)}else Pe(o,(L,ee)=>{N+=vn(w(x,ee),_,L)});return N/u}}();return n===1?function(_){return A(t[0],_)}:e.options.conjunction==="and"?function(_){var x,N=0;for(let L of t){if(x=A(L,_),x<=0)return 0;N+=x}return N/n}:function(_){var x=0;return Pe(t,N=>{x+=A(N,_)}),x/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const a=this,o=e.options,u=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof u=="function")return u.bind(this);const w=function(x,N){return x==="$score"?N.score:e.getAttrFn(a.items[N.id],x)};if(u)for(let _ of u)(e.query||_.field!=="$score")&&n.push(_);if(e.query){t=!0;for(let _ of n)if(_.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(_=>_.field!=="$score");return n.length?function(_,x){var N,L;for(let ee of n)if(L=ee.field,N=(ee.direction==="desc"?-1:1)*Br(w(L,_),w(L,x)),N)return N;return 0}:null}prepareSearch(e,t){const n={};var a=Object.assign({},t);if(wn(a,"sort"),wn(a,"sort_empty"),a.fields){wn(a,"fields");const o=[];a.fields.forEach(u=>{typeof u=="string"&&(u={field:u,weight:1}),o.push(u),n[u.field]="weight"in u?u.weight:1}),a.fields=o}return{options:a,query:e.toLowerCase().trim(),tokens:this.tokenize(e,a.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:a.nesting?Mr:Rr}}search(e,t){var n=this,a,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const u=t.score||n._getScoreFunction(o);e.length?Pe(n.items,(A,_)=>{a=u(A),(t.filter===!1||a>0)&&o.items.push({score:a,id:_})}):Pe(n.items,(A,_)=>{o.items.push({score:1,id:_})});const w=n._getSortFunction(o);return w&&o.items.sort(w),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const ot=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Oe=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(ki(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},ki=i=>typeof i=="string"&&i.indexOf("<")>-1,jr=i=>i.replace(/['"\\]/g,"\\$&"),_n=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Ct=(i,e)=>{Object.assign(i.style,e)},xe=(i,...e)=>{var t=Ti(e);i=Ci(i),i.map(n=>{t.map(a=>{n.classList.add(a)})})},ze=(i,...e)=>{var t=Ti(e);i=Ci(i),i.map(n=>{t.map(a=>{n.classList.remove(a)})})},Ti=i=>{var e=[];return ot(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ci=i=>(Array.isArray(i)||(i=[i]),i),Pt=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},ti=(i,e=0)=>e>0?i[i.length-1]:i[0],Ur=i=>Object.keys(i).length===0,Ht=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},we=(i,e)=>{ot(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},En=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Wr=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var u=o.data.match(e);if(u&&o.data.length>0){var w=document.createElement("span");w.className="highlight";var A=o.splitText(u.index);A.splitText(u[0].length);var _=A.cloneNode(!0);return w.appendChild(_),En(A,w),1}return 0},n=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(u=>{a(u)})},a=o=>o.nodeType===3?t(o):(n(o),0);a(i)},Xr=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Hr=65,Gr=13,xi=27,Sn=37,qr=38,Pi=39,zr=40,ni=8,Kr=46,On=9,Yr=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),xt=Yr?"metaKey":"ctrlKey";var ii={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Re=i=>typeof i>"u"||i===null?null:Nt(i),Nt=i=>typeof i=="boolean"?i?"1":"0":i+"",Dt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Zr=(i,e)=>{var t;return function(n,a){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[n]=!0,i.call(o,n,a)},e)}},ri=(i,e,t)=>{var n,a=i.trigger,o={};i.trigger=function(){var u=arguments[0];if(e.indexOf(u)!==-1)o[u]=arguments;else return a.apply(i,arguments)},t.apply(i,[]),i.trigger=a;for(n of e)n in o&&a.apply(i,o[n])},Qr=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),pe=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},_e=(i,e,t,n)=>{i.addEventListener(e,t,n)},Je=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},bn=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},oi=i=>i.replace(/[\\"']/g,"\\$&"),et=(i,e)=>{e&&i.append(e)};function si(i,e){var t=Object.assign({},ii,e),n=t.dataAttr,a=t.labelField,o=t.valueField,u=t.disabledField,w=t.optgroupField,A=t.optgroupLabelField,_=t.optgroupValueField,x=i.tagName.toLowerCase(),N=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!N&&!t.allowEmptyOption){let G=i.querySelector('option[value=""]');G&&(N=G.textContent)}var L={placeholder:N,options:[],optgroups:[],items:[],maxItems:null},ee=()=>{var G,S=L.options,P={},T=1,F=y=>{var I=Object.assign({},y.dataset),f=n&&I[n];return typeof f=="string"&&f.length&&(I=Object.assign(I,JSON.parse(f))),I},R=(y,I)=>{var f=Re(y.value);if(f!=null&&!(!f&&!t.allowEmptyOption)){if(P.hasOwnProperty(f)){if(I){var g=P[f][w];g?Array.isArray(g)?g.push(I):P[f][w]=[g,I]:P[f][w]=I}}else{var d=F(y);d[a]=d[a]||y.textContent,d[o]=d[o]||f,d[u]=d[u]||y.disabled,d[w]=d[w]||I,d.$option=y,P[f]=d,S.push(d)}y.selected&&L.items.push(f)}},Q=y=>{var I,f;f=F(y),f[A]=f[A]||y.getAttribute("label")||"",f[_]=f[_]||T++,f[u]=f[u]||y.disabled,L.optgroups.push(f),I=f[_],ot(y.children,g=>{R(g,I)})};L.maxItems=i.hasAttribute("multiple")?null:1,ot(i.children,y=>{G=y.tagName.toLowerCase(),G==="optgroup"?Q(y):G==="option"&&R(y)})},E=()=>{const G=i.getAttribute(n);if(G)L.options=JSON.parse(G),ot(L.options,P=>{L.items.push(P[o])});else{var S=i.value.trim()||"";if(!t.allowEmptyOption&&!S.length)return;const P=S.split(t.delimiter);ot(P,T=>{const F={};F[a]=T,F[o]=T,L.options.push(F)}),L.items=P}};return x==="select"?ee():E(),Object.assign({},ii,L,e)}var ai=0;class Ne extends _r(wr){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],ai++;var n,a=Oe(e);if(a.tomselect)throw new Error("Tom Select already initialized on this element");a.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(a,null);n=o.getPropertyValue("direction");const u=si(a,t);this.settings=u,this.input=a,this.tabIndex=a.tabIndex||0,this.is_select_tag=a.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=bn(a,"tomselect-"+ai),this.isRequired=a.required,this.sifter=new Vr(this.options,{diacritics:u.diacritics}),u.mode=u.mode||(u.maxItems===1?"single":"multi"),typeof u.hideSelected!="boolean"&&(u.hideSelected=u.mode==="multi"),typeof u.hidePlaceholder!="boolean"&&(u.hidePlaceholder=u.mode!=="multi");var w=u.createFilter;typeof w!="function"&&(typeof w=="string"&&(w=new RegExp(w)),w instanceof RegExp?u.createFilter=S=>w.test(S):u.createFilter=S=>this.settings.duplicates||!this.options[S]),this.initializePlugins(u.plugins),this.setupCallbacks(),this.setupTemplates();const A=Oe("<div>"),_=Oe("<div>"),x=this._render("dropdown"),N=Oe('<div role="listbox" tabindex="-1">'),L=this.input.getAttribute("class")||"",ee=u.mode;var E;if(xe(A,u.wrapperClass,L,ee),xe(_,u.controlClass),et(A,_),xe(x,u.dropdownClass,ee),u.copyClassesToDropdown&&xe(x,L),xe(N,u.dropdownContentClass),et(x,N),Oe(u.dropdownParent||A).appendChild(x),ki(u.controlInput)){E=Oe(u.controlInput);var G=["autocorrect","autocapitalize","autocomplete"];Pe(G,S=>{a.getAttribute(S)&&we(E,{[S]:a.getAttribute(S)})}),E.tabIndex=-1,_.appendChild(E),this.focus_node=E}else u.controlInput?(E=Oe(u.controlInput),this.focus_node=E):(E=Oe("<input/>"),this.focus_node=_);this.wrapper=A,this.dropdown=x,this.dropdown_content=N,this.control=_,this.control_input=E,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,a=e.dropdown,o=e.dropdown_content,u=e.wrapper,w=e.control,A=e.input,_=e.focus_node,x={passive:!0},N=e.inputId+"-ts-dropdown";we(o,{id:N}),we(_,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":N});const L=bn(_,e.inputId+"-ts-control"),ee="label[for='"+jr(e.inputId)+"']",E=document.querySelector(ee),G=e.focus.bind(e);if(E){_e(E,"click",G),we(E,{for:L});const T=bn(E,e.inputId+"-ts-label");we(_,{"aria-labelledby":T}),we(o,{"aria-labelledby":T})}if(u.style.width=A.style.width,e.plugins.names.length){const T="plugin-"+e.plugins.names.join(" plugin-");xe([u,a],T)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&we(A,{multiple:"multiple"}),t.placeholder&&we(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+gt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Zr(t.load,t.loadThrottle)),e.control_input.type=A.type,_e(a,"mousemove",()=>{e.ignoreHover=!1}),_e(a,"mouseenter",T=>{var F=Pt(T.target,"[data-selectable]",a);F&&e.onOptionHover(T,F)},{capture:!0}),_e(a,"click",T=>{const F=Pt(T.target,"[data-selectable]");F&&(e.onOptionSelect(T,F),pe(T,!0))}),_e(w,"click",T=>{var F=Pt(T.target,"[data-ts-item]",w);if(F&&e.onItemSelect(T,F)){pe(T,!0);return}n.value==""&&(e.onClick(),pe(T,!0))}),_e(_,"keydown",T=>e.onKeyDown(T)),_e(n,"keypress",T=>e.onKeyPress(T)),_e(n,"input",T=>e.onInput(T)),_e(_,"blur",T=>e.onBlur(T)),_e(_,"focus",T=>e.onFocus(T)),_e(n,"paste",T=>e.onPaste(T));const S=T=>{const F=T.composedPath()[0];if(!u.contains(F)&&!a.contains(F)){e.isFocused&&e.blur(),e.inputState();return}F==n&&e.isOpen?T.stopPropagation():pe(T,!0)},P=()=>{e.isOpen&&e.positionDropdown()};_e(document,"mousedown",S),_e(window,"scroll",P,x),_e(window,"resize",P,x),this._destroy=()=>{document.removeEventListener("mousedown",S),window.removeEventListener("scroll",P),window.removeEventListener("resize",P),E&&E.removeEventListener("click",G)},this.revertSettings={innerHTML:A.innerHTML,tabIndex:A.tabIndex},A.tabIndex=-1,A.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,_e(A,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,A.disabled?e.disable():e.enable(),e.on("change",this.onChange),xe(A,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Pe(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,a={optgroup:o=>{let u=document.createElement("div");return u.className="optgroup",u.appendChild(o.options),u},optgroup_header:(o,u)=>'<div class="optgroup-header">'+u(o[n])+"</div>",option:(o,u)=>"<div>"+u(o[t])+"</div>",item:(o,u)=>"<div>"+u(o[t])+"</div>",option_create:(o,u)=>'<div class="create">Add <strong>'+u(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},a,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?si(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){_n(this.input,"input"),_n(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){pe(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var a=n.trim().split(t.settings.splitOn);Pe(a,o=>{Re(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){pe(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),pe(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==On&&pe(e);return}switch(e.keyCode){case Hr:if(Je(xt,e)&&t.control_input.value==""){pe(e),t.selectAll();return}break;case xi:t.isOpen&&(pe(e,!0),t.close()),t.clearActiveItems();return;case zr:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}pe(e);return;case qr:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}pe(e);return;case Gr:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),pe(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&pe(e);return;case Sn:t.advanceSelection(-1,e);return;case Pi:t.advanceSelection(1,e);return;case On:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),pe(e)),t.settings.create&&t.createItem()&&pe(e));return;case ni:case Kr:t.deleteSelection(e);return}t.isInputHidden&&!Je(xt,e)&&pe(e)}onInput(e){var t=this;if(!t.isLocked){var n=t.inputValue();t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled){t.blur(),pe(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,a=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?a.createItem(null,()=>{a.settings.closeAfterSelect&&a.close()}):(n=t.dataset.value,typeof n<"u"&&(a.lastQuery=null,a.addItem(n),a.settings.closeAfterSelect&&a.close(),!a.settings.hideSelected&&e.type&&/click/.test(e.type)&&a.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(pe(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;xe(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||ze(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,_n(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];ri(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,a,o,u,w,A,_;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.showInput();return}if(a=t&&t.type.toLowerCase(),a==="click"&&Je("shiftKey",t)&&n.activeItems.length){for(_=n.getLastActive(),u=Array.prototype.indexOf.call(n.control.children,_),w=Array.prototype.indexOf.call(n.control.children,e),u>w&&(A=u,u=w,w=A),o=u;o<=w;o++)e=n.control.children[o],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);pe(t)}else a==="click"&&Je(xt,t)||a==="keydown"&&Je("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.hideInput(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&ze(n,"last-active"),xe(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),ze(e,"active")}clearActiveItems(){ze(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,we(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),we(e,{"aria-selected":"true"}),xe(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,a=n.clientHeight,o=n.scrollTop||0,u=e.offsetHeight,w=e.getBoundingClientRect().top-n.getBoundingClientRect().top+o;w+u>a+o?this.scroll(w-a+u,t):w<o&&this.scroll(w,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(ze(this.activeOption,"active"),we(this.activeOption,{"aria-selected":null})),this.activeOption=null,we(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,Pe(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(we(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&we(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,a=this,o=this.getSearchOptions();if(a.settings.score&&(n=a.settings.score.call(a,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==a.lastQuery?(a.lastQuery=e,t=a.sifter.search(e,Object.assign(o,{score:n})),a.currentResults=t):t=Object.assign({},a.currentResults),a.settings.hideSelected&&(t.items=t.items.filter(u=>{let w=Re(u.id);return!(w&&a.items.indexOf(w)!==-1)})),t}refreshOptions(e=!0){var t,n,a,o,u,w,A,_,x,N;const L={},ee=[];var E=this,G=E.inputValue();const S=G===E.lastQuery||G==""&&E.lastQuery==null;var P=E.search(G),T=null,F=E.settings.shouldOpen||!1,R=E.dropdown_content;for(S&&(T=E.activeOption,T&&(x=T.closest("[data-group]"))),o=P.items.length,typeof E.settings.maxOptions=="number"&&(o=Math.min(o,E.settings.maxOptions)),o>0&&(F=!0),t=0;t<o;t++){let y=P.items[t];if(!y)continue;let I=y.id,f=E.options[I];if(f===void 0)continue;let g=Nt(I),d=E.getOption(g,!0);for(E.settings.hideSelected||d.classList.toggle("selected",E.items.includes(g)),u=f[E.settings.optgroupField]||"",w=Array.isArray(u)?u:[u],n=0,a=w&&w.length;n<a;n++){u=w[n],E.optgroups.hasOwnProperty(u)||(u="");let b=L[u];b===void 0&&(b=document.createDocumentFragment(),ee.push(u)),n>0&&(d=d.cloneNode(!0),we(d,{id:f.$id+"-clone-"+n,"aria-selected":null}),d.classList.add("ts-cloned"),ze(d,"active"),E.activeOption&&E.activeOption.dataset.value==I&&x&&x.dataset.group===u.toString()&&(T=d)),b.appendChild(d),L[u]=b}}E.settings.lockOptgroupOrder&&ee.sort((y,I)=>{const f=E.optgroups[y],g=E.optgroups[I],d=f&&f.$order||0,b=g&&g.$order||0;return d-b}),A=document.createDocumentFragment(),Pe(ee,y=>{let I=L[y];if(!I||!I.children.length)return;let f=E.optgroups[y];if(f!==void 0){let g=document.createDocumentFragment(),d=E.render("optgroup_header",f);et(g,d),et(g,I);let b=E.render("optgroup",{group:f,options:g});et(A,b)}else et(A,I)}),R.innerHTML="",et(R,A),E.settings.highlight&&(Xr(R),P.query.length&&P.tokens.length&&Pe(P.tokens,y=>{Wr(R,y.regex)}));var Q=y=>{let I=E.render(y,{input:G});return I&&(F=!0,R.insertBefore(I,R.firstChild)),I};if(E.loading?Q("loading"):E.settings.shouldLoad.call(E,G)?P.items.length===0&&Q("no_results"):Q("not_loading"),_=E.canCreate(G),_&&(N=Q("option_create")),E.hasOptions=P.items.length>0||_,F){if(P.items.length>0){if(!T&&E.settings.mode==="single"&&E.items[0]!=null&&(T=E.getOption(E.items[0])),!R.contains(T)){let y=0;N&&!E.settings.addPrecedence&&(y=1),T=E.selectable()[y]}}else N&&(T=N);e&&!E.isOpen&&(E.open(),E.scrollToOption(T,"auto")),E.setActiveOption(T)}else E.clearActiveOption(),e&&E.isOpen&&E.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const a=Re(e[n.settings.valueField]);return a===null||n.options.hasOwnProperty(a)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[a]=e,n.lastQuery=null,t&&(n.userOptions[a]=t,n.trigger("option_add",a,e)),a)}addOptions(e,t=!1){Pe(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Re(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var a,o;const u=Re(e),w=Re(t[n.settings.valueField]);if(u===null)return;const A=n.options[u];if(A==null)return;if(typeof w!="string")throw new Error("Value must be set in option data");const _=n.getOption(u),x=n.getItem(u);if(t.$order=t.$order||A.$order,delete n.options[u],n.uncacheValue(w),n.options[w]=t,_){if(n.dropdown_content.contains(_)){const N=n._render("option",t);En(_,N),n.activeOption===_&&n.setActiveOption(N)}_.remove()}x&&(o=n.items.indexOf(u),o!==-1&&n.items.splice(o,1,w),a=n._render("item",t),x.classList.contains("active")&&xe(a,"active"),En(x,a)),n.lastQuery=null}removeOption(e,t){const n=this;e=Nt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};Pe(this.options,(a,o)=>{t(a,o)&&(n[o]=a)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Re(e);if(n===null)return null;const a=this.options[n];if(a!=null){if(a.$div)return a.$div;if(t)return this._render("option",a)}return null}getAdjacent(e,t,n="option"){var a=this,o;if(!e)return null;n=="item"?o=a.controlChildren():o=a.dropdown_content.querySelectorAll("[data-selectable]");for(let u=0;u<o.length;u++)if(o[u]==e)return t>0?o[u+1]:o[u-1];return null}getItem(e){if(typeof e=="object")return e;var t=Re(e);return t!==null?this.control.querySelector(`[data-value="${oi(t)}"]`):null}addItems(e,t){var n=this,a=Array.isArray(e)?e:[e];a=a.filter(u=>n.items.indexOf(u)===-1);const o=a[a.length-1];a.forEach(u=>{n.isPending=u!==o,n.addItem(u,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];ri(this,n,()=>{var a,o;const u=this,w=u.settings.mode,A=Re(e);if(!(A&&u.items.indexOf(A)!==-1&&(w==="single"&&u.close(),w==="single"||!u.settings.duplicates))&&!(A===null||!u.options.hasOwnProperty(A))&&(w==="single"&&u.clear(t),!(w==="multi"&&u.isFull()))){if(a=u._render("item",u.options[A]),u.control.contains(a)&&(a=a.cloneNode(!0)),o=u.isFull(),u.items.splice(u.caretPos,0,A),u.insertAtCaret(a),u.isSetup){if(!u.isPending&&u.settings.hideSelected){let _=u.getOption(A),x=u.getAdjacent(_,1);x&&u.setActiveOption(x)}!u.isPending&&!u.settings.closeAfterSelect&&u.refreshOptions(u.isFocused&&w!=="single"),u.settings.closeAfterSelect!=!1&&u.isFull()?u.close():u.isPending||u.positionDropdown(),u.trigger("item_add",A,a),u.isPending||u.updateOriginalInput({silent:t})}(!u.isPending||!o&&u.isFull())&&(u.inputState(),u.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var a,o;const u=e.dataset.value;a=Ht(e),e.remove(),e.classList.contains("active")&&(o=n.activeItems.indexOf(e),n.activeItems.splice(o,1),ze(e,"active")),n.items.splice(a,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(u)&&n.removeOption(u,t),a<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",u,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,a=n.caretPos,o;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var u=!1,w=A=>{if(n.unlock(),!A||typeof A!="object")return t();var _=Re(A[n.settings.valueField]);if(typeof _!="string")return t();n.setTextboxValue(),n.addOption(A,!0),n.setCaret(a),n.addItem(_),t(A),u=!0};return typeof n.settings.create=="function"?o=n.settings.create.call(this,e,w):o={[n.settings.labelField]:e,[n.settings.valueField]:e},u||w(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const a=e.wrapper.classList;a.toggle("focus",e.isFocused),a.toggle("disabled",e.isDisabled),a.toggle("required",e.isRequired),a.toggle("invalid",!e.isValid),a.toggle("locked",n),a.toggle("full",t),a.toggle("input-active",e.isFocused&&!e.isInputHidden),a.toggle("dropdown-active",e.isOpen),a.toggle("has-options",Ur(e.options)),a.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,a;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let A=function(_,x,N){return _||(_=Oe('<option value="'+Dt(x)+'">'+Dt(N)+"</option>")),_!=o&&t.input.append(_),u.push(_),(_!=o||w>0)&&(_.selected=!0),_};const u=[],w=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(_=>{_.selected=!1}),t.items.length==0&&t.settings.mode=="single"?A(o,"",""):t.items.forEach(_=>{if(n=t.options[_],a=n[t.settings.labelField]||"",u.includes(n.$option)){const x=t.input.querySelector(`option[value="${oi(_)}"]:not(:checked)`);A(x,_,a)}else n.$option=A(n.$option,_,a)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,we(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Ct(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Ct(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.hideInput()),t.isOpen=!1,we(t.focus_node,{"aria-expanded":"false"}),Ct(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,a=t.left+window.scrollX;Ct(this.dropdown,{width:t.width+"px",top:n+"px",left:a+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();Pe(n,a=>{t.removeItem(a,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,a=t.control;a.insertBefore(e,a.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,a,o,u=this;t=e&&e.keyCode===ni?-1:1,n=Qr(u.control_input);const w=[];if(u.activeItems.length)o=ti(u.activeItems,t),a=Ht(o),t>0&&a++,Pe(u.activeItems,A=>w.push(A));else if((u.isFocused||u.settings.mode==="single")&&u.items.length){const A=u.controlChildren();let _;t<0&&n.start===0&&n.length===0?_=A[u.caretPos-1]:t>0&&n.start===u.inputValue().length&&(_=A[u.caretPos]),_!==void 0&&w.push(_)}if(!u.shouldDelete(w,e))return!1;for(pe(e,!0),typeof a<"u"&&u.setCaret(a);w.length;)u.removeItem(w.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(a=>a.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,a,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(Je(xt,t)||Je("shiftKey",t)?(n=o.getLastActive(e),n?n.classList.contains("active")?a=o.getAdjacent(n,e,"item"):a=n:e>0?a=o.control_input.nextElementSibling:a=o.control_input.previousElementSibling,a&&(a.classList.contains("active")&&o.removeActiveItem(n),o.setActiveItemClass(a))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return ti(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,ze(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,a;const o=this;if(typeof this.settings.render[e]!="function"||(a=o.settings.render[e].call(this,t,Dt),!a))return null;if(a=Oe(a),e==="option"||e==="option_create"?t[o.settings.disabledField]?we(a,{"aria-disabled":"true"}):we(a,{"data-selectable":""}):e==="optgroup"&&(n=t.group[o.settings.optgroupValueField],we(a,{"data-group":n}),t.group[o.settings.disabledField]&&we(a,{"data-disabled":""})),e==="option"||e==="item"){const u=Nt(t[o.settings.valueField]);we(a,{"data-value":u}),e==="item"?(xe(a,o.settings.itemClass),we(a,{"data-ts-item":""})):(xe(a,o.settings.optionClass),we(a,{role:"option",id:t.$id}),t.$div=a,o.options[u]=t)}return a}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){Pe(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var a=this,o=a[t];a[t]=function(){var u,w;return e==="after"&&(u=o.apply(a,arguments)),w=n.apply(a,arguments),e==="instead"?w:(e==="before"&&(u=o.apply(a,arguments)),u)}}}function Jr(){_e(this.input,"change",()=>{this.sync()})}function eo(){var i=this,e=i.onOptionSelect;i.settings.hideSelected=!1;var t=function(a){setTimeout(()=>{var o=a.querySelector("input");o instanceof HTMLInputElement&&(a.classList.contains("selected")?o.checked=!0:o.checked=!1)},1)};i.hook("after","setupTemplates",()=>{var n=i.settings.render.option;i.settings.render.option=(a,o)=>{var u=Oe(n.call(i,a,o)),w=document.createElement("input");w.addEventListener("click",function(_){pe(_)}),w.type="checkbox";const A=Re(a[i.settings.valueField]);return A&&i.items.indexOf(A)>-1&&(w.checked=!0),u.prepend(w),u}}),i.on("item_remove",n=>{var a=i.getOption(n);a&&(a.classList.remove("selected"),t(a))}),i.on("item_add",n=>{var a=i.getOption(n);a&&t(a)}),i.hook("instead","onOptionSelect",(n,a)=>{if(a.classList.contains("selected")){a.classList.remove("selected"),i.removeItem(a.dataset.value),i.refreshOptions(),pe(n,!0);return}e.call(i,n,a),t(a)})}function to(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Oe(t.html(t));n.addEventListener("click",a=>{e.isDisabled||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),a.preventDefault(),a.stopPropagation())}),e.control.appendChild(n)})}function no(){var i=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(i.settings.mode==="multi"){var e=i.lock,t=i.unlock;i.hook("instead","lock",()=>{var n=$(i.control).data("sortable");return n&&n.disable(),e.call(i)}),i.hook("instead","unlock",()=>{var n=$(i.control).data("sortable");return n&&n.enable(),t.call(i)}),i.on("initialize",()=>{var n=$(i.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:(a,o)=>{o.placeholder.css("width",o.helper.css("width")),n.css({overflow:"visible"})},stop:()=>{n.css({overflow:"hidden"});var a=[];n.children("[data-value]").each(function(){this.dataset.value&&a.push(this.dataset.value)}),i.setValue(a)}})})}}function io(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Oe(t.html(t)),a=n.querySelector("."+t.closeClass);a&&a.addEventListener("click",o=>{pe(o,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function ro(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=Ht(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),ze(t,"last-active")}else i.setCaret(i.caretPos+e)})}function oo(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,xe(i.control_input,"dropdown-input");const e=Oe('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Oe('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case xi:i.isOpen&&(pe(t,!0),i.close()),i.clearActiveItems();return;case On:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),_e(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function so(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of n)e.style[o]=t.style[o];var a=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};a(),i.on("update item_add item_remove",a),_e(t,"input",a),_e(t,"keyup",a),_e(t,"blur",a),_e(t,"update",a)})}function ao(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function lo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function uo(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,a,o,u;if(!i.isOpen||!(t.keyCode===Sn||t.keyCode===Pi))return e.call(i,t);i.ignoreHover=!0,u=Pt(i.activeOption,"[data-group]"),n=Ht(i.activeOption,"[data-selectable]"),u&&(t.keyCode===Sn?u=u.previousSibling:u=u.nextSibling,u&&(o=u.querySelectorAll("[data-selectable]"),a=o[Math.min(o.length-1,n)],a&&i.setActiveOption(a)))})}function co(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Dt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var a=t.settings.render.item;t.settings.render.item=(o,u)=>{var w=Oe(a.call(t,o,u)),A=Oe(n);return w.appendChild(A),_e(A,"mousedown",_=>{pe(_,!0)}),_e(A,"click",_=>{pe(_,!0),!t.isLocked&&t.shouldDelete([w],_)&&(t.removeItem(w),t.refreshOptions(!1),t.inputState())}),w}})}}function fo(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var a=e.options[n];a&&e.setTextboxValue(t.text.call(e,a))}})}function po(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var a={},o,u=!1,w,A=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(i.activeOption){var L=i.selectable(),ee=Array.from(L).indexOf(i.activeOption);if(ee>=L.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const _=N=>typeof i.settings.maxOptions=="number"&&o.children.length>=i.settings.maxOptions?!1:!!(N in a&&a[N]),x=(N,L)=>i.items.indexOf(L)>=0||A.indexOf(L)>=0;i.setNextUrl=(N,L)=>{a[N]=L},i.getUrl=N=>{if(N in a){const L=a[N];return a[N]=!1,L}return a={},i.settings.firstUrl.call(i,N)},i.hook("instead","clearActiveOption",()=>{if(!u)return t.call(i)}),i.hook("instead","canLoad",N=>N in a?_(N):e.call(i,N)),i.hook("instead","loadCallback",(N,L)=>{if(!u)i.clearOptions(x);else if(w){const ee=N[0];ee!==void 0&&(w.dataset.value=ee[i.settings.valueField])}n.call(i,N,L),u=!1}),i.hook("after","refreshOptions",()=>{const N=i.lastValue;var L;_(N)?(L=i.render("loading_more",{query:N}),L&&(L.setAttribute("data-selectable",""),w=L)):N in a&&!o.querySelector(".no-results")&&(L=i.render("no_more_results",{query:N})),L&&(xe(L,i.settings.optionClass),o.append(L))}),i.on("initialize",()=>{A=Object.keys(i.options),o=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),o.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&_(i.lastValue)&&(u||(u=!0,i.load.call(i,i.lastValue)))})})}Ne.define("change_listener",Jr);Ne.define("checkbox_options",eo);Ne.define("clear_button",to);Ne.define("drag_drop",no);Ne.define("dropdown_header",io);Ne.define("caret_position",ro);Ne.define("dropdown_input",oo);Ne.define("input_autogrow",so);Ne.define("no_backspace_delete",ao);Ne.define("no_active_items",lo);Ne.define("optgroup_columns",uo);Ne.define("remove_button",co);Ne.define("restore_on_backspace",fo);Ne.define("virtual_scroll",po);async function ho(i){if(!await Y.scene.isReady())return;const n=(await Y.scene.local.getItems(o=>o.layer==="CHARACTER"))?.map(o=>o.id);let a=!1;for(const o of i){const u=o.metadata[`${D.EXTENSIONID}/metadata_ghosts`];if(u?.length>0){a=!0;const w=u.map(_=>_.id);for(const _ of u){const x=_.metadata[`${D.EXTENSIONID}/viewers`];x&&(x.includes(H.userId)?await Y.scene.local.addItems([_]):n.includes(_.id)&&await Y.scene.local.deleteItems([_.id]))}const A=n.filter(_=>!w.includes(_));A?.length>0&&await Y.scene.local.deleteItems(A)}}a||await Y.scene.local.deleteItems(n)}function go(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const a of H.players)n.push({value:a.id,text:a.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function mo(){Y.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${D.EXTENSIONID}/metadata_ghosts`]=e,await Y.player.setMetadata(t)}),await Y.contextMenu.create({id:`${D.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){document.getElementById("spectreWarning").style.display="none";for(const e of i.items){const t=e,n=t.text?.plainText||t.name;await Y.scene.items.deleteItems([t.id]),await Y.scene.local.addItems([t]),H.ghosts.push(t);const a=document.getElementById("ghostList"),o=document.createElement("tr");o.id=`tr-${t.id}`,o.className="ghost-table-entry",o.innerHTML=`<td class="token-name">${n}</td>
<td><select id="select-${t.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${t.id}" value="Delete"/></td>`,a.appendChild(o);const u=document.getElementById(`select-${t.id}`);for(const _ of H.players){const x=document.createElement("option");x.value=_.id,x.text=_.name,u.appendChild(x)}const w={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:H.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(_,x){const N=x.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await Y.scene.local.updateItems([N],L=>{const ee=L[0].metadata[`${D.EXTENSIONID}/viewers`],E=ee.findIndex(G=>G==_);ee.splice(E,1),L[0].metadata[`${D.EXTENSIONID}/viewers`]=ee})},onItemAdd:async function(_,x){const N=x.parentElement.parentElement.parentElement.parentElement.id.slice(3);await Y.scene.local.updateItems([N],L=>{const ee=L[0].metadata[`${D.EXTENSIONID}/viewers`];ee?(ee.push(_),L[0].metadata[`${D.EXTENSIONID}/viewers`]=ee):L[0].metadata[`${D.EXTENSIONID}/viewers`]=[_]})}};new Ne(`#select-${t.id}`,w);const A=document.getElementById(`deleteGhost-${t.id}`);A.onclick=async()=>{const _=H.ghosts.findIndex(x=>x.id===t.id);H.ghosts.splice(_,1),o.remove(),await Y.scene.local.updateItems([t.id],x=>{x[0].metadata[`${D.EXTENSIONID}/viewers`]=[]}),await Y.scene.local.deleteItems([t.id])}}}})}const Tn=document.getElementById("app");Tn.innerHTML=`
  <div>
    <div>
      <div class="title">Smoke!  Dynamic Fog&nbsp;&nbsp;</div>
      <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
      <div class="tooltip" id="whatsnewbutton" title="Whats New">&#x1F6C8;
    </div>
    <hr>
    <div style="text-align: center;">
      <p><span id="map_size">Boundary Size: 
      <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
      <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
      <input type="button" id="mapSubmit" value="Update"/>
      &nbsp;&nbsp;&nbsp;
      Grid Snap:</span><input type="checkbox" id="snap_checkbox" class="></p>
      
      <hr>
      <div class="visionTitle">Vision Radius</div>
      <div><i>GM-owned tokens give universal vision.</i></div>
      <p id="no_tokens_message">Enable vision on your character tokens.</p>
      <div id="token_list_div" style="display: block;">
        <table style="margin: auto; padding: 0;"><tbody id="token_list">
        </tbody></table>
      </div>
      </div>
      <hr>
      <div class="visionTitle">Spectres!</div>
      <div id="ghostContainer" style="display: block;">
      <div id="spectreWarning"><i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i></br>
      Enable vision here after it's been Spectred.</div>
        <table style="margin: auto; padding: 0; width: 100%">
        <colgroup>
            <col style="width: 50%;">
            <col style="width: 25%;">
            <col style="width: 25%;">
        </colgroup>
        <tbody id="ghostList">
        </tbody></table>
    <div id="debug_div" style="display: none;">
      <br><hr><br>
      <h2>Debug</h2>
      <h3>Performance Info</h3>
      <ul>
        <li><p>Compute time: <span id=compute_time>N/A</span></p></li>
        <li><p>Communication time: <span id=communication_time>N/A</span></p></li>
        <li><p>Cache hits/misses: <span id=cache_hits>?</span>/<span id=cache_misses>?</span></p></li>
      </ul>
    </div>
  </div>
`;Tn.parentElement.style.placeItems="start";const Ni=document.getElementById("vision_checkbox"),li=document.getElementById("snap_checkbox"),yo=document.getElementById("token_list"),ui=document.getElementById("no_tokens_message"),vo=document.getElementById("mapHeight"),wo=document.getElementById("mapWidth"),_o=document.getElementById("mapSubmit");async function bo(){Ni.addEventListener("click",async i=>{if(!H.ready||!i.target){i.preventDefault();return}const e=i.target;await Y.scene.setMetadata({[`${D.EXTENSIONID}/visionEnabled`]:e.checked})},!1),li.checked=!0,li.addEventListener("click",async i=>{if(!H.ready||!i.target){i.preventDefault();return}const e=i.target;H.snap=e.checked},!1)}function $t(i){const e=i.filter(pi);H.metadata&&(Ni.checked=H.metadata[`${D.EXTENSIONID}/visionEnabled`]==!0),e.length>0?ui.style.display="none":ui.style.display="block";const t=document.getElementsByClassName("token-table-entry"),n=[];for(const a of t){const o=a.id.slice(3);e.find(u=>u.id===o)===void 0&&n.push(a)}for(const a of n)a.remove();for(const a of e){const o=document.getElementById(`tr-${a.id}`);if(o){const u=o.getElementsByClassName("token-name")[0],w=o.getElementsByClassName("token-vision-range")[0],A=o.getElementsByClassName("unlimited-vision")[0];u&&(u.innerText=a.name),w&&(A.checked||(w.value=a.metadata[`${D.EXTENSIONID}/visionRange`]?a.metadata[`${D.EXTENSIONID}/visionRange`]:D.VISIONDEFAULT)),A&&(A.checked=!a.metadata[`${D.EXTENSIONID}/visionRange`]),A.checked?w.setAttribute("disabled","disabled"):w.removeAttribute("disabled")}else{const u=document.createElement("tr");u.id=`tr-${a.id}`,u.className="token-table-entry",u.innerHTML=`<td class="token-name">${a.name}</td><td><input class="token-vision-range" type="number" value=${D.VISIONDEFAULT}><span class="unit">ft</span></td><td>&nbsp;&nbsp;&infin;&nbsp<input type="checkbox" class="unlimited-vision"></td>`,yo.appendChild(u);const w=u.getElementsByClassName("token-vision-range")[0],A=u.getElementsByClassName("unlimited-vision")[0];w.addEventListener("change",async _=>{if(!_||!_.target)return;const x=_.target,N=parseInt(x.value);N<0&&(x.value="0"),N>999&&(x.value="999"),await Y.scene.items.updateItems([a],L=>{L[0].metadata[`${D.EXTENSIONID}/visionRange`]=N})},!1),A.addEventListener("click",async _=>{if(!_||!_.target)return;let x=0;_.target.checked?w.setAttribute("disabled","disabled"):(x=parseInt(w.value),w.removeAttribute("disabled")),await Y.scene.items.updateItems([a],L=>{L[0].metadata[`${D.EXTENSIONID}/visionRange`]=x})},!1)}}}async function ci(i){let e,t;[H.items,H.metadata,H.gridDpi,H.gridScale,e,t]=await Promise.all([Y.scene.items.getItems(),Y.scene.getMetadata(),Y.scene.grid.getDpi(),Y.scene.grid.getScale(),Y.scene.fog.getFilled(),Y.scene.fog.getColor()]),await Y.scene.items.deleteItems(H.items.filter(In).map(o=>o.id)),H.snap=!0,H.gridScale=H.gridScale.parsed.multiplier,H.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(H.items.filter(Zi).length==0){const o=H.items.filter(w=>w.layer=="MAP"&&w.type=="IMAGE"),u=o.map(w=>w.image.width*w.image.height/Math.pow(w.grid.dpi,2));n=o[u.indexOf(Math.max(...u))]}let a;if(H.items.filter(hi).length==0&&(a=st().width(H.gridDpi*30).height(H.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),a.metadata[`${D.EXTENSIONID}/isBackgroundImage`]=!0,a.id=D.GRIDID,H.items.push(a)),i=="GM"){a&&await Y.scene.items.addItems([a]),_o.onclick=async()=>{await Y.scene.items.updateItems([D.GRIDID],u=>{for(const w of u){const A=w;A.width=H.gridDpi*+wo.value,A.height=H.gridDpi*+vo.value,A.scale={x:1,y:1}}})};const o=document.getElementById("whatsnewbutton");o.onclick=async function(){await Y.modal.open({id:D.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},$t(H.items),n!==void 0&&await Y.scene.items.updateItems([n],u=>{u[0].metadata[`${D.EXTENSIONID}/isBackgroundImage`]=!0})}}Y.onReady(async()=>{await Y.player.getRole().then(async i=>{i=="GM"?(H.role="GM",await bo(),await hr(),await gr(),await mr(),await mo()):(Tn.innerHTML="Configuration is GM-Access only.",await Y.action.setHeight(90),await Y.action.setWidth(320)),Y.scene.fog.onChange(e=>{H.fog=e}),Y.scene.items.onChange(async e=>{const t=e;H.items=t,H.ready&&(i=="GM"&&$t(t),await ft())}),H.userId=await Y.player.getId(),H.players=await Y.party.getPlayers(),Y.party.onChange(async e=>{H.players=e,i==="PLAYER"?await ho(e):go()}),Y.scene.grid.onChange(async e=>{H.gridDpi=e.dpi,H.gridScale=parseInt(e.scale),H.ready&&await ft()}),Y.scene.onMetadataChange(async e=>{H.metadata=e,H.ready&&await ft()}),Y.scene.onReadyChange(async e=>{H.ready=e,e?(ci(i),await ft()):i=="GM"&&$t([])}),H.ready=await Y.scene.isReady(),H.ready?(ci(i),await ft()):i=="GM"&&$t([])})});
