import{C as S,b as Wt,a as nn,O as H,c as vt,d as ii}from"./constants-4214fcbb.js";var wn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ti(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function pr(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}),t}class hr{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const U=new hr;function gr(n){return n.layer=="MAP"&&(n.metadata[`${S.EXTENSIONID}/isBackgroundImage`]||n.metadata[`${S.ARMINDOID}/isBackgroundImage`])}function Pn(n){return n.metadata[`${S.EXTENSIONID}/isVisionFog`]||n.metadata[`${S.ARMINDOID}/isVisionFog`]}function mr(n){return n.metadata[`${S.EXTENSIONID}/isIndicatorRing`]||n.metadata[`${S.ARMINDOID}/isIndicatorRing`]}function vr(n){return n.metadata[`${S.EXTENSIONID}/isVisionLine`]&&!n.metadata[`${S.EXTENSIONID}/disabled`]||n.metadata[`${S.ARMINDOID}/isVisionLine`]&&!n.metadata[`${S.ARMINDOID}/disabled`]}function yr(n){return n.layer=="CHARACTER"&&(n.metadata[`${S.EXTENSIONID}/hasVision`]||n.metadata[`${S.ARMINDOID}/hasVision`])}function wr(n){return n.layer=="CHARACTER"&&(n.metadata[`${S.EXTENSIONID}/hasVision`]||n.metadata[`${S.ARMINDOID}/hasVision`])&&!n.metadata[`${S.EXTENSIONID}/visionBlind`]}function br(n){return n.layer=="CHARACTER"&&n.createdUserId==U.userId&&(n.metadata[`${S.EXTENSIONID}/hasVision`]||n.metadata[`${S.ARMINDOID}/hasVision`])&&!n.metadata[`${S.EXTENSIONID}/visionBlind`]}function Ai(n){return n.layer=="DRAWING"&&(n.metadata[`${S.EXTENSIONID}/isBackgroundImage`]||n.metadata[`${S.ARMINDOID}/isBackgroundImage`])}function Mt(n){return n.metadata[`${S.EXTENSIONID}/isTrailingFog`]}function Vt(n){return n.metadata[`${S.EXTENSIONID}/isTrailingFog`]||n.metadata[`${S.EXTENSIONID}/isVisionFog`]||n.metadata[`${S.ARMINDOID}/isVisionFog`]||n.metadata[`${S.EXTENSIONID}/isIndicatorRing`]}var xi={exports:{}};const Ir={},Er=Object.freeze(Object.defineProperty({__proto__:null,default:Ir},Symbol.toStringTag,{value:"Module"})),bn=pr(Er);(function(n,e){var t=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var u=Object.assign,v,E;r.ready=new Promise(function(a,s){v=a,E=s}),function(a){var s={};a.loadCmdsTypedArray=function(B){for(var z=0,Q=0;Q<B.length;Q++)z+=B[Q].length;if(s[z])var ee=s[z];else ee=new Float32Array(z),s[z]=ee;var re=0;for(Q=0;Q<B.length;Q++)for(var Ee=0;Ee<B[Q].length;Ee++){var Ne=B[Q][Ee];typeof Ne=="string"&&(Ne=a.SkBits2FloatUnsigned(parseInt(Ne))),ee[re]=Ne,re++}return B=a._malloc(ee.length*ee.BYTES_PER_ELEMENT),a.HEAPF32.set(ee,B/ee.BYTES_PER_ELEMENT),[B,z]},a.FromCmds=function(B){B=a.loadCmdsTypedArray(B);var z=a._FromCmds(B[0],B[1]);return a._free(B[0]),z};var c,p,_,x,K;a.cubicYFromX=function(B,z,Q,ee,re){return c&&p===B&&_===z&&x===Q&&K===ee||(c&&c.delete(),c=new a._SkCubicMap([B,z],[Q,ee]),p=B,_=z,x=Q,K=ee),c.computeYFromX(re)},a.cubicPtFromT=function(B,z,Q,ee,re){return c&&p===B&&_===z&&x===Q&&K===ee||(c&&c.delete(),c=new a._SkCubicMap([B,z],[Q,ee]),p=B,_=z,x=Q,K=ee),c.computePtFromT(re)}}(r),function(a){a.onRuntimeInitialized=function(){a.SkPath.prototype.addPath=function(){var s=arguments[0];if(arguments.length===1)this._addPath(s,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var c=arguments[1];this._addPath(s,c.a,c.c,c.e,c.b,c.d,c.f,0,0,1)}else if(arguments.length===7)c=arguments,this._addPath(s,c[1],c[3],c[5],c[2],c[4],c[6],0,0,1);else if(arguments.length===10)c=arguments,this._addPath(s,c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},a.SkPath.prototype.arc=function(s,c,p,_,x,K){return this._arc(s,c,p,_,x,!!K),this},a.SkPath.prototype.arcTo=function(s,c,p,_,x){return this._arcTo(s,c,p,_,x),this},a.SkPath.prototype.bezierCurveTo=function(s,c,p,_,x,K){return this._cubicTo(s,c,p,_,x,K),this},a.SkPath.prototype.close=function(){return this._close(),this},a.SkPath.prototype.closePath=function(){return this._close(),this},a.SkPath.prototype.conicTo=function(s,c,p,_,x){return this._conicTo(s,c,p,_,x),this},a.SkPath.prototype.cubicTo=function(s,c,p,_,x,K){return this._cubicTo(s,c,p,_,x,K),this},a.SkPath.prototype.dash=function(s,c,p){return this._dash(s,c,p)?this:null},a.SkPath.prototype.ellipse=function(s,c,p,_,x,K,B,z){return this._ellipse(s,c,p,_,x,K,B,!!z),this},a.SkPath.prototype.lineTo=function(s,c){return this._lineTo(s,c),this},a.SkPath.prototype.moveTo=function(s,c){return this._moveTo(s,c),this},a.SkPath.prototype.op=function(s,c){return this._op(s,c)?this:null},a.SkPath.prototype.quadraticCurveTo=function(s,c,p,_){return this._quadTo(s,c,p,_),this},a.SkPath.prototype.quadTo=function(s,c,p,_){return this._quadTo(s,c,p,_),this},a.SkPath.prototype.rect=function(s,c,p,_){return this._rect(s,c,p,_),this},a.SkPath.prototype.simplify=function(){return this._simplify()?this:null},a.SkPath.prototype.stroke=function(s){return s=s||{},s.width=s.width||1,s.miter_limit=s.miter_limit||4,s.cap=s.cap||a.StrokeCap.BUTT,s.join=s.join||a.StrokeJoin.MITER,this._stroke(s)?this:null},a.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var s=arguments;this._transform(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},a.SkPath.prototype.trim=function(s,c,p){return this._trim(s,c,!!p)?this:null}}}(r);var b=u({},r),P=typeof window=="object",D=typeof importScripts=="function",V="",Z,k,q,T,L,A;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(V=D?bn.dirname(V)+"/":__dirname+"/",A=()=>{L||(T=bn,L=bn)},Z=function(a,s){return A(),a=L.normalize(a),T.readFileSync(a,s?null:"utf8")},q=a=>(a=Z(a,!0),a.buffer||(a=new Uint8Array(a)),a),k=(a,s,c)=>{A(),a=L.normalize(a),T.readFile(a,function(p,_){p?c(p):s(_.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(a){throw a}),process.on("unhandledRejection",function(a){throw a}),r.inspect=function(){return"[Emscripten Module object]"}):(P||D)&&(D?V=self.location.href:typeof document<"u"&&document.currentScript&&(V=document.currentScript.src),i&&(V=i),V.indexOf("blob:")!==0?V=V.substr(0,V.replace(/[?#].*/,"").lastIndexOf("/")+1):V="",Z=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.send(null),s.responseText},D&&(q=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),k=(a,s,c)=>{var p=new XMLHttpRequest;p.open("GET",a,!0),p.responseType="arraybuffer",p.onload=()=>{p.status==200||p.status==0&&p.response?s(p.response):c()},p.onerror=c,p.send(null)});var j=r.print||console.log.bind(console),X=r.printErr||console.warn.bind(console);u(r,b),b=null;var J;r.wasmBinary&&(J=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ie("no native wasm support detected");var I,g=!1,f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function y(a,s,c){var p=s+c;for(c=s;a[c]&&!(c>=p);)++c;if(16<c-s&&a.subarray&&f)return f.decode(a.subarray(s,c));for(p="";s<c;){var _=a[s++];if(_&128){var x=a[s++]&63;if((_&224)==192)p+=String.fromCharCode((_&31)<<6|x);else{var K=a[s++]&63;_=(_&240)==224?(_&15)<<12|x<<6|K:(_&7)<<18|x<<12|K<<6|a[s++]&63,65536>_?p+=String.fromCharCode(_):(_-=65536,p+=String.fromCharCode(55296|_>>10,56320|_&1023))}}else p+=String.fromCharCode(_)}return p}function d(a,s,c){var p=oe;if(0<c){c=s+c-1;for(var _=0;_<a.length;++_){var x=a.charCodeAt(_);if(55296<=x&&57343>=x){var K=a.charCodeAt(++_);x=65536+((x&1023)<<10)|K&1023}if(127>=x){if(s>=c)break;p[s++]=x}else{if(2047>=x){if(s+1>=c)break;p[s++]=192|x>>6}else{if(65535>=x){if(s+2>=c)break;p[s++]=224|x>>12}else{if(s+3>=c)break;p[s++]=240|x>>18,p[s++]=128|x>>12&63}p[s++]=128|x>>6&63}p[s++]=128|x&63}}p[s]=0}}var O=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function N(a,s){for(var c=a>>1,p=c+s/2;!(c>=p)&&qe[c];)++c;if(c<<=1,32<c-a&&O)return O.decode(oe.subarray(a,c));for(c="",p=0;!(p>=s/2);++p){var _=De[a+2*p>>1];if(_==0)break;c+=String.fromCharCode(_)}return c}function ue(a,s,c){if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var p=s;c=c<2*a.length?c/2:a.length;for(var _=0;_<c;++_)De[s>>1]=a.charCodeAt(_),s+=2;return De[s>>1]=0,s-p}function se(a){return 2*a.length}function ce(a,s){for(var c=0,p="";!(c>=s/4);){var _=ke[a+4*c>>2];if(_==0)break;++c,65536<=_?(_-=65536,p+=String.fromCharCode(55296|_>>10,56320|_&1023)):p+=String.fromCharCode(_)}return p}function te(a,s,c){if(c===void 0&&(c=2147483647),4>c)return 0;var p=s;c=p+c-4;for(var _=0;_<a.length;++_){var x=a.charCodeAt(_);if(55296<=x&&57343>=x){var K=a.charCodeAt(++_);x=65536+((x&1023)<<10)|K&1023}if(ke[s>>2]=x,s+=4,s+4>c)break}return ke[s>>2]=0,s-p}function we(a){for(var s=0,c=0;c<a.length;++c){var p=a.charCodeAt(c);55296<=p&&57343>=p&&++c,s+=4}return s}var be,ye,oe,De,qe,ke,Be,et,nt;function Y(){var a=I.buffer;be=a,r.HEAP8=ye=new Int8Array(a),r.HEAP16=De=new Int16Array(a),r.HEAP32=ke=new Int32Array(a),r.HEAPU8=oe=new Uint8Array(a),r.HEAPU16=qe=new Uint16Array(a),r.HEAPU32=Be=new Uint32Array(a),r.HEAPF32=et=new Float32Array(a),r.HEAPF64=nt=new Float64Array(a)}var C,l=[],h=[],m=[];function M(){var a=r.preRun.shift();l.unshift(a)}var F=0,W=null;r.preloadedImages={},r.preloadedAudios={};function ie(a){throw r.onAbort&&r.onAbort(a),a="Aborted("+a+")",X(a),g=!0,a=new WebAssembly.RuntimeError(a+". Build with -s ASSERTIONS=1 for more info."),E(a),a}function me(){return ae.startsWith("data:application/octet-stream;base64,")}var ae;if(ae="pathkit.wasm",!me()){var Se=ae;ae=r.locateFile?r.locateFile(Se,V):V+Se}function Ae(){var a=ae;try{if(a==ae&&J)return new Uint8Array(J);if(q)return q(a);throw"both async and sync fetching of the wasm failed"}catch(s){ie(s)}}function Ce(){if(!J&&(P||D)){if(typeof fetch=="function"&&!ae.startsWith("file://"))return fetch(ae,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+ae+"'";return a.arrayBuffer()}).catch(function(){return Ae()});if(k)return new Promise(function(a,s){k(ae,function(c){a(new Uint8Array(c))},s)})}return Promise.resolve().then(function(){return Ae()})}function Oe(a){for(;0<a.length;){var s=a.shift();if(typeof s=="function")s(r);else{var c=s.Wa;typeof c=="number"?s.xa===void 0?C.get(c)():C.get(c)(s.xa):c(s.xa===void 0?null:s.xa)}}}var fe={};function pe(a){for(;a.length;){var s=a.pop();a.pop()(s)}}function $e(a){return this.fromWireType(Be[a>>2])}var Ve={},Ke={},w={};function R(a){if(a===void 0)return"_unknown";a=a.replace(/[^a-zA-Z0-9_]/g,"$");var s=a.charCodeAt(0);return 48<=s&&57>=s?"_"+a:a}function G(a,s){return a=R(a),function(){return s.apply(this,arguments)}}function ne(a){var s=Error,c=G(a,function(p){this.name=a,this.message=p,p=Error(p).stack,p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var le=void 0;function he(a){throw new le(a)}function de(a,s,c){function p(B){B=c(B),B.length!==a.length&&he("Mismatched type converter count");for(var z=0;z<a.length;++z)it(a[z],B[z])}a.forEach(function(B){w[B]=s});var _=Array(s.length),x=[],K=0;s.forEach(function(B,z){Ke.hasOwnProperty(B)?_[z]=Ke[B]:(x.push(B),Ve.hasOwnProperty(B)||(Ve[B]=[]),Ve[B].push(function(){_[z]=Ke[B],++K,K===x.length&&p(_)}))}),x.length===0&&p(_)}var xe={};function ge(a){switch(a){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+a)}}var Fe=void 0;function Ie(a){for(var s="";oe[a];)s+=Fe[oe[a++]];return s}var Re=void 0;function ve(a){throw new Re(a)}function it(a,s,c={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");var p=s.name;if(a||ve('type "'+p+'" must have a positive integer typeid pointer'),Ke.hasOwnProperty(a)){if(c.Qa)return;ve("Cannot register type '"+p+"' twice")}Ke[a]=s,delete w[a],Ve.hasOwnProperty(a)&&(s=Ve[a],delete Ve[a],s.forEach(function(_){_()}))}function on(a){ve(a.ea.ha.fa.name+" instance already deleted")}var sn=!1;function jn(){}function Xn(a){--a.count.value,a.count.value===0&&(a.ka?a.ma.la(a.ka):a.ha.fa.la(a.ga))}function yt(a){return typeof FinalizationGroup>"u"?(yt=s=>s,a):(sn=new FinalizationGroup(function(s){for(var c=s.next();!c.done;c=s.next())c=c.value,c.ga?Xn(c):console.warn("object already deleted: "+c.ga)}),yt=s=>(sn.register(s,s.ea,s.ea),s),jn=s=>{sn.unregister(s.ea)},yt(a))}var wt=void 0,bt=[];function an(){for(;bt.length;){var a=bt.pop();a.ea.pa=!1,a.delete()}}function lt(){}var Un={};function Hn(a,s,c){if(a[s].ia===void 0){var p=a[s];a[s]=function(){return a[s].ia.hasOwnProperty(arguments.length)||ve("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[s].ia+")!"),a[s].ia[arguments.length].apply(this,arguments)},a[s].ia=[],a[s].ia[p.ua]=p}}function ln(a,s,c){r.hasOwnProperty(a)?((c===void 0||r[a].ia!==void 0&&r[a].ia[c]!==void 0)&&ve("Cannot register public name '"+a+"' twice"),Hn(r,a,a),r.hasOwnProperty(c)&&ve("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[a].ia[c]=s):(r[a]=s,c!==void 0&&(r[a].Xa=c))}function Qi(a,s,c,p,_,x,K,B){this.name=a,this.constructor=s,this.qa=c,this.la=p,this.na=_,this.Oa=x,this.ta=K,this.La=B,this.Ta=[]}function cn(a,s,c){for(;s!==c;)s.ta||ve("Expected null or instance of "+c.name+", got an instance of "+s.name),a=s.ta(a),s=s.na;return a}function Ji(a,s){return s===null?(this.Ba&&ve("null is not a valid "+this.name),0):(s.ea||ve('Cannot pass "'+hn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),cn(s.ea.ga,s.ea.ha.fa,this.fa))}function er(a,s){if(s===null){if(this.Ba&&ve("null is not a valid "+this.name),this.wa){var c=this.sa();return a!==null&&a.push(this.la,c),c}return 0}if(s.ea||ve('Cannot pass "'+hn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&s.ea.ha.va&&ve("Cannot convert argument of type "+(s.ea.ma?s.ea.ma.name:s.ea.ha.name)+" to parameter type "+this.name),c=cn(s.ea.ga,s.ea.ha.fa,this.fa),this.wa)switch(s.ea.ka===void 0&&ve("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:s.ea.ma===this?c=s.ea.ka:ve("Cannot convert argument of type "+(s.ea.ma?s.ea.ma.name:s.ea.ha.name)+" to parameter type "+this.name);break;case 1:c=s.ea.ka;break;case 2:if(s.ea.ma===this)c=s.ea.ka;else{var p=s.clone();c=this.Ua(c,ct(function(){p.delete()})),a!==null&&a.push(this.la,c)}break;default:ve("Unsupporting sharing policy")}return c}function tr(a,s){return s===null?(this.Ba&&ve("null is not a valid "+this.name),0):(s.ea||ve('Cannot pass "'+hn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),s.ea.ha.va&&ve("Cannot convert argument of type "+s.ea.ha.name+" to parameter type "+this.name),cn(s.ea.ga,s.ea.ha.fa,this.fa))}function Wn(a,s,c){return s===c?a:c.na===void 0?null:(a=Wn(a,s,c.na),a===null?null:c.La(a))}var It={};function nr(a,s){for(s===void 0&&ve("ptr should not be undefined");a.na;)s=a.ta(s),a=a.na;return It[s]}function At(a,s){return s.ha&&s.ga||he("makeClassHandle requires ptr and ptrType"),!!s.ma!=!!s.ka&&he("Both smartPtrType and smartPtr must be specified"),s.count={value:1},yt(Object.create(a,{ea:{value:s}}))}function ot(a,s,c,p){this.name=a,this.fa=s,this.Ba=c,this.va=p,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,s.na!==void 0?this.toWireType=er:(this.toWireType=p?Ji:tr,this.ja=null)}function Gn(a,s,c){r.hasOwnProperty(a)||he("Replacing nonexistant public symbol"),r[a].ia!==void 0&&c!==void 0?r[a].ia[c]=s:(r[a]=s,r[a].ua=c)}function ir(a,s){var c=[];return function(){c.length=arguments.length;for(var p=0;p<arguments.length;p++)c[p]=arguments[p];return a.includes("j")?(p=r["dynCall_"+a],p=c&&c.length?p.apply(null,[s].concat(c)):p.call(null,s)):p=C.get(s).apply(null,c),p}}function je(a,s){a=Ie(a);var c=a.includes("j")?ir(a,s):C.get(s);return typeof c!="function"&&ve("unknown function pointer with signature "+a+": "+s),c}var qn=void 0;function Kn(a){a=ei(a);var s=Ie(a);return st(a),s}function xt(a,s){function c(x){_[x]||Ke[x]||(w[x]?w[x].forEach(c):(p.push(x),_[x]=!0))}var p=[],_={};throw s.forEach(c),new qn(a+": "+p.map(Kn).join([", "]))}function un(a,s){for(var c=[],p=0;p<a;p++)c.push(ke[(s>>2)+p]);return c}function dn(a,s,c,p,_){var x=s.length;2>x&&ve("argTypes array size mismatch! Must at least get return value and 'this' types!");var K=s[1]!==null&&c!==null,B=!1;for(c=1;c<s.length;++c)if(s[c]!==null&&s[c].ja===void 0){B=!0;break}var z=s[0].name!=="void",Q=x-2,ee=Array(Q),re=[],Ee=[];return function(){if(arguments.length!==Q&&ve("function "+a+" called with "+arguments.length+" arguments, expected "+Q+" args!"),Ee.length=0,re.length=K?2:1,re[0]=_,K){var Ne=s[1].toWireType(Ee,this);re[1]=Ne}for(var _e=0;_e<Q;++_e)ee[_e]=s[_e+2].toWireType(Ee,arguments[_e]),re.push(ee[_e]);if(_e=p.apply(null,re),B)pe(Ee);else for(var Xe=K?1:2;Xe<s.length;Xe++){var Ue=Xe===1?Ne:ee[Xe-2];s[Xe].ja!==null&&s[Xe].ja(Ue)}return Ne=z?s[0].fromWireType(_e):void 0,Ne}}var fn=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function zn(a){4<a&&--tt[a].Ca===0&&(tt[a]=void 0,fn.push(a))}function pn(a){return a||ve("Cannot use deleted val. handle = "+a),tt[a].value}function ct(a){switch(a){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var s=fn.length?fn.pop():tt.length;return tt[s]={Ca:1,value:a},s}}function rr(a,s,c){switch(s){case 0:return function(p){return this.fromWireType((c?ye:oe)[p])};case 1:return function(p){return this.fromWireType((c?De:qe)[p>>1])};case 2:return function(p){return this.fromWireType((c?ke:Be)[p>>2])};default:throw new TypeError("Unknown integer type: "+a)}}function Nt(a,s){var c=Ke[a];return c===void 0&&ve(s+" has unknown type "+Kn(a)),c}function hn(a){if(a===null)return"null";var s=typeof a;return s==="object"||s==="array"||s==="function"?a.toString():""+a}function or(a,s){switch(s){case 2:return function(c){return this.fromWireType(et[c>>2])};case 3:return function(c){return this.fromWireType(nt[c>>3])};default:throw new TypeError("Unknown float type: "+a)}}function sr(a,s,c){switch(s){case 0:return c?function(p){return ye[p]}:function(p){return oe[p]};case 1:return c?function(p){return De[p>>1]}:function(p){return qe[p>>1]};case 2:return c?function(p){return ke[p>>2]}:function(p){return Be[p>>2]};default:throw new TypeError("Unknown integer type: "+a)}}var ar={};function gn(a){var s=ar[a];return s===void 0?Ie(a):s}var mn=[];function Yn(){function a(s){s.$$$embind_global$$$=s;var c=typeof $$$embind_global$$$=="object"&&s.$$$embind_global$$$===s;return c||delete s.$$$embind_global$$$,c}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof wn=="object"&&a(wn)?$$$embind_global$$$=wn:typeof self=="object"&&a(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function lr(a){var s=mn.length;return mn.push(a),s}function cr(a,s){for(var c=Array(a),p=0;p<a;++p)c[p]=Nt(ke[(s>>2)+p],"parameter "+p);return c}var Zn=[];function ur(a){var s=Array(a+1);return function(c,p,_){s[0]=c;for(var x=0;x<a;++x){var K=Nt(ke[(p>>2)+x],"parameter "+x);s[x+1]=K.readValueFromPointer(_),_+=K.argPackAdvance}return c=new(c.bind.apply(c,s)),ct(c)}}var Qn={},dr=[null,[],[]];le=r.InternalError=ne("InternalError");for(var Jn=Array(256),Ct=0;256>Ct;++Ct)Jn[Ct]=String.fromCharCode(Ct);Fe=Jn,Re=r.BindingError=ne("BindingError"),lt.prototype.isAliasOf=function(a){if(!(this instanceof lt&&a instanceof lt))return!1;var s=this.ea.ha.fa,c=this.ea.ga,p=a.ea.ha.fa;for(a=a.ea.ga;s.na;)c=s.ta(c),s=s.na;for(;p.na;)a=p.ta(a),p=p.na;return s===p&&c===a},lt.prototype.clone=function(){if(this.ea.ga||on(this),this.ea.ra)return this.ea.count.value+=1,this;var a=yt,s=Object,c=s.create,p=Object.getPrototypeOf(this),_=this.ea;return a=a(c.call(s,p,{ea:{value:{count:_.count,pa:_.pa,ra:_.ra,ga:_.ga,ha:_.ha,ka:_.ka,ma:_.ma}}})),a.ea.count.value+=1,a.ea.pa=!1,a},lt.prototype.delete=function(){this.ea.ga||on(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),jn(this),Xn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},lt.prototype.isDeleted=function(){return!this.ea.ga},lt.prototype.deleteLater=function(){return this.ea.ga||on(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),bt.push(this),bt.length===1&&wt&&wt(an),this.ea.pa=!0,this},ot.prototype.Pa=function(a){return this.Ia&&(a=this.Ia(a)),a},ot.prototype.Ga=function(a){this.la&&this.la(a)},ot.prototype.argPackAdvance=8,ot.prototype.readValueFromPointer=$e,ot.prototype.deleteObject=function(a){a!==null&&a.delete()},ot.prototype.fromWireType=function(a){function s(){return this.wa?At(this.fa.qa,{ha:this.Sa,ga:c,ma:this,ka:a}):At(this.fa.qa,{ha:this,ga:a})}var c=this.Pa(a);if(!c)return this.Ga(a),null;var p=nr(this.fa,c);if(p!==void 0)return p.ea.count.value===0?(p.ea.ga=c,p.ea.ka=a,p.clone()):(p=p.clone(),this.Ga(a),p);if(p=this.fa.Oa(c),p=Un[p],!p)return s.call(this);p=this.va?p.Ja:p.pointerType;var _=Wn(c,this.fa,p.fa);return _===null?s.call(this):this.wa?At(p.fa.qa,{ha:p,ga:_,ma:this,ka:a}):At(p.fa.qa,{ha:p,ga:_})},r.getInheritedInstanceCount=function(){return Object.keys(It).length},r.getLiveInheritedInstances=function(){var a=[],s;for(s in It)It.hasOwnProperty(s)&&a.push(It[s]);return a},r.flushPendingDeletes=an,r.setDelayFunction=function(a){wt=a,bt.length&&wt&&wt(an)},qn=r.UnboundTypeError=ne("UnboundTypeError"),r.count_emval_handles=function(){for(var a=0,s=5;s<tt.length;++s)tt[s]!==void 0&&++a;return a},r.get_first_emval=function(){for(var a=5;a<tt.length;++a)if(tt[a]!==void 0)return tt[a];return null};var fr={r:function(a){var s=fe[a];delete fe[a];var c=s.elements,p=c.length,_=c.map(function(B){return B.Aa}).concat(c.map(function(B){return B.Ea})),x=s.sa,K=s.la;de([a],_,function(B){return c.forEach(function(z,Q){var ee=B[Q],re=z.ya,Ee=z.za,Ne=B[Q+p],_e=z.Da,Xe=z.Fa;z.read=Ue=>ee.fromWireType(re(Ee,Ue)),z.write=(Ue,dt)=>{var Ye=[];_e(Xe,Ue,Ne.toWireType(Ye,dt)),pe(Ye)}}),[{name:s.name,fromWireType:function(z){for(var Q=Array(p),ee=0;ee<p;++ee)Q[ee]=c[ee].read(z);return K(z),Q},toWireType:function(z,Q){if(p!==Q.length)throw new TypeError("Incorrect number of tuple elements for "+s.name+": expected="+p+", actual="+Q.length);for(var ee=x(),re=0;re<p;++re)c[re].write(ee,Q[re]);return z!==null&&z.push(K,ee),ee},argPackAdvance:8,readValueFromPointer:$e,ja:K}]})},u:function(a){var s=xe[a];delete xe[a];var c=s.sa,p=s.la,_=s.Ha,x=_.map(function(K){return K.Aa}).concat(_.map(function(K){return K.Ea}));de([a],x,function(K){var B={};return _.forEach(function(z,Q){var ee=K[Q],re=z.ya,Ee=z.za,Ne=K[Q+_.length],_e=z.Da,Xe=z.Fa;B[z.Na]={read:function(Ue){return ee.fromWireType(re(Ee,Ue))},write:function(Ue,dt){var Ye=[];_e(Xe,Ue,Ne.toWireType(Ye,dt)),pe(Ye)}}}),[{name:s.name,fromWireType:function(z){var Q={},ee;for(ee in B)Q[ee]=B[ee].read(z);return p(z),Q},toWireType:function(z,Q){for(var ee in B)if(!(ee in Q))throw new TypeError('Missing field:  "'+ee+'"');var re=c();for(ee in B)B[ee].write(re,Q[ee]);return z!==null&&z.push(p,re),re},argPackAdvance:8,readValueFromPointer:$e,ja:p}]})},z:function(){},F:function(a,s,c,p,_){var x=ge(c);s=Ie(s),it(a,{name:s,fromWireType:function(K){return!!K},toWireType:function(K,B){return B?p:_},argPackAdvance:8,readValueFromPointer:function(K){if(c===1)var B=ye;else if(c===2)B=De;else if(c===4)B=ke;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(B[K>>x])},ja:null})},l:function(a,s,c,p,_,x,K,B,z,Q,ee,re,Ee){ee=Ie(ee),x=je(_,x),B&&(B=je(K,B)),Q&&(Q=je(z,Q)),Ee=je(re,Ee);var Ne=R(ee);ln(Ne,function(){xt("Cannot construct "+ee+" due to unbound types",[p])}),de([a,s,c],p?[p]:[],function(_e){if(_e=_e[0],p)var Xe=_e.fa,Ue=Xe.qa;else Ue=lt.prototype;_e=G(Ne,function(){if(Object.getPrototypeOf(this)!==dt)throw new Re("Use 'new' to construct "+ee);if(Ye.oa===void 0)throw new Re(ee+" has no accessible constructor");var ni=Ye.oa[arguments.length];if(ni===void 0)throw new Re("Tried to invoke ctor of "+ee+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ye.oa).toString()+") parameters instead!");return ni.apply(this,arguments)});var dt=Object.create(Ue,{constructor:{value:_e}});_e.prototype=dt;var Ye=new Qi(ee,_e,dt,Ee,Xe,x,B,Q);Xe=new ot(ee,Ye,!0,!1),Ue=new ot(ee+"*",Ye,!1,!1);var ti=new ot(ee+" const*",Ye,!1,!0);return Un[a]={pointerType:Ue,Ja:ti},Gn(Ne,_e),[Xe,Ue,ti]})},i:function(a,s,c,p,_,x){0<s||ie(void 0);var K=un(s,c);_=je(p,_),de([],[a],function(B){B=B[0];var z="constructor "+B.name;if(B.fa.oa===void 0&&(B.fa.oa=[]),B.fa.oa[s-1]!==void 0)throw new Re("Cannot register multiple constructors with identical number of parameters ("+(s-1)+") for class '"+B.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return B.fa.oa[s-1]=()=>{xt("Cannot construct "+B.name+" due to unbound types",K)},de([],K,function(Q){return Q.splice(1,0,null),B.fa.oa[s-1]=dn(z,Q,null,_,x),[]}),[]})},a:function(a,s,c,p,_,x,K,B){var z=un(c,p);s=Ie(s),x=je(_,x),de([],[a],function(Q){function ee(){xt("Cannot call "+re+" due to unbound types",z)}Q=Q[0];var re=Q.name+"."+s;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),B&&Q.fa.Ta.push(s);var Ee=Q.fa.qa,Ne=Ee[s];return Ne===void 0||Ne.ia===void 0&&Ne.className!==Q.name&&Ne.ua===c-2?(ee.ua=c-2,ee.className=Q.name,Ee[s]=ee):(Hn(Ee,s,re),Ee[s].ia[c-2]=ee),de([],z,function(_e){return _e=dn(re,_e,Q,x,K),Ee[s].ia===void 0?(_e.ua=c-2,Ee[s]=_e):Ee[s].ia[c-2]=_e,[]}),[]})},I:function(a,s,c){a=Ie(a),de([],[s],function(p){return p=p[0],r[a]=p.fromWireType(c),[]})},E:function(a,s){s=Ie(s),it(a,{name:s,fromWireType:function(c){var p=pn(c);return zn(c),p},toWireType:function(c,p){return ct(p)},argPackAdvance:8,readValueFromPointer:$e,ja:null})},h:function(a,s,c,p){function _(){}c=ge(c),s=Ie(s),_.values={},it(a,{name:s,constructor:_,fromWireType:function(x){return this.constructor.values[x]},toWireType:function(x,K){return K.value},argPackAdvance:8,readValueFromPointer:rr(s,c,p),ja:null}),ln(s,_)},k:function(a,s,c){var p=Nt(a,"enum");s=Ie(s),a=p.constructor,p=Object.create(p.constructor.prototype,{value:{value:c},constructor:{value:G(p.name+"_"+s,function(){})}}),a.values[c]=p,a[s]=p},q:function(a,s,c){c=ge(c),s=Ie(s),it(a,{name:s,fromWireType:function(p){return p},toWireType:function(p,_){return _},argPackAdvance:8,readValueFromPointer:or(s,c),ja:null})},f:function(a,s,c,p,_,x){var K=un(s,c);a=Ie(a),_=je(p,_),ln(a,function(){xt("Cannot call "+a+" due to unbound types",K)},s-1),de([],K,function(B){return B=[B[0],null].concat(B.slice(1)),Gn(a,dn(a,B,null,_,x),s-1),[]})},e:function(a,s,c,p,_){s=Ie(s),_===-1&&(_=4294967295),_=ge(c);var x=B=>B;if(p===0){var K=32-8*c;x=B=>B<<K>>>K}c=s.includes("unsigned")?function(B,z){return z>>>0}:function(B,z){return z},it(a,{name:s,fromWireType:x,toWireType:c,argPackAdvance:8,readValueFromPointer:sr(s,_,p!==0),ja:null})},b:function(a,s,c){function p(x){x>>=2;var K=Be;return new _(be,K[x+1],K[x])}var _=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];c=Ie(c),it(a,{name:c,fromWireType:p,argPackAdvance:8,readValueFromPointer:p},{Qa:!0})},p:function(a,s){s=Ie(s);var c=s==="std::string";it(a,{name:s,fromWireType:function(p){var _=Be[p>>2];if(c)for(var x=p+4,K=0;K<=_;++K){var B=p+4+K;if(K==_||oe[B]==0){if(x=x?y(oe,x,B-x):"",z===void 0)var z=x;else z+=String.fromCharCode(0),z+=x;x=B+1}}else{for(z=Array(_),K=0;K<_;++K)z[K]=String.fromCharCode(oe[p+4+K]);z=z.join("")}return st(p),z},toWireType:function(p,_){_ instanceof ArrayBuffer&&(_=new Uint8Array(_));var x=typeof _=="string";x||_ instanceof Uint8Array||_ instanceof Uint8ClampedArray||_ instanceof Int8Array||ve("Cannot pass non-string to std::string");var K=(c&&x?()=>{for(var Q=0,ee=0;ee<_.length;++ee){var re=_.charCodeAt(ee);55296<=re&&57343>=re&&(re=65536+((re&1023)<<10)|_.charCodeAt(++ee)&1023),127>=re?++Q:Q=2047>=re?Q+2:65535>=re?Q+3:Q+4}return Q}:()=>_.length)(),B=vn(4+K+1);if(Be[B>>2]=K,c&&x)d(_,B+4,K+1);else if(x)for(x=0;x<K;++x){var z=_.charCodeAt(x);255<z&&(st(B),ve("String has UTF-16 code units that do not fit in 8 bits")),oe[B+4+x]=z}else for(x=0;x<K;++x)oe[B+4+x]=_[x];return p!==null&&p.push(st,B),B},argPackAdvance:8,readValueFromPointer:$e,ja:function(p){st(p)}})},m:function(a,s,c){if(c=Ie(c),s===2)var p=N,_=ue,x=se,K=()=>qe,B=1;else s===4&&(p=ce,_=te,x=we,K=()=>Be,B=2);it(a,{name:c,fromWireType:function(z){for(var Q=Be[z>>2],ee=K(),re,Ee=z+4,Ne=0;Ne<=Q;++Ne){var _e=z+4+Ne*s;(Ne==Q||ee[_e>>B]==0)&&(Ee=p(Ee,_e-Ee),re===void 0?re=Ee:(re+=String.fromCharCode(0),re+=Ee),Ee=_e+s)}return st(z),re},toWireType:function(z,Q){typeof Q!="string"&&ve("Cannot pass non-string to C++ string type "+c);var ee=x(Q),re=vn(4+ee+s);return Be[re>>2]=ee>>B,_(Q,re+4,ee+s),z!==null&&z.push(st,re),re},argPackAdvance:8,readValueFromPointer:$e,ja:function(z){st(z)}})},t:function(a,s,c,p,_,x){fe[a]={name:Ie(s),sa:je(c,p),la:je(_,x),elements:[]}},s:function(a,s,c,p,_,x,K,B,z){fe[a].elements.push({Aa:s,ya:je(c,p),za:_,Ea:x,Da:je(K,B),Fa:z})},v:function(a,s,c,p,_,x){xe[a]={name:Ie(s),sa:je(c,p),la:je(_,x),Ha:[]}},j:function(a,s,c,p,_,x,K,B,z,Q){xe[a].Ha.push({Na:Ie(s),Aa:c,ya:je(p,_),za:x,Ea:K,Da:je(B,z),Fa:Q})},G:function(a,s){s=Ie(s),it(a,{Ra:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(a,s,c,p){a=mn[a],s=pn(s),c=gn(c),a(s,c,null,p)},J:zn,x:function(a){return a===0?ct(Yn()):(a=gn(a),ct(Yn()[a]))},c:function(a,s){var c=cr(a,s),p=c[0];s=p.name+"_$"+c.slice(1).map(function(K){return K.name}).join("_")+"$";var _=Zn[s];if(_!==void 0)return _;var x=Array(a-1);return _=lr((K,B,z,Q)=>{for(var ee=0,re=0;re<a-1;++re)x[re]=c[re+1].readValueFromPointer(Q+ee),ee+=c[re+1].argPackAdvance;for(K=K[B].apply(K,x),re=0;re<a-1;++re)c[re+1].Ka&&c[re+1].Ka(x[re]);if(!p.Ra)return p.toWireType(z,K)}),Zn[s]=_},n:function(a){4<a&&(tt[a].Ca+=1)},w:function(a,s,c,p){a=pn(a);var _=Qn[s];return _||(_=ur(s),Qn[s]=_),_(a,c,p)},K:function(){return ct([])},D:function(a){return ct(gn(a))},H:function(a,s){return a=Nt(a,"_emval_take_value"),a=a.readValueFromPointer(s),ct(a)},g:function(){ie("")},B:function(a){var s=oe.length;if(a>>>=0,2147483648<a)return!1;for(var c=1;4>=c;c*=2){var p=s*(1+.2/c);p=Math.min(p,a+100663296),p=Math.max(a,p),0<p%65536&&(p+=65536-p%65536);e:{try{I.grow(Math.min(2147483648,p)-be.byteLength+65535>>>16),Y();var _=1;break e}catch{}_=void 0}if(_)return!0}return!1},C:function(){return 0},y:function(){},o:function(a,s,c,p){for(var _=0,x=0;x<c;x++){var K=ke[s>>2],B=ke[s+4>>2];s+=8;for(var z=0;z<B;z++){var Q=oe[K+z],ee=dr[a];Q===0||Q===10?((a===1?j:X)(y(ee,0)),ee.length=0):ee.push(Q)}_+=B}return ke[p>>2]=_,0},A:function(){}};(function(){function a(_){r.asm=_.exports,I=r.asm.L,Y(),C=r.asm._,h.unshift(r.asm.M),F--,r.monitorRunDependencies&&r.monitorRunDependencies(F),F==0&&W&&(_=W,W=null,_())}function s(_){a(_.instance)}function c(_){return Ce().then(function(x){return WebAssembly.instantiate(x,p)}).then(function(x){return x}).then(_,function(x){X("failed to asynchronously prepare wasm: "+x),ie(x)})}var p={a:fr};if(F++,r.monitorRunDependencies&&r.monitorRunDependencies(F),r.instantiateWasm)try{return r.instantiateWasm(p,a)}catch(_){return X("Module.instantiateWasm callback failed with error: "+_),!1}return function(){return J||typeof WebAssembly.instantiateStreaming!="function"||me()||ae.startsWith("file://")||typeof fetch!="function"?c(s):fetch(ae,{credentials:"same-origin"}).then(function(_){return WebAssembly.instantiateStreaming(_,p).then(s,function(x){return X("wasm streaming compile failed: "+x),X("falling back to ArrayBuffer instantiation"),c(s)})})}().catch(E),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var st=r._free=function(){return(st=r._free=r.asm.$).apply(null,arguments)},vn=r._malloc=function(){return(vn=r._malloc=r.asm.aa).apply(null,arguments)},ei=r.___getTypeName=function(){return(ei=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Dt;W=function a(){Dt||yn(),Dt||(W=a)};function yn(){function a(){if(!Dt&&(Dt=!0,r.calledRun=!0,!g)){if(Oe(h),v(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var s=r.postRun.shift();m.unshift(s)}Oe(m)}}if(!(0<F)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)M();Oe(l),0<F||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a())}}if(r.run=yn,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return yn(),o.ready}})();n.exports=t})(xi);var _r=xi.exports;const Sr=Ti(_r),Or="/assets/pathkit-1356ccfa.wasm";let Qe=null,Gt="",qt="",Kt="",zt="";async function Ni(){await H.scene.local.deleteItems([zt,Gt,qt,Kt]),Gt="",qt="",zt="",Kt="",await H.popover.close(S.POLYTOOLID)}async function Ci(){if(!Qe)return;const[n,e]=Qe;e(),Qe=null,Ni()}async function Di(){if(!Qe)return;const[n,e]=Qe,t=n(i=>{i.visible=!1,i.metadata[`${S.EXTENSIONID}/isVisionLine`]=!0,i.points.pop(),i.points.push(i.points[0])});t.points.length>=4&&H.scene.items.addItems([t]),e(),Qe=null,Ni()}async function kr(n,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===Gt||e.target.id===qt))Di();else if(e.target&&(e.target.id===zt||e.target.id===Kt))Ci();else{const[t]=Qe;t(i=>{i.points.push(e.pointerPosition)})}else{const t=Wt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),i=nn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Qe=await H.interaction.startItemInteraction(i);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Wt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await H.scene.local.addItems([t,o,r,u]),Gt=t.id,qt=o.id,zt=u.id,Kt=r.id,await H.popover.open({id:S.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function Tr(n,e){if(!Qe||e.transformer)return;const[t]=Qe,i=Math.round(U.gridDpi/U.gridSnap),o=Math.round(e.pointerPosition.x/U.gridDpi)*U.gridDpi,r=Math.round(e.pointerPosition.y/U.gridDpi)*U.gridDpi,u=Math.abs(o-e.pointerPosition.x),v=Math.abs(r-e.pointerPosition.y);let E,b;u<=i?E=o:E=e.pointerPosition.x,v<=i?b=r:b=e.pointerPosition.y,t(P=>{P.points[P.points.length-1]=U.snap?{x:E,y:b}:e.pointerPosition})}function Ar(n,e){Qe&&(e.key=="Escape"?Ci():e.key=="Enter"&&Di())}const In={onToolClick:kr,onToolMove:Tr,onKeyDown:Ar};let Je=null,St="",Ot="",Yt="",Zt="";async function Pi(){await H.scene.local.deleteItems([Zt,St,Ot,Yt]),St="",Ot="",Zt="",Yt="",await H.popover.close(S.LINETOOLID)}async function Li(){if(!Je)return;const[n,e]=Je;e(),Je=null,await Pi()}async function $i(){if(!Je)return;const[n,e]=Je,t=n(i=>{i.visible=!1,i.metadata[`${S.EXTENSIONID}/isVisionLine`]=!0,i.points.pop()});t.points.length>=2&&await H.scene.items.addItems([t]),e(),Je=null,await Pi()}async function xr(n,e){if(!e.transformer)if(Je)if(e.target&&(e.target.id===St||e.target.id===Ot))await $i();else if(e.target&&(e.target.id===Zt||e.target.id===Yt))await Li();else{const[t]=Je;t(i=>{i.points.push(e.pointerPosition)}),await H.scene.local.updateItems(i=>i.id==Ot||i.id==St,i=>{for(const o of i)o.position=e.pointerPosition})}else{const t=Wt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),i=nn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Je=await H.interaction.startItemInteraction(i);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),u=Wt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await H.scene.local.addItems([t,o,r,u]),St=t.id,Ot=o.id,Zt=u.id,Yt=r.id,await H.popover.open({id:S.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function Nr(n,e){if(!Je||e.transformer)return;const[t]=Je,i=Math.round(U.gridDpi/U.gridSnap),o=Math.round(e.pointerPosition.x/U.gridDpi)*U.gridDpi,r=Math.round(e.pointerPosition.y/U.gridDpi)*U.gridDpi,u=Math.abs(o-e.pointerPosition.x),v=Math.abs(r-e.pointerPosition.y);let E,b;u<=i?E=o:E=e.pointerPosition.x,v<=i?b=r:b=e.pointerPosition.y,t(P=>{P.points[P.points.length-1]=U.snap?{x:E,y:b}:e.pointerPosition})}function Cr(n,e){Je&&(e.key=="Escape"?Li():e.key=="Enter"&&$i())}const En={onToolClick:xr,onToolMove:Nr,onKeyDown:Cr};class ri{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Pt(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Fi={exports:{}};(function(n,e){(function(t){n.exports=t()})(function(){return function t(i,o,r){function u(b,P){if(!o[b]){if(!i[b]){var D=typeof Pt=="function"&&Pt;if(!P&&D)return D(b,!0);if(v)return v(b,!0);throw new Error("Cannot find module '"+b+"'")}P=o[b]={exports:{}},i[b][0].call(P.exports,function(V){var Z=i[b][1][V];return u(Z||V)},P,P.exports,t,i,o,r)}return o[b].exports}for(var v=typeof Pt=="function"&&Pt,E=0;E<r.length;E++)u(r[E]);return u}({1:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){var k=t("crypto");function q(I,g){g=A(I,g);var f;return(f=g.algorithm!=="passthrough"?k.createHash(g.algorithm):new J).write===void 0&&(f.write=f.update,f.end=f.update),X(g,f).dispatch(I),f.update||f.end(""),f.digest?f.digest(g.encoding==="buffer"?void 0:g.encoding):(I=f.read(),g.encoding!=="buffer"?I.toString(g.encoding):I)}(o=i.exports=q).sha1=function(I){return q(I)},o.keys=function(I){return q(I,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(I){return q(I,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(I){return q(I,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var T=k.getHashes?k.getHashes().slice():["sha1","md5"],L=(T.push("passthrough"),["buffer","hex","binary","base64"]);function A(I,g){var f={};if(f.algorithm=(g=g||{}).algorithm||"sha1",f.encoding=g.encoding||"hex",f.excludeValues=!!g.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=g.ignoreUnknown===!0,f.respectType=g.respectType!==!1,f.respectFunctionNames=g.respectFunctionNames!==!1,f.respectFunctionProperties=g.respectFunctionProperties!==!1,f.unorderedArrays=g.unorderedArrays===!0,f.unorderedSets=g.unorderedSets!==!1,f.unorderedObjects=g.unorderedObjects!==!1,f.replacer=g.replacer||void 0,f.excludeKeys=g.excludeKeys||void 0,I===void 0)throw new Error("Object argument required.");for(var y=0;y<T.length;++y)T[y].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=T[y]);if(T.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+T.join(", "));if(L.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+L.join(", "));return f}function j(I){if(typeof I=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(I))!=null}function X(I,g,f){f=f||[];function y(d){return g.update?g.update(d,"utf8"):g.write(d,"utf8")}return{dispatch:function(d){return this["_"+((d=I.replacer?I.replacer(d):d)===null?"null":typeof d)](d)},_object:function(d){var O,N=Object.prototype.toString.call(d),ue=/\[object (.*)\]/i.exec(N);if(ue=(ue=ue?ue[1]:"unknown:["+N+"]").toLowerCase(),0<=(N=f.indexOf(d)))return this.dispatch("[CIRCULAR:"+N+"]");if(f.push(d),v!==void 0&&v.isBuffer&&v.isBuffer(d))return y("buffer:"),y(d);if(ue==="object"||ue==="function"||ue==="asyncfunction")return N=Object.keys(d),I.unorderedObjects&&(N=N.sort()),I.respectType===!1||j(d)||N.splice(0,0,"prototype","__proto__","constructor"),I.excludeKeys&&(N=N.filter(function(se){return!I.excludeKeys(se)})),y("object:"+N.length+":"),O=this,N.forEach(function(se){O.dispatch(se),y(":"),I.excludeValues||O.dispatch(d[se]),y(",")});if(!this["_"+ue]){if(I.ignoreUnknown)return y("["+ue+"]");throw new Error('Unknown object type "'+ue+'"')}this["_"+ue](d)},_array:function(d,se){se=se!==void 0?se:I.unorderedArrays!==!1;var N=this;if(y("array:"+d.length+":"),!se||d.length<=1)return d.forEach(function(ce){return N.dispatch(ce)});var ue=[],se=d.map(function(ce){var te=new J,we=f.slice();return X(I,te,we).dispatch(ce),ue=ue.concat(we.slice(f.length)),te.read().toString()});return f=f.concat(ue),se.sort(),this._array(se,!1)},_date:function(d){return y("date:"+d.toJSON())},_symbol:function(d){return y("symbol:"+d.toString())},_error:function(d){return y("error:"+d.toString())},_boolean:function(d){return y("bool:"+d.toString())},_string:function(d){y("string:"+d.length+":"),y(d.toString())},_function:function(d){y("fn:"),j(d)?this.dispatch("[native]"):this.dispatch(d.toString()),I.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(d.name)),I.respectFunctionProperties&&this._object(d)},_number:function(d){return y("number:"+d.toString())},_xml:function(d){return y("xml:"+d.toString())},_null:function(){return y("Null")},_undefined:function(){return y("Undefined")},_regexp:function(d){return y("regex:"+d.toString())},_uint8array:function(d){return y("uint8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint8clampedarray:function(d){return y("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(d))},_int8array:function(d){return y("int8array:"),this.dispatch(Array.prototype.slice.call(d))},_uint16array:function(d){return y("uint16array:"),this.dispatch(Array.prototype.slice.call(d))},_int16array:function(d){return y("int16array:"),this.dispatch(Array.prototype.slice.call(d))},_uint32array:function(d){return y("uint32array:"),this.dispatch(Array.prototype.slice.call(d))},_int32array:function(d){return y("int32array:"),this.dispatch(Array.prototype.slice.call(d))},_float32array:function(d){return y("float32array:"),this.dispatch(Array.prototype.slice.call(d))},_float64array:function(d){return y("float64array:"),this.dispatch(Array.prototype.slice.call(d))},_arraybuffer:function(d){return y("arraybuffer:"),this.dispatch(new Uint8Array(d))},_url:function(d){return y("url:"+d.toString())},_map:function(d){return y("map:"),d=Array.from(d),this._array(d,I.unorderedSets!==!1)},_set:function(d){return y("set:"),d=Array.from(d),this._array(d,I.unorderedSets!==!1)},_file:function(d){return y("file:"),this.dispatch([d.name,d.size,d.type,d.lastModfied])},_blob:function(){if(I.ignoreUnknown)return y("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return y("domwindow")},_bigint:function(d){return y("bigint:"+d.toString())},_process:function(){return y("process")},_timer:function(){return y("timer")},_pipe:function(){return y("pipe")},_tcp:function(){return y("tcp")},_udp:function(){return y("udp")},_tty:function(){return y("tty")},_statwatcher:function(){return y("statwatcher")},_securecontext:function(){return y("securecontext")},_connection:function(){return y("connection")},_zlib:function(){return y("zlib")},_context:function(){return y("context")},_nodescript:function(){return y("nodescript")},_httpparser:function(){return y("httpparser")},_dataview:function(){return y("dataview")},_signal:function(){return y("signal")},_fsevent:function(){return y("fsevent")},_tlswrap:function(){return y("tlswrap")}}}function J(){return{buf:"",write:function(I){this.buf+=I},end:function(I){this.buf+=I},read:function(){return this.buf}}}o.writeToStream=function(I,g,f){return f===void 0&&(f=g,g={}),X(g=A(I,g),f).dispatch(I)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){(function(k){var q=typeof Uint8Array<"u"?Uint8Array:Array,T="+".charCodeAt(0),L="/".charCodeAt(0),A="0".charCodeAt(0),j="a".charCodeAt(0),X="A".charCodeAt(0),J="-".charCodeAt(0),I="_".charCodeAt(0);function g(f){return f=f.charCodeAt(0),f===T||f===J?62:f===L||f===I?63:f<A?-1:f<A+10?f-A+26+26:f<X+26?f-X:f<j+26?f-j+26:void 0}k.toByteArray=function(f){var y,d;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var O=f.length,O=f.charAt(O-2)==="="?2:f.charAt(O-1)==="="?1:0,N=new q(3*f.length/4-O),ue=0<O?f.length-4:f.length,se=0;function ce(te){N[se++]=te}for(y=0;y<ue;y+=4,0)ce((16711680&(d=g(f.charAt(y))<<18|g(f.charAt(y+1))<<12|g(f.charAt(y+2))<<6|g(f.charAt(y+3))))>>16),ce((65280&d)>>8),ce(255&d);return O==2?ce(255&(d=g(f.charAt(y))<<2|g(f.charAt(y+1))>>4)):O==1&&(ce((d=g(f.charAt(y))<<10|g(f.charAt(y+1))<<4|g(f.charAt(y+2))>>2)>>8&255),ce(255&d)),N},k.fromByteArray=function(f){var y,d,O,N,ue=f.length%3,se="";function ce(te){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(te)}for(y=0,O=f.length-ue;y<O;y+=3)d=(f[y]<<16)+(f[y+1]<<8)+f[y+2],se+=ce((N=d)>>18&63)+ce(N>>12&63)+ce(N>>6&63)+ce(63&N);switch(ue){case 1:se=(se+=ce((d=f[f.length-1])>>2))+ce(d<<4&63)+"==";break;case 2:se=(se=(se+=ce((d=(f[f.length-2]<<8)+f[f.length-1])>>10))+ce(d>>4&63))+ce(d<<2&63)+"="}return se}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,i,o){(function(r,u,T,E,b,P,D,V,Z){var k=t("base64-js"),q=t("ieee754");function T(l,h,m){if(!(this instanceof T))return new T(l,h,m);var M,F,W,ie,me=typeof l;if(h==="base64"&&me=="string")for(l=(ie=l).trim?ie.trim():ie.replace(/^\s+|\s+$/g,"");l.length%4!=0;)l+="=";if(me=="number")M=be(l);else if(me=="string")M=T.byteLength(l,h);else{if(me!="object")throw new Error("First argument needs to be a number, array or string.");M=be(l.length)}if(T._useTypedArrays?F=T._augment(new Uint8Array(M)):((F=this).length=M,F._isBuffer=!0),T._useTypedArrays&&typeof l.byteLength=="number")F._set(l);else if(ye(ie=l)||T.isBuffer(ie)||ie&&typeof ie=="object"&&typeof ie.length=="number")for(W=0;W<M;W++)T.isBuffer(l)?F[W]=l.readUInt8(W):F[W]=l[W];else if(me=="string")F.write(l,0,h);else if(me=="number"&&!T._useTypedArrays&&!m)for(W=0;W<M;W++)F[W]=0;return F}function L(l,h,m,M){return T._charsWritten=ke(function(F){for(var W=[],ie=0;ie<F.length;ie++)W.push(255&F.charCodeAt(ie));return W}(h),l,m,M)}function A(l,h,m,M){return T._charsWritten=ke(function(F){for(var W,ie,me=[],ae=0;ae<F.length;ae++)ie=F.charCodeAt(ae),W=ie>>8,ie=ie%256,me.push(ie),me.push(W);return me}(h),l,m,M)}function j(l,h,m){var M="";m=Math.min(l.length,m);for(var F=h;F<m;F++)M+=String.fromCharCode(l[F]);return M}function X(l,h,m,W){W||(C(typeof m=="boolean","missing or invalid endian"),C(h!=null,"missing offset"),C(h+1<l.length,"Trying to read beyond buffer length"));var F,W=l.length;if(!(W<=h))return m?(F=l[h],h+1<W&&(F|=l[h+1]<<8)):(F=l[h]<<8,h+1<W&&(F|=l[h+1])),F}function J(l,h,m,W){W||(C(typeof m=="boolean","missing or invalid endian"),C(h!=null,"missing offset"),C(h+3<l.length,"Trying to read beyond buffer length"));var F,W=l.length;if(!(W<=h))return m?(h+2<W&&(F=l[h+2]<<16),h+1<W&&(F|=l[h+1]<<8),F|=l[h],h+3<W&&(F+=l[h+3]<<24>>>0)):(h+1<W&&(F=l[h+1]<<16),h+2<W&&(F|=l[h+2]<<8),h+3<W&&(F|=l[h+3]),F+=l[h]<<24>>>0),F}function I(l,h,m,M){if(M||(C(typeof m=="boolean","missing or invalid endian"),C(h!=null,"missing offset"),C(h+1<l.length,"Trying to read beyond buffer length")),!(l.length<=h))return M=X(l,h,m,!0),32768&M?-1*(65535-M+1):M}function g(l,h,m,M){if(M||(C(typeof m=="boolean","missing or invalid endian"),C(h!=null,"missing offset"),C(h+3<l.length,"Trying to read beyond buffer length")),!(l.length<=h))return M=J(l,h,m,!0),2147483648&M?-1*(4294967295-M+1):M}function f(l,h,m,M){return M||(C(typeof m=="boolean","missing or invalid endian"),C(h+3<l.length,"Trying to read beyond buffer length")),q.read(l,h,m,23,4)}function y(l,h,m,M){return M||(C(typeof m=="boolean","missing or invalid endian"),C(h+7<l.length,"Trying to read beyond buffer length")),q.read(l,h,m,52,8)}function d(l,h,m,M,F){if(F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+1<l.length,"trying to write beyond buffer length"),et(h,65535)),F=l.length,!(F<=m))for(var W=0,ie=Math.min(F-m,2);W<ie;W++)l[m+W]=(h&255<<8*(M?W:1-W))>>>8*(M?W:1-W)}function O(l,h,m,M,F){if(F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+3<l.length,"trying to write beyond buffer length"),et(h,4294967295)),F=l.length,!(F<=m))for(var W=0,ie=Math.min(F-m,4);W<ie;W++)l[m+W]=h>>>8*(M?W:3-W)&255}function N(l,h,m,M,F){F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+1<l.length,"Trying to write beyond buffer length"),nt(h,32767,-32768)),l.length<=m||d(l,0<=h?h:65535+h+1,m,M,F)}function ue(l,h,m,M,F){F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+3<l.length,"Trying to write beyond buffer length"),nt(h,2147483647,-2147483648)),l.length<=m||O(l,0<=h?h:4294967295+h+1,m,M,F)}function se(l,h,m,M,F){F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+3<l.length,"Trying to write beyond buffer length"),Y(h,34028234663852886e22,-34028234663852886e22)),l.length<=m||q.write(l,h,m,M,23,4)}function ce(l,h,m,M,F){F||(C(h!=null,"missing value"),C(typeof M=="boolean","missing or invalid endian"),C(m!=null,"missing offset"),C(m+7<l.length,"Trying to write beyond buffer length"),Y(h,17976931348623157e292,-17976931348623157e292)),l.length<=m||q.write(l,h,m,M,52,8)}o.Buffer=T,o.SlowBuffer=T,o.INSPECT_MAX_BYTES=50,T.poolSize=8192,T._useTypedArrays=function(){try{var l=new ArrayBuffer(0),h=new Uint8Array(l);return h.foo=function(){return 42},h.foo()===42&&typeof h.subarray=="function"}catch{return!1}}(),T.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},T.isBuffer=function(l){return!(l==null||!l._isBuffer)},T.byteLength=function(l,h){var m;switch(l+="",h||"utf8"){case"hex":m=l.length/2;break;case"utf8":case"utf-8":m=De(l).length;break;case"ascii":case"binary":case"raw":m=l.length;break;case"base64":m=qe(l).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=2*l.length;break;default:throw new Error("Unknown encoding")}return m},T.concat=function(l,h){if(C(ye(l),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),l.length===0)return new T(0);if(l.length===1)return l[0];if(typeof h!="number")for(F=h=0;F<l.length;F++)h+=l[F].length;for(var m=new T(h),M=0,F=0;F<l.length;F++){var W=l[F];W.copy(m,M),M+=W.length}return m},T.prototype.write=function(l,h,m,M){isFinite(h)?isFinite(m)||(M=m,m=void 0):(ae=M,M=h,h=m,m=ae),h=Number(h)||0;var F,W,ie,me,ae=this.length-h;switch((!m||ae<(m=Number(m)))&&(m=ae),M=String(M||"utf8").toLowerCase()){case"hex":F=function(Se,Ae,Ce,Oe){Ce=Number(Ce)||0;var fe=Se.length-Ce;(!Oe||fe<(Oe=Number(Oe)))&&(Oe=fe),C((fe=Ae.length)%2==0,"Invalid hex string"),fe/2<Oe&&(Oe=fe/2);for(var pe=0;pe<Oe;pe++){var $e=parseInt(Ae.substr(2*pe,2),16);C(!isNaN($e),"Invalid hex string"),Se[Ce+pe]=$e}return T._charsWritten=2*pe,pe}(this,l,h,m);break;case"utf8":case"utf-8":W=this,ie=h,me=m,F=T._charsWritten=ke(De(l),W,ie,me);break;case"ascii":case"binary":F=L(this,l,h,m);break;case"base64":W=this,ie=h,me=m,F=T._charsWritten=ke(qe(l),W,ie,me);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":F=A(this,l,h,m);break;default:throw new Error("Unknown encoding")}return F},T.prototype.toString=function(l,h,m){var M,F,W,ie,me=this;if(l=String(l||"utf8").toLowerCase(),h=Number(h)||0,(m=m!==void 0?Number(m):me.length)===h)return"";switch(l){case"hex":M=function(ae,Se,Ae){var Ce=ae.length;(!Se||Se<0)&&(Se=0),(!Ae||Ae<0||Ce<Ae)&&(Ae=Ce);for(var Oe="",fe=Se;fe<Ae;fe++)Oe+=oe(ae[fe]);return Oe}(me,h,m);break;case"utf8":case"utf-8":M=function(ae,Se,Ae){var Ce="",Oe="";Ae=Math.min(ae.length,Ae);for(var fe=Se;fe<Ae;fe++)ae[fe]<=127?(Ce+=Be(Oe)+String.fromCharCode(ae[fe]),Oe=""):Oe+="%"+ae[fe].toString(16);return Ce+Be(Oe)}(me,h,m);break;case"ascii":case"binary":M=j(me,h,m);break;case"base64":F=me,ie=m,M=(W=h)===0&&ie===F.length?k.fromByteArray(F):k.fromByteArray(F.slice(W,ie));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=function(ae,Se,Ae){for(var Ce=ae.slice(Se,Ae),Oe="",fe=0;fe<Ce.length;fe+=2)Oe+=String.fromCharCode(Ce[fe]+256*Ce[fe+1]);return Oe}(me,h,m);break;default:throw new Error("Unknown encoding")}return M},T.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},T.prototype.copy=function(l,h,m,M){if(h=h||0,(M=M||M===0?M:this.length)!==(m=m||0)&&l.length!==0&&this.length!==0){C(m<=M,"sourceEnd < sourceStart"),C(0<=h&&h<l.length,"targetStart out of bounds"),C(0<=m&&m<this.length,"sourceStart out of bounds"),C(0<=M&&M<=this.length,"sourceEnd out of bounds"),M>this.length&&(M=this.length);var F=(M=l.length-h<M-m?l.length-h+m:M)-m;if(F<100||!T._useTypedArrays)for(var W=0;W<F;W++)l[W+h]=this[W+m];else l._set(this.subarray(m,m+F),h)}},T.prototype.slice=function(l,h){var m=this.length;if(l=we(l,m,0),h=we(h,m,m),T._useTypedArrays)return T._augment(this.subarray(l,h));for(var M=h-l,F=new T(M,void 0,!0),W=0;W<M;W++)F[W]=this[W+l];return F},T.prototype.get=function(l){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(l)},T.prototype.set=function(l,h){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(l,h)},T.prototype.readUInt8=function(l,h){if(h||(C(l!=null,"missing offset"),C(l<this.length,"Trying to read beyond buffer length")),!(l>=this.length))return this[l]},T.prototype.readUInt16LE=function(l,h){return X(this,l,!0,h)},T.prototype.readUInt16BE=function(l,h){return X(this,l,!1,h)},T.prototype.readUInt32LE=function(l,h){return J(this,l,!0,h)},T.prototype.readUInt32BE=function(l,h){return J(this,l,!1,h)},T.prototype.readInt8=function(l,h){if(h||(C(l!=null,"missing offset"),C(l<this.length,"Trying to read beyond buffer length")),!(l>=this.length))return 128&this[l]?-1*(255-this[l]+1):this[l]},T.prototype.readInt16LE=function(l,h){return I(this,l,!0,h)},T.prototype.readInt16BE=function(l,h){return I(this,l,!1,h)},T.prototype.readInt32LE=function(l,h){return g(this,l,!0,h)},T.prototype.readInt32BE=function(l,h){return g(this,l,!1,h)},T.prototype.readFloatLE=function(l,h){return f(this,l,!0,h)},T.prototype.readFloatBE=function(l,h){return f(this,l,!1,h)},T.prototype.readDoubleLE=function(l,h){return y(this,l,!0,h)},T.prototype.readDoubleBE=function(l,h){return y(this,l,!1,h)},T.prototype.writeUInt8=function(l,h,m){m||(C(l!=null,"missing value"),C(h!=null,"missing offset"),C(h<this.length,"trying to write beyond buffer length"),et(l,255)),h>=this.length||(this[h]=l)},T.prototype.writeUInt16LE=function(l,h,m){d(this,l,h,!0,m)},T.prototype.writeUInt16BE=function(l,h,m){d(this,l,h,!1,m)},T.prototype.writeUInt32LE=function(l,h,m){O(this,l,h,!0,m)},T.prototype.writeUInt32BE=function(l,h,m){O(this,l,h,!1,m)},T.prototype.writeInt8=function(l,h,m){m||(C(l!=null,"missing value"),C(h!=null,"missing offset"),C(h<this.length,"Trying to write beyond buffer length"),nt(l,127,-128)),h>=this.length||(0<=l?this.writeUInt8(l,h,m):this.writeUInt8(255+l+1,h,m))},T.prototype.writeInt16LE=function(l,h,m){N(this,l,h,!0,m)},T.prototype.writeInt16BE=function(l,h,m){N(this,l,h,!1,m)},T.prototype.writeInt32LE=function(l,h,m){ue(this,l,h,!0,m)},T.prototype.writeInt32BE=function(l,h,m){ue(this,l,h,!1,m)},T.prototype.writeFloatLE=function(l,h,m){se(this,l,h,!0,m)},T.prototype.writeFloatBE=function(l,h,m){se(this,l,h,!1,m)},T.prototype.writeDoubleLE=function(l,h,m){ce(this,l,h,!0,m)},T.prototype.writeDoubleBE=function(l,h,m){ce(this,l,h,!1,m)},T.prototype.fill=function(l,h,m){if(h=h||0,m=m||this.length,C(typeof(l=typeof(l=l||0)=="string"?l.charCodeAt(0):l)=="number"&&!isNaN(l),"value is not a number"),C(h<=m,"end < start"),m!==h&&this.length!==0){C(0<=h&&h<this.length,"start out of bounds"),C(0<=m&&m<=this.length,"end out of bounds");for(var M=h;M<m;M++)this[M]=l}},T.prototype.inspect=function(){for(var l=[],h=this.length,m=0;m<h;m++)if(l[m]=oe(this[m]),m===o.INSPECT_MAX_BYTES){l[m+1]="...";break}return"<Buffer "+l.join(" ")+">"},T.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(T._useTypedArrays)return new T(this).buffer;for(var l=new Uint8Array(this.length),h=0,m=l.length;h<m;h+=1)l[h]=this[h];return l.buffer};var te=T.prototype;function we(l,h,m){return typeof l!="number"?m:h<=(l=~~l)?h:0<=l||0<=(l+=h)?l:0}function be(l){return(l=~~Math.ceil(+l))<0?0:l}function ye(l){return(Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"})(l)}function oe(l){return l<16?"0"+l.toString(16):l.toString(16)}function De(l){for(var h=[],m=0;m<l.length;m++){var M=l.charCodeAt(m);if(M<=127)h.push(l.charCodeAt(m));else for(var F=m,W=(55296<=M&&M<=57343&&m++,encodeURIComponent(l.slice(F,m+1)).substr(1).split("%")),ie=0;ie<W.length;ie++)h.push(parseInt(W[ie],16))}return h}function qe(l){return k.toByteArray(l)}function ke(l,h,m,M){for(var F=0;F<M&&!(F+m>=h.length||F>=l.length);F++)h[F+m]=l[F];return F}function Be(l){try{return decodeURIComponent(l)}catch{return String.fromCharCode(65533)}}function et(l,h){C(typeof l=="number","cannot write a non-number as a number"),C(0<=l,"specified a negative value for writing an unsigned value"),C(l<=h,"value is larger than maximum value for type"),C(Math.floor(l)===l,"value has a fractional component")}function nt(l,h,m){C(typeof l=="number","cannot write a non-number as a number"),C(l<=h,"value larger than maximum allowed value"),C(m<=l,"value smaller than minimum allowed value"),C(Math.floor(l)===l,"value has a fractional component")}function Y(l,h,m){C(typeof l=="number","cannot write a non-number as a number"),C(l<=h,"value larger than maximum allowed value"),C(m<=l,"value smaller than minimum allowed value")}function C(l,h){if(!l)throw new Error(h||"Failed assertion")}T._augment=function(l){return l._isBuffer=!0,l._get=l.get,l._set=l.set,l.get=te.get,l.set=te.set,l.write=te.write,l.toString=te.toString,l.toLocaleString=te.toString,l.toJSON=te.toJSON,l.copy=te.copy,l.slice=te.slice,l.readUInt8=te.readUInt8,l.readUInt16LE=te.readUInt16LE,l.readUInt16BE=te.readUInt16BE,l.readUInt32LE=te.readUInt32LE,l.readUInt32BE=te.readUInt32BE,l.readInt8=te.readInt8,l.readInt16LE=te.readInt16LE,l.readInt16BE=te.readInt16BE,l.readInt32LE=te.readInt32LE,l.readInt32BE=te.readInt32BE,l.readFloatLE=te.readFloatLE,l.readFloatBE=te.readFloatBE,l.readDoubleLE=te.readDoubleLE,l.readDoubleBE=te.readDoubleBE,l.writeUInt8=te.writeUInt8,l.writeUInt16LE=te.writeUInt16LE,l.writeUInt16BE=te.writeUInt16BE,l.writeUInt32LE=te.writeUInt32LE,l.writeUInt32BE=te.writeUInt32BE,l.writeInt8=te.writeInt8,l.writeInt16LE=te.writeInt16LE,l.writeInt16BE=te.writeInt16BE,l.writeInt32LE=te.writeInt32LE,l.writeInt32BE=te.writeInt32BE,l.writeFloatLE=te.writeFloatLE,l.writeFloatBE=te.writeFloatBE,l.writeDoubleLE=te.writeDoubleLE,l.writeDoubleBE=te.writeDoubleBE,l.fill=te.fill,l.inspect=te.inspect,l.toArrayBuffer=te.toArrayBuffer,l}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,i,o){(function(r,u,k,E,b,P,D,V,Z){var k=t("buffer").Buffer,q=4,T=new k(q);T.fill(0),i.exports={hash:function(L,A,j,X){for(var J=A(function(d,O){d.length%q!=0&&(N=d.length+(q-d.length%q),d=k.concat([d,T],N));for(var N,ue=[],se=O?d.readInt32BE:d.readInt32LE,ce=0;ce<d.length;ce+=q)ue.push(se.call(d,ce));return ue}(L=k.isBuffer(L)?L:new k(L),X),8*L.length),A=X,I=new k(j),g=A?I.writeInt32BE:I.writeInt32LE,f=0;f<J.length;f++)g.call(I,J[f],4*f,!0);return I}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,i,o){(function(r,u,k,E,b,P,D,V,Z){var k=t("buffer").Buffer,q=t("./sha"),T=t("./sha256"),L=t("./rng"),A={sha1:q,sha256:T,md5:t("./md5")},j=64,X=new k(j);function J(d,O){var N=A[d=d||"sha1"],ue=[];return N||I("algorithm:",d,"is not yet supported"),{update:function(se){return k.isBuffer(se)||(se=new k(se)),ue.push(se),se.length,this},digest:function(se){var ce=k.concat(ue),ce=O?function(te,we,be){k.isBuffer(we)||(we=new k(we)),k.isBuffer(be)||(be=new k(be)),we.length>j?we=te(we):we.length<j&&(we=k.concat([we,X],j));for(var ye=new k(j),oe=new k(j),De=0;De<j;De++)ye[De]=54^we[De],oe[De]=92^we[De];return be=te(k.concat([ye,be])),te(k.concat([oe,be]))}(N,O,ce):N(ce);return ue=null,se?ce.toString(se):ce}}}function I(){var d=[].slice.call(arguments).join(" ");throw new Error([d,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}X.fill(0),o.createHash=function(d){return J(d)},o.createHmac=J,o.randomBytes=function(d,O){if(!O||!O.call)return new k(L(d));try{O.call(this,void 0,new k(L(d)))}catch(N){O(N)}};var g,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],y=function(d){o[d]=function(){I("sorry,",d,"is not implemented yet")}};for(g in f)y(f[g])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){var k=t("./helpers");function q(I,g){I[g>>5]|=128<<g%32,I[14+(g+64>>>9<<4)]=g;for(var f=1732584193,y=-271733879,d=-1732584194,O=271733878,N=0;N<I.length;N+=16){var ue=f,se=y,ce=d,te=O,f=L(f,y,d,O,I[N+0],7,-680876936),O=L(O,f,y,d,I[N+1],12,-389564586),d=L(d,O,f,y,I[N+2],17,606105819),y=L(y,d,O,f,I[N+3],22,-1044525330);f=L(f,y,d,O,I[N+4],7,-176418897),O=L(O,f,y,d,I[N+5],12,1200080426),d=L(d,O,f,y,I[N+6],17,-1473231341),y=L(y,d,O,f,I[N+7],22,-45705983),f=L(f,y,d,O,I[N+8],7,1770035416),O=L(O,f,y,d,I[N+9],12,-1958414417),d=L(d,O,f,y,I[N+10],17,-42063),y=L(y,d,O,f,I[N+11],22,-1990404162),f=L(f,y,d,O,I[N+12],7,1804603682),O=L(O,f,y,d,I[N+13],12,-40341101),d=L(d,O,f,y,I[N+14],17,-1502002290),f=A(f,y=L(y,d,O,f,I[N+15],22,1236535329),d,O,I[N+1],5,-165796510),O=A(O,f,y,d,I[N+6],9,-1069501632),d=A(d,O,f,y,I[N+11],14,643717713),y=A(y,d,O,f,I[N+0],20,-373897302),f=A(f,y,d,O,I[N+5],5,-701558691),O=A(O,f,y,d,I[N+10],9,38016083),d=A(d,O,f,y,I[N+15],14,-660478335),y=A(y,d,O,f,I[N+4],20,-405537848),f=A(f,y,d,O,I[N+9],5,568446438),O=A(O,f,y,d,I[N+14],9,-1019803690),d=A(d,O,f,y,I[N+3],14,-187363961),y=A(y,d,O,f,I[N+8],20,1163531501),f=A(f,y,d,O,I[N+13],5,-1444681467),O=A(O,f,y,d,I[N+2],9,-51403784),d=A(d,O,f,y,I[N+7],14,1735328473),f=j(f,y=A(y,d,O,f,I[N+12],20,-1926607734),d,O,I[N+5],4,-378558),O=j(O,f,y,d,I[N+8],11,-2022574463),d=j(d,O,f,y,I[N+11],16,1839030562),y=j(y,d,O,f,I[N+14],23,-35309556),f=j(f,y,d,O,I[N+1],4,-1530992060),O=j(O,f,y,d,I[N+4],11,1272893353),d=j(d,O,f,y,I[N+7],16,-155497632),y=j(y,d,O,f,I[N+10],23,-1094730640),f=j(f,y,d,O,I[N+13],4,681279174),O=j(O,f,y,d,I[N+0],11,-358537222),d=j(d,O,f,y,I[N+3],16,-722521979),y=j(y,d,O,f,I[N+6],23,76029189),f=j(f,y,d,O,I[N+9],4,-640364487),O=j(O,f,y,d,I[N+12],11,-421815835),d=j(d,O,f,y,I[N+15],16,530742520),f=X(f,y=j(y,d,O,f,I[N+2],23,-995338651),d,O,I[N+0],6,-198630844),O=X(O,f,y,d,I[N+7],10,1126891415),d=X(d,O,f,y,I[N+14],15,-1416354905),y=X(y,d,O,f,I[N+5],21,-57434055),f=X(f,y,d,O,I[N+12],6,1700485571),O=X(O,f,y,d,I[N+3],10,-1894986606),d=X(d,O,f,y,I[N+10],15,-1051523),y=X(y,d,O,f,I[N+1],21,-2054922799),f=X(f,y,d,O,I[N+8],6,1873313359),O=X(O,f,y,d,I[N+15],10,-30611744),d=X(d,O,f,y,I[N+6],15,-1560198380),y=X(y,d,O,f,I[N+13],21,1309151649),f=X(f,y,d,O,I[N+4],6,-145523070),O=X(O,f,y,d,I[N+11],10,-1120210379),d=X(d,O,f,y,I[N+2],15,718787259),y=X(y,d,O,f,I[N+9],21,-343485551),f=J(f,ue),y=J(y,se),d=J(d,ce),O=J(O,te)}return Array(f,y,d,O)}function T(I,g,f,y,d,O){return J((g=J(J(g,I),J(y,O)))<<d|g>>>32-d,f)}function L(I,g,f,y,d,O,N){return T(g&f|~g&y,I,g,d,O,N)}function A(I,g,f,y,d,O,N){return T(g&y|f&~y,I,g,d,O,N)}function j(I,g,f,y,d,O,N){return T(g^f^y,I,g,d,O,N)}function X(I,g,f,y,d,O,N){return T(f^(g|~y),I,g,d,O,N)}function J(I,g){var f=(65535&I)+(65535&g);return(I>>16)+(g>>16)+(f>>16)<<16|65535&f}i.exports=function(I){return k.hash(I,q,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){i.exports=function(k){for(var q,T=new Array(k),L=0;L<k;L++)!(3&L)&&(q=4294967296*Math.random()),T[L]=q>>>((3&L)<<3)&255;return T}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){var k=t("./helpers");function q(A,j){A[j>>5]|=128<<24-j%32,A[15+(j+64>>9<<4)]=j;for(var X,J,I,g=Array(80),f=1732584193,y=-271733879,d=-1732584194,O=271733878,N=-1009589776,ue=0;ue<A.length;ue+=16){for(var se=f,ce=y,te=d,we=O,be=N,ye=0;ye<80;ye++){g[ye]=ye<16?A[ue+ye]:L(g[ye-3]^g[ye-8]^g[ye-14]^g[ye-16],1);var oe=T(T(L(f,5),(oe=y,J=d,I=O,(X=ye)<20?oe&J|~oe&I:!(X<40)&&X<60?oe&J|oe&I|J&I:oe^J^I)),T(T(N,g[ye]),(X=ye)<20?1518500249:X<40?1859775393:X<60?-1894007588:-899497514)),N=O,O=d,d=L(y,30),y=f,f=oe}f=T(f,se),y=T(y,ce),d=T(d,te),O=T(O,we),N=T(N,be)}return Array(f,y,d,O,N)}function T(A,j){var X=(65535&A)+(65535&j);return(A>>16)+(j>>16)+(X>>16)<<16|65535&X}function L(A,j){return A<<j|A>>>32-j}i.exports=function(A){return k.hash(A,q,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){function k(j,X){var J=(65535&j)+(65535&X);return(j>>16)+(X>>16)+(J>>16)<<16|65535&J}function q(j,X){var J,I=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),g=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);j[X>>5]|=128<<24-X%32,j[15+(X+64>>9<<4)]=X;for(var y,d,O=0;O<j.length;O+=16){for(var N=g[0],ue=g[1],se=g[2],ce=g[3],te=g[4],we=g[5],be=g[6],ye=g[7],oe=0;oe<64;oe++)f[oe]=oe<16?j[oe+O]:k(k(k((d=f[oe-2],L(d,17)^L(d,19)^A(d,10)),f[oe-7]),(d=f[oe-15],L(d,7)^L(d,18)^A(d,3))),f[oe-16]),J=k(k(k(k(ye,L(d=te,6)^L(d,11)^L(d,25)),te&we^~te&be),I[oe]),f[oe]),y=k(L(y=N,2)^L(y,13)^L(y,22),N&ue^N&se^ue&se),ye=be,be=we,we=te,te=k(ce,J),ce=se,se=ue,ue=N,N=k(J,y);g[0]=k(N,g[0]),g[1]=k(ue,g[1]),g[2]=k(se,g[2]),g[3]=k(ce,g[3]),g[4]=k(te,g[4]),g[5]=k(we,g[5]),g[6]=k(be,g[6]),g[7]=k(ye,g[7])}return g}var T=t("./helpers"),L=function(j,X){return j>>>X|j<<32-X},A=function(j,X){return j>>>X};i.exports=function(j){return T.hash(j,q,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){o.read=function(k,q,T,L,O){var j,X,J=8*O-L-1,I=(1<<J)-1,g=I>>1,f=-7,y=T?O-1:0,d=T?-1:1,O=k[q+y];for(y+=d,j=O&(1<<-f)-1,O>>=-f,f+=J;0<f;j=256*j+k[q+y],y+=d,f-=8);for(X=j&(1<<-f)-1,j>>=-f,f+=L;0<f;X=256*X+k[q+y],y+=d,f-=8);if(j===0)j=1-g;else{if(j===I)return X?NaN:1/0*(O?-1:1);X+=Math.pow(2,L),j-=g}return(O?-1:1)*X*Math.pow(2,j-L)},o.write=function(k,q,T,L,A,N){var X,J,I=8*N-A-1,g=(1<<I)-1,f=g>>1,y=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=L?0:N-1,O=L?1:-1,N=q<0||q===0&&1/q<0?1:0;for(q=Math.abs(q),isNaN(q)||q===1/0?(J=isNaN(q)?1:0,X=g):(X=Math.floor(Math.log(q)/Math.LN2),q*(L=Math.pow(2,-X))<1&&(X--,L*=2),2<=(q+=1<=X+f?y/L:y*Math.pow(2,1-f))*L&&(X++,L/=2),g<=X+f?(J=0,X=g):1<=X+f?(J=(q*L-1)*Math.pow(2,A),X+=f):(J=q*Math.pow(2,f-1)*Math.pow(2,A),X=0));8<=A;k[T+d]=255&J,d+=O,J/=256,A-=8);for(X=X<<A|J,I+=A;0<I;k[T+d]=255&X,d+=O,X/=256,I-=8);k[T+d-O]|=128*N}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,i,o){(function(r,u,v,E,b,P,D,V,Z){var k,q,T;function L(){}(r=i.exports={}).nextTick=(q=typeof window<"u"&&window.setImmediate,T=typeof window<"u"&&window.postMessage&&window.addEventListener,q?function(A){return window.setImmediate(A)}:T?(k=[],window.addEventListener("message",function(A){var j=A.source;j!==window&&j!==null||A.data!=="process-tick"||(A.stopPropagation(),0<k.length&&k.shift()())},!0),function(A){k.push(A),window.postMessage("process-tick","*")}):function(A){setTimeout(A,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=L,r.addListener=L,r.once=L,r.off=L,r.removeListener=L,r.removeAllListeners=L,r.emit=L,r.binding=function(A){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(A){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Fi);var Dr=Fi.exports;const Lt=Ti(Dr);class Pr{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Lt(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Lt(e):String(e)]}getValue(e){return this.cache[this.useHash?Lt(e):String(e)]}isCached(e){return(this.useHash?Lt(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,i])=>e(t,i)),this.cache={}}}function $t(n,e){return(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)}function oi(n,e){return n.x==e.x&&n.y==e.y}function Ft(n,e,t){return t===void 0&&(t=.01),Math.abs(n-e)<=t}function _n(n,e){return(n%e+e)%e}async function Lr(){await H.contextMenu.create({id:`${S.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${S.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${S.EXTENSIONID}/hasVision`]===void 0);await H.scene.items.updateItems(n.items,t=>{for(const i of t)e?(i.metadata[`${S.EXTENSIONID}/hasVision`]=!0,i.metadata[`${S.EXTENSIONID}/visionRange`]===void 0&&(i.metadata[`${S.EXTENSIONID}/visionRange`]=S.VISIONDEFAULT)):delete i.metadata[`${S.EXTENSIONID}/hasVision`]})}}),await H.contextMenu.create({id:`${S.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${S.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(n){if(n.items.length>0){const e=n.items.map(i=>i.id),t=await H.scene.items.getItemAttachments(e);await H.scene.items.updateItems(t,i=>{for(const o of i)e.includes(o.attachedTo)&&(o.metadata[`${S.EXTENSIONID}/hasVision`]&&o.layer=="CHARACTER"?delete o.metadata[`${S.EXTENSIONID}/hasVision`]:o.layer=="CHARACTER"&&(o.metadata[`${S.EXTENSIONID}/hasVision`]=!0,o.metadata[`${S.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${S.EXTENSIONID}/visionRange`]=S.VISIONDEFAULT)))})}}}),await H.contextMenu.create({id:`${S.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${S.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${S.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${S.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${S.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(n){await H.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${S.EXTENSIONID}/isVisionLine`]&&t.metadata[`${S.EXTENSIONID}/disabled`]?delete t.metadata[`${S.EXTENSIONID}/disabled`]:t.metadata[`${S.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${S.EXTENSIONID}/disabled`]=!0)})}}),await H.contextMenu.create({id:`${S.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${S.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${S.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${S.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${S.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${S.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${S.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${S.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(n){await H.scene.items.updateItems(n.items,e=>{for(const t of e)(t.metadata[`${S.EXTENSIONID}/isVisionLine`]||t.metadata[`${S.ARMINDOID}/isVisionLine`])&&(t.metadata[`${S.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${S.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${S.EXTENSIONID}/oneSided`],delete t.metadata[`${S.ARMINDOID}/oneSided`]):(t.metadata[`${S.EXTENSIONID}/isVisionLine`]||t.metadata[`${S.ARMINDOID}/isVisionLine`])&&(t.metadata[`${S.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${S.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${S.EXTENSIONID}/oneSided`]="right",t.metadata[`${S.ARMINDOID}/oneSided`]="right"):(t.metadata[`${S.EXTENSIONID}/isVisionLine`]||t.metadata[`${S.ARMINDOID}/isVisionLine`])&&(t.metadata[`${S.EXTENSIONID}/oneSided`]="left",t.metadata[`${S.ARMINDOID}/oneSided`]="left")})}})}async function $r(){await H.tool.create({id:`${S.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await H.tool.activateTool(`${S.EXTENSIONID}/vision-tool`)}})}async function Fr(){await H.tool.createMode({id:`${S.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${S.EXTENSIONID}/vision-tool`]}}],onToolClick:In.onToolClick,onToolMove:In.onToolMove,onKeyDown:In.onKeyDown}),await H.tool.createMode({id:`${S.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${S.EXTENSIONID}/vision-tool`]}}],onToolClick:En.onToolClick,onToolMove:En.onToolMove,onKeyDown:En.onKeyDown})}function Rr(n){for(const[e,t]of Object.entries(n)){const i=document.getElementById(e);e=="compute_time"||e=="communication_time"?i&&(i.innerText=Number.parseFloat(t).toFixed(1)+"ms"):i&&(i.innerText=t)}}var ze,ut=!1;const ht=new Pr(!1);async function Br(n){if(ut=!0,ze||(ze=await Sr({locateFile:()=>Or})),!await H.scene.isReady()){ht.invalidate((Y,C)=>C.shadowPath.delete()),ut=!1;return}const{awaitTimer:e,computeTimer:t,metadata:i,visionShapes:o,tokensWithVision:r,invalidateCache:u}=n.detail;let v=n.detail.size,E=n.detail.offset,b=n.detail.scale,[P,D]=v;if(U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]===!0){const Y=await H.scene.items.getItems(l=>l.layer==="MAP");let C=[];for(let l of Y){let h=U.gridDpi/l.grid.dpi,m=l.position.x-h*l.grid.offset.x,M=l.position.y-h*l.grid.offset.y,F=(m+h*l.image.width)*l.scale.x,W=(M+h*l.image.height)*l.scale.y;C.length?(m<C[0]&&(C[0]=m),M<C[1]&&(C[1]=M),F>C[2]&&(C[2]=F),W>C[3]&&(C[3]=W)):(C[0]=m,C[1]=M,C[2]=F,C[3]=W)}E=[C[0],C[1]],v=[C[2]-C[0],C[3]-C[1]],b=[1,1],[P,D]=v}let Z=0,k=0;if(u&&ht.invalidate((Y,C)=>C.shadowPath.delete()),t.resume(),!(i[`${S.EXTENSIONID}/visionEnabled`]===!0)||r.length==0){const Y=await H.scene.items.getItems(Vt);await H.scene.local.deleteItems(Y.map(C=>C.id)),ut=!1;return}const T=[];for(const Y of o)for(let C=0;C<Y.points.length-1;C++)T.push({startPosition:{x:Y.points[C].x*Y.scale.x+Y.position.x,y:Y.points[C].y*Y.scale.y+Y.position.y},endPosition:{x:Y.points[C+1].x*Y.scale.x+Y.position.x,y:Y.points[C+1].y*Y.scale.y+Y.position.y},originalShape:Y,oneSided:Y.metadata[`${S.EXTENSIONID}/oneSided`]});const L=[],A=[],j=U.players.filter(Y=>Y.role=="GM");let X=0,J=0;for(const Y of r){const C=U.userId===Y.createdUserId,l=j.some(m=>m.id==Y.createdUserId);if(!C&&U.role!=="GM"&&!l)continue;const h=ht.getValue(Y.id);if(L.push([]),!(h!==void 0&&oi(h.player.position,Y.position)))for(const m of T){const M=(Y.position.x-m.startPosition.x)*(m.endPosition.y-m.startPosition.y)-(Y.position.y-m.startPosition.y)*(m.endPosition.x-m.startPosition.x);if(m.oneSided!==void 0&&(m.oneSided=="right"&&M>0||m.oneSided=="left"&&M<0))continue;let F=m.startPosition.x,W=m.startPosition.y,ie=m.endPosition.x,me=m.endPosition.y;if(F<E[0]||W<E[1]||F>E[0]+v[0]||W>E[1]+v[1]||ie<E[0]||me<E[1]||ie>E[0]+v[0]||me>E[1]+v[1]){J++;continue}X++;const ae={x:m.startPosition.x-Y.position.x,y:m.startPosition.y-Y.position.y},Se={x:m.endPosition.x-Y.position.x,y:m.endPosition.y-Y.position.y};var I={x:0,y:0},g={x:0,y:0},f=0,y=0,d=0,O=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ae.x<0?f=E[0]*b[0]:f=(P+E[0])*b[0],ae.y<0?y=E[1]*b[1]:y=(D+E[1])*b[1],Se.x<0?d=E[0]*b[0]:d=(P+E[0])*b[0],Se.y<0?O=E[1]*b[1]:O=(D+E[1])*b[1];const Ae=[],Ce=[];if(ae.x!=0){const w=ae.y/ae.x,R=m.startPosition.y-w*m.startPosition.x;Ae.push({x:f,y:w*f+R})}if(ae.y!=0){const w=ae.x/ae.y,R=w*m.startPosition.y-m.startPosition.x;Ae.push({x:w*y-R,y})}if(Se.x!=0){const w=Se.y/Se.x,R=m.endPosition.y-w*m.endPosition.x;Ce.push({x:d,y:w*d+R})}if(Se.y!=0){const w=Se.x/Se.y,R=w*m.endPosition.y-m.endPosition.x;Ce.push({x:w*O-R,y:O})}Ae.length==1||$t(Ae[0],m.startPosition)<$t(Ae[1],m.startPosition)?I=Ae[0]:I=Ae[1],Ce.length==1||$t(Ce[0],m.endPosition)<$t(Ce[1],m.endPosition)?g=Ce[0]:g=Ce[1];const Oe=[{x:m.startPosition.x,y:m.startPosition.y},I,g,{x:m.endPosition.x,y:m.endPosition.y}],fe=[{x:(P+E[0])*b[0],y:E[1]*b[1]},{x:(P+E[0])*b[0],y:(D+E[1])*b[1]},{x:E[0]*b[0],y:(D+E[1])*b[1]},{x:E[0]*b[0],y:E[1]*b[1]}],pe=[0,0];let $e=0;for(const w of[I,g])Ft(w.y,E[1]*b[1])?pe[$e]=0:Ft(w.y,(D+E[1])*b[1])?pe[$e]=2:Ft(w.x,E[0]*b[0])?pe[$e]=3:Ft(w.x,(P+E[0])*b[0])&&(pe[$e]=1),$e++;let Ve=Math.sign(M);Ve=Ve==0?1:-Ve;const Ke=Ve==1?pe[1]:_n(pe[1]-1,4);for(let w=pe[0]+(Ve==1?0:-1);_n(w,4)!=Ke;w+=Ve)Oe.splice(Oe.length-2,0,fe[_n(w,4)]);L[L.length-1].push({pointset:Oe,fromShape:m.originalShape})}}if(L.length==0){ut=!1;return}const N={};for(let Y=0;Y<L.length;Y++){const C=r[Y];let l=ht.getValue(C.id);if(l!==void 0&&oi(l.player.position,C.position)){N[Y]=l.shadowPath.copy(),Z++;continue}k++;const h=L[Y],m=new ze.SkOpBuilder,M=ze.NewPath().rect(E[0],E[1],v[0],v[1]);m.add(M,ze.PathOp.UNION),M.delete();for(const W of h){const ie=W.fromShape,me=ze.NewPath();me.moveTo(W.pointset[0].x,W.pointset[0].y);for(let ae=1;ae<W.pointset.length;ae++)me.lineTo(W.pointset[ae].x,W.pointset[ae].y);if(ie.style.closed!=!1){const ae=ze.NewPath();ae.moveTo(ie.points[0].x*ie.scale.x+ie.position.x,ie.points[0].y*ie.scale.y+ie.position.y);for(let Se=1;Se<ie.points.length-1;Se++)ae.lineTo(ie.points[Se].x*ie.scale.x+ie.position.x,ie.points[Se].y*ie.scale.y+ie.position.y);me.op(ae,ze.PathOp.DIFFERENCE),ae.delete()}m.add(me,ze.PathOp.DIFFERENCE),me.delete()}const F=m.resolve();if(!F){console.error("Couldn't compute fog"),ut=!1;return}if(m.delete(),F!==void 0){F.simplify(),N[Y]=F;let W=ht.getValue(C.id);W!==void 0&&W.shadowPath.delete(),ht.cacheValue(C.id,{shadowPath:F.copy(),player:C})}}for(let Y=0;Y<r.length;Y++){const C=r[Y],l=C.metadata[`${S.EXTENSIONID}/visionRange`],h=U.userId===r[Y].createdUserId,m=j.some(M=>M.id==r[Y].createdUserId);if(l){if(!h&&U.role!=="GM"&&!m)continue;const M=U.gridDpi*(l/U.gridScale+.5),F=ze.NewPath().ellipse(C.position.x,C.position.y,M,M,0,0,2*Math.PI);N[Y]?.op(F,ze.PathOp.INTERSECT),F.delete();const W=U.players.find(ie=>ie.id===C.createdUserId);if(W&&U.role==="GM"){const ie=vt().strokeColor(W.color).fillOpacity(0).position({x:C.position.x,y:C.position.y}).width(M*2).height(M*2).shapeType("CIRCLE").metadata({[`${S.EXTENSIONID}/isIndicatorRing`]:!0}).build();A.push(ie)}}}const ue=[],se=U.metadata[`${S.EXTENSIONID}/persistenceEnabled`]===!0,ce=U.metadata[`${S.EXTENSIONID}/fowEnabled`]===!0,te=ze.NewPath(),we={},be=await H.scene.local.getItems(Vt),ye=await H.scene.local.getItems(mr),oe=[];ce&&te.rect(E[0],E[1],v[0],v[1]);for(const Y of Object.keys(N)){const C=N[Y],h=new TextEncoder().encode(C.toCmds().toString()),m=await crypto.subtle.digest("SHA-1",h).then(F=>[...new Uint8Array(F)].map(W=>W.toString(16).padStart(2,"0")).join(""));be.filter(F=>Pn(F)&&F.metadata[`${S.EXTENSIONID}/digest`]===m).length===0?ue.push({cmds:C.toCmds(),visible:!1,zIndex:3,playerId:r[Y].id,digest:m}):we[m]=!0,ce&&te.op(C,ze.PathOp.DIFFERENCE),C.delete()}const De=be.filter(Mt),qe=be.filter(Y=>{const C=Y.metadata[`${S.EXTENSIONID}/digest`];return Pn(Y)&&we[C]===void 0});if(ce){let Y=U.metadata[`${S.EXTENSIONID}/fowColor`]?U.metadata[`${S.EXTENSIONID}/fowColor`]:"#00000088",C=.5;Y.length==9&&(console.log(Y.substring(7)),C=Number.parseInt(Y.substring(7),16)/255,Y=Y.substring(0,7));const l=ii().commands(te.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(Y).fillOpacity(C).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${S.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();l.disableHit=!0,De.length>0?H.scene.local.updateItems(Mt,h=>{for(const m of h)m.commands=l.commands},!1):oe.push(H.scene.local.addItems([l]))}else oe.push(H.scene.local.deleteItems(be.filter(Mt).map(Y=>Y.id)));te.delete(),t.pause(),e.resume(),oe.push(H.scene.local.deleteItems(ye.map(Y=>Y.id))),oe.push(H.scene.local.addItems(ue.map(Y=>{const C=ii().commands(Y.cmds).locked(!0).visible(Y.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${S.EXTENSIONID}/isVisionFog`]:!0,[`${S.EXTENSIONID}/digest`]:Y.digest}).build();return C.zIndex=Y.zIndex,C}))),se||oe.push(H.scene.local.deleteItems(qe.map(Y=>Y.id))),A.length>0&&oe.push(H.scene.local.addItems(A)),U.fog.filled||oe.push(H.scene.fog.setFilled(!0)),await Promise.all(oe);let Be=(await H.scene.local.getItems(Vt)).length;const[et,nt]=[e.stop(),t.stop()];Rr({compute_time:`${nt} ms`,communication_time:`${et} ms`,cache_hits:Z,cache_misses:k,line_counter:X,skip_counter:J,item_counter:Be}),ut=!1}document.addEventListener("updateVision",Br);let Sn,si,Et=[],ai,On,li,ci,ui,di;async function gt(n){if(ut||!await H.scene.isReady())return;const[e,t]=[new ri,new ri];e.start(),e.pause(),t.start();const i=U.players.filter(J=>J.role=="GM"),o=U.items.filter(J=>J.layer=="CHARACTER"&&i.some(I=>J.createdUserId===I.id)&&(J.metadata[`${S.EXTENSIONID}/hasVision`]||J.metadata[`${S.ARMINDOID}/hasVision`])&&!J.metadata[`${S.EXTENSIONID}/visionBlind`]),r=U.role=="GM"?U.items.filter(wr):U.items.filter(br).concat(o),u=U.items.filter(vr),v=U.items.filter(Ai)?.[0],E=U.metadata[`${S.EXTENSIONID}/visionEnabled`]===!0,b=U.metadata[`${S.EXTENSIONID}/persistenceEnabled`]===!0,P=U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]===!0,D=U.metadata[`${S.EXTENSIONID}/fowEnabled`]===!0,V=U.metadata[`${S.EXTENSIONID}/fowColor`],Z=[],k=[],q=[];if(v===void 0?(Z[0]=0,Z[1]=0,k[0]=1,k[1]=1,q[0]=0,q[1]=0):(Z[0]=v.width*v.scale.x,Z[1]=v.height*v.scale.y,k[0]=v.scale.x,k[1]=v.scale.y,q[0]=v.position.x,q[1]=v.position.y),U.role=="GM"){const J=document.getElementById("mapHeight"),I=document.getElementById("mapWidth");I.value=(Math.round(Z[0])/U.gridDpi).toString(),J.value=(Math.round(Z[1])/U.gridDpi).toString()}const T=JSON.stringify(u),L=JSON.stringify(r),A=JSON.stringify(v);if(A==On&&E==ai&&di==V&&li==P&&ci==D&&ui==b&&Sn==T&&si==L&&Z[0]==Et[0]&&Z[1]==Et[1]&&n!==!0)return;let j=!1;(A!=On||Sn!=T||Z[0]!=Et[0]||Z[1]!=Et[1])&&(j=!0),On=A,si=L,Sn=T,Et=Z,ai=E,li=P,ci=D,di=V,ui=b,t.pause();const X=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:U.items,metadata:U.metadata,size:Z,offset:q,scale:k,tokensWithVision:r,visionShapes:u,invalidateCache:j}});ut||document.dispatchEvent(X)}function kn(n,e){n.split(/\s+/).forEach(t=>{e(t)})}class Mr{constructor(){this._events=void 0,this._events={}}on(e,t){kn(e,i=>{const o=this._events[i]||[];o.push(t),this._events[i]=o})}off(e,t){var i=arguments.length;if(i===0){this._events={};return}kn(e,o=>{if(i===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var i=this;kn(e,o=>{const r=i._events[o];r!==void 0&&r.forEach(u=>{u.apply(i,t)})})}}function Vr(n){return n.plugins={},class extends n{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){n.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,i;const o=this,r=[];if(Array.isArray(e))e.forEach(u=>{typeof u=="string"?r.push(u):(o.plugins.settings[u.name]=u.options,r.push(u.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;i=r.shift();)o.require(i)}loadPlugin(e){var t=this,i=t.plugins,o=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),i.names.push(e)}require(e){var t=this,i=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(i.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return i.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const rn=n=>(n=n.filter(Boolean),n.length<2?n[0]||"":Xr(n)==1?"["+n.join("")+"]":"(?:"+n.join("|")+")"),Ri=n=>{if(!jr(n))return n.join("");let e="",t=0;const i=()=>{t>1&&(e+="{"+t+"}")};return n.forEach((o,r)=>{if(o===n[r-1]){t++;return}i(),e+=o,t=1}),i(),e},Bi=n=>{let e=Bn(n);return rn(e)},jr=n=>new Set(n).size!==n.length,Tt=n=>(n+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Xr=n=>n.reduce((e,t)=>Math.max(e,Ur(t)),0),Ur=n=>Bn(n).length,Bn=n=>Array.from(n);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Mi=n=>{if(n.length===1)return[[n]];let e=[];const t=n.substring(1);return Mi(t).forEach(function(o){let r=o.slice(0);r[0]=n.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(n.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Hr=[[0,65535]],Wr="[̀-ͯ·ʾʼ]";let Qt,Vi;const Gr=3,Mn={},fi={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let n in fi){let e=fi[n]||"";for(let t=0;t<e.length;t++){let i=e.substring(t,t+1);Mn[i]=n}}const qr=new RegExp(Object.keys(Mn).join("|")+"|"+Wr,"gu"),Kr=n=>{Qt===void 0&&(Qt=Qr(n||Hr))},pi=(n,e="NFKD")=>n.normalize(e),Jt=n=>Bn(n).reduce((e,t)=>e+zr(t),""),zr=n=>(n=pi(n).toLowerCase().replace(qr,e=>Mn[e]||""),pi(n,"NFC"));function*Yr(n){for(const[e,t]of n)for(let i=e;i<=t;i++){let o=String.fromCharCode(i),r=Jt(o);r!=o.toLowerCase()&&(r.length>Gr||r.length!=0&&(yield{folded:r,composed:o,code_point:i}))}}const Zr=n=>{const e={},t=(i,o)=>{const r=e[i]||new Set,u=new RegExp("^"+Bi(r)+"$","iu");o.match(u)||(r.add(Tt(o)),e[i]=r)};for(let i of Yr(n))t(i.folded,i.folded),t(i.folded,i.composed);return e},Qr=n=>{const e=Zr(n),t={};let i=[];for(let r in e){let u=e[r];u&&(t[r]=Bi(u)),r.length>1&&i.push(Tt(r))}i.sort((r,u)=>u.length-r.length);const o=rn(i);return Vi=new RegExp("^"+o,"u"),t},Jr=(n,e=1)=>{let t=0;return n=n.map(i=>(Qt[i]&&(t+=i.length),Qt[i]||i)),t>=e?Ri(n):""},eo=(n,e=1)=>(e=Math.max(e,n.length-1),rn(Mi(n).map(t=>Jr(t,e)))),hi=(n,e=!0)=>{let t=n.length>1?1:0;return rn(n.map(i=>{let o=[];const r=e?i.length():i.length()-1;for(let u=0;u<r;u++)o.push(eo(i.substrs[u]||"",t));return Ri(o)}))},to=(n,e)=>{for(const t of e){if(t.start!=n.start||t.end!=n.end||t.substrs.join("")!==n.substrs.join(""))continue;let i=n.parts;const o=u=>{for(const v of i){if(v.start===u.start&&v.substr===u.substr)return!1;if(!(u.length==1||v.length==1)&&(u.start<v.start&&u.end>v.start||v.start<u.start&&v.end>u.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class en{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let i=new en,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const E of o)i.add(E);let u=t.substr.substring(0,e-r.start),v=u.length;return i.add({start:r.start,end:r.start+v,length:v,substr:u}),i}}const no=n=>{Kr(),n=Jt(n);let e="",t=[new en];for(let i=0;i<n.length;i++){let r=n.substring(i).match(Vi);const u=n.substring(i,i+1),v=r?r[0]:null;let E=[],b=new Set;for(const P of t){const D=P.last();if(!D||D.length==1||D.end<=i)if(v){const V=v.length;P.add({start:i,end:i+V,length:V,substr:v}),b.add("1")}else P.add({start:i,end:i+1,length:1,substr:u}),b.add("2");else if(v){let V=P.clone(i,D);const Z=v.length;V.add({start:i,end:i+Z,length:Z,substr:v}),E.push(V)}else b.add("3")}if(E.length>0){E=E.sort((P,D)=>P.length()-D.length());for(let P of E)to(P,t)||t.push(P);continue}if(i>0&&b.size==1&&!b.has("3")){e+=hi(t,!1);let P=new en;const D=t[0];D&&P.add(D.last()),t=[P]}}return e+=hi(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const io=(n,e)=>{if(n)return n[e]},ro=(n,e)=>{if(n){for(var t,i=e.split(".");(t=i.shift())&&(n=n[t]););return n}},Tn=(n,e,t)=>{var i,o;return!n||(n=n+"",e.regex==null)||(o=n.search(e.regex),o===-1)?0:(i=e.string.length/n.length,o===0&&(i+=.5),i*t)},An=(n,e)=>{var t=n[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(n[e]=[t])},We=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},oo=(n,e)=>typeof n=="number"&&typeof e=="number"?n>e?1:n<e?-1:0:(n=Jt(n+"").toLowerCase(),e=Jt(e+"").toLowerCase(),n>e?1:e>n?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class so{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,i){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var u;return i&&(u=new RegExp("^("+Object.keys(i).map(Tt).join("|")+"):(.*)$")),r.forEach(v=>{let E,b=null,P=null;u&&(E=v.match(u))&&(b=E[1],v=E[2]),v.length>0&&(this.settings.diacritics?P=no(v)||null:P=Tt(v),P&&t&&(P="\\b"+P)),o.push({string:v,regex:P?new RegExp(P,"iu"):null,field:b})}),o}getScoreFunction(e,t){var i=this.prepareSearch(e,t);return this._getScoreFunction(i)}_getScoreFunction(e){const t=e.tokens,i=t.length;if(!i)return function(){return 0};const o=e.options.fields,r=e.weights,u=o.length,v=e.getAttrFn;if(!u)return function(){return 1};const E=function(){return u===1?function(b,P){const D=o[0].field;return Tn(v(P,D),b,r[D]||1)}:function(b,P){var D=0;if(b.field){const V=v(P,b.field);!b.regex&&V?D+=1/u:D+=Tn(V,b,1)}else We(r,(V,Z)=>{D+=Tn(v(P,Z),b,V)});return D/u}}();return i===1?function(b){return E(t[0],b)}:e.options.conjunction==="and"?function(b){var P,D=0;for(let V of t){if(P=E(V,b),P<=0)return 0;D+=P}return D/i}:function(b){var P=0;return We(t,D=>{P+=E(D,b)}),P/i}}getSortFunction(e,t){var i=this.prepareSearch(e,t);return this._getSortFunction(i)}_getSortFunction(e){var t,i=[];const o=this,r=e.options,u=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof u=="function")return u.bind(this);const v=function(P,D){return P==="$score"?D.score:e.getAttrFn(o.items[D.id],P)};if(u)for(let b of u)(e.query||b.field!=="$score")&&i.push(b);if(e.query){t=!0;for(let b of i)if(b.field==="$score"){t=!1;break}t&&i.unshift({field:"$score",direction:"desc"})}else i=i.filter(b=>b.field!=="$score");return i.length?function(b,P){var D,V;for(let Z of i)if(V=Z.field,D=(Z.direction==="desc"?-1:1)*oo(v(V,b),v(V,P)),D)return D;return 0}:null}prepareSearch(e,t){const i={};var o=Object.assign({},t);if(An(o,"sort"),An(o,"sort_empty"),o.fields){An(o,"fields");const r=[];o.fields.forEach(u=>{typeof u=="string"&&(u={field:u,weight:1}),r.push(u),i[u.field]="weight"in u?u.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,i),total:0,items:[],weights:i,getAttrFn:o.nesting?ro:io}}search(e,t){var i=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const u=t.score||i._getScoreFunction(r);e.length?We(i.items,(E,b)=>{o=u(E),(t.filter===!1||o>0)&&r.items.push({score:o,id:b})}):We(i.items,(E,b)=>{r.items.push({score:1,id:b})});const v=i._getSortFunction(r);return v&&r.items.sort(v),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const mt=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},Me=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(ji(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},ji=n=>typeof n=="string"&&n.indexOf("<")>-1,ao=n=>n.replace(/['"\\]/g,"\\$&"),xn=(n,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),n.dispatchEvent(t)},Rt=(n,e)=>{Object.assign(n.style,e)},He=(n,...e)=>{var t=Xi(e);n=Ui(n),n.map(i=>{t.map(o=>{i.classList.add(o)})})},at=(n,...e)=>{var t=Xi(e);n=Ui(n),n.map(i=>{t.map(o=>{i.classList.remove(o)})})},Xi=n=>{var e=[];return mt(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ui=n=>(Array.isArray(n)||(n=[n]),n),jt=(n,e,t)=>{if(!(t&&!t.contains(n)))for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},gi=(n,e=0)=>e>0?n[n.length-1]:n[0],lo=n=>Object.keys(n).length===0,tn=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t},Pe=(n,e)=>{mt(e,(t,i)=>{t==null?n.removeAttribute(i):n.setAttribute(i,""+t)})},Ln=(n,e)=>{n.parentNode&&n.parentNode.replaceChild(e,n)},co=(n,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var u=r.data.match(e);if(u&&r.data.length>0){var v=document.createElement("span");v.className="highlight";var E=r.splitText(u.index);E.splitText(u[0].length);var b=E.cloneNode(!0);return v.appendChild(b),Ln(E,v),1}return 0},i=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(u=>{o(u)})},o=r=>r.nodeType===3?t(r):(i(r),0);o(n)},uo=n=>{var e=n.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var i=t.parentNode;i.replaceChild(t.firstChild,t),i.normalize()})},fo=65,po=13,Hi=27,$n=37,ho=38,Wi=39,go=40,mi=8,mo=46,Fn=9,vo=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Bt=vo?"metaKey":"ctrlKey";var vi={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(n){return n.length>0},render:{}};const Ze=n=>typeof n>"u"||n===null?null:Xt(n),Xt=n=>typeof n=="boolean"?n?"1":"0":n+"",Ut=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),yo=(n,e)=>{var t;return function(i,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[i]=!0,n.call(r,i,o)},e)}},yi=(n,e,t)=>{var i,o=n.trigger,r={};n.trigger=function(){var u=arguments[0];if(e.indexOf(u)!==-1)r[u]=arguments;else return o.apply(n,arguments)},t.apply(n,[]),n.trigger=o;for(i of e)i in r&&o.apply(n,r[i])},wo=n=>({start:n.selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)}),Te=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Le=(n,e,t,i)=>{n.addEventListener(e,t,i)},ft=(n,e)=>{if(!e||!e[n])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Nn=(n,e)=>{const t=n.getAttribute("id");return t||(n.setAttribute("id",e),e)},wi=n=>n.replace(/[\\"']/g,"\\$&"),pt=(n,e)=>{e&&n.append(e)};function bi(n,e){var t=Object.assign({},vi,e),i=t.dataAttr,o=t.labelField,r=t.valueField,u=t.disabledField,v=t.optgroupField,E=t.optgroupLabelField,b=t.optgroupValueField,P=n.tagName.toLowerCase(),D=n.getAttribute("placeholder")||n.getAttribute("data-placeholder");if(!D&&!t.allowEmptyOption){let q=n.querySelector('option[value=""]');q&&(D=q.textContent)}var V={placeholder:D,options:[],optgroups:[],items:[],maxItems:null},Z=()=>{var q,T=V.options,L={},A=1,j=I=>{var g=Object.assign({},I.dataset),f=i&&g[i];return typeof f=="string"&&f.length&&(g=Object.assign(g,JSON.parse(f))),g},X=(I,g)=>{var f=Ze(I.value);if(f!=null&&!(!f&&!t.allowEmptyOption)){if(L.hasOwnProperty(f)){if(g){var y=L[f][v];y?Array.isArray(y)?y.push(g):L[f][v]=[y,g]:L[f][v]=g}}else{var d=j(I);d[o]=d[o]||I.textContent,d[r]=d[r]||f,d[u]=d[u]||I.disabled,d[v]=d[v]||g,d.$option=I,L[f]=d,T.push(d)}I.selected&&V.items.push(f)}},J=I=>{var g,f;f=j(I),f[E]=f[E]||I.getAttribute("label")||"",f[b]=f[b]||A++,f[u]=f[u]||I.disabled,V.optgroups.push(f),g=f[b],mt(I.children,y=>{X(y,g)})};V.maxItems=n.hasAttribute("multiple")?null:1,mt(n.children,I=>{q=I.tagName.toLowerCase(),q==="optgroup"?J(I):q==="option"&&X(I)})},k=()=>{const q=n.getAttribute(i);if(q)V.options=JSON.parse(q),mt(V.options,L=>{V.items.push(L[r])});else{var T=n.value.trim()||"";if(!t.allowEmptyOption&&!T.length)return;const L=T.split(t.delimiter);mt(L,A=>{const j={};j[o]=A,j[r]=A,V.options.push(j)}),V.items=L}};return P==="select"?Z():k(),Object.assign({},vi,V,e)}var Ii=0;class Ge extends Vr(Mr){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],Ii++;var i,o=Me(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);i=r.getPropertyValue("direction");const u=bi(o,t);this.settings=u,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(i),this.inputId=Nn(o,"tomselect-"+Ii),this.isRequired=o.required,this.sifter=new so(this.options,{diacritics:u.diacritics}),u.mode=u.mode||(u.maxItems===1?"single":"multi"),typeof u.hideSelected!="boolean"&&(u.hideSelected=u.mode==="multi"),typeof u.hidePlaceholder!="boolean"&&(u.hidePlaceholder=u.mode!=="multi");var v=u.createFilter;typeof v!="function"&&(typeof v=="string"&&(v=new RegExp(v)),v instanceof RegExp?u.createFilter=T=>v.test(T):u.createFilter=T=>this.settings.duplicates||!this.options[T]),this.initializePlugins(u.plugins),this.setupCallbacks(),this.setupTemplates();const E=Me("<div>"),b=Me("<div>"),P=this._render("dropdown"),D=Me('<div role="listbox" tabindex="-1">'),V=this.input.getAttribute("class")||"",Z=u.mode;var k;if(He(E,u.wrapperClass,V,Z),He(b,u.controlClass),pt(E,b),He(P,u.dropdownClass,Z),u.copyClassesToDropdown&&He(P,V),He(D,u.dropdownContentClass),pt(P,D),Me(u.dropdownParent||E).appendChild(P),ji(u.controlInput)){k=Me(u.controlInput);var q=["autocorrect","autocapitalize","autocomplete"];We(q,T=>{o.getAttribute(T)&&Pe(k,{[T]:o.getAttribute(T)})}),k.tabIndex=-1,b.appendChild(k),this.focus_node=k}else u.controlInput?(k=Me(u.controlInput),this.focus_node=k):(k=Me("<input/>"),this.focus_node=b);this.wrapper=E,this.dropdown=P,this.dropdown_content=D,this.control=b,this.control_input=k,this.setup()}setup(){const e=this,t=e.settings,i=e.control_input,o=e.dropdown,r=e.dropdown_content,u=e.wrapper,v=e.control,E=e.input,b=e.focus_node,P={passive:!0},D=e.inputId+"-ts-dropdown";Pe(r,{id:D}),Pe(b,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":D});const V=Nn(b,e.inputId+"-ts-control"),Z="label[for='"+ao(e.inputId)+"']",k=document.querySelector(Z),q=e.focus.bind(e);if(k){Le(k,"click",q),Pe(k,{for:V});const A=Nn(k,e.inputId+"-ts-label");Pe(b,{"aria-labelledby":A}),Pe(r,{"aria-labelledby":A})}if(u.style.width=E.style.width,e.plugins.names.length){const A="plugin-"+e.plugins.names.join(" plugin-");He([u,o],A)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&Pe(E,{multiple:"multiple"}),t.placeholder&&Pe(i,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Tt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=yo(t.load,t.loadThrottle)),e.control_input.type=E.type,Le(o,"mousemove",()=>{e.ignoreHover=!1}),Le(o,"mouseenter",A=>{var j=jt(A.target,"[data-selectable]",o);j&&e.onOptionHover(A,j)},{capture:!0}),Le(o,"click",A=>{const j=jt(A.target,"[data-selectable]");j&&(e.onOptionSelect(A,j),Te(A,!0))}),Le(v,"click",A=>{var j=jt(A.target,"[data-ts-item]",v);if(j&&e.onItemSelect(A,j)){Te(A,!0);return}i.value==""&&(e.onClick(),Te(A,!0))}),Le(b,"keydown",A=>e.onKeyDown(A)),Le(i,"keypress",A=>e.onKeyPress(A)),Le(i,"input",A=>e.onInput(A)),Le(b,"blur",A=>e.onBlur(A)),Le(b,"focus",A=>e.onFocus(A)),Le(i,"paste",A=>e.onPaste(A));const T=A=>{const j=A.composedPath()[0];if(!u.contains(j)&&!o.contains(j)){e.isFocused&&e.blur(),e.inputState();return}j==i&&e.isOpen?A.stopPropagation():Te(A,!0)},L=()=>{e.isOpen&&e.positionDropdown()};Le(document,"mousedown",T),Le(window,"scroll",L,P),Le(window,"resize",L,P),this._destroy=()=>{document.removeEventListener("mousedown",T),window.removeEventListener("scroll",L),window.removeEventListener("resize",L),k&&k.removeEventListener("click",q)},this.revertSettings={innerHTML:E.innerHTML,tabIndex:E.tabIndex},E.tabIndex=-1,E.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Le(E,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,E.disabled?e.disable():e.enable(),e.on("change",this.onChange),He(E,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),We(t,i=>{this.registerOptionGroup(i)})}setupTemplates(){var e=this,t=e.settings.labelField,i=e.settings.optgroupLabelField,o={optgroup:r=>{let u=document.createElement("div");return u.className="optgroup",u.appendChild(r.options),u},optgroup_header:(r,u)=>'<div class="optgroup-header">'+u(r[i])+"</div>",option:(r,u)=>"<div>"+u(r[t])+"</div>",item:(r,u)=>"<div>"+u(r[t])+"</div>",option_create:(r,u)=>'<div class="create">Add <strong>'+u(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)t=this.settings[i[e]],t&&this.on(e,t)}sync(e=!0){const t=this,i=e?bi(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(i.options,i.optgroups),t.setValue(i.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){xn(this.input,"input"),xn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Te(e);return}t.settings.splitOn&&setTimeout(()=>{var i=t.inputValue();if(i.match(t.settings.splitOn)){var o=i.trim().split(t.settings.splitOn);We(o,r=>{Ze(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Te(e);return}var i=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&i===t.settings.delimiter){t.createItem(),Te(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Fn&&Te(e);return}switch(e.keyCode){case fo:if(ft(Bt,e)&&t.control_input.value==""){Te(e),t.selectAll();return}break;case Hi:t.isOpen&&(Te(e,!0),t.close()),t.clearActiveItems();return;case go:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let i=t.getAdjacent(t.activeOption,1);i&&t.setActiveOption(i)}Te(e);return;case ho:if(t.activeOption){let i=t.getAdjacent(t.activeOption,-1);i&&t.setActiveOption(i)}Te(e);return;case po:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Te(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Te(e);return;case $n:t.advanceSelection(-1,e);return;case Wi:t.advanceSelection(1,e);return;case Fn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Te(e)),t.settings.create&&t.createItem()&&Te(e));return;case mi:case mo:t.deleteSelection(e);return}t.isInputHidden&&!ft(Bt,e)&&Te(e)}onInput(e){var t=this;if(!t.isLocked){var i=t.inputValue();t.lastValue!==i&&(t.lastValue=i,t.settings.shouldLoad.call(t,i)&&t.load(i),t.refreshOptions(),t.trigger("type",i))}}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,i=t.isFocused;if(t.isDisabled){t.blur(),Te(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),i||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var i=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,i):i()}}}onOptionSelect(e,t){var i,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(i=t.dataset.value,typeof i<"u"&&(o.lastQuery=null,o.addItem(i),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var i=this;return!i.isLocked&&i.settings.mode==="multi"?(Te(e),i.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;He(t.wrapper,t.settings.loadingClass),t.loading++;const i=t.loadCallback.bind(t);t.settings.load.call(t,e,i)}loadCallback(e,t){const i=this;i.loading=Math.max(i.loading-1,0),i.lastQuery=null,i.clearActiveOption(),i.setupOptions(e,t),i.refreshOptions(i.isFocused&&!i.isInputHidden),i.loading||at(i.wrapper,i.settings.loadingClass),i.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,i=t.value!==e;i&&(t.value=e,xn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var i=t?[]:["change"];yi(this,i,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var i=this,o,r,u,v,E,b;if(i.settings.mode!=="single"){if(!e){i.clearActiveItems(),i.isFocused&&i.showInput();return}if(o=t&&t.type.toLowerCase(),o==="click"&&ft("shiftKey",t)&&i.activeItems.length){for(b=i.getLastActive(),u=Array.prototype.indexOf.call(i.control.children,b),v=Array.prototype.indexOf.call(i.control.children,e),u>v&&(E=u,u=v,v=E),r=u;r<=v;r++)e=i.control.children[r],i.activeItems.indexOf(e)===-1&&i.setActiveItemClass(e);Te(t)}else o==="click"&&ft(Bt,t)||o==="keydown"&&ft("shiftKey",t)?e.classList.contains("active")?i.removeActiveItem(e):i.setActiveItemClass(e):(i.clearActiveItems(),i.setActiveItemClass(e));i.hideInput(),i.isFocused||i.focus()}}setActiveItemClass(e){const t=this,i=t.control.querySelector(".last-active");i&&at(i,"last-active"),He(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),at(e,"active")}clearActiveItems(){at(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,Pe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),Pe(e,{"aria-selected":"true"}),He(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const i=this.dropdown_content,o=i.clientHeight,r=i.scrollTop||0,u=e.offsetHeight,v=e.getBoundingClientRect().top-i.getBoundingClientRect().top+r;v+u>o+r?this.scroll(v-o+u,t):v<r&&this.scroll(v,t)}scroll(e,t){const i=this.dropdown_content;t&&(i.style.scrollBehavior=t),i.scrollTop=e,i.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(at(this.activeOption,"active"),Pe(this.activeOption,{"aria-selected":null})),this.activeOption=null,Pe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,We(t,i=>{e.setActiveItemClass(i)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(Pe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&Pe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,i,o=this,r=this.getSearchOptions();if(o.settings.score&&(i=o.settings.score.call(o,e),typeof i!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:i})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(u=>{let v=Ze(u.id);return!(v&&o.items.indexOf(v)!==-1)})),t}refreshOptions(e=!0){var t,i,o,r,u,v,E,b,P,D;const V={},Z=[];var k=this,q=k.inputValue();const T=q===k.lastQuery||q==""&&k.lastQuery==null;var L=k.search(q),A=null,j=k.settings.shouldOpen||!1,X=k.dropdown_content;for(T&&(A=k.activeOption,A&&(P=A.closest("[data-group]"))),r=L.items.length,typeof k.settings.maxOptions=="number"&&(r=Math.min(r,k.settings.maxOptions)),r>0&&(j=!0),t=0;t<r;t++){let I=L.items[t];if(!I)continue;let g=I.id,f=k.options[g];if(f===void 0)continue;let y=Xt(g),d=k.getOption(y,!0);for(k.settings.hideSelected||d.classList.toggle("selected",k.items.includes(y)),u=f[k.settings.optgroupField]||"",v=Array.isArray(u)?u:[u],i=0,o=v&&v.length;i<o;i++){u=v[i],k.optgroups.hasOwnProperty(u)||(u="");let O=V[u];O===void 0&&(O=document.createDocumentFragment(),Z.push(u)),i>0&&(d=d.cloneNode(!0),Pe(d,{id:f.$id+"-clone-"+i,"aria-selected":null}),d.classList.add("ts-cloned"),at(d,"active"),k.activeOption&&k.activeOption.dataset.value==g&&P&&P.dataset.group===u.toString()&&(A=d)),O.appendChild(d),V[u]=O}}k.settings.lockOptgroupOrder&&Z.sort((I,g)=>{const f=k.optgroups[I],y=k.optgroups[g],d=f&&f.$order||0,O=y&&y.$order||0;return d-O}),E=document.createDocumentFragment(),We(Z,I=>{let g=V[I];if(!g||!g.children.length)return;let f=k.optgroups[I];if(f!==void 0){let y=document.createDocumentFragment(),d=k.render("optgroup_header",f);pt(y,d),pt(y,g);let O=k.render("optgroup",{group:f,options:y});pt(E,O)}else pt(E,g)}),X.innerHTML="",pt(X,E),k.settings.highlight&&(uo(X),L.query.length&&L.tokens.length&&We(L.tokens,I=>{co(X,I.regex)}));var J=I=>{let g=k.render(I,{input:q});return g&&(j=!0,X.insertBefore(g,X.firstChild)),g};if(k.loading?J("loading"):k.settings.shouldLoad.call(k,q)?L.items.length===0&&J("no_results"):J("not_loading"),b=k.canCreate(q),b&&(D=J("option_create")),k.hasOptions=L.items.length>0||b,j){if(L.items.length>0){if(!A&&k.settings.mode==="single"&&k.items[0]!=null&&(A=k.getOption(k.items[0])),!X.contains(A)){let I=0;D&&!k.settings.addPrecedence&&(I=1),A=k.selectable()[I]}}else D&&(A=D);e&&!k.isOpen&&(k.open(),k.scrollToOption(A,"auto")),k.setActiveOption(A)}else k.clearActiveOption(),e&&k.isOpen&&k.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const i=this;if(Array.isArray(e))return i.addOptions(e,t),!1;const o=Ze(e[i.settings.valueField]);return o===null||i.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++i.order,e.$id=i.inputId+"-opt-"+e.$order,i.options[o]=e,i.lastQuery=null,t&&(i.userOptions[o]=t,i.trigger("option_add",o,e)),o)}addOptions(e,t=!1){We(e,i=>{this.addOption(i,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ze(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var i;t[this.settings.optgroupValueField]=e,(i=this.registerOptionGroup(t))&&this.trigger("optgroup_add",i,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const i=this;var o,r;const u=Ze(e),v=Ze(t[i.settings.valueField]);if(u===null)return;const E=i.options[u];if(E==null)return;if(typeof v!="string")throw new Error("Value must be set in option data");const b=i.getOption(u),P=i.getItem(u);if(t.$order=t.$order||E.$order,delete i.options[u],i.uncacheValue(v),i.options[v]=t,b){if(i.dropdown_content.contains(b)){const D=i._render("option",t);Ln(b,D),i.activeOption===b&&i.setActiveOption(D)}b.remove()}P&&(r=i.items.indexOf(u),r!==-1&&i.items.splice(r,1,v),o=i._render("item",t),P.classList.contains("active")&&He(o,"active"),Ln(P,o)),i.lastQuery=null}removeOption(e,t){const i=this;e=Xt(e),i.uncacheValue(e),delete i.userOptions[e],delete i.options[e],i.lastQuery=null,i.trigger("option_remove",e),i.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const i={};We(this.options,(o,r)=>{t(o,r)&&(i[r]=o)}),this.options=this.sifter.items=i,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const i=Ze(e);if(i===null)return null;const o=this.options[i];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,i="option"){var o=this,r;if(!e)return null;i=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let u=0;u<r.length;u++)if(r[u]==e)return t>0?r[u+1]:r[u-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ze(e);return t!==null?this.control.querySelector(`[data-value="${wi(t)}"]`):null}addItems(e,t){var i=this,o=Array.isArray(e)?e:[e];o=o.filter(u=>i.items.indexOf(u)===-1);const r=o[o.length-1];o.forEach(u=>{i.isPending=u!==r,i.addItem(u,t)})}addItem(e,t){var i=t?[]:["change","dropdown_close"];yi(this,i,()=>{var o,r;const u=this,v=u.settings.mode,E=Ze(e);if(!(E&&u.items.indexOf(E)!==-1&&(v==="single"&&u.close(),v==="single"||!u.settings.duplicates))&&!(E===null||!u.options.hasOwnProperty(E))&&(v==="single"&&u.clear(t),!(v==="multi"&&u.isFull()))){if(o=u._render("item",u.options[E]),u.control.contains(o)&&(o=o.cloneNode(!0)),r=u.isFull(),u.items.splice(u.caretPos,0,E),u.insertAtCaret(o),u.isSetup){if(!u.isPending&&u.settings.hideSelected){let b=u.getOption(E),P=u.getAdjacent(b,1);P&&u.setActiveOption(P)}!u.isPending&&!u.settings.closeAfterSelect&&u.refreshOptions(u.isFocused&&v!=="single"),u.settings.closeAfterSelect!=!1&&u.isFull()?u.close():u.isPending||u.positionDropdown(),u.trigger("item_add",E,o),u.isPending||u.updateOriginalInput({silent:t})}(!u.isPending||!r&&u.isFull())&&(u.inputState(),u.refreshState())}})}removeItem(e=null,t){const i=this;if(e=i.getItem(e),!e)return;var o,r;const u=e.dataset.value;o=tn(e),e.remove(),e.classList.contains("active")&&(r=i.activeItems.indexOf(e),i.activeItems.splice(r,1),at(e,"active")),i.items.splice(o,1),i.lastQuery=null,!i.settings.persist&&i.userOptions.hasOwnProperty(u)&&i.removeOption(u,t),o<i.caretPos&&i.setCaret(i.caretPos-1),i.updateOriginalInput({silent:t}),i.refreshState(),i.positionDropdown(),i.trigger("item_remove",u,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var i=this,o=i.caretPos,r;if(e=e||i.inputValue(),!i.canCreate(e))return t(),!1;i.lock();var u=!1,v=E=>{if(i.unlock(),!E||typeof E!="object")return t();var b=Ze(E[i.settings.valueField]);if(typeof b!="string")return t();i.setTextboxValue(),i.addOption(E,!0),i.setCaret(o),i.addItem(b),t(E),u=!0};return typeof i.settings.create=="function"?r=i.settings.create.call(this,e,v):r={[i.settings.labelField]:e,[i.settings.valueField]:e},u||v(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),i=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",i),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",lo(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var i,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let E=function(b,P,D){return b||(b=Me('<option value="'+Ut(P)+'">'+Ut(D)+"</option>")),b!=r&&t.input.append(b),u.push(b),(b!=r||v>0)&&(b.selected=!0),b};const u=[],v=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(b=>{b.selected=!1}),t.items.length==0&&t.settings.mode=="single"?E(r,"",""):t.items.forEach(b=>{if(i=t.options[b],o=i[t.settings.labelField]||"",u.includes(i.$option)){const P=t.input.querySelector(`option[value="${wi(b)}"]:not(:checked)`);E(P,b,o)}else i.$option=E(i.$option,b,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,Pe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Rt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Rt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,i=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.hideInput()),t.isOpen=!1,Pe(t.focus_node,{"aria-expanded":"false"}),Rt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),i&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),i=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Rt(this.dropdown,{width:t.width+"px",top:i+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var i=t.controlChildren();We(i,o=>{t.removeItem(o,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,i=t.caretPos,o=t.control;o.insertBefore(e,o.children[i]||null),t.setCaret(i+1)}deleteSelection(e){var t,i,o,r,u=this;t=e&&e.keyCode===mi?-1:1,i=wo(u.control_input);const v=[];if(u.activeItems.length)r=gi(u.activeItems,t),o=tn(r),t>0&&o++,We(u.activeItems,E=>v.push(E));else if((u.isFocused||u.settings.mode==="single")&&u.items.length){const E=u.controlChildren();let b;t<0&&i.start===0&&i.length===0?b=E[u.caretPos-1]:t>0&&i.start===u.inputValue().length&&(b=E[u.caretPos]),b!==void 0&&v.push(b)}if(!u.shouldDelete(v,e))return!1;for(Te(e,!0),typeof o<"u"&&u.setCaret(o);v.length;)u.removeItem(v.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!1),!0}shouldDelete(e,t){const i=e.map(o=>o.dataset.value);return!(!i.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(i,t)===!1)}advanceSelection(e,t){var i,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(ft(Bt,t)||ft("shiftKey",t)?(i=r.getLastActive(e),i?i.classList.contains("active")?o=r.getAdjacent(i,e,"item"):o=i:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(i),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var i=this.control.querySelectorAll(".active");if(i)return gi(i,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,at(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var i,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,Ut),!o))return null;if(o=Me(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?Pe(o,{"aria-disabled":"true"}):Pe(o,{"data-selectable":""}):e==="optgroup"&&(i=t.group[r.settings.optgroupValueField],Pe(o,{"data-group":i}),t.group[r.settings.disabledField]&&Pe(o,{"data-disabled":""})),e==="option"||e==="item"){const u=Xt(t[r.settings.valueField]);Pe(o,{"data-value":u}),e==="item"?(He(o,r.settings.itemClass),Pe(o,{"data-ts-item":""})):(He(o,r.settings.optionClass),Pe(o,{role:"option",id:t.$id}),t.$div=o,r.options[u]=t)}return o}_render(e,t){const i=this.render(e,t);if(i==null)throw"HTMLElement expected";return i}clearCache(){We(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,i){var o=this,r=o[t];o[t]=function(){var u,v;return e==="after"&&(u=r.apply(o,arguments)),v=i.apply(o,arguments),e==="instead"?v:(e==="before"&&(u=r.apply(o,arguments)),u)}}}function bo(){Le(this.input,"change",()=>{this.sync()})}function Io(){var n=this,e=n.onOptionSelect;n.settings.hideSelected=!1;var t=function(o){setTimeout(()=>{var r=o.querySelector("input");r instanceof HTMLInputElement&&(o.classList.contains("selected")?r.checked=!0:r.checked=!1)},1)};n.hook("after","setupTemplates",()=>{var i=n.settings.render.option;n.settings.render.option=(o,r)=>{var u=Me(i.call(n,o,r)),v=document.createElement("input");v.addEventListener("click",function(b){Te(b)}),v.type="checkbox";const E=Ze(o[n.settings.valueField]);return E&&n.items.indexOf(E)>-1&&(v.checked=!0),u.prepend(v),u}}),n.on("item_remove",i=>{var o=n.getOption(i);o&&(o.classList.remove("selected"),t(o))}),n.on("item_add",i=>{var o=n.getOption(i);o&&t(o)}),n.hook("instead","onOptionSelect",(i,o)=>{if(o.classList.contains("selected")){o.classList.remove("selected"),n.removeItem(o.dataset.value),n.refreshOptions(),Te(i,!0);return}e.call(n,i,o),t(o)})}function Eo(n){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:i=>`<div class="${i.className}" title="${i.title}">&#10799;</div>`},n);e.on("initialize",()=>{var i=Me(t.html(t));i.addEventListener("click",o=>{e.isDisabled||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(i)})}function _o(){var n=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(n.settings.mode==="multi"){var e=n.lock,t=n.unlock;n.hook("instead","lock",()=>{var i=$(n.control).data("sortable");return i&&i.disable(),e.call(n)}),n.hook("instead","unlock",()=>{var i=$(n.control).data("sortable");return i&&i.enable(),t.call(n)}),n.on("initialize",()=>{var i=$(n.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:n.isLocked,start:(o,r)=>{r.placeholder.css("width",r.helper.css("width")),i.css({overflow:"visible"})},stop:()=>{i.css({overflow:"hidden"});var o=[];i.children("[data-value]").each(function(){this.dataset.value&&o.push(this.dataset.value)}),n.setValue(o)}})})}}function So(n){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:i=>'<div class="'+i.headerClass+'"><div class="'+i.titleRowClass+'"><span class="'+i.labelClass+'">'+i.title+'</span><a class="'+i.closeClass+'">&times;</a></div></div>'},n);e.on("initialize",()=>{var i=Me(t.html(t)),o=i.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Te(r,!0),e.close()}),e.dropdown.insertBefore(i,e.dropdown.firstChild)})}function Oo(){var n=this;n.hook("instead","setCaret",e=>{n.settings.mode==="single"||!n.control.contains(n.control_input)?e=n.items.length:(e=Math.max(0,Math.min(n.items.length,e)),e!=n.caretPos&&!n.isPending&&n.controlChildren().forEach((t,i)=>{i<e?n.control_input.insertAdjacentElement("beforebegin",t):n.control.appendChild(t)})),n.caretPos=e}),n.hook("instead","moveCaret",e=>{if(!n.isFocused)return;const t=n.getLastActive(e);if(t){const i=tn(t);n.setCaret(e>0?i+1:i),n.setActiveItem(),at(t,"last-active")}else n.setCaret(n.caretPos+e)})}function ko(){const n=this;n.settings.shouldOpen=!0,n.hook("before","setup",()=>{n.focus_node=n.control,He(n.control_input,"dropdown-input");const e=Me('<div class="dropdown-input-wrap">');e.append(n.control_input),n.dropdown.insertBefore(e,n.dropdown.firstChild);const t=Me('<input class="items-placeholder" tabindex="-1" />');t.placeholder=n.settings.placeholder||"",n.control.append(t)}),n.on("initialize",()=>{n.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case Hi:n.isOpen&&(Te(t,!0),n.close()),n.clearActiveItems();return;case Fn:n.focus_node.tabIndex=-1;break}return n.onKeyDown.call(n,t)}),n.on("blur",()=>{n.focus_node.tabIndex=n.isDisabled?-1:n.tabIndex}),n.on("dropdown_open",()=>{n.control_input.focus()});const e=n.onBlur;n.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==n.control_input))return e.call(n)}),Le(n.control_input,"blur",()=>n.onBlur()),n.hook("before","close",()=>{n.isOpen&&n.focus_node.focus({preventScroll:!0})})})}function To(){var n=this;n.on("initialize",()=>{var e=document.createElement("span"),t=n.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(e);var i=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of i)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),n.on("update item_add item_remove",o),Le(t,"input",o),Le(t,"keyup",o),Le(t,"blur",o),Le(t,"update",o)})}function Ao(){var n=this,e=n.deleteSelection;this.hook("instead","deleteSelection",t=>n.activeItems.length?e.call(n,t):!1)}function xo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function No(){var n=this,e=n.onKeyDown;n.hook("instead","onKeyDown",t=>{var i,o,r,u;if(!n.isOpen||!(t.keyCode===$n||t.keyCode===Wi))return e.call(n,t);n.ignoreHover=!0,u=jt(n.activeOption,"[data-group]"),i=tn(n.activeOption,"[data-selectable]"),u&&(t.keyCode===$n?u=u.previousSibling:u=u.nextSibling,u&&(r=u.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,i)],o&&n.setActiveOption(o)))})}function Co(n){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},n);var t=this;if(e.append){var i='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Ut(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,u)=>{var v=Me(o.call(t,r,u)),E=Me(i);return v.appendChild(E),Le(E,"mousedown",b=>{Te(b,!0)}),Le(E,"click",b=>{Te(b,!0),!t.isLocked&&t.shouldDelete([v],b)&&(t.removeItem(v),t.refreshOptions(!1),t.inputState())}),v}})}}function Do(n){const e=this,t=Object.assign({text:i=>i[e.settings.labelField]},n);e.on("item_remove",function(i){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[i];o&&e.setTextboxValue(t.text.call(e,o))}})}function Po(){const n=this,e=n.canLoad,t=n.clearActiveOption,i=n.loadCallback;var o={},r,u=!1,v,E=[];if(n.settings.shouldLoadMore||(n.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(n.activeOption){var V=n.selectable(),Z=Array.from(V).indexOf(n.activeOption);if(Z>=V.length-2)return!0}return!1}),!n.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";n.settings.sortField=[{field:"$order"},{field:"$score"}];const b=D=>typeof n.settings.maxOptions=="number"&&r.children.length>=n.settings.maxOptions?!1:!!(D in o&&o[D]),P=(D,V)=>n.items.indexOf(V)>=0||E.indexOf(V)>=0;n.setNextUrl=(D,V)=>{o[D]=V},n.getUrl=D=>{if(D in o){const V=o[D];return o[D]=!1,V}return o={},n.settings.firstUrl.call(n,D)},n.hook("instead","clearActiveOption",()=>{if(!u)return t.call(n)}),n.hook("instead","canLoad",D=>D in o?b(D):e.call(n,D)),n.hook("instead","loadCallback",(D,V)=>{if(!u)n.clearOptions(P);else if(v){const Z=D[0];Z!==void 0&&(v.dataset.value=Z[n.settings.valueField])}i.call(n,D,V),u=!1}),n.hook("after","refreshOptions",()=>{const D=n.lastValue;var V;b(D)?(V=n.render("loading_more",{query:D}),V&&(V.setAttribute("data-selectable",""),v=V)):D in o&&!r.querySelector(".no-results")&&(V=n.render("no_more_results",{query:D})),V&&(He(V,n.settings.optionClass),r.append(V))}),n.on("initialize",()=>{E=Object.keys(n.options),r=n.dropdown_content,n.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},n.settings.render),r.addEventListener("scroll",()=>{n.settings.shouldLoadMore.call(n)&&b(n.lastValue)&&(u||(u=!0,n.load.call(n,n.lastValue)))})})}Ge.define("change_listener",bo);Ge.define("checkbox_options",Io);Ge.define("clear_button",Eo);Ge.define("drag_drop",_o);Ge.define("dropdown_header",So);Ge.define("caret_position",Oo);Ge.define("dropdown_input",ko);Ge.define("input_autogrow",To);Ge.define("no_backspace_delete",Ao);Ge.define("no_active_items",xo);Ge.define("optgroup_columns",No);Ge.define("remove_button",Co);Ge.define("restore_on_backspace",Do);Ge.define("virtual_scroll",Po);async function Lo(n){if(!await H.scene.isReady())return;const i=(await H.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of n){const u=r.metadata[`${S.EXTENSIONID}/metadata_ghosts`];if(u?.length>0){o=!0;const v=u.map(b=>b.id);for(const b of u){const P=b.metadata[`${S.EXTENSIONID}/viewers`];P&&(P.includes(U.userId)?await H.scene.local.addItems([b]):i.includes(b.id)&&await H.scene.local.deleteItems([b.id]))}const E=i.filter(b=>!v.includes(b));E?.length>0&&await H.scene.local.deleteItems(E)}}o||await H.scene.local.deleteItems(i)}function $o(){const n=document.querySelectorAll(".tSelects");for(const e of n)if(e&&e.tomselect){const t=e.tomselect,i=[];for(const o of U.players)i.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(i),i.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function Fo(){H.scene.local.onChange(async n=>{const e=n.filter(i=>i.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${S.EXTENSIONID}/metadata_ghosts`]=e,await H.player.setMetadata(t)}),await H.contextMenu.create({id:`${S.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(n){document.getElementById("spectreWarning").style.display="none";for(const e of n.items){const t=e,i=t.text?.plainText||t.name;await H.scene.items.deleteItems([t.id]),await H.scene.local.addItems([t]),U.ghosts.push(t);const o=document.getElementById("ghostList"),r=document.createElement("tr");r.id=`tr-${t.id}`,r.className="ghost-table-entry",r.innerHTML=`<td class="token-name">${i}</td>
<td><select id="select-${t.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${t.id}" value="Delete"/></td>`,o.appendChild(r);const u=document.getElementById(`select-${t.id}`);for(const b of U.players){const P=document.createElement("option");P.value=b.id,P.text=b.name,u.appendChild(P)}const v={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:U.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(b,P){const D=P.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await H.scene.local.updateItems([D],V=>{const Z=V[0].metadata[`${S.EXTENSIONID}/viewers`],k=Z.findIndex(q=>q==b);Z.splice(k,1),V[0].metadata[`${S.EXTENSIONID}/viewers`]=Z})},onItemAdd:async function(b,P){const D=P.parentElement.parentElement.parentElement.parentElement.id.slice(3);await H.scene.local.updateItems([D],V=>{const Z=V[0].metadata[`${S.EXTENSIONID}/viewers`];Z?(Z.push(b),V[0].metadata[`${S.EXTENSIONID}/viewers`]=Z):V[0].metadata[`${S.EXTENSIONID}/viewers`]=[b]})}};new Ge(`#select-${t.id}`,v);const E=document.getElementById(`deleteGhost-${t.id}`);E.onclick=async()=>{const b=U.ghosts.findIndex(P=>P.id===t.id);U.ghosts.splice(b,1),r.remove(),await H.scene.local.updateItems([t.id],P=>{P[0].metadata[`${S.EXTENSIONID}/viewers`]=[]}),await H.scene.local.deleteItems([t.id])}}}})}async function Ei(n){const e=await H.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=n.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,n.appendChild(r)),t[e[o].id]=e[o].name}let i=n.querySelectorAll("option");for(let o=0;o<i.length;o++)t[i[o].value]===void 0&&n.removeChild(i[o])}async function Ro(n,e,t,i,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=U.gridDpi/t,u,v=[];if(v[0]=0,v[1]=0,i!==""){let E=await H.scene.items.getItems([i]);if(E.length>0)u=E[0],t===0&&(t=u.grid.dpi),r=U.gridDpi/t,v[0]=u.position.x-u.grid.offset.x*r,v[1]=u.position.y-u.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}n==="foundry"?Mo(e,r,v,o):n==="uvtt"&&Bo(e,r,v,o)}function Bo(n,e,t,i){if(!n.line_of_sight||n.line_of_sight.length===0){i.innerText="No walls / los found";return}const o=[];let r=0,u=72;if(n.portals&&n.portals.length)for(let E=0;E<n.portals.length;E++){let b=n.portals[E].bounds;n.line_of_sight.push(b)}for(var v=0;v<n.line_of_sight.length;v++){let E=n.line_of_sight[v][0].x*u,b=n.line_of_sight[v][0].y*u,P=n.line_of_sight[v][1].x*u,D=n.line_of_sight[v][1].y*u;const V=nn().tension(0).points([{x:E*e+t[0],y:b*e+t[1]},{x:P*e+t[0],y:D*e+t[1]}]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();V.visible=!1,V.metadata[`${S.EXTENSIONID}/isVisionLine`]=!0,o.push(V),o.length>50&&(r+=o.length,H.scene.items.addItems(o),o.length=0)}o.length>0&&(r+=o.length,H.scene.items.addItems(o)),i.innerText="Finished importing "+r+" walls!"}function Mo(n,e,t,i){if(!n.walls||n.walls.length===0){i.innerText="No walls found";return}const o=[];let r=0;for(var u=0;u<n.walls.length;u++){const v=nn().tension(0).points([{x:n.walls[u].c[0]*e+t[0],y:n.walls[u].c[1]*e+t[1]},{x:n.walls[u].c[2]*e+t[0],y:n.walls[u].c[3]*e+t[1]}]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();v.visible=!1,v.metadata[`${S.EXTENSIONID}/isVisionLine`]=!0,o.push(v),o.length>50&&(r+=o.length,H.scene.items.addItems(o),o.length=0)}o.length>0&&(r+=o.length,H.scene.items.addItems(o)),i.innerText="Finished importing "+r+" walls!"}var rt=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(n,e,t,i){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},u,v,E,b,P,D,V,Z,k,q,T,L,A,j,X,J,I={},g={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return i},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},f={},y="",d={},O=!1;function N(w){if(typeof w=="object"){var R=function(){switch(G){case"el":we(w.el),w.wrap!==!1&&ye(w.el);break;case"parent":u=e.querySelector(w.parent),u&&(u.appendChild(v),g.parent=w.parent,u===e.body&&(u=i));break;case"themeMode":g.themeMode=w.themeMode,w.themeMode==="auto"&&n.matchMedia&&n.matchMedia("(prefers-color-scheme: dark)").matches&&(g.themeMode="dark");case"theme":w.theme&&(g.theme=w.theme),v.className="clr-picker clr-"+g.theme+" clr-"+g.themeMode,g.inline&&be();break;case"rtl":g.rtl=!!w.rtl,e.querySelectorAll(".clr-field").forEach(function(Re){return Re.classList.toggle("clr-rtl",g.rtl)});break;case"margin":w.margin*=1,g.margin=isNaN(w.margin)?g.margin:w.margin;break;case"wrap":w.el&&w.wrap&&ye(w.el);break;case"formatToggle":g.formatToggle=!!w.formatToggle,fe("clr-format").style.display=g.formatToggle?"block":"none",g.formatToggle&&(g.format="auto");break;case"swatches":if(Array.isArray(w.swatches)){var le=[];w.swatches.forEach(function(Re,ve){le.push('<button type="button" id="clr-swatch-'+ve+'" aria-labelledby="clr-swatch-label clr-swatch-'+ve+'" style="color: '+Re+';">'+Re+"</button>")}),fe("clr-swatches").innerHTML=le.length?"<div>"+le.join("")+"</div>":"",g.swatches=w.swatches.slice()}break;case"swatchesOnly":g.swatchesOnly=!!w.swatchesOnly,v.setAttribute("data-minimal",g.swatchesOnly);break;case"alpha":g.alpha=!!w.alpha,v.setAttribute("data-alpha",g.alpha);break;case"inline":if(g.inline=!!w.inline,v.setAttribute("data-inline",g.inline),g.inline){var he=w.defaultColor||g.defaultColor;j=qe(he),be(),De(he)}break;case"clearButton":typeof w.clearButton=="object"&&(w.clearButton.label&&(g.clearLabel=w.clearButton.label,V.innerHTML=g.clearLabel),w.clearButton=w.clearButton.show),g.clearButton=!!w.clearButton,V.style.display=g.clearButton?"block":"none";break;case"clearLabel":g.clearLabel=w.clearLabel,V.innerHTML=g.clearLabel;break;case"closeButton":g.closeButton=!!w.closeButton,g.closeButton?v.insertBefore(Z,P):P.appendChild(Z);break;case"closeLabel":g.closeLabel=w.closeLabel,Z.innerHTML=g.closeLabel;break;case"a11y":var de=w.a11y,xe=!1;if(typeof de=="object")for(var ge in de)de[ge]&&g.a11y[ge]&&(g.a11y[ge]=de[ge],xe=!0);if(xe){var Fe=fe("clr-open-label"),Ie=fe("clr-swatch-label");Fe.innerHTML=g.a11y.open,Ie.innerHTML=g.a11y.swatch,Z.setAttribute("aria-label",g.a11y.close),V.setAttribute("aria-label",g.a11y.clear),k.setAttribute("aria-label",g.a11y.hueSlider),T.setAttribute("aria-label",g.a11y.alphaSlider),D.setAttribute("aria-label",g.a11y.input),E.setAttribute("aria-label",g.a11y.instruction)}break;default:g[G]=w[G]}};for(var G in w)R()}}function ue(w,R){typeof w=="string"&&typeof R=="object"&&(f[w]=R,O=!0)}function se(w){delete f[w],Object.keys(f).length===0&&(O=!1,w===y&&te())}function ce(w){if(O){var R=["el","wrap","rtl","inline","defaultColor","a11y"],G=function(){var de=f[ne];if(w.matches(ne)){y=ne,d={},R.forEach(function(ge){return delete de[ge]});for(var xe in de)d[xe]=Array.isArray(g[xe])?g[xe].slice():g[xe];return N(de),"break"}};for(var ne in f){var le=G();if(le==="break")break}}}function te(){Object.keys(d).length>0&&(N(d),y="",d={})}function we(w){pe(e,"click",w,function(R){g.inline||(ce(R.target),A=R.target,X=A.value,j=qe(X),v.classList.add("clr-open"),be(),De(X),(g.focusInput||g.selectInput)&&(D.focus({preventScroll:!0}),D.setSelectionRange(A.selectionStart,A.selectionEnd)),g.selectInput&&D.select(),(J||g.swatchesOnly)&&Oe().shift().focus(),A.dispatchEvent(new Event("open",{bubbles:!0})))}),pe(e,"input",w,function(R){var G=R.target.parentNode;G.classList.contains("clr-field")&&(G.style.color=R.target.value)})}function be(){if(!(!v||!A&&!g.inline)){var w=u,R=n.scrollY,G=v.offsetWidth,ne=v.offsetHeight,le={left:!1,top:!1},he,de,xe,ge={x:0,y:0};if(w&&(he=n.getComputedStyle(w),de=parseFloat(he.marginTop),xe=parseFloat(he.borderTopWidth),ge=w.getBoundingClientRect(),ge.y+=xe+R),!g.inline){var Fe=A.getBoundingClientRect(),Ie=Fe.x,Re=R+Fe.y+Fe.height+g.margin;w?(Ie-=ge.x,Re-=ge.y,Ie+G>w.clientWidth&&(Ie+=Fe.width-G,le.left=!0),Re+ne>w.clientHeight-de&&ne+g.margin<=Fe.top-(ge.y-R)&&(Re-=Fe.height+ne+g.margin*2,le.top=!0),Re+=w.scrollTop):(Ie+G>e.documentElement.clientWidth&&(Ie+=Fe.width-G,le.left=!0),Re+ne-R>e.documentElement.clientHeight&&ne+g.margin<=Fe.top&&(Re=R+Fe.y-ne-g.margin,le.top=!0)),v.classList.toggle("clr-left",le.left),v.classList.toggle("clr-top",le.top),v.style.left=Ie+"px",v.style.top=Re+"px",ge.x+=v.offsetLeft,ge.y+=v.offsetTop}I={width:E.offsetWidth,height:E.offsetHeight,x:E.offsetLeft+ge.x,y:E.offsetTop+ge.y}}}function ye(w){e.querySelectorAll(w).forEach(function(R){var G=R.parentNode;if(!G.classList.contains("clr-field")){var ne=e.createElement("div"),le="clr-field";(g.rtl||R.classList.contains("clr-rtl"))&&(le+=" clr-rtl"),ne.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',G.insertBefore(ne,R),ne.setAttribute("class",le),ne.style.color=R.value,ne.appendChild(R)}})}function oe(w){if(A&&!g.inline){var R=A;w&&(A=i,X!==R.value&&(R.value=X,R.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){X!==R.value&&R.dispatchEvent(new Event("change",{bubbles:!0}))}),v.classList.remove("clr-open"),O&&te(),R.dispatchEvent(new Event("close",{bubbles:!0})),g.focusInput&&R.focus({preventScroll:!0}),A=i}}function De(w){var R=me(w),G=ie(R);et(G.s,G.v),h(R,G),k.value=G.h,v.style.color="hsl("+G.h+", 100%, 50%)",q.style.left=G.h/360*100+"%",b.style.left=I.width*G.s/100+"px",b.style.top=I.height-I.height*G.v/100+"px",T.value=G.a*100,L.style.left=G.a*100+"%"}function qe(w){var R=w.substring(0,3).toLowerCase();return R==="rgb"||R==="hsl"?R:"hex"}function ke(w){w=w!==i?w:D.value,A&&(A.value=w,A.dispatchEvent(new Event("input",{bubbles:!0}))),g.onChange&&g.onChange.call(n,w,A),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:w,currentEl:A}}))}function Be(w,R){var G={h:k.value*1,s:w/I.width*100,v:100-R/I.height*100,a:T.value/100},ne=F(G);et(G.s,G.v),h(ne,G),ke()}function et(w,R){var G=g.a11y.marker;w=w.toFixed(1)*1,R=R.toFixed(1)*1,G=G.replace("{s}",w),G=G.replace("{v}",R),b.setAttribute("aria-label",G)}function nt(w){return{pageX:w.changedTouches?w.changedTouches[0].pageX:w.pageX,pageY:w.changedTouches?w.changedTouches[0].pageY:w.pageY}}function Y(w){var R=nt(w),G=R.pageX-I.x,ne=R.pageY-I.y;u&&(ne+=u.scrollTop),l(G,ne),w.preventDefault(),w.stopPropagation()}function C(w,R){var G=b.style.left.replace("px","")*1+w,ne=b.style.top.replace("px","")*1+R;l(G,ne)}function l(w,R){w=w<0?0:w>I.width?I.width:w,R=R<0?0:R>I.height?I.height:R,b.style.left=w+"px",b.style.top=R+"px",Be(w,R),b.focus()}function h(w,R){w===void 0&&(w={}),R===void 0&&(R={});var G=g.format;for(var ne in w)r[ne]=w[ne];for(var le in R)r[le]=R[le];var he=ae(r),de=he.substring(0,7);switch(b.style.color=de,L.parentNode.style.color=de,L.style.color=he,P.style.color=he,E.style.display="none",E.offsetHeight,E.style.display="",L.nextElementSibling.style.display="none",L.nextElementSibling.offsetHeight,L.nextElementSibling.style.display="",G==="mixed"?G=r.a===1?"hex":"rgb":G==="auto"&&(G=j),G){case"hex":D.value=he;break;case"rgb":D.value=Se(r);break;case"hsl":D.value=Ae(W(r));break}e.querySelector('.clr-format [value="'+G+'"]').checked=!0}function m(){var w=k.value*1,R=b.style.left.replace("px","")*1,G=b.style.top.replace("px","")*1;v.style.color="hsl("+w+", 100%, 50%)",q.style.left=w/360*100+"%",Be(R,G)}function M(){var w=T.value/100;L.style.left=w*100+"%",h({a:w}),ke()}function F(w){var R=w.s/100,G=w.v/100,ne=R*G,le=w.h/60,he=ne*(1-t.abs(le%2-1)),de=G-ne;ne=ne+de,he=he+de;var xe=t.floor(le)%6,ge=[ne,he,de,de,he,ne][xe],Fe=[he,ne,ne,he,de,de][xe],Ie=[de,de,he,ne,ne,he][xe];return{r:t.round(ge*255),g:t.round(Fe*255),b:t.round(Ie*255),a:w.a}}function W(w){var R=w.v/100,G=R*(1-w.s/100/2),ne;return G>0&&G<1&&(ne=t.round((R-G)/t.min(G,1-G)*100)),{h:w.h,s:ne||0,l:t.round(G*100),a:w.a}}function ie(w){var R=w.r/255,G=w.g/255,ne=w.b/255,le=t.max(R,G,ne),he=t.min(R,G,ne),de=le-he,xe=le,ge=0,Fe=0;return de&&(le===R&&(ge=(G-ne)/de),le===G&&(ge=2+(ne-R)/de),le===ne&&(ge=4+(R-G)/de),le&&(Fe=de/le)),ge=t.floor(ge*60),{h:ge<0?ge+360:ge,s:t.round(Fe*100),v:t.round(xe*100),a:w.a}}function me(w){var R=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,G,ne;return o.fillStyle="#000",o.fillStyle=w,G=R.exec(o.fillStyle),G?(ne={r:G[3]*1,g:G[4]*1,b:G[5]*1,a:G[6]*1},ne.a=+ne.a.toFixed(2)):(G=o.fillStyle.replace("#","").match(/.{2}/g).map(function(le){return parseInt(le,16)}),ne={r:G[0],g:G[1],b:G[2],a:1}),ne}function ae(w){var R=w.r.toString(16),G=w.g.toString(16),ne=w.b.toString(16),le="";if(w.r<16&&(R="0"+R),w.g<16&&(G="0"+G),w.b<16&&(ne="0"+ne),g.alpha&&(w.a<1||g.forceAlpha)){var he=w.a*255|0;le=he.toString(16),he<16&&(le="0"+le)}return"#"+R+G+ne+le}function Se(w){return!g.alpha||w.a===1&&!g.forceAlpha?"rgb("+w.r+", "+w.g+", "+w.b+")":"rgba("+w.r+", "+w.g+", "+w.b+", "+w.a+")"}function Ae(w){return!g.alpha||w.a===1&&!g.forceAlpha?"hsl("+w.h+", "+w.s+"%, "+w.l+"%)":"hsla("+w.h+", "+w.s+"%, "+w.l+"%, "+w.a+")"}function Ce(){e.getElementById("clr-picker")||(u=i,v=e.createElement("div"),v.setAttribute("id","clr-picker"),v.className="clr-picker",v.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+g.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+g.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+g.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+g.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+g.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+g.a11y.clear+'">'+g.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+g.a11y.close+'">'+g.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+g.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+g.a11y.swatch+"</span>"),e.body.appendChild(v),E=fe("clr-color-area"),b=fe("clr-color-marker"),V=fe("clr-clear"),Z=fe("clr-close"),P=fe("clr-color-preview"),D=fe("clr-color-value"),k=fe("clr-hue-slider"),q=fe("clr-hue-marker"),T=fe("clr-alpha-slider"),L=fe("clr-alpha-marker"),we(g.el),ye(g.el),pe(v,"mousedown",function(w){v.classList.remove("clr-keyboard-nav"),w.stopPropagation()}),pe(E,"mousedown",function(w){pe(e,"mousemove",Y)}),pe(E,"touchstart",function(w){e.addEventListener("touchmove",Y,{passive:!1})}),pe(b,"mousedown",function(w){pe(e,"mousemove",Y)}),pe(b,"touchstart",function(w){e.addEventListener("touchmove",Y,{passive:!1})}),pe(D,"change",function(w){var R=D.value;if(A||g.inline){var G=R===""?R:De(R);ke(G)}}),pe(V,"click",function(w){ke(""),oe()}),pe(Z,"click",function(w){ke(),oe()}),pe(fe("clr-format"),"click",".clr-format input",function(w){j=w.target.value,h(),ke()}),pe(v,"click",".clr-swatches button",function(w){De(w.target.textContent),ke(),g.swatchesOnly&&oe()}),pe(e,"mouseup",function(w){e.removeEventListener("mousemove",Y)}),pe(e,"touchend",function(w){e.removeEventListener("touchmove",Y)}),pe(e,"mousedown",function(w){J=!1,v.classList.remove("clr-keyboard-nav"),oe()}),pe(e,"keydown",function(w){var R=w.key,G=w.target,ne=w.shiftKey,le=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(R==="Escape"?oe(!0):le.includes(R)&&(J=!0,v.classList.add("clr-keyboard-nav")),R==="Tab"&&G.matches(".clr-picker *")){var he=Oe(),de=he.shift(),xe=he.pop();ne&&G===de?(xe.focus(),w.preventDefault()):!ne&&G===xe&&(de.focus(),w.preventDefault())}}),pe(e,"click",".clr-field button",function(w){O&&te(),w.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),pe(b,"keydown",function(w){var R={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(R).includes(w.key)&&(C.apply(void 0,R[w.key]),w.preventDefault())}),pe(E,"click",Y),pe(k,"input",m),pe(T,"input",M))}function Oe(){var w=Array.from(v.querySelectorAll("input, button")),R=w.filter(function(G){return!!G.offsetWidth});return R}function fe(w){return e.getElementById(w)}function pe(w,R,G,ne){var le=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof G=="string"?w.addEventListener(R,function(he){le.call(he.target,G)&&ne.call(he.target,he)}):(ne=G,w.addEventListener(R,ne))}function $e(w,R){R=R!==i?R:[],e.readyState!=="loading"?w.apply(void 0,R):e.addEventListener("DOMContentLoaded",function(){w.apply(void 0,R)})}NodeList!==i&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function Ve(w,R){A=R,X=A.value,ce(R),j=qe(w),be(),De(w),ke(),X!==w&&A.dispatchEvent(new Event("change",{bubbles:!0}))}var Ke=function(){var w={init:Ce,set:N,wrap:ye,close:oe,setInstance:ue,setColor:Ve,removeInstance:se,updatePosition:be};function R(le){$e(function(){le&&(typeof le=="string"?we(le):N(le))})}var G=function(he){R[he]=function(){for(var de=arguments.length,xe=new Array(de),ge=0;ge<de;ge++)xe[ge]=arguments[ge];$e(w[he],xe)}};for(var ne in w)G(ne);return $e(function(){n.addEventListener("resize",function(le){R.updatePosition()}),n.addEventListener("scroll",function(le){R.updatePosition()})}),R}();return Ke.coloris=Ke,Ke}(window,document,Math)}();rt.coloris;rt.init;rt.set;rt.wrap;rt.close;rt.setInstance;rt.removeInstance;rt.updatePosition;const Vn=document.getElementById("app");Vn.innerHTML=`
<div>
    <div>
        <div class="title">
            Smoke! ˣ Dynamic Fog
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings">&#x2699;</div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New">&#x1F6C8;</div>
        </div>
        <br>
        <hr>
        <div id="settings-ui" class="grid-settings" style="display:none;">
            <div class="visionTitle grid-3">Settings</div>

            <div><label for="autodetect_checkbox">Autodetect Maps</label></div>
            <div style="grid-column: span 2;"><input type="checkbox" id="autodetect_checkbox" checked></div>

            <div id="boundry_options" class="grid-3" style="display:none;">
                <span id="map_size">Boundary Size: 
                    <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
                    <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
                    <input type="button" id="mapSubmit" value="Update"/>
                    &nbsp;&nbsp;&nbsp;
                </span>
            </div>

            <div><label for="snap_checkbox">Grid Snap</label></div>
            <div class="grid-2"><input type="checkbox" id="snap_checkbox"></div>

            <div><label for="persistence_checkbox">Persistence</label></div>
            <div><input type="checkbox" id="persistence_checkbox"></div>
            <div><input type="button" id="persistence_reset" value="Reset"></div>

            <div><label for="fow_checkbox">Trailing Fog</label></div>
            <div><input type="checkbox" id="fow_checkbox"></div>
            <div><input type="text" style="width: 90px;" maxlength="9" id="fow_color" value="#00000088"></div>

            <div>Convert from <i>Dynamic Fog</i></div>
            <div></div>
            <div><input type="button" id="convert_button" value="Convert"></div>

            <div></div>
            <div></div>
            <div><input type="button" id="debug_button" value="Enable Debugging"></div>

            <div class="visionTitle grid-3" style="margin-top: 16px;">Import</div>

            <div class="grid-3" style="margin-bottom: 16px;">Import JSON files with fog data from<br><a href="https://www.dungeonalchemist.com/" target="_blank">Dungeon Alchemist</a> and other tools.</div>

            <div>File Format</div>
            <div></div>
            <div><select id="import_format"><option value="foundry">Foundry</option><option value="uvtt">Universal VTT</option></select></div>

            <div><label for="dpi_autodetect">DPI Autodetect</label></div>
            <div><input type="checkbox" id="dpi_autodetect" checked></div>
            <div><input id="import_dpi" disabled type="text" value="150" size="1" maxlength="4"></div>

            <div style="margin-bottom: 8px;">Map Alignment</div>
            <div></div>
            <div><select id="map_align" style="width: 120px;"><option selected>Loading..</option></select></div>

            <div><input id="import_file" style="width: 190px;" type="file"></div>
            <div></div>
            <div><input style="padding: 6px" type="button" id="import_button" value="Import" disabled></div>

            <div id="import_errors" class="grid-3"></div>
        </div>

        <div id="main-ui" class="grid-main">
            <div class="visionTitle grid-3">Vision Radius</div>
            <div class="grid-3"><i>GM-owned tokens give universal vision.</i></div>
            <p class="grid-3" id="no_tokens_message">Enable vision on your character tokens.</p>
            <div id="token_list_div" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <table style="margin: auto; padding: 0;">
                <tbody id="token_list"></tbody>
                </table>
            </div>
            <div class="visionTitle grid-3">Spectres!</div>
            <div id="ghostContainer" class="grid-3">
                <div id="spectreWarning">
                    <i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i>
                    <br>
                    <br>
                    Enable vision here after it's been Spectred.
                </div>
                <table style="margin: auto; padding: 0; width: 100%">
                <colgroup>
                    <col style="width: 50%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                </colgroup>
                <tbody id="ghostList">
                </tbody></table>
            </div> 
        </div>

        <div id="debug_div" style="display: none;" class="grid-debug">
            <div class="visionTitle grid-2" style="text-align: center; margin-top: 16px">Performance Info</div>
            <div>Compute time</div><div id="compute_time">N/A</div>
            <div>Communication time</div><div id="communication_time">N/A</div>
            <div>Cache hits/misses</div><div><span id="cache_hits">?</span>/<span id=cache_misses>?</span></div>
            <div>Vision Lines</div><div><span id="line_counter">?</span> (<span id="skip_counter">?</span> skipped)</div>
            <div>Fog Objects</div><div id="item_counter">?</div>
        </div>
    </div>
</div>
`;Vn.parentElement.style.placeItems="start";const _i=document.getElementById("main-ui"),Cn=document.getElementById("settings-ui"),Gi=document.getElementById("vision_checkbox"),Si=document.getElementById("snap_checkbox"),Vo=document.getElementById("token_list"),jo=document.getElementById("no_tokens_message"),Xo=document.getElementById("mapHeight"),Uo=document.getElementById("mapWidth"),Ho=document.getElementById("mapSubmit"),qi=document.getElementById("persistence_checkbox"),kt=document.getElementById("autodetect_checkbox"),Ki=document.getElementById("fow_checkbox"),zi=document.getElementById("fow_color"),Wo=document.getElementById("persistence_reset"),Go=document.getElementById("convert_button"),qo=document.getElementById("settings_button"),Yi=document.getElementById("boundry_options"),Oi=document.getElementById("debug_div"),Ko=document.getElementById("debug_button"),Dn=document.getElementById("import_button"),zo=document.getElementById("import_file"),Rn=document.getElementById("map_align"),_t=document.getElementById("import_errors"),Yo=document.getElementById("dpi_autodetect"),Zo=document.getElementById("import_dpi"),Qo=document.getElementById("import_format");rt.init();async function Jo(){Gi.addEventListener("click",async e=>{if(!U.ready||!e.target){e.preventDefault();return}const t=e.target;await H.scene.setMetadata({[`${S.EXTENSIONID}/visionEnabled`]:t.checked})},!1),Si.checked=!0,Si.addEventListener("click",async e=>{if(!U.ready||!e.target){e.preventDefault();return}const t=e.target;U.snap=t.checked},!1),qo.addEventListener("click",async e=>{!e||!e.target||(Cn.style.display==="grid"?(Cn.style.display="none",_i.style.display="grid"):(Cn.style.display="grid",_i.style.display="none"))},!1),qi.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await H.scene.setMetadata({[`${S.EXTENSIONID}/persistenceEnabled`]:t.checked})},!1),kt.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;if(await H.scene.setMetadata({[`${S.EXTENSIONID}/autodetectEnabled`]:t.checked}),Yi.style.display=t.checked?"none":"",!t.checked){let i=Zi();i&&await H.scene.items.addItems([i])}},!1),Ki.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await H.scene.setMetadata({[`${S.EXTENSIONID}/fowEnabled`]:t.checked})},!1),Wo.addEventListener("click",async e=>{!e||!e.target||(H.scene.setMetadata({[`${S.EXTENSIONID}/forceReset`]:!0}),H.scene.setMetadata({[`${S.EXTENSIONID}/forceReset`]:void 0}))},!1),Ko.addEventListener("click",async e=>{!e||!e.target||(e.target,Oi.style.display=Oi.style.display=="none"?"grid":"none")},!1),zi.addEventListener("input",async e=>{if(!e||!e.target)return;const t=e.target;if(/#[a-f0-9]{8}/.test(t.value)){await H.scene.setMetadata({[`${S.EXTENSIONID}/fowColor`]:t.value});const o=await H.scene.local.getItems(Mt);await H.scene.local.deleteItems(o.map(r=>r.id))}},!1),Go.addEventListener("click",async e=>{if(!(!e||!e.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const t=await H.scene.getMetadata();console.log(t);for(const o in t)o.substring(0,o.indexOf("/"))==S.ARMINDOID&&H.scene.setMetadata({[`${o}`]:void 0});const i=await H.scene.items.getItems();console.log(i),await H.scene.items.updateItems(i,o=>{for(const r of o)r.metadata[`${S.ARMINDOID}/isVisionLine`]!==void 0&&(r.metadata[`${S.EXTENSIONID}/isVisionLine`]=r.metadata[`${S.ARMINDOID}/isVisionLine`],delete r.metadata[`${S.ARMINDOID}/isVisionLine`]),r.metadata[`${S.ARMINDOID}/disabled`]!==void 0&&(r.metadata[`${S.EXTENSIONID}/disabled`]=r.metadata[`${S.ARMINDOID}/disabled`],delete r.metadata[`${S.ARMINDOID}/disabled`])})}},!1);var n;zo.addEventListener("change",async e=>{if(Dn.disabled=!0,!e||!e.target)return;const t=e.target;if(!t.files)return;const i=t.files[0];if(i.type!=="text/javascript"&&i.type,i){var o=new FileReader;o.onload=function(r){if(!r||!r.target){_t.innerText="Invalid import event";return}const u=r.target;if(!u.result){_t.innerText="Unable to read imported file";return}const v=u.result;n=JSON.parse(v),n&&(n.walls&&n.walls.length||n.line_of_sight&&n.line_of_sight.length)?Dn.disabled=!1:_t.innerText="Imported file has no walls"},o.readAsText(i)}else _t.innerText="Failed to load file"}),Dn.addEventListener("click",async e=>{!e||!e.target||(e.target,Ro(Qo.value,n,Yo.checked?0:Number.parseInt(Zo.value),Rn.value,_t))},!1)}function Ht(n){const e=n.filter(yr);U.metadata&&(Gi.checked=U.metadata[`${S.EXTENSIONID}/visionEnabled`]==!0,kt.checked=U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]==!0,qi.checked=U.metadata[`${S.EXTENSIONID}/persistenceEnabled`]==!0,kt.checked=U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]==!0,Ki.checked=U.metadata[`${S.EXTENSIONID}/fowEnabled`]==!0,zi.value=U.metadata[`${S.EXTENSIONID}/fowColor`]?U.metadata[`${S.EXTENSIONID}/fowColor`]:"#00000088"),Yi.style.display=kt.checked?"none":"",jo.style.display=e.length>0?"none":"block";const t=document.getElementsByClassName("token-table-entry"),i=[];for(const o of t){const r=o.id.slice(3);e.find(u=>u.id===r)===void 0&&i.push(o)}for(const o of i)o.remove();for(const o of e){const r=document.getElementById(`tr-${o.id}`);if(r){const u=r.getElementsByClassName("token-name")[0],v=r.getElementsByClassName("token-vision-range")[0],E=r.getElementsByClassName("unlimited-vision")[0],b=r.getElementsByClassName("no-vision")[0];u&&(u.innerText=o.name),v&&!E.checked&&!b.checked&&(v.value=o.metadata[`${S.EXTENSIONID}/visionRange`]?o.metadata[`${S.EXTENSIONID}/visionRange`]:S.VISIONDEFAULT),E&&(E.checked=o.metadata[`${S.EXTENSIONID}/visionRange`]===0),b&&(b.checked=o.metadata[`${S.EXTENSIONID}/visionBlind`]),E.checked||b.checked?v.setAttribute("disabled","disabled"):v.removeAttribute("disabled")}else{const u=U.items.find(D=>D.id===o.id),v=document.createElement("tr");v.id=`tr-${u.id}`,v.className="token-table-entry",v.innerHTML=`<td class="token-name">${u.name}</td><td><input class="token-vision-range" type="number" value=${S.VISIONDEFAULT}><span class="unit">ft</span></td><td>&nbsp;&nbsp;&infin;&nbsp<input type="checkbox" class="unlimited-vision">&nbsp;None <input type="checkbox" class="no-vision"></td>`,Vo.appendChild(v);const E=v.getElementsByClassName("token-vision-range")[0],b=v.getElementsByClassName("unlimited-vision")[0],P=v.getElementsByClassName("no-vision")[0];E&&!b.checked&&!P.checked&&(E.value=o.metadata[`${S.EXTENSIONID}/visionRange`]?o.metadata[`${S.EXTENSIONID}/visionRange`]:S.VISIONDEFAULT),b&&(b.checked=o.metadata[`${S.EXTENSIONID}/visionRange`]===0),P&&(P.checked=o.metadata[`${S.EXTENSIONID}/visionBlind`]),b.checked||P.checked?E.setAttribute("disabled","disabled"):E.removeAttribute("disabled"),E.addEventListener("change",async D=>{if(!D||!D.target)return;const V=U.items.find(q=>q.id===o.id),Z=D.target,k=parseInt(Z.value);k<0&&(Z.value="0"),k>999&&(Z.value="999"),await H.scene.items.updateItems([V],q=>{q[0].metadata[`${S.EXTENSIONID}/visionRange`]=k})},!1),b.addEventListener("click",async D=>{if(!D||!D.target)return;const V=U.items.find(q=>q.id===o.id);let Z=0;D.target.checked?(E.setAttribute("disabled","disabled"),P.checked=!1):(Z=parseInt(E.value),E.removeAttribute("disabled")),await H.scene.items.updateItems([V],q=>{q[0].metadata[`${S.EXTENSIONID}/visionRange`]=Z})},!1),P.addEventListener("click",async D=>{if(!D||!D.target)return;const V=U.items.find(k=>k.id===o.id),Z=D.target;Z.checked?(E.setAttribute("disabled","disabled"),b.checked=!1):E.removeAttribute("disabled"),await H.scene.items.updateItems([V],k=>{k[0].metadata[`${S.EXTENSIONID}/visionBlind`]=Z.checked})},!1)}}}function Zi(){let n;return U.items.filter(Ai).length==0&&(n=vt().width(U.gridDpi*30).height(U.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),n.metadata[`${S.EXTENSIONID}/isBackgroundImage`]=!0,n.id=S.GRIDID,U.items.push(n)),n}async function ki(n){let e,t;[U.items,U.metadata,U.gridDpi,U.gridScale,e,t]=await Promise.all([H.scene.items.getItems(),H.scene.getMetadata(),H.scene.grid.getDpi(),H.scene.grid.getScale(),H.scene.fog.getFilled(),H.scene.fog.getColor()]),await H.scene.items.deleteItems(U.items.filter(Pn).map(r=>r.id)),U.snap=!0,U.gridScale=U.gridScale.parsed.multiplier,U.fog={filled:e,style:{color:t,strokeWidth:5}};let i;if(U.items.filter(gr).length==0){const r=U.items.filter(v=>v.layer=="MAP"&&v.type=="IMAGE"),u=r.map(v=>v.image.width*v.image.height/Math.pow(v.grid.dpi,2));i=r[u.indexOf(Math.max(...u))]}let o;if(U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]===void 0?(kt.checked=!0,await H.scene.setMetadata({[`${S.EXTENSIONID}/autodetectEnabled`]:!0})):U.metadata[`${S.EXTENSIONID}/autodetectEnabled`]===!1&&(o=Zi()),n=="GM"){o&&await H.scene.items.addItems([o]),Ho.onclick=async()=>{await H.scene.items.updateItems([S.GRIDID],u=>{for(const v of u){const E=v;E.width=U.gridDpi*+Uo.value,E.height=U.gridDpi*+Xo.value,E.scale={x:1,y:1}}})};const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await H.modal.open({id:S.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},Ht(U.items),rt({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),i!==void 0&&await H.scene.items.updateItems([i],u=>{u[0].metadata[`${S.EXTENSIONID}/isBackgroundImage`]=!0})}}H.onReady(async()=>{await H.player.getRole().then(async n=>{n=="GM"?(U.role="GM",await Jo(),await Lr(),await $r(),await Fr(),await Fo()):(Vn.innerHTML="Configuration is GM-Access only.",await H.action.setHeight(90),await H.action.setWidth(320)),H.scene.fog.onChange(e=>{U.fog=e}),H.scene.items.onChange(async e=>{const t=e;U.items=t,U.ready&&(n=="GM"&&(Ht(t),await Ei(Rn)),await gt())}),U.userId=await H.player.getId(),U.players=await H.party.getPlayers(),H.party.onChange(async e=>{U.players=e,n==="PLAYER"?await Lo(e):$o()}),H.scene.grid.onChange(async e=>{U.gridDpi=e.dpi,U.gridScale=parseInt(e.scale),U.ready&&await gt()}),H.scene.onMetadataChange(async e=>{if(e[`${S.EXTENSIONID}/forceReset`]===!0){const t=await H.scene.local.getItems(Vt);H.scene.local.deleteItems(t.map(i=>i.id)),gt(!0)}else U.metadata=e,U.ready&&await gt()}),H.scene.onReadyChange(async e=>{U.ready=e,e?(ki(n),await gt()):n=="GM"&&Ht([])}),U.ready=await H.scene.isReady(),U.ready?(ki(n),await gt(),n=="GM"&&await Ei(Rn)):n=="GM"&&Ht([])})});
