import{C as _,b as qt,a as sn,O as j,c as yt,d as En}from"./constants-8a17c75a.js";var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ai(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function vr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),t}function yr(i){return i*(Math.PI/180)}function wr(i){return i*(180/Math.PI)}class qe{static inverse(e){const[t,n,o,r,c,y,E,v,x]=e,D=t*(c*x-v*y)-n*(r*x-y*E)+o*(r*v-c*E);if(Math.abs(D)<1e-14)return e;const F=1/D,K=(c*x-v*y)*F,k=(o*v-n*x)*F,R=(n*y-o*c)*F,T=(y*E-r*x)*F,L=(t*x-o*E)*F,A=(r*o-t*y)*F,N=(r*v-E*c)*F,B=(E*n-t*v)*F,J=(t*c-r*n)*F;return[K,k,R,T,L,A,N,B,J]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=yr(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=qe.fromPosition(e.position),n=qe.fromScale(e.scale),o=qe.fromRotation(e.rotation);return qe.multiply(qe.multiply(t,o),n)}static decompose(e){const[t,n,o,r,c,y]=e,E=t*c-r*n,v={position:{x:o,y},rotation:0,scale:{x:1,y:1}};if(t!=0||r!=0){var x=Math.sqrt(t*t+r*r);v.rotation=r>0?Math.acos(t/x):-Math.acos(t/x),v.scale={x,y:E/x}}else if(n!=0||c!=0){var D=Math.sqrt(n*n+c*c);v.rotation=Math.PI/2-(c>0?Math.acos(-n/D):-Math.acos(n/D)),v.scale={x:E/D,y:D}}return v.rotation=wr(v.rotation),v}}class br{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const X=new br;function Ir(i){return i.layer=="MAP"&&(i.metadata[`${_.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${_.ARMINDOID}/isBackgroundImage`])}function Ot(i){return i.metadata[`${_.EXTENSIONID}/isVisionFog`]||i.metadata[`${_.ARMINDOID}/isVisionFog`]}function Er(i){return i.metadata[`${_.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${_.ARMINDOID}/isIndicatorRing`]}function _r(i){return i.metadata[`${_.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${_.EXTENSIONID}/disabled`]||i.metadata[`${_.ARMINDOID}/isVisionLine`]&&!i.metadata[`${_.ARMINDOID}/disabled`]}function Ni(i){return i.layer=="CHARACTER"&&(i.metadata[`${_.EXTENSIONID}/hasVision`]||i.metadata[`${_.ARMINDOID}/hasVision`])}function Sr(i){return i.layer=="CHARACTER"&&(i.metadata[`${_.EXTENSIONID}/hasVision`]||i.metadata[`${_.ARMINDOID}/hasVision`])&&!i.metadata[`${_.EXTENSIONID}/visionBlind`]}function Or(i){return i.layer=="CHARACTER"&&i.createdUserId==X.userId&&(i.metadata[`${_.EXTENSIONID}/hasVision`]||i.metadata[`${_.ARMINDOID}/hasVision`])&&!i.metadata[`${_.EXTENSIONID}/visionBlind`]}function xi(i){return i.layer=="DRAWING"&&(i.metadata[`${_.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${_.ARMINDOID}/isBackgroundImage`])}function jt(i){return i.metadata[`${_.EXTENSIONID}/isTrailingFog`]}function Rn(i){return i.metadata[`${_.EXTENSIONID}/isTrailingFog`]||i.metadata[`${_.EXTENSIONID}/isVisionFog`]||i.metadata[`${_.ARMINDOID}/isVisionFog`]||i.metadata[`${_.EXTENSIONID}/isIndicatorRing`]}function Xt(i){return i.metadata[`${_.EXTENSIONID}/visionTorch`]}function Ci(i){return i.layer=="CHARACTER"&&!Ni(i)&&i.metadata[`${_.EXTENSIONID}/hasAutohide`]===!0}var Pi={exports:{}};const kr={},Tr=Object.freeze(Object.defineProperty({__proto__:null,default:kr},Symbol.toStringTag,{value:"Module"})),Sn=vr(Tr);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var c=Object.assign,y,E;r.ready=new Promise(function(a,s){y=a,E=s}),function(a){var s={};a.loadCmdsTypedArray=function(V){for(var G=0,Z=0;Z<V.length;Z++)G+=V[Z].length;if(s[G])var Q=s[G];else Q=new Float32Array(G),s[G]=Q;var ie=0;for(Z=0;Z<V.length;Z++)for(var Ee=0;Ee<V[Z].length;Ee++){var Ne=V[Z][Ee];typeof Ne=="string"&&(Ne=a.SkBits2FloatUnsigned(parseInt(Ne))),Q[ie]=Ne,ie++}return V=a._malloc(Q.length*Q.BYTES_PER_ELEMENT),a.HEAPF32.set(Q,V/Q.BYTES_PER_ELEMENT),[V,G]},a.FromCmds=function(V){V=a.loadCmdsTypedArray(V);var G=a._FromCmds(V[0],V[1]);return a._free(V[0]),G};var u,h,S,P,z;a.cubicYFromX=function(V,G,Z,Q,ie){return u&&h===V&&S===G&&P===Z&&z===Q||(u&&u.delete(),u=new a._SkCubicMap([V,G],[Z,Q]),h=V,S=G,P=Z,z=Q),u.computeYFromX(ie)},a.cubicPtFromT=function(V,G,Z,Q,ie){return u&&h===V&&S===G&&P===Z&&z===Q||(u&&u.delete(),u=new a._SkCubicMap([V,G],[Z,Q]),h=V,S=G,P=Z,z=Q),u.computePtFromT(ie)}}(r),function(a){a.onRuntimeInitialized=function(){a.SkPath.prototype.addPath=function(){var s=arguments[0];if(arguments.length===1)this._addPath(s,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var u=arguments[1];this._addPath(s,u.a,u.c,u.e,u.b,u.d,u.f,0,0,1)}else if(arguments.length===7)u=arguments,this._addPath(s,u[1],u[3],u[5],u[2],u[4],u[6],0,0,1);else if(arguments.length===10)u=arguments,this._addPath(s,u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},a.SkPath.prototype.arc=function(s,u,h,S,P,z){return this._arc(s,u,h,S,P,!!z),this},a.SkPath.prototype.arcTo=function(s,u,h,S,P){return this._arcTo(s,u,h,S,P),this},a.SkPath.prototype.bezierCurveTo=function(s,u,h,S,P,z){return this._cubicTo(s,u,h,S,P,z),this},a.SkPath.prototype.close=function(){return this._close(),this},a.SkPath.prototype.closePath=function(){return this._close(),this},a.SkPath.prototype.conicTo=function(s,u,h,S,P){return this._conicTo(s,u,h,S,P),this},a.SkPath.prototype.cubicTo=function(s,u,h,S,P,z){return this._cubicTo(s,u,h,S,P,z),this},a.SkPath.prototype.dash=function(s,u,h){return this._dash(s,u,h)?this:null},a.SkPath.prototype.ellipse=function(s,u,h,S,P,z,V,G){return this._ellipse(s,u,h,S,P,z,V,!!G),this},a.SkPath.prototype.lineTo=function(s,u){return this._lineTo(s,u),this},a.SkPath.prototype.moveTo=function(s,u){return this._moveTo(s,u),this},a.SkPath.prototype.op=function(s,u){return this._op(s,u)?this:null},a.SkPath.prototype.quadraticCurveTo=function(s,u,h,S){return this._quadTo(s,u,h,S),this},a.SkPath.prototype.quadTo=function(s,u,h,S){return this._quadTo(s,u,h,S),this},a.SkPath.prototype.rect=function(s,u,h,S){return this._rect(s,u,h,S),this},a.SkPath.prototype.simplify=function(){return this._simplify()?this:null},a.SkPath.prototype.stroke=function(s){return s=s||{},s.width=s.width||1,s.miter_limit=s.miter_limit||4,s.cap=s.cap||a.StrokeCap.BUTT,s.join=s.join||a.StrokeJoin.MITER,this._stroke(s)?this:null},a.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var s=arguments;this._transform(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7],s[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},a.SkPath.prototype.trim=function(s,u,h){return this._trim(s,u,!!h)?this:null}}}(r);var v=c({},r),x=typeof window=="object",D=typeof importScripts=="function",F="",K,k,R,T,L,A;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(F=D?Sn.dirname(F)+"/":__dirname+"/",A=()=>{L||(T=Sn,L=Sn)},K=function(a,s){return A(),a=L.normalize(a),T.readFileSync(a,s?null:"utf8")},R=a=>(a=K(a,!0),a.buffer||(a=new Uint8Array(a)),a),k=(a,s,u)=>{A(),a=L.normalize(a),T.readFile(a,function(h,S){h?u(h):s(S.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(a){throw a}),process.on("unhandledRejection",function(a){throw a}),r.inspect=function(){return"[Emscripten Module object]"}):(x||D)&&(D?F=self.location.href:typeof document<"u"&&document.currentScript&&(F=document.currentScript.src),n&&(F=n),F.indexOf("blob:")!==0?F=F.substr(0,F.replace(/[?#].*/,"").lastIndexOf("/")+1):F="",K=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.send(null),s.responseText},D&&(R=a=>{var s=new XMLHttpRequest;return s.open("GET",a,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),k=(a,s,u)=>{var h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?s(h.response):u()},h.onerror=u,h.send(null)});var N=r.print||console.log.bind(console),B=r.printErr||console.warn.bind(console);c(r,v),v=null;var J;r.wasmBinary&&(J=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ne("no native wasm support detected");var w,g=!1,f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function m(a,s,u){var h=s+u;for(u=s;a[u]&&!(u>=h);)++u;if(16<u-s&&a.subarray&&f)return f.decode(a.subarray(s,u));for(h="";s<u;){var S=a[s++];if(S&128){var P=a[s++]&63;if((S&224)==192)h+=String.fromCharCode((S&31)<<6|P);else{var z=a[s++]&63;S=(S&240)==224?(S&15)<<12|P<<6|z:(S&7)<<18|P<<12|z<<6|a[s++]&63,65536>S?h+=String.fromCharCode(S):(S-=65536,h+=String.fromCharCode(55296|S>>10,56320|S&1023))}}else h+=String.fromCharCode(S)}return h}function p(a,s,u){var h=ae;if(0<u){u=s+u-1;for(var S=0;S<a.length;++S){var P=a.charCodeAt(S);if(55296<=P&&57343>=P){var z=a.charCodeAt(++S);P=65536+((P&1023)<<10)|z&1023}if(127>=P){if(s>=u)break;h[s++]=P}else{if(2047>=P){if(s+1>=u)break;h[s++]=192|P>>6}else{if(65535>=P){if(s+2>=u)break;h[s++]=224|P>>12}else{if(s+3>=u)break;h[s++]=240|P>>18,h[s++]=128|P>>12&63}h[s++]=128|P>>6&63}h[s++]=128|P&63}}h[s]=0}}var O=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function C(a,s){for(var u=a>>1,h=u+s/2;!(u>=h)&&Me[u];)++u;if(u<<=1,32<u-a&&O)return O.decode(ae.subarray(a,u));for(u="",h=0;!(h>=s/2);++h){var S=ke[a+2*h>>1];if(S==0)break;u+=String.fromCharCode(S)}return u}function ce(a,s,u){if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var h=s;u=u<2*a.length?u/2:a.length;for(var S=0;S<u;++S)ke[s>>1]=a.charCodeAt(S),s+=2;return ke[s>>1]=0,s-h}function le(a){return 2*a.length}function oe(a,s){for(var u=0,h="";!(u>=s/4);){var S=Se[a+4*u>>2];if(S==0)break;++u,65536<=S?(S-=65536,h+=String.fromCharCode(55296|S>>10,56320|S&1023)):h+=String.fromCharCode(S)}return h}function ee(a,s,u){if(u===void 0&&(u=2147483647),4>u)return 0;var h=s;u=h+u-4;for(var S=0;S<a.length;++S){var P=a.charCodeAt(S);if(55296<=P&&57343>=P){var z=a.charCodeAt(++S);P=65536+((P&1023)<<10)|z&1023}if(Se[s>>2]=P,s+=4,s+4>u)break}return Se[s>>2]=0,s-h}function pe(a){for(var s=0,u=0;u<a.length;++u){var h=a.charCodeAt(u);55296<=h&&57343>=h&&++u,s+=4}return s}var ye,se,ae,ke,Me,Se,Re,Je,nt;function Ve(){var a=w.buffer;ye=a,r.HEAP8=se=new Int8Array(a),r.HEAP16=ke=new Int16Array(a),r.HEAP32=Se=new Int32Array(a),r.HEAPU8=ae=new Uint8Array(a),r.HEAPU16=Me=new Uint16Array(a),r.HEAPU32=Re=new Uint32Array(a),r.HEAPF32=Je=new Float32Array(a),r.HEAPF64=nt=new Float64Array(a)}var Y,l=[],d=[],b=[];function H(){var a=r.preRun.shift();l.unshift(a)}var M=0,q=null;r.preloadedImages={},r.preloadedAudios={};function ne(a){throw r.onAbort&&r.onAbort(a),a="Aborted("+a+")",B(a),g=!0,a=new WebAssembly.RuntimeError(a+". Build with -s ASSERTIONS=1 for more info."),E(a),a}function de(){return re.startsWith("data:application/octet-stream;base64,")}var re;if(re="pathkit.wasm",!de()){var Ce=re;re=r.locateFile?r.locateFile(Ce,F):F+Ce}function be(){var a=re;try{if(a==re&&J)return new Uint8Array(J);if(R)return R(a);throw"both async and sync fetching of the wasm failed"}catch(s){ne(s)}}function Te(){if(!J&&(x||D)){if(typeof fetch=="function"&&!re.startsWith("file://"))return fetch(re,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+re+"'";return a.arrayBuffer()}).catch(function(){return be()});if(k)return new Promise(function(a,s){k(re,function(u){a(new Uint8Array(u))},s)})}return Promise.resolve().then(function(){return be()})}function Pe(a){for(;0<a.length;){var s=a.shift();if(typeof s=="function")s(r);else{var u=s.Wa;typeof u=="number"?s.xa===void 0?Y.get(u)():Y.get(u)(s.xa):u(s.xa===void 0?null:s.xa)}}}var he={};function we(a){for(;a.length;){var s=a.pop();a.pop()(s)}}function Ge(a){return this.fromWireType(Re[a>>2])}var lt={},et={},I={};function U(a){if(a===void 0)return"_unknown";a=a.replace(/[^a-zA-Z0-9_]/g,"$");var s=a.charCodeAt(0);return 48<=s&&57>=s?"_"+a:a}function W(a,s){return a=U(a),function(){return s.apply(this,arguments)}}function te(a){var s=Error,u=W(a,function(h){this.name=a,this.message=h,h=Error(h).stack,h!==void 0&&(this.stack=this.toString()+`
`+h.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},u}var ue=void 0;function ge(a){throw new ue(a)}function fe(a,s,u){function h(V){V=u(V),V.length!==a.length&&ge("Mismatched type converter count");for(var G=0;G<a.length;++G)it(a[G],V[G])}a.forEach(function(V){I[V]=s});var S=Array(s.length),P=[],z=0;s.forEach(function(V,G){et.hasOwnProperty(V)?S[G]=et[V]:(P.push(V),lt.hasOwnProperty(V)||(lt[V]=[]),lt[V].push(function(){S[G]=et[V],++z,z===P.length&&h(S)}))}),P.length===0&&h(S)}var Ae={};function me(a){switch(a){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+a)}}var $e=void 0;function Ie(a){for(var s="";ae[a];)s+=$e[ae[a++]];return s}var Fe=void 0;function ve(a){throw new Fe(a)}function it(a,s,u={}){if(!("argPackAdvance"in s))throw new TypeError("registerType registeredInstance requires argPackAdvance");var h=s.name;if(a||ve('type "'+h+'" must have a positive integer typeid pointer'),et.hasOwnProperty(a)){if(u.Qa)return;ve("Cannot register type '"+h+"' twice")}et[a]=s,delete I[a],lt.hasOwnProperty(a)&&(s=lt[a],delete lt[a],s.forEach(function(S){S()}))}function ln(a){ve(a.ea.ha.fa.name+" instance already deleted")}var cn=!1;function zn(){}function Gn(a){--a.count.value,a.count.value===0&&(a.ka?a.ma.la(a.ka):a.ha.fa.la(a.ga))}function wt(a){return typeof FinalizationGroup>"u"?(wt=s=>s,a):(cn=new FinalizationGroup(function(s){for(var u=s.next();!u.done;u=s.next())u=u.value,u.ga?Gn(u):console.warn("object already deleted: "+u.ga)}),wt=s=>(cn.register(s,s.ea,s.ea),s),zn=s=>{cn.unregister(s.ea)},wt(a))}var bt=void 0,It=[];function un(){for(;It.length;){var a=It.pop();a.ea.pa=!1,a.delete()}}function ct(){}var qn={};function Kn(a,s,u){if(a[s].ia===void 0){var h=a[s];a[s]=function(){return a[s].ia.hasOwnProperty(arguments.length)||ve("Function '"+u+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+a[s].ia+")!"),a[s].ia[arguments.length].apply(this,arguments)},a[s].ia=[],a[s].ia[h.ua]=h}}function dn(a,s,u){r.hasOwnProperty(a)?((u===void 0||r[a].ia!==void 0&&r[a].ia[u]!==void 0)&&ve("Cannot register public name '"+a+"' twice"),Kn(r,a,a),r.hasOwnProperty(u)&&ve("Cannot register multiple overloads of a function with the same number of arguments ("+u+")!"),r[a].ia[u]=s):(r[a]=s,u!==void 0&&(r[a].Xa=u))}function nr(a,s,u,h,S,P,z,V){this.name=a,this.constructor=s,this.qa=u,this.la=h,this.na=S,this.Oa=P,this.ta=z,this.La=V,this.Ta=[]}function fn(a,s,u){for(;s!==u;)s.ta||ve("Expected null or instance of "+u.name+", got an instance of "+s.name),a=s.ta(a),s=s.na;return a}function ir(a,s){return s===null?(this.Ba&&ve("null is not a valid "+this.name),0):(s.ea||ve('Cannot pass "'+vn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),fn(s.ea.ga,s.ea.ha.fa,this.fa))}function rr(a,s){if(s===null){if(this.Ba&&ve("null is not a valid "+this.name),this.wa){var u=this.sa();return a!==null&&a.push(this.la,u),u}return 0}if(s.ea||ve('Cannot pass "'+vn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&s.ea.ha.va&&ve("Cannot convert argument of type "+(s.ea.ma?s.ea.ma.name:s.ea.ha.name)+" to parameter type "+this.name),u=fn(s.ea.ga,s.ea.ha.fa,this.fa),this.wa)switch(s.ea.ka===void 0&&ve("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:s.ea.ma===this?u=s.ea.ka:ve("Cannot convert argument of type "+(s.ea.ma?s.ea.ma.name:s.ea.ha.name)+" to parameter type "+this.name);break;case 1:u=s.ea.ka;break;case 2:if(s.ea.ma===this)u=s.ea.ka;else{var h=s.clone();u=this.Ua(u,ut(function(){h.delete()})),a!==null&&a.push(this.la,u)}break;default:ve("Unsupporting sharing policy")}return u}function or(a,s){return s===null?(this.Ba&&ve("null is not a valid "+this.name),0):(s.ea||ve('Cannot pass "'+vn(s)+'" as a '+this.name),s.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),s.ea.ha.va&&ve("Cannot convert argument of type "+s.ea.ha.name+" to parameter type "+this.name),fn(s.ea.ga,s.ea.ha.fa,this.fa))}function Yn(a,s,u){return s===u?a:u.na===void 0?null:(a=Yn(a,s,u.na),a===null?null:u.La(a))}var Et={};function sr(a,s){for(s===void 0&&ve("ptr should not be undefined");a.na;)s=a.ta(s),a=a.na;return Et[s]}function xt(a,s){return s.ha&&s.ga||ge("makeClassHandle requires ptr and ptrType"),!!s.ma!=!!s.ka&&ge("Both smartPtrType and smartPtr must be specified"),s.count={value:1},wt(Object.create(a,{ea:{value:s}}))}function ot(a,s,u,h){this.name=a,this.fa=s,this.Ba=u,this.va=h,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,s.na!==void 0?this.toWireType=rr:(this.toWireType=h?ir:or,this.ja=null)}function Zn(a,s,u){r.hasOwnProperty(a)||ge("Replacing nonexistant public symbol"),r[a].ia!==void 0&&u!==void 0?r[a].ia[u]=s:(r[a]=s,r[a].ua=u)}function ar(a,s){var u=[];return function(){u.length=arguments.length;for(var h=0;h<arguments.length;h++)u[h]=arguments[h];return a.includes("j")?(h=r["dynCall_"+a],h=u&&u.length?h.apply(null,[s].concat(u)):h.call(null,s)):h=Y.get(s).apply(null,u),h}}function je(a,s){a=Ie(a);var u=a.includes("j")?ar(a,s):Y.get(s);return typeof u!="function"&&ve("unknown function pointer with signature "+a+": "+s),u}var Qn=void 0;function Jn(a){a=oi(a);var s=Ie(a);return st(a),s}function Ct(a,s){function u(P){S[P]||et[P]||(I[P]?I[P].forEach(u):(h.push(P),S[P]=!0))}var h=[],S={};throw s.forEach(u),new Qn(a+": "+h.map(Jn).join([", "]))}function pn(a,s){for(var u=[],h=0;h<a;h++)u.push(Se[(s>>2)+h]);return u}function hn(a,s,u,h,S){var P=s.length;2>P&&ve("argTypes array size mismatch! Must at least get return value and 'this' types!");var z=s[1]!==null&&u!==null,V=!1;for(u=1;u<s.length;++u)if(s[u]!==null&&s[u].ja===void 0){V=!0;break}var G=s[0].name!=="void",Z=P-2,Q=Array(Z),ie=[],Ee=[];return function(){if(arguments.length!==Z&&ve("function "+a+" called with "+arguments.length+" arguments, expected "+Z+" args!"),Ee.length=0,ie.length=z?2:1,ie[0]=S,z){var Ne=s[1].toWireType(Ee,this);ie[1]=Ne}for(var _e=0;_e<Z;++_e)Q[_e]=s[_e+2].toWireType(Ee,arguments[_e]),ie.push(Q[_e]);if(_e=h.apply(null,ie),V)we(Ee);else for(var Xe=z?1:2;Xe<s.length;Xe++){var Ue=Xe===1?Ne:Q[Xe-2];s[Xe].ja!==null&&s[Xe].ja(Ue)}return Ne=G?s[0].fromWireType(_e):void 0,Ne}}var gn=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ei(a){4<a&&--tt[a].Ca===0&&(tt[a]=void 0,gn.push(a))}function mn(a){return a||ve("Cannot use deleted val. handle = "+a),tt[a].value}function ut(a){switch(a){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var s=gn.length?gn.pop():tt.length;return tt[s]={Ca:1,value:a},s}}function lr(a,s,u){switch(s){case 0:return function(h){return this.fromWireType((u?se:ae)[h])};case 1:return function(h){return this.fromWireType((u?ke:Me)[h>>1])};case 2:return function(h){return this.fromWireType((u?Se:Re)[h>>2])};default:throw new TypeError("Unknown integer type: "+a)}}function Pt(a,s){var u=et[a];return u===void 0&&ve(s+" has unknown type "+Jn(a)),u}function vn(a){if(a===null)return"null";var s=typeof a;return s==="object"||s==="array"||s==="function"?a.toString():""+a}function cr(a,s){switch(s){case 2:return function(u){return this.fromWireType(Je[u>>2])};case 3:return function(u){return this.fromWireType(nt[u>>3])};default:throw new TypeError("Unknown float type: "+a)}}function ur(a,s,u){switch(s){case 0:return u?function(h){return se[h]}:function(h){return ae[h]};case 1:return u?function(h){return ke[h>>1]}:function(h){return Me[h>>1]};case 2:return u?function(h){return Se[h>>2]}:function(h){return Re[h>>2]};default:throw new TypeError("Unknown integer type: "+a)}}var dr={};function yn(a){var s=dr[a];return s===void 0?Ie(a):s}var wn=[];function ti(){function a(s){s.$$$embind_global$$$=s;var u=typeof $$$embind_global$$$=="object"&&s.$$$embind_global$$$===s;return u||delete s.$$$embind_global$$$,u}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof _n=="object"&&a(_n)?$$$embind_global$$$=_n:typeof self=="object"&&a(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function fr(a){var s=wn.length;return wn.push(a),s}function pr(a,s){for(var u=Array(a),h=0;h<a;++h)u[h]=Pt(Se[(s>>2)+h],"parameter "+h);return u}var ni=[];function hr(a){var s=Array(a+1);return function(u,h,S){s[0]=u;for(var P=0;P<a;++P){var z=Pt(Se[(h>>2)+P],"parameter "+P);s[P+1]=z.readValueFromPointer(S),S+=z.argPackAdvance}return u=new(u.bind.apply(u,s)),ut(u)}}var ii={},gr=[null,[],[]];ue=r.InternalError=te("InternalError");for(var ri=Array(256),Dt=0;256>Dt;++Dt)ri[Dt]=String.fromCharCode(Dt);$e=ri,Fe=r.BindingError=te("BindingError"),ct.prototype.isAliasOf=function(a){if(!(this instanceof ct&&a instanceof ct))return!1;var s=this.ea.ha.fa,u=this.ea.ga,h=a.ea.ha.fa;for(a=a.ea.ga;s.na;)u=s.ta(u),s=s.na;for(;h.na;)a=h.ta(a),h=h.na;return s===h&&u===a},ct.prototype.clone=function(){if(this.ea.ga||ln(this),this.ea.ra)return this.ea.count.value+=1,this;var a=wt,s=Object,u=s.create,h=Object.getPrototypeOf(this),S=this.ea;return a=a(u.call(s,h,{ea:{value:{count:S.count,pa:S.pa,ra:S.ra,ga:S.ga,ha:S.ha,ka:S.ka,ma:S.ma}}})),a.ea.count.value+=1,a.ea.pa=!1,a},ct.prototype.delete=function(){this.ea.ga||ln(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),zn(this),Gn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},ct.prototype.isDeleted=function(){return!this.ea.ga},ct.prototype.deleteLater=function(){return this.ea.ga||ln(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),It.push(this),It.length===1&&bt&&bt(un),this.ea.pa=!0,this},ot.prototype.Pa=function(a){return this.Ia&&(a=this.Ia(a)),a},ot.prototype.Ga=function(a){this.la&&this.la(a)},ot.prototype.argPackAdvance=8,ot.prototype.readValueFromPointer=Ge,ot.prototype.deleteObject=function(a){a!==null&&a.delete()},ot.prototype.fromWireType=function(a){function s(){return this.wa?xt(this.fa.qa,{ha:this.Sa,ga:u,ma:this,ka:a}):xt(this.fa.qa,{ha:this,ga:a})}var u=this.Pa(a);if(!u)return this.Ga(a),null;var h=sr(this.fa,u);if(h!==void 0)return h.ea.count.value===0?(h.ea.ga=u,h.ea.ka=a,h.clone()):(h=h.clone(),this.Ga(a),h);if(h=this.fa.Oa(u),h=qn[h],!h)return s.call(this);h=this.va?h.Ja:h.pointerType;var S=Yn(u,this.fa,h.fa);return S===null?s.call(this):this.wa?xt(h.fa.qa,{ha:h,ga:S,ma:this,ka:a}):xt(h.fa.qa,{ha:h,ga:S})},r.getInheritedInstanceCount=function(){return Object.keys(Et).length},r.getLiveInheritedInstances=function(){var a=[],s;for(s in Et)Et.hasOwnProperty(s)&&a.push(Et[s]);return a},r.flushPendingDeletes=un,r.setDelayFunction=function(a){bt=a,It.length&&bt&&bt(un)},Qn=r.UnboundTypeError=te("UnboundTypeError"),r.count_emval_handles=function(){for(var a=0,s=5;s<tt.length;++s)tt[s]!==void 0&&++a;return a},r.get_first_emval=function(){for(var a=5;a<tt.length;++a)if(tt[a]!==void 0)return tt[a];return null};var mr={r:function(a){var s=he[a];delete he[a];var u=s.elements,h=u.length,S=u.map(function(V){return V.Aa}).concat(u.map(function(V){return V.Ea})),P=s.sa,z=s.la;fe([a],S,function(V){return u.forEach(function(G,Z){var Q=V[Z],ie=G.ya,Ee=G.za,Ne=V[Z+h],_e=G.Da,Xe=G.Fa;G.read=Ue=>Q.fromWireType(ie(Ee,Ue)),G.write=(Ue,ft)=>{var Ke=[];_e(Xe,Ue,Ne.toWireType(Ke,ft)),we(Ke)}}),[{name:s.name,fromWireType:function(G){for(var Z=Array(h),Q=0;Q<h;++Q)Z[Q]=u[Q].read(G);return z(G),Z},toWireType:function(G,Z){if(h!==Z.length)throw new TypeError("Incorrect number of tuple elements for "+s.name+": expected="+h+", actual="+Z.length);for(var Q=P(),ie=0;ie<h;++ie)u[ie].write(Q,Z[ie]);return G!==null&&G.push(z,Q),Q},argPackAdvance:8,readValueFromPointer:Ge,ja:z}]})},u:function(a){var s=Ae[a];delete Ae[a];var u=s.sa,h=s.la,S=s.Ha,P=S.map(function(z){return z.Aa}).concat(S.map(function(z){return z.Ea}));fe([a],P,function(z){var V={};return S.forEach(function(G,Z){var Q=z[Z],ie=G.ya,Ee=G.za,Ne=z[Z+S.length],_e=G.Da,Xe=G.Fa;V[G.Na]={read:function(Ue){return Q.fromWireType(ie(Ee,Ue))},write:function(Ue,ft){var Ke=[];_e(Xe,Ue,Ne.toWireType(Ke,ft)),we(Ke)}}}),[{name:s.name,fromWireType:function(G){var Z={},Q;for(Q in V)Z[Q]=V[Q].read(G);return h(G),Z},toWireType:function(G,Z){for(var Q in V)if(!(Q in Z))throw new TypeError('Missing field:  "'+Q+'"');var ie=u();for(Q in V)V[Q].write(ie,Z[Q]);return G!==null&&G.push(h,ie),ie},argPackAdvance:8,readValueFromPointer:Ge,ja:h}]})},z:function(){},F:function(a,s,u,h,S){var P=me(u);s=Ie(s),it(a,{name:s,fromWireType:function(z){return!!z},toWireType:function(z,V){return V?h:S},argPackAdvance:8,readValueFromPointer:function(z){if(u===1)var V=se;else if(u===2)V=ke;else if(u===4)V=Se;else throw new TypeError("Unknown boolean type size: "+s);return this.fromWireType(V[z>>P])},ja:null})},l:function(a,s,u,h,S,P,z,V,G,Z,Q,ie,Ee){Q=Ie(Q),P=je(S,P),V&&(V=je(z,V)),Z&&(Z=je(G,Z)),Ee=je(ie,Ee);var Ne=U(Q);dn(Ne,function(){Ct("Cannot construct "+Q+" due to unbound types",[h])}),fe([a,s,u],h?[h]:[],function(_e){if(_e=_e[0],h)var Xe=_e.fa,Ue=Xe.qa;else Ue=ct.prototype;_e=W(Ne,function(){if(Object.getPrototypeOf(this)!==ft)throw new Fe("Use 'new' to construct "+Q);if(Ke.oa===void 0)throw new Fe(Q+" has no accessible constructor");var ai=Ke.oa[arguments.length];if(ai===void 0)throw new Fe("Tried to invoke ctor of "+Q+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ke.oa).toString()+") parameters instead!");return ai.apply(this,arguments)});var ft=Object.create(Ue,{constructor:{value:_e}});_e.prototype=ft;var Ke=new nr(Q,_e,ft,Ee,Xe,P,V,Z);Xe=new ot(Q,Ke,!0,!1),Ue=new ot(Q+"*",Ke,!1,!1);var si=new ot(Q+" const*",Ke,!1,!0);return qn[a]={pointerType:Ue,Ja:si},Zn(Ne,_e),[Xe,Ue,si]})},i:function(a,s,u,h,S,P){0<s||ne(void 0);var z=pn(s,u);S=je(h,S),fe([],[a],function(V){V=V[0];var G="constructor "+V.name;if(V.fa.oa===void 0&&(V.fa.oa=[]),V.fa.oa[s-1]!==void 0)throw new Fe("Cannot register multiple constructors with identical number of parameters ("+(s-1)+") for class '"+V.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return V.fa.oa[s-1]=()=>{Ct("Cannot construct "+V.name+" due to unbound types",z)},fe([],z,function(Z){return Z.splice(1,0,null),V.fa.oa[s-1]=hn(G,Z,null,S,P),[]}),[]})},a:function(a,s,u,h,S,P,z,V){var G=pn(u,h);s=Ie(s),P=je(S,P),fe([],[a],function(Z){function Q(){Ct("Cannot call "+ie+" due to unbound types",G)}Z=Z[0];var ie=Z.name+"."+s;s.startsWith("@@")&&(s=Symbol[s.substring(2)]),V&&Z.fa.Ta.push(s);var Ee=Z.fa.qa,Ne=Ee[s];return Ne===void 0||Ne.ia===void 0&&Ne.className!==Z.name&&Ne.ua===u-2?(Q.ua=u-2,Q.className=Z.name,Ee[s]=Q):(Kn(Ee,s,ie),Ee[s].ia[u-2]=Q),fe([],G,function(_e){return _e=hn(ie,_e,Z,P,z),Ee[s].ia===void 0?(_e.ua=u-2,Ee[s]=_e):Ee[s].ia[u-2]=_e,[]}),[]})},I:function(a,s,u){a=Ie(a),fe([],[s],function(h){return h=h[0],r[a]=h.fromWireType(u),[]})},E:function(a,s){s=Ie(s),it(a,{name:s,fromWireType:function(u){var h=mn(u);return ei(u),h},toWireType:function(u,h){return ut(h)},argPackAdvance:8,readValueFromPointer:Ge,ja:null})},h:function(a,s,u,h){function S(){}u=me(u),s=Ie(s),S.values={},it(a,{name:s,constructor:S,fromWireType:function(P){return this.constructor.values[P]},toWireType:function(P,z){return z.value},argPackAdvance:8,readValueFromPointer:lr(s,u,h),ja:null}),dn(s,S)},k:function(a,s,u){var h=Pt(a,"enum");s=Ie(s),a=h.constructor,h=Object.create(h.constructor.prototype,{value:{value:u},constructor:{value:W(h.name+"_"+s,function(){})}}),a.values[u]=h,a[s]=h},q:function(a,s,u){u=me(u),s=Ie(s),it(a,{name:s,fromWireType:function(h){return h},toWireType:function(h,S){return S},argPackAdvance:8,readValueFromPointer:cr(s,u),ja:null})},f:function(a,s,u,h,S,P){var z=pn(s,u);a=Ie(a),S=je(h,S),dn(a,function(){Ct("Cannot call "+a+" due to unbound types",z)},s-1),fe([],z,function(V){return V=[V[0],null].concat(V.slice(1)),Zn(a,hn(a,V,null,S,P),s-1),[]})},e:function(a,s,u,h,S){s=Ie(s),S===-1&&(S=4294967295),S=me(u);var P=V=>V;if(h===0){var z=32-8*u;P=V=>V<<z>>>z}u=s.includes("unsigned")?function(V,G){return G>>>0}:function(V,G){return G},it(a,{name:s,fromWireType:P,toWireType:u,argPackAdvance:8,readValueFromPointer:ur(s,S,h!==0),ja:null})},b:function(a,s,u){function h(P){P>>=2;var z=Re;return new S(ye,z[P+1],z[P])}var S=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][s];u=Ie(u),it(a,{name:u,fromWireType:h,argPackAdvance:8,readValueFromPointer:h},{Qa:!0})},p:function(a,s){s=Ie(s);var u=s==="std::string";it(a,{name:s,fromWireType:function(h){var S=Re[h>>2];if(u)for(var P=h+4,z=0;z<=S;++z){var V=h+4+z;if(z==S||ae[V]==0){if(P=P?m(ae,P,V-P):"",G===void 0)var G=P;else G+=String.fromCharCode(0),G+=P;P=V+1}}else{for(G=Array(S),z=0;z<S;++z)G[z]=String.fromCharCode(ae[h+4+z]);G=G.join("")}return st(h),G},toWireType:function(h,S){S instanceof ArrayBuffer&&(S=new Uint8Array(S));var P=typeof S=="string";P||S instanceof Uint8Array||S instanceof Uint8ClampedArray||S instanceof Int8Array||ve("Cannot pass non-string to std::string");var z=(u&&P?()=>{for(var Z=0,Q=0;Q<S.length;++Q){var ie=S.charCodeAt(Q);55296<=ie&&57343>=ie&&(ie=65536+((ie&1023)<<10)|S.charCodeAt(++Q)&1023),127>=ie?++Z:Z=2047>=ie?Z+2:65535>=ie?Z+3:Z+4}return Z}:()=>S.length)(),V=bn(4+z+1);if(Re[V>>2]=z,u&&P)p(S,V+4,z+1);else if(P)for(P=0;P<z;++P){var G=S.charCodeAt(P);255<G&&(st(V),ve("String has UTF-16 code units that do not fit in 8 bits")),ae[V+4+P]=G}else for(P=0;P<z;++P)ae[V+4+P]=S[P];return h!==null&&h.push(st,V),V},argPackAdvance:8,readValueFromPointer:Ge,ja:function(h){st(h)}})},m:function(a,s,u){if(u=Ie(u),s===2)var h=C,S=ce,P=le,z=()=>Me,V=1;else s===4&&(h=oe,S=ee,P=pe,z=()=>Re,V=2);it(a,{name:u,fromWireType:function(G){for(var Z=Re[G>>2],Q=z(),ie,Ee=G+4,Ne=0;Ne<=Z;++Ne){var _e=G+4+Ne*s;(Ne==Z||Q[_e>>V]==0)&&(Ee=h(Ee,_e-Ee),ie===void 0?ie=Ee:(ie+=String.fromCharCode(0),ie+=Ee),Ee=_e+s)}return st(G),ie},toWireType:function(G,Z){typeof Z!="string"&&ve("Cannot pass non-string to C++ string type "+u);var Q=P(Z),ie=bn(4+Q+s);return Re[ie>>2]=Q>>V,S(Z,ie+4,Q+s),G!==null&&G.push(st,ie),ie},argPackAdvance:8,readValueFromPointer:Ge,ja:function(G){st(G)}})},t:function(a,s,u,h,S,P){he[a]={name:Ie(s),sa:je(u,h),la:je(S,P),elements:[]}},s:function(a,s,u,h,S,P,z,V,G){he[a].elements.push({Aa:s,ya:je(u,h),za:S,Ea:P,Da:je(z,V),Fa:G})},v:function(a,s,u,h,S,P){Ae[a]={name:Ie(s),sa:je(u,h),la:je(S,P),Ha:[]}},j:function(a,s,u,h,S,P,z,V,G,Z){Ae[a].Ha.push({Na:Ie(s),Aa:u,ya:je(h,S),za:P,Ea:z,Da:je(V,G),Fa:Z})},G:function(a,s){s=Ie(s),it(a,{Ra:!0,name:s,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(a,s,u,h){a=wn[a],s=mn(s),u=yn(u),a(s,u,null,h)},J:ei,x:function(a){return a===0?ut(ti()):(a=yn(a),ut(ti()[a]))},c:function(a,s){var u=pr(a,s),h=u[0];s=h.name+"_$"+u.slice(1).map(function(z){return z.name}).join("_")+"$";var S=ni[s];if(S!==void 0)return S;var P=Array(a-1);return S=fr((z,V,G,Z)=>{for(var Q=0,ie=0;ie<a-1;++ie)P[ie]=u[ie+1].readValueFromPointer(Z+Q),Q+=u[ie+1].argPackAdvance;for(z=z[V].apply(z,P),ie=0;ie<a-1;++ie)u[ie+1].Ka&&u[ie+1].Ka(P[ie]);if(!h.Ra)return h.toWireType(G,z)}),ni[s]=S},n:function(a){4<a&&(tt[a].Ca+=1)},w:function(a,s,u,h){a=mn(a);var S=ii[s];return S||(S=hr(s),ii[s]=S),S(a,u,h)},K:function(){return ut([])},D:function(a){return ut(yn(a))},H:function(a,s){return a=Pt(a,"_emval_take_value"),a=a.readValueFromPointer(s),ut(a)},g:function(){ne("")},B:function(a){var s=ae.length;if(a>>>=0,2147483648<a)return!1;for(var u=1;4>=u;u*=2){var h=s*(1+.2/u);h=Math.min(h,a+100663296),h=Math.max(a,h),0<h%65536&&(h+=65536-h%65536);e:{try{w.grow(Math.min(2147483648,h)-ye.byteLength+65535>>>16),Ve();var S=1;break e}catch{}S=void 0}if(S)return!0}return!1},C:function(){return 0},y:function(){},o:function(a,s,u,h){for(var S=0,P=0;P<u;P++){var z=Se[s>>2],V=Se[s+4>>2];s+=8;for(var G=0;G<V;G++){var Z=ae[z+G],Q=gr[a];Z===0||Z===10?((a===1?N:B)(m(Q,0)),Q.length=0):Q.push(Z)}S+=V}return Se[h>>2]=S,0},A:function(){}};(function(){function a(S){r.asm=S.exports,w=r.asm.L,Ve(),Y=r.asm._,d.unshift(r.asm.M),M--,r.monitorRunDependencies&&r.monitorRunDependencies(M),M==0&&q&&(S=q,q=null,S())}function s(S){a(S.instance)}function u(S){return Te().then(function(P){return WebAssembly.instantiate(P,h)}).then(function(P){return P}).then(S,function(P){B("failed to asynchronously prepare wasm: "+P),ne(P)})}var h={a:mr};if(M++,r.monitorRunDependencies&&r.monitorRunDependencies(M),r.instantiateWasm)try{return r.instantiateWasm(h,a)}catch(S){return B("Module.instantiateWasm callback failed with error: "+S),!1}return function(){return J||typeof WebAssembly.instantiateStreaming!="function"||de()||re.startsWith("file://")||typeof fetch!="function"?u(s):fetch(re,{credentials:"same-origin"}).then(function(S){return WebAssembly.instantiateStreaming(S,h).then(s,function(P){return B("wasm streaming compile failed: "+P),B("falling back to ArrayBuffer instantiation"),u(s)})})}().catch(E),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var st=r._free=function(){return(st=r._free=r.asm.$).apply(null,arguments)},bn=r._malloc=function(){return(bn=r._malloc=r.asm.aa).apply(null,arguments)},oi=r.___getTypeName=function(){return(oi=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Lt;q=function a(){Lt||In(),Lt||(q=a)};function In(){function a(){if(!Lt&&(Lt=!0,r.calledRun=!0,!g)){if(Pe(d),y(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var s=r.postRun.shift();b.unshift(s)}Pe(b)}}if(!(0<M)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)H();Pe(l),0<M||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),a()},1)):a())}}if(r.run=In,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return In(),o.ready}})();i.exports=t})(Pi);var Ar=Pi.exports;const Nr=Ai(Ar),xr="/assets/pathkit-1356ccfa.wasm";let Ze=null,Kt="",Yt="",Zt="",Qt="";async function Di(){await j.scene.local.deleteItems([Qt,Kt,Yt,Zt]),Kt="",Yt="",Qt="",Zt="",await j.popover.close(_.POLYTOOLID)}async function Li(){if(!Ze)return;const[i,e]=Ze;e(),Ze=null,Di()}async function $i(){if(!Ze)return;const[i,e]=Ze,t=i(n=>{n.visible=!1,n.metadata[`${_.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&j.scene.items.addItems([t]),e(),Ze=null,Di()}async function Cr(i,e){if(!e.transformer)if(Ze)if(e.target&&(e.target.id===Kt||e.target.id===Yt))$i();else if(e.target&&(e.target.id===Qt||e.target.id===Zt))Li();else{const[t]=Ze;t(n=>{n.points.push(e.pointerPosition)})}else{const t=qt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=sn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Ze=await j.interaction.startItemInteraction(n);const o=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),c=qt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await j.scene.local.addItems([t,o,r,c]),Kt=t.id,Yt=o.id,Qt=c.id,Zt=r.id,await j.popover.open({id:_.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function Pr(i,e){if(!Ze||e.transformer)return;const[t]=Ze,n=Math.round(X.gridDpi/X.gridSnap),o=Math.round(e.pointerPosition.x/X.gridDpi)*X.gridDpi,r=Math.round(e.pointerPosition.y/X.gridDpi)*X.gridDpi,c=Math.abs(o-e.pointerPosition.x),y=Math.abs(r-e.pointerPosition.y);let E,v;c<=n?E=o:E=e.pointerPosition.x,y<=n?v=r:v=e.pointerPosition.y,t(x=>{x.points[x.points.length-1]=X.snap?{x:E,y:v}:e.pointerPosition})}function Dr(i,e){Ze&&(e.key=="Escape"?Li():e.key=="Enter"&&$i())}const On={onToolClick:Cr,onToolMove:Pr,onKeyDown:Dr};let Qe=null,kt="",Tt="",Jt="",en="";async function Fi(){await j.scene.local.deleteItems([en,kt,Tt,Jt]),kt="",Tt="",en="",Jt="",await j.popover.close(_.LINETOOLID)}async function Ri(){if(!Qe)return;const[i,e]=Qe;e(),Qe=null,await Fi()}async function Bi(){if(!Qe)return;const[i,e]=Qe,t=i(n=>{n.visible=!1,n.metadata[`${_.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await j.scene.items.addItems([t]),e(),Qe=null,await Fi()}async function Lr(i,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===kt||e.target.id===Tt))await Bi();else if(e.target&&(e.target.id===en||e.target.id===Jt))await Ri();else{const[t]=Qe;t(n=>{n.points.push(e.pointerPosition)}),await j.scene.local.updateItems(n=>n.id==Tt||n.id==kt,n=>{for(const o of n)o.position=e.pointerPosition})}else{const t=qt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=sn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Qe=await j.interaction.startItemInteraction(n);const o=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),c=qt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await j.scene.local.addItems([t,o,r,c]),kt=t.id,Tt=o.id,en=c.id,Jt=r.id,await j.popover.open({id:_.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function $r(i,e){if(!Qe||e.transformer)return;const[t]=Qe,n=Math.round(X.gridDpi/X.gridSnap),o=Math.round(e.pointerPosition.x/X.gridDpi)*X.gridDpi,r=Math.round(e.pointerPosition.y/X.gridDpi)*X.gridDpi,c=Math.abs(o-e.pointerPosition.x),y=Math.abs(r-e.pointerPosition.y);let E,v;c<=n?E=o:E=e.pointerPosition.x,y<=n?v=r:v=e.pointerPosition.y,t(x=>{x.points[x.points.length-1]=X.snap?{x:E,y:v}:e.pointerPosition})}function Fr(i,e){Qe&&(e.key=="Escape"?Ri():e.key=="Enter"&&Bi())}const kn={onToolClick:Lr,onToolMove:$r,onKeyDown:Fr};class Bn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function $t(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Mi={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,o,r){function c(v,x){if(!o[v]){if(!n[v]){var D=typeof $t=="function"&&$t;if(!x&&D)return D(v,!0);if(y)return y(v,!0);throw new Error("Cannot find module '"+v+"'")}x=o[v]={exports:{}},n[v][0].call(x.exports,function(F){var K=n[v][1][F];return c(K||F)},x,x.exports,t,n,o,r)}return o[v].exports}for(var y=typeof $t=="function"&&$t,E=0;E<r.length;E++)c(r[E]);return c}({1:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){var k=t("crypto");function R(w,g){g=A(w,g);var f;return(f=g.algorithm!=="passthrough"?k.createHash(g.algorithm):new J).write===void 0&&(f.write=f.update,f.end=f.update),B(g,f).dispatch(w),f.update||f.end(""),f.digest?f.digest(g.encoding==="buffer"?void 0:g.encoding):(w=f.read(),g.encoding!=="buffer"?w.toString(g.encoding):w)}(o=n.exports=R).sha1=function(w){return R(w)},o.keys=function(w){return R(w,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(w){return R(w,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(w){return R(w,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var T=k.getHashes?k.getHashes().slice():["sha1","md5"],L=(T.push("passthrough"),["buffer","hex","binary","base64"]);function A(w,g){var f={};if(f.algorithm=(g=g||{}).algorithm||"sha1",f.encoding=g.encoding||"hex",f.excludeValues=!!g.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=g.ignoreUnknown===!0,f.respectType=g.respectType!==!1,f.respectFunctionNames=g.respectFunctionNames!==!1,f.respectFunctionProperties=g.respectFunctionProperties!==!1,f.unorderedArrays=g.unorderedArrays===!0,f.unorderedSets=g.unorderedSets!==!1,f.unorderedObjects=g.unorderedObjects!==!1,f.replacer=g.replacer||void 0,f.excludeKeys=g.excludeKeys||void 0,w===void 0)throw new Error("Object argument required.");for(var m=0;m<T.length;++m)T[m].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=T[m]);if(T.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+T.join(", "));if(L.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+L.join(", "));return f}function N(w){if(typeof w=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(w))!=null}function B(w,g,f){f=f||[];function m(p){return g.update?g.update(p,"utf8"):g.write(p,"utf8")}return{dispatch:function(p){return this["_"+((p=w.replacer?w.replacer(p):p)===null?"null":typeof p)](p)},_object:function(p){var O,C=Object.prototype.toString.call(p),ce=/\[object (.*)\]/i.exec(C);if(ce=(ce=ce?ce[1]:"unknown:["+C+"]").toLowerCase(),0<=(C=f.indexOf(p)))return this.dispatch("[CIRCULAR:"+C+"]");if(f.push(p),y!==void 0&&y.isBuffer&&y.isBuffer(p))return m("buffer:"),m(p);if(ce==="object"||ce==="function"||ce==="asyncfunction")return C=Object.keys(p),w.unorderedObjects&&(C=C.sort()),w.respectType===!1||N(p)||C.splice(0,0,"prototype","__proto__","constructor"),w.excludeKeys&&(C=C.filter(function(le){return!w.excludeKeys(le)})),m("object:"+C.length+":"),O=this,C.forEach(function(le){O.dispatch(le),m(":"),w.excludeValues||O.dispatch(p[le]),m(",")});if(!this["_"+ce]){if(w.ignoreUnknown)return m("["+ce+"]");throw new Error('Unknown object type "'+ce+'"')}this["_"+ce](p)},_array:function(p,le){le=le!==void 0?le:w.unorderedArrays!==!1;var C=this;if(m("array:"+p.length+":"),!le||p.length<=1)return p.forEach(function(oe){return C.dispatch(oe)});var ce=[],le=p.map(function(oe){var ee=new J,pe=f.slice();return B(w,ee,pe).dispatch(oe),ce=ce.concat(pe.slice(f.length)),ee.read().toString()});return f=f.concat(ce),le.sort(),this._array(le,!1)},_date:function(p){return m("date:"+p.toJSON())},_symbol:function(p){return m("symbol:"+p.toString())},_error:function(p){return m("error:"+p.toString())},_boolean:function(p){return m("bool:"+p.toString())},_string:function(p){m("string:"+p.length+":"),m(p.toString())},_function:function(p){m("fn:"),N(p)?this.dispatch("[native]"):this.dispatch(p.toString()),w.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(p.name)),w.respectFunctionProperties&&this._object(p)},_number:function(p){return m("number:"+p.toString())},_xml:function(p){return m("xml:"+p.toString())},_null:function(){return m("Null")},_undefined:function(){return m("Undefined")},_regexp:function(p){return m("regex:"+p.toString())},_uint8array:function(p){return m("uint8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint8clampedarray:function(p){return m("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(p))},_int8array:function(p){return m("int8array:"),this.dispatch(Array.prototype.slice.call(p))},_uint16array:function(p){return m("uint16array:"),this.dispatch(Array.prototype.slice.call(p))},_int16array:function(p){return m("int16array:"),this.dispatch(Array.prototype.slice.call(p))},_uint32array:function(p){return m("uint32array:"),this.dispatch(Array.prototype.slice.call(p))},_int32array:function(p){return m("int32array:"),this.dispatch(Array.prototype.slice.call(p))},_float32array:function(p){return m("float32array:"),this.dispatch(Array.prototype.slice.call(p))},_float64array:function(p){return m("float64array:"),this.dispatch(Array.prototype.slice.call(p))},_arraybuffer:function(p){return m("arraybuffer:"),this.dispatch(new Uint8Array(p))},_url:function(p){return m("url:"+p.toString())},_map:function(p){return m("map:"),p=Array.from(p),this._array(p,w.unorderedSets!==!1)},_set:function(p){return m("set:"),p=Array.from(p),this._array(p,w.unorderedSets!==!1)},_file:function(p){return m("file:"),this.dispatch([p.name,p.size,p.type,p.lastModfied])},_blob:function(){if(w.ignoreUnknown)return m("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return m("domwindow")},_bigint:function(p){return m("bigint:"+p.toString())},_process:function(){return m("process")},_timer:function(){return m("timer")},_pipe:function(){return m("pipe")},_tcp:function(){return m("tcp")},_udp:function(){return m("udp")},_tty:function(){return m("tty")},_statwatcher:function(){return m("statwatcher")},_securecontext:function(){return m("securecontext")},_connection:function(){return m("connection")},_zlib:function(){return m("zlib")},_context:function(){return m("context")},_nodescript:function(){return m("nodescript")},_httpparser:function(){return m("httpparser")},_dataview:function(){return m("dataview")},_signal:function(){return m("signal")},_fsevent:function(){return m("fsevent")},_tlswrap:function(){return m("tlswrap")}}}function J(){return{buf:"",write:function(w){this.buf+=w},end:function(w){this.buf+=w},read:function(){return this.buf}}}o.writeToStream=function(w,g,f){return f===void 0&&(f=g,g={}),B(g=A(w,g),f).dispatch(w)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){(function(k){var R=typeof Uint8Array<"u"?Uint8Array:Array,T="+".charCodeAt(0),L="/".charCodeAt(0),A="0".charCodeAt(0),N="a".charCodeAt(0),B="A".charCodeAt(0),J="-".charCodeAt(0),w="_".charCodeAt(0);function g(f){return f=f.charCodeAt(0),f===T||f===J?62:f===L||f===w?63:f<A?-1:f<A+10?f-A+26+26:f<B+26?f-B:f<N+26?f-N+26:void 0}k.toByteArray=function(f){var m,p;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var O=f.length,O=f.charAt(O-2)==="="?2:f.charAt(O-1)==="="?1:0,C=new R(3*f.length/4-O),ce=0<O?f.length-4:f.length,le=0;function oe(ee){C[le++]=ee}for(m=0;m<ce;m+=4,0)oe((16711680&(p=g(f.charAt(m))<<18|g(f.charAt(m+1))<<12|g(f.charAt(m+2))<<6|g(f.charAt(m+3))))>>16),oe((65280&p)>>8),oe(255&p);return O==2?oe(255&(p=g(f.charAt(m))<<2|g(f.charAt(m+1))>>4)):O==1&&(oe((p=g(f.charAt(m))<<10|g(f.charAt(m+1))<<4|g(f.charAt(m+2))>>2)>>8&255),oe(255&p)),C},k.fromByteArray=function(f){var m,p,O,C,ce=f.length%3,le="";function oe(ee){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(ee)}for(m=0,O=f.length-ce;m<O;m+=3)p=(f[m]<<16)+(f[m+1]<<8)+f[m+2],le+=oe((C=p)>>18&63)+oe(C>>12&63)+oe(C>>6&63)+oe(63&C);switch(ce){case 1:le=(le+=oe((p=f[f.length-1])>>2))+oe(p<<4&63)+"==";break;case 2:le=(le=(le+=oe((p=(f[f.length-2]<<8)+f[f.length-1])>>10))+oe(p>>4&63))+oe(p<<2&63)+"="}return le}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,o){(function(r,c,T,E,v,x,D,F,K){var k=t("base64-js"),R=t("ieee754");function T(l,d,b){if(!(this instanceof T))return new T(l,d,b);var H,M,q,ne,de=typeof l;if(d==="base64"&&de=="string")for(l=(ne=l).trim?ne.trim():ne.replace(/^\s+|\s+$/g,"");l.length%4!=0;)l+="=";if(de=="number")H=ye(l);else if(de=="string")H=T.byteLength(l,d);else{if(de!="object")throw new Error("First argument needs to be a number, array or string.");H=ye(l.length)}if(T._useTypedArrays?M=T._augment(new Uint8Array(H)):((M=this).length=H,M._isBuffer=!0),T._useTypedArrays&&typeof l.byteLength=="number")M._set(l);else if(se(ne=l)||T.isBuffer(ne)||ne&&typeof ne=="object"&&typeof ne.length=="number")for(q=0;q<H;q++)T.isBuffer(l)?M[q]=l.readUInt8(q):M[q]=l[q];else if(de=="string")M.write(l,0,d);else if(de=="number"&&!T._useTypedArrays&&!b)for(q=0;q<H;q++)M[q]=0;return M}function L(l,d,b,H){return T._charsWritten=Se(function(M){for(var q=[],ne=0;ne<M.length;ne++)q.push(255&M.charCodeAt(ne));return q}(d),l,b,H)}function A(l,d,b,H){return T._charsWritten=Se(function(M){for(var q,ne,de=[],re=0;re<M.length;re++)ne=M.charCodeAt(re),q=ne>>8,ne=ne%256,de.push(ne),de.push(q);return de}(d),l,b,H)}function N(l,d,b){var H="";b=Math.min(l.length,b);for(var M=d;M<b;M++)H+=String.fromCharCode(l[M]);return H}function B(l,d,b,q){q||(Y(typeof b=="boolean","missing or invalid endian"),Y(d!=null,"missing offset"),Y(d+1<l.length,"Trying to read beyond buffer length"));var M,q=l.length;if(!(q<=d))return b?(M=l[d],d+1<q&&(M|=l[d+1]<<8)):(M=l[d]<<8,d+1<q&&(M|=l[d+1])),M}function J(l,d,b,q){q||(Y(typeof b=="boolean","missing or invalid endian"),Y(d!=null,"missing offset"),Y(d+3<l.length,"Trying to read beyond buffer length"));var M,q=l.length;if(!(q<=d))return b?(d+2<q&&(M=l[d+2]<<16),d+1<q&&(M|=l[d+1]<<8),M|=l[d],d+3<q&&(M+=l[d+3]<<24>>>0)):(d+1<q&&(M=l[d+1]<<16),d+2<q&&(M|=l[d+2]<<8),d+3<q&&(M|=l[d+3]),M+=l[d]<<24>>>0),M}function w(l,d,b,H){if(H||(Y(typeof b=="boolean","missing or invalid endian"),Y(d!=null,"missing offset"),Y(d+1<l.length,"Trying to read beyond buffer length")),!(l.length<=d))return H=B(l,d,b,!0),32768&H?-1*(65535-H+1):H}function g(l,d,b,H){if(H||(Y(typeof b=="boolean","missing or invalid endian"),Y(d!=null,"missing offset"),Y(d+3<l.length,"Trying to read beyond buffer length")),!(l.length<=d))return H=J(l,d,b,!0),2147483648&H?-1*(4294967295-H+1):H}function f(l,d,b,H){return H||(Y(typeof b=="boolean","missing or invalid endian"),Y(d+3<l.length,"Trying to read beyond buffer length")),R.read(l,d,b,23,4)}function m(l,d,b,H){return H||(Y(typeof b=="boolean","missing or invalid endian"),Y(d+7<l.length,"Trying to read beyond buffer length")),R.read(l,d,b,52,8)}function p(l,d,b,H,M){if(M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+1<l.length,"trying to write beyond buffer length"),Je(d,65535)),M=l.length,!(M<=b))for(var q=0,ne=Math.min(M-b,2);q<ne;q++)l[b+q]=(d&255<<8*(H?q:1-q))>>>8*(H?q:1-q)}function O(l,d,b,H,M){if(M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+3<l.length,"trying to write beyond buffer length"),Je(d,4294967295)),M=l.length,!(M<=b))for(var q=0,ne=Math.min(M-b,4);q<ne;q++)l[b+q]=d>>>8*(H?q:3-q)&255}function C(l,d,b,H,M){M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+1<l.length,"Trying to write beyond buffer length"),nt(d,32767,-32768)),l.length<=b||p(l,0<=d?d:65535+d+1,b,H,M)}function ce(l,d,b,H,M){M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+3<l.length,"Trying to write beyond buffer length"),nt(d,2147483647,-2147483648)),l.length<=b||O(l,0<=d?d:4294967295+d+1,b,H,M)}function le(l,d,b,H,M){M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+3<l.length,"Trying to write beyond buffer length"),Ve(d,34028234663852886e22,-34028234663852886e22)),l.length<=b||R.write(l,d,b,H,23,4)}function oe(l,d,b,H,M){M||(Y(d!=null,"missing value"),Y(typeof H=="boolean","missing or invalid endian"),Y(b!=null,"missing offset"),Y(b+7<l.length,"Trying to write beyond buffer length"),Ve(d,17976931348623157e292,-17976931348623157e292)),l.length<=b||R.write(l,d,b,H,52,8)}o.Buffer=T,o.SlowBuffer=T,o.INSPECT_MAX_BYTES=50,T.poolSize=8192,T._useTypedArrays=function(){try{var l=new ArrayBuffer(0),d=new Uint8Array(l);return d.foo=function(){return 42},d.foo()===42&&typeof d.subarray=="function"}catch{return!1}}(),T.isEncoding=function(l){switch(String(l).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},T.isBuffer=function(l){return!(l==null||!l._isBuffer)},T.byteLength=function(l,d){var b;switch(l+="",d||"utf8"){case"hex":b=l.length/2;break;case"utf8":case"utf-8":b=ke(l).length;break;case"ascii":case"binary":case"raw":b=l.length;break;case"base64":b=Me(l).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":b=2*l.length;break;default:throw new Error("Unknown encoding")}return b},T.concat=function(l,d){if(Y(se(l),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),l.length===0)return new T(0);if(l.length===1)return l[0];if(typeof d!="number")for(M=d=0;M<l.length;M++)d+=l[M].length;for(var b=new T(d),H=0,M=0;M<l.length;M++){var q=l[M];q.copy(b,H),H+=q.length}return b},T.prototype.write=function(l,d,b,H){isFinite(d)?isFinite(b)||(H=b,b=void 0):(re=H,H=d,d=b,b=re),d=Number(d)||0;var M,q,ne,de,re=this.length-d;switch((!b||re<(b=Number(b)))&&(b=re),H=String(H||"utf8").toLowerCase()){case"hex":M=function(Ce,be,Te,Pe){Te=Number(Te)||0;var he=Ce.length-Te;(!Pe||he<(Pe=Number(Pe)))&&(Pe=he),Y((he=be.length)%2==0,"Invalid hex string"),he/2<Pe&&(Pe=he/2);for(var we=0;we<Pe;we++){var Ge=parseInt(be.substr(2*we,2),16);Y(!isNaN(Ge),"Invalid hex string"),Ce[Te+we]=Ge}return T._charsWritten=2*we,we}(this,l,d,b);break;case"utf8":case"utf-8":q=this,ne=d,de=b,M=T._charsWritten=Se(ke(l),q,ne,de);break;case"ascii":case"binary":M=L(this,l,d,b);break;case"base64":q=this,ne=d,de=b,M=T._charsWritten=Se(Me(l),q,ne,de);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":M=A(this,l,d,b);break;default:throw new Error("Unknown encoding")}return M},T.prototype.toString=function(l,d,b){var H,M,q,ne,de=this;if(l=String(l||"utf8").toLowerCase(),d=Number(d)||0,(b=b!==void 0?Number(b):de.length)===d)return"";switch(l){case"hex":H=function(re,Ce,be){var Te=re.length;(!Ce||Ce<0)&&(Ce=0),(!be||be<0||Te<be)&&(be=Te);for(var Pe="",he=Ce;he<be;he++)Pe+=ae(re[he]);return Pe}(de,d,b);break;case"utf8":case"utf-8":H=function(re,Ce,be){var Te="",Pe="";be=Math.min(re.length,be);for(var he=Ce;he<be;he++)re[he]<=127?(Te+=Re(Pe)+String.fromCharCode(re[he]),Pe=""):Pe+="%"+re[he].toString(16);return Te+Re(Pe)}(de,d,b);break;case"ascii":case"binary":H=N(de,d,b);break;case"base64":M=de,ne=b,H=(q=d)===0&&ne===M.length?k.fromByteArray(M):k.fromByteArray(M.slice(q,ne));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":H=function(re,Ce,be){for(var Te=re.slice(Ce,be),Pe="",he=0;he<Te.length;he+=2)Pe+=String.fromCharCode(Te[he]+256*Te[he+1]);return Pe}(de,d,b);break;default:throw new Error("Unknown encoding")}return H},T.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},T.prototype.copy=function(l,d,b,H){if(d=d||0,(H=H||H===0?H:this.length)!==(b=b||0)&&l.length!==0&&this.length!==0){Y(b<=H,"sourceEnd < sourceStart"),Y(0<=d&&d<l.length,"targetStart out of bounds"),Y(0<=b&&b<this.length,"sourceStart out of bounds"),Y(0<=H&&H<=this.length,"sourceEnd out of bounds"),H>this.length&&(H=this.length);var M=(H=l.length-d<H-b?l.length-d+b:H)-b;if(M<100||!T._useTypedArrays)for(var q=0;q<M;q++)l[q+d]=this[q+b];else l._set(this.subarray(b,b+M),d)}},T.prototype.slice=function(l,d){var b=this.length;if(l=pe(l,b,0),d=pe(d,b,b),T._useTypedArrays)return T._augment(this.subarray(l,d));for(var H=d-l,M=new T(H,void 0,!0),q=0;q<H;q++)M[q]=this[q+l];return M},T.prototype.get=function(l){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(l)},T.prototype.set=function(l,d){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(l,d)},T.prototype.readUInt8=function(l,d){if(d||(Y(l!=null,"missing offset"),Y(l<this.length,"Trying to read beyond buffer length")),!(l>=this.length))return this[l]},T.prototype.readUInt16LE=function(l,d){return B(this,l,!0,d)},T.prototype.readUInt16BE=function(l,d){return B(this,l,!1,d)},T.prototype.readUInt32LE=function(l,d){return J(this,l,!0,d)},T.prototype.readUInt32BE=function(l,d){return J(this,l,!1,d)},T.prototype.readInt8=function(l,d){if(d||(Y(l!=null,"missing offset"),Y(l<this.length,"Trying to read beyond buffer length")),!(l>=this.length))return 128&this[l]?-1*(255-this[l]+1):this[l]},T.prototype.readInt16LE=function(l,d){return w(this,l,!0,d)},T.prototype.readInt16BE=function(l,d){return w(this,l,!1,d)},T.prototype.readInt32LE=function(l,d){return g(this,l,!0,d)},T.prototype.readInt32BE=function(l,d){return g(this,l,!1,d)},T.prototype.readFloatLE=function(l,d){return f(this,l,!0,d)},T.prototype.readFloatBE=function(l,d){return f(this,l,!1,d)},T.prototype.readDoubleLE=function(l,d){return m(this,l,!0,d)},T.prototype.readDoubleBE=function(l,d){return m(this,l,!1,d)},T.prototype.writeUInt8=function(l,d,b){b||(Y(l!=null,"missing value"),Y(d!=null,"missing offset"),Y(d<this.length,"trying to write beyond buffer length"),Je(l,255)),d>=this.length||(this[d]=l)},T.prototype.writeUInt16LE=function(l,d,b){p(this,l,d,!0,b)},T.prototype.writeUInt16BE=function(l,d,b){p(this,l,d,!1,b)},T.prototype.writeUInt32LE=function(l,d,b){O(this,l,d,!0,b)},T.prototype.writeUInt32BE=function(l,d,b){O(this,l,d,!1,b)},T.prototype.writeInt8=function(l,d,b){b||(Y(l!=null,"missing value"),Y(d!=null,"missing offset"),Y(d<this.length,"Trying to write beyond buffer length"),nt(l,127,-128)),d>=this.length||(0<=l?this.writeUInt8(l,d,b):this.writeUInt8(255+l+1,d,b))},T.prototype.writeInt16LE=function(l,d,b){C(this,l,d,!0,b)},T.prototype.writeInt16BE=function(l,d,b){C(this,l,d,!1,b)},T.prototype.writeInt32LE=function(l,d,b){ce(this,l,d,!0,b)},T.prototype.writeInt32BE=function(l,d,b){ce(this,l,d,!1,b)},T.prototype.writeFloatLE=function(l,d,b){le(this,l,d,!0,b)},T.prototype.writeFloatBE=function(l,d,b){le(this,l,d,!1,b)},T.prototype.writeDoubleLE=function(l,d,b){oe(this,l,d,!0,b)},T.prototype.writeDoubleBE=function(l,d,b){oe(this,l,d,!1,b)},T.prototype.fill=function(l,d,b){if(d=d||0,b=b||this.length,Y(typeof(l=typeof(l=l||0)=="string"?l.charCodeAt(0):l)=="number"&&!isNaN(l),"value is not a number"),Y(d<=b,"end < start"),b!==d&&this.length!==0){Y(0<=d&&d<this.length,"start out of bounds"),Y(0<=b&&b<=this.length,"end out of bounds");for(var H=d;H<b;H++)this[H]=l}},T.prototype.inspect=function(){for(var l=[],d=this.length,b=0;b<d;b++)if(l[b]=ae(this[b]),b===o.INSPECT_MAX_BYTES){l[b+1]="...";break}return"<Buffer "+l.join(" ")+">"},T.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(T._useTypedArrays)return new T(this).buffer;for(var l=new Uint8Array(this.length),d=0,b=l.length;d<b;d+=1)l[d]=this[d];return l.buffer};var ee=T.prototype;function pe(l,d,b){return typeof l!="number"?b:d<=(l=~~l)?d:0<=l||0<=(l+=d)?l:0}function ye(l){return(l=~~Math.ceil(+l))<0?0:l}function se(l){return(Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"})(l)}function ae(l){return l<16?"0"+l.toString(16):l.toString(16)}function ke(l){for(var d=[],b=0;b<l.length;b++){var H=l.charCodeAt(b);if(H<=127)d.push(l.charCodeAt(b));else for(var M=b,q=(55296<=H&&H<=57343&&b++,encodeURIComponent(l.slice(M,b+1)).substr(1).split("%")),ne=0;ne<q.length;ne++)d.push(parseInt(q[ne],16))}return d}function Me(l){return k.toByteArray(l)}function Se(l,d,b,H){for(var M=0;M<H&&!(M+b>=d.length||M>=l.length);M++)d[M+b]=l[M];return M}function Re(l){try{return decodeURIComponent(l)}catch{return String.fromCharCode(65533)}}function Je(l,d){Y(typeof l=="number","cannot write a non-number as a number"),Y(0<=l,"specified a negative value for writing an unsigned value"),Y(l<=d,"value is larger than maximum value for type"),Y(Math.floor(l)===l,"value has a fractional component")}function nt(l,d,b){Y(typeof l=="number","cannot write a non-number as a number"),Y(l<=d,"value larger than maximum allowed value"),Y(b<=l,"value smaller than minimum allowed value"),Y(Math.floor(l)===l,"value has a fractional component")}function Ve(l,d,b){Y(typeof l=="number","cannot write a non-number as a number"),Y(l<=d,"value larger than maximum allowed value"),Y(b<=l,"value smaller than minimum allowed value")}function Y(l,d){if(!l)throw new Error(d||"Failed assertion")}T._augment=function(l){return l._isBuffer=!0,l._get=l.get,l._set=l.set,l.get=ee.get,l.set=ee.set,l.write=ee.write,l.toString=ee.toString,l.toLocaleString=ee.toString,l.toJSON=ee.toJSON,l.copy=ee.copy,l.slice=ee.slice,l.readUInt8=ee.readUInt8,l.readUInt16LE=ee.readUInt16LE,l.readUInt16BE=ee.readUInt16BE,l.readUInt32LE=ee.readUInt32LE,l.readUInt32BE=ee.readUInt32BE,l.readInt8=ee.readInt8,l.readInt16LE=ee.readInt16LE,l.readInt16BE=ee.readInt16BE,l.readInt32LE=ee.readInt32LE,l.readInt32BE=ee.readInt32BE,l.readFloatLE=ee.readFloatLE,l.readFloatBE=ee.readFloatBE,l.readDoubleLE=ee.readDoubleLE,l.readDoubleBE=ee.readDoubleBE,l.writeUInt8=ee.writeUInt8,l.writeUInt16LE=ee.writeUInt16LE,l.writeUInt16BE=ee.writeUInt16BE,l.writeUInt32LE=ee.writeUInt32LE,l.writeUInt32BE=ee.writeUInt32BE,l.writeInt8=ee.writeInt8,l.writeInt16LE=ee.writeInt16LE,l.writeInt16BE=ee.writeInt16BE,l.writeInt32LE=ee.writeInt32LE,l.writeInt32BE=ee.writeInt32BE,l.writeFloatLE=ee.writeFloatLE,l.writeFloatBE=ee.writeFloatBE,l.writeDoubleLE=ee.writeDoubleLE,l.writeDoubleBE=ee.writeDoubleBE,l.fill=ee.fill,l.inspect=ee.inspect,l.toArrayBuffer=ee.toArrayBuffer,l}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,o){(function(r,c,k,E,v,x,D,F,K){var k=t("buffer").Buffer,R=4,T=new k(R);T.fill(0),n.exports={hash:function(L,A,N,B){for(var J=A(function(p,O){p.length%R!=0&&(C=p.length+(R-p.length%R),p=k.concat([p,T],C));for(var C,ce=[],le=O?p.readInt32BE:p.readInt32LE,oe=0;oe<p.length;oe+=R)ce.push(le.call(p,oe));return ce}(L=k.isBuffer(L)?L:new k(L),B),8*L.length),A=B,w=new k(N),g=A?w.writeInt32BE:w.writeInt32LE,f=0;f<J.length;f++)g.call(w,J[f],4*f,!0);return w}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,o){(function(r,c,k,E,v,x,D,F,K){var k=t("buffer").Buffer,R=t("./sha"),T=t("./sha256"),L=t("./rng"),A={sha1:R,sha256:T,md5:t("./md5")},N=64,B=new k(N);function J(p,O){var C=A[p=p||"sha1"],ce=[];return C||w("algorithm:",p,"is not yet supported"),{update:function(le){return k.isBuffer(le)||(le=new k(le)),ce.push(le),le.length,this},digest:function(le){var oe=k.concat(ce),oe=O?function(ee,pe,ye){k.isBuffer(pe)||(pe=new k(pe)),k.isBuffer(ye)||(ye=new k(ye)),pe.length>N?pe=ee(pe):pe.length<N&&(pe=k.concat([pe,B],N));for(var se=new k(N),ae=new k(N),ke=0;ke<N;ke++)se[ke]=54^pe[ke],ae[ke]=92^pe[ke];return ye=ee(k.concat([se,ye])),ee(k.concat([ae,ye]))}(C,O,oe):C(oe);return ce=null,le?oe.toString(le):oe}}}function w(){var p=[].slice.call(arguments).join(" ");throw new Error([p,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}B.fill(0),o.createHash=function(p){return J(p)},o.createHmac=J,o.randomBytes=function(p,O){if(!O||!O.call)return new k(L(p));try{O.call(this,void 0,new k(L(p)))}catch(C){O(C)}};var g,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],m=function(p){o[p]=function(){w("sorry,",p,"is not implemented yet")}};for(g in f)m(f[g])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){var k=t("./helpers");function R(w,g){w[g>>5]|=128<<g%32,w[14+(g+64>>>9<<4)]=g;for(var f=1732584193,m=-271733879,p=-1732584194,O=271733878,C=0;C<w.length;C+=16){var ce=f,le=m,oe=p,ee=O,f=L(f,m,p,O,w[C+0],7,-680876936),O=L(O,f,m,p,w[C+1],12,-389564586),p=L(p,O,f,m,w[C+2],17,606105819),m=L(m,p,O,f,w[C+3],22,-1044525330);f=L(f,m,p,O,w[C+4],7,-176418897),O=L(O,f,m,p,w[C+5],12,1200080426),p=L(p,O,f,m,w[C+6],17,-1473231341),m=L(m,p,O,f,w[C+7],22,-45705983),f=L(f,m,p,O,w[C+8],7,1770035416),O=L(O,f,m,p,w[C+9],12,-1958414417),p=L(p,O,f,m,w[C+10],17,-42063),m=L(m,p,O,f,w[C+11],22,-1990404162),f=L(f,m,p,O,w[C+12],7,1804603682),O=L(O,f,m,p,w[C+13],12,-40341101),p=L(p,O,f,m,w[C+14],17,-1502002290),f=A(f,m=L(m,p,O,f,w[C+15],22,1236535329),p,O,w[C+1],5,-165796510),O=A(O,f,m,p,w[C+6],9,-1069501632),p=A(p,O,f,m,w[C+11],14,643717713),m=A(m,p,O,f,w[C+0],20,-373897302),f=A(f,m,p,O,w[C+5],5,-701558691),O=A(O,f,m,p,w[C+10],9,38016083),p=A(p,O,f,m,w[C+15],14,-660478335),m=A(m,p,O,f,w[C+4],20,-405537848),f=A(f,m,p,O,w[C+9],5,568446438),O=A(O,f,m,p,w[C+14],9,-1019803690),p=A(p,O,f,m,w[C+3],14,-187363961),m=A(m,p,O,f,w[C+8],20,1163531501),f=A(f,m,p,O,w[C+13],5,-1444681467),O=A(O,f,m,p,w[C+2],9,-51403784),p=A(p,O,f,m,w[C+7],14,1735328473),f=N(f,m=A(m,p,O,f,w[C+12],20,-1926607734),p,O,w[C+5],4,-378558),O=N(O,f,m,p,w[C+8],11,-2022574463),p=N(p,O,f,m,w[C+11],16,1839030562),m=N(m,p,O,f,w[C+14],23,-35309556),f=N(f,m,p,O,w[C+1],4,-1530992060),O=N(O,f,m,p,w[C+4],11,1272893353),p=N(p,O,f,m,w[C+7],16,-155497632),m=N(m,p,O,f,w[C+10],23,-1094730640),f=N(f,m,p,O,w[C+13],4,681279174),O=N(O,f,m,p,w[C+0],11,-358537222),p=N(p,O,f,m,w[C+3],16,-722521979),m=N(m,p,O,f,w[C+6],23,76029189),f=N(f,m,p,O,w[C+9],4,-640364487),O=N(O,f,m,p,w[C+12],11,-421815835),p=N(p,O,f,m,w[C+15],16,530742520),f=B(f,m=N(m,p,O,f,w[C+2],23,-995338651),p,O,w[C+0],6,-198630844),O=B(O,f,m,p,w[C+7],10,1126891415),p=B(p,O,f,m,w[C+14],15,-1416354905),m=B(m,p,O,f,w[C+5],21,-57434055),f=B(f,m,p,O,w[C+12],6,1700485571),O=B(O,f,m,p,w[C+3],10,-1894986606),p=B(p,O,f,m,w[C+10],15,-1051523),m=B(m,p,O,f,w[C+1],21,-2054922799),f=B(f,m,p,O,w[C+8],6,1873313359),O=B(O,f,m,p,w[C+15],10,-30611744),p=B(p,O,f,m,w[C+6],15,-1560198380),m=B(m,p,O,f,w[C+13],21,1309151649),f=B(f,m,p,O,w[C+4],6,-145523070),O=B(O,f,m,p,w[C+11],10,-1120210379),p=B(p,O,f,m,w[C+2],15,718787259),m=B(m,p,O,f,w[C+9],21,-343485551),f=J(f,ce),m=J(m,le),p=J(p,oe),O=J(O,ee)}return Array(f,m,p,O)}function T(w,g,f,m,p,O){return J((g=J(J(g,w),J(m,O)))<<p|g>>>32-p,f)}function L(w,g,f,m,p,O,C){return T(g&f|~g&m,w,g,p,O,C)}function A(w,g,f,m,p,O,C){return T(g&m|f&~m,w,g,p,O,C)}function N(w,g,f,m,p,O,C){return T(g^f^m,w,g,p,O,C)}function B(w,g,f,m,p,O,C){return T(f^(g|~m),w,g,p,O,C)}function J(w,g){var f=(65535&w)+(65535&g);return(w>>16)+(g>>16)+(f>>16)<<16|65535&f}n.exports=function(w){return k.hash(w,R,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){n.exports=function(k){for(var R,T=new Array(k),L=0;L<k;L++)!(3&L)&&(R=4294967296*Math.random()),T[L]=R>>>((3&L)<<3)&255;return T}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){var k=t("./helpers");function R(A,N){A[N>>5]|=128<<24-N%32,A[15+(N+64>>9<<4)]=N;for(var B,J,w,g=Array(80),f=1732584193,m=-271733879,p=-1732584194,O=271733878,C=-1009589776,ce=0;ce<A.length;ce+=16){for(var le=f,oe=m,ee=p,pe=O,ye=C,se=0;se<80;se++){g[se]=se<16?A[ce+se]:L(g[se-3]^g[se-8]^g[se-14]^g[se-16],1);var ae=T(T(L(f,5),(ae=m,J=p,w=O,(B=se)<20?ae&J|~ae&w:!(B<40)&&B<60?ae&J|ae&w|J&w:ae^J^w)),T(T(C,g[se]),(B=se)<20?1518500249:B<40?1859775393:B<60?-1894007588:-899497514)),C=O,O=p,p=L(m,30),m=f,f=ae}f=T(f,le),m=T(m,oe),p=T(p,ee),O=T(O,pe),C=T(C,ye)}return Array(f,m,p,O,C)}function T(A,N){var B=(65535&A)+(65535&N);return(A>>16)+(N>>16)+(B>>16)<<16|65535&B}function L(A,N){return A<<N|A>>>32-N}n.exports=function(A){return k.hash(A,R,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){function k(N,B){var J=(65535&N)+(65535&B);return(N>>16)+(B>>16)+(J>>16)<<16|65535&J}function R(N,B){var J,w=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),g=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);N[B>>5]|=128<<24-B%32,N[15+(B+64>>9<<4)]=B;for(var m,p,O=0;O<N.length;O+=16){for(var C=g[0],ce=g[1],le=g[2],oe=g[3],ee=g[4],pe=g[5],ye=g[6],se=g[7],ae=0;ae<64;ae++)f[ae]=ae<16?N[ae+O]:k(k(k((p=f[ae-2],L(p,17)^L(p,19)^A(p,10)),f[ae-7]),(p=f[ae-15],L(p,7)^L(p,18)^A(p,3))),f[ae-16]),J=k(k(k(k(se,L(p=ee,6)^L(p,11)^L(p,25)),ee&pe^~ee&ye),w[ae]),f[ae]),m=k(L(m=C,2)^L(m,13)^L(m,22),C&ce^C&le^ce&le),se=ye,ye=pe,pe=ee,ee=k(oe,J),oe=le,le=ce,ce=C,C=k(J,m);g[0]=k(C,g[0]),g[1]=k(ce,g[1]),g[2]=k(le,g[2]),g[3]=k(oe,g[3]),g[4]=k(ee,g[4]),g[5]=k(pe,g[5]),g[6]=k(ye,g[6]),g[7]=k(se,g[7])}return g}var T=t("./helpers"),L=function(N,B){return N>>>B|N<<32-B},A=function(N,B){return N>>>B};n.exports=function(N){return T.hash(N,R,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){o.read=function(k,R,T,L,O){var N,B,J=8*O-L-1,w=(1<<J)-1,g=w>>1,f=-7,m=T?O-1:0,p=T?-1:1,O=k[R+m];for(m+=p,N=O&(1<<-f)-1,O>>=-f,f+=J;0<f;N=256*N+k[R+m],m+=p,f-=8);for(B=N&(1<<-f)-1,N>>=-f,f+=L;0<f;B=256*B+k[R+m],m+=p,f-=8);if(N===0)N=1-g;else{if(N===w)return B?NaN:1/0*(O?-1:1);B+=Math.pow(2,L),N-=g}return(O?-1:1)*B*Math.pow(2,N-L)},o.write=function(k,R,T,L,A,C){var B,J,w=8*C-A-1,g=(1<<w)-1,f=g>>1,m=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=L?0:C-1,O=L?1:-1,C=R<0||R===0&&1/R<0?1:0;for(R=Math.abs(R),isNaN(R)||R===1/0?(J=isNaN(R)?1:0,B=g):(B=Math.floor(Math.log(R)/Math.LN2),R*(L=Math.pow(2,-B))<1&&(B--,L*=2),2<=(R+=1<=B+f?m/L:m*Math.pow(2,1-f))*L&&(B++,L/=2),g<=B+f?(J=0,B=g):1<=B+f?(J=(R*L-1)*Math.pow(2,A),B+=f):(J=R*Math.pow(2,f-1)*Math.pow(2,A),B=0));8<=A;k[T+p]=255&J,p+=O,J/=256,A-=8);for(B=B<<A|J,w+=A;0<w;k[T+p]=255&B,p+=O,B/=256,w-=8);k[T+p-O]|=128*C}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,o){(function(r,c,y,E,v,x,D,F,K){var k,R,T;function L(){}(r=n.exports={}).nextTick=(R=typeof window<"u"&&window.setImmediate,T=typeof window<"u"&&window.postMessage&&window.addEventListener,R?function(A){return window.setImmediate(A)}:T?(k=[],window.addEventListener("message",function(A){var N=A.source;N!==window&&N!==null||A.data!=="process-tick"||(A.stopPropagation(),0<k.length&&k.shift()())},!0),function(A){k.push(A),window.postMessage("process-tick","*")}):function(A){setTimeout(A,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=L,r.addListener=L,r.once=L,r.off=L,r.removeListener=L,r.removeAllListeners=L,r.emit=L,r.binding=function(A){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(A){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Mi);var Rr=Mi.exports;const Ft=Ai(Rr);class Br{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Ft(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Ft(e):String(e)]}getValue(e){return this.cache[this.useHash?Ft(e):String(e)]}isCached(e){return(this.useHash?Ft(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Rt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Vi(i,e){return i.x==e.x&&i.y==e.y}function Bt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function Tn(i,e){return(i%e+e)%e}async function Mr(){await j.contextMenu.create({id:`${_.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${_.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${_.EXTENSIONID}/hasVision`]===void 0);await j.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${_.EXTENSIONID}/hasVision`]=!0,n.metadata[`${_.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${_.EXTENSIONID}/visionRange`]=_.VISIONDEFAULT)):delete n.metadata[`${_.EXTENSIONID}/hasVision`]})}}),await j.contextMenu.create({id:`${_.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${_.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await j.scene.items.getItemAttachments(e);await j.scene.items.updateItems(t,n=>{for(const o of n)e.includes(o.attachedTo)&&(o.metadata[`${_.EXTENSIONID}/hasVision`]&&o.layer=="CHARACTER"?delete o.metadata[`${_.EXTENSIONID}/hasVision`]:o.layer=="CHARACTER"&&(o.metadata[`${_.EXTENSIONID}/hasVision`]=!0,o.metadata[`${_.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${_.EXTENSIONID}/visionRange`]=_.VISIONDEFAULT)))})}}}),await j.contextMenu.create({id:`${_.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${_.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${_.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${_.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${_.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await j.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${_.EXTENSIONID}/isVisionLine`]&&t.metadata[`${_.EXTENSIONID}/disabled`]?delete t.metadata[`${_.EXTENSIONID}/disabled`]:t.metadata[`${_.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${_.EXTENSIONID}/disabled`]=!0)})}}),await j.contextMenu.create({id:`${_.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${_.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${_.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${_.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${_.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${_.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${_.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${_.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await j.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${_.EXTENSIONID}/isVisionLine`]||t.metadata[`${_.ARMINDOID}/isVisionLine`])&&(t.metadata[`${_.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${_.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${_.EXTENSIONID}/oneSided`],delete t.metadata[`${_.ARMINDOID}/oneSided`]):(t.metadata[`${_.EXTENSIONID}/isVisionLine`]||t.metadata[`${_.ARMINDOID}/isVisionLine`])&&(t.metadata[`${_.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${_.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${_.EXTENSIONID}/oneSided`]="right",t.metadata[`${_.ARMINDOID}/oneSided`]="right"):(t.metadata[`${_.EXTENSIONID}/isVisionLine`]||t.metadata[`${_.ARMINDOID}/isVisionLine`])&&(t.metadata[`${_.EXTENSIONID}/oneSided`]="left",t.metadata[`${_.ARMINDOID}/oneSided`]="left")})}}),await j.contextMenu.create({id:`${_.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${_.EXTENSIONID}/hasAutohide`],value:void 0}]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${_.EXTENSIONID}/hasAutohide`]===void 0);await j.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${_.EXTENSIONID}/hasAutohide`]=!0:delete n.metadata[`${_.EXTENSIONID}/hasAutohide`]})}})}async function Vr(){await j.tool.create({id:`${_.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await j.tool.activateTool(`${_.EXTENSIONID}/vision-tool`)}})}async function jr(){await j.tool.createMode({id:`${_.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${_.EXTENSIONID}/vision-tool`]}}],onToolClick:On.onToolClick,onToolMove:On.onToolMove,onKeyDown:On.onKeyDown}),await j.tool.createMode({id:`${_.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${_.EXTENSIONID}/vision-tool`]}}],onToolClick:kn.onToolClick,onToolMove:kn.onToolMove,onKeyDown:kn.onKeyDown})}function Xr(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function Ur(i){let e=[];for(const t of i)for(let n=0;n<t.points.length-1;n++){let o,r;const c=qe.fromItem(t),y=qe.fromPosition(t.points[n]),E=qe.fromPosition(t.points[n+1]);o=qe.decompose(qe.multiply(c,y)).position,r=qe.decompose(qe.multiply(c,E)).position,e.push({startPosition:o,endPosition:r,originalShape:t,oneSided:t.metadata[`${_.EXTENSIONID}/oneSided`]})}return e}function Hr(i,e,t,n,o,r){let c=[],y=[t,n];const E=X.players.filter(R=>R.role=="GM");for(const R of e){const T=X.userId===R.createdUserId,L=E.some(N=>N.id==R.createdUserId);if(!T&&X.role!=="GM"&&!L)continue;const A=mt.getValue(R.id);if(c.push([]),!(A!==void 0&&Vi(A.player.position,R.position)))for(const N of i){const B=(R.position.x-N.startPosition.x)*(N.endPosition.y-N.startPosition.y)-(R.position.y-N.startPosition.y)*(N.endPosition.x-N.startPosition.x);if(N.oneSided!==void 0&&(N.oneSided=="right"&&B>0||N.oneSided=="left"&&B<0))continue;let J=N.startPosition.x,w=N.startPosition.y,g=N.endPosition.x,f=N.endPosition.y;if(J<o[0]||w<o[1]||J>o[0]+y[0]||w>o[1]+y[1]||g<o[0]||f<o[1]||g>o[0]+y[0]||f>o[1]+y[1])continue;const m={x:N.startPosition.x-R.position.x,y:N.startPosition.y-R.position.y},p={x:N.endPosition.x-R.position.x,y:N.endPosition.y-R.position.y};var v={x:0,y:0},x={x:0,y:0},D=0,F=0,K=0,k=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
m.x<0?D=o[0]*r[0]:D=(t+o[0])*r[0],m.y<0?F=o[1]*r[1]:F=(n+o[1])*r[1],p.x<0?K=o[0]*r[0]:K=(t+o[0])*r[0],p.y<0?k=o[1]*r[1]:k=(n+o[1])*r[1];const O=[],C=[];if(m.x!=0){const se=m.y/m.x,ae=N.startPosition.y-se*N.startPosition.x;O.push({x:D,y:se*D+ae})}if(m.y!=0){const se=m.x/m.y,ae=se*N.startPosition.y-N.startPosition.x;O.push({x:se*F-ae,y:F})}if(p.x!=0){const se=p.y/p.x,ae=N.endPosition.y-se*N.endPosition.x;C.push({x:K,y:se*K+ae})}if(p.y!=0){const se=p.x/p.y,ae=se*N.endPosition.y-N.endPosition.x;C.push({x:se*k-ae,y:k})}O.length==1||Rt(O[0],N.startPosition)<Rt(O[1],N.startPosition)?v=O[0]:v=O[1],C.length==1||Rt(C[0],N.endPosition)<Rt(C[1],N.endPosition)?x=C[0]:x=C[1];const ce=[{x:N.startPosition.x,y:N.startPosition.y},v,x,{x:N.endPosition.x,y:N.endPosition.y}],le=[{x:(t+o[0])*r[0],y:o[1]*r[1]},{x:(t+o[0])*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:o[1]*r[1]}],oe=[0,0];let ee=0;for(const se of[v,x])Bt(se.y,o[1]*r[1])?oe[ee]=0:Bt(se.y,(n+o[1])*r[1])?oe[ee]=2:Bt(se.x,o[0]*r[0])?oe[ee]=3:Bt(se.x,(t+o[0])*r[0])&&(oe[ee]=1),ee++;let pe=Math.sign(B);pe=pe==0?1:-pe;const ye=pe==1?oe[1]:Tn(oe[1]-1,4);for(let se=oe[0]+(pe==1?0:-1);Tn(se,4)!=ye;se+=pe)ce.splice(ce.length-2,0,le[Tn(se,4)]);c[c.length-1].push({pointset:ce,fromShape:N.originalShape})}}return c}var xe,dt=!1;const mt=new Br(!1);async function Wr(i){if(dt=!0,xe||(xe=await Nr({locateFile:()=>xr})),!await j.scene.isReady()){mt.invalidate((l,d)=>d.shadowPath.delete()),dt=!1;return}const e=[];for(let l=0;l<=6;l++)e.push(new Bn);e[1].start();const{awaitTimer:t,computeTimer:n,metadata:o,visionShapes:r,tokensWithVision:c,invalidateCache:y}=i.detail;let E=i.detail.size,v=i.detail.offset,x=i.detail.scale,[D,F]=E;if(X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]===!0){const l=await j.scene.items.getItems(b=>b.layer==="MAP");let d=[];for(let b of l){let H=X.gridDpi/b.grid.dpi,M=b.position.x-H*b.grid.offset.x*b.scale.x,q=b.position.y-H*b.grid.offset.y*b.scale.y,ne=M+H*b.image.width*b.scale.x,de=q+H*b.image.height*b.scale.y;d.length?(M<d[0]&&(d[0]=M),q<d[1]&&(d[1]=q),ne>d[2]&&(d[2]=ne),de>d[3]&&(d[3]=de)):(d[0]=M,d[1]=q,d[2]=ne,d[3]=de)}v=[d[0],d[1]],E=[d[2]-d[0],d[3]-d[1]],x=[1,1],[D,F]=E}let k=0,R=0;if(y&&mt.invalidate((l,d)=>d.shadowPath.delete()),n.resume(),!(o[`${_.EXTENSIONID}/visionEnabled`]===!0)||c.length==0){const l=await j.scene.local.getItems(Rn);await j.scene.local.deleteItems(l.map(d=>d.id)),dt=!1;return}const L=Ur(r),A=Hr(L,c,D,F,v,x);if(A.length==0){dt=!1;return}const N=[];e[1].pause(),e[2].start();const B={};for(let l=0;l<A.length;l++){const d=c[l];let b=mt.getValue(d.id);if(b!==void 0&&Vi(b.player.position,d.position)){B[l]=b.shadowPath.copy(),k++;continue}R++;const H=A[l],M=new xe.SkOpBuilder,q=xe.NewPath().rect(v[0],v[1],E[0],E[1]);M.add(q,xe.PathOp.UNION),q.delete();for(const de of H){const re=de.fromShape,Ce=xe.NewPath();Ce.moveTo(de.pointset[0].x,de.pointset[0].y);for(let be=1;be<de.pointset.length;be++)Ce.lineTo(de.pointset[be].x,de.pointset[be].y);if(re.style.closed!=!1){const be=xe.NewPath();be.moveTo(re.points[0].x*re.scale.x+re.position.x,re.points[0].y*re.scale.y+re.position.y);for(let Te=1;Te<re.points.length-1;Te++)be.lineTo(re.points[Te].x*re.scale.x+re.position.x,re.points[Te].y*re.scale.y+re.position.y);Ce.op(be,xe.PathOp.DIFFERENCE),be.delete()}M.add(Ce,xe.PathOp.DIFFERENCE),Ce.delete()}const ne=M.resolve();if(!ne){console.error("Couldn't compute fog"),dt=!1;return}if(M.delete(),ne!==void 0){ne.simplify(),B[l]=ne;let de=mt.getValue(d.id);de!==void 0&&de.shadowPath.delete(),mt.cacheValue(d.id,{shadowPath:ne.copy(),player:d})}}const J=X.items.filter(Xt),w=[];for(let l=0;l<c.length;l++){if(Xt(c[l]))continue;const d=c[l];for(let b=0;b<J.length;b++)w.push({token:d,torch:J[b],visible:!0})}e[2].pause(),e[3].start();const g=[],f=xe.NewPath();for(let l=0;l<c.length;l++){const d=c[l],b=d.metadata[`${_.EXTENSIONID}/visionRange`],H=X.players.filter(re=>re.role=="GM"),M=X.userId===c[l].createdUserId,q=H.some(re=>re.id==c[l].createdUserId),ne=Xt(d),de=w.some(re=>re.torch.id==d.id&&re.visible);if(ne&&!de){delete c[l],delete B[l];continue}else ne?g[l]=!0:f.op(B[l],xe.PathOp.UNION);if(b){if(!M&&X.role!=="GM"&&!q)continue;const re=X.gridDpi*(b/X.gridScale+.5),Ce=xe.NewPath().ellipse(d.position.x,d.position.y,re,re,0,0,2*Math.PI);B[l]?.op(Ce,xe.PathOp.INTERSECT),Ce.delete();const be=X.players.find(Te=>Te.id===d.createdUserId);if(be&&X.role==="GM"&&!ne){const Te=yt().strokeColor(be.color).fillOpacity(0).position({x:d.position.x,y:d.position.y}).width(re*2).height(re*2).shapeType("CIRCLE").metadata({[`${_.EXTENSIONID}/isIndicatorRing`]:!0}).build();N.push(Te)}}}f.simplify();for(let l=0;l<g.length;l++)g[l]===!0&&(B[l].op(f,xe.PathOp.INTERSECT),B[l].simplify());f.delete(),e[3].pause(),e[4].start();const m=[],p=[],O=X.metadata[`${_.EXTENSIONID}/persistenceEnabled`]===!0,C=X.metadata[`${_.EXTENSIONID}/fowEnabled`]===!0,ce=xe.NewPath(),le={},oe=await j.scene.local.getItems(Rn),ee=await j.scene.local.getItems(Er);C&&ce.rect(v[0],v[1],E[0],E[1]);let pe=O&&!0,ye=[],se;if(pe)if(ye=await j.scene.local.getItems(Ot),se=new xe.SkOpBuilder,le.reuse=!0,ye.length===0){const l=En().commands([]).fillRule("nonzero").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${_.EXTENSIONID}/isVisionFog`]:!0,[`${_.EXTENSIONID}/digest`]:"reuse"}).build();l.zIndex=3,await j.scene.local.addItems([l]),ye=await j.scene.local.getItems(Ot)}else{let l=xe.FromCmds(ye[0].commands);se.add(l,xe.PathOp.UNION),l.delete()}const ae=new xe.SkOpBuilder;let ke=!1;for(const l of Object.keys(B)){const d=B[l],H=new TextEncoder().encode(d.toCmds().toString()),M=await crypto.subtle.digest("SHA-1",H).then(ne=>[...new Uint8Array(ne)].map(de=>de.toString(16).padStart(2,"0")).join(""));oe.filter(ne=>Ot(ne)&&ne.metadata[`${_.EXTENSIONID}/digest`]===M).length===0?pe?se.add(d,xe.PathOp.UNION):m.push({cmds:d.toCmds(),visible:!1,zIndex:3,playerId:c[l].id,digest:M}):le[M]=!0,C&&(ce.op(d,xe.PathOp.DIFFERENCE),X.role==="GM"&&(ke=!0,ae.add(d,xe.PathOp.UNION))),d.delete()}pe&&(await j.scene.local.updateItems([ye[0].id],l=>{let d=se.resolve();d.setFillType(xe.FillType.EVENODD),l[0].commands=d.toCmds(),d.delete()}),se.delete());let Me;ke&&(Me=ae.resolve()),ae.delete();const Se=oe.filter(jt),Re=oe.filter(l=>{const d=l.metadata[`${_.EXTENSIONID}/digest`];return Ot(l)&&le[d]===void 0});if(C){let l=X.metadata[`${_.EXTENSIONID}/fowColor`]?X.metadata[`${_.EXTENSIONID}/fowColor`]:"#00000088",d=.5;l.length==9&&(d=Number.parseInt(l.substring(7),16)/255,l=l.substring(0,7));const b=En().commands(ce.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(l).fillOpacity(d).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${_.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();b.disableHit=!0,Se.length>0?j.scene.local.updateItems(jt,H=>{for(const M of H)M.commands=b.commands},!1):p.push(j.scene.local.addItems([b]))}else p.push(j.scene.local.deleteItems(oe.filter(jt).map(l=>l.id)));ce.delete(),e[4].pause(),e[5].start(),n.pause(),t.resume(),j.scene.local.deleteItems(ee.map(l=>l.id)),j.scene.local.addItems(m.map(l=>{const d=En().commands(l.cmds).locked(!0).visible(l.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${_.EXTENSIONID}/isVisionFog`]:!0,[`${_.EXTENSIONID}/digest`]:l.digest}).build();return d.zIndex=l.zIndex,d})),O||j.scene.local.deleteItems(Re.map(l=>l.id)),N.length>0&&j.scene.local.addItems(N),X.fog.filled||j.scene.fog.setFilled(!0);let Je=0;e[5].pause(),e[6].start(),ke&&(zr(Me),Me.delete()),e[6].pause();const[nt,Ve]=[t.stop(),n.stop()],Y={compute_time:`${Ve} ms`,communication_time:`${nt} ms`,cache_hits:k.toString(),cache_misses:R.toString(),item_counter:Je.toString()};for(let l=1;l<=6;l++){const d=e[l].stop();Y["stage"+l]=`${d} ms`}Xr(Y),dt=!1}document.addEventListener("updateVision",Wr);async function zr(i){const e=[],t=X.items.filter(Ci);i.simplify();for(const n of t){const o=new xe.SkOpBuilder,r=xe.NewPath(),c=X.gridDpi/n.grid.dpi*(n.image.width/2)*n.scale.x;for(let v=0;v<6;v++){const x=v*60*Math.PI/180,D=n.position.x+c*Math.cos(x),F=n.position.y+c*Math.sin(x);v==0?r.moveTo(D,F):r.lineTo(D,F)}r.closePath(),o.add(r,xe.PathOp.UNION),o.add(i,xe.PathOp.INTERSECT);const y=o.resolve(),E=!y.toCmds().length;n.visible==E&&e.push(n),r.delete(),o.delete(),y.delete()}await j.scene.items.updateItems(e.map(n=>n.id),n=>{for(let o=0;o<n.length;o++)n[o].visible=!n[o].visible})}let An,Gr,li,_t=[],ci,Nn,ui,di,fi,pi;async function gt(i){if(dt||!await j.scene.isReady())return;document.querySelector("#debug_div");const[e,t]=[new Bn,new Bn];e.start(),e.pause(),t.start();const n=X.players.filter(f=>f.role=="GM"),o=X.items.filter(f=>f.layer=="CHARACTER"&&n.some(m=>f.createdUserId===m.id)&&(f.metadata[`${_.EXTENSIONID}/hasVision`]||f.metadata[`${_.ARMINDOID}/hasVision`])&&!f.metadata[`${_.EXTENSIONID}/visionBlind`]),c=(X.role=="GM"?X.items.filter(Sr):X.items.filter(Or).concat(o)).filter(f=>!Xt(f)||f.visible===!0),y=X.items.filter(_r),E=X.items.filter(Ci),v=X.items.filter(xi)?.[0],x=X.metadata[`${_.EXTENSIONID}/visionEnabled`]===!0,D=X.metadata[`${_.EXTENSIONID}/persistenceEnabled`]===!0,F=X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]===!0,K=X.metadata[`${_.EXTENSIONID}/fowEnabled`]===!0,k=X.metadata[`${_.EXTENSIONID}/fowColor`],R=[],T=[],L=[];if(v===void 0?(R[0]=0,R[1]=0,T[0]=1,T[1]=1,L[0]=0,L[1]=0):(R[0]=v.width*v.scale.x,R[1]=v.height*v.scale.y,T[0]=v.scale.x,T[1]=v.scale.y,L[0]=v.position.x,L[1]=v.position.y),X.role=="GM"){const f=document.getElementById("mapHeight"),m=document.getElementById("mapWidth");m.value=(Math.round(R[0])/X.gridDpi).toString(),f.value=(Math.round(R[1])/X.gridDpi).toString()}const A=JSON.stringify(y),N=JSON.stringify(E),B=JSON.stringify(c),J=JSON.stringify(v);if(J==Nn&&x==ci&&pi==k&&ui==F&&di==K&&fi==D&&An==A&&Gr==N&&li==B&&R[0]==_t[0]&&R[1]==_t[1]&&i!==!0)return;let w=!1;(J!=Nn||An!=A||R[0]!=_t[0]||R[1]!=_t[1])&&(w=!0),Nn=J,li=B,An=A,_t=R,ci=x,ui=F,di=K,pi=k,fi=D,t.pause();const g=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:X.items,metadata:X.metadata,size:R,offset:L,scale:T,tokensWithVision:c,visionShapes:y,invalidateCache:w}});dt||document.dispatchEvent(g)}function xn(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class qr{constructor(){this._events=void 0,this._events={}}on(e,t){xn(e,n=>{const o=this._events[n]||[];o.push(t),this._events[n]=o})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}xn(e,o=>{if(n===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var n=this;xn(e,o=>{const r=n._events[o];r!==void 0&&r.forEach(c=>{c.apply(n,t)})})}}function Kr(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const o=this,r=[];if(Array.isArray(e))e.forEach(c=>{typeof c=="string"?r.push(c):(o.plugins.settings[c.name]=c.options,r.push(c.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;n=r.shift();)o.require(n)}loadPlugin(e){var t=this,n=t.plugins,o=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const an=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Zr(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),ji=i=>{if(!Yr(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((o,r)=>{if(o===i[r-1]){t++;return}n(),e+=o,t=1}),n(),e},Xi=i=>{let e=Un(i);return an(e)},Yr=i=>new Set(i).size!==i.length,Nt=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Zr=i=>i.reduce((e,t)=>Math.max(e,Qr(t)),0),Qr=i=>Un(i).length,Un=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Ui=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Ui(t).forEach(function(o){let r=o.slice(0);r[0]=i.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(i.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Jr=[[0,65535]],eo="[̀-ͯ·ʾʼ]";let tn,Hi;const to=3,Hn={},hi={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in hi){let e=hi[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Hn[n]=i}}const no=new RegExp(Object.keys(Hn).join("|")+"|"+eo,"gu"),io=i=>{tn===void 0&&(tn=ao(i||Jr))},gi=(i,e="NFKD")=>i.normalize(e),nn=i=>Un(i).reduce((e,t)=>e+ro(t),""),ro=i=>(i=gi(i).toLowerCase().replace(no,e=>Hn[e]||""),gi(i,"NFC"));function*oo(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let o=String.fromCharCode(n),r=nn(o);r!=o.toLowerCase()&&(r.length>to||r.length!=0&&(yield{folded:r,composed:o,code_point:n}))}}const so=i=>{const e={},t=(n,o)=>{const r=e[n]||new Set,c=new RegExp("^"+Xi(r)+"$","iu");o.match(c)||(r.add(Nt(o)),e[n]=r)};for(let n of oo(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},ao=i=>{const e=so(i),t={};let n=[];for(let r in e){let c=e[r];c&&(t[r]=Xi(c)),r.length>1&&n.push(Nt(r))}n.sort((r,c)=>c.length-r.length);const o=an(n);return Hi=new RegExp("^"+o,"u"),t},lo=(i,e=1)=>{let t=0;return i=i.map(n=>(tn[n]&&(t+=n.length),tn[n]||n)),t>=e?ji(i):""},co=(i,e=1)=>(e=Math.max(e,i.length-1),an(Ui(i).map(t=>lo(t,e)))),mi=(i,e=!0)=>{let t=i.length>1?1:0;return an(i.map(n=>{let o=[];const r=e?n.length():n.length()-1;for(let c=0;c<r;c++)o.push(co(n.substrs[c]||"",t));return ji(o)}))},uo=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const o=c=>{for(const y of n){if(y.start===c.start&&y.substr===c.substr)return!1;if(!(c.length==1||y.length==1)&&(c.start<y.start&&c.end>y.start||y.start<c.start&&y.end>c.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class rn{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new rn,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const E of o)n.add(E);let c=t.substr.substring(0,e-r.start),y=c.length;return n.add({start:r.start,end:r.start+y,length:y,substr:c}),n}}const fo=i=>{io(),i=nn(i);let e="",t=[new rn];for(let n=0;n<i.length;n++){let r=i.substring(n).match(Hi);const c=i.substring(n,n+1),y=r?r[0]:null;let E=[],v=new Set;for(const x of t){const D=x.last();if(!D||D.length==1||D.end<=n)if(y){const F=y.length;x.add({start:n,end:n+F,length:F,substr:y}),v.add("1")}else x.add({start:n,end:n+1,length:1,substr:c}),v.add("2");else if(y){let F=x.clone(n,D);const K=y.length;F.add({start:n,end:n+K,length:K,substr:y}),E.push(F)}else v.add("3")}if(E.length>0){E=E.sort((x,D)=>x.length()-D.length());for(let x of E)uo(x,t)||t.push(x);continue}if(n>0&&v.size==1&&!v.has("3")){e+=mi(t,!1);let x=new rn;const D=t[0];D&&x.add(D.last()),t=[x]}}return e+=mi(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const po=(i,e)=>{if(i)return i[e]},ho=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},Cn=(i,e,t)=>{var n,o;return!i||(i=i+"",e.regex==null)||(o=i.search(e.regex),o===-1)?0:(n=e.string.length/i.length,o===0&&(n+=.5),n*t)},Pn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},We=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},go=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=nn(i+"").toLowerCase(),e=nn(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class mo{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var c;return n&&(c=new RegExp("^("+Object.keys(n).map(Nt).join("|")+"):(.*)$")),r.forEach(y=>{let E,v=null,x=null;c&&(E=y.match(c))&&(v=E[1],y=E[2]),y.length>0&&(this.settings.diacritics?x=fo(y)||null:x=Nt(y),x&&t&&(x="\\b"+x)),o.push({string:y,regex:x?new RegExp(x,"iu"):null,field:v})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const o=e.options.fields,r=e.weights,c=o.length,y=e.getAttrFn;if(!c)return function(){return 1};const E=function(){return c===1?function(v,x){const D=o[0].field;return Cn(y(x,D),v,r[D]||1)}:function(v,x){var D=0;if(v.field){const F=y(x,v.field);!v.regex&&F?D+=1/c:D+=Cn(F,v,1)}else We(r,(F,K)=>{D+=Cn(y(x,K),v,F)});return D/c}}();return n===1?function(v){return E(t[0],v)}:e.options.conjunction==="and"?function(v){var x,D=0;for(let F of t){if(x=E(F,v),x<=0)return 0;D+=x}return D/n}:function(v){var x=0;return We(t,D=>{x+=E(D,v)}),x/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const o=this,r=e.options,c=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof c=="function")return c.bind(this);const y=function(x,D){return x==="$score"?D.score:e.getAttrFn(o.items[D.id],x)};if(c)for(let v of c)(e.query||v.field!=="$score")&&n.push(v);if(e.query){t=!0;for(let v of n)if(v.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(v=>v.field!=="$score");return n.length?function(v,x){var D,F;for(let K of n)if(F=K.field,D=(K.direction==="desc"?-1:1)*go(y(F,v),y(F,x)),D)return D;return 0}:null}prepareSearch(e,t){const n={};var o=Object.assign({},t);if(Pn(o,"sort"),Pn(o,"sort_empty"),o.fields){Pn(o,"fields");const r=[];o.fields.forEach(c=>{typeof c=="string"&&(c={field:c,weight:1}),r.push(c),n[c.field]="weight"in c?c.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:o.nesting?ho:po}}search(e,t){var n=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const c=t.score||n._getScoreFunction(r);e.length?We(n.items,(E,v)=>{o=c(E),(t.filter===!1||o>0)&&r.items.push({score:o,id:v})}):We(n.items,(E,v)=>{r.items.push({score:1,id:v})});const y=n._getSortFunction(r);return y&&r.items.sort(y),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const vt=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Be=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(Wi(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},Wi=i=>typeof i=="string"&&i.indexOf("<")>-1,vo=i=>i.replace(/['"\\]/g,"\\$&"),Dn=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Mt=(i,e)=>{Object.assign(i.style,e)},He=(i,...e)=>{var t=zi(e);i=Gi(i),i.map(n=>{t.map(o=>{n.classList.add(o)})})},at=(i,...e)=>{var t=zi(e);i=Gi(i),i.map(n=>{t.map(o=>{n.classList.remove(o)})})},zi=i=>{var e=[];return vt(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Gi=i=>(Array.isArray(i)||(i=[i]),i),Ut=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},vi=(i,e=0)=>e>0?i[i.length-1]:i[0],yo=i=>Object.keys(i).length===0,on=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},De=(i,e)=>{vt(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},Mn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},wo=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var c=r.data.match(e);if(c&&r.data.length>0){var y=document.createElement("span");y.className="highlight";var E=r.splitText(c.index);E.splitText(c[0].length);var v=E.cloneNode(!0);return y.appendChild(v),Mn(E,y),1}return 0},n=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(c=>{o(c)})},o=r=>r.nodeType===3?t(r):(n(r),0);o(i)},bo=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Io=65,Eo=13,qi=27,Vn=37,_o=38,Ki=39,So=40,yi=8,Oo=46,jn=9,ko=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Vt=ko?"metaKey":"ctrlKey";var wi={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Ye=i=>typeof i>"u"||i===null?null:Ht(i),Ht=i=>typeof i=="boolean"?i?"1":"0":i+"",Wt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),To=(i,e)=>{var t;return function(n,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[n]=!0,i.call(r,n,o)},e)}},bi=(i,e,t)=>{var n,o=i.trigger,r={};i.trigger=function(){var c=arguments[0];if(e.indexOf(c)!==-1)r[c]=arguments;else return o.apply(i,arguments)},t.apply(i,[]),i.trigger=o;for(n of e)n in r&&o.apply(i,r[n])},Ao=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),Oe=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},Le=(i,e,t,n)=>{i.addEventListener(e,t,n)},pt=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Ln=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},Ii=i=>i.replace(/[\\"']/g,"\\$&"),ht=(i,e)=>{e&&i.append(e)};function Ei(i,e){var t=Object.assign({},wi,e),n=t.dataAttr,o=t.labelField,r=t.valueField,c=t.disabledField,y=t.optgroupField,E=t.optgroupLabelField,v=t.optgroupValueField,x=i.tagName.toLowerCase(),D=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!D&&!t.allowEmptyOption){let R=i.querySelector('option[value=""]');R&&(D=R.textContent)}var F={placeholder:D,options:[],optgroups:[],items:[],maxItems:null},K=()=>{var R,T=F.options,L={},A=1,N=w=>{var g=Object.assign({},w.dataset),f=n&&g[n];return typeof f=="string"&&f.length&&(g=Object.assign(g,JSON.parse(f))),g},B=(w,g)=>{var f=Ye(w.value);if(f!=null&&!(!f&&!t.allowEmptyOption)){if(L.hasOwnProperty(f)){if(g){var m=L[f][y];m?Array.isArray(m)?m.push(g):L[f][y]=[m,g]:L[f][y]=g}}else{var p=N(w);p[o]=p[o]||w.textContent,p[r]=p[r]||f,p[c]=p[c]||w.disabled,p[y]=p[y]||g,p.$option=w,L[f]=p,T.push(p)}w.selected&&F.items.push(f)}},J=w=>{var g,f;f=N(w),f[E]=f[E]||w.getAttribute("label")||"",f[v]=f[v]||A++,f[c]=f[c]||w.disabled,F.optgroups.push(f),g=f[v],vt(w.children,m=>{B(m,g)})};F.maxItems=i.hasAttribute("multiple")?null:1,vt(i.children,w=>{R=w.tagName.toLowerCase(),R==="optgroup"?J(w):R==="option"&&B(w)})},k=()=>{const R=i.getAttribute(n);if(R)F.options=JSON.parse(R),vt(F.options,L=>{F.items.push(L[r])});else{var T=i.value.trim()||"";if(!t.allowEmptyOption&&!T.length)return;const L=T.split(t.delimiter);vt(L,A=>{const N={};N[o]=A,N[r]=A,F.options.push(N)}),F.items=L}};return x==="select"?K():k(),Object.assign({},wi,F,e)}var _i=0;class ze extends Kr(qr){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],_i++;var n,o=Be(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);n=r.getPropertyValue("direction");const c=Ei(o,t);this.settings=c,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=Ln(o,"tomselect-"+_i),this.isRequired=o.required,this.sifter=new mo(this.options,{diacritics:c.diacritics}),c.mode=c.mode||(c.maxItems===1?"single":"multi"),typeof c.hideSelected!="boolean"&&(c.hideSelected=c.mode==="multi"),typeof c.hidePlaceholder!="boolean"&&(c.hidePlaceholder=c.mode!=="multi");var y=c.createFilter;typeof y!="function"&&(typeof y=="string"&&(y=new RegExp(y)),y instanceof RegExp?c.createFilter=T=>y.test(T):c.createFilter=T=>this.settings.duplicates||!this.options[T]),this.initializePlugins(c.plugins),this.setupCallbacks(),this.setupTemplates();const E=Be("<div>"),v=Be("<div>"),x=this._render("dropdown"),D=Be('<div role="listbox" tabindex="-1">'),F=this.input.getAttribute("class")||"",K=c.mode;var k;if(He(E,c.wrapperClass,F,K),He(v,c.controlClass),ht(E,v),He(x,c.dropdownClass,K),c.copyClassesToDropdown&&He(x,F),He(D,c.dropdownContentClass),ht(x,D),Be(c.dropdownParent||E).appendChild(x),Wi(c.controlInput)){k=Be(c.controlInput);var R=["autocorrect","autocapitalize","autocomplete"];We(R,T=>{o.getAttribute(T)&&De(k,{[T]:o.getAttribute(T)})}),k.tabIndex=-1,v.appendChild(k),this.focus_node=k}else c.controlInput?(k=Be(c.controlInput),this.focus_node=k):(k=Be("<input/>"),this.focus_node=v);this.wrapper=E,this.dropdown=x,this.dropdown_content=D,this.control=v,this.control_input=k,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,o=e.dropdown,r=e.dropdown_content,c=e.wrapper,y=e.control,E=e.input,v=e.focus_node,x={passive:!0},D=e.inputId+"-ts-dropdown";De(r,{id:D}),De(v,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":D});const F=Ln(v,e.inputId+"-ts-control"),K="label[for='"+vo(e.inputId)+"']",k=document.querySelector(K),R=e.focus.bind(e);if(k){Le(k,"click",R),De(k,{for:F});const A=Ln(k,e.inputId+"-ts-label");De(v,{"aria-labelledby":A}),De(r,{"aria-labelledby":A})}if(c.style.width=E.style.width,e.plugins.names.length){const A="plugin-"+e.plugins.names.join(" plugin-");He([c,o],A)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&De(E,{multiple:"multiple"}),t.placeholder&&De(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Nt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=To(t.load,t.loadThrottle)),e.control_input.type=E.type,Le(o,"mousemove",()=>{e.ignoreHover=!1}),Le(o,"mouseenter",A=>{var N=Ut(A.target,"[data-selectable]",o);N&&e.onOptionHover(A,N)},{capture:!0}),Le(o,"click",A=>{const N=Ut(A.target,"[data-selectable]");N&&(e.onOptionSelect(A,N),Oe(A,!0))}),Le(y,"click",A=>{var N=Ut(A.target,"[data-ts-item]",y);if(N&&e.onItemSelect(A,N)){Oe(A,!0);return}n.value==""&&(e.onClick(),Oe(A,!0))}),Le(v,"keydown",A=>e.onKeyDown(A)),Le(n,"keypress",A=>e.onKeyPress(A)),Le(n,"input",A=>e.onInput(A)),Le(v,"blur",A=>e.onBlur(A)),Le(v,"focus",A=>e.onFocus(A)),Le(n,"paste",A=>e.onPaste(A));const T=A=>{const N=A.composedPath()[0];if(!c.contains(N)&&!o.contains(N)){e.isFocused&&e.blur(),e.inputState();return}N==n&&e.isOpen?A.stopPropagation():Oe(A,!0)},L=()=>{e.isOpen&&e.positionDropdown()};Le(document,"mousedown",T),Le(window,"scroll",L,x),Le(window,"resize",L,x),this._destroy=()=>{document.removeEventListener("mousedown",T),window.removeEventListener("scroll",L),window.removeEventListener("resize",L),k&&k.removeEventListener("click",R)},this.revertSettings={innerHTML:E.innerHTML,tabIndex:E.tabIndex},E.tabIndex=-1,E.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Le(E,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,E.disabled?e.disable():e.enable(),e.on("change",this.onChange),He(E,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),We(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,o={optgroup:r=>{let c=document.createElement("div");return c.className="optgroup",c.appendChild(r.options),c},optgroup_header:(r,c)=>'<div class="optgroup-header">'+c(r[n])+"</div>",option:(r,c)=>"<div>"+c(r[t])+"</div>",item:(r,c)=>"<div>"+c(r[t])+"</div>",option_create:(r,c)=>'<div class="create">Add <strong>'+c(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Ei(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Dn(this.input,"input"),Dn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Oe(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var o=n.trim().split(t.settings.splitOn);We(o,r=>{Ye(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Oe(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),Oe(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==jn&&Oe(e);return}switch(e.keyCode){case Io:if(pt(Vt,e)&&t.control_input.value==""){Oe(e),t.selectAll();return}break;case qi:t.isOpen&&(Oe(e,!0),t.close()),t.clearActiveItems();return;case So:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}Oe(e);return;case _o:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}Oe(e);return;case Eo:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Oe(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Oe(e);return;case Vn:t.advanceSelection(-1,e);return;case Ki:t.advanceSelection(1,e);return;case jn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Oe(e)),t.settings.create&&t.createItem()&&Oe(e));return;case yi:case Oo:t.deleteSelection(e);return}t.isInputHidden&&!pt(Vt,e)&&Oe(e)}onInput(e){var t=this;if(!t.isLocked){var n=t.inputValue();t.lastValue!==n&&(t.lastValue=n,t.settings.shouldLoad.call(t,n)&&t.load(n),t.refreshOptions(),t.trigger("type",n))}}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled){t.blur(),Oe(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.showInput(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(n=t.dataset.value,typeof n<"u"&&(o.lastQuery=null,o.addItem(n),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(Oe(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;He(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||at(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Dn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];bi(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,o,r,c,y,E,v;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.showInput();return}if(o=t&&t.type.toLowerCase(),o==="click"&&pt("shiftKey",t)&&n.activeItems.length){for(v=n.getLastActive(),c=Array.prototype.indexOf.call(n.control.children,v),y=Array.prototype.indexOf.call(n.control.children,e),c>y&&(E=c,c=y,y=E),r=c;r<=y;r++)e=n.control.children[r],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);Oe(t)}else o==="click"&&pt(Vt,t)||o==="keydown"&&pt("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.hideInput(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&at(n,"last-active"),He(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),at(e,"active")}clearActiveItems(){at(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,De(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),De(e,{"aria-selected":"true"}),He(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,o=n.clientHeight,r=n.scrollTop||0,c=e.offsetHeight,y=e.getBoundingClientRect().top-n.getBoundingClientRect().top+r;y+c>o+r?this.scroll(y-o+c,t):y<r&&this.scroll(y,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(at(this.activeOption,"active"),De(this.activeOption,{"aria-selected":null})),this.activeOption=null,De(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.hideInput(),e.close(),e.activeItems=t,We(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(De(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&De(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}hideInput(){this.inputState()}showInput(){this.inputState()}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,o=this,r=this.getSearchOptions();if(o.settings.score&&(n=o.settings.score.call(o,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:n})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(c=>{let y=Ye(c.id);return!(y&&o.items.indexOf(y)!==-1)})),t}refreshOptions(e=!0){var t,n,o,r,c,y,E,v,x,D;const F={},K=[];var k=this,R=k.inputValue();const T=R===k.lastQuery||R==""&&k.lastQuery==null;var L=k.search(R),A=null,N=k.settings.shouldOpen||!1,B=k.dropdown_content;for(T&&(A=k.activeOption,A&&(x=A.closest("[data-group]"))),r=L.items.length,typeof k.settings.maxOptions=="number"&&(r=Math.min(r,k.settings.maxOptions)),r>0&&(N=!0),t=0;t<r;t++){let w=L.items[t];if(!w)continue;let g=w.id,f=k.options[g];if(f===void 0)continue;let m=Ht(g),p=k.getOption(m,!0);for(k.settings.hideSelected||p.classList.toggle("selected",k.items.includes(m)),c=f[k.settings.optgroupField]||"",y=Array.isArray(c)?c:[c],n=0,o=y&&y.length;n<o;n++){c=y[n],k.optgroups.hasOwnProperty(c)||(c="");let O=F[c];O===void 0&&(O=document.createDocumentFragment(),K.push(c)),n>0&&(p=p.cloneNode(!0),De(p,{id:f.$id+"-clone-"+n,"aria-selected":null}),p.classList.add("ts-cloned"),at(p,"active"),k.activeOption&&k.activeOption.dataset.value==g&&x&&x.dataset.group===c.toString()&&(A=p)),O.appendChild(p),F[c]=O}}k.settings.lockOptgroupOrder&&K.sort((w,g)=>{const f=k.optgroups[w],m=k.optgroups[g],p=f&&f.$order||0,O=m&&m.$order||0;return p-O}),E=document.createDocumentFragment(),We(K,w=>{let g=F[w];if(!g||!g.children.length)return;let f=k.optgroups[w];if(f!==void 0){let m=document.createDocumentFragment(),p=k.render("optgroup_header",f);ht(m,p),ht(m,g);let O=k.render("optgroup",{group:f,options:m});ht(E,O)}else ht(E,g)}),B.innerHTML="",ht(B,E),k.settings.highlight&&(bo(B),L.query.length&&L.tokens.length&&We(L.tokens,w=>{wo(B,w.regex)}));var J=w=>{let g=k.render(w,{input:R});return g&&(N=!0,B.insertBefore(g,B.firstChild)),g};if(k.loading?J("loading"):k.settings.shouldLoad.call(k,R)?L.items.length===0&&J("no_results"):J("not_loading"),v=k.canCreate(R),v&&(D=J("option_create")),k.hasOptions=L.items.length>0||v,N){if(L.items.length>0){if(!A&&k.settings.mode==="single"&&k.items[0]!=null&&(A=k.getOption(k.items[0])),!B.contains(A)){let w=0;D&&!k.settings.addPrecedence&&(w=1),A=k.selectable()[w]}}else D&&(A=D);e&&!k.isOpen&&(k.open(),k.scrollToOption(A,"auto")),k.setActiveOption(A)}else k.clearActiveOption(),e&&k.isOpen&&k.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const o=Ye(e[n.settings.valueField]);return o===null||n.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[o]=e,n.lastQuery=null,t&&(n.userOptions[o]=t,n.trigger("option_add",o,e)),o)}addOptions(e,t=!1){We(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ye(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var o,r;const c=Ye(e),y=Ye(t[n.settings.valueField]);if(c===null)return;const E=n.options[c];if(E==null)return;if(typeof y!="string")throw new Error("Value must be set in option data");const v=n.getOption(c),x=n.getItem(c);if(t.$order=t.$order||E.$order,delete n.options[c],n.uncacheValue(y),n.options[y]=t,v){if(n.dropdown_content.contains(v)){const D=n._render("option",t);Mn(v,D),n.activeOption===v&&n.setActiveOption(D)}v.remove()}x&&(r=n.items.indexOf(c),r!==-1&&n.items.splice(r,1,y),o=n._render("item",t),x.classList.contains("active")&&He(o,"active"),Mn(x,o)),n.lastQuery=null}removeOption(e,t){const n=this;e=Ht(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};We(this.options,(o,r)=>{t(o,r)&&(n[r]=o)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Ye(e);if(n===null)return null;const o=this.options[n];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,n="option"){var o=this,r;if(!e)return null;n=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let c=0;c<r.length;c++)if(r[c]==e)return t>0?r[c+1]:r[c-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ye(e);return t!==null?this.control.querySelector(`[data-value="${Ii(t)}"]`):null}addItems(e,t){var n=this,o=Array.isArray(e)?e:[e];o=o.filter(c=>n.items.indexOf(c)===-1);const r=o[o.length-1];o.forEach(c=>{n.isPending=c!==r,n.addItem(c,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];bi(this,n,()=>{var o,r;const c=this,y=c.settings.mode,E=Ye(e);if(!(E&&c.items.indexOf(E)!==-1&&(y==="single"&&c.close(),y==="single"||!c.settings.duplicates))&&!(E===null||!c.options.hasOwnProperty(E))&&(y==="single"&&c.clear(t),!(y==="multi"&&c.isFull()))){if(o=c._render("item",c.options[E]),c.control.contains(o)&&(o=o.cloneNode(!0)),r=c.isFull(),c.items.splice(c.caretPos,0,E),c.insertAtCaret(o),c.isSetup){if(!c.isPending&&c.settings.hideSelected){let v=c.getOption(E),x=c.getAdjacent(v,1);x&&c.setActiveOption(x)}!c.isPending&&!c.settings.closeAfterSelect&&c.refreshOptions(c.isFocused&&y!=="single"),c.settings.closeAfterSelect!=!1&&c.isFull()?c.close():c.isPending||c.positionDropdown(),c.trigger("item_add",E,o),c.isPending||c.updateOriginalInput({silent:t})}(!c.isPending||!r&&c.isFull())&&(c.inputState(),c.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var o,r;const c=e.dataset.value;o=on(e),e.remove(),e.classList.contains("active")&&(r=n.activeItems.indexOf(e),n.activeItems.splice(r,1),at(e,"active")),n.items.splice(o,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(c)&&n.removeOption(c,t),o<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",c,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,o=n.caretPos,r;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var c=!1,y=E=>{if(n.unlock(),!E||typeof E!="object")return t();var v=Ye(E[n.settings.valueField]);if(typeof v!="string")return t();n.setTextboxValue(),n.addOption(E,!0),n.setCaret(o),n.addItem(v),t(E),c=!0};return typeof n.settings.create=="function"?r=n.settings.create.call(this,e,y):r={[n.settings.labelField]:e,[n.settings.valueField]:e},c||y(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",n),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",yo(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let E=function(v,x,D){return v||(v=Be('<option value="'+Wt(x)+'">'+Wt(D)+"</option>")),v!=r&&t.input.append(v),c.push(v),(v!=r||y>0)&&(v.selected=!0),v};const c=[],y=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(v=>{v.selected=!1}),t.items.length==0&&t.settings.mode=="single"?E(r,"",""):t.items.forEach(v=>{if(n=t.options[v],o=n[t.settings.labelField]||"",c.includes(n.$option)){const x=t.input.querySelector(`option[value="${Ii(v)}"]:not(:checked)`);E(x,v,o)}else n.$option=E(n.$option,v,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,De(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Mt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Mt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.hideInput()),t.isOpen=!1,De(t.focus_node,{"aria-expanded":"false"}),Mt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Mt(this.dropdown,{width:t.width+"px",top:n+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();We(n,o=>{t.removeItem(o,!0)}),t.showInput(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,o=t.control;o.insertBefore(e,o.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,o,r,c=this;t=e&&e.keyCode===yi?-1:1,n=Ao(c.control_input);const y=[];if(c.activeItems.length)r=vi(c.activeItems,t),o=on(r),t>0&&o++,We(c.activeItems,E=>y.push(E));else if((c.isFocused||c.settings.mode==="single")&&c.items.length){const E=c.controlChildren();let v;t<0&&n.start===0&&n.length===0?v=E[c.caretPos-1]:t>0&&n.start===c.inputValue().length&&(v=E[c.caretPos]),v!==void 0&&y.push(v)}if(!c.shouldDelete(y,e))return!1;for(Oe(e,!0),typeof o<"u"&&c.setCaret(o);y.length;)c.removeItem(y.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(o=>o.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(pt(Vt,t)||pt("shiftKey",t)?(n=r.getLastActive(e),n?n.classList.contains("active")?o=r.getAdjacent(n,e,"item"):o=n:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(n),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return vi(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.isLocked=!0,this.refreshState()}unlock(){this.isLocked=!1,this.refreshState()}disable(){var e=this;e.input.disabled=!0,e.control_input.disabled=!0,e.focus_node.tabIndex=-1,e.isDisabled=!0,this.close(),e.lock()}enable(){var e=this;e.input.disabled=!1,e.control_input.disabled=!1,e.focus_node.tabIndex=e.tabIndex,e.isDisabled=!1,e.unlock()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,at(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,Wt),!o))return null;if(o=Be(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?De(o,{"aria-disabled":"true"}):De(o,{"data-selectable":""}):e==="optgroup"&&(n=t.group[r.settings.optgroupValueField],De(o,{"data-group":n}),t.group[r.settings.disabledField]&&De(o,{"data-disabled":""})),e==="option"||e==="item"){const c=Ht(t[r.settings.valueField]);De(o,{"data-value":c}),e==="item"?(He(o,r.settings.itemClass),De(o,{"data-ts-item":""})):(He(o,r.settings.optionClass),De(o,{role:"option",id:t.$id}),t.$div=o,r.options[c]=t)}return o}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){We(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var o=this,r=o[t];o[t]=function(){var c,y;return e==="after"&&(c=r.apply(o,arguments)),y=n.apply(o,arguments),e==="instead"?y:(e==="before"&&(c=r.apply(o,arguments)),c)}}}function No(){Le(this.input,"change",()=>{this.sync()})}function xo(){var i=this,e=i.onOptionSelect;i.settings.hideSelected=!1;var t=function(o){setTimeout(()=>{var r=o.querySelector("input");r instanceof HTMLInputElement&&(o.classList.contains("selected")?r.checked=!0:r.checked=!1)},1)};i.hook("after","setupTemplates",()=>{var n=i.settings.render.option;i.settings.render.option=(o,r)=>{var c=Be(n.call(i,o,r)),y=document.createElement("input");y.addEventListener("click",function(v){Oe(v)}),y.type="checkbox";const E=Ye(o[i.settings.valueField]);return E&&i.items.indexOf(E)>-1&&(y.checked=!0),c.prepend(y),c}}),i.on("item_remove",n=>{var o=i.getOption(n);o&&(o.classList.remove("selected"),t(o))}),i.on("item_add",n=>{var o=i.getOption(n);o&&t(o)}),i.hook("instead","onOptionSelect",(n,o)=>{if(o.classList.contains("selected")){o.classList.remove("selected"),i.removeItem(o.dataset.value),i.refreshOptions(),Oe(n,!0);return}e.call(i,n,o),t(o)})}function Co(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Be(t.html(t));n.addEventListener("click",o=>{e.isDisabled||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(n)})}function Po(){var i=this;if(!$.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(i.settings.mode==="multi"){var e=i.lock,t=i.unlock;i.hook("instead","lock",()=>{var n=$(i.control).data("sortable");return n&&n.disable(),e.call(i)}),i.hook("instead","unlock",()=>{var n=$(i.control).data("sortable");return n&&n.enable(),t.call(i)}),i.on("initialize",()=>{var n=$(i.control).sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:i.isLocked,start:(o,r)=>{r.placeholder.css("width",r.helper.css("width")),n.css({overflow:"visible"})},stop:()=>{n.css({overflow:"hidden"});var o=[];n.children("[data-value]").each(function(){this.dataset.value&&o.push(this.dataset.value)}),i.setValue(o)}})})}}function Do(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Be(t.html(t)),o=n.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Oe(r,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function Lo(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=on(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),at(t,"last-active")}else i.setCaret(i.caretPos+e)})}function $o(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,He(i.control_input,"dropdown-input");const e=Be('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Be('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case qi:i.isOpen&&(Oe(t,!0),i.close()),i.clearActiveItems();return;case jn:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),Le(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function Fo(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of n)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),i.on("update item_add item_remove",o),Le(t,"input",o),Le(t,"keyup",o),Le(t,"blur",o),Le(t,"update",o)})}function Ro(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function Bo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function Mo(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,o,r,c;if(!i.isOpen||!(t.keyCode===Vn||t.keyCode===Ki))return e.call(i,t);i.ignoreHover=!0,c=Ut(i.activeOption,"[data-group]"),n=on(i.activeOption,"[data-selectable]"),c&&(t.keyCode===Vn?c=c.previousSibling:c=c.nextSibling,c&&(r=c.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,n)],o&&i.setActiveOption(o)))})}function Vo(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Wt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,c)=>{var y=Be(o.call(t,r,c)),E=Be(n);return y.appendChild(E),Le(E,"mousedown",v=>{Oe(v,!0)}),Le(E,"click",v=>{Oe(v,!0),!t.isLocked&&t.shouldDelete([y],v)&&(t.removeItem(y),t.refreshOptions(!1),t.inputState())}),y}})}}function jo(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[n];o&&e.setTextboxValue(t.text.call(e,o))}})}function Xo(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var o={},r,c=!1,y,E=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(i.activeOption){var F=i.selectable(),K=Array.from(F).indexOf(i.activeOption);if(K>=F.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const v=D=>typeof i.settings.maxOptions=="number"&&r.children.length>=i.settings.maxOptions?!1:!!(D in o&&o[D]),x=(D,F)=>i.items.indexOf(F)>=0||E.indexOf(F)>=0;i.setNextUrl=(D,F)=>{o[D]=F},i.getUrl=D=>{if(D in o){const F=o[D];return o[D]=!1,F}return o={},i.settings.firstUrl.call(i,D)},i.hook("instead","clearActiveOption",()=>{if(!c)return t.call(i)}),i.hook("instead","canLoad",D=>D in o?v(D):e.call(i,D)),i.hook("instead","loadCallback",(D,F)=>{if(!c)i.clearOptions(x);else if(y){const K=D[0];K!==void 0&&(y.dataset.value=K[i.settings.valueField])}n.call(i,D,F),c=!1}),i.hook("after","refreshOptions",()=>{const D=i.lastValue;var F;v(D)?(F=i.render("loading_more",{query:D}),F&&(F.setAttribute("data-selectable",""),y=F)):D in o&&!r.querySelector(".no-results")&&(F=i.render("no_more_results",{query:D})),F&&(He(F,i.settings.optionClass),r.append(F))}),i.on("initialize",()=>{E=Object.keys(i.options),r=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),r.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&v(i.lastValue)&&(c||(c=!0,i.load.call(i,i.lastValue)))})})}ze.define("change_listener",No);ze.define("checkbox_options",xo);ze.define("clear_button",Co);ze.define("drag_drop",Po);ze.define("dropdown_header",Do);ze.define("caret_position",Lo);ze.define("dropdown_input",$o);ze.define("input_autogrow",Fo);ze.define("no_backspace_delete",Ro);ze.define("no_active_items",Bo);ze.define("optgroup_columns",Mo);ze.define("remove_button",Vo);ze.define("restore_on_backspace",jo);ze.define("virtual_scroll",Xo);async function Uo(i){if(!await j.scene.isReady())return;const n=(await j.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of i){const c=r.metadata[`${_.EXTENSIONID}/metadata_ghosts`];if(c?.length>0){o=!0;const y=c.map(v=>v.id);for(const v of c){const x=v.metadata[`${_.EXTENSIONID}/viewers`];x&&(x.includes(X.userId)?await j.scene.local.addItems([v]):n.includes(v.id)&&await j.scene.local.deleteItems([v.id]))}const E=n.filter(v=>!y.includes(v));E?.length>0&&await j.scene.local.deleteItems(E)}}o||await j.scene.local.deleteItems(n)}function Ho(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const o of X.players)n.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function Wo(){j.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${_.EXTENSIONID}/metadata_ghosts`]=e,await j.player.setMetadata(t)}),await j.contextMenu.create({id:`${_.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"}]}}],async onClick(i){document.getElementById("spectreWarning").style.display="none";for(const e of i.items){const t=e,n=t.text?.plainText||t.name;await j.scene.items.deleteItems([t.id]),await j.scene.local.addItems([t]),X.ghosts.push(t);const o=document.getElementById("ghostList"),r=document.createElement("tr");r.id=`tr-${t.id}`,r.className="ghost-table-entry",r.innerHTML=`<td class="token-name">${n}</td>
<td><select id="select-${t.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${t.id}" value="Delete"/></td>`,o.appendChild(r);const c=document.getElementById(`select-${t.id}`);for(const v of X.players){const x=document.createElement("option");x.value=v.id,x.text=v.name,c.appendChild(x)}const y={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:X.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(v,x){const D=x.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await j.scene.local.updateItems([D],F=>{const K=F[0].metadata[`${_.EXTENSIONID}/viewers`],k=K.findIndex(R=>R==v);K.splice(k,1),F[0].metadata[`${_.EXTENSIONID}/viewers`]=K})},onItemAdd:async function(v,x){const D=x.parentElement.parentElement.parentElement.parentElement.id.slice(3);await j.scene.local.updateItems([D],F=>{const K=F[0].metadata[`${_.EXTENSIONID}/viewers`];K?(K.push(v),F[0].metadata[`${_.EXTENSIONID}/viewers`]=K):F[0].metadata[`${_.EXTENSIONID}/viewers`]=[v]})}};new ze(`#select-${t.id}`,y);const E=document.getElementById(`deleteGhost-${t.id}`);E.onclick=async()=>{const v=X.ghosts.findIndex(x=>x.id===t.id);X.ghosts.splice(v,1),r.remove(),await j.scene.local.updateItems([t.id],x=>{x[0].metadata[`${_.EXTENSIONID}/viewers`]=[]}),await j.scene.local.deleteItems([t.id])}}}})}async function Si(i){const e=await j.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=i.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,i.appendChild(r)),t[e[o].id]=e[o].name}let n=i.querySelectorAll("option");for(let o=0;o<n.length;o++)t[n[o].value]===void 0&&i.removeChild(n[o])}async function zo(i,e,t,n,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=X.gridDpi/t,c,y=[];if(y[0]=0,y[1]=0,n!==""){let E=await j.scene.items.getItems([n]);if(E.length>0)c=E[0],t===0&&(t=c.grid.dpi),r=X.gridDpi/t,y[0]=c.position.x-c.grid.offset.x*r,y[1]=c.position.y-c.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}i==="foundry"?qo(e,r,y,o):i==="uvtt"&&Go(e,r,y,o)}function Go(i,e,t,n){if(!i.line_of_sight||i.line_of_sight.length===0){n.innerText="No walls / los found";return}const o=[];let r=0,c=72;if(i.portals&&i.portals.length)for(let E=0;E<i.portals.length;E++){let v=i.portals[E].bounds;i.line_of_sight.push(v)}for(var y=0;y<i.line_of_sight.length;y++){let E=i.line_of_sight[y][0].x*c,v=i.line_of_sight[y][0].y*c,x=i.line_of_sight[y][1].x*c,D=i.line_of_sight[y][1].y*c;const F=sn().tension(0).points([{x:E*e+t[0],y:v*e+t[1]},{x:x*e+t[0],y:D*e+t[1]}]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();F.visible=!1,F.metadata[`${_.EXTENSIONID}/isVisionLine`]=!0,o.push(F),o.length>50&&(r+=o.length,j.scene.items.addItems(o),o.length=0)}o.length>0&&(r+=o.length,j.scene.items.addItems(o)),n.innerText="Finished importing "+r+" walls!"}function qo(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const o=[];let r=0;for(var c=0;c<i.walls.length;c++){const y=sn().tension(0).points([{x:i.walls[c].c[0]*e+t[0],y:i.walls[c].c[1]*e+t[1]},{x:i.walls[c].c[2]*e+t[0],y:i.walls[c].c[3]*e+t[1]}]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();y.visible=!1,y.metadata[`${_.EXTENSIONID}/isVisionLine`]=!0,o.push(y),o.length>50&&(r+=o.length,j.scene.items.addItems(o),o.length=0)}o.length>0&&(r+=o.length,j.scene.items.addItems(o)),n.innerText="Finished importing "+r+" walls!"}var rt=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(i,e,t,n){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},c,y,E,v,x,D,F,K,k,R,T,L,A,N,B,J,w={},g={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},f={},m="",p={},O=!1;function C(I){if(typeof I=="object"){var U=function(){switch(W){case"el":pe(I.el),I.wrap!==!1&&se(I.el);break;case"parent":c=e.querySelector(I.parent),c&&(c.appendChild(y),g.parent=I.parent,c===e.body&&(c=n));break;case"themeMode":g.themeMode=I.themeMode,I.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(g.themeMode="dark");case"theme":I.theme&&(g.theme=I.theme),y.className="clr-picker clr-"+g.theme+" clr-"+g.themeMode,g.inline&&ye();break;case"rtl":g.rtl=!!I.rtl,e.querySelectorAll(".clr-field").forEach(function(Fe){return Fe.classList.toggle("clr-rtl",g.rtl)});break;case"margin":I.margin*=1,g.margin=isNaN(I.margin)?g.margin:I.margin;break;case"wrap":I.el&&I.wrap&&se(I.el);break;case"formatToggle":g.formatToggle=!!I.formatToggle,he("clr-format").style.display=g.formatToggle?"block":"none",g.formatToggle&&(g.format="auto");break;case"swatches":if(Array.isArray(I.swatches)){var ue=[];I.swatches.forEach(function(Fe,ve){ue.push('<button type="button" id="clr-swatch-'+ve+'" aria-labelledby="clr-swatch-label clr-swatch-'+ve+'" style="color: '+Fe+';">'+Fe+"</button>")}),he("clr-swatches").innerHTML=ue.length?"<div>"+ue.join("")+"</div>":"",g.swatches=I.swatches.slice()}break;case"swatchesOnly":g.swatchesOnly=!!I.swatchesOnly,y.setAttribute("data-minimal",g.swatchesOnly);break;case"alpha":g.alpha=!!I.alpha,y.setAttribute("data-alpha",g.alpha);break;case"inline":if(g.inline=!!I.inline,y.setAttribute("data-inline",g.inline),g.inline){var ge=I.defaultColor||g.defaultColor;N=Me(ge),ye(),ke(ge)}break;case"clearButton":typeof I.clearButton=="object"&&(I.clearButton.label&&(g.clearLabel=I.clearButton.label,F.innerHTML=g.clearLabel),I.clearButton=I.clearButton.show),g.clearButton=!!I.clearButton,F.style.display=g.clearButton?"block":"none";break;case"clearLabel":g.clearLabel=I.clearLabel,F.innerHTML=g.clearLabel;break;case"closeButton":g.closeButton=!!I.closeButton,g.closeButton?y.insertBefore(K,x):x.appendChild(K);break;case"closeLabel":g.closeLabel=I.closeLabel,K.innerHTML=g.closeLabel;break;case"a11y":var fe=I.a11y,Ae=!1;if(typeof fe=="object")for(var me in fe)fe[me]&&g.a11y[me]&&(g.a11y[me]=fe[me],Ae=!0);if(Ae){var $e=he("clr-open-label"),Ie=he("clr-swatch-label");$e.innerHTML=g.a11y.open,Ie.innerHTML=g.a11y.swatch,K.setAttribute("aria-label",g.a11y.close),F.setAttribute("aria-label",g.a11y.clear),k.setAttribute("aria-label",g.a11y.hueSlider),T.setAttribute("aria-label",g.a11y.alphaSlider),D.setAttribute("aria-label",g.a11y.input),E.setAttribute("aria-label",g.a11y.instruction)}break;default:g[W]=I[W]}};for(var W in I)U()}}function ce(I,U){typeof I=="string"&&typeof U=="object"&&(f[I]=U,O=!0)}function le(I){delete f[I],Object.keys(f).length===0&&(O=!1,I===m&&ee())}function oe(I){if(O){var U=["el","wrap","rtl","inline","defaultColor","a11y"],W=function(){var fe=f[te];if(I.matches(te)){m=te,p={},U.forEach(function(me){return delete fe[me]});for(var Ae in fe)p[Ae]=Array.isArray(g[Ae])?g[Ae].slice():g[Ae];return C(fe),"break"}};for(var te in f){var ue=W();if(ue==="break")break}}}function ee(){Object.keys(p).length>0&&(C(p),m="",p={})}function pe(I){we(e,"click",I,function(U){g.inline||(oe(U.target),A=U.target,B=A.value,N=Me(B),y.classList.add("clr-open"),ye(),ke(B),(g.focusInput||g.selectInput)&&(D.focus({preventScroll:!0}),D.setSelectionRange(A.selectionStart,A.selectionEnd)),g.selectInput&&D.select(),(J||g.swatchesOnly)&&Pe().shift().focus(),A.dispatchEvent(new Event("open",{bubbles:!0})))}),we(e,"input",I,function(U){var W=U.target.parentNode;W.classList.contains("clr-field")&&(W.style.color=U.target.value)})}function ye(){if(!(!y||!A&&!g.inline)){var I=c,U=i.scrollY,W=y.offsetWidth,te=y.offsetHeight,ue={left:!1,top:!1},ge,fe,Ae,me={x:0,y:0};if(I&&(ge=i.getComputedStyle(I),fe=parseFloat(ge.marginTop),Ae=parseFloat(ge.borderTopWidth),me=I.getBoundingClientRect(),me.y+=Ae+U),!g.inline){var $e=A.getBoundingClientRect(),Ie=$e.x,Fe=U+$e.y+$e.height+g.margin;I?(Ie-=me.x,Fe-=me.y,Ie+W>I.clientWidth&&(Ie+=$e.width-W,ue.left=!0),Fe+te>I.clientHeight-fe&&te+g.margin<=$e.top-(me.y-U)&&(Fe-=$e.height+te+g.margin*2,ue.top=!0),Fe+=I.scrollTop):(Ie+W>e.documentElement.clientWidth&&(Ie+=$e.width-W,ue.left=!0),Fe+te-U>e.documentElement.clientHeight&&te+g.margin<=$e.top&&(Fe=U+$e.y-te-g.margin,ue.top=!0)),y.classList.toggle("clr-left",ue.left),y.classList.toggle("clr-top",ue.top),y.style.left=Ie+"px",y.style.top=Fe+"px",me.x+=y.offsetLeft,me.y+=y.offsetTop}w={width:E.offsetWidth,height:E.offsetHeight,x:E.offsetLeft+me.x,y:E.offsetTop+me.y}}}function se(I){e.querySelectorAll(I).forEach(function(U){var W=U.parentNode;if(!W.classList.contains("clr-field")){var te=e.createElement("div"),ue="clr-field";(g.rtl||U.classList.contains("clr-rtl"))&&(ue+=" clr-rtl"),te.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',W.insertBefore(te,U),te.setAttribute("class",ue),te.style.color=U.value,te.appendChild(U)}})}function ae(I){if(A&&!g.inline){var U=A;I&&(A=n,B!==U.value&&(U.value=B,U.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){B!==U.value&&U.dispatchEvent(new Event("change",{bubbles:!0}))}),y.classList.remove("clr-open"),O&&ee(),U.dispatchEvent(new Event("close",{bubbles:!0})),g.focusInput&&U.focus({preventScroll:!0}),A=n}}function ke(I){var U=de(I),W=ne(U);Je(W.s,W.v),d(U,W),k.value=W.h,y.style.color="hsl("+W.h+", 100%, 50%)",R.style.left=W.h/360*100+"%",v.style.left=w.width*W.s/100+"px",v.style.top=w.height-w.height*W.v/100+"px",T.value=W.a*100,L.style.left=W.a*100+"%"}function Me(I){var U=I.substring(0,3).toLowerCase();return U==="rgb"||U==="hsl"?U:"hex"}function Se(I){I=I!==n?I:D.value,A&&(A.value=I,A.dispatchEvent(new Event("input",{bubbles:!0}))),g.onChange&&g.onChange.call(i,I,A),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:I,currentEl:A}}))}function Re(I,U){var W={h:k.value*1,s:I/w.width*100,v:100-U/w.height*100,a:T.value/100},te=M(W);Je(W.s,W.v),d(te,W),Se()}function Je(I,U){var W=g.a11y.marker;I=I.toFixed(1)*1,U=U.toFixed(1)*1,W=W.replace("{s}",I),W=W.replace("{v}",U),v.setAttribute("aria-label",W)}function nt(I){return{pageX:I.changedTouches?I.changedTouches[0].pageX:I.pageX,pageY:I.changedTouches?I.changedTouches[0].pageY:I.pageY}}function Ve(I){var U=nt(I),W=U.pageX-w.x,te=U.pageY-w.y;c&&(te+=c.scrollTop),l(W,te),I.preventDefault(),I.stopPropagation()}function Y(I,U){var W=v.style.left.replace("px","")*1+I,te=v.style.top.replace("px","")*1+U;l(W,te)}function l(I,U){I=I<0?0:I>w.width?w.width:I,U=U<0?0:U>w.height?w.height:U,v.style.left=I+"px",v.style.top=U+"px",Re(I,U),v.focus()}function d(I,U){I===void 0&&(I={}),U===void 0&&(U={});var W=g.format;for(var te in I)r[te]=I[te];for(var ue in U)r[ue]=U[ue];var ge=re(r),fe=ge.substring(0,7);switch(v.style.color=fe,L.parentNode.style.color=fe,L.style.color=ge,x.style.color=ge,E.style.display="none",E.offsetHeight,E.style.display="",L.nextElementSibling.style.display="none",L.nextElementSibling.offsetHeight,L.nextElementSibling.style.display="",W==="mixed"?W=r.a===1?"hex":"rgb":W==="auto"&&(W=N),W){case"hex":D.value=ge;break;case"rgb":D.value=Ce(r);break;case"hsl":D.value=be(q(r));break}e.querySelector('.clr-format [value="'+W+'"]').checked=!0}function b(){var I=k.value*1,U=v.style.left.replace("px","")*1,W=v.style.top.replace("px","")*1;y.style.color="hsl("+I+", 100%, 50%)",R.style.left=I/360*100+"%",Re(U,W)}function H(){var I=T.value/100;L.style.left=I*100+"%",d({a:I}),Se()}function M(I){var U=I.s/100,W=I.v/100,te=U*W,ue=I.h/60,ge=te*(1-t.abs(ue%2-1)),fe=W-te;te=te+fe,ge=ge+fe;var Ae=t.floor(ue)%6,me=[te,ge,fe,fe,ge,te][Ae],$e=[ge,te,te,ge,fe,fe][Ae],Ie=[fe,fe,ge,te,te,ge][Ae];return{r:t.round(me*255),g:t.round($e*255),b:t.round(Ie*255),a:I.a}}function q(I){var U=I.v/100,W=U*(1-I.s/100/2),te;return W>0&&W<1&&(te=t.round((U-W)/t.min(W,1-W)*100)),{h:I.h,s:te||0,l:t.round(W*100),a:I.a}}function ne(I){var U=I.r/255,W=I.g/255,te=I.b/255,ue=t.max(U,W,te),ge=t.min(U,W,te),fe=ue-ge,Ae=ue,me=0,$e=0;return fe&&(ue===U&&(me=(W-te)/fe),ue===W&&(me=2+(te-U)/fe),ue===te&&(me=4+(U-W)/fe),ue&&($e=fe/ue)),me=t.floor(me*60),{h:me<0?me+360:me,s:t.round($e*100),v:t.round(Ae*100),a:I.a}}function de(I){var U=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,W,te;return o.fillStyle="#000",o.fillStyle=I,W=U.exec(o.fillStyle),W?(te={r:W[3]*1,g:W[4]*1,b:W[5]*1,a:W[6]*1},te.a=+te.a.toFixed(2)):(W=o.fillStyle.replace("#","").match(/.{2}/g).map(function(ue){return parseInt(ue,16)}),te={r:W[0],g:W[1],b:W[2],a:1}),te}function re(I){var U=I.r.toString(16),W=I.g.toString(16),te=I.b.toString(16),ue="";if(I.r<16&&(U="0"+U),I.g<16&&(W="0"+W),I.b<16&&(te="0"+te),g.alpha&&(I.a<1||g.forceAlpha)){var ge=I.a*255|0;ue=ge.toString(16),ge<16&&(ue="0"+ue)}return"#"+U+W+te+ue}function Ce(I){return!g.alpha||I.a===1&&!g.forceAlpha?"rgb("+I.r+", "+I.g+", "+I.b+")":"rgba("+I.r+", "+I.g+", "+I.b+", "+I.a+")"}function be(I){return!g.alpha||I.a===1&&!g.forceAlpha?"hsl("+I.h+", "+I.s+"%, "+I.l+"%)":"hsla("+I.h+", "+I.s+"%, "+I.l+"%, "+I.a+")"}function Te(){e.getElementById("clr-picker")||(c=n,y=e.createElement("div"),y.setAttribute("id","clr-picker"),y.className="clr-picker",y.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+g.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+g.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+g.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+g.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+g.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+g.a11y.clear+'">'+g.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+g.a11y.close+'">'+g.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+g.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+g.a11y.swatch+"</span>"),e.body.appendChild(y),E=he("clr-color-area"),v=he("clr-color-marker"),F=he("clr-clear"),K=he("clr-close"),x=he("clr-color-preview"),D=he("clr-color-value"),k=he("clr-hue-slider"),R=he("clr-hue-marker"),T=he("clr-alpha-slider"),L=he("clr-alpha-marker"),pe(g.el),se(g.el),we(y,"mousedown",function(I){y.classList.remove("clr-keyboard-nav"),I.stopPropagation()}),we(E,"mousedown",function(I){we(e,"mousemove",Ve)}),we(E,"touchstart",function(I){e.addEventListener("touchmove",Ve,{passive:!1})}),we(v,"mousedown",function(I){we(e,"mousemove",Ve)}),we(v,"touchstart",function(I){e.addEventListener("touchmove",Ve,{passive:!1})}),we(D,"change",function(I){var U=D.value;if(A||g.inline){var W=U===""?U:ke(U);Se(W)}}),we(F,"click",function(I){Se(""),ae()}),we(K,"click",function(I){Se(),ae()}),we(he("clr-format"),"click",".clr-format input",function(I){N=I.target.value,d(),Se()}),we(y,"click",".clr-swatches button",function(I){ke(I.target.textContent),Se(),g.swatchesOnly&&ae()}),we(e,"mouseup",function(I){e.removeEventListener("mousemove",Ve)}),we(e,"touchend",function(I){e.removeEventListener("touchmove",Ve)}),we(e,"mousedown",function(I){J=!1,y.classList.remove("clr-keyboard-nav"),ae()}),we(e,"keydown",function(I){var U=I.key,W=I.target,te=I.shiftKey,ue=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(U==="Escape"?ae(!0):ue.includes(U)&&(J=!0,y.classList.add("clr-keyboard-nav")),U==="Tab"&&W.matches(".clr-picker *")){var ge=Pe(),fe=ge.shift(),Ae=ge.pop();te&&W===fe?(Ae.focus(),I.preventDefault()):!te&&W===Ae&&(fe.focus(),I.preventDefault())}}),we(e,"click",".clr-field button",function(I){O&&ee(),I.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),we(v,"keydown",function(I){var U={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(U).includes(I.key)&&(Y.apply(void 0,U[I.key]),I.preventDefault())}),we(E,"click",Ve),we(k,"input",b),we(T,"input",H))}function Pe(){var I=Array.from(y.querySelectorAll("input, button")),U=I.filter(function(W){return!!W.offsetWidth});return U}function he(I){return e.getElementById(I)}function we(I,U,W,te){var ue=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof W=="string"?I.addEventListener(U,function(ge){ue.call(ge.target,W)&&te.call(ge.target,ge)}):(te=W,I.addEventListener(U,te))}function Ge(I,U){U=U!==n?U:[],e.readyState!=="loading"?I.apply(void 0,U):e.addEventListener("DOMContentLoaded",function(){I.apply(void 0,U)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function lt(I,U){A=U,B=A.value,oe(U),N=Me(I),ye(),ke(I),Se(),B!==I&&A.dispatchEvent(new Event("change",{bubbles:!0}))}var et=function(){var I={init:Te,set:C,wrap:se,close:ae,setInstance:ce,setColor:lt,removeInstance:le,updatePosition:ye};function U(ue){Ge(function(){ue&&(typeof ue=="string"?pe(ue):C(ue))})}var W=function(ge){U[ge]=function(){for(var fe=arguments.length,Ae=new Array(fe),me=0;me<fe;me++)Ae[me]=arguments[me];Ge(I[ge],Ae)}};for(var te in I)W(te);return Ge(function(){i.addEventListener("resize",function(ue){U.updatePosition()}),i.addEventListener("scroll",function(ue){U.updatePosition()})}),U}();return et.coloris=et,et}(window,document,Math)}();rt.coloris;rt.init;rt.set;rt.wrap;rt.close;rt.setInstance;rt.removeInstance;rt.updatePosition;const Wn=document.getElementById("app");Wn.innerHTML=`
<div>
    <div>
        <div class="title">
            Smoke! ˣ Dynamic Fog
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings"><svg fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.63 11.08zm.21.41v-.1zm.23.38L1 11.68zM1 11.68l-.11-.19zm-.21-.29c-.06-.1-.11-.21-.16-.31.05.1.1.21.16.31zm.32.54v-.06z"/><path d="m11.26 12.63 1.83 1.09a7.34 7.34 0 0 0 1-.94 7.48 7.48 0 0 0 1.56-2.86l-1.74-1A5.29 5.29 0 0 0 14 8a5.29 5.29 0 0 0-.08-.9l1.74-1a7.45 7.45 0 0 0-1.33-2.58 7.54 7.54 0 0 0-1.24-1.22l-1.83 1.04a6 6 0 0 0-1.11-.53v-2A8.55 8.55 0 0 0 7.94.53a8.39 8.39 0 0 0-2.26.3v2a7.23 7.23 0 0 0-1.12.54L2.78 2.28A7.46 7.46 0 0 0 .2 6.06l1.72 1a5.29 5.29 0 0 0-.08.9 5.29 5.29 0 0 0 .08.9l-1.73 1a8 8 0 0 0 .43 1.15c.05.1.1.21.16.31v.1l.11.19.12.19v.06a7.69 7.69 0 0 0 1.64 1.78l1.81-1.08a7.23 7.23 0 0 0 1.12.54v2a8.39 8.39 0 0 0 2.26.31 8.56 8.56 0 0 0 2.22-.3v-2a6 6 0 0 0 1.2-.48zm-2.39 1.52a7.57 7.57 0 0 1-.95.06 7.73 7.73 0 0 1-1-.06v-1.69a4.92 4.92 0 0 1-2.53-1.27l-1.54.92a6.22 6.22 0 0 1-1.08-1.61l1.56-.93a4.27 4.27 0 0 1 0-3.17l-1.56-.92a6.11 6.11 0 0 1 1.12-1.62l1.56.93A5 5 0 0 1 7 3.53V1.82a7.73 7.73 0 0 1 1-.06 7.57 7.57 0 0 1 .95.06v1.72a4.9 4.9 0 0 1 2.4 1.26l1.59-.94a6.31 6.31 0 0 1 1.11 1.62l-1.6.94a4.35 4.35 0 0 1 .3 1.58 4.44 4.44 0 0 1-.29 1.55l1.56.93a6.43 6.43 0 0 1-1.11 1.61l-1.58-.93a5 5 0 0 1-2.49 1.28z"/><path d="M7.92 5.49A2.59 2.59 0 0 0 5.25 8a2.59 2.59 0 0 0 2.67 2.51A2.6 2.6 0 0 0 10.6 8a2.6 2.6 0 0 0-2.68-2.51zM8 9.2A1.35 1.35 0 0 1 6.55 8 1.35 1.35 0 0 1 8 6.7 1.35 1.35 0 0 1 9.39 8 1.35 1.35 0 0 1 8 9.2z"/></svg></div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
        </div>
        <hr>
        <div id="settings-ui" class="grid-settings" style="display:none;">
            <div class="visionTitle grid-3">Settings</div>

            <div><label for="autodetect_checkbox" title="Automatically detect fog areas based on the current scene's maps">Autodetect Maps</label></div>
            <div style="grid-column: span 2;"><input type="checkbox" id="autodetect_checkbox" checked></div>

            <div id="boundry_options" class="grid-3" style="display:none;">
                <span id="map_size">Boundary Size: 
                    <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
                    <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
                    <input type="button" id="mapSubmit" value="Update"/>
                    &nbsp;&nbsp;&nbsp;
                </span>
            </div>

            <div><label for="snap_checkbox">Grid Snap</label></div>
            <div class="grid-2"><input type="checkbox" id="snap_checkbox"></div>

            <div><label for="persistence_checkbox" title="Enabling fog persistence will retain the previously viewed areas of the map">Persistence</label></div>
            <div><input type="checkbox" id="persistence_checkbox"></div>
            <div><input type="button" id="persistence_reset" value="Reset"></div>

            <div><label for="fow_checkbox" title="Trailing fog shows an opaque layer for previously viewed areas that players cannot currently view">Trailing Fog + Autohide</label></div>
            <div><input type="checkbox" id="fow_checkbox"></div>
            <div><input type="text" style="width: 90px;" maxlength="9" id="fow_color" value="#00000088"></div>

            <div>Convert from <i>Dynamic Fog</i></div>
            <div></div>
            <div><input type="button" id="convert_button" value="Convert"></div>

            <div></div>
            <div></div>
            <div><input type="button" id="debug_button" value="Enable Debugging" title="Show debugging and performance data"></div>

            <div class="visionTitle grid-3" style="margin-top: 16px;">Import</div>

            <div class="grid-3" style="margin-bottom: 16px;">Import JSON files with fog data from<br><a href="https://www.dungeonalchemist.com/" target="_blank">Dungeon Alchemist</a> and other tools.</div>

            <div>File Format</div>
            <div></div>
            <div><select id="import_format"><option value="foundry">Foundry</option><option value="uvtt">Universal VTT</option></select></div>

            <div><label for="dpi_autodetect" title="Whether or not to automatically detect the DPI of imported data based">DPI Autodetect</label></div>
            <div><input type="checkbox" id="dpi_autodetect" checked></div>
            <div><input id="import_dpi" disabled type="text" value="150" style="width: 32px;" maxlength="4"></div>

            <div style="margin-bottom: 8px;" title="Which map to align imported lines to">Map Alignment</div>
            <div></div>
            <div><select id="map_align" style="width: 120px;"><option selected>Loading..</option></select></div>

            <div><input id="import_file" style="width: 190px;" type="file"></div>
            <div></div>
            <div><input style="padding: 6px" type="button" id="import_button" value="Import" disabled></div>

            <div id="import_errors" class="grid-3"></div>
        </div>

        <div id="main-ui" class="grid-main">
            <div class="visionTitle grid-3">Vision Radius</div>
            <div class="grid-3"><i>GM-owned tokens give universal vision.</i></div>
            <p class="grid-3" id="no_tokens_message">Enable vision on your character tokens.</p>
            <div id="token_list_div" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <table style="margin: auto; padding: 0;">
                <tbody id="token_list"></tbody>
                </table>
            </div>
            <div class="visionTitle grid-3">Spectres!</div>
            <div id="ghostContainer" class="grid-3">
                <div id="spectreWarning">
                    Spectre tokens are only visible to specific players.
                    <br>
                    Enable vision here after it's been Spectred.
                    <br>
                    <br>
                    <i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i>
                </div>
                <table style="margin: auto; padding: 0; width: 100%">
                <colgroup>
                    <col style="width: 50%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                </colgroup>
                <tbody id="ghostList">
                </tbody></table>
            </div> 
        </div>

        <div id="debug_div" style="display: none;" class="grid-debug">
            <div class="visionTitle grid-2" style="text-align: center; margin-top: 16px">Performance Info</div>
            <div>Stage 1: Fog Shapes</div><div id="stage1">N/A</div>
            <div>Stage 2: Player Vision</div><div id="stage2">N/A</div>
            <div>Stage 3: Vision Ranges</div><div id="stage3">N/A</div>
            <div>Stage 4: Persistence+Trailing</div><div id="stage4">N/A</div>
            <div>Stage 5: OBR Scene</div><div id="stage5">N/A</div>
            <div>Stage 6: Autohide</div><div id="stage6">N/A</div>
            <div>Cache hits/misses</div><div><span id="cache_hits">?</span>/<span id=cache_misses>?</span></div>
        </div>
    </div>
</div>
`;Wn.parentElement.style.placeItems="start";const Oi=document.getElementById("main-ui"),$n=document.getElementById("settings-ui"),Yi=document.getElementById("vision_checkbox"),ki=document.getElementById("snap_checkbox"),Ko=document.getElementById("token_list"),Yo=document.getElementById("no_tokens_message"),Zo=document.getElementById("mapHeight"),Qo=document.getElementById("mapWidth"),Jo=document.getElementById("mapSubmit"),Zi=document.getElementById("persistence_checkbox"),At=document.getElementById("autodetect_checkbox"),Qi=document.getElementById("fow_checkbox"),Ji=document.getElementById("fow_color"),es=document.getElementById("persistence_reset"),ts=document.getElementById("convert_button"),ns=document.getElementById("settings_button"),er=document.getElementById("boundry_options"),zt=document.getElementById("debug_div"),is=document.getElementById("debug_button"),Fn=document.getElementById("import_button"),rs=document.getElementById("import_file"),Xn=document.getElementById("map_align"),St=document.getElementById("import_errors"),os=document.getElementById("dpi_autodetect"),ss=document.getElementById("import_dpi"),as=document.getElementById("import_format");rt.init();async function ls(){Yi.addEventListener("click",async e=>{if(!X.ready||!e.target){e.preventDefault();return}const t=e.target;await j.scene.setMetadata({[`${_.EXTENSIONID}/visionEnabled`]:t.checked})},!1),ki.checked=!0,ki.addEventListener("click",async e=>{if(!X.ready||!e.target){e.preventDefault();return}const t=e.target;X.snap=t.checked},!1),ns.addEventListener("click",async e=>{!e||!e.target||($n.style.display==="grid"?($n.style.display="none",Oi.style.display="grid"):($n.style.display="grid",Oi.style.display="none"))},!1),Zi.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await j.scene.setMetadata({[`${_.EXTENSIONID}/persistenceEnabled`]:t.checked})},!1),At.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;if(await j.scene.setMetadata({[`${_.EXTENSIONID}/autodetectEnabled`]:t.checked}),er.style.display=t.checked?"none":"",!t.checked){let n=tr();n&&await j.scene.items.addItems([n])}},!1),Qi.addEventListener("click",async e=>{if(!e||!e.target)return;const t=e.target;await j.scene.setMetadata({[`${_.EXTENSIONID}/fowEnabled`]:t.checked})},!1),es.addEventListener("click",async e=>{!e||!e.target||(j.scene.setMetadata({[`${_.EXTENSIONID}/forceReset`]:!0}),j.scene.setMetadata({[`${_.EXTENSIONID}/forceReset`]:void 0}))},!1),is.addEventListener("click",async e=>{!e||!e.target||(e.target,zt.style.display=zt.style.display=="none"?"grid":"none",await j.scene.setMetadata({[`${_.EXTENSIONID}/debug`]:zt.style.display==="grid"}))},!1),Ji.addEventListener("input",async e=>{if(!e||!e.target)return;const t=e.target;if(/#[a-f0-9]{8}/.test(t.value)){await j.scene.setMetadata({[`${_.EXTENSIONID}/fowColor`]:t.value});const o=await j.scene.local.getItems(jt);await j.scene.local.deleteItems(o.map(r=>r.id))}},!1),ts.addEventListener("click",async e=>{if(!(!e||!e.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const t=await j.scene.getMetadata();for(const o in t)o.substring(0,o.indexOf("/"))==_.ARMINDOID&&j.scene.setMetadata({[`${o}`]:void 0});const n=await j.scene.items.getItems();await j.scene.items.updateItems(n,o=>{for(const r of o)r.metadata[`${_.ARMINDOID}/isVisionLine`]!==void 0&&(r.metadata[`${_.EXTENSIONID}/isVisionLine`]=r.metadata[`${_.ARMINDOID}/isVisionLine`],delete r.metadata[`${_.ARMINDOID}/isVisionLine`]),r.metadata[`${_.ARMINDOID}/disabled`]!==void 0&&(r.metadata[`${_.EXTENSIONID}/disabled`]=r.metadata[`${_.ARMINDOID}/disabled`],delete r.metadata[`${_.ARMINDOID}/disabled`])})}},!1);var i;rs.addEventListener("change",async e=>{if(Fn.disabled=!0,!e||!e.target)return;const t=e.target;if(!t.files)return;const n=t.files[0];if(n.type!=="text/javascript"&&n.type,n){var o=new FileReader;o.onload=function(r){if(!r||!r.target){St.innerText="Invalid import event";return}const c=r.target;if(!c.result){St.innerText="Unable to read imported file";return}const y=c.result;i=JSON.parse(y),i&&(i.walls&&i.walls.length||i.line_of_sight&&i.line_of_sight.length)?Fn.disabled=!1:St.innerText="Imported file has no walls"},o.readAsText(n)}else St.innerText="Failed to load file"}),Fn.addEventListener("click",async e=>{!e||!e.target||(e.target,zo(as.value,i,os.checked?0:Number.parseInt(ss.value),Xn.value,St))},!1)}function Gt(i){const e=i.filter(Ni);let t=!1;X.metadata&&(Yi.checked=X.metadata[`${_.EXTENSIONID}/visionEnabled`]==!0,At.checked=X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]==!0,Zi.checked=X.metadata[`${_.EXTENSIONID}/persistenceEnabled`]==!0,At.checked=X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]==!0,Qi.checked=X.metadata[`${_.EXTENSIONID}/fowEnabled`]==!0,Ji.value=X.metadata[`${_.EXTENSIONID}/fowColor`]?X.metadata[`${_.EXTENSIONID}/fowColor`]:"#00000088",t=X.metadata[`${_.EXTENSIONID}/debug`]==!0),zt.style.display=t?"grid":"none",er.style.display=At.checked?"none":"",Yo.style.display=e.length>0?"none":"block";const n=document.getElementsByClassName("token-table-entry"),o=[];for(const r of n){const c=r.id.slice(3);e.find(y=>y.id===c)===void 0&&o.push(r)}for(const r of o)r.remove();for(const r of e){const c=document.getElementById(`tr-${r.id}`);if(c){const y=c.getElementsByClassName("token-name")[0],E=c.getElementsByClassName("token-vision-range")[0],v=c.getElementsByClassName("unlimited-vision")[0],x=c.getElementsByClassName("no-vision")[0];y&&(y.innerText=r.name),E&&!v.checked&&!x.checked&&(E.value=r.metadata[`${_.EXTENSIONID}/visionRange`]?r.metadata[`${_.EXTENSIONID}/visionRange`]:_.VISIONDEFAULT),v&&(v.checked=r.metadata[`${_.EXTENSIONID}/visionRange`]===0),x&&(x.checked=r.metadata[`${_.EXTENSIONID}/visionBlind`]),v.checked||x.checked?E.setAttribute("disabled","disabled"):E.removeAttribute("disabled")}else{const y=X.items.find(K=>K.id===r.id),E=document.createElement("tr");E.id=`tr-${y.id}`,E.className="token-table-entry",E.innerHTML=`<td class="token-name">${y.name}</td>
                               <td><input class="token-vision-range" type="number" value=${_.VISIONDEFAULT}><span class="unit">ft</span></td>
                               <td>
                                <div class="cbutton"><label title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span>&infin;</span></label></div>
                                <div class="cbutton"><label title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span>&#128294;</span></label></div>
                                <div class="cbutton"><label title="Disable vision on this token"><input type="checkbox" class="no-vision"><span>None</span></label></div>
                               </td>`,Ko.appendChild(E);const v=E.getElementsByClassName("token-vision-range")[0],x=E.getElementsByClassName("unlimited-vision")[0],D=E.getElementsByClassName("torch-vision")[0],F=E.getElementsByClassName("no-vision")[0];v&&!x.checked&&!F.checked&&(v.value=r.metadata[`${_.EXTENSIONID}/visionRange`]?r.metadata[`${_.EXTENSIONID}/visionRange`]:_.VISIONDEFAULT),x&&(x.checked=r.metadata[`${_.EXTENSIONID}/visionRange`]===0),D&&(D.checked=r.metadata[`${_.EXTENSIONID}/visionTorch`]),F&&(F.checked=r.metadata[`${_.EXTENSIONID}/visionBlind`]),x.checked||F.checked?v.setAttribute("disabled","disabled"):v.removeAttribute("disabled"),v.addEventListener("change",async K=>{if(!K||!K.target)return;const k=X.items.find(L=>L.id===r.id),R=K.target,T=parseInt(R.value);T<0&&(R.value="0"),T>999&&(R.value="999"),await j.scene.items.updateItems([k],L=>{L[0].metadata[`${_.EXTENSIONID}/visionRange`]=T})},!1),x.addEventListener("click",async K=>{if(!K||!K.target)return;const k=X.items.find(L=>L.id===r.id);let R=0;K.target.checked?(v.setAttribute("disabled","disabled"),F.checked=!1):(R=parseInt(v.value),v.removeAttribute("disabled")),await j.scene.items.updateItems([k],L=>{L[0].metadata[`${_.EXTENSIONID}/visionRange`]=R})},!1),F.addEventListener("click",async K=>{if(!K||!K.target)return;const k=X.items.find(T=>T.id===r.id),R=K.target;R.checked?v.setAttribute("disabled","disabled"):v.removeAttribute("disabled"),await j.scene.items.updateItems([k],T=>{T[0].metadata[`${_.EXTENSIONID}/visionBlind`]=R.checked})},!1),D.addEventListener("click",async K=>{if(!K||!K.target)return;const k=X.items.find(T=>T.id===r.id),R=K.target;await j.scene.items.updateItems([k],T=>{T[0].metadata[`${_.EXTENSIONID}/visionTorch`]=R.checked})},!1),v.addEventListener("mousewheel",async()=>{})}}}function tr(){let i;return X.items.filter(xi).length==0&&(i=yt().width(X.gridDpi*30).height(X.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),i.metadata[`${_.EXTENSIONID}/isBackgroundImage`]=!0,i.id=_.GRIDID,X.items.push(i)),i}async function Ti(i){let e,t;[X.items,X.metadata,X.gridDpi,X.gridScale,e,t]=await Promise.all([j.scene.items.getItems(),j.scene.getMetadata(),j.scene.grid.getDpi(),j.scene.grid.getScale(),j.scene.fog.getFilled(),j.scene.fog.getColor()]),await j.scene.items.deleteItems(X.items.filter(Ot).map(r=>r.id)),X.snap=!0,X.gridScale=X.gridScale.parsed.multiplier,X.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(X.items.filter(Ir).length==0){const r=X.items.filter(y=>y.layer=="MAP"&&y.type=="IMAGE"),c=r.map(y=>y.image.width*y.image.height/Math.pow(y.grid.dpi,2));n=r[c.indexOf(Math.max(...c))]}let o;if(X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]===void 0?(At.checked=!0,await j.scene.setMetadata({[`${_.EXTENSIONID}/autodetectEnabled`]:!0})):X.metadata[`${_.EXTENSIONID}/autodetectEnabled`]===!1&&(o=tr()),i=="GM"){o&&await j.scene.items.addItems([o]),Jo.onclick=async()=>{await j.scene.items.updateItems([_.GRIDID],c=>{for(const y of c){const E=y;E.width=X.gridDpi*+Qo.value,E.height=X.gridDpi*+Zo.value,E.scale={x:1,y:1}}})};const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await j.modal.open({id:_.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},Gt(X.items),rt({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),n!==void 0&&await j.scene.items.updateItems([n],c=>{c[0].metadata[`${_.EXTENSIONID}/isBackgroundImage`]=!0})}}j.onReady(async()=>{await j.player.getRole().then(async i=>{i=="GM"?(X.role="GM",await ls(),await Mr(),await Vr(),await jr(),await Wo()):(Wn.innerHTML="Configuration is GM-Access only.",await j.action.setHeight(90),await j.action.setWidth(320)),j.scene.fog.onChange(e=>{X.fog=e}),j.player.onChange(async e=>{const t=document.querySelectorAll(".token-table-entry");for(let n of t){let o=n.id.substring(3);e.selection!==void 0&&e.selection.includes(o)?n.classList.add("token-table-selected"):n.classList.remove("token-table-selected")}}),j.scene.items.onChange(async e=>{const t=e;X.items=t,X.ready&&(i=="GM"&&(Gt(t),await Si(Xn)),await gt())}),X.userId=await j.player.getId(),X.players=await j.party.getPlayers(),j.party.onChange(async e=>{X.players=e,i==="PLAYER"?await Uo(e):Ho()}),j.scene.grid.onChange(async e=>{X.gridDpi=e.dpi,X.gridScale=parseInt(e.scale),X.ready&&await gt()}),j.scene.onMetadataChange(async e=>{if(e[`${_.EXTENSIONID}/forceReset`]===!0){const t=await j.scene.local.getItems(Rn);j.scene.local.deleteItems(t.map(n=>n.id)),gt(!0)}else X.metadata=e,X.ready&&await gt()}),j.scene.onReadyChange(async e=>{X.ready=e,e?(Ti(i),await gt()):i=="GM"&&Gt([])}),X.ready=await j.scene.isReady(),X.ready?(Ti(i),await gt(),i=="GM"&&await Si(Xn)):i=="GM"&&Gt([])})});
