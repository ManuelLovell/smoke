import{C as h,b as Vr,O as C,a as mt,c as Ba,d as Xa,e as Fa,f as ut,i as ja,g as Mt}from"./bsConstants-966acf43.js";/* empty css              */var qt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zn(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Va(a){if(a.__esModule)return a;var e=a.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(a).forEach(function(n){var i=Object.getOwnPropertyDescriptor(a,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return a[n]}})}),t}function Ha(a){return a.type==="CURVE"}function Qt(a){return a.type==="IMAGE"}function gr(a,e){return Math.round(a/e)*e}function yr(a,e){return Math.floor(a/e)*e}function An(a){return a*(Math.PI/180)}function Ua(a){return a*(180/Math.PI)}function vr(a,e,t){return a*(1-t)+e*t}class We{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const i=Math.cos(An(n)),o=Math.sin(An(n)),l=this.subtract(e,t);return{x:t.x+i*l.x-o*l.y,y:t.y+o*l.x+i*l.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:gr(e.x,t.x),y:gr(e.y,t.y)}}static floorTo(e,t){return{x:yr(e.x,t.x),y:yr(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let k of e)t=k.x<t?k.x:t,n=k.x>n?k.x:n,i=k.y<i?k.y:i,o=k.y>o?k.y:o;let l=n-t,y=o-i,b={x:(t+n)/2,y:(i+o)/2};return{min:{x:t,y:i},max:{x:n,y:o},width:l,height:y,center:b}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let i=!1;for(let o=0,l=t.length-1;o<t.length;l=o++){const y=t[o].y>e.y,b=t[l].y>e.y;y!==b&&e.x<(t[l].x-t[o].x)*(e.y-t[o].y)/(t[l].y-t[o].y)+t[o].x&&(i=!i)}return i}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:vr(e.x,t.x,n),y:vr(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class ze{static inverse(e){const[t,n,i,o,l,y,b,k,M]=e,L=t*(l*M-k*y)-n*(o*M-y*b)+i*(o*k-l*b);if(Math.abs(L)<1e-14)return e;const x=1/L,B=(l*M-k*y)*x,O=(i*k-n*M)*x,j=(n*y-i*l)*x,A=(y*b-o*M)*x,V=(t*M-i*b)*x,X=(o*i-t*y)*x,W=(o*k-b*l)*x,r=(b*n-t*k)*x,f=(t*l-o*n)*x;return[B,O,j,A,V,X,W,r,f]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=An(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=ze.fromPosition(e.position),n=ze.fromScale(e.scale),i=ze.fromRotation(e.rotation);return ze.multiply(ze.multiply(t,i),n)}static decompose(e){const[t,n,i,o,l,y]=e,b=t*l-o*n,k={position:{x:i,y},rotation:0,scale:{x:1,y:1}};if(t!=0||o!=0){var M=Math.sqrt(t*t+o*o);k.rotation=o>0?Math.acos(t/M):-Math.acos(t/M),k.scale={x:M,y:b/M}}else if(n!=0||l!=0){var L=Math.sqrt(n*n+l*l);k.rotation=Math.PI/2-(l>0?Math.acos(-n/L):-Math.acos(n/L)),k.scale={x:b/L,y:L}}return k.rotation=Ua(k.rotation),k}}var Hr={exports:{}};(function(a){(function(){function e(r){var f={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(r===!1)return JSON.parse(JSON.stringify(f));var s={};for(var d in f)f.hasOwnProperty(d)&&(s[d]=f[d].defaultValue);return s}function t(){var r=e(!0),f={};for(var s in r)r.hasOwnProperty(s)&&(f[s]=!0);return f}var n={},i={},o={},l=e(!0),y="vanilla",b={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:t()};n.helper={},n.extensions={},n.setOption=function(r,f){return l[r]=f,this},n.getOption=function(r){return l[r]},n.getOptions=function(){return l},n.resetOptions=function(){l=e(!0)},n.setFlavor=function(r){if(!b.hasOwnProperty(r))throw Error(r+" flavor was not found");n.resetOptions();var f=b[r];y=r;for(var s in f)f.hasOwnProperty(s)&&(l[s]=f[s])},n.getFlavor=function(){return y},n.getFlavorOptions=function(r){if(b.hasOwnProperty(r))return b[r]},n.getDefaultOptions=function(r){return e(r)},n.subParser=function(r,f){if(n.helper.isString(r))if(typeof f<"u")i[r]=f;else{if(i.hasOwnProperty(r))return i[r];throw Error("SubParser named "+r+" not registered!")}},n.extension=function(r,f){if(!n.helper.isString(r))throw Error("Extension 'name' must be a string");if(r=n.helper.stdExtName(r),n.helper.isUndefined(f)){if(!o.hasOwnProperty(r))throw Error("Extension named "+r+" is not registered!");return o[r]}else{typeof f=="function"&&(f=f()),n.helper.isArray(f)||(f=[f]);var s=k(f,r);if(s.valid)o[r]=f;else throw Error(s.error)}},n.getAllExtensions=function(){return o},n.removeExtension=function(r){delete o[r]},n.resetExtensions=function(){o={}};function k(r,f){var s=f?"Error in "+f+" extension->":"Error in unnamed extension",d={valid:!0,error:""};n.helper.isArray(r)||(r=[r]);for(var c=0;c<r.length;++c){var g=s+" sub-extension "+c+": ",u=r[c];if(typeof u!="object")return d.valid=!1,d.error=g+"must be an object, but "+typeof u+" given",d;if(!n.helper.isString(u.type))return d.valid=!1,d.error=g+'property "type" must be a string, but '+typeof u.type+" given",d;var v=u.type=u.type.toLowerCase();if(v==="language"&&(v=u.type="lang"),v==="html"&&(v=u.type="output"),v!=="lang"&&v!=="output"&&v!=="listener")return d.valid=!1,d.error=g+"type "+v+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',d;if(v==="listener"){if(n.helper.isUndefined(u.listeners))return d.valid=!1,d.error=g+'. Extensions of type "listener" must have a property called "listeners"',d}else if(n.helper.isUndefined(u.filter)&&n.helper.isUndefined(u.regex))return d.valid=!1,d.error=g+v+' extensions must define either a "regex" property or a "filter" method',d;if(u.listeners){if(typeof u.listeners!="object")return d.valid=!1,d.error=g+'"listeners" property must be an object but '+typeof u.listeners+" given",d;for(var D in u.listeners)if(u.listeners.hasOwnProperty(D)&&typeof u.listeners[D]!="function")return d.valid=!1,d.error=g+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+D+" must be a function but "+typeof u.listeners[D]+" given",d}if(u.filter){if(typeof u.filter!="function")return d.valid=!1,d.error=g+'"filter" must be a function, but '+typeof u.filter+" given",d}else if(u.regex){if(n.helper.isString(u.regex)&&(u.regex=new RegExp(u.regex,"g")),!(u.regex instanceof RegExp))return d.valid=!1,d.error=g+'"regex" property must either be a string or a RegExp object, but '+typeof u.regex+" given",d;if(n.helper.isUndefined(u.replace))return d.valid=!1,d.error=g+'"regex" extensions must implement a replace string or function',d}}return d}n.validateExtension=function(r){var f=k(r,null);return f.valid?!0:(console.warn(f.error),!1)},n.hasOwnProperty("helper")||(n.helper={}),n.helper.isString=function(r){return typeof r=="string"||r instanceof String},n.helper.isFunction=function(r){var f={};return r&&f.toString.call(r)==="[object Function]"},n.helper.isArray=function(r){return Array.isArray(r)},n.helper.isUndefined=function(r){return typeof r>"u"},n.helper.forEach=function(r,f){if(n.helper.isUndefined(r))throw new Error("obj param is required");if(n.helper.isUndefined(f))throw new Error("callback param is required");if(!n.helper.isFunction(f))throw new Error("callback param must be a function/closure");if(typeof r.forEach=="function")r.forEach(f);else if(n.helper.isArray(r))for(var s=0;s<r.length;s++)f(r[s],s,r);else if(typeof r=="object")for(var d in r)r.hasOwnProperty(d)&&f(r[d],d,r);else throw new Error("obj does not seem to be an array or an iterable object")},n.helper.stdExtName=function(r){return r.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function M(r,f){var s=f.charCodeAt(0);return"¨E"+s+"E"}n.helper.escapeCharactersCallback=M,n.helper.escapeCharacters=function(r,f,s){var d="(["+f.replace(/([\[\]\\])/g,"\\$1")+"])";s&&(d="\\\\"+d);var c=new RegExp(d,"g");return r=r.replace(c,M),r},n.helper.unescapeHTMLEntities=function(r){return r.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var L=function(r,f,s,d){var c=d||"",g=c.indexOf("g")>-1,u=new RegExp(f+"|"+s,"g"+c.replace(/g/g,"")),v=new RegExp(f,c.replace(/g/g,"")),D=[],P,F,H,_,U;do for(P=0;H=u.exec(r);)if(v.test(H[0]))P++||(F=u.lastIndex,_=F-H[0].length);else if(P&&!--P){U=H.index+H[0].length;var ne={left:{start:_,end:F},match:{start:F,end:H.index},right:{start:H.index,end:U},wholeMatch:{start:_,end:U}};if(D.push(ne),!g)return D}while(P&&(u.lastIndex=F));return D};n.helper.matchRecursiveRegExp=function(r,f,s,d){for(var c=L(r,f,s,d),g=[],u=0;u<c.length;++u)g.push([r.slice(c[u].wholeMatch.start,c[u].wholeMatch.end),r.slice(c[u].match.start,c[u].match.end),r.slice(c[u].left.start,c[u].left.end),r.slice(c[u].right.start,c[u].right.end)]);return g},n.helper.replaceRecursiveRegExp=function(r,f,s,d,c){if(!n.helper.isFunction(f)){var g=f;f=function(){return g}}var u=L(r,s,d,c),v=r,D=u.length;if(D>0){var P=[];u[0].wholeMatch.start!==0&&P.push(r.slice(0,u[0].wholeMatch.start));for(var F=0;F<D;++F)P.push(f(r.slice(u[F].wholeMatch.start,u[F].wholeMatch.end),r.slice(u[F].match.start,u[F].match.end),r.slice(u[F].left.start,u[F].left.end),r.slice(u[F].right.start,u[F].right.end))),F<D-1&&P.push(r.slice(u[F].wholeMatch.end,u[F+1].wholeMatch.start));u[D-1].wholeMatch.end<r.length&&P.push(r.slice(u[D-1].wholeMatch.end)),v=P.join("")}return v},n.helper.regexIndexOf=function(r,f,s){if(!n.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(f instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var d=r.substring(s||0).search(f);return d>=0?d+(s||0):d},n.helper.splitAtIndex=function(r,f){if(!n.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[r.substring(0,f),r.substring(f)]},n.helper.encodeEmailAddress=function(r){var f=[function(s){return"&#"+s.charCodeAt(0)+";"},function(s){return"&#x"+s.charCodeAt(0).toString(16)+";"},function(s){return s}];return r=r.replace(/./g,function(s){if(s==="@")s=f[Math.floor(Math.random()*2)](s);else{var d=Math.random();s=d>.9?f[2](s):d>.45?f[1](s):f[0](s)}return s}),r},n.helper.padEnd=function(f,s,d){return s=s>>0,d=String(d||" "),f.length>s?String(f):(s=s-f.length,s>d.length&&(d+=d.repeat(s/d.length)),String(f)+d.slice(0,s))},typeof console>"u"&&(console={warn:function(r){alert(r)},log:function(r){alert(r)},error:function(r){throw r}}),n.helper.regexes={asteriskDashAndColon:/([*_:~])/g},n.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},n.Converter=function(r){var f={},s=[],d=[],c={},g=y,u={parsed:{},raw:"",format:""};v();function v(){r=r||{};for(var _ in l)l.hasOwnProperty(_)&&(f[_]=l[_]);if(typeof r=="object")for(var U in r)r.hasOwnProperty(U)&&(f[U]=r[U]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof r+" was passed instead.");f.extensions&&n.helper.forEach(f.extensions,D)}function D(_,U){if(U=U||null,n.helper.isString(_))if(_=n.helper.stdExtName(_),U=_,n.extensions[_]){console.warn("DEPRECATION WARNING: "+_+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),P(n.extensions[_],_);return}else if(!n.helper.isUndefined(o[_]))_=o[_];else throw Error('Extension "'+_+'" could not be loaded. It was either not found or is not a valid extension.');typeof _=="function"&&(_=_()),n.helper.isArray(_)||(_=[_]);var ne=k(_,U);if(!ne.valid)throw Error(ne.error);for(var ie=0;ie<_.length;++ie){switch(_[ie].type){case"lang":s.push(_[ie]);break;case"output":d.push(_[ie]);break}if(_[ie].hasOwnProperty("listeners"))for(var oe in _[ie].listeners)_[ie].listeners.hasOwnProperty(oe)&&F(oe,_[ie].listeners[oe])}}function P(_,U){typeof _=="function"&&(_=_(new n.Converter)),n.helper.isArray(_)||(_=[_]);var ne=k(_,U);if(!ne.valid)throw Error(ne.error);for(var ie=0;ie<_.length;++ie)switch(_[ie].type){case"lang":s.push(_[ie]);break;case"output":d.push(_[ie]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function F(_,U){if(!n.helper.isString(_))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof _+" given");if(typeof U!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof U+" given");c.hasOwnProperty(_)||(c[_]=[]),c[_].push(U)}function H(_){var U=_.match(/^\s*/)[0].length,ne=new RegExp("^\\s{0,"+U+"}","gm");return _.replace(ne,"")}this._dispatch=function(U,ne,ie,oe){if(c.hasOwnProperty(U))for(var Z=0;Z<c[U].length;++Z){var fe=c[U][Z](U,ne,this,ie,oe);fe&&typeof fe<"u"&&(ne=fe)}return ne},this.listen=function(_,U){return F(_,U),this},this.makeHtml=function(_){if(!_)return _;var U={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:s,outputModifiers:d,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return _=_.replace(/¨/g,"¨T"),_=_.replace(/\$/g,"¨D"),_=_.replace(/\r\n/g,`
`),_=_.replace(/\r/g,`
`),_=_.replace(/\u00A0/g,"&nbsp;"),f.smartIndentationFix&&(_=H(_)),_=`

`+_+`

`,_=n.subParser("detab")(_,f,U),_=_.replace(/^[ \t]+$/mg,""),n.helper.forEach(s,function(ne){_=n.subParser("runExtension")(ne,_,f,U)}),_=n.subParser("metadata")(_,f,U),_=n.subParser("hashPreCodeTags")(_,f,U),_=n.subParser("githubCodeBlocks")(_,f,U),_=n.subParser("hashHTMLBlocks")(_,f,U),_=n.subParser("hashCodeTags")(_,f,U),_=n.subParser("stripLinkDefinitions")(_,f,U),_=n.subParser("blockGamut")(_,f,U),_=n.subParser("unhashHTMLSpans")(_,f,U),_=n.subParser("unescapeSpecialChars")(_,f,U),_=_.replace(/¨D/g,"$$"),_=_.replace(/¨T/g,"¨"),_=n.subParser("completeHTMLDocument")(_,f,U),n.helper.forEach(d,function(ne){_=n.subParser("runExtension")(ne,_,f,U)}),u=U.metadata,_},this.makeMarkdown=this.makeMd=function(_,U){if(_=_.replace(/\r\n/g,`
`),_=_.replace(/\r/g,`
`),_=_.replace(/>[ \t]+</,">¨NBSP;<"),!U)if(window&&window.document)U=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var ne=U.createElement("div");ne.innerHTML=_;var ie={preList:be(ne)};le(ne);for(var oe=ne.childNodes,Z="",fe=0;fe<oe.length;fe++)Z+=n.subParser("makeMarkdown.node")(oe[fe],ie);function le(he){for(var pe=0;pe<he.childNodes.length;++pe){var me=he.childNodes[pe];me.nodeType===3?!/\S/.test(me.nodeValue)&&!/^[ ]+$/.test(me.nodeValue)?(he.removeChild(me),--pe):(me.nodeValue=me.nodeValue.split(`
`).join(" "),me.nodeValue=me.nodeValue.replace(/(\s)+/g,"$1")):me.nodeType===1&&le(me)}}function be(he){for(var pe=he.querySelectorAll("pre"),me=[],Y=0;Y<pe.length;++Y)if(pe[Y].childElementCount===1&&pe[Y].firstChild.tagName.toLowerCase()==="code"){var w=pe[Y].firstChild.innerHTML.trim(),S=pe[Y].firstChild.getAttribute("data-language")||"";if(S==="")for(var $=pe[Y].firstChild.className.split(" "),K=0;K<$.length;++K){var J=$[K].match(/^language-(.+)$/);if(J!==null){S=J[1];break}}w=n.helper.unescapeHTMLEntities(w),me.push(w),pe[Y].outerHTML='<precode language="'+S+'" precodenum="'+Y.toString()+'"></precode>'}else me.push(pe[Y].innerHTML),pe[Y].innerHTML="",pe[Y].setAttribute("prenum",Y.toString());return me}return Z},this.setOption=function(_,U){f[_]=U},this.getOption=function(_){return f[_]},this.getOptions=function(){return f},this.addExtension=function(_,U){U=U||null,D(_,U)},this.useExtension=function(_){D(_)},this.setFlavor=function(_){if(!b.hasOwnProperty(_))throw Error(_+" flavor was not found");var U=b[_];g=_;for(var ne in U)U.hasOwnProperty(ne)&&(f[ne]=U[ne])},this.getFlavor=function(){return g},this.removeExtension=function(_){n.helper.isArray(_)||(_=[_]);for(var U=0;U<_.length;++U){for(var ne=_[U],ie=0;ie<s.length;++ie)s[ie]===ne&&s.splice(ie,1);for(var oe=0;oe<d.length;++oe)d[oe]===ne&&d.splice(oe,1)}},this.getAllExtensions=function(){return{language:s,output:d}},this.getMetadata=function(_){return _?u.raw:u.parsed},this.getMetadataFormat=function(){return u.format},this._setMetadataPair=function(_,U){u.parsed[_]=U},this._setMetadataFormat=function(_){u.format=_},this._setMetadataRaw=function(_){u.raw=_}},n.subParser("anchors",function(r,f,s){r=s.converter._dispatch("anchors.before",r,f,s);var d=function(c,g,u,v,D,P,F){if(n.helper.isUndefined(F)&&(F=""),u=u.toLowerCase(),c.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)v="";else if(!v)if(u||(u=g.toLowerCase().replace(/ ?\n/g," ")),v="#"+u,!n.helper.isUndefined(s.gUrls[u]))v=s.gUrls[u],n.helper.isUndefined(s.gTitles[u])||(F=s.gTitles[u]);else return c;v=v.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var H='<a href="'+v+'"';return F!==""&&F!==null&&(F=F.replace(/"/g,"&quot;"),F=F.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),H+=' title="'+F+'"'),f.openLinksInNewWindow&&!/^#/.test(v)&&(H+=' rel="noopener noreferrer" target="¨E95Eblank"'),H+=">"+g+"</a>",H};return r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,d),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,d),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,d),r=r.replace(/\[([^\[\]]+)]()()()()()/g,d),f.ghMentions&&(r=r.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(c,g,u,v,D){if(u==="\\")return g+v;if(!n.helper.isString(f.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var P=f.ghMentionsLink.replace(/\{u}/g,D),F="";return f.openLinksInNewWindow&&(F=' rel="noopener noreferrer" target="¨E95Eblank"'),g+'<a href="'+P+'"'+F+">"+v+"</a>"})),r=s.converter._dispatch("anchors.after",r,f,s),r});var x=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,B=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,O=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,j=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,A=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,V=function(r){return function(f,s,d,c,g,u,v){d=d.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var D=d,P="",F="",H=s||"",_=v||"";return/^www\./i.test(d)&&(d=d.replace(/^www\./i,"http://www.")),r.excludeTrailingPunctuationFromURLs&&u&&(P=u),r.openLinksInNewWindow&&(F=' rel="noopener noreferrer" target="¨E95Eblank"'),H+'<a href="'+d+'"'+F+">"+D+"</a>"+P+_}},X=function(r,f){return function(s,d,c){var g="mailto:";return d=d||"",c=n.subParser("unescapeSpecialChars")(c,r,f),r.encodeEmails?(g=n.helper.encodeEmailAddress(g+c),c=n.helper.encodeEmailAddress(c)):g=g+c,d+'<a href="'+g+'">'+c+"</a>"}};n.subParser("autoLinks",function(r,f,s){return r=s.converter._dispatch("autoLinks.before",r,f,s),r=r.replace(O,V(f)),r=r.replace(A,X(f,s)),r=s.converter._dispatch("autoLinks.after",r,f,s),r}),n.subParser("simplifiedAutoLinks",function(r,f,s){return f.simplifiedAutoLink&&(r=s.converter._dispatch("simplifiedAutoLinks.before",r,f,s),f.excludeTrailingPunctuationFromURLs?r=r.replace(B,V(f)):r=r.replace(x,V(f)),r=r.replace(j,X(f,s)),r=s.converter._dispatch("simplifiedAutoLinks.after",r,f,s)),r}),n.subParser("blockGamut",function(r,f,s){return r=s.converter._dispatch("blockGamut.before",r,f,s),r=n.subParser("blockQuotes")(r,f,s),r=n.subParser("headers")(r,f,s),r=n.subParser("horizontalRule")(r,f,s),r=n.subParser("lists")(r,f,s),r=n.subParser("codeBlocks")(r,f,s),r=n.subParser("tables")(r,f,s),r=n.subParser("hashHTMLBlocks")(r,f,s),r=n.subParser("paragraphs")(r,f,s),r=s.converter._dispatch("blockGamut.after",r,f,s),r}),n.subParser("blockQuotes",function(r,f,s){r=s.converter._dispatch("blockQuotes.before",r,f,s),r=r+`

`;var d=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return f.splitAdjacentBlockquotes&&(d=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),r=r.replace(d,function(c){return c=c.replace(/^[ \t]*>[ \t]?/gm,""),c=c.replace(/¨0/g,""),c=c.replace(/^[ \t]+$/gm,""),c=n.subParser("githubCodeBlocks")(c,f,s),c=n.subParser("blockGamut")(c,f,s),c=c.replace(/(^|\n)/g,"$1  "),c=c.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(g,u){var v=u;return v=v.replace(/^  /mg,"¨0"),v=v.replace(/¨0/g,""),v}),n.subParser("hashBlock")(`<blockquote>
`+c+`
</blockquote>`,f,s)}),r=s.converter._dispatch("blockQuotes.after",r,f,s),r}),n.subParser("codeBlocks",function(r,f,s){r=s.converter._dispatch("codeBlocks.before",r,f,s),r+="¨0";var d=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return r=r.replace(d,function(c,g,u){var v=g,D=u,P=`
`;return v=n.subParser("outdent")(v,f,s),v=n.subParser("encodeCode")(v,f,s),v=n.subParser("detab")(v,f,s),v=v.replace(/^\n+/g,""),v=v.replace(/\n+$/g,""),f.omitExtraWLInCodeBlocks&&(P=""),v="<pre><code>"+v+P+"</code></pre>",n.subParser("hashBlock")(v,f,s)+D}),r=r.replace(/¨0/,""),r=s.converter._dispatch("codeBlocks.after",r,f,s),r}),n.subParser("codeSpans",function(r,f,s){return r=s.converter._dispatch("codeSpans.before",r,f,s),typeof r>"u"&&(r=""),r=r.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(d,c,g,u){var v=u;return v=v.replace(/^([ \t]*)/g,""),v=v.replace(/[ \t]*$/g,""),v=n.subParser("encodeCode")(v,f,s),v=c+"<code>"+v+"</code>",v=n.subParser("hashHTMLSpans")(v,f,s),v}),r=s.converter._dispatch("codeSpans.after",r,f,s),r}),n.subParser("completeHTMLDocument",function(r,f,s){if(!f.completeHTMLDocument)return r;r=s.converter._dispatch("completeHTMLDocument.before",r,f,s);var d="html",c=`<!DOCTYPE HTML>
`,g="",u=`<meta charset="utf-8">
`,v="",D="";typeof s.metadata.parsed.doctype<"u"&&(c="<!DOCTYPE "+s.metadata.parsed.doctype+`>
`,d=s.metadata.parsed.doctype.toString().toLowerCase(),(d==="html"||d==="html5")&&(u='<meta charset="utf-8">'));for(var P in s.metadata.parsed)if(s.metadata.parsed.hasOwnProperty(P))switch(P.toLowerCase()){case"doctype":break;case"title":g="<title>"+s.metadata.parsed.title+`</title>
`;break;case"charset":d==="html"||d==="html5"?u='<meta charset="'+s.metadata.parsed.charset+`">
`:u='<meta name="charset" content="'+s.metadata.parsed.charset+`">
`;break;case"language":case"lang":v=' lang="'+s.metadata.parsed[P]+'"',D+='<meta name="'+P+'" content="'+s.metadata.parsed[P]+`">
`;break;default:D+='<meta name="'+P+'" content="'+s.metadata.parsed[P]+`">
`}return r=c+"<html"+v+`>
<head>
`+g+u+D+`</head>
<body>
`+r.trim()+`
</body>
</html>`,r=s.converter._dispatch("completeHTMLDocument.after",r,f,s),r}),n.subParser("detab",function(r,f,s){return r=s.converter._dispatch("detab.before",r,f,s),r=r.replace(/\t(?=\t)/g,"    "),r=r.replace(/\t/g,"¨A¨B"),r=r.replace(/¨B(.+?)¨A/g,function(d,c){for(var g=c,u=4-g.length%4,v=0;v<u;v++)g+=" ";return g}),r=r.replace(/¨A/g,"    "),r=r.replace(/¨B/g,""),r=s.converter._dispatch("detab.after",r,f,s),r}),n.subParser("ellipsis",function(r,f,s){return f.ellipsis&&(r=s.converter._dispatch("ellipsis.before",r,f,s),r=r.replace(/\.\.\./g,"…"),r=s.converter._dispatch("ellipsis.after",r,f,s)),r}),n.subParser("emoji",function(r,f,s){if(!f.emoji)return r;r=s.converter._dispatch("emoji.before",r,f,s);var d=/:([\S]+?):/g;return r=r.replace(d,function(c,g){return n.helper.emojis.hasOwnProperty(g)?n.helper.emojis[g]:c}),r=s.converter._dispatch("emoji.after",r,f,s),r}),n.subParser("encodeAmpsAndAngles",function(r,f,s){return r=s.converter._dispatch("encodeAmpsAndAngles.before",r,f,s),r=r.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),r=r.replace(/<(?![a-z\/?$!])/gi,"&lt;"),r=r.replace(/</g,"&lt;"),r=r.replace(/>/g,"&gt;"),r=s.converter._dispatch("encodeAmpsAndAngles.after",r,f,s),r}),n.subParser("encodeBackslashEscapes",function(r,f,s){return r=s.converter._dispatch("encodeBackslashEscapes.before",r,f,s),r=r.replace(/\\(\\)/g,n.helper.escapeCharactersCallback),r=r.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,n.helper.escapeCharactersCallback),r=s.converter._dispatch("encodeBackslashEscapes.after",r,f,s),r}),n.subParser("encodeCode",function(r,f,s){return r=s.converter._dispatch("encodeCode.before",r,f,s),r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,n.helper.escapeCharactersCallback),r=s.converter._dispatch("encodeCode.after",r,f,s),r}),n.subParser("escapeSpecialCharsWithinTagAttributes",function(r,f,s){r=s.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",r,f,s);var d=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,c=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return r=r.replace(d,function(g){return g.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),r=r.replace(c,function(g){return g.replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),r=s.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",r,f,s),r}),n.subParser("githubCodeBlocks",function(r,f,s){return f.ghCodeBlocks?(r=s.converter._dispatch("githubCodeBlocks.before",r,f,s),r+="¨0",r=r.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(d,c,g,u){var v=f.omitExtraWLInCodeBlocks?"":`
`;return u=n.subParser("encodeCode")(u,f,s),u=n.subParser("detab")(u,f,s),u=u.replace(/^\n+/g,""),u=u.replace(/\n+$/g,""),u="<pre><code"+(g?' class="'+g+" language-"+g+'"':"")+">"+u+v+"</code></pre>",u=n.subParser("hashBlock")(u,f,s),`

¨G`+(s.ghCodeBlocks.push({text:d,codeblock:u})-1)+`G

`}),r=r.replace(/¨0/,""),s.converter._dispatch("githubCodeBlocks.after",r,f,s)):r}),n.subParser("hashBlock",function(r,f,s){return r=s.converter._dispatch("hashBlock.before",r,f,s),r=r.replace(/(^\n+|\n+$)/g,""),r=`

¨K`+(s.gHtmlBlocks.push(r)-1)+`K

`,r=s.converter._dispatch("hashBlock.after",r,f,s),r}),n.subParser("hashCodeTags",function(r,f,s){r=s.converter._dispatch("hashCodeTags.before",r,f,s);var d=function(c,g,u,v){var D=u+n.subParser("encodeCode")(g,f,s)+v;return"¨C"+(s.gHtmlSpans.push(D)-1)+"C"};return r=n.helper.replaceRecursiveRegExp(r,d,"<code\\b[^>]*>","</code>","gim"),r=s.converter._dispatch("hashCodeTags.after",r,f,s),r}),n.subParser("hashElement",function(r,f,s){return function(d,c){var g=c;return g=g.replace(/\n\n/g,`
`),g=g.replace(/^\n/,""),g=g.replace(/\n+$/g,""),g=`

¨K`+(s.gHtmlBlocks.push(g)-1)+`K

`,g}}),n.subParser("hashHTMLBlocks",function(r,f,s){r=s.converter._dispatch("hashHTMLBlocks.before",r,f,s);var d=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],c=function(_,U,ne,ie){var oe=_;return ne.search(/\bmarkdown\b/)!==-1&&(oe=ne+s.converter.makeHtml(U)+ie),`

¨K`+(s.gHtmlBlocks.push(oe)-1)+`K

`};f.backslashEscapesHTMLTags&&(r=r.replace(/\\<(\/?[^>]+?)>/g,function(_,U){return"&lt;"+U+"&gt;"}));for(var g=0;g<d.length;++g)for(var u,v=new RegExp("^ {0,3}(<"+d[g]+"\\b[^>]*>)","im"),D="<"+d[g]+"\\b[^>]*>",P="</"+d[g]+">";(u=n.helper.regexIndexOf(r,v))!==-1;){var F=n.helper.splitAtIndex(r,u),H=n.helper.replaceRecursiveRegExp(F[1],c,D,P,"im");if(H===F[1])break;r=F[0].concat(H)}return r=r.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(r,f,s)),r=n.helper.replaceRecursiveRegExp(r,function(_){return`

¨K`+(s.gHtmlBlocks.push(_)-1)+`K

`},"^ {0,3}<!--","-->","gm"),r=r.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(r,f,s)),r=s.converter._dispatch("hashHTMLBlocks.after",r,f,s),r}),n.subParser("hashHTMLSpans",function(r,f,s){r=s.converter._dispatch("hashHTMLSpans.before",r,f,s);function d(c){return"¨C"+(s.gHtmlSpans.push(c)-1)+"C"}return r=r.replace(/<[^>]+?\/>/gi,function(c){return d(c)}),r=r.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(c){return d(c)}),r=r.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(c){return d(c)}),r=r.replace(/<[^>]+?>/gi,function(c){return d(c)}),r=s.converter._dispatch("hashHTMLSpans.after",r,f,s),r}),n.subParser("unhashHTMLSpans",function(r,f,s){r=s.converter._dispatch("unhashHTMLSpans.before",r,f,s);for(var d=0;d<s.gHtmlSpans.length;++d){for(var c=s.gHtmlSpans[d],g=0;/¨C(\d+)C/.test(c);){var u=RegExp.$1;if(c=c.replace("¨C"+u+"C",s.gHtmlSpans[u]),g===10){console.error("maximum nesting of 10 spans reached!!!");break}++g}r=r.replace("¨C"+d+"C",c)}return r=s.converter._dispatch("unhashHTMLSpans.after",r,f,s),r}),n.subParser("hashPreCodeTags",function(r,f,s){r=s.converter._dispatch("hashPreCodeTags.before",r,f,s);var d=function(c,g,u,v){var D=u+n.subParser("encodeCode")(g,f,s)+v;return`

¨G`+(s.ghCodeBlocks.push({text:c,codeblock:D})-1)+`G

`};return r=n.helper.replaceRecursiveRegExp(r,d,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),r=s.converter._dispatch("hashPreCodeTags.after",r,f,s),r}),n.subParser("headers",function(r,f,s){r=s.converter._dispatch("headers.before",r,f,s);var d=isNaN(parseInt(f.headerLevelStart))?1:parseInt(f.headerLevelStart),c=f.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,g=f.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;r=r.replace(c,function(D,P){var F=n.subParser("spanGamut")(P,f,s),H=f.noHeaderId?"":' id="'+v(P)+'"',_=d,U="<h"+_+H+">"+F+"</h"+_+">";return n.subParser("hashBlock")(U,f,s)}),r=r.replace(g,function(D,P){var F=n.subParser("spanGamut")(P,f,s),H=f.noHeaderId?"":' id="'+v(P)+'"',_=d+1,U="<h"+_+H+">"+F+"</h"+_+">";return n.subParser("hashBlock")(U,f,s)});var u=f.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;r=r.replace(u,function(D,P,F){var H=F;f.customizedHeaderId&&(H=F.replace(/\s?\{([^{]+?)}\s*$/,""));var _=n.subParser("spanGamut")(H,f,s),U=f.noHeaderId?"":' id="'+v(F)+'"',ne=d-1+P.length,ie="<h"+ne+U+">"+_+"</h"+ne+">";return n.subParser("hashBlock")(ie,f,s)});function v(D){var P,F;if(f.customizedHeaderId){var H=D.match(/\{([^{]+?)}\s*$/);H&&H[1]&&(D=H[1])}return P=D,n.helper.isString(f.prefixHeaderId)?F=f.prefixHeaderId:f.prefixHeaderId===!0?F="section-":F="",f.rawPrefixHeaderId||(P=F+P),f.ghCompatibleHeaderId?P=P.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():f.rawHeaderId?P=P.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():P=P.replace(/[^\w]/g,"").toLowerCase(),f.rawPrefixHeaderId&&(P=F+P),s.hashLinkCounts[P]?P=P+"-"+s.hashLinkCounts[P]++:s.hashLinkCounts[P]=1,P}return r=s.converter._dispatch("headers.after",r,f,s),r}),n.subParser("horizontalRule",function(r,f,s){r=s.converter._dispatch("horizontalRule.before",r,f,s);var d=n.subParser("hashBlock")("<hr />",f,s);return r=r.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,d),r=r.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,d),r=r.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,d),r=s.converter._dispatch("horizontalRule.after",r,f,s),r}),n.subParser("images",function(r,f,s){r=s.converter._dispatch("images.before",r,f,s);var d=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,c=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,g=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,u=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,v=/!\[([^\[\]]+)]()()()()()/g;function D(F,H,_,U,ne,ie,oe,Z){return U=U.replace(/\s/g,""),P(F,H,_,U,ne,ie,oe,Z)}function P(F,H,_,U,ne,ie,oe,Z){var fe=s.gUrls,le=s.gTitles,be=s.gDimensions;if(_=_.toLowerCase(),Z||(Z=""),F.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)U="";else if(U===""||U===null)if((_===""||_===null)&&(_=H.toLowerCase().replace(/ ?\n/g," ")),U="#"+_,!n.helper.isUndefined(fe[_]))U=fe[_],n.helper.isUndefined(le[_])||(Z=le[_]),n.helper.isUndefined(be[_])||(ne=be[_].width,ie=be[_].height);else return F;H=H.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),U=U.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var he='<img src="'+U+'" alt="'+H+'"';return Z&&n.helper.isString(Z)&&(Z=Z.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),he+=' title="'+Z+'"'),ne&&ie&&(ne=ne==="*"?"auto":ne,ie=ie==="*"?"auto":ie,he+=' width="'+ne+'"',he+=' height="'+ie+'"'),he+=" />",he}return r=r.replace(u,P),r=r.replace(g,D),r=r.replace(c,P),r=r.replace(d,P),r=r.replace(v,P),r=s.converter._dispatch("images.after",r,f,s),r}),n.subParser("italicsAndBold",function(r,f,s){r=s.converter._dispatch("italicsAndBold.before",r,f,s);function d(c,g,u){return g+c+u}return f.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(c,g){return d(g,"<strong><em>","</em></strong>")}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(c,g){return d(g,"<strong>","</strong>")}),r=r.replace(/\b_(\S[\s\S]*?)_\b/g,function(c,g){return d(g,"<em>","</em>")})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(c,g){return/\S$/.test(g)?d(g,"<strong><em>","</em></strong>"):c}),r=r.replace(/__(\S[\s\S]*?)__/g,function(c,g){return/\S$/.test(g)?d(g,"<strong>","</strong>"):c}),r=r.replace(/_([^\s_][\s\S]*?)_/g,function(c,g){return/\S$/.test(g)?d(g,"<em>","</em>"):c})),f.literalMidWordAsterisks?(r=r.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(c,g,u){return d(u,g+"<strong><em>","</em></strong>")}),r=r.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(c,g,u){return d(u,g+"<strong>","</strong>")}),r=r.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(c,g,u){return d(u,g+"<em>","</em>")})):(r=r.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(c,g){return/\S$/.test(g)?d(g,"<strong><em>","</em></strong>"):c}),r=r.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(c,g){return/\S$/.test(g)?d(g,"<strong>","</strong>"):c}),r=r.replace(/\*([^\s*][\s\S]*?)\*/g,function(c,g){return/\S$/.test(g)?d(g,"<em>","</em>"):c})),r=s.converter._dispatch("italicsAndBold.after",r,f,s),r}),n.subParser("lists",function(r,f,s){function d(u,v){s.gListLevel++,u=u.replace(/\n{2,}$/,`
`),u+="¨0";var D=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,P=/\n[ \t]*\n(?!¨0)/.test(u);return f.disableForced4SpacesIndentedSublists&&(D=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),u=u.replace(D,function(F,H,_,U,ne,ie,oe){oe=oe&&oe.trim()!=="";var Z=n.subParser("outdent")(ne,f,s),fe="";return ie&&f.tasklists&&(fe=' class="task-list-item" style="list-style-type: none;"',Z=Z.replace(/^[ \t]*\[(x|X| )?]/m,function(){var le='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return oe&&(le+=" checked"),le+=">",le})),Z=Z.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(le){return"¨A"+le}),H||Z.search(/\n{2,}/)>-1?(Z=n.subParser("githubCodeBlocks")(Z,f,s),Z=n.subParser("blockGamut")(Z,f,s)):(Z=n.subParser("lists")(Z,f,s),Z=Z.replace(/\n$/,""),Z=n.subParser("hashHTMLBlocks")(Z,f,s),Z=Z.replace(/\n\n+/g,`

`),P?Z=n.subParser("paragraphs")(Z,f,s):Z=n.subParser("spanGamut")(Z,f,s)),Z=Z.replace("¨A",""),Z="<li"+fe+">"+Z+`</li>
`,Z}),u=u.replace(/¨0/g,""),s.gListLevel--,v&&(u=u.replace(/\s+$/,"")),u}function c(u,v){if(v==="ol"){var D=u.match(/^ *(\d+)\./);if(D&&D[1]!=="1")return' start="'+D[1]+'"'}return""}function g(u,v,D){var P=f.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,F=f.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,H=v==="ul"?P:F,_="";if(u.search(H)!==-1)(function ne(ie){var oe=ie.search(H),Z=c(u,v);oe!==-1?(_+=`

<`+v+Z+`>
`+d(ie.slice(0,oe),!!D)+"</"+v+`>
`,v=v==="ul"?"ol":"ul",H=v==="ul"?P:F,ne(ie.slice(oe))):_+=`

<`+v+Z+`>
`+d(ie,!!D)+"</"+v+`>
`})(u);else{var U=c(u,v);_=`

<`+v+U+`>
`+d(u,!!D)+"</"+v+`>
`}return _}return r=s.converter._dispatch("lists.before",r,f,s),r+="¨0",s.gListLevel?r=r.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(u,v,D){var P=D.search(/[*+-]/g)>-1?"ul":"ol";return g(v,P,!0)}):r=r.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(u,v,D,P){var F=P.search(/[*+-]/g)>-1?"ul":"ol";return g(D,F,!1)}),r=r.replace(/¨0/,""),r=s.converter._dispatch("lists.after",r,f,s),r}),n.subParser("metadata",function(r,f,s){if(!f.metadata)return r;r=s.converter._dispatch("metadata.before",r,f,s);function d(c){s.metadata.raw=c,c=c.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),c=c.replace(/\n {4}/g," "),c.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(g,u,v){return s.metadata.parsed[u]=v,""})}return r=r.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(c,g,u){return d(u),"¨M"}),r=r.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(c,g,u){return g&&(s.metadata.format=g),d(u),"¨M"}),r=r.replace(/¨M/g,""),r=s.converter._dispatch("metadata.after",r,f,s),r}),n.subParser("outdent",function(r,f,s){return r=s.converter._dispatch("outdent.before",r,f,s),r=r.replace(/^(\t|[ ]{1,4})/gm,"¨0"),r=r.replace(/¨0/g,""),r=s.converter._dispatch("outdent.after",r,f,s),r}),n.subParser("paragraphs",function(r,f,s){r=s.converter._dispatch("paragraphs.before",r,f,s),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,"");for(var d=r.split(/\n{2,}/g),c=[],g=d.length,u=0;u<g;u++){var v=d[u];v.search(/¨(K|G)(\d+)\1/g)>=0?c.push(v):v.search(/\S/)>=0&&(v=n.subParser("spanGamut")(v,f,s),v=v.replace(/^([ \t]*)/g,"<p>"),v+="</p>",c.push(v))}for(g=c.length,u=0;u<g;u++){for(var D="",P=c[u],F=!1;/¨(K|G)(\d+)\1/.test(P);){var H=RegExp.$1,_=RegExp.$2;H==="K"?D=s.gHtmlBlocks[_]:F?D=n.subParser("encodeCode")(s.ghCodeBlocks[_].text,f,s):D=s.ghCodeBlocks[_].codeblock,D=D.replace(/\$/g,"$$$$"),P=P.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,D),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(P)&&(F=!0)}c[u]=P}return r=c.join(`
`),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),s.converter._dispatch("paragraphs.after",r,f,s)}),n.subParser("runExtension",function(r,f,s,d){if(r.filter)f=r.filter(f,d.converter,s);else if(r.regex){var c=r.regex;c instanceof RegExp||(c=new RegExp(c,"g")),f=f.replace(c,r.replace)}return f}),n.subParser("spanGamut",function(r,f,s){return r=s.converter._dispatch("spanGamut.before",r,f,s),r=n.subParser("codeSpans")(r,f,s),r=n.subParser("escapeSpecialCharsWithinTagAttributes")(r,f,s),r=n.subParser("encodeBackslashEscapes")(r,f,s),r=n.subParser("images")(r,f,s),r=n.subParser("anchors")(r,f,s),r=n.subParser("autoLinks")(r,f,s),r=n.subParser("simplifiedAutoLinks")(r,f,s),r=n.subParser("emoji")(r,f,s),r=n.subParser("underline")(r,f,s),r=n.subParser("italicsAndBold")(r,f,s),r=n.subParser("strikethrough")(r,f,s),r=n.subParser("ellipsis")(r,f,s),r=n.subParser("hashHTMLSpans")(r,f,s),r=n.subParser("encodeAmpsAndAngles")(r,f,s),f.simpleLineBreaks?/\n\n¨K/.test(r)||(r=r.replace(/\n+/g,`<br />
`)):r=r.replace(/  +\n/g,`<br />
`),r=s.converter._dispatch("spanGamut.after",r,f,s),r}),n.subParser("strikethrough",function(r,f,s){function d(c){return f.simplifiedAutoLink&&(c=n.subParser("simplifiedAutoLinks")(c,f,s)),"<del>"+c+"</del>"}return f.strikethrough&&(r=s.converter._dispatch("strikethrough.before",r,f,s),r=r.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(c,g){return d(g)}),r=s.converter._dispatch("strikethrough.after",r,f,s)),r}),n.subParser("stripLinkDefinitions",function(r,f,s){var d=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,c=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;r+="¨0";var g=function(u,v,D,P,F,H,_){return v=v.toLowerCase(),r.toLowerCase().split(v).length-1<2?u:(D.match(/^data:.+?\/.+?;base64,/)?s.gUrls[v]=D.replace(/\s/g,""):s.gUrls[v]=n.subParser("encodeAmpsAndAngles")(D,f,s),H?H+_:(_&&(s.gTitles[v]=_.replace(/"|'/g,"&quot;")),f.parseImgDimensions&&P&&F&&(s.gDimensions[v]={width:P,height:F}),""))};return r=r.replace(c,g),r=r.replace(d,g),r=r.replace(/¨0/,""),r}),n.subParser("tables",function(r,f,s){if(!f.tables)return r;var d=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,c=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function g(F){return/^:[ \t]*--*$/.test(F)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(F)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(F)?' style="text-align:center;"':""}function u(F,H){var _="";return F=F.trim(),(f.tablesHeaderId||f.tableHeaderId)&&(_=' id="'+F.replace(/ /g,"_").toLowerCase()+'"'),F=n.subParser("spanGamut")(F,f,s),"<th"+_+H+">"+F+`</th>
`}function v(F,H){var _=n.subParser("spanGamut")(F,f,s);return"<td"+H+">"+_+`</td>
`}function D(F,H){for(var _=`<table>
<thead>
<tr>
`,U=F.length,ne=0;ne<U;++ne)_+=F[ne];for(_+=`</tr>
</thead>
<tbody>
`,ne=0;ne<H.length;++ne){_+=`<tr>
`;for(var ie=0;ie<U;++ie)_+=H[ne][ie];_+=`</tr>
`}return _+=`</tbody>
</table>
`,_}function P(F){var H,_=F.split(`
`);for(H=0;H<_.length;++H)/^ {0,3}\|/.test(_[H])&&(_[H]=_[H].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(_[H])&&(_[H]=_[H].replace(/\|[ \t]*$/,"")),_[H]=n.subParser("codeSpans")(_[H],f,s);var U=_[0].split("|").map(function(he){return he.trim()}),ne=_[1].split("|").map(function(he){return he.trim()}),ie=[],oe=[],Z=[],fe=[];for(_.shift(),_.shift(),H=0;H<_.length;++H)_[H].trim()!==""&&ie.push(_[H].split("|").map(function(he){return he.trim()}));if(U.length<ne.length)return F;for(H=0;H<ne.length;++H)Z.push(g(ne[H]));for(H=0;H<U.length;++H)n.helper.isUndefined(Z[H])&&(Z[H]=""),oe.push(u(U[H],Z[H]));for(H=0;H<ie.length;++H){for(var le=[],be=0;be<oe.length;++be)n.helper.isUndefined(ie[H][be]),le.push(v(ie[H][be],Z[be]));fe.push(le)}return D(oe,fe)}return r=s.converter._dispatch("tables.before",r,f,s),r=r.replace(/\\(\|)/g,n.helper.escapeCharactersCallback),r=r.replace(d,P),r=r.replace(c,P),r=s.converter._dispatch("tables.after",r,f,s),r}),n.subParser("underline",function(r,f,s){return f.underline&&(r=s.converter._dispatch("underline.before",r,f,s),f.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(d,c){return"<u>"+c+"</u>"}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(d,c){return"<u>"+c+"</u>"})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(d,c){return/\S$/.test(c)?"<u>"+c+"</u>":d}),r=r.replace(/__(\S[\s\S]*?)__/g,function(d,c){return/\S$/.test(c)?"<u>"+c+"</u>":d})),r=r.replace(/(_)/g,n.helper.escapeCharactersCallback),r=s.converter._dispatch("underline.after",r,f,s)),r}),n.subParser("unescapeSpecialChars",function(r,f,s){return r=s.converter._dispatch("unescapeSpecialChars.before",r,f,s),r=r.replace(/¨E(\d+)E/g,function(d,c){var g=parseInt(c);return String.fromCharCode(g)}),r=s.converter._dispatch("unescapeSpecialChars.after",r,f,s),r}),n.subParser("makeMarkdown.blockquote",function(r,f){var s="";if(r.hasChildNodes())for(var d=r.childNodes,c=d.length,g=0;g<c;++g){var u=n.subParser("makeMarkdown.node")(d[g],f);u!==""&&(s+=u)}return s=s.trim(),s="> "+s.split(`
`).join(`
> `),s}),n.subParser("makeMarkdown.codeBlock",function(r,f){var s=r.getAttribute("language"),d=r.getAttribute("precodenum");return"```"+s+`
`+f.preList[d]+"\n```"}),n.subParser("makeMarkdown.codeSpan",function(r){return"`"+r.innerHTML+"`"}),n.subParser("makeMarkdown.emphasis",function(r,f){var s="";if(r.hasChildNodes()){s+="*";for(var d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);s+="*"}return s}),n.subParser("makeMarkdown.header",function(r,f,s){var d=new Array(s+1).join("#"),c="";if(r.hasChildNodes()){c=d+" ";for(var g=r.childNodes,u=g.length,v=0;v<u;++v)c+=n.subParser("makeMarkdown.node")(g[v],f)}return c}),n.subParser("makeMarkdown.hr",function(){return"---"}),n.subParser("makeMarkdown.image",function(r){var f="";return r.hasAttribute("src")&&(f+="!["+r.getAttribute("alt")+"](",f+="<"+r.getAttribute("src")+">",r.hasAttribute("width")&&r.hasAttribute("height")&&(f+=" ="+r.getAttribute("width")+"x"+r.getAttribute("height")),r.hasAttribute("title")&&(f+=' "'+r.getAttribute("title")+'"'),f+=")"),f}),n.subParser("makeMarkdown.links",function(r,f){var s="";if(r.hasChildNodes()&&r.hasAttribute("href")){var d=r.childNodes,c=d.length;s="[";for(var g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);s+="](",s+="<"+r.getAttribute("href")+">",r.hasAttribute("title")&&(s+=' "'+r.getAttribute("title")+'"'),s+=")"}return s}),n.subParser("makeMarkdown.list",function(r,f,s){var d="";if(!r.hasChildNodes())return"";for(var c=r.childNodes,g=c.length,u=r.getAttribute("start")||1,v=0;v<g;++v)if(!(typeof c[v].tagName>"u"||c[v].tagName.toLowerCase()!=="li")){var D="";s==="ol"?D=u.toString()+". ":D="- ",d+=D+n.subParser("makeMarkdown.listItem")(c[v],f),++u}return d+=`
<!-- -->
`,d.trim()}),n.subParser("makeMarkdown.listItem",function(r,f){for(var s="",d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);return/\n$/.test(s)?s=s.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):s+=`
`,s}),n.subParser("makeMarkdown.node",function(r,f,s){s=s||!1;var d="";if(r.nodeType===3)return n.subParser("makeMarkdown.txt")(r,f);if(r.nodeType===8)return"<!--"+r.data+`-->

`;if(r.nodeType!==1)return"";var c=r.tagName.toLowerCase();switch(c){case"h1":s||(d=n.subParser("makeMarkdown.header")(r,f,1)+`

`);break;case"h2":s||(d=n.subParser("makeMarkdown.header")(r,f,2)+`

`);break;case"h3":s||(d=n.subParser("makeMarkdown.header")(r,f,3)+`

`);break;case"h4":s||(d=n.subParser("makeMarkdown.header")(r,f,4)+`

`);break;case"h5":s||(d=n.subParser("makeMarkdown.header")(r,f,5)+`

`);break;case"h6":s||(d=n.subParser("makeMarkdown.header")(r,f,6)+`

`);break;case"p":s||(d=n.subParser("makeMarkdown.paragraph")(r,f)+`

`);break;case"blockquote":s||(d=n.subParser("makeMarkdown.blockquote")(r,f)+`

`);break;case"hr":s||(d=n.subParser("makeMarkdown.hr")(r,f)+`

`);break;case"ol":s||(d=n.subParser("makeMarkdown.list")(r,f,"ol")+`

`);break;case"ul":s||(d=n.subParser("makeMarkdown.list")(r,f,"ul")+`

`);break;case"precode":s||(d=n.subParser("makeMarkdown.codeBlock")(r,f)+`

`);break;case"pre":s||(d=n.subParser("makeMarkdown.pre")(r,f)+`

`);break;case"table":s||(d=n.subParser("makeMarkdown.table")(r,f)+`

`);break;case"code":d=n.subParser("makeMarkdown.codeSpan")(r,f);break;case"em":case"i":d=n.subParser("makeMarkdown.emphasis")(r,f);break;case"strong":case"b":d=n.subParser("makeMarkdown.strong")(r,f);break;case"del":d=n.subParser("makeMarkdown.strikethrough")(r,f);break;case"a":d=n.subParser("makeMarkdown.links")(r,f);break;case"img":d=n.subParser("makeMarkdown.image")(r,f);break;default:d=r.outerHTML+`

`}return d}),n.subParser("makeMarkdown.paragraph",function(r,f){var s="";if(r.hasChildNodes())for(var d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);return s=s.trim(),s}),n.subParser("makeMarkdown.pre",function(r,f){var s=r.getAttribute("prenum");return"<pre>"+f.preList[s]+"</pre>"}),n.subParser("makeMarkdown.strikethrough",function(r,f){var s="";if(r.hasChildNodes()){s+="~~";for(var d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);s+="~~"}return s}),n.subParser("makeMarkdown.strong",function(r,f){var s="";if(r.hasChildNodes()){s+="**";for(var d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f);s+="**"}return s}),n.subParser("makeMarkdown.table",function(r,f){var s="",d=[[],[]],c=r.querySelectorAll("thead>tr>th"),g=r.querySelectorAll("tbody>tr"),u,v;for(u=0;u<c.length;++u){var D=n.subParser("makeMarkdown.tableCell")(c[u],f),P="---";if(c[u].hasAttribute("style")){var F=c[u].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(F){case"text-align:left;":P=":---";break;case"text-align:right;":P="---:";break;case"text-align:center;":P=":---:";break}}d[0][u]=D.trim(),d[1][u]=P}for(u=0;u<g.length;++u){var H=d.push([])-1,_=g[u].getElementsByTagName("td");for(v=0;v<c.length;++v){var U=" ";typeof _[v]<"u"&&(U=n.subParser("makeMarkdown.tableCell")(_[v],f)),d[H].push(U)}}var ne=3;for(u=0;u<d.length;++u)for(v=0;v<d[u].length;++v){var ie=d[u][v].length;ie>ne&&(ne=ie)}for(u=0;u<d.length;++u){for(v=0;v<d[u].length;++v)u===1?d[u][v].slice(-1)===":"?d[u][v]=n.helper.padEnd(d[u][v].slice(-1),ne-1,"-")+":":d[u][v]=n.helper.padEnd(d[u][v],ne,"-"):d[u][v]=n.helper.padEnd(d[u][v],ne);s+="| "+d[u].join(" | ")+` |
`}return s.trim()}),n.subParser("makeMarkdown.tableCell",function(r,f){var s="";if(!r.hasChildNodes())return"";for(var d=r.childNodes,c=d.length,g=0;g<c;++g)s+=n.subParser("makeMarkdown.node")(d[g],f,!0);return s.trim()}),n.subParser("makeMarkdown.txt",function(r){var f=r.nodeValue;return f=f.replace(/ +/g," "),f=f.replace(/¨NBSP;/g," "),f=n.helper.unescapeHTMLEntities(f),f=f.replace(/([*_~|`])/g,"\\$1"),f=f.replace(/^(\s*)>/g,"\\$1>"),f=f.replace(/^#/gm,"\\#"),f=f.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),f=f.replace(/^( {0,3}\d+)\./gm,"$1\\."),f=f.replace(/^( {0,3})([+-])/gm,"$1\\$2"),f=f.replace(/]([\s]*)\(/g,"\\]$1\\("),f=f.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),f});var W=this;a.exports?a.exports=n:W.showdown=n}).call(qt)})(Hr);var za=Hr.exports;function wr(a,e){let t=!1;const n=e.length;let i=e[0];for(let o=1;o<=n;o++){const l=e[o%n];if(a.y>Math.min(i.y,l.y)&&a.y<=Math.max(i.y,l.y)&&a.x<=Math.max(i.x,l.x)&&i.y!=l.y){const y=(a.y-i.y)*(l.x-i.x)/(l.y-i.y)+i.x;(i.x==l.x||a.x<=y)&&(t=!t)}i=l}return t}function Er(a,e){let t;return function(...i){t&&clearTimeout(t),t=setTimeout(()=>{a(...i),t=void 0},e)}}function Ga(a){for(const e in a)if(a.hasOwnProperty(e))return!1;return!0}function Gn(a,e,t=[]){if(a===e)return!0;if(typeof a!="object"||typeof e!="object"||a===null||e===null)return!1;const n=Object.keys(a).filter(o=>!t.includes(o)),i=Object.keys(e).filter(o=>!t.includes(o));if(n.length!==i.length)return!1;for(const o of n)if(!i.includes(o)||!Gn(a[o],e[o],t))return!1;return!0}function Wa(a,e){return Gn(a,e,["lastModified","lastModifiedUserId"])}function br(a,e){let t=JSON.stringify(a);if(e){const i=JSON.stringify(e);t=t+i}return new TextEncoder().encode(t).length>14384}function _n(a,e){const t=["lastModified","lastModifiedUserId"];if(a.length!==e.length)return!1;for(let n=0;n<a.length;n++)if(!Gn(a[n],e[n],t))return!1;return!0}function qa(a,e){e.forEach(t=>{const n=a.findIndex(i=>i.id===t.id);n!==-1?a[n]=t:a.push(t)})}function Ka(){try{localStorage.setItem("STORAGECHECK","test")}catch{const e=document.getElementById("localStorageWarning");e.innerText="Local Storage disabled. Some features will not function."}}function _r(a,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",i=t.matches?"light":"dark";for(var o=0;o<e.styleSheets.length;o++)for(var l=0;l<e.styleSheets[o].cssRules.length;l++){let y=e.styleSheets[o].cssRules[l];y&&y.media&&y.media.mediaText.includes("prefers-color-scheme")&&(a.mode=="LIGHT"?(y.media.appendMedium(`(prefers-color-scheme: ${n})`),y.media.mediaText.includes(i)&&y.media.deleteMedium(`(prefers-color-scheme: ${i})`)):a.mode=="DARK"&&(y.media.appendMedium(`(prefers-color-scheme: ${i})`),y.media.mediaText.includes(n)&&y.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}async function $n(){const a=I.sceneItems.filter(Qn);if(!I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]&&a.length==0){const e=[],t=Vr().width(I.gridDpi*30).height(I.gridDpi*30).visible(!1).shapeType("RECTANGLE").name("Smoke! Boundary Box").visible(!0).locked(!1).strokeColor("pink").strokeOpacity(.5).fillColor(I.fogColor).fillOpacity(I.sceneMetadata[`${h.EXTENSIONID}/visionEnabled`]===!0?1:0).strokeDash([200,500]).strokeWidth(50).layer("FOG").visible(!0).zIndex(0).build();t.metadata[`${h.EXTENSIONID}/isBackgroundImage`]=!0,t.metadata[`${h.EXTENSIONID}/grid`]=!0,t.id=h.GRIDID,e.push(t),await C.scene.items.addItems(e),await C.scene.fog.setFilled(!1)}I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]===!0&&a.length>0&&(I.sceneMetadata[`${h.EXTENSIONID}/visionEnabled`]===!0&&await C.scene.fog.setFilled(!0),await C.scene.items.deleteItems([h.GRIDID]))}function Ya(a){function e(){document.getElementById("contextMenu").style.display="none"}const t=document.getElementById(`tr-${a.id}`);if(t){const n=t.getElementsByClassName("token-name")[0],i=t.getElementsByClassName("token-vision-range")[0],o=t.getElementsByClassName("unlimited-vision")[0],l=t.getElementsByClassName("no-vision")[0],y=t.getElementsByClassName("hidden-token")[0];n&&(n.innerText=a.name),i&&!o.checked&&!l.checked&&(i.value=a.metadata[`${h.EXTENSIONID}/visionRange`]!==void 0?a.metadata[`${h.EXTENSIONID}/visionRange`]:h.VISIONDEFAULT),o&&(o.checked=a.metadata[`${h.EXTENSIONID}/visionRange`]===0),l&&(l.checked=a.metadata[`${h.EXTENSIONID}/visionBlind`]),y&&(y.checked=a.metadata[`${h.EXTENSIONID}/hiddenToken`]),o.checked||l.checked?i.setAttribute("disabled","disabled"):i.removeAttribute("disabled")}else{const n=I.sceneMetadata[`${h.EXTENSIONID}/USER-${a.createdUserId}`];let i=n?.color,o=n?.name?`This token is owned by ${n.name}.`:"This token is owned by you.";!i&&a.createdUserId!==I.playerId&&(i="#aeb0af",o="This tokens owner is not in the room currently.");const l=I.sceneItems.find(B=>B.id===a.id),y=document.createElement("tr");y.id=`tr-${l.id}`,y.className="token-table-entry",y.innerHTML=`<td id="contextLocator" title="${o}" ${i==="#aeb0af"?'style="color:black !important; font-style: italic;" ':""}data-color="${i}" class="token-name">${l.name}</td>
                           <td class="token-vision-container" title="The unit of measurement for your grid"><input class="token-vision-range" type="number" value=${h.VISIONDEFAULT}><span class="unit">${I.gridType}</span></td>
                           <td class="token-vision-container-grid">
                            <div class="vision-container-div">
                                <label class="cbutton" title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span class="emoji">&infin;</span></label>
                                <label class="cbutton" title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span class="emoji">&#128294;</span></label>
                                <label class="cbutton" title="Disable vision on this token"><input type="checkbox" class="no-vision"><span class="emoji">&#8856;</span></label>
                                <label class="cbutton" title="Move to Out-of-Sight List"><input type="checkbox" class="hidden-token"><span class="emoji">&#128065;</span></label>
                            </div>
                           </td>`,a.metadata[`${h.EXTENSIONID}/hiddenToken`]===!0?te.hiddenTable.prepend(y):te.table.appendChild(y),y.getElementsByClassName("token-name")[0].style.textShadow=`
        -2px -2px 2px ${i},
        2px -2px 2px ${i},
        -2px 2px 2px ${i},
        2px 2px 2px ${i}`;const b=y.getElementsByClassName("token-vision-range")[0],k=y.getElementsByClassName("unlimited-vision")[0],M=y.getElementsByClassName("torch-vision")[0],L=y.getElementsByClassName("no-vision")[0],x=y.getElementsByClassName("hidden-token")[0];b&&!k.checked&&!L.checked&&(b.value=a.metadata[`${h.EXTENSIONID}/visionRange`]?a.metadata[`${h.EXTENSIONID}/visionRange`]:h.VISIONDEFAULT),k&&(k.checked=a.metadata[`${h.EXTENSIONID}/visionRange`]===0),M&&(M.checked=a.metadata[`${h.EXTENSIONID}/visionTorch`]),L&&(L.checked=a.metadata[`${h.EXTENSIONID}/visionBlind`]),x&&(x.checked=a.metadata[`${h.EXTENSIONID}/hiddenToken`]),k.checked||L.checked?b.setAttribute("disabled","disabled"):b.removeAttribute("disabled"),b.onchange=async B=>{if(!B||!B.target)return;const O=I.sceneItems.find(V=>V.id===a.id),j=B.target,A=parseInt(j.value);A<0&&(j.value="0"),A>999&&(j.value="999"),await C.scene.items.updateItems([O],V=>{V[0].metadata[`${h.EXTENSIONID}/visionRange`]=A})},x.onclick=async B=>{if(!B||!B.target)return;const O=I.sceneItems.find(V=>V.id===a.id),j=B.target,A=document.getElementById(`tr-${a.id}`);j.checked?te.hiddenTable.prepend(A):te.table.appendChild(A),await C.scene.items.updateItems([O],V=>{V[0].metadata[`${h.EXTENSIONID}/hiddenToken`]=j.checked})},k.onclick=async B=>{if(!B||!B.target)return;const O=I.sceneItems.find(V=>V.id===a.id);let j=0;B.target.checked?(b.setAttribute("disabled","disabled"),L.checked=!1):(j=parseInt(b.value),b.removeAttribute("disabled")),await C.scene.items.updateItems([O],V=>{V[0].metadata[`${h.EXTENSIONID}/visionRange`]=j})},L.onclick=async B=>{if(!B||!B.target)return;const O=I.sceneItems.find(A=>A.id===a.id),j=B.target;j.checked?b.setAttribute("disabled","disabled"):b.removeAttribute("disabled"),await C.scene.items.updateItems([O],A=>{A[0].metadata[`${h.EXTENSIONID}/visionBlind`]=j.checked})},M.onclick=async B=>{if(!B||!B.target)return;const O=I.sceneItems.find(A=>A.id===a.id),j=B.target;await C.scene.items.updateItems([O],A=>{A[0].metadata[`${h.EXTENSIONID}/visionTorch`]=j.checked})},b.addEventListener("mousewheel",async()=>{}),y.oncontextmenu=async function(B){B.preventDefault();const O=B.currentTarget,j=document.getElementById("contextMenu"),A=W=>{W.preventDefault()},V=async W=>{const r=W.target,f=j.getAttribute("currentUnit"),s=I.party.find(g=>r.id===g.id)?.color,c=document.getElementById(`tr-${f}`).getElementsByClassName("token-name")[0];s?c.style.textShadow=`
                    -2px -2px 2px ${s},
                    2px -2px 2px ${s},
                    -2px 2px 2px ${s},
                    2px 2px 2px ${s}`:c.style.textShadow="",await C.scene.items.updateItems([f],g=>{for(const u of g)u.createdUserId=r.id}),j.style.display="none",W.stopPropagation(),window.removeEventListener("click",X),j.removeEventListener("click",V),j.removeEventListener("contextmenu",A)};j.setAttribute("currentUnit",O.id.substring(3));const X=()=>{j.style.display="none",window.removeEventListener("click",X),j.removeEventListener("click",V),j.removeEventListener("contextmenu",A)};if(j.addEventListener("click",V),j.addEventListener("contextmenu",A),window.addEventListener("click",X),j.style.display=="block")e();else{const r=(document.getElementById("playerListing").children.length+1)*34,f=Math.min(B.pageX,window.innerWidth-150);let s=Math.min(B.pageY,(window.innerHeight>300?window.innerHeight-50:window.innerHeight)-120);window.innerHeight<r+s&&(s=window.innerHeight-r),j.style.display="block",j.style.left=f+"px",j.style.top=s+"px"}}}}async function Za(a){const e=await C.scene.local.getItems(n=>n.metadata[`${h.EXTENSIONID}/doorId`]!==void 0),t=[];for(let n of e){let i=!1;for(const o of a)n.metadata[`${h.EXTENSIONID}/doorId`]==o.id&&(i=!0);i&&t.push(n.id)}await C.scene.local.deleteItems(t)}async function en(a){const e=[],t=await C.scene.local.getItems(n=>n.metadata[`${h.EXTENSIONID}/doorId`]!==void 0);for(const n of a){if(!Ha(n)||t.some(l=>l.metadata[`${h.EXTENSIONID}/doorId`]===n.id))continue;const i=ze.fromItem(n),o=[];for(let l=0;l<n.points.length;l++){const y=ze.fromPosition(n.points[l]);o.push(ze.decompose(ze.multiply(i,y)).position)}e.push(mt().locked(!0).commands(Ur(n.metadata[`${h.EXTENSIONID}/disabled`]===!0)).scale({x:.2,y:.2}).name("Door").position(We.centroid(o)).metadata({[`${h.EXTENSIONID}/doorId`]:n.id}).build())}e.length>0&&await C.scene.local.addItems(e)}async function Ja(a){const e=await C.scene.local.getItems(t=>t.id===a&&t.metadata[`${h.EXTENSIONID}/doorId`]!==void 0);if(e.length===1){const t=e[0].metadata[`${h.EXTENSIONID}/doorId`],n=I.sceneItems.filter(i=>i.id===t);await C.scene.items.updateItems(n,i=>{const o=i[0];I.playerRole!=="GM"&&o.metadata[`${h.EXTENSIONID}/isDoorLocked`]||(o.metadata[`${h.EXTENSIONID}/isVisionLine`]&&o.metadata[`${h.EXTENSIONID}/disabled`]?(delete o.metadata[`${h.EXTENSIONID}/disabled`],delete o.metadata[`${h.EXTENSIONID}/doorOpen`]):o.metadata[`${h.EXTENSIONID}/isVisionLine`]&&(o.metadata[`${h.EXTENSIONID}/disabled`]=!0,o.metadata[`${h.EXTENSIONID}/doorOpen`]=!0,delete o.metadata[`${h.EXTENSIONID}/isDoorLocked`]))}),await C.player.deselect([a])}}async function Qa(){const a=I.sceneItems.filter(e=>e.metadata[`${h.EXTENSIONID}/isDoor`]===!0);await en(a)}function Ur(a){return a?h.DOOROPEN:h.DOORCLOSED}var zr={exports:{}};(function(a){(function(){function e(y,b){var k=y.x-b.x,M=y.y-b.y;return k*k+M*M}function t(y,b,k){var M=b.x,L=b.y,x=k.x-M,B=k.y-L;if(x!==0||B!==0){var O=((y.x-M)*x+(y.y-L)*B)/(x*x+B*B);O>1?(M=k.x,L=k.y):O>0&&(M+=x*O,L+=B*O)}return x=y.x-M,B=y.y-L,x*x+B*B}function n(y,b){for(var k=y[0],M=[k],L,x=1,B=y.length;x<B;x++)L=y[x],e(L,k)>b&&(M.push(L),k=L);return k!==L&&M.push(L),M}function i(y,b,k,M,L){for(var x=M,B,O=b+1;O<k;O++){var j=t(y[O],y[b],y[k]);j>x&&(B=O,x=j)}x>M&&(B-b>1&&i(y,b,B,M,L),L.push(y[B]),k-B>1&&i(y,B,k,M,L))}function o(y,b){var k=y.length-1,M=[y[0]];return i(y,0,k,b,M),M.push(y[k]),M}function l(y,b,k){if(y.length<=2)return y;var M=b!==void 0?b*b:1;return y=k?y:n(y,M),y=o(y,M),y}a.exports=l,a.exports.default=l})()})(zr);var ei=zr.exports;const ti=zn(ei),Wn="#000000",qn=8,Kn=[];function Ln(a){const e=I.sceneItems.filter(i=>i.layer==="MAP"),t={};for(let i=0;i<e.length;i++){let o=a.querySelector("#map-"+e[i].id);o===null&&(o=document.createElement("option"),o.id="map-"+e[i].id,o.value=e[i].id,o.innerText=e[i].name,a.appendChild(o)),t[e[i].id]=e[i].name}let n=a.querySelectorAll("option");for(let i=0;i<n.length;i++)t[n[i].value]===void 0&&a.removeChild(n[i])}async function ni(a,e,t,n,i){if(i.innerText="",Number.isNaN(t)||t<0){i.innerText="Invalid DPI";return}let o=I.gridDpi/t,l,y=[];if(y[0]=0,y[1]=0,n!==""){let b=await C.scene.items.getItems([n]);if(b.length>0)l=b[0],t===0&&(t=l.grid.dpi),o=I.gridDpi/t,y[0]=l.position.x-l.grid.offset.x*o,y[1]=l.position.y-l.grid.offset.y*o;else{i.innerText="Unable to find map";return}}else{i.innerText="No map selected";return}a==="foundry"?oi(e,o,y,i):a==="uvtt"&&ii(e,o,y,i)}function Ir(a){const e=[];for(const t of a){const n=[];for(const o of t)n.push({x:o.x*I.gridDpi,y:o.y*I.gridDpi});const i=ut().tension(0).points(n).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??Wn).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??Kn).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??qn).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${h.EXTENSIONID}/isVisionLine`]:!0}).build();e.push(i)}return e}function ri(a){const e=[];for(const t of a){const n=[];for(const o of t.bounds)n.push({x:o.x*I.gridDpi,y:o.y*I.gridDpi});const i=ut().tension(0).points(n).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??Wn).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??Kn).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??qn).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Door)").closed(!1).locked(!0).visible(!1).metadata({[`${h.EXTENSIONID}/isVisionLine`]:!0,[`${h.EXTENSIONID}/isDoor`]:!0}).build();e.push(i)}return e}async function ai(a,e){let t=[];a.objects_line_of_sight?.length>0&&(t=t.concat(Ir(a.objects_line_of_sight))),a.line_of_sight?.length>0&&(t=t.concat(Ir(a.line_of_sight))),a.portals?.length>0&&(t=t.concat(ri(a.portals)));try{if(a.lights?.length>0){const b=[];for(const k of a.lights){const M=Ba({height:150,width:150,url:"https://battle-system.com/blank.png",mime:"image/png"},{dpi:300,offset:{x:150,y:150}}).position({x:k.position.x*I.gridDpi,y:k.position.y*I.gridDpi}).layer("CHARACTER").metadata({[`${h.EXTENSIONID}/hasVision`]:!0,[`${h.EXTENSIONID}/visionRange`]:k.range.toString(),[`${h.EXTENSIONID}/visionTorch`]:!0,[`${h.EXTENSIONID}/hiddenToken`]:!0}).name("Imported Light Source").build();b.push(M)}t=t.concat(b)}const n=atob(a.image),i=new Uint8Array(n.length);for(let b=0;b<n.length;b++)i[b]=n.charCodeAt(b);const o=new Blob([i],{type:"image/png"}),l=Xa(o).grid({dpi:a.resolution.pixels_per_grid,offset:{x:0,y:0}}).build(),y=Fa().baseMap(l).name("New UVTT Scene").items(t).build();await C.assets.uploadScenes([y],!0),await C.notification.show("Toggle Smoke Off then On when opening the new Scene","DEFAULT")}catch(n){await C.notification.show("There was an error: "+n,"ERROR")}}async function Gr(a,e,t,n,i){let o=0,l=0,y=0;const b=[];for(let k=0;k<a.length;k++){let M=[],L=!1;for(let x=0;x<a[k].length-1;x++){let B=a[k][x].x*e,O=a[k][x].y*e,j=a[k][x+1].x*e,A=a[k][x+1].y*e;M.push({x:B*t+n[0],y:O*t+n[1]}),M.push({x:j*t+n[0],y:A*t+n[1]}),l++,!L&&a[k][x].door&&(L=!0)}M.length>128&&(M.length,M=ti(M,8,!1));for(let x=0;x<M.length;x+=256){const B=M.slice(x>0?x-1:0,x+256),O=ut().tension(0).points(B).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??Wn).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??Kn).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??qn).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Import)").closed(!1).locked(!0).build();if(O.visible=!1,O.metadata[`${h.EXTENSIONID}/isVisionLine`]=!0,L&&(O.metadata[`${h.EXTENSIONID}/isDoor`]=!0),b.push(O),y+=B.length,y>512||b.length>64){o+=b.length,await C.scene.items.addItems(b);const j=b.filter(A=>A.metadata[`${h.EXTENSIONID}/isDoor`]===!0);await en(j),b.length=0,y=0}}}if(b.length>0){o+=b.length,await C.scene.items.addItems(b);const k=b.filter(M=>M.metadata[`${h.EXTENSIONID}/isDoor`]===!0);await en(k)}i.innerText="Finished importing "+o+" walls, "+l+" points."}function ii(a,e,t,n){if(a.resolution.map_origin!==void 0&&(t[0]-=a.resolution.map_origin.x*a.resolution.pixels_per_grid,t[1]-=a.resolution.map_origin.y*a.resolution.pixels_per_grid),a.portals&&a.portals.length)for(let o=0;o<a.portals.length;o++){let l=a.portals[o].bounds;l[0].door=!0,l[1].door=!0,a.line_of_sight.push(l)}const i=a.line_of_sight.concat(a.objects_line_of_sight);Gr(i,a.resolution.pixels_per_grid,e,t,n)}function oi(a,e,t,n){if(!a.walls||a.walls.length===0){n.innerText="No walls found";return}const i=[];for(var o=0;o<a.walls.length;o++)i.push([{x:a.walls[o].c[0],y:a.walls[o].c[1],door:!!a.walls[o].door},{x:a.walls[o].c[2],y:a.walls[o].c[3],door:!!a.walls[o].door}]);Gr(i,1,e,t,n)}async function kr(){await C.contextMenu.create({id:`${h.EXTENSIONID}/convert-curve`,icons:[{icon:"/opendoor.svg",label:"Convert to Obstruction",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/elevation`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:void 0}],roles:["GM"]}}],async onClick(a){const e="#000000",n=[],i=[],o=[];for(const l of a.items){if(l.type==="CURVE"){const y=l;if(y.points.length>2){const b=ut().tension(0).points(y.points).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??e).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??n).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).position(y.position).metadata({[`${h.EXTENSIONID}/isVisionLine`]:!0}).build();y.style.closed&&b.points.push(y.points[0]),i.push(b),o.push(y.id)}}else if(l.type==="LINE"){const y=l,b=ut().tension(0).points([y.startPosition,y.endPosition]).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??e).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??n).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).position(y.position).metadata({[`${h.EXTENSIONID}/isVisionLine`]:!0}).build();i.push(b),o.push(y.id)}else if(l.type==="SHAPE"){const y=l,b=[];if(y.shapeType==="CIRCLE"){const k=Math.min(y.width,y.height)/2,M=2*Math.PI/20;for(let L=0;L<20;L++){const x=L*M,B=k*Math.cos(x),O=k*Math.sin(x);b.push({x:B,y:O})}}else if(y.shapeType==="RECTANGLE"){const L=0+y.width,x=0+y.height;b.push({x:0,y:0}),b.push({x:L,y:0}),b.push({x:L,y:x}),b.push({x:0,y:x})}else if(y.shapeType==="HEXAGON"){const k=y.width/2,M=[Math.PI/2,Math.PI/6,11*Math.PI/6,3*Math.PI/2,7*Math.PI/6,5*Math.PI/6];for(let L=0;L<6;L++){const x=M[L],B=k*Math.cos(x),O=k*Math.sin(x);b.push({x:B,y:O})}}else y.shapeType==="TRIANGLE"&&(b.push({x:0,y:0}),b.push({x:0-y.width/2,y:0+y.height}),b.push({x:0+y.width/2,y:0+y.height}));if(b.length>0){const k=ut().tension(0).points(b).position(y.position).rotation(y.rotation).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??e).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??n).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${h.EXTENSIONID}/isVisionLine`]:!0}).build();k.points.push(b[0]),i.push(k),o.push(y.id)}}i.length>0&&(await C.scene.items.addItems(i),await C.scene.items.deleteItems(o))}}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:["metadata",`${h.EXTENSIONID}/hasVision`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${h.SPECTREID}/spectred`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:["metadata",`${h.SPECTREID}/spectred`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${h.EXTENSIONID}/hasVision`]===void 0);await C.scene.items.updateItems(a.items,t=>{for(const n of t)e?(n.metadata[`${h.EXTENSIONID}/hasVision`]=!0,n.metadata[`${h.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${h.EXTENSIONID}/visionRange`]=h.VISIONDEFAULT)):delete n.metadata[`${h.EXTENSIONID}/hasVision`]})}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${h.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(a){if(a.items.length>0){const e=a.items.map(n=>n.id),t=await C.scene.items.getItemAttachments(e);await C.scene.items.updateItems(t,n=>{for(const i of n)e.includes(i.attachedTo)&&(i.metadata[`${h.EXTENSIONID}/hasVision`]&&(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")?delete i.metadata[`${h.EXTENSIONID}/hasVision`]:(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${h.EXTENSIONID}/hasVision`]=!0,i.metadata[`${h.EXTENSIONID}/visionRange`]===void 0&&(i.metadata[`${h.EXTENSIONID}/visionRange`]=h.VISIONDEFAULT)))})}}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${h.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${h.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(a){await C.scene.items.updateItems(a.items,e=>{for(const t of e)t.metadata[`${h.EXTENSIONID}/isVisionLine`]&&t.metadata[`${h.EXTENSIONID}/disabled`]?delete t.metadata[`${h.EXTENSIONID}/disabled`]:t.metadata[`${h.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${h.EXTENSIONID}/disabled`]=!0)})}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${h.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${h.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${h.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${h.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(a){await C.scene.items.updateItems(a.items,e=>{for(const t of e)(t.metadata[`${h.EXTENSIONID}/isVisionLine`]||t.metadata[`${h.ARMINDOID}/isVisionLine`])&&(t.metadata[`${h.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${h.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${h.EXTENSIONID}/oneSided`],delete t.metadata[`${h.ARMINDOID}/oneSided`]):(t.metadata[`${h.EXTENSIONID}/isVisionLine`]||t.metadata[`${h.ARMINDOID}/isVisionLine`])&&(t.metadata[`${h.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${h.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${h.EXTENSIONID}/oneSided`]="right",t.metadata[`${h.ARMINDOID}/oneSided`]="right"):(t.metadata[`${h.EXTENSIONID}/isVisionLine`]||t.metadata[`${h.ARMINDOID}/isVisionLine`])&&(t.metadata[`${h.EXTENSIONID}/oneSided`]="left",t.metadata[`${h.ARMINDOID}/oneSided`]="left")})}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"}]}}],async onClick(a){a.items.length>0&&await C.scene.items.updateItems(a.items,e=>{for(let t=0;t<e.length;t++)e[t].zIndex=1,e[t].layer="FOG",e[t].disableHit=!0,e[t].locked=!1,e[t].visible=!1,e[t].metadata[`${h.EXTENSIONID}/isBackgroundMap`]=!0})}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/bounding-grid`,icons:[{icon:"/icon.svg",label:"Smoke Bounding Grid",filter:{every:[{key:["metadata",`${h.EXTENSIONID}/grid`],value:!0}]}}],async onClick(a){await C.notification.show("This is the Smoke&Spectre Bounding Grid. It contains the area your fog can be drawn in. To remove this and have fog contained dynamically by the size of your map(s), turn on AutoDetect Maps in Settings.","INFO")}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/create-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${h.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/grid`],value:void 0}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${h.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/grid`],value:void 0}],roles:["GM"]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${h.EXTENSIONID}/isDoor`]===void 0);await C.scene.items.updateItems(a.items,t=>{for(const n of t)e?n.metadata[`${h.EXTENSIONID}/isDoor`]=!0:delete n.metadata[`${h.EXTENSIONID}/isDoor`]}),e?await en(a.items):await Za(a.items)}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/open-door`,icons:[{icon:"/opendoor.svg",label:"Open Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${h.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${h.EXTENSIONID}/doorOpen`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/isDoorLocked`],value:void 0}]}},{icon:"/closedoor.svg",label:"Close Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${h.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${h.EXTENSIONID}/doorOpen`],value:!0},{key:["metadata",`${h.EXTENSIONID}/isDoorLocked`],value:void 0}]}}],async onClick(a){await C.scene.items.updateItems(a.items,e=>{for(let t of e)t.metadata[`${h.EXTENSIONID}/isVisionLine`]&&t.metadata[`${h.EXTENSIONID}/disabled`]?(delete t.metadata[`${h.EXTENSIONID}/disabled`],delete t.metadata[`${h.EXTENSIONID}/doorOpen`]):t.metadata[`${h.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${h.EXTENSIONID}/disabled`]=!0,t.metadata[`${h.EXTENSIONID}/doorOpen`]=!0)})}}),await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-door-lock`,icons:[{icon:"/locked-door.svg",label:"Lock Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isDoorLocked`],value:void 0},{key:["metadata",`${h.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${h.EXTENSIONID}/doorOpen`],value:void 0}],roles:["GM"]}},{icon:"/unlocked-door.svg",label:"Unlock Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${h.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${h.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${h.EXTENSIONID}/doorOpen`],value:void 0}],roles:["GM"]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${h.EXTENSIONID}/isDoorLocked`]===void 0);await C.scene.items.updateItems(a.items,t=>{for(const n of t)e?n.metadata[`${h.EXTENSIONID}/isDoorLocked`]=!0:delete n.metadata[`${h.EXTENSIONID}/isDoorLocked`]})}})}async function tn(a){a?await C.contextMenu.create({id:`${h.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${h.EXTENSIONID}/hasAutohide`],value:void 0,coordinator:"&&"},{key:["metadata",`${h.SPECTREID}/spectred`],value:void 0,operator:"=="}],roles:["GM"]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"&&"},{key:["metadata",`${h.SPECTREID}/spectred`],value:void 0,operator:"=="}],roles:["GM"]}}],async onClick(e){const t=e.items.every(n=>n.metadata[`${h.EXTENSIONID}/hasAutohide`]===void 0);await C.scene.items.updateItems(e.items,n=>{for(const i of n)t?i.metadata[`${h.EXTENSIONID}/hasAutohide`]=!0:delete i.metadata[`${h.EXTENSIONID}/hasAutohide`]})}}):await C.contextMenu.remove(`${h.EXTENSIONID}/toggle-autohide-menu`)}function In(a,e){a.split(/\s+/).forEach(t=>{e(t)})}class si{constructor(){this._events=void 0,this._events={}}on(e,t){In(e,n=>{const i=this._events[n]||[];i.push(t),this._events[n]=i})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}In(e,i=>{if(n===1){delete this._events[i];return}const o=this._events[i];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[i]=o)})}trigger(e,...t){var n=this;In(e,i=>{const o=n._events[i];o!==void 0&&o.forEach(l=>{l.apply(n,t)})})}}function di(a){return a.plugins={},class extends a{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){a.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const i=this,o=[];if(Array.isArray(e))e.forEach(l=>{typeof l=="string"?o.push(l):(i.plugins.settings[l.name]=l.options,o.push(l.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],o.push(t));for(;n=o.shift();)i.require(n)}loadPlugin(e){var t=this,n=t.plugins,i=a.plugins[e];if(!a.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const sn=a=>(a=a.filter(Boolean),a.length<2?a[0]||"":ci(a)==1?"["+a.join("")+"]":"(?:"+a.join("|")+")"),Wr=a=>{if(!ui(a))return a.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return a.forEach((i,o)=>{if(i===a[o-1]){t++;return}n(),e+=i,t=1}),n(),e},qr=a=>{let e=Yn(a);return sn(e)},ui=a=>new Set(a).size!==a.length,At=a=>(a+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),ci=a=>a.reduce((e,t)=>Math.max(e,li(t)),0),li=a=>Yn(a).length,Yn=a=>Array.from(a);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Kr=a=>{if(a.length===1)return[[a]];let e=[];const t=a.substring(1);return Kr(t).forEach(function(i){let o=i.slice(0);o[0]=a.charAt(0)+o[0],e.push(o),o=i.slice(0),o.unshift(a.charAt(0)),e.push(o)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const fi=[[0,65535]],hi="[̀-ͯ·ʾʼ]";let nn,Yr;const pi=3,Zn={},Sr={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let a in Sr){let e=Sr[a]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Zn[n]=a}}const mi=new RegExp(Object.keys(Zn).join("|")+"|"+hi,"gu"),gi=a=>{nn===void 0&&(nn=Ei(a||fi))},Tr=(a,e="NFKD")=>a.normalize(e),rn=a=>Yn(a).reduce((e,t)=>e+yi(t),""),yi=a=>(a=Tr(a).toLowerCase().replace(mi,e=>Zn[e]||""),Tr(a,"NFC"));function*vi(a){for(const[e,t]of a)for(let n=e;n<=t;n++){let i=String.fromCharCode(n),o=rn(i);o!=i.toLowerCase()&&(o.length>pi||o.length!=0&&(yield{folded:o,composed:i,code_point:n}))}}const wi=a=>{const e={},t=(n,i)=>{const o=e[n]||new Set,l=new RegExp("^"+qr(o)+"$","iu");i.match(l)||(o.add(At(i)),e[n]=o)};for(let n of vi(a))t(n.folded,n.folded),t(n.folded,n.composed);return e},Ei=a=>{const e=wi(a),t={};let n=[];for(let o in e){let l=e[o];l&&(t[o]=qr(l)),o.length>1&&n.push(At(o))}n.sort((o,l)=>l.length-o.length);const i=sn(n);return Yr=new RegExp("^"+i,"u"),t},bi=(a,e=1)=>{let t=0;return a=a.map(n=>(nn[n]&&(t+=n.length),nn[n]||n)),t>=e?Wr(a):""},_i=(a,e=1)=>(e=Math.max(e,a.length-1),sn(Kr(a).map(t=>bi(t,e)))),Nr=(a,e=!0)=>{let t=a.length>1?1:0;return sn(a.map(n=>{let i=[];const o=e?n.length():n.length()-1;for(let l=0;l<o;l++)i.push(_i(n.substrs[l]||"",t));return Wr(i)}))},Ii=(a,e)=>{for(const t of e){if(t.start!=a.start||t.end!=a.end||t.substrs.join("")!==a.substrs.join(""))continue;let n=a.parts;const i=l=>{for(const y of n){if(y.start===l.start&&y.substr===l.substr)return!1;if(!(l.length==1||y.length==1)&&(l.start<y.start&&l.end>y.start||y.start<l.start&&y.end>l.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};class an{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new an,i=JSON.parse(JSON.stringify(this.parts)),o=i.pop();for(const b of i)n.add(b);let l=t.substr.substring(0,e-o.start),y=l.length;return n.add({start:o.start,end:o.start+y,length:y,substr:l}),n}}const ki=a=>{gi(),a=rn(a);let e="",t=[new an];for(let n=0;n<a.length;n++){let o=a.substring(n).match(Yr);const l=a.substring(n,n+1),y=o?o[0]:null;let b=[],k=new Set;for(const M of t){const L=M.last();if(!L||L.length==1||L.end<=n)if(y){const x=y.length;M.add({start:n,end:n+x,length:x,substr:y}),k.add("1")}else M.add({start:n,end:n+1,length:1,substr:l}),k.add("2");else if(y){let x=M.clone(n,L);const B=y.length;x.add({start:n,end:n+B,length:B,substr:y}),b.push(x)}else k.add("3")}if(b.length>0){b=b.sort((M,L)=>M.length()-L.length());for(let M of b)Ii(M,t)||t.push(M);continue}if(n>0&&k.size==1&&!k.has("3")){e+=Nr(t,!1);let M=new an;const L=t[0];L&&M.add(L.last()),t=[M]}}return e+=Nr(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Si=(a,e)=>{if(a)return a[e]},Ti=(a,e)=>{if(a){for(var t,n=e.split(".");(t=n.shift())&&(a=a[t]););return a}},kn=(a,e,t)=>{var n,i;return!a||(a=a+"",e.regex==null)||(i=a.search(e.regex),i===-1)?0:(n=e.string.length/a.length,i===0&&(n+=.5),n*t)},Sn=(a,e)=>{var t=a[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(a[e]=[t])},Qe=(a,e)=>{if(Array.isArray(a))a.forEach(e);else for(var t in a)a.hasOwnProperty(t)&&e(a[t],t)},Ni=(a,e)=>typeof a=="number"&&typeof e=="number"?a>e?1:a<e?-1:0:(a=rn(a+"").toLowerCase(),e=rn(e+"").toLowerCase(),a>e?1:e>a?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Oi{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const i=[],o=e.split(/\s+/);var l;return n&&(l=new RegExp("^("+Object.keys(n).map(At).join("|")+"):(.*)$")),o.forEach(y=>{let b,k=null,M=null;l&&(b=y.match(l))&&(k=b[1],y=b[2]),y.length>0&&(this.settings.diacritics?M=ki(y)||null:M=At(y),M&&t&&(M="\\b"+M)),i.push({string:y,regex:M?new RegExp(M,"iu"):null,field:k})}),i}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const i=e.options.fields,o=e.weights,l=i.length,y=e.getAttrFn;if(!l)return function(){return 1};const b=function(){return l===1?function(k,M){const L=i[0].field;return kn(y(M,L),k,o[L]||1)}:function(k,M){var L=0;if(k.field){const x=y(M,k.field);!k.regex&&x?L+=1/l:L+=kn(x,k,1)}else Qe(o,(x,B)=>{L+=kn(y(M,B),k,x)});return L/l}}();return n===1?function(k){return b(t[0],k)}:e.options.conjunction==="and"?function(k){var M,L=0;for(let x of t){if(M=b(x,k),M<=0)return 0;L+=M}return L/n}:function(k){var M=0;return Qe(t,L=>{M+=b(L,k)}),M/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const i=this,o=e.options,l=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof l=="function")return l.bind(this);const y=function(M,L){return M==="$score"?L.score:e.getAttrFn(i.items[L.id],M)};if(l)for(let k of l)(e.query||k.field!=="$score")&&n.push(k);if(e.query){t=!0;for(let k of n)if(k.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(k=>k.field!=="$score");return n.length?function(k,M){var L,x;for(let B of n)if(x=B.field,L=(B.direction==="desc"?-1:1)*Ni(y(x,k),y(x,M)),L)return L;return 0}:null}prepareSearch(e,t){const n={};var i=Object.assign({},t);if(Sn(i,"sort"),Sn(i,"sort_empty"),i.fields){Sn(i,"fields");const o=[];i.fields.forEach(l=>{typeof l=="string"&&(l={field:l,weight:1}),o.push(l),n[l.field]="weight"in l?l.weight:1}),i.fields=o}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:i.nesting?Ti:Si}}search(e,t){var n=this,i,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const l=t.score||n._getScoreFunction(o);e.length?Qe(n.items,(b,k)=>{i=l(b),(t.filter===!1||i>0)&&o.items.push({score:i,id:k})}):Qe(n.items,(b,k)=>{o.items.push({score:1,id:k})});const y=n._getSortFunction(o);return y&&o.items.sort(y),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const St=(a,e)=>{if(Array.isArray(a))a.forEach(e);else for(var t in a)a.hasOwnProperty(t)&&e(a[t],t)},Ue=a=>{if(a.jquery)return a[0];if(a instanceof HTMLElement)return a;if(Zr(a)){var e=document.createElement("template");return e.innerHTML=a.trim(),e.content.firstChild}return document.querySelector(a)},Zr=a=>typeof a=="string"&&a.indexOf("<")>-1,Ci=a=>a.replace(/['"\\]/g,"\\$&"),Tn=(a,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),a.dispatchEvent(t)},Xt=(a,e)=>{Object.assign(a.style,e)},Je=(a,...e)=>{var t=Jr(e);a=Qr(a),a.map(n=>{t.map(i=>{n.classList.add(i)})})},pt=(a,...e)=>{var t=Jr(e);a=Qr(a),a.map(n=>{t.map(i=>{n.classList.remove(i)})})},Jr=a=>{var e=[];return St(a,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Qr=a=>(Array.isArray(a)||(a=[a]),a),Kt=(a,e,t)=>{if(!(t&&!t.contains(a)))for(;a&&a.matches;){if(a.matches(e))return a;a=a.parentNode}},Or=(a,e=0)=>e>0?a[a.length-1]:a[0],Di=a=>Object.keys(a).length===0,on=(a,e)=>{if(!a)return-1;e=e||a.nodeName;for(var t=0;a=a.previousElementSibling;)a.matches(e)&&t++;return t},Xe=(a,e)=>{St(e,(t,n)=>{t==null?a.removeAttribute(n):a.setAttribute(n,""+t)})},Rn=(a,e)=>{a.parentNode&&a.parentNode.replaceChild(e,a)},Mi=(a,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var l=o.data.match(e);if(l&&o.data.length>0){var y=document.createElement("span");y.className="highlight";var b=o.splitText(l.index);b.splitText(l[0].length);var k=b.cloneNode(!0);return y.appendChild(k),Rn(b,y),1}return 0},n=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(l=>{i(l)})},i=o=>o.nodeType===3?t(o):(n(o),0);i(a)},Pi=a=>{var e=a.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Ai=65,$i=13,ea=27,xn=37,Li=38,ta=39,Ri=40,Cr=8,xi=46,Bn=9,Bi=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Ft=Bi?"metaKey":"ctrlKey";var Dr={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(a){return a.length>0},render:{}};const ot=a=>typeof a>"u"||a===null?null:Yt(a),Yt=a=>typeof a=="boolean"?a?"1":"0":a+"",Zt=a=>(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Xi=(a,e)=>e>0?setTimeout(a,e):(a.call(null),null),Fi=(a,e)=>{var t;return function(n,i){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[n]=!0,a.call(o,n,i)},e)}},Mr=(a,e,t)=>{var n,i=a.trigger,o={};a.trigger=function(){var l=arguments[0];if(e.indexOf(l)!==-1)o[l]=arguments;else return i.apply(a,arguments)},t.apply(a,[]),a.trigger=i;for(n of e)n in o&&i.apply(a,o[n])},ji=a=>({start:a.selectionStart||0,length:(a.selectionEnd||0)-(a.selectionStart||0)}),$e=(a,e=!1)=>{a&&(a.preventDefault(),e&&a.stopPropagation())},Le=(a,e,t,n)=>{a.addEventListener(e,t,n)},Et=(a,e)=>{if(!e||!e[a])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Nn=(a,e)=>{const t=a.getAttribute("id");return t||(a.setAttribute("id",e),e)},Pr=a=>a.replace(/[\\"']/g,"\\$&"),bt=(a,e)=>{e&&a.append(e)};function Ar(a,e){var t=Object.assign({},Dr,e),n=t.dataAttr,i=t.labelField,o=t.valueField,l=t.disabledField,y=t.optgroupField,b=t.optgroupLabelField,k=t.optgroupValueField,M=a.tagName.toLowerCase(),L=a.getAttribute("placeholder")||a.getAttribute("data-placeholder");if(!L&&!t.allowEmptyOption){let j=a.querySelector('option[value=""]');j&&(L=j.textContent)}var x={placeholder:L,options:[],optgroups:[],items:[],maxItems:null},B=()=>{var j,A=x.options,V={},X=1;let W=0;var r=d=>{var c=Object.assign({},d.dataset),g=n&&c[n];return typeof g=="string"&&g.length&&(c=Object.assign(c,JSON.parse(g))),c},f=(d,c)=>{var g=ot(d.value);if(g!=null&&!(!g&&!t.allowEmptyOption)){if(V.hasOwnProperty(g)){if(c){var u=V[g][y];u?Array.isArray(u)?u.push(c):V[g][y]=[u,c]:V[g][y]=c}}else{var v=r(d);v[i]=v[i]||d.textContent,v[o]=v[o]||g,v[l]=v[l]||d.disabled,v[y]=v[y]||c,v.$option=d,v.$order=v.$order||++W,V[g]=v,A.push(v)}d.selected&&x.items.push(g)}},s=d=>{var c,g;g=r(d),g[b]=g[b]||d.getAttribute("label")||"",g[k]=g[k]||X++,g[l]=g[l]||d.disabled,g.$order=g.$order||++W,x.optgroups.push(g),c=g[k],St(d.children,u=>{f(u,c)})};x.maxItems=a.hasAttribute("multiple")?null:1,St(a.children,d=>{j=d.tagName.toLowerCase(),j==="optgroup"?s(d):j==="option"&&f(d)})},O=()=>{const j=a.getAttribute(n);if(j)x.options=JSON.parse(j),St(x.options,V=>{x.items.push(V[o])});else{var A=a.value.trim()||"";if(!t.allowEmptyOption&&!A.length)return;const V=A.split(t.delimiter);St(V,X=>{const W={};W[i]=X,W[o]=X,x.options.push(W)}),x.items=V}};return M==="select"?B():O(),Object.assign({},Dr,x,e)}var $r=0;class et extends di(si){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,$r++;var n,i=Ue(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(i,null);n=o.getPropertyValue("direction");const l=Ar(i,t);this.settings=l,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=Nn(i,"tomselect-"+$r),this.isRequired=i.required,this.sifter=new Oi(this.options,{diacritics:l.diacritics}),l.mode=l.mode||(l.maxItems===1?"single":"multi"),typeof l.hideSelected!="boolean"&&(l.hideSelected=l.mode==="multi"),typeof l.hidePlaceholder!="boolean"&&(l.hidePlaceholder=l.mode!=="multi");var y=l.createFilter;typeof y!="function"&&(typeof y=="string"&&(y=new RegExp(y)),y instanceof RegExp?l.createFilter=A=>y.test(A):l.createFilter=A=>this.settings.duplicates||!this.options[A]),this.initializePlugins(l.plugins),this.setupCallbacks(),this.setupTemplates();const b=Ue("<div>"),k=Ue("<div>"),M=this._render("dropdown"),L=Ue('<div role="listbox" tabindex="-1">'),x=this.input.getAttribute("class")||"",B=l.mode;var O;if(Je(b,l.wrapperClass,x,B),Je(k,l.controlClass),bt(b,k),Je(M,l.dropdownClass,B),l.copyClassesToDropdown&&Je(M,x),Je(L,l.dropdownContentClass),bt(M,L),Ue(l.dropdownParent||b).appendChild(M),Zr(l.controlInput)){O=Ue(l.controlInput);var j=["autocorrect","autocapitalize","autocomplete","spellcheck"];Qe(j,A=>{i.getAttribute(A)&&Xe(O,{[A]:i.getAttribute(A)})}),O.tabIndex=-1,k.appendChild(O),this.focus_node=O}else l.controlInput?(O=Ue(l.controlInput),this.focus_node=O):(O=Ue("<input/>"),this.focus_node=k);this.wrapper=b,this.dropdown=M,this.dropdown_content=L,this.control=k,this.control_input=O,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,i=e.dropdown,o=e.dropdown_content,l=e.wrapper,y=e.control,b=e.input,k=e.focus_node,M={passive:!0},L=e.inputId+"-ts-dropdown";Xe(o,{id:L}),Xe(k,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":L});const x=Nn(k,e.inputId+"-ts-control"),B="label[for='"+Ci(e.inputId)+"']",O=document.querySelector(B),j=e.focus.bind(e);if(O){Le(O,"click",j),Xe(O,{for:x});const X=Nn(O,e.inputId+"-ts-label");Xe(k,{"aria-labelledby":X}),Xe(o,{"aria-labelledby":X})}if(l.style.width=b.style.width,e.plugins.names.length){const X="plugin-"+e.plugins.names.join(" plugin-");Je([l,i],X)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&Xe(b,{multiple:"multiple"}),t.placeholder&&Xe(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+At(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Fi(t.load,t.loadThrottle)),Le(i,"mousemove",()=>{e.ignoreHover=!1}),Le(i,"mouseenter",X=>{var W=Kt(X.target,"[data-selectable]",i);W&&e.onOptionHover(X,W)},{capture:!0}),Le(i,"click",X=>{const W=Kt(X.target,"[data-selectable]");W&&(e.onOptionSelect(X,W),$e(X,!0))}),Le(y,"click",X=>{var W=Kt(X.target,"[data-ts-item]",y);if(W&&e.onItemSelect(X,W)){$e(X,!0);return}n.value==""&&(e.onClick(),$e(X,!0))}),Le(k,"keydown",X=>e.onKeyDown(X)),Le(n,"keypress",X=>e.onKeyPress(X)),Le(n,"input",X=>e.onInput(X)),Le(k,"blur",X=>e.onBlur(X)),Le(k,"focus",X=>e.onFocus(X)),Le(n,"paste",X=>e.onPaste(X));const A=X=>{const W=X.composedPath()[0];if(!l.contains(W)&&!i.contains(W)){e.isFocused&&e.blur(),e.inputState();return}W==n&&e.isOpen?X.stopPropagation():$e(X,!0)},V=()=>{e.isOpen&&e.positionDropdown()};Le(document,"mousedown",A),Le(window,"scroll",V,M),Le(window,"resize",V,M),this._destroy=()=>{document.removeEventListener("mousedown",A),window.removeEventListener("scroll",V),window.removeEventListener("resize",V),O&&O.removeEventListener("click",j)},this.revertSettings={innerHTML:b.innerHTML,tabIndex:b.tabIndex},b.tabIndex=-1,b.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Le(b,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,b.disabled?e.disable():b.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Je(b,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),Qe(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,i={optgroup:o=>{let l=document.createElement("div");return l.className="optgroup",l.appendChild(o.options),l},optgroup_header:(o,l)=>'<div class="optgroup-header">'+l(o[n])+"</div>",option:(o,l)=>"<div>"+l(o[t])+"</div>",item:(o,l)=>"<div>"+l(o[t])+"</div>",option_create:(o,l)=>'<div class="create">Add <strong>'+l(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Ar(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Tn(this.input,"input"),Tn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){$e(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var i=n.trim().split(t.settings.splitOn);Qe(i,o=>{ot(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){$e(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),$e(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Bn&&$e(e);return}switch(e.keyCode){case Ai:if(Et(Ft,e)&&t.control_input.value==""){$e(e),t.selectAll();return}break;case ea:t.isOpen&&($e(e,!0),t.close()),t.clearActiveItems();return;case Ri:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}$e(e);return;case Li:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}$e(e);return;case $i:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),$e(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&$e(e);return;case xn:t.advanceSelection(-1,e);return;case ta:t.advanceSelection(1,e);return;case Bn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),$e(e)),t.settings.create&&t.createItem()&&$e(e));return;case Cr:case xi:t.deleteSelection(e);return}t.isInputHidden&&!Et(Ft,e)&&$e(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=Xi(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),$e(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(n=t.dataset.value,typeof n<"u"&&(i.lastQuery=null,i.addItem(n),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?($e(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Je(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||pt(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Tn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];Mr(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,i,o,l,y,b,k;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&Et("shiftKey",t)&&n.activeItems.length){for(k=n.getLastActive(),l=Array.prototype.indexOf.call(n.control.children,k),y=Array.prototype.indexOf.call(n.control.children,e),l>y&&(b=l,l=y,y=b),o=l;o<=y;o++)e=n.control.children[o],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);$e(t)}else i==="click"&&Et(Ft,t)||i==="keydown"&&Et("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&pt(n,"last-active"),Je(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),pt(e,"active")}clearActiveItems(){pt(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,Xe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),Xe(e,{"aria-selected":"true"}),Je(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,i=n.clientHeight,o=n.scrollTop||0,l=e.offsetHeight,y=e.getBoundingClientRect().top-n.getBoundingClientRect().top+o;y+l>i+o?this.scroll(y-i+l,t):y<o&&this.scroll(y,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(pt(this.activeOption,"active"),Xe(this.activeOption,{"aria-selected":null})),this.activeOption=null,Xe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,Qe(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(Xe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&Xe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,i=this,o=this.getSearchOptions();if(i.settings.score&&(n=i.settings.score.call(i,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(o,{score:n})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(l=>{let y=ot(l.id);return!(y&&i.items.indexOf(y)!==-1)})),t}refreshOptions(e=!0){var t,n,i,o,l,y,b,k,M,L;const x={},B=[];var O=this,j=O.inputValue();const A=j===O.lastQuery||j==""&&O.lastQuery==null;var V=O.search(j),X=null,W=O.settings.shouldOpen||!1,r=O.dropdown_content;A&&(X=O.activeOption,X&&(M=X.closest("[data-group]"))),o=V.items.length,typeof O.settings.maxOptions=="number"&&(o=Math.min(o,O.settings.maxOptions)),o>0&&(W=!0);const f=(d,c)=>{let g=x[d];if(g!==void 0){let v=B[g];if(v!==void 0)return[g,v.fragment]}let u=document.createDocumentFragment();return g=B.length,B.push({fragment:u,order:c,optgroup:d}),[g,u]};for(t=0;t<o;t++){let d=V.items[t];if(!d)continue;let c=d.id,g=O.options[c];if(g===void 0)continue;let u=Yt(c),v=O.getOption(u,!0);for(O.settings.hideSelected||v.classList.toggle("selected",O.items.includes(u)),l=g[O.settings.optgroupField]||"",y=Array.isArray(l)?l:[l],n=0,i=y&&y.length;n<i;n++){l=y[n];let D=g.$order,P=O.optgroups[l];P===void 0?l="":D=P.$order;const[F,H]=f(l,D);n>0&&(v=v.cloneNode(!0),Xe(v,{id:g.$id+"-clone-"+n,"aria-selected":null}),v.classList.add("ts-cloned"),pt(v,"active"),O.activeOption&&O.activeOption.dataset.value==c&&M&&M.dataset.group===l.toString()&&(X=v)),H.appendChild(v),l!=""&&(x[l]=F)}}O.settings.lockOptgroupOrder&&B.sort((d,c)=>d.order-c.order),b=document.createDocumentFragment(),Qe(B,d=>{let c=d.fragment,g=d.optgroup;if(!c||!c.children.length)return;let u=O.optgroups[g];if(u!==void 0){let v=document.createDocumentFragment(),D=O.render("optgroup_header",u);bt(v,D),bt(v,c);let P=O.render("optgroup",{group:u,options:v});bt(b,P)}else bt(b,c)}),r.innerHTML="",bt(r,b),O.settings.highlight&&(Pi(r),V.query.length&&V.tokens.length&&Qe(V.tokens,d=>{Mi(r,d.regex)}));var s=d=>{let c=O.render(d,{input:j});return c&&(W=!0,r.insertBefore(c,r.firstChild)),c};if(O.loading?s("loading"):O.settings.shouldLoad.call(O,j)?V.items.length===0&&s("no_results"):s("not_loading"),k=O.canCreate(j),k&&(L=s("option_create")),O.hasOptions=V.items.length>0||k,W){if(V.items.length>0){if(!X&&O.settings.mode==="single"&&O.items[0]!=null&&(X=O.getOption(O.items[0])),!r.contains(X)){let d=0;L&&!O.settings.addPrecedence&&(d=1),X=O.selectable()[d]}}else L&&(X=L);e&&!O.isOpen&&(O.open(),O.scrollToOption(X,"auto")),O.setActiveOption(X)}else O.clearActiveOption(),e&&O.isOpen&&O.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const i=ot(e[n.settings.valueField]);return i===null||n.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[i]=e,n.lastQuery=null,t&&(n.userOptions[i]=t,n.trigger("option_add",i,e)),i)}addOptions(e,t=!1){Qe(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=ot(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var i,o;const l=ot(e),y=ot(t[n.settings.valueField]);if(l===null)return;const b=n.options[l];if(b==null)return;if(typeof y!="string")throw new Error("Value must be set in option data");const k=n.getOption(l),M=n.getItem(l);if(t.$order=t.$order||b.$order,delete n.options[l],n.uncacheValue(y),n.options[y]=t,k){if(n.dropdown_content.contains(k)){const L=n._render("option",t);Rn(k,L),n.activeOption===k&&n.setActiveOption(L)}k.remove()}M&&(o=n.items.indexOf(l),o!==-1&&n.items.splice(o,1,y),i=n._render("item",t),M.classList.contains("active")&&Je(i,"active"),Rn(M,i)),n.lastQuery=null}removeOption(e,t){const n=this;e=Yt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};Qe(this.options,(i,o)=>{t(i,o)&&(n[o]=i)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=ot(e);if(n===null)return null;const i=this.options[n];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,n="option"){var i=this,o;if(!e)return null;n=="item"?o=i.controlChildren():o=i.dropdown_content.querySelectorAll("[data-selectable]");for(let l=0;l<o.length;l++)if(o[l]==e)return t>0?o[l+1]:o[l-1];return null}getItem(e){if(typeof e=="object")return e;var t=ot(e);return t!==null?this.control.querySelector(`[data-value="${Pr(t)}"]`):null}addItems(e,t){var n=this,i=Array.isArray(e)?e:[e];i=i.filter(l=>n.items.indexOf(l)===-1);const o=i[i.length-1];i.forEach(l=>{n.isPending=l!==o,n.addItem(l,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];Mr(this,n,()=>{var i,o;const l=this,y=l.settings.mode,b=ot(e);if(!(b&&l.items.indexOf(b)!==-1&&(y==="single"&&l.close(),y==="single"||!l.settings.duplicates))&&!(b===null||!l.options.hasOwnProperty(b))&&(y==="single"&&l.clear(t),!(y==="multi"&&l.isFull()))){if(i=l._render("item",l.options[b]),l.control.contains(i)&&(i=i.cloneNode(!0)),o=l.isFull(),l.items.splice(l.caretPos,0,b),l.insertAtCaret(i),l.isSetup){if(!l.isPending&&l.settings.hideSelected){let k=l.getOption(b),M=l.getAdjacent(k,1);M&&l.setActiveOption(M)}!l.isPending&&!l.settings.closeAfterSelect&&l.refreshOptions(l.isFocused&&y!=="single"),l.settings.closeAfterSelect!=!1&&l.isFull()?l.close():l.isPending||l.positionDropdown(),l.trigger("item_add",b,i),l.isPending||l.updateOriginalInput({silent:t})}(!l.isPending||!o&&l.isFull())&&(l.inputState(),l.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var i,o;const l=e.dataset.value;i=on(e),e.remove(),e.classList.contains("active")&&(o=n.activeItems.indexOf(e),n.activeItems.splice(o,1),pt(e,"active")),n.items.splice(i,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(l)&&n.removeOption(l,t),i<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",l,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,i=n.caretPos,o;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var l=!1,y=b=>{if(n.unlock(),!b||typeof b!="object")return t();var k=ot(b[n.settings.valueField]);if(typeof k!="string")return t();n.setTextboxValue(),n.addOption(b,!0),n.setCaret(i),n.addItem(k),t(b),l=!0};return typeof n.settings.create=="function"?o=n.settings.create.call(this,e,y):o={[n.settings.labelField]:e,[n.settings.valueField]:e},l||y(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",n),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",Di(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,i;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let b=function(k,M,L){return k||(k=Ue('<option value="'+Zt(M)+'">'+Zt(L)+"</option>")),k!=o&&t.input.append(k),l.push(k),(k!=o||y>0)&&(k.selected=!0),k};const l=[],y=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(k=>{k.selected=!1}),t.items.length==0&&t.settings.mode=="single"?b(o,"",""):t.items.forEach(k=>{if(n=t.options[k],i=n[t.settings.labelField]||"",l.includes(n.$option)){const M=t.input.querySelector(`option[value="${Pr(k)}"]:not(:checked)`);b(M,k,i)}else n.$option=b(n.$option,k,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,Xe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Xt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Xt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,Xe(t.focus_node,{"aria-expanded":"false"}),Xt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;Xt(this.dropdown,{width:t.width+"px",top:n+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();Qe(n,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,i=t.control;i.insertBefore(e,i.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,i,o,l=this;t=e&&e.keyCode===Cr?-1:1,n=ji(l.control_input);const y=[];if(l.activeItems.length)o=Or(l.activeItems,t),i=on(o),t>0&&i++,Qe(l.activeItems,b=>y.push(b));else if((l.isFocused||l.settings.mode==="single")&&l.items.length){const b=l.controlChildren();let k;t<0&&n.start===0&&n.length===0?k=b[l.caretPos-1]:t>0&&n.start===l.inputValue().length&&(k=b[l.caretPos]),k!==void 0&&y.push(k)}if(!l.shouldDelete(y,e))return!1;for($e(e,!0),typeof i<"u"&&l.setCaret(i);y.length;)l.removeItem(y.pop());return l.inputState(),l.positionDropdown(),l.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(i=>i.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,i,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(Et(Ft,t)||Et("shiftKey",t)?(n=o.getLastActive(e),n?n.classList.contains("active")?i=o.getAdjacent(n,e,"item"):i=n:e>0?i=o.control_input.nextElementSibling:i=o.control_input.previousElementSibling,i&&(i.classList.contains("active")&&o.removeActiveItem(n),o.setActiveItemClass(i))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Or(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,pt(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,i;const o=this;if(typeof this.settings.render[e]!="function"||(i=o.settings.render[e].call(this,t,Zt),!i))return null;if(i=Ue(i),e==="option"||e==="option_create"?t[o.settings.disabledField]?Xe(i,{"aria-disabled":"true"}):Xe(i,{"data-selectable":""}):e==="optgroup"&&(n=t.group[o.settings.optgroupValueField],Xe(i,{"data-group":n}),t.group[o.settings.disabledField]&&Xe(i,{"data-disabled":""})),e==="option"||e==="item"){const l=Yt(t[o.settings.valueField]);Xe(i,{"data-value":l}),e==="item"?(Je(i,o.settings.itemClass),Xe(i,{"data-ts-item":""})):(Je(i,o.settings.optionClass),Xe(i,{role:"option",id:t.$id}),t.$div=i,o.options[l]=t)}return i}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){Qe(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var i=this,o=i[t];i[t]=function(){var l,y;return e==="after"&&(l=o.apply(i,arguments)),y=n.apply(i,arguments),e==="instead"?y:(e==="before"&&(l=o.apply(i,arguments)),l)}}}function Vi(){Le(this.input,"change",()=>{this.sync()})}function Hi(a){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},a);var i=function(y,b){b?(y.checked=!0,n.uncheckedClassNames&&y.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&y.classList.add(...n.checkedClassNames)):(y.checked=!1,n.checkedClassNames&&y.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&y.classList.add(...n.uncheckedClassNames))},o=function(y){setTimeout(()=>{var b=y.querySelector("input."+n.className);b instanceof HTMLInputElement&&i(b,y.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var l=e.settings.render.option;e.settings.render.option=(y,b)=>{var k=Ue(l.call(e,y,b)),M=document.createElement("input");n.className&&M.classList.add(n.className),M.addEventListener("click",function(x){$e(x)}),M.type="checkbox";const L=ot(y[e.settings.valueField]);return i(M,!!(L&&e.items.indexOf(L)>-1)),k.prepend(M),k}}),e.on("item_remove",l=>{var y=e.getOption(l);y&&(y.classList.remove("selected"),o(y))}),e.on("item_add",l=>{var y=e.getOption(l);y&&o(y)}),e.hook("instead","onOptionSelect",(l,y)=>{if(y.classList.contains("selected")){y.classList.remove("selected"),e.removeItem(y.dataset.value),e.refreshOptions(),$e(l,!0);return}t.call(e,l,y),o(y)})}function Ui(a){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},a);e.on("initialize",()=>{var n=Ue(t.html(t));n.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(n)})}const zi=(a,e)=>{var t;(t=a.parentNode)==null||t.insertBefore(e,a.nextSibling)},Gi=(a,e)=>{var t;(t=a.parentNode)==null||t.insertBefore(e,a)},Wi=(a,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,a==e)return!0}while(e&&e.previousElementSibling);return!1};function qi(){var a=this;if(a.settings.mode!=="multi")return;var e=a.lock,t=a.unlock;let n=!0,i;a.hook("after","setupTemplates",()=>{var o=a.settings.render.item;a.settings.render.item=(l,y)=>{const b=Ue(o.call(a,l,y));Xe(b,{draggable:"true"});const k=j=>{n||$e(j),j.stopPropagation()},M=j=>{i=b,setTimeout(()=>{b.classList.add("ts-dragging")},0)},L=j=>{j.preventDefault(),b.classList.add("ts-drag-over"),B(b,i)},x=()=>{b.classList.remove("ts-drag-over")},B=(j,A)=>{A!==void 0&&(Wi(A,b)?zi(j,A):Gi(j,A))},O=()=>{var j;document.querySelectorAll(".ts-drag-over").forEach(V=>V.classList.remove("ts-drag-over")),(j=i)==null||j.classList.remove("ts-dragging"),i=void 0;var A=[];a.control.querySelectorAll("[data-value]").forEach(V=>{if(V.dataset.value){let X=V.dataset.value;X&&A.push(X)}}),a.setValue(A)};return Le(b,"mousedown",k),Le(b,"dragstart",M),Le(b,"dragenter",L),Le(b,"dragover",L),Le(b,"dragleave",x),Le(b,"dragend",O),b}}),a.hook("instead","lock",()=>(n=!1,e.call(a))),a.hook("instead","unlock",()=>(n=!0,t.call(a)))}function Ki(a){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},a);e.on("initialize",()=>{var n=Ue(t.html(t)),i=n.querySelector("."+t.closeClass);i&&i.addEventListener("click",o=>{$e(o,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function Yi(){var a=this;a.hook("instead","setCaret",e=>{a.settings.mode==="single"||!a.control.contains(a.control_input)?e=a.items.length:(e=Math.max(0,Math.min(a.items.length,e)),e!=a.caretPos&&!a.isPending&&a.controlChildren().forEach((t,n)=>{n<e?a.control_input.insertAdjacentElement("beforebegin",t):a.control.appendChild(t)})),a.caretPos=e}),a.hook("instead","moveCaret",e=>{if(!a.isFocused)return;const t=a.getLastActive(e);if(t){const n=on(t);a.setCaret(e>0?n+1:n),a.setActiveItem(),pt(t,"last-active")}else a.setCaret(a.caretPos+e)})}function Zi(){const a=this;a.settings.shouldOpen=!0,a.hook("before","setup",()=>{a.focus_node=a.control,Je(a.control_input,"dropdown-input");const e=Ue('<div class="dropdown-input-wrap">');e.append(a.control_input),a.dropdown.insertBefore(e,a.dropdown.firstChild);const t=Ue('<input class="items-placeholder" tabindex="-1" />');t.placeholder=a.settings.placeholder||"",a.control.append(t)}),a.on("initialize",()=>{a.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case ea:a.isOpen&&($e(t,!0),a.close()),a.clearActiveItems();return;case Bn:a.focus_node.tabIndex=-1;break}return a.onKeyDown.call(a,t)}),a.on("blur",()=>{a.focus_node.tabIndex=a.isDisabled?-1:a.tabIndex}),a.on("dropdown_open",()=>{a.control_input.focus()});const e=a.onBlur;a.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==a.control_input))return e.call(a)}),Le(a.control_input,"blur",()=>a.onBlur()),a.hook("before","close",()=>{a.isOpen&&a.focus_node.focus({preventScroll:!0})})})}function Ji(){var a=this;a.on("initialize",()=>{var e=document.createElement("span"),t=a.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",a.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of n)e.style[o]=t.style[o];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),a.on("update item_add item_remove",i),Le(t,"input",i),Le(t,"keyup",i),Le(t,"blur",i),Le(t,"update",i)})}function Qi(){var a=this,e=a.deleteSelection;this.hook("instead","deleteSelection",t=>a.activeItems.length?e.call(a,t):!1)}function eo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function to(){var a=this,e=a.onKeyDown;a.hook("instead","onKeyDown",t=>{var n,i,o,l;if(!a.isOpen||!(t.keyCode===xn||t.keyCode===ta))return e.call(a,t);a.ignoreHover=!0,l=Kt(a.activeOption,"[data-group]"),n=on(a.activeOption,"[data-selectable]"),l&&(t.keyCode===xn?l=l.previousSibling:l=l.nextSibling,l&&(o=l.querySelectorAll("[data-selectable]"),i=o[Math.min(o.length-1,n)],i&&a.setActiveOption(i)))})}function no(a){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},a);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Zt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(o,l)=>{var y=Ue(i.call(t,o,l)),b=Ue(n);return y.appendChild(b),Le(b,"mousedown",k=>{$e(k,!0)}),Le(b,"click",k=>{t.isLocked||($e(k,!0),!t.isLocked&&t.shouldDelete([y],k)&&(t.removeItem(y),t.refreshOptions(!1),t.inputState()))}),y}})}}function ro(a){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},a);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[n];i&&e.setTextboxValue(t.text.call(e,i))}})}function ao(){const a=this,e=a.canLoad,t=a.clearActiveOption,n=a.loadCallback;var i={},o,l=!1,y,b=[];if(a.settings.shouldLoadMore||(a.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(a.activeOption){var x=a.selectable(),B=Array.from(x).indexOf(a.activeOption);if(B>=x.length-2)return!0}return!1}),!a.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";a.settings.sortField=[{field:"$order"},{field:"$score"}];const k=L=>typeof a.settings.maxOptions=="number"&&o.children.length>=a.settings.maxOptions?!1:!!(L in i&&i[L]),M=(L,x)=>a.items.indexOf(x)>=0||b.indexOf(x)>=0;a.setNextUrl=(L,x)=>{i[L]=x},a.getUrl=L=>{if(L in i){const x=i[L];return i[L]=!1,x}return a.clearPagination(),a.settings.firstUrl.call(a,L)},a.clearPagination=()=>{i={}},a.hook("instead","clearActiveOption",()=>{if(!l)return t.call(a)}),a.hook("instead","canLoad",L=>L in i?k(L):e.call(a,L)),a.hook("instead","loadCallback",(L,x)=>{if(!l)a.clearOptions(M);else if(y){const B=L[0];B!==void 0&&(y.dataset.value=B[a.settings.valueField])}n.call(a,L,x),l=!1}),a.hook("after","refreshOptions",()=>{const L=a.lastValue;var x;k(L)?(x=a.render("loading_more",{query:L}),x&&(x.setAttribute("data-selectable",""),y=x)):L in i&&!o.querySelector(".no-results")&&(x=a.render("no_more_results",{query:L})),x&&(Je(x,a.settings.optionClass),o.append(x))}),a.on("initialize",()=>{b=Object.keys(a.options),o=a.dropdown_content,a.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},a.settings.render),o.addEventListener("scroll",()=>{a.settings.shouldLoadMore.call(a)&&k(a.lastValue)&&(l||(l=!0,a.load.call(a,a.lastValue)))})})}et.define("change_listener",Vi);et.define("checkbox_options",Hi);et.define("clear_button",Ui);et.define("drag_drop",qi);et.define("dropdown_header",Ki);et.define("caret_position",Yi);et.define("dropdown_input",Zi);et.define("input_autogrow",Ji);et.define("no_backspace_delete",Qi);et.define("no_active_items",eo);et.define("optgroup_columns",to);et.define("remove_button",no);et.define("restore_on_backspace",ro);et.define("virtual_scroll",ao);class io{debouncedLocalChanges;debouncedBroadcastChanges;constructor(){this.debouncedBroadcastChanges=Er(async e=>{if(!e.data||e.data.length===0)return;const t=e.data,n=I.playerRole==="GM"?t:t.filter(y=>y.metadata[`${h.SPECTREID}/viewers`].includes(I.playerId)),o=I.localGhosts.filter(y=>y.metadata[`${h.SPECTREID}/spectred`]===!0).filter(y=>y.metadata[`${h.SPECTREID}/viewers`].includes(I.playerId));if(!_n(n,o)){const y=n.map(M=>M.id),b=[],k=I.localGhosts.filter(M=>!y.includes(M.id));for(const M of n){const L=I.localGhosts.find(x=>x.id===M.id);L&&Wa(M,L)||b.push(M)}b.length>0&&await C.scene.local.addItems(b),k.length>0&&await C.scene.local.deleteItems(k.map(M=>M.id)),I.localGhosts=t}},0),this.debouncedLocalChanges=Er(async e=>{if(I.playerRole==="GM"){const t=e.filter(i=>i.metadata[`${h.SPECTREID}/spectred`]===!0);if(_n(I.localGhosts,t))return;I.localGhosts=t,br(t)?await C.notification.show("You currently have too many Spectres in the scene. Unable to update.","ERROR"):(await C.scene.setMetadata({[`${h.SPECTREID}/current_spectres`]:t}),await C.broadcast.sendMessage(h.SPECTREBROADCASTID,t));const n=document.querySelectorAll(".tSelects");for(const i of n){const o=i.id.replace("select-","");t.find(y=>y.id===o)||document.getElementById(`tr-${o}`)?.remove()}}else{const t=e.filter(l=>l.metadata[`${h.SPECTREID}/spectred`]===!0),i=I.localGhosts.filter(l=>l.metadata[`${h.SPECTREID}/spectred`]===!0).filter(l=>l.metadata[`${h.SPECTREID}/viewers`].includes(I.playerId));if(t.length<i.length){const l=[];for(const y of i)t.includes(y)||l.push(y.id);l.length>0&&await C.broadcast.sendMessage("SPECTREDELETED",l)}if(t.length===0&&i.length===0)return;if(t.length<i.length){I.localGhosts=t;return}_n(t,i)||(qa(I.localGhosts,t),await C.broadcast.sendMessage(h.SPECTREBROADCASTID,I.localGhosts))}},0)}SetupLocalSpecterHandlers(){I.sceneReady&&(C.broadcast.onMessage(h.SPECTREBROADCASTID,e=>{this.debouncedBroadcastChanges(e)}),I.playerRole==="GM"&&C.broadcast.onMessage("SPECTREDELETED",async e=>{const t=e.data;if(t.length>0){for(const n of t)document.getElementById(`tr-${n}`).remove();await C.scene.local.deleteItems(t)}}))}async LoadSpectreSceneMetadata(){I.localGhosts=I.sceneMetadata[`${h.SPECTREID}/current_spectres`],I.localGhosts||(I.localGhosts=[]);const e=[];for(const t of I.localGhosts)t.metadata[`${h.SPECTREID}/viewers`].includes(I.playerId)&&I.playerRole!=="GM"&&e.push(t);e.length>0&&await C.scene.local.addItems(e)}UpdateSpectreTargets(){const e=document.querySelectorAll(".tSelects");for(const t of e)if(t&&t.tomselect){const n=t.tomselect,i=[];for(const o of I.party)i.push({value:o.id,text:o.name});n.clearOptions(),n.addOption(i),i.length===0?(n.settings.placeholder="No Players Present",n.inputState()):(n.settings.placeholder="Choose..",n.inputState())}}async SetupSpectreGM(){await C.contextMenu.create({id:`${h.SPECTREID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${h.SPECTREID}/spectred`],value:void 0,operator:"==",coordinator:"&&"},{key:["metadata",`${h.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${h.SPECTREID}/spectred`],value:void 0,operator:"!=",coordinator:"&&"}]}}],async onClick(e){if(e.items.every(n=>n.metadata[`${h.SPECTREID}/spectred`]===void 0))if(br(I.localGhosts,e.items))await C.notification.show("This would exceed the maximum Spectres. Please remove some before adding more.","INFO");else for(const n of e.items){const i=n;lt.SetupTomSelect(i)}else for(const n of e.items){const i=n;await lt.RemoveGhost(i),i.metadata[`${h.SPECTREID}/spectred`]=void 0;const o=I.localGhosts.findIndex(l=>l.id===i.id);o!==-1&&(I.localGhosts.splice(o,1),document.getElementById(`tr-${i.id}`)?.remove(),i.metadata[`${h.SPECTREID}/viewers`]=[],await C.scene.items.addItems([i]))}}})}async RestoreGhostsGM(){I.localGhosts=I.sceneMetadata[`${h.SPECTREID}/current_spectres`],I.localGhosts||(I.localGhosts=[]),I.localGhosts.length>0&&(await C.scene.local.addItems(I.localGhosts),I.localGhosts.forEach(t=>{this.SetupTomSelect(t)})),I.sceneMetadata[`${h.SPECTREID}/stored`]?.length>0&&(await C.scene.local.addItems(I.localGhosts),I.localGhosts.forEach(t=>{this.SetupTomSelect(t)}))}async StoreGhost(e){let t=I.sceneMetadata[`${h.SPECTREID}/current_spectres`];if(!t)t=[e];else{if(t.find(i=>i.id===e.id))return;t.push(e)}await C.scene.setMetadata({[`${h.SPECTREID}/current_spectres`]:t})}async RemoveGhost(e){let t=I.sceneMetadata[`${h.SPECTREID}/current_spectres`];t||(t=[]);const n=t.filter(i=>i.id!==e.id);await C.scene.local.deleteItems([e.id]),await C.scene.setMetadata({[`${h.SPECTREID}/current_spectres`]:n})}async SetupTomSelect(e){const t=e.text?.plainText||e.name;let n=e.metadata[`${h.SPECTREID}/viewers`];e.metadata[`${h.SPECTREID}/spectred`]=!0,n===void 0&&(n=[],e.metadata[`${h.SPECTREID}/viewers`]=[]),await C.scene.items.deleteItems([e.id]),await C.scene.local.addItems([e]),await this.StoreGhost(e),I.localGhosts.push(e);const i=document.getElementById("ghostList"),o=document.createElement("tr");o.id=`tr-${e.id}`,o.className="ghost-table-entry",o.innerHTML=`<td class="token-name">${t}</td>
            <td><select id="select-${e.id}" class="tSelects" multiple autocomplete="off" /></td>
            <td><input type="button" class="mysteryButton" id="deleteGhost-${e.id}" value="Delete"/></td>`,i.appendChild(o);const l=document.getElementById(`select-${e.id}`);for(const M of I.party){const L=document.createElement("option");L.value=M.id,L.text=M.name,l.appendChild(L)}const y={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:I.party.length==0?"No Players Present":"Choose..",maxItems:null,create:!1,onDelete:async function(M,L){const x=L.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await C.scene.local.updateItems([x],B=>{const O=B[0].metadata[`${h.SPECTREID}/viewers`],j=O.findIndex(A=>A==M);O.splice(j,1),B[0].metadata[`${h.SPECTREID}/viewers`]=O})},onItemAdd:async function(M,L){const x=L.parentElement.parentElement.parentElement.parentElement.id.slice(3);await C.scene.local.updateItems([x],B=>{const O=B[0].metadata[`${h.SPECTREID}/viewers`];O?(O.push(M),B[0].metadata[`${h.SPECTREID}/viewers`]=O):B[0].metadata[`${h.SPECTREID}/viewers`]=[M]})}},b=new et(`#select-${e.id}`,y);if(n.length>0)for(const M of n){if(!I.party.find(x=>x.id===M)){const x=I.sceneMetadata[`${h.EXTENSIONID}/USER-${M}`],B=[];B.push({value:M,text:x.name}),b.addOption(B)}b.addItem(M,!0)}const k=document.getElementById(`deleteGhost-${e.id}`);k.onclick=async()=>{const M=I.localGhosts.findIndex(L=>L.id===e.id);I.localGhosts.splice(M,1),o.remove(),await C.scene.local.updateItems([e.id],L=>{L[0]&&(L[0].metadata[`${h.SPECTREID}/viewers`]=[])}),await this.RemoveGhost(e)}}ClearGhostList(){const e=document.getElementById("ghostList");e&&(e.innerHTML="")}}const lt=new io;async function Xn(){await C.scene.items.deleteItems(I.sceneItems.filter(Pt).map(e=>e.id)),tn(I.sceneMetadata[`${h.EXTENSIONID}/fowEnabled`]==!0);let a;if(I.sceneItems.filter(ga).length==0){const e=I.sceneItems.filter(n=>n.layer=="MAP"&&Qt(n)),t=e.map(n=>n.image.width*n.image.height/Math.pow(n.grid.dpi,2));a=e[t.indexOf(Math.max(...t))]}if(I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]===void 0&&(I.playerRole==="GM"&&(te.autodetectCheckbox.checked=!0),await C.scene.setMetadata({[`${h.EXTENSIONID}/autodetectEnabled`]:!0})),I.sceneMetadata[`${h.EXTENSIONID}/sceneId`]===void 0)await C.scene.setMetadata({[`${h.EXTENSIONID}/sceneId`]:crypto.randomUUID()});else try{const e=I.sceneMetadata[`${h.EXTENSIONID}/sceneId`],t=localStorage.getItem(`${h.EXTENSIONID}/fogCache/${I.playerId}/${e}`);if(t!==null&&I.sceneMetadata[`${h.EXTENSIONID}/persistenceEnabled`]===!0){const n=JSON.parse(t),i=[];for(let o=0;o<n.length;o++){const l=mt().commands(n[o].commands).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${h.EXTENSIONID}/isVisionFog`]:!0,[`${h.EXTENSIONID}/digest`]:n[o].digest}).build();l.zIndex=3,i.push(l)}await C.scene.local.addItems(i)}}catch{}I.playerRole==="GM"?(await lt.RestoreGhostsGM(),await te.UpdateUI(),te.mapSubmit.onclick=async()=>{await C.scene.items.updateItems([h.GRIDID],e=>{for(const t of e){const n=t;n.width=I.gridDpi*+te.mapWidth.value,n.height=I.gridDpi*+te.mapHeight.value,n.scale={x:1,y:1}}})},a!==void 0&&await C.scene.items.updateItems([a],e=>{e[0].metadata[`${h.EXTENSIONID}/isBackgroundImage`]=!0})):await lt.LoadSpectreSceneMetadata(),I.snap=!0,I.sceneInitialized=!0}var na={exports:{}};const oo={},so=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"})),On=Va(so);(function(a,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(i){i=i||{};var o;o||(o=typeof i<"u"?i:{});var l=Object.assign,y,b;o.ready=new Promise(function(m,p){y=m,b=p}),function(m){var p={};m.loadCmdsTypedArray=function(Q){for(var ae=0,ue=0;ue<Q.length;ue++)ae+=Q[ue].length;if(p[ae])var ce=p[ae];else ce=new Float32Array(ae),p[ae]=ce;var ge=0;for(ue=0;ue<Q.length;ue++)for(var Pe=0;Pe<Q[ue].length;Pe++){var Re=Q[ue][Pe];typeof Re=="string"&&(Re=m.SkBits2FloatUnsigned(parseInt(Re))),ce[ge]=Re,ge++}return Q=m._malloc(ce.length*ce.BYTES_PER_ELEMENT),m.HEAPF32.set(ce,Q/ce.BYTES_PER_ELEMENT),[Q,ae]},m.FromCmds=function(Q){Q=m.loadCmdsTypedArray(Q);var ae=m._FromCmds(Q[0],Q[1]);return m._free(Q[0]),ae};var E,T,R,z,re;m.cubicYFromX=function(Q,ae,ue,ce,ge){return E&&T===Q&&R===ae&&z===ue&&re===ce||(E&&E.delete(),E=new m._SkCubicMap([Q,ae],[ue,ce]),T=Q,R=ae,z=ue,re=ce),E.computeYFromX(ge)},m.cubicPtFromT=function(Q,ae,ue,ce,ge){return E&&T===Q&&R===ae&&z===ue&&re===ce||(E&&E.delete(),E=new m._SkCubicMap([Q,ae],[ue,ce]),T=Q,R=ae,z=ue,re=ce),E.computePtFromT(ge)}}(o),function(m){m.onRuntimeInitialized=function(){m.SkPath.prototype.addPath=function(){var p=arguments[0];if(arguments.length===1)this._addPath(p,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var E=arguments[1];this._addPath(p,E.a,E.c,E.e,E.b,E.d,E.f,0,0,1)}else if(arguments.length===7)E=arguments,this._addPath(p,E[1],E[3],E[5],E[2],E[4],E[6],0,0,1);else if(arguments.length===10)E=arguments,this._addPath(p,E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},m.SkPath.prototype.arc=function(p,E,T,R,z,re){return this._arc(p,E,T,R,z,!!re),this},m.SkPath.prototype.arcTo=function(p,E,T,R,z){return this._arcTo(p,E,T,R,z),this},m.SkPath.prototype.bezierCurveTo=function(p,E,T,R,z,re){return this._cubicTo(p,E,T,R,z,re),this},m.SkPath.prototype.close=function(){return this._close(),this},m.SkPath.prototype.closePath=function(){return this._close(),this},m.SkPath.prototype.conicTo=function(p,E,T,R,z){return this._conicTo(p,E,T,R,z),this},m.SkPath.prototype.cubicTo=function(p,E,T,R,z,re){return this._cubicTo(p,E,T,R,z,re),this},m.SkPath.prototype.dash=function(p,E,T){return this._dash(p,E,T)?this:null},m.SkPath.prototype.ellipse=function(p,E,T,R,z,re,Q,ae){return this._ellipse(p,E,T,R,z,re,Q,!!ae),this},m.SkPath.prototype.lineTo=function(p,E){return this._lineTo(p,E),this},m.SkPath.prototype.moveTo=function(p,E){return this._moveTo(p,E),this},m.SkPath.prototype.op=function(p,E){return this._op(p,E)?this:null},m.SkPath.prototype.quadraticCurveTo=function(p,E,T,R){return this._quadTo(p,E,T,R),this},m.SkPath.prototype.quadTo=function(p,E,T,R){return this._quadTo(p,E,T,R),this},m.SkPath.prototype.rect=function(p,E,T,R){return this._rect(p,E,T,R),this},m.SkPath.prototype.simplify=function(){return this._simplify()?this:null},m.SkPath.prototype.stroke=function(p){return p=p||{},p.width=p.width||1,p.miter_limit=p.miter_limit||4,p.cap=p.cap||m.StrokeCap.BUTT,p.join=p.join||m.StrokeJoin.MITER,this._stroke(p)?this:null},m.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var p=arguments;this._transform(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},m.SkPath.prototype.trim=function(p,E,T){return this._trim(p,E,!!T)?this:null}}}(o);var k=l({},o),M=typeof window=="object",L=typeof importScripts=="function",x="",B,O,j,A,V,X;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(x=L?On.dirname(x)+"/":__dirname+"/",X=()=>{V||(A=On,V=On)},B=function(m,p){return X(),m=V.normalize(m),A.readFileSync(m,p?null:"utf8")},j=m=>(m=B(m,!0),m.buffer||(m=new Uint8Array(m)),m),O=(m,p,E)=>{X(),m=V.normalize(m),A.readFile(m,function(T,R){T?E(T):p(R.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(m){throw m}),process.on("unhandledRejection",function(m){throw m}),o.inspect=function(){return"[Emscripten Module object]"}):(M||L)&&(L?x=self.location.href:typeof document<"u"&&document.currentScript&&(x=document.currentScript.src),n&&(x=n),x.indexOf("blob:")!==0?x=x.substr(0,x.replace(/[?#].*/,"").lastIndexOf("/")+1):x="",B=m=>{var p=new XMLHttpRequest;return p.open("GET",m,!1),p.send(null),p.responseText},L&&(j=m=>{var p=new XMLHttpRequest;return p.open("GET",m,!1),p.responseType="arraybuffer",p.send(null),new Uint8Array(p.response)}),O=(m,p,E)=>{var T=new XMLHttpRequest;T.open("GET",m,!0),T.responseType="arraybuffer",T.onload=()=>{T.status==200||T.status==0&&T.response?p(T.response):E()},T.onerror=E,T.send(null)});var W=o.print||console.log.bind(console),r=o.printErr||console.warn.bind(console);l(o,k),k=null;var f;o.wasmBinary&&(f=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&ye("no native wasm support detected");var s,d=!1,c=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function g(m,p,E){var T=p+E;for(E=p;m[E]&&!(E>=T);)++E;if(16<E-p&&m.subarray&&c)return c.decode(m.subarray(p,E));for(T="";p<E;){var R=m[p++];if(R&128){var z=m[p++]&63;if((R&224)==192)T+=String.fromCharCode((R&31)<<6|z);else{var re=m[p++]&63;R=(R&240)==224?(R&15)<<12|z<<6|re:(R&7)<<18|z<<12|re<<6|m[p++]&63,65536>R?T+=String.fromCharCode(R):(R-=65536,T+=String.fromCharCode(55296|R>>10,56320|R&1023))}}else T+=String.fromCharCode(R)}return T}function u(m,p,E){var T=oe;if(0<E){E=p+E-1;for(var R=0;R<m.length;++R){var z=m.charCodeAt(R);if(55296<=z&&57343>=z){var re=m.charCodeAt(++R);z=65536+((z&1023)<<10)|re&1023}if(127>=z){if(p>=E)break;T[p++]=z}else{if(2047>=z){if(p+1>=E)break;T[p++]=192|z>>6}else{if(65535>=z){if(p+2>=E)break;T[p++]=224|z>>12}else{if(p+3>=E)break;T[p++]=240|z>>18,T[p++]=128|z>>12&63}T[p++]=128|z>>6&63}T[p++]=128|z&63}}T[p]=0}}var v=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function D(m,p){for(var E=m>>1,T=E+p/2;!(E>=T)&&fe[E];)++E;if(E<<=1,32<E-m&&v)return v.decode(oe.subarray(m,E));for(E="",T=0;!(T>=p/2);++T){var R=Z[m+2*T>>1];if(R==0)break;E+=String.fromCharCode(R)}return E}function P(m,p,E){if(E===void 0&&(E=2147483647),2>E)return 0;E-=2;var T=p;E=E<2*m.length?E/2:m.length;for(var R=0;R<E;++R)Z[p>>1]=m.charCodeAt(R),p+=2;return Z[p>>1]=0,p-T}function F(m){return 2*m.length}function H(m,p){for(var E=0,T="";!(E>=p/4);){var R=le[m+4*E>>2];if(R==0)break;++E,65536<=R?(R-=65536,T+=String.fromCharCode(55296|R>>10,56320|R&1023)):T+=String.fromCharCode(R)}return T}function _(m,p,E){if(E===void 0&&(E=2147483647),4>E)return 0;var T=p;E=T+E-4;for(var R=0;R<m.length;++R){var z=m.charCodeAt(R);if(55296<=z&&57343>=z){var re=m.charCodeAt(++R);z=65536+((z&1023)<<10)|re&1023}if(le[p>>2]=z,p+=4,p+4>E)break}return le[p>>2]=0,p-T}function U(m){for(var p=0,E=0;E<m.length;++E){var T=m.charCodeAt(E);55296<=T&&57343>=T&&++E,p+=4}return p}var ne,ie,oe,Z,fe,le,be,he,pe;function me(){var m=s.buffer;ne=m,o.HEAP8=ie=new Int8Array(m),o.HEAP16=Z=new Int16Array(m),o.HEAP32=le=new Int32Array(m),o.HEAPU8=oe=new Uint8Array(m),o.HEAPU16=fe=new Uint16Array(m),o.HEAPU32=be=new Uint32Array(m),o.HEAPF32=he=new Float32Array(m),o.HEAPF64=pe=new Float64Array(m)}var Y,w=[],S=[],$=[];function K(){var m=o.preRun.shift();w.unshift(m)}var J=0,q=null;o.preloadedImages={},o.preloadedAudios={};function ye(m){throw o.onAbort&&o.onAbort(m),m="Aborted("+m+")",r(m),d=!0,m=new WebAssembly.RuntimeError(m+". Build with -s ASSERTIONS=1 for more info."),b(m),m}function Oe(){return ke.startsWith("data:application/octet-stream;base64,")}var ke;if(ke="pathkit.wasm",!Oe()){var Be=ke;ke=o.locateFile?o.locateFile(Be,x):x+Be}function je(){var m=ke;try{if(m==ke&&f)return new Uint8Array(f);if(j)return j(m);throw"both async and sync fetching of the wasm failed"}catch(p){ye(p)}}function Fe(){if(!f&&(M||L)){if(typeof fetch=="function"&&!ke.startsWith("file://"))return fetch(ke,{credentials:"same-origin"}).then(function(m){if(!m.ok)throw"failed to load wasm binary file at '"+ke+"'";return m.arrayBuffer()}).catch(function(){return je()});if(O)return new Promise(function(m,p){O(ke,function(E){m(new Uint8Array(E))},p)})}return Promise.resolve().then(function(){return je()})}function Ce(m){for(;0<m.length;){var p=m.shift();if(typeof p=="function")p(o);else{var E=p.Wa;typeof E=="number"?p.xa===void 0?Y.get(E)():Y.get(E)(p.xa):E(p.xa===void 0?null:p.xa)}}}var _e={};function Te(m){for(;m.length;){var p=m.pop();m.pop()(p)}}function qe(m){return this.fromWireType(be[m>>2])}var st={},se={},N={};function G(m){if(m===void 0)return"_unknown";m=m.replace(/[^a-zA-Z0-9_]/g,"$");var p=m.charCodeAt(0);return 48<=p&&57>=p?"_"+m:m}function ee(m,p){return m=G(m),function(){return p.apply(this,arguments)}}function de(m){var p=Error,E=ee(m,function(T){this.name=m,this.message=T,T=Error(T).stack,T!==void 0&&(this.stack=this.toString()+`
`+T.replace(/^Error(:[^\n]*)?\n/,""))});return E.prototype=Object.create(p.prototype),E.prototype.constructor=E,E.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},E}var we=void 0;function ve(m){throw new we(m)}function Ee(m,p,E){function T(Q){Q=E(Q),Q.length!==m.length&&ve("Mismatched type converter count");for(var ae=0;ae<m.length;++ae)ct(m[ae],Q[ae])}m.forEach(function(Q){N[Q]=p});var R=Array(p.length),z=[],re=0;p.forEach(function(Q,ae){se.hasOwnProperty(Q)?R[ae]=se[Q]:(z.push(Q),st.hasOwnProperty(Q)||(st[Q]=[]),st[Q].push(function(){R[ae]=se[Q],++re,re===z.length&&T(R)}))}),z.length===0&&T(R)}var De={};function Ie(m){switch(m){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+m)}}var Ve=void 0;function Me(m){for(var p="";oe[m];)p+=Ve[oe[m++]];return p}var He=void 0;function Ne(m){throw new He(m)}function ct(m,p,E={}){if(!("argPackAdvance"in p))throw new TypeError("registerType registeredInstance requires argPackAdvance");var T=p.name;if(m||Ne('type "'+T+'" must have a positive integer typeid pointer'),se.hasOwnProperty(m)){if(E.Qa)return;Ne("Cannot register type '"+T+"' twice")}se[m]=p,delete N[m],st.hasOwnProperty(m)&&(p=st[m],delete st[m],p.forEach(function(R){R()}))}function dn(m){Ne(m.ea.ha.fa.name+" instance already deleted")}var un=!1;function er(){}function tr(m){--m.count.value,m.count.value===0&&(m.ka?m.ma.la(m.ka):m.ha.fa.la(m.ga))}function Nt(m){return typeof FinalizationGroup>"u"?(Nt=p=>p,m):(un=new FinalizationGroup(function(p){for(var E=p.next();!E.done;E=p.next())E=E.value,E.ga?tr(E):console.warn("object already deleted: "+E.ga)}),Nt=p=>(un.register(p,p.ea,p.ea),p),er=p=>{un.unregister(p.ea)},Nt(m))}var Ot=void 0,Ct=[];function cn(){for(;Ct.length;){var m=Ct.pop();m.ea.pa=!1,m.delete()}}function gt(){}var nr={};function rr(m,p,E){if(m[p].ia===void 0){var T=m[p];m[p]=function(){return m[p].ia.hasOwnProperty(arguments.length)||Ne("Function '"+E+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+m[p].ia+")!"),m[p].ia[arguments.length].apply(this,arguments)},m[p].ia=[],m[p].ia[T.ua]=T}}function ln(m,p,E){o.hasOwnProperty(m)?((E===void 0||o[m].ia!==void 0&&o[m].ia[E]!==void 0)&&Ne("Cannot register public name '"+m+"' twice"),rr(o,m,m),o.hasOwnProperty(E)&&Ne("Cannot register multiple overloads of a function with the same number of arguments ("+E+")!"),o[m].ia[E]=p):(o[m]=p,E!==void 0&&(o[m].Xa=E))}function Ia(m,p,E,T,R,z,re,Q){this.name=m,this.constructor=p,this.qa=E,this.la=T,this.na=R,this.Oa=z,this.ta=re,this.La=Q,this.Ta=[]}function fn(m,p,E){for(;p!==E;)p.ta||Ne("Expected null or instance of "+E.name+", got an instance of "+p.name),m=p.ta(m),p=p.na;return m}function ka(m,p){return p===null?(this.Ba&&Ne("null is not a valid "+this.name),0):(p.ea||Ne('Cannot pass "'+yn(p)+'" as a '+this.name),p.ea.ga||Ne("Cannot pass deleted object as a pointer of type "+this.name),fn(p.ea.ga,p.ea.ha.fa,this.fa))}function Sa(m,p){if(p===null){if(this.Ba&&Ne("null is not a valid "+this.name),this.wa){var E=this.sa();return m!==null&&m.push(this.la,E),E}return 0}if(p.ea||Ne('Cannot pass "'+yn(p)+'" as a '+this.name),p.ea.ga||Ne("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&p.ea.ha.va&&Ne("Cannot convert argument of type "+(p.ea.ma?p.ea.ma.name:p.ea.ha.name)+" to parameter type "+this.name),E=fn(p.ea.ga,p.ea.ha.fa,this.fa),this.wa)switch(p.ea.ka===void 0&&Ne("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:p.ea.ma===this?E=p.ea.ka:Ne("Cannot convert argument of type "+(p.ea.ma?p.ea.ma.name:p.ea.ha.name)+" to parameter type "+this.name);break;case 1:E=p.ea.ka;break;case 2:if(p.ea.ma===this)E=p.ea.ka;else{var T=p.clone();E=this.Ua(E,yt(function(){T.delete()})),m!==null&&m.push(this.la,E)}break;default:Ne("Unsupporting sharing policy")}return E}function Ta(m,p){return p===null?(this.Ba&&Ne("null is not a valid "+this.name),0):(p.ea||Ne('Cannot pass "'+yn(p)+'" as a '+this.name),p.ea.ga||Ne("Cannot pass deleted object as a pointer of type "+this.name),p.ea.ha.va&&Ne("Cannot convert argument of type "+p.ea.ha.name+" to parameter type "+this.name),fn(p.ea.ga,p.ea.ha.fa,this.fa))}function ar(m,p,E){return p===E?m:E.na===void 0?null:(m=ar(m,p,E.na),m===null?null:E.La(m))}var Dt={};function Na(m,p){for(p===void 0&&Ne("ptr should not be undefined");m.na;)p=m.ta(p),m=m.na;return Dt[p]}function $t(m,p){return p.ha&&p.ga||ve("makeClassHandle requires ptr and ptrType"),!!p.ma!=!!p.ka&&ve("Both smartPtrType and smartPtr must be specified"),p.count={value:1},Nt(Object.create(m,{ea:{value:p}}))}function ft(m,p,E,T){this.name=m,this.fa=p,this.Ba=E,this.va=T,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,p.na!==void 0?this.toWireType=Sa:(this.toWireType=T?ka:Ta,this.ja=null)}function ir(m,p,E){o.hasOwnProperty(m)||ve("Replacing nonexistant public symbol"),o[m].ia!==void 0&&E!==void 0?o[m].ia[E]=p:(o[m]=p,o[m].ua=E)}function Oa(m,p){var E=[];return function(){E.length=arguments.length;for(var T=0;T<arguments.length;T++)E[T]=arguments[T];return m.includes("j")?(T=o["dynCall_"+m],T=E&&E.length?T.apply(null,[p].concat(E)):T.call(null,p)):T=Y.get(p).apply(null,E),T}}function Ke(m,p){m=Me(m);var E=m.includes("j")?Oa(m,p):Y.get(p);return typeof E!="function"&&Ne("unknown function pointer with signature "+m+": "+p),E}var or=void 0;function sr(m){m=hr(m);var p=Me(m);return ht(m),p}function Lt(m,p){function E(z){R[z]||se[z]||(N[z]?N[z].forEach(E):(T.push(z),R[z]=!0))}var T=[],R={};throw p.forEach(E),new or(m+": "+T.map(sr).join([", "]))}function hn(m,p){for(var E=[],T=0;T<m;T++)E.push(le[(p>>2)+T]);return E}function pn(m,p,E,T,R){var z=p.length;2>z&&Ne("argTypes array size mismatch! Must at least get return value and 'this' types!");var re=p[1]!==null&&E!==null,Q=!1;for(E=1;E<p.length;++E)if(p[E]!==null&&p[E].ja===void 0){Q=!0;break}var ae=p[0].name!=="void",ue=z-2,ce=Array(ue),ge=[],Pe=[];return function(){if(arguments.length!==ue&&Ne("function "+m+" called with "+arguments.length+" arguments, expected "+ue+" args!"),Pe.length=0,ge.length=re?2:1,ge[0]=R,re){var Re=p[1].toWireType(Pe,this);ge[1]=Re}for(var Ae=0;Ae<ue;++Ae)ce[Ae]=p[Ae+2].toWireType(Pe,arguments[Ae]),ge.push(ce[Ae]);if(Ae=T.apply(null,ge),Q)Te(Pe);else for(var Ye=re?1:2;Ye<p.length;Ye++){var Ze=Ye===1?Re:ce[Ye-2];p[Ye].ja!==null&&p[Ye].ja(Ze)}return Re=ae?p[0].fromWireType(Ae):void 0,Re}}var mn=[],dt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function dr(m){4<m&&--dt[m].Ca===0&&(dt[m]=void 0,mn.push(m))}function gn(m){return m||Ne("Cannot use deleted val. handle = "+m),dt[m].value}function yt(m){switch(m){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var p=mn.length?mn.pop():dt.length;return dt[p]={Ca:1,value:m},p}}function Ca(m,p,E){switch(p){case 0:return function(T){return this.fromWireType((E?ie:oe)[T])};case 1:return function(T){return this.fromWireType((E?Z:fe)[T>>1])};case 2:return function(T){return this.fromWireType((E?le:be)[T>>2])};default:throw new TypeError("Unknown integer type: "+m)}}function Rt(m,p){var E=se[m];return E===void 0&&Ne(p+" has unknown type "+sr(m)),E}function yn(m){if(m===null)return"null";var p=typeof m;return p==="object"||p==="array"||p==="function"?m.toString():""+m}function Da(m,p){switch(p){case 2:return function(E){return this.fromWireType(he[E>>2])};case 3:return function(E){return this.fromWireType(pe[E>>3])};default:throw new TypeError("Unknown float type: "+m)}}function Ma(m,p,E){switch(p){case 0:return E?function(T){return ie[T]}:function(T){return oe[T]};case 1:return E?function(T){return Z[T>>1]}:function(T){return fe[T>>1]};case 2:return E?function(T){return le[T>>2]}:function(T){return be[T>>2]};default:throw new TypeError("Unknown integer type: "+m)}}var Pa={};function vn(m){var p=Pa[m];return p===void 0?Me(m):p}var wn=[];function ur(){function m(p){p.$$$embind_global$$$=p;var E=typeof $$$embind_global$$$=="object"&&p.$$$embind_global$$$===p;return E||delete p.$$$embind_global$$$,E}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof qt=="object"&&m(qt)?$$$embind_global$$$=qt:typeof self=="object"&&m(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Aa(m){var p=wn.length;return wn.push(m),p}function $a(m,p){for(var E=Array(m),T=0;T<m;++T)E[T]=Rt(le[(p>>2)+T],"parameter "+T);return E}var cr=[];function La(m){var p=Array(m+1);return function(E,T,R){p[0]=E;for(var z=0;z<m;++z){var re=Rt(le[(T>>2)+z],"parameter "+z);p[z+1]=re.readValueFromPointer(R),R+=re.argPackAdvance}return E=new(E.bind.apply(E,p)),yt(E)}}var lr={},Ra=[null,[],[]];we=o.InternalError=de("InternalError");for(var fr=Array(256),xt=0;256>xt;++xt)fr[xt]=String.fromCharCode(xt);Ve=fr,He=o.BindingError=de("BindingError"),gt.prototype.isAliasOf=function(m){if(!(this instanceof gt&&m instanceof gt))return!1;var p=this.ea.ha.fa,E=this.ea.ga,T=m.ea.ha.fa;for(m=m.ea.ga;p.na;)E=p.ta(E),p=p.na;for(;T.na;)m=T.ta(m),T=T.na;return p===T&&E===m},gt.prototype.clone=function(){if(this.ea.ga||dn(this),this.ea.ra)return this.ea.count.value+=1,this;var m=Nt,p=Object,E=p.create,T=Object.getPrototypeOf(this),R=this.ea;return m=m(E.call(p,T,{ea:{value:{count:R.count,pa:R.pa,ra:R.ra,ga:R.ga,ha:R.ha,ka:R.ka,ma:R.ma}}})),m.ea.count.value+=1,m.ea.pa=!1,m},gt.prototype.delete=function(){this.ea.ga||dn(this),this.ea.pa&&!this.ea.ra&&Ne("Object already scheduled for deletion"),er(this),tr(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},gt.prototype.isDeleted=function(){return!this.ea.ga},gt.prototype.deleteLater=function(){return this.ea.ga||dn(this),this.ea.pa&&!this.ea.ra&&Ne("Object already scheduled for deletion"),Ct.push(this),Ct.length===1&&Ot&&Ot(cn),this.ea.pa=!0,this},ft.prototype.Pa=function(m){return this.Ia&&(m=this.Ia(m)),m},ft.prototype.Ga=function(m){this.la&&this.la(m)},ft.prototype.argPackAdvance=8,ft.prototype.readValueFromPointer=qe,ft.prototype.deleteObject=function(m){m!==null&&m.delete()},ft.prototype.fromWireType=function(m){function p(){return this.wa?$t(this.fa.qa,{ha:this.Sa,ga:E,ma:this,ka:m}):$t(this.fa.qa,{ha:this,ga:m})}var E=this.Pa(m);if(!E)return this.Ga(m),null;var T=Na(this.fa,E);if(T!==void 0)return T.ea.count.value===0?(T.ea.ga=E,T.ea.ka=m,T.clone()):(T=T.clone(),this.Ga(m),T);if(T=this.fa.Oa(E),T=nr[T],!T)return p.call(this);T=this.va?T.Ja:T.pointerType;var R=ar(E,this.fa,T.fa);return R===null?p.call(this):this.wa?$t(T.fa.qa,{ha:T,ga:R,ma:this,ka:m}):$t(T.fa.qa,{ha:T,ga:R})},o.getInheritedInstanceCount=function(){return Object.keys(Dt).length},o.getLiveInheritedInstances=function(){var m=[],p;for(p in Dt)Dt.hasOwnProperty(p)&&m.push(Dt[p]);return m},o.flushPendingDeletes=cn,o.setDelayFunction=function(m){Ot=m,Ct.length&&Ot&&Ot(cn)},or=o.UnboundTypeError=de("UnboundTypeError"),o.count_emval_handles=function(){for(var m=0,p=5;p<dt.length;++p)dt[p]!==void 0&&++m;return m},o.get_first_emval=function(){for(var m=5;m<dt.length;++m)if(dt[m]!==void 0)return dt[m];return null};var xa={r:function(m){var p=_e[m];delete _e[m];var E=p.elements,T=E.length,R=E.map(function(Q){return Q.Aa}).concat(E.map(function(Q){return Q.Ea})),z=p.sa,re=p.la;Ee([m],R,function(Q){return E.forEach(function(ae,ue){var ce=Q[ue],ge=ae.ya,Pe=ae.za,Re=Q[ue+T],Ae=ae.Da,Ye=ae.Fa;ae.read=Ze=>ce.fromWireType(ge(Pe,Ze)),ae.write=(Ze,wt)=>{var it=[];Ae(Ye,Ze,Re.toWireType(it,wt)),Te(it)}}),[{name:p.name,fromWireType:function(ae){for(var ue=Array(T),ce=0;ce<T;++ce)ue[ce]=E[ce].read(ae);return re(ae),ue},toWireType:function(ae,ue){if(T!==ue.length)throw new TypeError("Incorrect number of tuple elements for "+p.name+": expected="+T+", actual="+ue.length);for(var ce=z(),ge=0;ge<T;++ge)E[ge].write(ce,ue[ge]);return ae!==null&&ae.push(re,ce),ce},argPackAdvance:8,readValueFromPointer:qe,ja:re}]})},u:function(m){var p=De[m];delete De[m];var E=p.sa,T=p.la,R=p.Ha,z=R.map(function(re){return re.Aa}).concat(R.map(function(re){return re.Ea}));Ee([m],z,function(re){var Q={};return R.forEach(function(ae,ue){var ce=re[ue],ge=ae.ya,Pe=ae.za,Re=re[ue+R.length],Ae=ae.Da,Ye=ae.Fa;Q[ae.Na]={read:function(Ze){return ce.fromWireType(ge(Pe,Ze))},write:function(Ze,wt){var it=[];Ae(Ye,Ze,Re.toWireType(it,wt)),Te(it)}}}),[{name:p.name,fromWireType:function(ae){var ue={},ce;for(ce in Q)ue[ce]=Q[ce].read(ae);return T(ae),ue},toWireType:function(ae,ue){for(var ce in Q)if(!(ce in ue))throw new TypeError('Missing field:  "'+ce+'"');var ge=E();for(ce in Q)Q[ce].write(ge,ue[ce]);return ae!==null&&ae.push(T,ge),ge},argPackAdvance:8,readValueFromPointer:qe,ja:T}]})},z:function(){},F:function(m,p,E,T,R){var z=Ie(E);p=Me(p),ct(m,{name:p,fromWireType:function(re){return!!re},toWireType:function(re,Q){return Q?T:R},argPackAdvance:8,readValueFromPointer:function(re){if(E===1)var Q=ie;else if(E===2)Q=Z;else if(E===4)Q=le;else throw new TypeError("Unknown boolean type size: "+p);return this.fromWireType(Q[re>>z])},ja:null})},l:function(m,p,E,T,R,z,re,Q,ae,ue,ce,ge,Pe){ce=Me(ce),z=Ke(R,z),Q&&(Q=Ke(re,Q)),ue&&(ue=Ke(ae,ue)),Pe=Ke(ge,Pe);var Re=G(ce);ln(Re,function(){Lt("Cannot construct "+ce+" due to unbound types",[T])}),Ee([m,p,E],T?[T]:[],function(Ae){if(Ae=Ae[0],T)var Ye=Ae.fa,Ze=Ye.qa;else Ze=gt.prototype;Ae=ee(Re,function(){if(Object.getPrototypeOf(this)!==wt)throw new He("Use 'new' to construct "+ce);if(it.oa===void 0)throw new He(ce+" has no accessible constructor");var mr=it.oa[arguments.length];if(mr===void 0)throw new He("Tried to invoke ctor of "+ce+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(it.oa).toString()+") parameters instead!");return mr.apply(this,arguments)});var wt=Object.create(Ze,{constructor:{value:Ae}});Ae.prototype=wt;var it=new Ia(ce,Ae,wt,Pe,Ye,z,Q,ue);Ye=new ft(ce,it,!0,!1),Ze=new ft(ce+"*",it,!1,!1);var pr=new ft(ce+" const*",it,!1,!0);return nr[m]={pointerType:Ze,Ja:pr},ir(Re,Ae),[Ye,Ze,pr]})},i:function(m,p,E,T,R,z){0<p||ye(void 0);var re=hn(p,E);R=Ke(T,R),Ee([],[m],function(Q){Q=Q[0];var ae="constructor "+Q.name;if(Q.fa.oa===void 0&&(Q.fa.oa=[]),Q.fa.oa[p-1]!==void 0)throw new He("Cannot register multiple constructors with identical number of parameters ("+(p-1)+") for class '"+Q.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return Q.fa.oa[p-1]=()=>{Lt("Cannot construct "+Q.name+" due to unbound types",re)},Ee([],re,function(ue){return ue.splice(1,0,null),Q.fa.oa[p-1]=pn(ae,ue,null,R,z),[]}),[]})},a:function(m,p,E,T,R,z,re,Q){var ae=hn(E,T);p=Me(p),z=Ke(R,z),Ee([],[m],function(ue){function ce(){Lt("Cannot call "+ge+" due to unbound types",ae)}ue=ue[0];var ge=ue.name+"."+p;p.startsWith("@@")&&(p=Symbol[p.substring(2)]),Q&&ue.fa.Ta.push(p);var Pe=ue.fa.qa,Re=Pe[p];return Re===void 0||Re.ia===void 0&&Re.className!==ue.name&&Re.ua===E-2?(ce.ua=E-2,ce.className=ue.name,Pe[p]=ce):(rr(Pe,p,ge),Pe[p].ia[E-2]=ce),Ee([],ae,function(Ae){return Ae=pn(ge,Ae,ue,z,re),Pe[p].ia===void 0?(Ae.ua=E-2,Pe[p]=Ae):Pe[p].ia[E-2]=Ae,[]}),[]})},I:function(m,p,E){m=Me(m),Ee([],[p],function(T){return T=T[0],o[m]=T.fromWireType(E),[]})},E:function(m,p){p=Me(p),ct(m,{name:p,fromWireType:function(E){var T=gn(E);return dr(E),T},toWireType:function(E,T){return yt(T)},argPackAdvance:8,readValueFromPointer:qe,ja:null})},h:function(m,p,E,T){function R(){}E=Ie(E),p=Me(p),R.values={},ct(m,{name:p,constructor:R,fromWireType:function(z){return this.constructor.values[z]},toWireType:function(z,re){return re.value},argPackAdvance:8,readValueFromPointer:Ca(p,E,T),ja:null}),ln(p,R)},k:function(m,p,E){var T=Rt(m,"enum");p=Me(p),m=T.constructor,T=Object.create(T.constructor.prototype,{value:{value:E},constructor:{value:ee(T.name+"_"+p,function(){})}}),m.values[E]=T,m[p]=T},q:function(m,p,E){E=Ie(E),p=Me(p),ct(m,{name:p,fromWireType:function(T){return T},toWireType:function(T,R){return R},argPackAdvance:8,readValueFromPointer:Da(p,E),ja:null})},f:function(m,p,E,T,R,z){var re=hn(p,E);m=Me(m),R=Ke(T,R),ln(m,function(){Lt("Cannot call "+m+" due to unbound types",re)},p-1),Ee([],re,function(Q){return Q=[Q[0],null].concat(Q.slice(1)),ir(m,pn(m,Q,null,R,z),p-1),[]})},e:function(m,p,E,T,R){p=Me(p),R===-1&&(R=4294967295),R=Ie(E);var z=Q=>Q;if(T===0){var re=32-8*E;z=Q=>Q<<re>>>re}E=p.includes("unsigned")?function(Q,ae){return ae>>>0}:function(Q,ae){return ae},ct(m,{name:p,fromWireType:z,toWireType:E,argPackAdvance:8,readValueFromPointer:Ma(p,R,T!==0),ja:null})},b:function(m,p,E){function T(z){z>>=2;var re=be;return new R(ne,re[z+1],re[z])}var R=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][p];E=Me(E),ct(m,{name:E,fromWireType:T,argPackAdvance:8,readValueFromPointer:T},{Qa:!0})},p:function(m,p){p=Me(p);var E=p==="std::string";ct(m,{name:p,fromWireType:function(T){var R=be[T>>2];if(E)for(var z=T+4,re=0;re<=R;++re){var Q=T+4+re;if(re==R||oe[Q]==0){if(z=z?g(oe,z,Q-z):"",ae===void 0)var ae=z;else ae+=String.fromCharCode(0),ae+=z;z=Q+1}}else{for(ae=Array(R),re=0;re<R;++re)ae[re]=String.fromCharCode(oe[T+4+re]);ae=ae.join("")}return ht(T),ae},toWireType:function(T,R){R instanceof ArrayBuffer&&(R=new Uint8Array(R));var z=typeof R=="string";z||R instanceof Uint8Array||R instanceof Uint8ClampedArray||R instanceof Int8Array||Ne("Cannot pass non-string to std::string");var re=(E&&z?()=>{for(var ue=0,ce=0;ce<R.length;++ce){var ge=R.charCodeAt(ce);55296<=ge&&57343>=ge&&(ge=65536+((ge&1023)<<10)|R.charCodeAt(++ce)&1023),127>=ge?++ue:ue=2047>=ge?ue+2:65535>=ge?ue+3:ue+4}return ue}:()=>R.length)(),Q=En(4+re+1);if(be[Q>>2]=re,E&&z)u(R,Q+4,re+1);else if(z)for(z=0;z<re;++z){var ae=R.charCodeAt(z);255<ae&&(ht(Q),Ne("String has UTF-16 code units that do not fit in 8 bits")),oe[Q+4+z]=ae}else for(z=0;z<re;++z)oe[Q+4+z]=R[z];return T!==null&&T.push(ht,Q),Q},argPackAdvance:8,readValueFromPointer:qe,ja:function(T){ht(T)}})},m:function(m,p,E){if(E=Me(E),p===2)var T=D,R=P,z=F,re=()=>fe,Q=1;else p===4&&(T=H,R=_,z=U,re=()=>be,Q=2);ct(m,{name:E,fromWireType:function(ae){for(var ue=be[ae>>2],ce=re(),ge,Pe=ae+4,Re=0;Re<=ue;++Re){var Ae=ae+4+Re*p;(Re==ue||ce[Ae>>Q]==0)&&(Pe=T(Pe,Ae-Pe),ge===void 0?ge=Pe:(ge+=String.fromCharCode(0),ge+=Pe),Pe=Ae+p)}return ht(ae),ge},toWireType:function(ae,ue){typeof ue!="string"&&Ne("Cannot pass non-string to C++ string type "+E);var ce=z(ue),ge=En(4+ce+p);return be[ge>>2]=ce>>Q,R(ue,ge+4,ce+p),ae!==null&&ae.push(ht,ge),ge},argPackAdvance:8,readValueFromPointer:qe,ja:function(ae){ht(ae)}})},t:function(m,p,E,T,R,z){_e[m]={name:Me(p),sa:Ke(E,T),la:Ke(R,z),elements:[]}},s:function(m,p,E,T,R,z,re,Q,ae){_e[m].elements.push({Aa:p,ya:Ke(E,T),za:R,Ea:z,Da:Ke(re,Q),Fa:ae})},v:function(m,p,E,T,R,z){De[m]={name:Me(p),sa:Ke(E,T),la:Ke(R,z),Ha:[]}},j:function(m,p,E,T,R,z,re,Q,ae,ue){De[m].Ha.push({Na:Me(p),Aa:E,ya:Ke(T,R),za:z,Ea:re,Da:Ke(Q,ae),Fa:ue})},G:function(m,p){p=Me(p),ct(m,{Ra:!0,name:p,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(m,p,E,T){m=wn[m],p=gn(p),E=vn(E),m(p,E,null,T)},J:dr,x:function(m){return m===0?yt(ur()):(m=vn(m),yt(ur()[m]))},c:function(m,p){var E=$a(m,p),T=E[0];p=T.name+"_$"+E.slice(1).map(function(re){return re.name}).join("_")+"$";var R=cr[p];if(R!==void 0)return R;var z=Array(m-1);return R=Aa((re,Q,ae,ue)=>{for(var ce=0,ge=0;ge<m-1;++ge)z[ge]=E[ge+1].readValueFromPointer(ue+ce),ce+=E[ge+1].argPackAdvance;for(re=re[Q].apply(re,z),ge=0;ge<m-1;++ge)E[ge+1].Ka&&E[ge+1].Ka(z[ge]);if(!T.Ra)return T.toWireType(ae,re)}),cr[p]=R},n:function(m){4<m&&(dt[m].Ca+=1)},w:function(m,p,E,T){m=gn(m);var R=lr[p];return R||(R=La(p),lr[p]=R),R(m,E,T)},K:function(){return yt([])},D:function(m){return yt(vn(m))},H:function(m,p){return m=Rt(m,"_emval_take_value"),m=m.readValueFromPointer(p),yt(m)},g:function(){ye("")},B:function(m){var p=oe.length;if(m>>>=0,2147483648<m)return!1;for(var E=1;4>=E;E*=2){var T=p*(1+.2/E);T=Math.min(T,m+100663296),T=Math.max(m,T),0<T%65536&&(T+=65536-T%65536);e:{try{s.grow(Math.min(2147483648,T)-ne.byteLength+65535>>>16),me();var R=1;break e}catch{}R=void 0}if(R)return!0}return!1},C:function(){return 0},y:function(){},o:function(m,p,E,T){for(var R=0,z=0;z<E;z++){var re=le[p>>2],Q=le[p+4>>2];p+=8;for(var ae=0;ae<Q;ae++){var ue=oe[re+ae],ce=Ra[m];ue===0||ue===10?((m===1?W:r)(g(ce,0)),ce.length=0):ce.push(ue)}R+=Q}return le[T>>2]=R,0},A:function(){}};(function(){function m(R){o.asm=R.exports,s=o.asm.L,me(),Y=o.asm._,S.unshift(o.asm.M),J--,o.monitorRunDependencies&&o.monitorRunDependencies(J),J==0&&q&&(R=q,q=null,R())}function p(R){m(R.instance)}function E(R){return Fe().then(function(z){return WebAssembly.instantiate(z,T)}).then(function(z){return z}).then(R,function(z){r("failed to asynchronously prepare wasm: "+z),ye(z)})}var T={a:xa};if(J++,o.monitorRunDependencies&&o.monitorRunDependencies(J),o.instantiateWasm)try{return o.instantiateWasm(T,m)}catch(R){return r("Module.instantiateWasm callback failed with error: "+R),!1}return function(){return f||typeof WebAssembly.instantiateStreaming!="function"||Oe()||ke.startsWith("file://")||typeof fetch!="function"?E(p):fetch(ke,{credentials:"same-origin"}).then(function(R){return WebAssembly.instantiateStreaming(R,T).then(p,function(z){return r("wasm streaming compile failed: "+z),r("falling back to ArrayBuffer instantiation"),E(p)})})}().catch(b),{}})(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.M).apply(null,arguments)},o.__Z6ToCmdsRK6SkPath=function(){return(o.__Z6ToCmdsRK6SkPath=o.asm.N).apply(null,arguments)},o.__Z8FromCmdsmi=function(){return(o.__Z8FromCmdsmi=o.asm.O).apply(null,arguments)},o.__Z7NewPathv=function(){return(o.__Z7NewPathv=o.asm.P).apply(null,arguments)},o.__Z8CopyPathRK6SkPath=function(){return(o.__Z8CopyPathRK6SkPath=o.asm.Q).apply(null,arguments)},o.__Z6EqualsRK6SkPathS1_=function(){return(o.__Z6EqualsRK6SkPathS1_=o.asm.R).apply(null,arguments)},o.__Z11ToSVGStringRK6SkPath=function(){return(o.__Z11ToSVGStringRK6SkPath=o.asm.S).apply(null,arguments)},o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(o.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=o.asm.T).apply(null,arguments)},o.__Z13ApplySimplifyR6SkPath=function(){return(o.__Z13ApplySimplifyR6SkPath=o.asm.U).apply(null,arguments)},o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(o.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=o.asm.V).apply(null,arguments)},o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(o.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=o.asm.W).apply(null,arguments)},o.__Z14ResolveBuilderR11SkOpBuilder=function(){return(o.__Z14ResolveBuilderR11SkOpBuilder=o.asm.X).apply(null,arguments)},o.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(o.__Z8ToCanvasRK6SkPathN10emscripten3valE=o.asm.Y).apply(null,arguments)},o.__Z8ToPath2DRK6SkPath=function(){return(o.__Z8ToPath2DRK6SkPath=o.asm.Z).apply(null,arguments)};var ht=o._free=function(){return(ht=o._free=o.asm.$).apply(null,arguments)},En=o._malloc=function(){return(En=o._malloc=o.asm.aa).apply(null,arguments)},hr=o.___getTypeName=function(){return(hr=o.___getTypeName=o.asm.ba).apply(null,arguments)};o.___embind_register_native_and_builtin_types=function(){return(o.___embind_register_native_and_builtin_types=o.asm.ca).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.da).apply(null,arguments)};var Bt;q=function m(){Bt||bn(),Bt||(q=m)};function bn(){function m(){if(!Bt&&(Bt=!0,o.calledRun=!0,!d)){if(Ce(S),y(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var p=o.postRun.shift();$.unshift(p)}Ce($)}}if(!(0<J)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)K();Ce(w),0<J||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),m()},1)):m())}}if(o.run=bn,o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return bn(),i.ready}})();a.exports=t})(na);var uo=na.exports;const co=zn(uo),lo="/assets/pathkit-1356ccfa.wasm";class Cn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}class fo{activated;constructor(e){this.activated=e}async BlueTokenBoundingPath(e){if(this.activated){const t=mt().strokeColor("#0000ff").locked(!0).fillOpacity(1).commands(e.toCmds()).metadata({[`${h.EXTENSIONID}/debug`]:!0}).build();await C.scene.local.addItems([t])}}async RedIntersectionPath(e){if(this.activated){const t=mt().fillRule("evenodd").locked(!0).strokeColor("#ff0000").fillOpacity(0).commands(e.toCmds()).metadata({[`${h.EXTENSIONID}/debug`]:!0}).build();await C.scene.local.addItems([t])}}async GreenDebugPath(e){if(this.activated){const t=mt().commands(e.toCmds()).locked(!0).visible(e.visible).fillColor("#555500").fillOpacity(.3).strokeColor("#00FF00").layer("DRAWING").metadata({[`${h.EXTENSIONID}/debug`]:!0}).build();await C.scene.local.addItems([t])}}async DebugBlobINeverUse(){this.activated}}const jt=new fo(!1);function Vt(a,e){return(a.x-e.x)*(a.x-e.x)+(a.y-e.y)*(a.y-e.y)}function ra(a,e){return a.x==e.x&&a.y==e.y}function Ht(a,e,t){return t===void 0&&(t=.01),Math.abs(a-e)<=t}function Dn(a,e){return(a%e+e)%e}function ho(a,e){return We.pointInPolygon(a[0],e)||We.pointInPolygon(a[0],e)?!0:Ut(a,[e[0],e[1]])||Ut(a,[e[1],e[2]])||Ut(a,[e[2],e[3]])||Ut(a,[e[3],e[0]])}function Ut(a,e){const t=(a[1].x-a[0].x)*(e[1].y-e[0].y)-(e[1].x-e[0].x)*(a[1].y-a[0].y),n=((e[1].y-e[0].y)*(e[1].x-a[0].x)+(e[0].x-e[1].x)*(e[1].y-a[0].y))/t,i=((a[0].y-a[1].y)*(e[1].x-a[0].x)+(a[1].x-a[0].x)*(e[1].y-a[0].y))/t;return n>=0&&n<=1&&i>=0&&i<=1}function zt(a,e,t){return{x:a.x+e*Math.cos(t),y:a.y+e*Math.sin(t)}}function po(a,e,t,n){const i=Math.atan2(a.y-t.y,a.x-t.x);let o=zt(a,e,i+Math.PI/2),l=zt(a,e,i-Math.PI/2),y=zt(t,n,i+Math.PI/2),b=zt(t,n,i-Math.PI/2);const k=We.normalize(We.subtract(a,t));return o=We.add(o,We.multiply(k,e)),l=We.add(l,We.multiply(k,e)),y=We.add(y,We.multiply(k,0-n)),b=We.add(b,We.multiply(k,0-n)),[o,l,b,y]}function mo(a){return a.filter(e=>e.points&&e.points.length>1).flatMap(e=>{const t=ze.fromItem(e);return e.points.slice(0,-1).map((n,i)=>{const o=ze.fromPosition(e.points[i]),l=ze.fromPosition(e.points[i+1]),y=ze.decompose(ze.multiply(t,o)).position,b=ze.decompose(ze.multiply(t,l)).position;return{startPosition:y,endPosition:b,originalShape:e,oneSided:e.metadata[`${h.EXTENSIONID}/oneSided`]}})})}function go(a,e,t,n,i,o){const l=parseInt(I.sceneMetadata[`${h.EXTENSIONID}/defaultMELDepth`]??"0");let y=[],b=[t,n];const k=I.sceneMetadata[`${h.EXTENSIONID}/elevationMapping`]??[],M=[{x:(t+i[0])*o[0],y:i[1]*o[1]},{x:(t+i[0])*o[0],y:(n+i[1])*o[1]},{x:i[0]*o[0],y:(n+i[1])*o[1]},{x:i[0]*o[0],y:i[1]*o[1]}],L=I.gridDpi,x=h.EXTENSIONID,B=e.some(It);if(e.length===0)return y;for(const r of e){const f=I.playerId===r.createdUserId,d=I.sceneMetadata[`${h.EXTENSIONID}/USER-${r.createdUserId}`]?.role==="GM";let c;for(const P of k)wr(r.position,P.Points)&&(c===void 0||P.Depth>c)&&(c=P.Depth);if(c===void 0&&(c=l),!f&&I.playerRole!=="GM"&&!d)continue;const g=r.metadata[`${x}/visionRange`],u=I.playerShadowCache.getValue(r.id);if(y.push([]),u!==void 0&&ra(u.player.position,r.position)&&u.player.metadata[`${x}/visionRange`]===g)continue;let v=L*1e3;g&&(v=L*(g/I.gridScale+.5));const D=[];if(B&&!It(r)){for(const P of e)if(It(P)){const F=P.metadata[`${h.EXTENSIONID}/visionRange`];let H=1e3*I.gridDpi;F&&(H=I.gridDpi*(F/I.gridScale+.5));const _=po(r.position,v,P.position,H);D.push(_)}}for(const P of a){let F;for(const q of k)wr(P.startPosition,q.Points)&&(F===void 0||q.Depth>F)&&(F=q.Depth);if(F===void 0&&(F=l),c>=F&&F!==0&&c!==0)continue;const H=(r.position.x-P.startPosition.x)*(P.endPosition.y-P.startPosition.y)-(r.position.y-P.startPosition.y)*(P.endPosition.x-P.startPosition.x);if(P.oneSided!==void 0&&(P.oneSided==="right"&&H>0||P.oneSided==="left"&&H<0))continue;let _=P.startPosition.x,U=P.startPosition.y,ne=P.endPosition.x,ie=P.endPosition.y;(_<i[0]||U<i[1]||_>i[0]+b[0]||U>i[1]+b[1]||ne<i[0]||ie<i[1]||ne>i[0]+b[0]||ie>i[1]+b[1])&&(_=Math.max(i[0],Math.min(_,i[0]+b[0])),U=Math.max(i[1],Math.min(U,i[1]+b[1])),P.startPosition=Lr(P,i,b).startPosition,P.endPosition=Lr(P,i,b).endPosition);const oe=[P.startPosition,P.endPosition],Z=We.distance(P.startPosition,P.endPosition),le=Math.floor(Z/(v/3));for(let q=1;q<le;q++)oe.push(We.lerp(P.startPosition,P.endPosition,q/le));let be=!0;for(const q of oe)if(We.compare(r.position,q,v*1.05)){be=!1;break}if(be&&B&&!It(r)){for(const q of D)if(ho([P.startPosition,P.endPosition],q)){be=!1;break}}if(be)continue;const he={x:P.startPosition.x-r.position.x,y:P.startPosition.y-r.position.y},pe={x:P.endPosition.x-r.position.x,y:P.endPosition.y-r.position.y};var O={x:0,y:0},j={x:0,y:0},A=0,V=0,X=0,W=0;he.x<0?A=i[0]*o[0]:A=(t+i[0])*o[0],he.y<0?V=i[1]*o[1]:V=(n+i[1])*o[1],pe.x<0?X=i[0]*o[0]:X=(t+i[0])*o[0],pe.y<0?W=i[1]*o[1]:W=(n+i[1])*o[1];const me=[],Y=[];if(he.x!=0){const q=he.y/he.x,ye=P.startPosition.y-q*P.startPosition.x;me.push({x:A,y:q*A+ye})}if(he.y!=0){const q=he.x/he.y,ye=q*P.startPosition.y-P.startPosition.x;me.push({x:q*V-ye,y:V})}if(pe.x!=0){const q=pe.y/pe.x,ye=P.endPosition.y-q*P.endPosition.x;Y.push({x:X,y:q*X+ye})}if(pe.y!=0){const q=pe.x/pe.y,ye=q*P.endPosition.y-P.endPosition.x;Y.push({x:q*W-ye,y:W})}if(me.length===0||Y.length===0)continue;me.length==1||Vt(me[0],P.startPosition)<Vt(me[1],P.startPosition)?O=me[0]:O=me[1],Y.length==1||Vt(Y[0],P.endPosition)<Vt(Y[1],P.endPosition)?j=Y[0]:j=Y[1];const w=[{x:P.startPosition.x,y:P.startPosition.y},O,j,{x:P.endPosition.x,y:P.endPosition.y}],S=[0,0];let $=0;for(const q of[O,j])Ht(q.y,i[1]*o[1])?S[$]=0:Ht(q.y,(n+i[1])*o[1])?S[$]=2:Ht(q.x,i[0]*o[0])?S[$]=3:Ht(q.x,(t+i[0])*o[0])&&(S[$]=1),$++;let K=Math.sign(H);K=K==0?1:-K;const J=K==1?S[1]:Dn(S[1]-1,4);for(let q=S[0]+(K==1?0:-1);Dn(q,4)!=J;q+=K)w.splice(w.length-2,0,M[Dn(q,4)]);y[y.length-1].push({pointset:w,fromShape:P.originalShape})}}return y}function Lr(a,e,t){let{x:n,y:i}=a.startPosition,{x:o,y:l}=a.endPosition,y=(l-i)/(o-n),b=i-y*n,k=[];if(i<e[1]){let B=(e[1]-b)/y;B>=e[0]&&B<=e[0]+t[0]&&k.push({x:B,y:e[1]})}if(i>e[1]+t[1]){let B=(e[1]+t[1]-b)/y;B>=e[0]&&B<=e[0]+t[0]&&k.push({x:B,y:e[1]+t[1]})}if(n<e[0]){let B=y*e[0]+b;B>=e[1]&&B<=e[1]+t[1]&&k.push({x:e[0],y:B})}if(n>e[0]+t[0]){let B=y*(e[0]+t[0])+b;B>=e[1]&&B<=e[1]+t[1]&&k.push({x:e[0]+t[0],y:B})}k.sort((B,O)=>{let j=Math.sqrt((B.x-n)**2+(B.y-i)**2),A=Math.sqrt((O.x-n)**2+(O.y-i)**2);return j-A});let M=k.length>0?k[0]:{x:n,y:i},L=k.length>0?k[k.length-1]:{x:o,y:l};return{startPosition:M,endPosition:L}}let xe;async function _t(a){if(await C.action.setBadgeText("⏱️"),await C.player.setMetadata({[`${h.EXTENSIONID}/processed`]:!1}),xe||(xe=await co({locateFile:()=>lo})),!I.sceneReady||!I.sceneInitialized){I.playerShadowCache.invalidate(),I.busy=!1,await C.action.setBadgeText(void 0);return}if(I.busy)return;I.busy=!0;const[e,t]=[new Cn,new Cn];e.start(),e.pause(),t.start();const n=I.sceneItems.filter(Z=>xr(Z)&&(!It(Z)||Z.visible===!0)),i=I.sceneItems.filter(Fo),o=I.sceneItems.filter(Br),l=I.sceneItems.filter(ga)?.[0],y=I.sceneItems.filter(Qn)?.[0],b=I.sceneMetadata[`${h.EXTENSIONID}/visionEnabled`]===!0,k=I.sceneMetadata[`${h.EXTENSIONID}/persistenceEnabled`]===!0,M=I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]===!0,L=I.sceneMetadata[`${h.EXTENSIONID}/fowEnabled`]===!0,x=I.sceneMetadata[`${h.EXTENSIONID}/fowColor`],B=I.sceneMetadata[`${h.EXTENSIONID}/playerDoors`]===!0;let O=[0,0],j=[1,1],A=[0,0],[V,X]=O,W=!1,r=[];if(l===void 0&&y===void 0){I.playerShadowCache.invalidate(),I.busy=!1,await C.action.setBadgeText(void 0);return}else if(M){const Z=I.sceneItems.filter(le=>le.layer==="MAP"&&Qt(le));if(Z.length===0){I.busy=!1,await C.action.setBadgeText(void 0);return}let fe=[];for(let le of Z){let be=I.gridDpi/le.grid.dpi,he=le.position.x-be*le.grid.offset.x*le.scale.x,pe=le.position.y-be*le.grid.offset.y*le.scale.y,me=he+be*le.image.width*le.scale.x,Y=pe+be*le.image.height*le.scale.y;if(le.rotation>0){const w=Math.abs(me-he),S=Math.abs(Y-pe);switch(le.rotation){case 270:pe-=S,Y-=S;break;case 180:pe-=S,Y-=S,he-=w,me-=w;break;case 90:he-=w,me-=w;break}}fe.length?(he<fe[0]&&(fe[0]=he),pe<fe[1]&&(fe[1]=pe),me>fe[2]&&(fe[2]=me),Y>fe[3]&&(fe[3]=Y)):(fe[0]=he,fe[1]=pe,fe[2]=me,fe[3]=Y)}A=[fe[0],fe[1]],O=[fe[2]-fe[0],fe[3]-fe[1]],j=[1,1],[V,X]=O}else O[0]=y.width*y.scale.x,O[1]=y.height*y.scale.y,j[0]=y.scale.x,j[1]=y.scale.y,A[0]=y.position.x,A[1]=y.position.y,[V,X]=O;if(I.playerRole==="GM"){r=n;const Z=document.getElementById("mapHeight"),fe=document.getElementById("mapWidth");fe&&(fe.value=(Math.round(O[0])/I.gridDpi).toString()),Z&&(Z.value=(Math.round(O[1])/I.gridDpi).toString())}else{r=n.filter(jo);for(const Z of n)xr(Z)&&I.sceneMetadata[`${h.EXTENSIONID}/USER-${Z.createdUserId}`]?.role==="GM"&&r.push(Z)}const f=JSON.stringify(i),s=JSON.stringify(o),d=JSON.stringify(r),c=JSON.stringify(l);if(I.previousMap===c&&I.previousVisionEnabled===b&&I.previousFowColor===x&&I.previousAutodetectEnabled===M&&I.previousFowEnabled===L&&I.previousPersistenceEnabled===k&&I.previousVisionShapes===f&&I.previousAutohideItems===s&&I.previousPlayersWithVision===d&&I.previousSize[0]===O[0]&&I.previousSize[1]===O[1]&&a!==!0){I.busy=!1,await C.action.setBadgeText(void 0);return}(c!=I.previousMap||I.previousVisionShapes!=f||O[0]!=I.previousSize[0]||O[1]!=I.previousSize[1])&&(W=!0),I.previousMap=c,I.previousPlayersWithVision=d,I.previousVisionShapes=f,I.previousSize=O,I.previousVisionEnabled=b,I.previousAutodetectEnabled=M,I.previousFowEnabled=L,I.previousFowColor=x,I.previousPersistenceEnabled=k,t.pause();const g=[];for(let Z=0;Z<=6;Z++)g.push(new Cn);g[1].start();let u=0,v=0;if(W&&I.playerShadowCache.invalidate(),t.resume(),!(I.sceneMetadata[`${h.EXTENSIONID}/visionEnabled`]===!0)||r.length==0){const Z=I.sceneLocal.filter(fe=>Un(fe));await C.scene.local.deleteItems(Z.map(fe=>fe.id)),I.busy=!1,await C.action.setBadgeText(void 0);return}const P=mo(i),F=go(P,r,V,X,A,j);if(F.length==0){I.busy=!1,await C.action.setBadgeText(void 0);return}const H=[];g[1].pause(),g[2].start();const _={};let U=0;await ne();async function ne(){const Z=r[U];let fe=I.playerShadowCache.getValue(Z.id);if(fe!==void 0&&ra(fe.player.position,Z.position)&&fe.player.metadata[`${h.EXTENSIONID}/visionRange`]===Z.metadata[`${h.EXTENSIONID}/visionRange`]){const me=xe.FromCmds(fe.shadowPath);if(_[U]=me,u++,U===r.length-1){await ie(g);return}else{U++,await ne();return}}v++;const le=F[U];let be=new xe.SkOpBuilder;const he=xe.NewPath().rect(A[0],A[1],O[0],O[1]);be.add(he,xe.PathOp.UNION),he.delete(),await pe(le);function pe(me){const Y=Math.ceil(me.length/I.workers.length);let w=0,S=0,$={};for(let K=0;K<I.workers.length;K++){const J=w+Y,q=me.slice(w,J+10);I.workers[K].onmessage=async function(ye){if(ye.data){const{numb:Oe,messageData:ke}=ye.data;if(S++,$[Oe]=ke,S===I.workers.length){for(let Fe=0;Fe<I.workers.length;Fe++){const Ce=$[Fe];if(Ce){const _e=xe.FromCmds(Ce);be.add(_e,xe.PathOp.INTERSECT),_e.delete()}}let Be=be.resolve();if(Be.simplify(),!Be){console.error("Couldn't compute fog"),I.busy=!1,await C.action.setBadgeText(void 0);return}_[U]=Be,fe!==void 0&&(fe.shadowPath="");const je=Be.toCmds();I.playerShadowCache.cacheValue(Z.id,{shadowPath:je,player:Z}),be.delete(),U===r.length-1?await ie(g):(U++,await ne())}}},I.workers[K].postMessage({numb:K,polygons:q,mapOffset:A,mapSize:O}),w=J}}}async function ie(Z){Z[2].pause(),Z[3].start();const fe=[],le=xe.NewPath();for(let se=0;se<r.length;se++){const N=r[se],G=N.metadata[`${h.EXTENSIONID}/visionRange`],ee=I.playerId===r[se].createdUserId,we=I.sceneMetadata[`${h.EXTENSIONID}/USER-${r[se].createdUserId}`]?.role==="GM";if(It(N)?fe[se]=!0:le.op(_[se],xe.PathOp.UNION),G){if(!ee&&I.playerRole!=="GM"&&!we)continue;const ve=I.gridDpi*(G/I.gridScale+.5),Ee=xe.NewPath().ellipse(N.position.x,N.position.y,ve,ve,0,0,2*Math.PI);_[se]?.op(Ee,xe.PathOp.INTERSECT),Ee.delete();const De=I.sceneMetadata[`${h.EXTENSIONID}/USER-${N.createdUserId}`];if(De&&I.playerRole==="GM"&&!It(N)&&De.role!=="GM"){const Ie=Vr().strokeColor(De.color).fillOpacity(0).position({x:N.position.x,y:N.position.y}).width(ve*2).height(ve*2).shapeType("CIRCLE").metadata({[`${h.EXTENSIONID}/isIndicatorRing`]:!0}).locked(!0).build();H.push(Ie)}}}le.simplify();for(let se=0;se<fe.length;se++)fe[se]===!0&&(_[se].op(le,xe.PathOp.INTERSECT),_[se].simplify());le.delete(),Z[3].pause(),Z[4].start();const be=[],he=[];let pe=[],me=[];const Y=xe.NewPath(),w={},S=I.sceneLocal.filter(se=>Un(se)),$=I.sceneLocal.filter(se=>Xo(se));L&&Y.rect(A[0],A[1],O[0],O[1]);let K=[],J,q=null;if(k)if(K=S.filter(se=>Pt(se)),J=new xe.SkOpBuilder,w.reuse=!0,K.length===0){const se=mt().commands([]).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Smoke!").metadata({[`${h.EXTENSIONID}/isVisionFog`]:!0,[`${h.EXTENSIONID}/digest`]:"reuse"}).build();se.zIndex=3,me.push(se),K=[se]}else q=xe.FromCmds(K[0].commands),q.setFillType(xe.FillType.EVENODD);const ye=new xe.SkOpBuilder;let Oe=!1;for(const se of Object.keys(_)){const N=_[se],ee=new TextEncoder().encode(N.toCmds().toString()),de=await crypto.subtle.digest("SHA-1",ee).then(ve=>[...new Uint8Array(ve)].map(Ee=>Ee.toString(16).padStart(2,"0")).join(""));if(S.filter(ve=>Pt(ve)&&ve.metadata[`${h.EXTENSIONID}/digest`]===de).length===0?k?J.add(N,xe.PathOp.UNION):be.push({cmds:N.toCmds(),visible:!1,zIndex:3,playerId:r[se].id,digest:de}):w[de]=!0,L){const ve=I.sceneLocal.filter(Ee=>Ee.metadata[`${h.EXTENSIONID}/debug`]===!0).map(Ee=>Ee.id);ve.length>0&&(pe=pe.concat(ve)),await jt.GreenDebugPath(N),Y.op(N,xe.PathOp.DIFFERENCE),I.playerRole==="GM"&&(Oe=!0,ye.add(N,xe.PathOp.UNION))}N.delete()}const ke=I.sceneMetadata[`${h.EXTENSIONID}/sceneId`];if(k){const se=J.resolve();se.setFillType(xe.FillType.EVENODD),q!==null&&se.op(q,xe.PathOp.UNION);const N=se.toCmds();K.length>0&&(K[0].commands=N,me=me.concat(K));try{localStorage.setItem(`${h.EXTENSIONID}/fogCache/${I.playerId}/${ke}`,JSON.stringify([{digest:"reuse",commands:N}]))}catch{console.log("Local storage is disabled")}q!==null&&q.delete(),se.delete(),J.delete()}else if(k){const se=S.filter(Pt);try{localStorage.setItem(`${h.EXTENSIONID}/fogCache/${I.playerId}/${ke}`,JSON.stringify(se.map(N=>({digest:N.metadata[`${h.EXTENSIONID}/digest`],commands:N.commands}))))}catch{console.log("Local storage is disabled")}}let Be;Oe&&(Be=ye.resolve()),ye.delete();const je=S.filter(Jt),Fe=S.filter(se=>{const N=se.metadata[`${h.EXTENSIONID}/digest`];return Pt(se)&&w[N]===void 0});if(L){let se=I.sceneMetadata[`${h.EXTENSIONID}/fowColor`]?I.sceneMetadata[`${h.EXTENSIONID}/fowColor`]:"#00000088",N=.5;se.length==9&&(N=Number.parseInt(se.substring(7),16)/255,se=se.substring(0,7));const G=mt().commands(Y.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(se).fillOpacity(N).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${h.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();G.disableHit=!0,je.length>0?he.push(C.scene.local.updateItems(Jt,ee=>{for(const de of ee)de.commands=G.commands},!1)):me.push(G)}else pe=pe.concat(S.filter(Jt).map(se=>se.id));Y.delete(),Z[4].pause(),Z[5].start();const Ce=I.sceneLocal.filter(se=>se.metadata[`${h.EXTENSIONID}/doorId`]!==void 0);B||I.playerRole=="GM"?await Qa():Ce.length>0&&(pe=pe.concat(Ce.map(se=>se.id)));for(const se of Ce){const N=se.metadata[`${h.EXTENSIONID}/doorId`],G=I.sceneItems.find(ee=>ee.id===N);if(G){const ee=se.commands.length==h.DOOROPEN.length,de=!!G.metadata[`${h.EXTENSIONID}/doorOpen`];if(ee===de)continue;he.push(C.scene.local.updateItems([se.id],we=>{const ve=we[0];ja(ve)&&(ve.commands=Ur(de))}))}}t.pause(),e.resume(),await jt.DebugBlobINeverUse(),pe=pe.concat($.map(se=>se.id)),be.map(se=>{const N=mt().commands(se.cmds).fillRule("evenodd").locked(!0).visible(se.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Smoke!").metadata({[`${h.EXTENSIONID}/isVisionFog`]:!0,[`${h.EXTENSIONID}/digest`]:se.digest}).build();N.zIndex=se.zIndex,me.push(N)}),k||(pe=pe.concat(Fe.map(se=>se.id))),H.length>0&&(me=me.concat(H)),!I.fogFilled&&I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]===!0?await C.scene.fog.setFilled(!0):I.fogFilled&&I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]!==!0&&await C.scene.fog.setFilled(!1),y&&y.zIndex!==0&&he.push(C.scene.items.updateItems([y.id],se=>{for(let N of se)N.zIndex=0})),await Promise.all(he),await C.scene.local.deleteItems(pe),await C.scene.local.addItems(me);let _e=0;Z[5].pause(),Z[6].start(),Oe&&(await oe(Be,he),Be.delete()),Z[6].pause();const[Te,qe]=[e.stop(),t.stop()],st={compute_time:`${qe} ms`,communication_time:`${Te} ms`,cache_hits:u.toString(),cache_misses:v.toString(),item_counter:_e.toString()};for(let se=1;se<=6;se++){const N=Z[se].stop();st["stage"+se]=`${N} ms`}yo(st),I.busy=!1,await C.player.setMetadata({[`${h.EXTENSIONID}/processed`]:!0}),await C.action.setBadgeText(void 0)}async function oe(Z,fe){const le=[],be=I.sceneItems.filter(he=>Br(he)&&Qt(he));Z.simplify();for(const he of be){const pe=new xe.SkOpBuilder,me=xe.NewPath(),Y=I.gridDpi/he.grid.dpi*(he.image.width/2)*he.scale.x;for(let $=0;$<6;$++){const K=$*60*Math.PI/180,J=he.position.x+Y*Math.cos(K),q=he.position.y+Y*Math.sin(K);$==0?me.moveTo(J,q):me.lineTo(J,q)}me.closePath(),await jt.BlueTokenBoundingPath(me),pe.add(me,xe.PathOp.UNION),pe.add(Z,xe.PathOp.INTERSECT);const w=pe.resolve(),S=!w.toCmds().length;he.visible==S&&le.push(he),await jt.RedIntersectionPath(w),me.delete(),pe.delete(),w.delete()}fe.push(C.scene.items.updateItems(le.map(he=>he.id),he=>{for(let pe=0;pe<he.length;pe++)he[pe].visible=!he[pe].visible}))}}function yo(a){for(const[e,t]of Object.entries(a)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function Tt(a){if(a.ctrlKey)return a.pointerPosition;const e=Math.round(I.gridDpi/I.gridSnap),t=Math.round(a.pointerPosition.x/I.gridDpi)*I.gridDpi,n=Math.round(a.pointerPosition.y/I.gridDpi)*I.gridDpi,i=Math.abs(t-a.pointerPosition.x),o=Math.abs(n-a.pointerPosition.y);let l,y;return i<=e?l=t:l=a.pointerPosition.x,o<=e?y=n:y=a.pointerPosition.y,{x:l,y}}let tt=null;const vo="#000000",wo=8,Eo=[];async function aa(){await C.popover.close(h.LINETOOLID)}async function Fn(){if(!tt)return;const[a,e]=tt;e(),tt=null,await aa()}async function jn(){if(!tt)return;const[a,e]=tt,t=a(n=>{n.visible=!1,n.metadata[`${h.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await C.scene.items.addItems([t]),e(),tt=null,await aa()}async function ia(){if(!tt)return;const[a]=tt;a(e=>{e.points.length>2&&e.points.pop()})}async function bo(a,e){if(!e.transformer)if(tt){const[t]=tt;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Tt(e),n=I.snap?t:e.pointerPosition,i=ut().tension(0).points([n,n]).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??vo).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??Eo).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??wo).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).locked(!0).build();tt=await C.interaction.startItemInteraction(i);const o=await C.viewport.getWidth();await C.popover.open({id:h.LINETOOLID,url:"/pages/line.html",height:75,width:350,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function _o(a,e){if(!tt||e.transformer)return;const[t]=tt,n=Tt(e);t(i=>{i.points[i.points.length-1]=I.snap?n:e.pointerPosition})}function Io(a,e){tt&&(e.key=="Escape"?Fn():e.key=="Enter"?jn():e.key==="z"&&ia())}const Mn={onToolClick:bo,onToolMove:_o,onKeyDown:Io};let nt=null;const ko="#000000",So=8,To=[];async function oa(){await C.popover.close(h.POLYTOOLID)}async function Vn(){if(!nt)return;const[a,e]=nt;e(),nt=null,oa(),await C.player.setMetadata({[`${h.EXTENSIONID}/cancelPoly`]:!1})}async function Hn(){if(!nt)return;const[a,e]=nt,t=a(n=>{n.visible=!1,n.metadata[`${h.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&await C.scene.items.addItems([t]),e(),nt=null,oa(),await C.player.setMetadata({[`${h.EXTENSIONID}/finishPoly`]:!1})}async function sa(){if(!nt)return;const[a]=nt;a(e=>{e.points.length>2&&e.points.pop()})}async function No(a,e){if(!e.transformer)if(nt){const[t]=nt;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Tt(e),n=I.snap?t:e.pointerPosition,i=ut().tension(0).points([n,n]).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??ko).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??To).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??So).fillOpacity(.5).fillColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").locked(!0).build();nt=await C.interaction.startItemInteraction(i);const o=await C.viewport.getWidth();await C.popover.open({id:h.POLYTOOLID,url:"/pages/polygon.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Oo(a,e){if(!nt||e.transformer)return;const[t]=nt,n=Tt(e);t(i=>{i.points[i.points.length-1]=I.snap?n:e.pointerPosition})}function Co(a,e){nt&&(e.key=="Escape"?Vn():e.key=="Enter"?Hn():e.key==="z"&&sa())}const Pn={onToolClick:No,onToolMove:Oo,onKeyDown:Co};let rt=null;const da=8,ua=[];async function ca(){await C.popover.close(h.ELEVATIONTOOLID)}async function Jn(){if(!rt)return;const[a,e]=rt;e(),rt=null,ca()}async function la(){if(!rt)return;const[a,e]=rt,t=a(n=>{n.visible=!1,n.points.pop(),n.points.push(n.points[0])});if(t.points.length>=4){await C.scene.local.addItems([t]);let n=I.sceneMetadata[`${h.EXTENSIONID}/elevationMapping`];n||(n=[]);const i=t.metadata[`${h.EXTENSIONID}/elevation`]??0,o={Points:t.points,Depth:i};n.push(o),await C.scene.setMetadata({[`${h.EXTENSIONID}/elevationMapping`]:n})}e(),rt=null,ca()}async function fa(){if(!rt)return;const[a]=rt;a(e=>{e.points.length>2&&e.points.pop()})}async function Do(a,e,t){if(!e.transformer)if(rt){const[n]=rt;n(i=>{i.points.push(e.pointerPosition)})}else{const n=Tt(e),i=I.snap?n:e.pointerPosition,o=ut().tension(0).points([i,i]).strokeColor(ha(t)).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??ua).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??da).fillOpacity(.5).fillColor(pa(t)).layer("DRAWING").metadata({[`${h.EXTENSIONID}/elevation`]:t}).name(`Elevation-${t} Area`).zIndex(t).locked(!0).build();rt=await C.interaction.startItemInteraction(o);const l=await C.viewport.getWidth();await C.popover.open({id:h.ELEVATIONTOOLID,url:"/pages/elevation.html",height:110,width:360,disableClickAway:!0,anchorPosition:{top:60,left:l/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Mo(a,e){if(!rt||e.transformer)return;const[t]=rt,n=Tt(e);t(i=>{i.points[i.points.length-1]=I.snap?n:e.pointerPosition})}function Po(a,e,t){rt&&(e.key=="Escape"?Jn():e.key=="Enter"?la():e.key==="z"&&fa())}async function Ao(a){const e=a.metadata[`${h.EXTENSIONID}/elevationEditor`]??!1;await C.tool.setMetadata(`${h.EXTENSIONID}/vision-tool`,{[`${h.EXTENSIONID}/elevationEditor`]:!e}),e?await Lo():await $o()}async function $o(a){const t=(await C.scene.getMetadata())[`${h.EXTENSIONID}/elevationMapping`]??[];if(t&&t.length>0){const n=[];for(const i of t){const o=ut().tension(0).points(i.Points).strokeColor(ha(i.Depth)).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??ua).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??da).fillOpacity(.5).fillColor(pa(i.Depth)).layer("DRAWING").name("Elevation-1 Area").locked(!0).visible(!1).metadata({[`${h.EXTENSIONID}/elevation`]:i.Depth}).zIndex(i.Depth).build();n.push(o)}await C.scene.local.addItems(n)}}async function Lo(a){const e=I.sceneLocal.filter(t=>t.metadata[`${h.EXTENSIONID}/elevation`]!==void 0);if(e.length>0){const t=[];for(const n of e){let i=n.points;(n.position.x!==0||n.position.y!==0)&&(i=n.points.map(l=>{const y=l.x+n.position.x,b=l.y+n.position.y;return{x:y,y:b}}));const o={Points:i,Depth:n.metadata[`${h.EXTENSIONID}/elevation`]??0};t.push(o)}await C.scene.setMetadata({[`${h.EXTENSIONID}/elevationMapping`]:t}),await C.scene.local.deleteItems(e.map(n=>n.id))}else await C.scene.setMetadata({[`${h.EXTENSIONID}/elevationMapping`]:[]})}function ha(a){switch(a){case 1:return"#6454ac";case 2:return"#029658";case 3:return"#fcd444";case 4:return"#fc6404";case 5:return"#ff0000";default:return"#000000"}}function pa(a){switch(a){case 1:return"#6454ac4F";case 2:return"#0296584F";case 3:return"#fcd4444F";case 4:return"#fc64044F";case 5:return"#ff00004F";default:return"#0000004F"}}const Ge={onToolClick:Do,onToolMove:Mo,onKeyDown:Po,enterEditMode:Ao,cancelDrawing:Jn};function Gt(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ma={exports:{}};(function(a,e){(function(t){a.exports=t()})(function(){return function t(n,i,o){function l(k,M){if(!i[k]){if(!n[k]){var L=typeof Gt=="function"&&Gt;if(!M&&L)return L(k,!0);if(y)return y(k,!0);throw new Error("Cannot find module '"+k+"'")}M=i[k]={exports:{}},n[k][0].call(M.exports,function(x){var B=n[k][1][x];return l(B||x)},M,M.exports,t,n,i,o)}return i[k].exports}for(var y=typeof Gt=="function"&&Gt,b=0;b<o.length;b++)l(o[b]);return l}({1:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){var O=t("crypto");function j(s,d){d=X(s,d);var c;return(c=d.algorithm!=="passthrough"?O.createHash(d.algorithm):new f).write===void 0&&(c.write=c.update,c.end=c.update),r(d,c).dispatch(s),c.update||c.end(""),c.digest?c.digest(d.encoding==="buffer"?void 0:d.encoding):(s=c.read(),d.encoding!=="buffer"?s.toString(d.encoding):s)}(i=n.exports=j).sha1=function(s){return j(s)},i.keys=function(s){return j(s,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},i.MD5=function(s){return j(s,{algorithm:"md5",encoding:"hex"})},i.keysMD5=function(s){return j(s,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var A=O.getHashes?O.getHashes().slice():["sha1","md5"],V=(A.push("passthrough"),["buffer","hex","binary","base64"]);function X(s,d){var c={};if(c.algorithm=(d=d||{}).algorithm||"sha1",c.encoding=d.encoding||"hex",c.excludeValues=!!d.excludeValues,c.algorithm=c.algorithm.toLowerCase(),c.encoding=c.encoding.toLowerCase(),c.ignoreUnknown=d.ignoreUnknown===!0,c.respectType=d.respectType!==!1,c.respectFunctionNames=d.respectFunctionNames!==!1,c.respectFunctionProperties=d.respectFunctionProperties!==!1,c.unorderedArrays=d.unorderedArrays===!0,c.unorderedSets=d.unorderedSets!==!1,c.unorderedObjects=d.unorderedObjects!==!1,c.replacer=d.replacer||void 0,c.excludeKeys=d.excludeKeys||void 0,s===void 0)throw new Error("Object argument required.");for(var g=0;g<A.length;++g)A[g].toLowerCase()===c.algorithm.toLowerCase()&&(c.algorithm=A[g]);if(A.indexOf(c.algorithm)===-1)throw new Error('Algorithm "'+c.algorithm+'"  not supported. supported values: '+A.join(", "));if(V.indexOf(c.encoding)===-1&&c.algorithm!=="passthrough")throw new Error('Encoding "'+c.encoding+'"  not supported. supported values: '+V.join(", "));return c}function W(s){if(typeof s=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(s))!=null}function r(s,d,c){c=c||[];function g(u){return d.update?d.update(u,"utf8"):d.write(u,"utf8")}return{dispatch:function(u){return this["_"+((u=s.replacer?s.replacer(u):u)===null?"null":typeof u)](u)},_object:function(u){var v,D=Object.prototype.toString.call(u),P=/\[object (.*)\]/i.exec(D);if(P=(P=P?P[1]:"unknown:["+D+"]").toLowerCase(),0<=(D=c.indexOf(u)))return this.dispatch("[CIRCULAR:"+D+"]");if(c.push(u),y!==void 0&&y.isBuffer&&y.isBuffer(u))return g("buffer:"),g(u);if(P==="object"||P==="function"||P==="asyncfunction")return D=Object.keys(u),s.unorderedObjects&&(D=D.sort()),s.respectType===!1||W(u)||D.splice(0,0,"prototype","__proto__","constructor"),s.excludeKeys&&(D=D.filter(function(F){return!s.excludeKeys(F)})),g("object:"+D.length+":"),v=this,D.forEach(function(F){v.dispatch(F),g(":"),s.excludeValues||v.dispatch(u[F]),g(",")});if(!this["_"+P]){if(s.ignoreUnknown)return g("["+P+"]");throw new Error('Unknown object type "'+P+'"')}this["_"+P](u)},_array:function(u,F){F=F!==void 0?F:s.unorderedArrays!==!1;var D=this;if(g("array:"+u.length+":"),!F||u.length<=1)return u.forEach(function(H){return D.dispatch(H)});var P=[],F=u.map(function(H){var _=new f,U=c.slice();return r(s,_,U).dispatch(H),P=P.concat(U.slice(c.length)),_.read().toString()});return c=c.concat(P),F.sort(),this._array(F,!1)},_date:function(u){return g("date:"+u.toJSON())},_symbol:function(u){return g("symbol:"+u.toString())},_error:function(u){return g("error:"+u.toString())},_boolean:function(u){return g("bool:"+u.toString())},_string:function(u){g("string:"+u.length+":"),g(u.toString())},_function:function(u){g("fn:"),W(u)?this.dispatch("[native]"):this.dispatch(u.toString()),s.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(u.name)),s.respectFunctionProperties&&this._object(u)},_number:function(u){return g("number:"+u.toString())},_xml:function(u){return g("xml:"+u.toString())},_null:function(){return g("Null")},_undefined:function(){return g("Undefined")},_regexp:function(u){return g("regex:"+u.toString())},_uint8array:function(u){return g("uint8array:"),this.dispatch(Array.prototype.slice.call(u))},_uint8clampedarray:function(u){return g("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(u))},_int8array:function(u){return g("int8array:"),this.dispatch(Array.prototype.slice.call(u))},_uint16array:function(u){return g("uint16array:"),this.dispatch(Array.prototype.slice.call(u))},_int16array:function(u){return g("int16array:"),this.dispatch(Array.prototype.slice.call(u))},_uint32array:function(u){return g("uint32array:"),this.dispatch(Array.prototype.slice.call(u))},_int32array:function(u){return g("int32array:"),this.dispatch(Array.prototype.slice.call(u))},_float32array:function(u){return g("float32array:"),this.dispatch(Array.prototype.slice.call(u))},_float64array:function(u){return g("float64array:"),this.dispatch(Array.prototype.slice.call(u))},_arraybuffer:function(u){return g("arraybuffer:"),this.dispatch(new Uint8Array(u))},_url:function(u){return g("url:"+u.toString())},_map:function(u){return g("map:"),u=Array.from(u),this._array(u,s.unorderedSets!==!1)},_set:function(u){return g("set:"),u=Array.from(u),this._array(u,s.unorderedSets!==!1)},_file:function(u){return g("file:"),this.dispatch([u.name,u.size,u.type,u.lastModfied])},_blob:function(){if(s.ignoreUnknown)return g("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return g("domwindow")},_bigint:function(u){return g("bigint:"+u.toString())},_process:function(){return g("process")},_timer:function(){return g("timer")},_pipe:function(){return g("pipe")},_tcp:function(){return g("tcp")},_udp:function(){return g("udp")},_tty:function(){return g("tty")},_statwatcher:function(){return g("statwatcher")},_securecontext:function(){return g("securecontext")},_connection:function(){return g("connection")},_zlib:function(){return g("zlib")},_context:function(){return g("context")},_nodescript:function(){return g("nodescript")},_httpparser:function(){return g("httpparser")},_dataview:function(){return g("dataview")},_signal:function(){return g("signal")},_fsevent:function(){return g("fsevent")},_tlswrap:function(){return g("tlswrap")}}}function f(){return{buf:"",write:function(s){this.buf+=s},end:function(s){this.buf+=s},read:function(){return this.buf}}}i.writeToStream=function(s,d,c){return c===void 0&&(c=d,d={}),r(d=X(s,d),c).dispatch(s)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){(function(O){var j=typeof Uint8Array<"u"?Uint8Array:Array,A="+".charCodeAt(0),V="/".charCodeAt(0),X="0".charCodeAt(0),W="a".charCodeAt(0),r="A".charCodeAt(0),f="-".charCodeAt(0),s="_".charCodeAt(0);function d(c){return c=c.charCodeAt(0),c===A||c===f?62:c===V||c===s?63:c<X?-1:c<X+10?c-X+26+26:c<r+26?c-r:c<W+26?c-W+26:void 0}O.toByteArray=function(c){var g,u;if(0<c.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var v=c.length,v=c.charAt(v-2)==="="?2:c.charAt(v-1)==="="?1:0,D=new j(3*c.length/4-v),P=0<v?c.length-4:c.length,F=0;function H(_){D[F++]=_}for(g=0;g<P;g+=4,0)H((16711680&(u=d(c.charAt(g))<<18|d(c.charAt(g+1))<<12|d(c.charAt(g+2))<<6|d(c.charAt(g+3))))>>16),H((65280&u)>>8),H(255&u);return v==2?H(255&(u=d(c.charAt(g))<<2|d(c.charAt(g+1))>>4)):v==1&&(H((u=d(c.charAt(g))<<10|d(c.charAt(g+1))<<4|d(c.charAt(g+2))>>2)>>8&255),H(255&u)),D},O.fromByteArray=function(c){var g,u,v,D,P=c.length%3,F="";function H(_){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(_)}for(g=0,v=c.length-P;g<v;g+=3)u=(c[g]<<16)+(c[g+1]<<8)+c[g+2],F+=H((D=u)>>18&63)+H(D>>12&63)+H(D>>6&63)+H(63&D);switch(P){case 1:F=(F+=H((u=c[c.length-1])>>2))+H(u<<4&63)+"==";break;case 2:F=(F=(F+=H((u=(c[c.length-2]<<8)+c[c.length-1])>>10))+H(u>>4&63))+H(u<<2&63)+"="}return F}})(i===void 0?this.base64js={}:i)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,i){(function(o,l,A,b,k,M,L,x,B){var O=t("base64-js"),j=t("ieee754");function A(w,S,$){if(!(this instanceof A))return new A(w,S,$);var K,J,q,ye,Oe=typeof w;if(S==="base64"&&Oe=="string")for(w=(ye=w).trim?ye.trim():ye.replace(/^\s+|\s+$/g,"");w.length%4!=0;)w+="=";if(Oe=="number")K=ne(w);else if(Oe=="string")K=A.byteLength(w,S);else{if(Oe!="object")throw new Error("First argument needs to be a number, array or string.");K=ne(w.length)}if(A._useTypedArrays?J=A._augment(new Uint8Array(K)):((J=this).length=K,J._isBuffer=!0),A._useTypedArrays&&typeof w.byteLength=="number")J._set(w);else if(ie(ye=w)||A.isBuffer(ye)||ye&&typeof ye=="object"&&typeof ye.length=="number")for(q=0;q<K;q++)A.isBuffer(w)?J[q]=w.readUInt8(q):J[q]=w[q];else if(Oe=="string")J.write(w,0,S);else if(Oe=="number"&&!A._useTypedArrays&&!$)for(q=0;q<K;q++)J[q]=0;return J}function V(w,S,$,K){return A._charsWritten=le(function(J){for(var q=[],ye=0;ye<J.length;ye++)q.push(255&J.charCodeAt(ye));return q}(S),w,$,K)}function X(w,S,$,K){return A._charsWritten=le(function(J){for(var q,ye,Oe=[],ke=0;ke<J.length;ke++)ye=J.charCodeAt(ke),q=ye>>8,ye=ye%256,Oe.push(ye),Oe.push(q);return Oe}(S),w,$,K)}function W(w,S,$){var K="";$=Math.min(w.length,$);for(var J=S;J<$;J++)K+=String.fromCharCode(w[J]);return K}function r(w,S,$,q){q||(Y(typeof $=="boolean","missing or invalid endian"),Y(S!=null,"missing offset"),Y(S+1<w.length,"Trying to read beyond buffer length"));var J,q=w.length;if(!(q<=S))return $?(J=w[S],S+1<q&&(J|=w[S+1]<<8)):(J=w[S]<<8,S+1<q&&(J|=w[S+1])),J}function f(w,S,$,q){q||(Y(typeof $=="boolean","missing or invalid endian"),Y(S!=null,"missing offset"),Y(S+3<w.length,"Trying to read beyond buffer length"));var J,q=w.length;if(!(q<=S))return $?(S+2<q&&(J=w[S+2]<<16),S+1<q&&(J|=w[S+1]<<8),J|=w[S],S+3<q&&(J+=w[S+3]<<24>>>0)):(S+1<q&&(J=w[S+1]<<16),S+2<q&&(J|=w[S+2]<<8),S+3<q&&(J|=w[S+3]),J+=w[S]<<24>>>0),J}function s(w,S,$,K){if(K||(Y(typeof $=="boolean","missing or invalid endian"),Y(S!=null,"missing offset"),Y(S+1<w.length,"Trying to read beyond buffer length")),!(w.length<=S))return K=r(w,S,$,!0),32768&K?-1*(65535-K+1):K}function d(w,S,$,K){if(K||(Y(typeof $=="boolean","missing or invalid endian"),Y(S!=null,"missing offset"),Y(S+3<w.length,"Trying to read beyond buffer length")),!(w.length<=S))return K=f(w,S,$,!0),2147483648&K?-1*(4294967295-K+1):K}function c(w,S,$,K){return K||(Y(typeof $=="boolean","missing or invalid endian"),Y(S+3<w.length,"Trying to read beyond buffer length")),j.read(w,S,$,23,4)}function g(w,S,$,K){return K||(Y(typeof $=="boolean","missing or invalid endian"),Y(S+7<w.length,"Trying to read beyond buffer length")),j.read(w,S,$,52,8)}function u(w,S,$,K,J){if(J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+1<w.length,"trying to write beyond buffer length"),he(S,65535)),J=w.length,!(J<=$))for(var q=0,ye=Math.min(J-$,2);q<ye;q++)w[$+q]=(S&255<<8*(K?q:1-q))>>>8*(K?q:1-q)}function v(w,S,$,K,J){if(J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+3<w.length,"trying to write beyond buffer length"),he(S,4294967295)),J=w.length,!(J<=$))for(var q=0,ye=Math.min(J-$,4);q<ye;q++)w[$+q]=S>>>8*(K?q:3-q)&255}function D(w,S,$,K,J){J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+1<w.length,"Trying to write beyond buffer length"),pe(S,32767,-32768)),w.length<=$||u(w,0<=S?S:65535+S+1,$,K,J)}function P(w,S,$,K,J){J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+3<w.length,"Trying to write beyond buffer length"),pe(S,2147483647,-2147483648)),w.length<=$||v(w,0<=S?S:4294967295+S+1,$,K,J)}function F(w,S,$,K,J){J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+3<w.length,"Trying to write beyond buffer length"),me(S,34028234663852886e22,-34028234663852886e22)),w.length<=$||j.write(w,S,$,K,23,4)}function H(w,S,$,K,J){J||(Y(S!=null,"missing value"),Y(typeof K=="boolean","missing or invalid endian"),Y($!=null,"missing offset"),Y($+7<w.length,"Trying to write beyond buffer length"),me(S,17976931348623157e292,-17976931348623157e292)),w.length<=$||j.write(w,S,$,K,52,8)}i.Buffer=A,i.SlowBuffer=A,i.INSPECT_MAX_BYTES=50,A.poolSize=8192,A._useTypedArrays=function(){try{var w=new ArrayBuffer(0),S=new Uint8Array(w);return S.foo=function(){return 42},S.foo()===42&&typeof S.subarray=="function"}catch{return!1}}(),A.isEncoding=function(w){switch(String(w).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},A.isBuffer=function(w){return!(w==null||!w._isBuffer)},A.byteLength=function(w,S){var $;switch(w+="",S||"utf8"){case"hex":$=w.length/2;break;case"utf8":case"utf-8":$=Z(w).length;break;case"ascii":case"binary":case"raw":$=w.length;break;case"base64":$=fe(w).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":$=2*w.length;break;default:throw new Error("Unknown encoding")}return $},A.concat=function(w,S){if(Y(ie(w),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),w.length===0)return new A(0);if(w.length===1)return w[0];if(typeof S!="number")for(J=S=0;J<w.length;J++)S+=w[J].length;for(var $=new A(S),K=0,J=0;J<w.length;J++){var q=w[J];q.copy($,K),K+=q.length}return $},A.prototype.write=function(w,S,$,K){isFinite(S)?isFinite($)||(K=$,$=void 0):(ke=K,K=S,S=$,$=ke),S=Number(S)||0;var J,q,ye,Oe,ke=this.length-S;switch((!$||ke<($=Number($)))&&($=ke),K=String(K||"utf8").toLowerCase()){case"hex":J=function(Be,je,Fe,Ce){Fe=Number(Fe)||0;var _e=Be.length-Fe;(!Ce||_e<(Ce=Number(Ce)))&&(Ce=_e),Y((_e=je.length)%2==0,"Invalid hex string"),_e/2<Ce&&(Ce=_e/2);for(var Te=0;Te<Ce;Te++){var qe=parseInt(je.substr(2*Te,2),16);Y(!isNaN(qe),"Invalid hex string"),Be[Fe+Te]=qe}return A._charsWritten=2*Te,Te}(this,w,S,$);break;case"utf8":case"utf-8":q=this,ye=S,Oe=$,J=A._charsWritten=le(Z(w),q,ye,Oe);break;case"ascii":case"binary":J=V(this,w,S,$);break;case"base64":q=this,ye=S,Oe=$,J=A._charsWritten=le(fe(w),q,ye,Oe);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":J=X(this,w,S,$);break;default:throw new Error("Unknown encoding")}return J},A.prototype.toString=function(w,S,$){var K,J,q,ye,Oe=this;if(w=String(w||"utf8").toLowerCase(),S=Number(S)||0,($=$!==void 0?Number($):Oe.length)===S)return"";switch(w){case"hex":K=function(ke,Be,je){var Fe=ke.length;(!Be||Be<0)&&(Be=0),(!je||je<0||Fe<je)&&(je=Fe);for(var Ce="",_e=Be;_e<je;_e++)Ce+=oe(ke[_e]);return Ce}(Oe,S,$);break;case"utf8":case"utf-8":K=function(ke,Be,je){var Fe="",Ce="";je=Math.min(ke.length,je);for(var _e=Be;_e<je;_e++)ke[_e]<=127?(Fe+=be(Ce)+String.fromCharCode(ke[_e]),Ce=""):Ce+="%"+ke[_e].toString(16);return Fe+be(Ce)}(Oe,S,$);break;case"ascii":case"binary":K=W(Oe,S,$);break;case"base64":J=Oe,ye=$,K=(q=S)===0&&ye===J.length?O.fromByteArray(J):O.fromByteArray(J.slice(q,ye));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":K=function(ke,Be,je){for(var Fe=ke.slice(Be,je),Ce="",_e=0;_e<Fe.length;_e+=2)Ce+=String.fromCharCode(Fe[_e]+256*Fe[_e+1]);return Ce}(Oe,S,$);break;default:throw new Error("Unknown encoding")}return K},A.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},A.prototype.copy=function(w,S,$,K){if(S=S||0,(K=K||K===0?K:this.length)!==($=$||0)&&w.length!==0&&this.length!==0){Y($<=K,"sourceEnd < sourceStart"),Y(0<=S&&S<w.length,"targetStart out of bounds"),Y(0<=$&&$<this.length,"sourceStart out of bounds"),Y(0<=K&&K<=this.length,"sourceEnd out of bounds"),K>this.length&&(K=this.length);var J=(K=w.length-S<K-$?w.length-S+$:K)-$;if(J<100||!A._useTypedArrays)for(var q=0;q<J;q++)w[q+S]=this[q+$];else w._set(this.subarray($,$+J),S)}},A.prototype.slice=function(w,S){var $=this.length;if(w=U(w,$,0),S=U(S,$,$),A._useTypedArrays)return A._augment(this.subarray(w,S));for(var K=S-w,J=new A(K,void 0,!0),q=0;q<K;q++)J[q]=this[q+w];return J},A.prototype.get=function(w){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(w)},A.prototype.set=function(w,S){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(w,S)},A.prototype.readUInt8=function(w,S){if(S||(Y(w!=null,"missing offset"),Y(w<this.length,"Trying to read beyond buffer length")),!(w>=this.length))return this[w]},A.prototype.readUInt16LE=function(w,S){return r(this,w,!0,S)},A.prototype.readUInt16BE=function(w,S){return r(this,w,!1,S)},A.prototype.readUInt32LE=function(w,S){return f(this,w,!0,S)},A.prototype.readUInt32BE=function(w,S){return f(this,w,!1,S)},A.prototype.readInt8=function(w,S){if(S||(Y(w!=null,"missing offset"),Y(w<this.length,"Trying to read beyond buffer length")),!(w>=this.length))return 128&this[w]?-1*(255-this[w]+1):this[w]},A.prototype.readInt16LE=function(w,S){return s(this,w,!0,S)},A.prototype.readInt16BE=function(w,S){return s(this,w,!1,S)},A.prototype.readInt32LE=function(w,S){return d(this,w,!0,S)},A.prototype.readInt32BE=function(w,S){return d(this,w,!1,S)},A.prototype.readFloatLE=function(w,S){return c(this,w,!0,S)},A.prototype.readFloatBE=function(w,S){return c(this,w,!1,S)},A.prototype.readDoubleLE=function(w,S){return g(this,w,!0,S)},A.prototype.readDoubleBE=function(w,S){return g(this,w,!1,S)},A.prototype.writeUInt8=function(w,S,$){$||(Y(w!=null,"missing value"),Y(S!=null,"missing offset"),Y(S<this.length,"trying to write beyond buffer length"),he(w,255)),S>=this.length||(this[S]=w)},A.prototype.writeUInt16LE=function(w,S,$){u(this,w,S,!0,$)},A.prototype.writeUInt16BE=function(w,S,$){u(this,w,S,!1,$)},A.prototype.writeUInt32LE=function(w,S,$){v(this,w,S,!0,$)},A.prototype.writeUInt32BE=function(w,S,$){v(this,w,S,!1,$)},A.prototype.writeInt8=function(w,S,$){$||(Y(w!=null,"missing value"),Y(S!=null,"missing offset"),Y(S<this.length,"Trying to write beyond buffer length"),pe(w,127,-128)),S>=this.length||(0<=w?this.writeUInt8(w,S,$):this.writeUInt8(255+w+1,S,$))},A.prototype.writeInt16LE=function(w,S,$){D(this,w,S,!0,$)},A.prototype.writeInt16BE=function(w,S,$){D(this,w,S,!1,$)},A.prototype.writeInt32LE=function(w,S,$){P(this,w,S,!0,$)},A.prototype.writeInt32BE=function(w,S,$){P(this,w,S,!1,$)},A.prototype.writeFloatLE=function(w,S,$){F(this,w,S,!0,$)},A.prototype.writeFloatBE=function(w,S,$){F(this,w,S,!1,$)},A.prototype.writeDoubleLE=function(w,S,$){H(this,w,S,!0,$)},A.prototype.writeDoubleBE=function(w,S,$){H(this,w,S,!1,$)},A.prototype.fill=function(w,S,$){if(S=S||0,$=$||this.length,Y(typeof(w=typeof(w=w||0)=="string"?w.charCodeAt(0):w)=="number"&&!isNaN(w),"value is not a number"),Y(S<=$,"end < start"),$!==S&&this.length!==0){Y(0<=S&&S<this.length,"start out of bounds"),Y(0<=$&&$<=this.length,"end out of bounds");for(var K=S;K<$;K++)this[K]=w}},A.prototype.inspect=function(){for(var w=[],S=this.length,$=0;$<S;$++)if(w[$]=oe(this[$]),$===i.INSPECT_MAX_BYTES){w[$+1]="...";break}return"<Buffer "+w.join(" ")+">"},A.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(A._useTypedArrays)return new A(this).buffer;for(var w=new Uint8Array(this.length),S=0,$=w.length;S<$;S+=1)w[S]=this[S];return w.buffer};var _=A.prototype;function U(w,S,$){return typeof w!="number"?$:S<=(w=~~w)?S:0<=w||0<=(w+=S)?w:0}function ne(w){return(w=~~Math.ceil(+w))<0?0:w}function ie(w){return(Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"})(w)}function oe(w){return w<16?"0"+w.toString(16):w.toString(16)}function Z(w){for(var S=[],$=0;$<w.length;$++){var K=w.charCodeAt($);if(K<=127)S.push(w.charCodeAt($));else for(var J=$,q=(55296<=K&&K<=57343&&$++,encodeURIComponent(w.slice(J,$+1)).substr(1).split("%")),ye=0;ye<q.length;ye++)S.push(parseInt(q[ye],16))}return S}function fe(w){return O.toByteArray(w)}function le(w,S,$,K){for(var J=0;J<K&&!(J+$>=S.length||J>=w.length);J++)S[J+$]=w[J];return J}function be(w){try{return decodeURIComponent(w)}catch{return String.fromCharCode(65533)}}function he(w,S){Y(typeof w=="number","cannot write a non-number as a number"),Y(0<=w,"specified a negative value for writing an unsigned value"),Y(w<=S,"value is larger than maximum value for type"),Y(Math.floor(w)===w,"value has a fractional component")}function pe(w,S,$){Y(typeof w=="number","cannot write a non-number as a number"),Y(w<=S,"value larger than maximum allowed value"),Y($<=w,"value smaller than minimum allowed value"),Y(Math.floor(w)===w,"value has a fractional component")}function me(w,S,$){Y(typeof w=="number","cannot write a non-number as a number"),Y(w<=S,"value larger than maximum allowed value"),Y($<=w,"value smaller than minimum allowed value")}function Y(w,S){if(!w)throw new Error(S||"Failed assertion")}A._augment=function(w){return w._isBuffer=!0,w._get=w.get,w._set=w.set,w.get=_.get,w.set=_.set,w.write=_.write,w.toString=_.toString,w.toLocaleString=_.toString,w.toJSON=_.toJSON,w.copy=_.copy,w.slice=_.slice,w.readUInt8=_.readUInt8,w.readUInt16LE=_.readUInt16LE,w.readUInt16BE=_.readUInt16BE,w.readUInt32LE=_.readUInt32LE,w.readUInt32BE=_.readUInt32BE,w.readInt8=_.readInt8,w.readInt16LE=_.readInt16LE,w.readInt16BE=_.readInt16BE,w.readInt32LE=_.readInt32LE,w.readInt32BE=_.readInt32BE,w.readFloatLE=_.readFloatLE,w.readFloatBE=_.readFloatBE,w.readDoubleLE=_.readDoubleLE,w.readDoubleBE=_.readDoubleBE,w.writeUInt8=_.writeUInt8,w.writeUInt16LE=_.writeUInt16LE,w.writeUInt16BE=_.writeUInt16BE,w.writeUInt32LE=_.writeUInt32LE,w.writeUInt32BE=_.writeUInt32BE,w.writeInt8=_.writeInt8,w.writeInt16LE=_.writeInt16LE,w.writeInt16BE=_.writeInt16BE,w.writeInt32LE=_.writeInt32LE,w.writeInt32BE=_.writeInt32BE,w.writeFloatLE=_.writeFloatLE,w.writeFloatBE=_.writeFloatBE,w.writeDoubleLE=_.writeDoubleLE,w.writeDoubleBE=_.writeDoubleBE,w.fill=_.fill,w.inspect=_.inspect,w.toArrayBuffer=_.toArrayBuffer,w}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,i){(function(o,l,O,b,k,M,L,x,B){var O=t("buffer").Buffer,j=4,A=new O(j);A.fill(0),n.exports={hash:function(V,X,W,r){for(var f=X(function(u,v){u.length%j!=0&&(D=u.length+(j-u.length%j),u=O.concat([u,A],D));for(var D,P=[],F=v?u.readInt32BE:u.readInt32LE,H=0;H<u.length;H+=j)P.push(F.call(u,H));return P}(V=O.isBuffer(V)?V:new O(V),r),8*V.length),X=r,s=new O(W),d=X?s.writeInt32BE:s.writeInt32LE,c=0;c<f.length;c++)d.call(s,f[c],4*c,!0);return s}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,i){(function(o,l,O,b,k,M,L,x,B){var O=t("buffer").Buffer,j=t("./sha"),A=t("./sha256"),V=t("./rng"),X={sha1:j,sha256:A,md5:t("./md5")},W=64,r=new O(W);function f(u,v){var D=X[u=u||"sha1"],P=[];return D||s("algorithm:",u,"is not yet supported"),{update:function(F){return O.isBuffer(F)||(F=new O(F)),P.push(F),F.length,this},digest:function(F){var H=O.concat(P),H=v?function(_,U,ne){O.isBuffer(U)||(U=new O(U)),O.isBuffer(ne)||(ne=new O(ne)),U.length>W?U=_(U):U.length<W&&(U=O.concat([U,r],W));for(var ie=new O(W),oe=new O(W),Z=0;Z<W;Z++)ie[Z]=54^U[Z],oe[Z]=92^U[Z];return ne=_(O.concat([ie,ne])),_(O.concat([oe,ne]))}(D,v,H):D(H);return P=null,F?H.toString(F):H}}}function s(){var u=[].slice.call(arguments).join(" ");throw new Error([u,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}r.fill(0),i.createHash=function(u){return f(u)},i.createHmac=f,i.randomBytes=function(u,v){if(!v||!v.call)return new O(V(u));try{v.call(this,void 0,new O(V(u)))}catch(D){v(D)}};var d,c=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],g=function(u){i[u]=function(){s("sorry,",u,"is not implemented yet")}};for(d in c)g(c[d])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){var O=t("./helpers");function j(s,d){s[d>>5]|=128<<d%32,s[14+(d+64>>>9<<4)]=d;for(var c=1732584193,g=-271733879,u=-1732584194,v=271733878,D=0;D<s.length;D+=16){var P=c,F=g,H=u,_=v,c=V(c,g,u,v,s[D+0],7,-680876936),v=V(v,c,g,u,s[D+1],12,-389564586),u=V(u,v,c,g,s[D+2],17,606105819),g=V(g,u,v,c,s[D+3],22,-1044525330);c=V(c,g,u,v,s[D+4],7,-176418897),v=V(v,c,g,u,s[D+5],12,1200080426),u=V(u,v,c,g,s[D+6],17,-1473231341),g=V(g,u,v,c,s[D+7],22,-45705983),c=V(c,g,u,v,s[D+8],7,1770035416),v=V(v,c,g,u,s[D+9],12,-1958414417),u=V(u,v,c,g,s[D+10],17,-42063),g=V(g,u,v,c,s[D+11],22,-1990404162),c=V(c,g,u,v,s[D+12],7,1804603682),v=V(v,c,g,u,s[D+13],12,-40341101),u=V(u,v,c,g,s[D+14],17,-1502002290),c=X(c,g=V(g,u,v,c,s[D+15],22,1236535329),u,v,s[D+1],5,-165796510),v=X(v,c,g,u,s[D+6],9,-1069501632),u=X(u,v,c,g,s[D+11],14,643717713),g=X(g,u,v,c,s[D+0],20,-373897302),c=X(c,g,u,v,s[D+5],5,-701558691),v=X(v,c,g,u,s[D+10],9,38016083),u=X(u,v,c,g,s[D+15],14,-660478335),g=X(g,u,v,c,s[D+4],20,-405537848),c=X(c,g,u,v,s[D+9],5,568446438),v=X(v,c,g,u,s[D+14],9,-1019803690),u=X(u,v,c,g,s[D+3],14,-187363961),g=X(g,u,v,c,s[D+8],20,1163531501),c=X(c,g,u,v,s[D+13],5,-1444681467),v=X(v,c,g,u,s[D+2],9,-51403784),u=X(u,v,c,g,s[D+7],14,1735328473),c=W(c,g=X(g,u,v,c,s[D+12],20,-1926607734),u,v,s[D+5],4,-378558),v=W(v,c,g,u,s[D+8],11,-2022574463),u=W(u,v,c,g,s[D+11],16,1839030562),g=W(g,u,v,c,s[D+14],23,-35309556),c=W(c,g,u,v,s[D+1],4,-1530992060),v=W(v,c,g,u,s[D+4],11,1272893353),u=W(u,v,c,g,s[D+7],16,-155497632),g=W(g,u,v,c,s[D+10],23,-1094730640),c=W(c,g,u,v,s[D+13],4,681279174),v=W(v,c,g,u,s[D+0],11,-358537222),u=W(u,v,c,g,s[D+3],16,-722521979),g=W(g,u,v,c,s[D+6],23,76029189),c=W(c,g,u,v,s[D+9],4,-640364487),v=W(v,c,g,u,s[D+12],11,-421815835),u=W(u,v,c,g,s[D+15],16,530742520),c=r(c,g=W(g,u,v,c,s[D+2],23,-995338651),u,v,s[D+0],6,-198630844),v=r(v,c,g,u,s[D+7],10,1126891415),u=r(u,v,c,g,s[D+14],15,-1416354905),g=r(g,u,v,c,s[D+5],21,-57434055),c=r(c,g,u,v,s[D+12],6,1700485571),v=r(v,c,g,u,s[D+3],10,-1894986606),u=r(u,v,c,g,s[D+10],15,-1051523),g=r(g,u,v,c,s[D+1],21,-2054922799),c=r(c,g,u,v,s[D+8],6,1873313359),v=r(v,c,g,u,s[D+15],10,-30611744),u=r(u,v,c,g,s[D+6],15,-1560198380),g=r(g,u,v,c,s[D+13],21,1309151649),c=r(c,g,u,v,s[D+4],6,-145523070),v=r(v,c,g,u,s[D+11],10,-1120210379),u=r(u,v,c,g,s[D+2],15,718787259),g=r(g,u,v,c,s[D+9],21,-343485551),c=f(c,P),g=f(g,F),u=f(u,H),v=f(v,_)}return Array(c,g,u,v)}function A(s,d,c,g,u,v){return f((d=f(f(d,s),f(g,v)))<<u|d>>>32-u,c)}function V(s,d,c,g,u,v,D){return A(d&c|~d&g,s,d,u,v,D)}function X(s,d,c,g,u,v,D){return A(d&g|c&~g,s,d,u,v,D)}function W(s,d,c,g,u,v,D){return A(d^c^g,s,d,u,v,D)}function r(s,d,c,g,u,v,D){return A(c^(d|~g),s,d,u,v,D)}function f(s,d){var c=(65535&s)+(65535&d);return(s>>16)+(d>>16)+(c>>16)<<16|65535&c}n.exports=function(s){return O.hash(s,j,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){n.exports=function(O){for(var j,A=new Array(O),V=0;V<O;V++)!(3&V)&&(j=4294967296*Math.random()),A[V]=j>>>((3&V)<<3)&255;return A}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){var O=t("./helpers");function j(X,W){X[W>>5]|=128<<24-W%32,X[15+(W+64>>9<<4)]=W;for(var r,f,s,d=Array(80),c=1732584193,g=-271733879,u=-1732584194,v=271733878,D=-1009589776,P=0;P<X.length;P+=16){for(var F=c,H=g,_=u,U=v,ne=D,ie=0;ie<80;ie++){d[ie]=ie<16?X[P+ie]:V(d[ie-3]^d[ie-8]^d[ie-14]^d[ie-16],1);var oe=A(A(V(c,5),(oe=g,f=u,s=v,(r=ie)<20?oe&f|~oe&s:!(r<40)&&r<60?oe&f|oe&s|f&s:oe^f^s)),A(A(D,d[ie]),(r=ie)<20?1518500249:r<40?1859775393:r<60?-1894007588:-899497514)),D=v,v=u,u=V(g,30),g=c,c=oe}c=A(c,F),g=A(g,H),u=A(u,_),v=A(v,U),D=A(D,ne)}return Array(c,g,u,v,D)}function A(X,W){var r=(65535&X)+(65535&W);return(X>>16)+(W>>16)+(r>>16)<<16|65535&r}function V(X,W){return X<<W|X>>>32-W}n.exports=function(X){return O.hash(X,j,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){function O(W,r){var f=(65535&W)+(65535&r);return(W>>16)+(r>>16)+(f>>16)<<16|65535&f}function j(W,r){var f,s=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),d=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),c=new Array(64);W[r>>5]|=128<<24-r%32,W[15+(r+64>>9<<4)]=r;for(var g,u,v=0;v<W.length;v+=16){for(var D=d[0],P=d[1],F=d[2],H=d[3],_=d[4],U=d[5],ne=d[6],ie=d[7],oe=0;oe<64;oe++)c[oe]=oe<16?W[oe+v]:O(O(O((u=c[oe-2],V(u,17)^V(u,19)^X(u,10)),c[oe-7]),(u=c[oe-15],V(u,7)^V(u,18)^X(u,3))),c[oe-16]),f=O(O(O(O(ie,V(u=_,6)^V(u,11)^V(u,25)),_&U^~_&ne),s[oe]),c[oe]),g=O(V(g=D,2)^V(g,13)^V(g,22),D&P^D&F^P&F),ie=ne,ne=U,U=_,_=O(H,f),H=F,F=P,P=D,D=O(f,g);d[0]=O(D,d[0]),d[1]=O(P,d[1]),d[2]=O(F,d[2]),d[3]=O(H,d[3]),d[4]=O(_,d[4]),d[5]=O(U,d[5]),d[6]=O(ne,d[6]),d[7]=O(ie,d[7])}return d}var A=t("./helpers"),V=function(W,r){return W>>>r|W<<32-r},X=function(W,r){return W>>>r};n.exports=function(W){return A.hash(W,j,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){i.read=function(O,j,A,V,v){var W,r,f=8*v-V-1,s=(1<<f)-1,d=s>>1,c=-7,g=A?v-1:0,u=A?-1:1,v=O[j+g];for(g+=u,W=v&(1<<-c)-1,v>>=-c,c+=f;0<c;W=256*W+O[j+g],g+=u,c-=8);for(r=W&(1<<-c)-1,W>>=-c,c+=V;0<c;r=256*r+O[j+g],g+=u,c-=8);if(W===0)W=1-d;else{if(W===s)return r?NaN:1/0*(v?-1:1);r+=Math.pow(2,V),W-=d}return(v?-1:1)*r*Math.pow(2,W-V)},i.write=function(O,j,A,V,X,D){var r,f,s=8*D-X-1,d=(1<<s)-1,c=d>>1,g=X===23?Math.pow(2,-24)-Math.pow(2,-77):0,u=V?0:D-1,v=V?1:-1,D=j<0||j===0&&1/j<0?1:0;for(j=Math.abs(j),isNaN(j)||j===1/0?(f=isNaN(j)?1:0,r=d):(r=Math.floor(Math.log(j)/Math.LN2),j*(V=Math.pow(2,-r))<1&&(r--,V*=2),2<=(j+=1<=r+c?g/V:g*Math.pow(2,1-c))*V&&(r++,V/=2),d<=r+c?(f=0,r=d):1<=r+c?(f=(j*V-1)*Math.pow(2,X),r+=c):(f=j*Math.pow(2,c-1)*Math.pow(2,X),r=0));8<=X;O[A+u]=255&f,u+=v,f/=256,X-=8);for(r=r<<X|f,s+=X;0<s;O[A+u]=255&r,u+=v,r/=256,s-=8);O[A+u-v]|=128*D}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,i){(function(o,l,y,b,k,M,L,x,B){var O,j,A;function V(){}(o=n.exports={}).nextTick=(j=typeof window<"u"&&window.setImmediate,A=typeof window<"u"&&window.postMessage&&window.addEventListener,j?function(X){return window.setImmediate(X)}:A?(O=[],window.addEventListener("message",function(X){var W=X.source;W!==window&&W!==null||X.data!=="process-tick"||(X.stopPropagation(),0<O.length&&O.shift()())},!0),function(X){O.push(X),window.postMessage("process-tick","*")}):function(X){setTimeout(X,0)}),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=V,o.addListener=V,o.once=V,o.off=V,o.removeListener=V,o.removeAllListeners=V,o.emit=V,o.binding=function(X){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(X){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(ma);var Ro=ma.exports;const Wt=zn(Ro);class xo{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Wt(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Wt(e):String(e)]}getValue(e){return this.cache[this.useHash?Wt(e):String(e)]}isCached(e){return(this.useHash?Wt(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Bo(){return new Worker("/assets/worker-b3cb1e7d.js",{type:"module"})}class Se{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENELOCAL="SCENELOCAL";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static SCENEFOG="SCENEFOG";static ROOMMETA="ROOMMETADATA";playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;fogFilled;fogColor;fogStroke;gridDpi;gridScale;gridSnap;gridType;storedMetaItems;baseMELDepth;sceneItems;sceneLocal;sceneSelected;sceneMetadata;sceneReady;sceneInitialized;roomMetadata;theme;caches;playerShadowCache;localGhosts;snap;torchActive;previousVisionShapes;previousAutohideItems;previousPlayersWithVision;previousSize=[];previousVisionEnabled;previousMap;previousAutodetectEnabled;previousFowEnabled;previousPersistenceEnabled;previousFowColor;busy;workers;workersSetup;toolStarted;sceneMetadataHandler;sceneItemsHandler;sceneLocalHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;fogHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.fogFilled=!1,this.fogColor="#000",this.fogStroke=5,this.storedMetaItems=[],this.sceneItems=[],this.sceneLocal=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.gridSnap=10,this.gridType="ft",this.sceneReady=!1,this.sceneInitialized=!1,this.theme="DARK",this.roomMetadata={},this.localGhosts=[],this.snap=!1,this.busy=!1,this.torchActive=!1,this.toolStarted=!1,this.baseMELDepth=0,this.caches=e,this.playerShadowCache=new xo(!1),this.previousVisionShapes="",this.previousAutohideItems="",this.previousPlayersWithVision="",this.previousSize=[],this.previousVisionEnabled=!1,this.previousMap="",this.previousAutodetectEnabled=!1,this.previousFowEnabled=!1,this.previousPersistenceEnabled=!1,this.previousFowColor="",this.workers=[],this.workersSetup=!1}async RefreshCache(){if(this.caches.includes(Se.PLAYER)&&(this.playerId=await C.player.getId(),this.playerName=await C.player.getName(),this.playerColor=await C.player.getColor(),this.playerMetadata=await C.player.getMetadata(),this.playerRole=await C.player.getRole()),this.caches.includes(Se.PARTY)&&(this.party=await C.party.getPlayers()),this.caches.includes(Se.SCENEFOG)&&this.sceneReady&&(this.fogColor=await C.scene.fog.getColor(),this.fogFilled=await C.scene.fog.getFilled()),this.caches.includes(Se.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await C.scene.items.getItems(),this.sceneLocal=await C.scene.local.getItems()),this.caches.includes(Se.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await C.scene.getMetadata();const e=this.sceneMetadata[`${h.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e)}if(this.caches.includes(Se.SCENEGRID)&&this.sceneReady){this.gridDpi=await C.scene.grid.getDpi();const e=await C.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(Se.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await C.room.getMetadata())}async InitializeCache(){if(this.CreateWorkers(),this.sceneReady=await C.scene.isReady(),this.theme=await C.theme.getTheme(),_r(this.theme,document),this.caches.includes(Se.PLAYER)&&(this.playerId=await C.player.getId(),this.playerName=await C.player.getName(),this.playerColor=await C.player.getColor(),this.playerMetadata=await C.player.getMetadata(),this.playerRole=await C.player.getRole()),this.caches.includes(Se.PARTY)&&(this.party=await C.party.getPlayers()),this.caches.includes(Se.SCENEFOG)&&this.sceneReady&&(this.fogColor=await C.scene.fog.getColor(),this.fogFilled=await C.scene.fog.getFilled()),this.caches.includes(Se.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await C.scene.items.getItems(),this.sceneLocal=await C.scene.local.getItems()),this.caches.includes(Se.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await C.scene.getMetadata();const e=this.sceneMetadata[`${h.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e)}if(this.caches.includes(Se.SCENEGRID)&&this.sceneReady){this.gridDpi=await C.scene.grid.getDpi();const e=await C.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(Se.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await C.room.getMetadata()),C.broadcast.onMessage(h.RESETID,async e=>{e.data&&await te.ResetPersistence()}),C.broadcast.onMessage(`${h.EXTENSIONID}/ELEVATIONEVENT`,e=>{switch(e.data){case"CANCEL":Jn();break;case"FINISH":la();break;case"UNDO":fa();break}}),C.broadcast.onMessage(`${h.EXTENSIONID}/LINEEVENT`,e=>{switch(e.data){case"CANCEL":Fn();break;case"FINISH":jn();break;case"UNDO":ia();break}}),C.broadcast.onMessage(`${h.EXTENSIONID}/POLYGONEVENT`,e=>{switch(e.data){case"CANCEL":Vn();break;case"FINISH":Hn();break;case"UNDO":sa();break}}),await this.SaveUserToScene()}CreateWorkers(){const t=Math.min(navigator.hardwareConcurrency??1,16);for(let n=0;n<t;n++){const i=new Bo;this.workers.push(i)}}async SaveUserToScene(){await C.scene.setMetadata({[`${h.EXTENSIONID}/USER-${this.playerId}`]:{role:this.playerRole,name:this.playerName,color:this.playerColor}})}KillHandlers(){this.caches.includes(Se.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(Se.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(Se.SCENEITEMS)&&this.sceneLocalHandler!==void 0&&this.sceneLocalHandler(),this.caches.includes(Se.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(Se.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(Se.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(Se.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.caches.includes(Se.SCENEFOG)&&this.fogHandler!==void 0&&this.fogHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(Se.SCENEMETA)&&(this.sceneMetadataHandler=C.scene.onMetadataChange(async e=>{this.sceneMetadata=e,await this.OnSceneMetadataChanges(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(Se.SCENEITEMS)&&(this.sceneItemsHandler=C.scene.items.onChange(async e=>{this.sceneItems=e,await this.OnSceneItemsChange(e)}),this.sceneLocalHandler=C.scene.local.onChange(async e=>{this.sceneLocal=e,await this.OnSceneLocalChange(e)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(Se.SCENEGRID)&&(this.sceneGridHandler=C.scene.grid.onChange(async e=>{await this.OnSceneGridChange(e),this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(Se.PLAYER)&&(this.playerHandler=C.player.onChange(async e=>{const t=this.playerRole;let n=!1;(this.playerName!==e.name||this.playerColor!==e.color||this.playerRole!==e.role)&&(n=!0),this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e,t),n&&await this.SaveUserToScene()})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(Se.PARTY)&&(this.partyHandler=C.party.onChange(async e=>{this.party=e.filter(t=>t.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(Se.ROOMMETA)&&(this.roomHandler=C.room.onMetadataChange(async e=>{await this.OnRoomMetadataChange(e),this.roomMetadata=e})),(this.fogHandler===void 0||this.fogHandler.length===0)&&this.caches.includes(Se.ROOMMETA)&&(this.fogHandler=C.scene.fog.onChange(async e=>{await this.OnFogChange(e),this.fogColor=e.style.color,this.fogFilled=e.filled})),this.themeHandler===void 0&&(this.themeHandler=C.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=C.scene.onReadyChange(async e=>{this.sceneReady=e,e?(await this.SaveUserToScene(),await this.RefreshCache()):(lt.ClearGhostList(),this.KillHandlers(),this.toolStarted=!1,await C.tool.setMetadata(`${h.EXTENSIONID}/vision-tool`,{[`${h.EXTENSIONID}/elevationEditor`]:!1}),this.sceneItems=[],this.sceneMetadata={}),await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){this.baseMELDepth=e[`${h.EXTENSIONID}/defaultMELDepth`]??0,this.playerRole==="GM"&&await $n(),await _t()}async OnSceneItemsChange(e){this.playerRole==="GM"?(await te.UpdateUI(),await Ln(te.mapAlign)):te.UpdatePlayerVisionList(),await _t()}async OnSceneLocalChange(e){lt.debouncedLocalChanges(I.sceneLocal)}async OnSceneGridChange(e){await _t()}async OnSceneReadyChange(e){e?(await Xn(),this.SetupHandlers(),await _t(),this.playerRole==="GM"&&await $n()):this.playerRole==="GM"&&(this.sceneInitialized=!1,await te.UpdateUI())}async OnPlayerChange(e,t){this.playerRole!==t&&(await te.SoftReset(),e.role==="GM"?(await C.action.setHeight(510),await C.action.setWidth(420)):te.UpdatePlayerVisionList());const n=document.querySelectorAll(".token-table-entry");for(let k of n){let M=k.id.substring(3);e.selection!==void 0&&e.selection.includes(M)?k.classList.add("token-table-selected"):k.classList.remove("token-table-selected")}e.selection!==void 0&&e.selection.length===1&&Ja(e.selection[0]);const i=e.metadata;(i[`${h.EXTENSIONID}/finishLine`]??!1)===!0&&jn(),(i[`${h.EXTENSIONID}/cancelLine`]??!1)===!0&&Fn(),(i[`${h.EXTENSIONID}/finishPoly`]??!1)===!0&&Hn(),(i[`${h.EXTENSIONID}/cancelPoly`]??!1)===!0&&Vn()}async OnPartyChange(e){if(this.playerRole!=="PLAYER"){const t=document.getElementById("playerListing");t.innerHTML="",t.appendChild(te.GetEmptyContextItem());for(const n of this.party){const i=document.createElement("li");i.id=n.id,i.textContent=n.name,i.style.color=n.color,t.appendChild(i)}lt.UpdateSpectreTargets(),te.UpdatePlayerProcessUI()}}async OnFogChange(e){}async OnRoomMetadataChange(e){}async OnThemeChange(e){_r(e,document)}async ToggleBusy(e){await C.action.setBadgeText(e?"⏱️":void 0),I.busy=e}}const I=new Se([Se.SCENEITEMS,Se.SCENEMETA,Se.SCENEFOG,Se.SCENEGRID,Se.PLAYER,Se.PARTY]);function ga(a){return a.layer=="MAP"&&(a.metadata[`${h.EXTENSIONID}/isBackgroundImage`]||a.metadata[`${h.ARMINDOID}/isBackgroundImage`])}function Pt(a){return a.metadata[`${h.EXTENSIONID}/isVisionFog`]||a.metadata[`${h.ARMINDOID}/isVisionFog`]}function Xo(a){return a.metadata[`${h.EXTENSIONID}/isIndicatorRing`]||a.metadata[`${h.ARMINDOID}/isIndicatorRing`]}function Rr(a){return a.metadata[`${h.EXTENSIONID}/isVisionLine`]||a.metadata[`${h.ARMINDOID}/isVisionLine`]}function Fo(a){return a.metadata[`${h.EXTENSIONID}/isVisionLine`]&&!a.metadata[`${h.EXTENSIONID}/disabled`]||a.metadata[`${h.ARMINDOID}/isVisionLine`]&&!a.metadata[`${h.ARMINDOID}/disabled`]}function ya(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&(a.metadata[`${h.EXTENSIONID}/hasVision`]||a.metadata[`${h.ARMINDOID}/hasVision`])}function xr(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&(a.metadata[`${h.EXTENSIONID}/hasVision`]||a.metadata[`${h.ARMINDOID}/hasVision`])&&!a.metadata[`${h.EXTENSIONID}/visionBlind`]}function jo(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&a.createdUserId==I.playerId&&(a.metadata[`${h.EXTENSIONID}/hasVision`]||a.metadata[`${h.ARMINDOID}/hasVision`])&&!a.metadata[`${h.EXTENSIONID}/visionBlind`]}function Qn(a){return a.layer==="FOG"&&(a.metadata[`${h.EXTENSIONID}/isBackgroundImage`]||a.metadata[`${h.ARMINDOID}/isBackgroundImage`])}function Jt(a){return a.metadata[`${h.EXTENSIONID}/isTrailingFog`]}function Un(a){return a.metadata[`${h.EXTENSIONID}/isTrailingFog`]||a.metadata[`${h.EXTENSIONID}/isVisionFog`]||a.metadata[`${h.ARMINDOID}/isVisionFog`]||a.metadata[`${h.EXTENSIONID}/isIndicatorRing`]}function Vo(a){return a.metadata[`${h.EXTENSIONID}/isBrushSquare`]}function It(a){return a.metadata[`${h.EXTENSIONID}/visionTorch`]}function Br(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&!ya(a)&&a.metadata[`${h.EXTENSIONID}/hasAutohide`]===!0}var at=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(a,e,t,n){var i=e.createElement("canvas").getContext("2d"),o={r:0,g:0,b:0,h:0,s:0,v:0,a:1},l,y,b,k,M,L,x,B,O,j,A,V,X,W,r,f,s={},d={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},c={},g="",u={},v=!1;function D(N){if(typeof N=="object"){var G=function(){switch(ee){case"el":U(N.el),N.wrap!==!1&&ie(N.el);break;case"parent":l=e.querySelector(N.parent),l&&(l.appendChild(y),d.parent=N.parent,l===e.body&&(l=n));break;case"themeMode":d.themeMode=N.themeMode,N.themeMode==="auto"&&a.matchMedia&&a.matchMedia("(prefers-color-scheme: dark)").matches&&(d.themeMode="dark");case"theme":N.theme&&(d.theme=N.theme),y.className="clr-picker clr-"+d.theme+" clr-"+d.themeMode,d.inline&&ne();break;case"rtl":d.rtl=!!N.rtl,e.querySelectorAll(".clr-field").forEach(function(He){return He.classList.toggle("clr-rtl",d.rtl)});break;case"margin":N.margin*=1,d.margin=isNaN(N.margin)?d.margin:N.margin;break;case"wrap":N.el&&N.wrap&&ie(N.el);break;case"formatToggle":d.formatToggle=!!N.formatToggle,_e("clr-format").style.display=d.formatToggle?"block":"none",d.formatToggle&&(d.format="auto");break;case"swatches":if(Array.isArray(N.swatches)){var we=[];N.swatches.forEach(function(He,Ne){we.push('<button type="button" id="clr-swatch-'+Ne+'" aria-labelledby="clr-swatch-label clr-swatch-'+Ne+'" style="color: '+He+';">'+He+"</button>")}),_e("clr-swatches").innerHTML=we.length?"<div>"+we.join("")+"</div>":"",d.swatches=N.swatches.slice()}break;case"swatchesOnly":d.swatchesOnly=!!N.swatchesOnly,y.setAttribute("data-minimal",d.swatchesOnly);break;case"alpha":d.alpha=!!N.alpha,y.setAttribute("data-alpha",d.alpha);break;case"inline":if(d.inline=!!N.inline,y.setAttribute("data-inline",d.inline),d.inline){var ve=N.defaultColor||d.defaultColor;W=fe(ve),ne(),Z(ve)}break;case"clearButton":typeof N.clearButton=="object"&&(N.clearButton.label&&(d.clearLabel=N.clearButton.label,x.innerHTML=d.clearLabel),N.clearButton=N.clearButton.show),d.clearButton=!!N.clearButton,x.style.display=d.clearButton?"block":"none";break;case"clearLabel":d.clearLabel=N.clearLabel,x.innerHTML=d.clearLabel;break;case"closeButton":d.closeButton=!!N.closeButton,d.closeButton?y.insertBefore(B,M):M.appendChild(B);break;case"closeLabel":d.closeLabel=N.closeLabel,B.innerHTML=d.closeLabel;break;case"a11y":var Ee=N.a11y,De=!1;if(typeof Ee=="object")for(var Ie in Ee)Ee[Ie]&&d.a11y[Ie]&&(d.a11y[Ie]=Ee[Ie],De=!0);if(De){var Ve=_e("clr-open-label"),Me=_e("clr-swatch-label");Ve.innerHTML=d.a11y.open,Me.innerHTML=d.a11y.swatch,B.setAttribute("aria-label",d.a11y.close),x.setAttribute("aria-label",d.a11y.clear),O.setAttribute("aria-label",d.a11y.hueSlider),A.setAttribute("aria-label",d.a11y.alphaSlider),L.setAttribute("aria-label",d.a11y.input),b.setAttribute("aria-label",d.a11y.instruction)}break;default:d[ee]=N[ee]}};for(var ee in N)G()}}function P(N,G){typeof N=="string"&&typeof G=="object"&&(c[N]=G,v=!0)}function F(N){delete c[N],Object.keys(c).length===0&&(v=!1,N===g&&_())}function H(N){if(v){var G=["el","wrap","rtl","inline","defaultColor","a11y"],ee=function(){var Ee=c[de];if(N.matches(de)){g=de,u={},G.forEach(function(Ie){return delete Ee[Ie]});for(var De in Ee)u[De]=Array.isArray(d[De])?d[De].slice():d[De];return D(Ee),"break"}};for(var de in c){var we=ee();if(we==="break")break}}}function _(){Object.keys(u).length>0&&(D(u),g="",u={})}function U(N){Te(e,"click",N,function(G){d.inline||(H(G.target),X=G.target,r=X.value,W=fe(r),y.classList.add("clr-open"),ne(),Z(r),(d.focusInput||d.selectInput)&&(L.focus({preventScroll:!0}),L.setSelectionRange(X.selectionStart,X.selectionEnd)),d.selectInput&&L.select(),(f||d.swatchesOnly)&&Ce().shift().focus(),X.dispatchEvent(new Event("open",{bubbles:!0})))}),Te(e,"input",N,function(G){var ee=G.target.parentNode;ee.classList.contains("clr-field")&&(ee.style.color=G.target.value)})}function ne(){if(!(!y||!X&&!d.inline)){var N=l,G=a.scrollY,ee=y.offsetWidth,de=y.offsetHeight,we={left:!1,top:!1},ve,Ee,De,Ie={x:0,y:0};if(N&&(ve=a.getComputedStyle(N),Ee=parseFloat(ve.marginTop),De=parseFloat(ve.borderTopWidth),Ie=N.getBoundingClientRect(),Ie.y+=De+G),!d.inline){var Ve=X.getBoundingClientRect(),Me=Ve.x,He=G+Ve.y+Ve.height+d.margin;N?(Me-=Ie.x,He-=Ie.y,Me+ee>N.clientWidth&&(Me+=Ve.width-ee,we.left=!0),He+de>N.clientHeight-Ee&&de+d.margin<=Ve.top-(Ie.y-G)&&(He-=Ve.height+de+d.margin*2,we.top=!0),He+=N.scrollTop):(Me+ee>e.documentElement.clientWidth&&(Me+=Ve.width-ee,we.left=!0),He+de-G>e.documentElement.clientHeight&&de+d.margin<=Ve.top&&(He=G+Ve.y-de-d.margin,we.top=!0)),y.classList.toggle("clr-left",we.left),y.classList.toggle("clr-top",we.top),y.style.left=Me+"px",y.style.top=He+"px",Ie.x+=y.offsetLeft,Ie.y+=y.offsetTop}s={width:b.offsetWidth,height:b.offsetHeight,x:b.offsetLeft+Ie.x,y:b.offsetTop+Ie.y}}}function ie(N){e.querySelectorAll(N).forEach(function(G){var ee=G.parentNode;if(!ee.classList.contains("clr-field")){var de=e.createElement("div"),we="clr-field";(d.rtl||G.classList.contains("clr-rtl"))&&(we+=" clr-rtl"),de.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',ee.insertBefore(de,G),de.setAttribute("class",we),de.style.color=G.value,de.appendChild(G)}})}function oe(N){if(X&&!d.inline){var G=X;N&&(X=n,r!==G.value&&(G.value=r,G.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){r!==G.value&&G.dispatchEvent(new Event("change",{bubbles:!0}))}),y.classList.remove("clr-open"),v&&_(),G.dispatchEvent(new Event("close",{bubbles:!0})),d.focusInput&&G.focus({preventScroll:!0}),X=n}}function Z(N){var G=Oe(N),ee=ye(G);he(ee.s,ee.v),S(G,ee),O.value=ee.h,y.style.color="hsl("+ee.h+", 100%, 50%)",j.style.left=ee.h/360*100+"%",k.style.left=s.width*ee.s/100+"px",k.style.top=s.height-s.height*ee.v/100+"px",A.value=ee.a*100,V.style.left=ee.a*100+"%"}function fe(N){var G=N.substring(0,3).toLowerCase();return G==="rgb"||G==="hsl"?G:"hex"}function le(N){N=N!==n?N:L.value,X&&(X.value=N,X.dispatchEvent(new Event("input",{bubbles:!0}))),d.onChange&&d.onChange.call(a,N,X),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:N,currentEl:X}}))}function be(N,G){var ee={h:O.value*1,s:N/s.width*100,v:100-G/s.height*100,a:A.value/100},de=J(ee);he(ee.s,ee.v),S(de,ee),le()}function he(N,G){var ee=d.a11y.marker;N=N.toFixed(1)*1,G=G.toFixed(1)*1,ee=ee.replace("{s}",N),ee=ee.replace("{v}",G),k.setAttribute("aria-label",ee)}function pe(N){return{pageX:N.changedTouches?N.changedTouches[0].pageX:N.pageX,pageY:N.changedTouches?N.changedTouches[0].pageY:N.pageY}}function me(N){var G=pe(N),ee=G.pageX-s.x,de=G.pageY-s.y;l&&(de+=l.scrollTop),w(ee,de),N.preventDefault(),N.stopPropagation()}function Y(N,G){var ee=k.style.left.replace("px","")*1+N,de=k.style.top.replace("px","")*1+G;w(ee,de)}function w(N,G){N=N<0?0:N>s.width?s.width:N,G=G<0?0:G>s.height?s.height:G,k.style.left=N+"px",k.style.top=G+"px",be(N,G),k.focus()}function S(N,G){N===void 0&&(N={}),G===void 0&&(G={});var ee=d.format;for(var de in N)o[de]=N[de];for(var we in G)o[we]=G[we];var ve=ke(o),Ee=ve.substring(0,7);switch(k.style.color=Ee,V.parentNode.style.color=Ee,V.style.color=ve,M.style.color=ve,b.style.display="none",b.offsetHeight,b.style.display="",V.nextElementSibling.style.display="none",V.nextElementSibling.offsetHeight,V.nextElementSibling.style.display="",ee==="mixed"?ee=o.a===1?"hex":"rgb":ee==="auto"&&(ee=W),ee){case"hex":L.value=ve;break;case"rgb":L.value=Be(o);break;case"hsl":L.value=je(q(o));break}e.querySelector('.clr-format [value="'+ee+'"]').checked=!0}function $(){var N=O.value*1,G=k.style.left.replace("px","")*1,ee=k.style.top.replace("px","")*1;y.style.color="hsl("+N+", 100%, 50%)",j.style.left=N/360*100+"%",be(G,ee)}function K(){var N=A.value/100;V.style.left=N*100+"%",S({a:N}),le()}function J(N){var G=N.s/100,ee=N.v/100,de=G*ee,we=N.h/60,ve=de*(1-t.abs(we%2-1)),Ee=ee-de;de=de+Ee,ve=ve+Ee;var De=t.floor(we)%6,Ie=[de,ve,Ee,Ee,ve,de][De],Ve=[ve,de,de,ve,Ee,Ee][De],Me=[Ee,Ee,ve,de,de,ve][De];return{r:t.round(Ie*255),g:t.round(Ve*255),b:t.round(Me*255),a:N.a}}function q(N){var G=N.v/100,ee=G*(1-N.s/100/2),de;return ee>0&&ee<1&&(de=t.round((G-ee)/t.min(ee,1-ee)*100)),{h:N.h,s:de||0,l:t.round(ee*100),a:N.a}}function ye(N){var G=N.r/255,ee=N.g/255,de=N.b/255,we=t.max(G,ee,de),ve=t.min(G,ee,de),Ee=we-ve,De=we,Ie=0,Ve=0;return Ee&&(we===G&&(Ie=(ee-de)/Ee),we===ee&&(Ie=2+(de-G)/Ee),we===de&&(Ie=4+(G-ee)/Ee),we&&(Ve=Ee/we)),Ie=t.floor(Ie*60),{h:Ie<0?Ie+360:Ie,s:t.round(Ve*100),v:t.round(De*100),a:N.a}}function Oe(N){var G=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,ee,de;return i.fillStyle="#000",i.fillStyle=N,ee=G.exec(i.fillStyle),ee?(de={r:ee[3]*1,g:ee[4]*1,b:ee[5]*1,a:ee[6]*1},de.a=+de.a.toFixed(2)):(ee=i.fillStyle.replace("#","").match(/.{2}/g).map(function(we){return parseInt(we,16)}),de={r:ee[0],g:ee[1],b:ee[2],a:1}),de}function ke(N){var G=N.r.toString(16),ee=N.g.toString(16),de=N.b.toString(16),we="";if(N.r<16&&(G="0"+G),N.g<16&&(ee="0"+ee),N.b<16&&(de="0"+de),d.alpha&&(N.a<1||d.forceAlpha)){var ve=N.a*255|0;we=ve.toString(16),ve<16&&(we="0"+we)}return"#"+G+ee+de+we}function Be(N){return!d.alpha||N.a===1&&!d.forceAlpha?"rgb("+N.r+", "+N.g+", "+N.b+")":"rgba("+N.r+", "+N.g+", "+N.b+", "+N.a+")"}function je(N){return!d.alpha||N.a===1&&!d.forceAlpha?"hsl("+N.h+", "+N.s+"%, "+N.l+"%)":"hsla("+N.h+", "+N.s+"%, "+N.l+"%, "+N.a+")"}function Fe(){e.getElementById("clr-picker")||(l=n,y=e.createElement("div"),y.setAttribute("id","clr-picker"),y.className="clr-picker",y.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+d.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+d.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+d.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+d.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+d.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+d.a11y.clear+'">'+d.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+d.a11y.close+'">'+d.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+d.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+d.a11y.swatch+"</span>"),e.body.appendChild(y),b=_e("clr-color-area"),k=_e("clr-color-marker"),x=_e("clr-clear"),B=_e("clr-close"),M=_e("clr-color-preview"),L=_e("clr-color-value"),O=_e("clr-hue-slider"),j=_e("clr-hue-marker"),A=_e("clr-alpha-slider"),V=_e("clr-alpha-marker"),U(d.el),ie(d.el),Te(y,"mousedown",function(N){y.classList.remove("clr-keyboard-nav"),N.stopPropagation()}),Te(b,"mousedown",function(N){Te(e,"mousemove",me)}),Te(b,"touchstart",function(N){e.addEventListener("touchmove",me,{passive:!1})}),Te(k,"mousedown",function(N){Te(e,"mousemove",me)}),Te(k,"touchstart",function(N){e.addEventListener("touchmove",me,{passive:!1})}),Te(L,"change",function(N){var G=L.value;if(X||d.inline){var ee=G===""?G:Z(G);le(ee)}}),Te(x,"click",function(N){le(""),oe()}),Te(B,"click",function(N){le(),oe()}),Te(_e("clr-format"),"click",".clr-format input",function(N){W=N.target.value,S(),le()}),Te(y,"click",".clr-swatches button",function(N){Z(N.target.textContent),le(),d.swatchesOnly&&oe()}),Te(e,"mouseup",function(N){e.removeEventListener("mousemove",me)}),Te(e,"touchend",function(N){e.removeEventListener("touchmove",me)}),Te(e,"mousedown",function(N){f=!1,y.classList.remove("clr-keyboard-nav"),oe()}),Te(e,"keydown",function(N){var G=N.key,ee=N.target,de=N.shiftKey,we=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(G==="Escape"?oe(!0):we.includes(G)&&(f=!0,y.classList.add("clr-keyboard-nav")),G==="Tab"&&ee.matches(".clr-picker *")){var ve=Ce(),Ee=ve.shift(),De=ve.pop();de&&ee===Ee?(De.focus(),N.preventDefault()):!de&&ee===De&&(Ee.focus(),N.preventDefault())}}),Te(e,"click",".clr-field button",function(N){v&&_(),N.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),Te(k,"keydown",function(N){var G={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(G).includes(N.key)&&(Y.apply(void 0,G[N.key]),N.preventDefault())}),Te(b,"click",me),Te(O,"input",$),Te(A,"input",K))}function Ce(){var N=Array.from(y.querySelectorAll("input, button")),G=N.filter(function(ee){return!!ee.offsetWidth});return G}function _e(N){return e.getElementById(N)}function Te(N,G,ee,de){var we=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof ee=="string"?N.addEventListener(G,function(ve){we.call(ve.target,ee)&&de.call(ve.target,ve)}):(de=ee,N.addEventListener(G,de))}function qe(N,G){G=G!==n?G:[],e.readyState!=="loading"?N.apply(void 0,G):e.addEventListener("DOMContentLoaded",function(){N.apply(void 0,G)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function st(N,G){X=G,r=X.value,H(G),W=fe(N),ne(),Z(N),le(),r!==N&&X.dispatchEvent(new Event("change",{bubbles:!0}))}var se=function(){var N={init:Fe,set:D,wrap:ie,close:oe,setInstance:P,setColor:st,removeInstance:F,updatePosition:ne};function G(we){qe(function(){we&&(typeof we=="string"?U(we):D(we))})}var ee=function(ve){G[ve]=function(){for(var Ee=arguments.length,De=new Array(Ee),Ie=0;Ie<Ee;Ie++)De[Ie]=arguments[Ie];qe(N[ve],De)}};for(var de in N)ee(de);return qe(function(){a.addEventListener("resize",function(we){G.updatePosition()}),a.addEventListener("scroll",function(we){G.updatePosition()})}),G}();return se.coloris=se,se}(window,document,Math)}();at.coloris;at.init;at.set;at.wrap;at.close;at.setInstance;at.removeInstance;at.updatePosition;function Ho(){te.smokeViewToggle.onclick=e=>{e.preventDefault(),a(te.smokeViewToggle,te.smokeViewPanel)},te.spectreViewToggle.onclick=e=>{e.preventDefault(),a(te.spectreViewToggle,te.spectreViewPanel)},te.settingsViewToggle.onclick=e=>{e.preventDefault(),a(te.settingsViewToggle,te.settingsViewPanel)},te.debugViewToggle.onclick=e=>{e.preventDefault(),a(te.debugViewToggle,te.debugViewPanel)},te.helpViewToggle.onclick=e=>{e.preventDefault(),a(te.helpViewToggle,te.helpViewPanel)};function a(e,t){te.smokeViewToggle?.classList.remove("selected"),te.spectreViewToggle?.classList.remove("selected"),te.settingsViewToggle?.classList.remove("selected"),te.debugViewToggle?.classList.remove("selected"),te.helpViewToggle?.classList.remove("selected"),te.smokeViewPanel.style.display="none",te.spectreViewPanel.style.display="none",te.settingsViewPanel.style.display="none",te.debugViewPanel.style.display="none",te.helpViewPanel.style.display="none",e.classList.add("selected"),t.style.display="block"}}function Xr(){te.processedIndicator.onclick=async()=>{await C.popover.open({id:h.PROCESSEDID,url:"/pages/processed.html",height:300,width:320,disableClickAway:!1})},te.hiddenListToggle.onclick=async i=>{te.hiddenTable.style.display==="none"?(te.hiddenTable&&(te.hiddenTable.style.display="table-row-group"),te.hiddenListToggle&&(te.hiddenListToggle.value="Out-of-Sight List: Click to Hide")):(te.hiddenTable&&(te.hiddenTable.style.display="none"),te.hiddenListToggle&&(te.hiddenListToggle.value="Out-of-Sight List: Click to Show"))},te.visionCheckbox.onclick=async i=>{if(!I.sceneReady){i.preventDefault();return}const o=i.target;if(await C.scene.setMetadata({[`${h.EXTENSIONID}/visionEnabled`]:o.checked}),I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]===!0)await C.scene.fog.setFilled(o.checked);else{await C.scene.fog.setFilled(!1);const l=I.sceneItems.filter(Qn);await C.scene.items.updateItems(l,y=>{for(let b of y)o.checked?b.style.fillOpacity=1:b.style.fillOpacity=0})}},te.snapCheckbox.checked=!0,te.snapCheckbox.onclick=async i=>{if(!I.sceneReady){i.preventDefault();return}const o=i.target;I.snap=o.checked},te.persistenceCheckbox.onclick=async i=>{if(!i||!i.target)return;const o=i.target;await C.scene.setMetadata({[`${h.EXTENSIONID}/persistenceEnabled`]:o.checked})},te.autodetectCheckbox.onclick=async i=>{if(!i||!i.target)return;const o=i.target;te.boundryOptions.style.display=o.checked?"none":"",await C.scene.setMetadata({[`${h.EXTENSIONID}/autodetectEnabled`]:o.checked})},te.fowCheckbox.onclick=async i=>{if(!i||!i.target)return;const o=i.target;await tn(o.checked),await C.scene.setMetadata({[`${h.EXTENSIONID}/fowEnabled`]:o.checked})},te.doorCheckbox.onclick=async i=>{if(!i||!i.target)return;const o=i.target;await C.scene.setMetadata({[`${h.EXTENSIONID}/playerDoors`]:o.checked})},te.resetButton.onclick=async i=>{!i||!i.target||C.broadcast.sendMessage(h.RESETID,!0,{destination:"ALL"})},te.unlockFogButton.onclick=async i=>{if(!i||!i.target)return;const o=I.sceneItems.filter(l=>Rr(l));await I.ToggleBusy(!0);for(let l=0;l<o.length;l+=64){const y=o.slice(l,l+64);await C.scene.items.updateItems(y,b=>{for(let k of b)k.locked=!1})}await I.ToggleBusy(!1)},te.lockFogButton.onclick=async i=>{if(!i||!i.target)return;const o=I.sceneItems.filter(l=>Rr(l));await I.ToggleBusy(!0);for(let l=0;l<o.length;l+=64){const y=o.slice(l,l+64);await C.scene.items.updateItems(y,b=>{for(let k of b)k.locked=!0})}await I.ToggleBusy(!1)},te.backgroundButton.onclick=async i=>{!i||!i.target||(i.target,await C.scene.items.updateItems(o=>o.layer=="FOG"&&o.metadata[`${h.EXTENSIONID}/isBackgroundMap`]===!0,o=>{for(let l=0;l<o.length;l++)o[l].layer="MAP",o[l].disableHit=!1,o[l].locked=!1,o[l].visible=!0,delete o[l].metadata[`${h.EXTENSIONID}/isBackgroundMap`]}))};let a;te.fowColor.onclick=()=>{at({el:`#${te.fowColor.id}`,alpha:!0,forceAlpha:!0})},te.fowColor.oninput=async i=>{if(!i||!i.target)return;const o=i.target;clearTimeout(a),a=setTimeout(async()=>{if(/#[a-f0-9]{8}/.test(o.value)){await C.scene.setMetadata({[`${h.EXTENSIONID}/fowColor`]:o.value});const y=await C.scene.local.getItems(Jt);await C.scene.local.deleteItems(y.map(b=>b.id))}},500)},te.convertButton.onclick=async i=>{if(!(!i||!i.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){for(const o in I.sceneMetadata)o.substring(0,o.indexOf("/"))==h.ARMINDOID&&await C.scene.setMetadata({[`${o}`]:void 0});await C.scene.items.updateItems(I.sceneItems,o=>{for(const l of o)l.metadata[`${h.ARMINDOID}/isVisionLine`]!==void 0&&(l.metadata[`${h.EXTENSIONID}/isVisionLine`]=l.metadata[`${h.ARMINDOID}/isVisionLine`],delete l.metadata[`${h.ARMINDOID}/isVisionLine`]),l.metadata[`${h.ARMINDOID}/disabled`]!==void 0&&(l.metadata[`${h.EXTENSIONID}/disabled`]=l.metadata[`${h.ARMINDOID}/disabled`],delete l.metadata[`${h.ARMINDOID}/disabled`])})}};var e;te.importFile.onchange=i=>{if(te.importButton.disabled=!0,!i||!i.target)return;const o=i.target;if(!o.files)return;const l=o.files[0];if(l.type!=="text/javascript"&&l.type,l){var y=new FileReader;y.onload=function(b){if(!b||!b.target){te.importErrors.innerText="Invalid import event";return}const k=b.target;if(!k.result){te.importErrors.innerText="Unable to read imported file";return}const M=k.result;e=JSON.parse(M),e&&(e.walls&&e.walls.length||e.line_of_sight&&e.line_of_sight.length||e.objects_line_of_sight&&e.objects_line_of_sight.length)?te.importButton.disabled=!1:te.importErrors.innerText="Imported file has no walls"},y.readAsText(l)}else te.importErrors.innerText="Failed to load file"},te.dpiAutodetect.onclick=async i=>{!i||!i.target||(te.importDpi.disabled=te.dpiAutodetect.checked)},te.importButton.onclick=async i=>{!i||!i.target||(await I.ToggleBusy(!0),te.importFormat.value==="scene"?await ai(e,te.importErrors):await ni(te.importFormat.value,e,te.dpiAutodetect.checked?0:Number.parseInt(te.importDpi.value),te.mapAlign.value,te.importErrors),await I.ToggleBusy(!1))},te.toolColor.onclick=async i=>{at({el:`#${te.toolColor.id}`,alpha:!1,forceAlpha:!1})},te.toolColor.oninput=async i=>{if(!i||!i.target)return;const o=i.target;clearTimeout(a),a=setTimeout(async()=>{/#[a-f0-9]{6}/.test(o.value)&&await C.scene.setMetadata({[`${h.EXTENSIONID}/toolColor`]:o.value})},400)},te.toolStyle.onchange=async i=>{const o=i.currentTarget;await C.scene.setMetadata({[`${h.EXTENSIONID}/toolStyle`]:o.value=="solid"?[]:[25,25]})},te.toolWidth.onchange=i=>{const o=i.currentTarget;clearTimeout(a),a=setTimeout(async()=>{await C.scene.setMetadata({[`${h.EXTENSIONID}/toolWidth`]:o.value})},400)},te.defaultMELDepth.onchange=i=>{const o=i.currentTarget;clearTimeout(a),a=setTimeout(async()=>{await C.scene.setMetadata({[`${h.EXTENSIONID}/defaultMELDepth`]:o.value})},400)},te.whatsNewButton.onclick=async function(){te.whatsNewIcon?.classList.remove("new-shine"),await C.modal.open({id:h.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:400})};const t=I.sceneMetadata[`${h.EXTENSIONID}/fowColor`]??"#00000088",n=I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??"#000000";te.toolColor&&(te.toolColor.value=n),te.fowColor&&(te.fowColor.value=t),at({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color",defaultColor:t}),at({themeMode:"dark",alpha:!1,forceAlpha:!1,el:"#tool_color",defaultColor:n})}const va="#000000",Uo=8,zo=[];let vt=[];async function wa(){vt=[];const a=await C.scene.local.getItems(Vo);await C.scene.local.deleteItems(a.map(e=>e.id)),await C.popover.close(h.BRUSHTOOLID)}async function Go(a,e){await Ea(e.pointerPosition)}async function Wo(){const a=await C.viewport.getWidth();await C.popover.open({id:h.BRUSHTOOLID,url:"/pages/brush.html",height:80,width:350,disableClickAway:!0,anchorPosition:{top:60,left:a/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}async function qo(){await C.popover.close(h.BRUSHTOOLID)}async function Ko(a,e){await Ea(e.pointerPosition)}async function Yo(a,e){await Jo(),await wa()}async function Zo(a,e){await wa()}async function Ea(a){const e={x:Math.floor(a.x/I.gridDpi),y:Math.floor(a.y/I.gridDpi)};if(!vt.some(n=>n.x===e.x&&n.y===e.y)){const n={x:e.x*I.gridDpi,y:e.y*I.gridDpi},i={x:(e.x+1)*I.gridDpi,y:e.y*I.gridDpi},o={x:e.x*I.gridDpi,y:(e.y+1)*I.gridDpi},l={x:(e.x+1)*I.gridDpi,y:(e.y+1)*I.gridDpi},y=[[Mt.MOVE,n.x,n.y],[Mt.LINE,i.x,i.y],[Mt.LINE,l.x,l.y],[Mt.LINE,o.x,o.y],[Mt.CLOSE]],b=mt().commands(y).strokeOpacity(0).fillOpacity(.5).fillColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??va).build();b.metadata[`${h.EXTENSIONID}/isBrushSquare`]=!0,vt.push(e),await C.scene.local.addItems([b])}}async function Jo(){const a=[];for(const l of vt){const{x:y,y:b}=l,k={x:y*I.gridDpi,y:b*I.gridDpi},M={x:(y+1)*I.gridDpi,y:b*I.gridDpi},L={x:y*I.gridDpi,y:(b+1)*I.gridDpi},x={x:(y+1)*I.gridDpi,y:(b+1)*I.gridDpi};if(!vt.some(B=>B.x===y&&B.y===b-1)){const B=k,O=M;a.push({Start:B,End:O})}if(!vt.some(B=>B.x===y&&B.y===b+1)){const B=L,O=x;a.push({Start:B,End:O})}if(!vt.some(B=>B.x===y-1&&B.y===b)){const B=k,O=L;a.push({Start:B,End:O})}if(!vt.some(B=>B.x===y+1&&B.y===b)){const B=M,O=x;a.push({Start:B,End:O})}}const e=_a(a),t=ba(e),n=ts(t),i=25,o=n.length;for(let l=0;l<o;l+=i){const y=n.slice(l,l+i);await C.scene.items.addItems(y)}}function ba(a){let e=[],t=[],n=!1;for(const i of a){const o=i.Start.x===i.End.x?a.filter(b=>b.Start.x===b.End.x):a.filter(b=>b.Start.y===b.End.y),l=i.Start.x===i.End.x?o.filter(b=>b.Start.x===i.Start.x&&b.End.x===i.End.x):o.filter(b=>b.Start.y===i.Start.y&&b.End.y===i.End.y),y=i.Start.x!==i.End.x?l.find(b=>b.Start.x>i.Start.x&&b.Start.x<i.End.x):l.find(b=>b.Start.y>i.Start.y&&b.Start.y<i.End.y);if(y){const b=es(i,y);t.push(b),e.push(i),e.push(y),t=t.filter(k=>k!==i&&k!==y),n=!0}else e.includes(i)||t.push(i)}return n?ba(t):t}function _a(a){let e=[],t=[],n=!1;for(const i of a){const l=(i.Start.x===i.End.x?a.filter(y=>y.Start.x===y.End.x):a.filter(y=>y.Start.y===y.End.y)).find(y=>y.Start.x===i.End.x&&y.Start.y===i.End.y);if(l){const y=Qo(i,l);t.push(y),e.push(i),e.push(l),t=t.filter(b=>b!==i&&b!==l),n=!0}else e.includes(i)||t.push(i)}return n?_a(t):t}function Qo(a,e){return{Start:a.Start,End:e.End}}function es(a,e){const t=Math.min(a.Start.x,e.Start.x),n=Math.min(a.Start.y,e.Start.y),i=Math.max(a.End.x,e.End.x),o=Math.max(a.End.y,e.End.y);return{Start:{x:t,y:n},End:{x:i,y:o}}}function ts(a){const e=[];for(const t of a){const n=ut().tension(0).points([t.Start,t.End]).strokeColor(I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??va).strokeDash(I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]??zo).strokeWidth(I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??Uo).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Brushed)").closed(!1).locked(!0).build();n.visible=!1,n.metadata[`${h.EXTENSIONID}/isVisionLine`]=!0,e.push(n)}return e}const kt={onActivate:Wo,onDeactivate:qo,onDragStart:Go,onDragMove:Ko,onDragEnd:Yo,onDragCancel:Zo};async function Fr(){await C.tool.create({id:`${h.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],defaultMetadata:{[`${h.EXTENSIONID}/elevationEditor`]:!1},async onClick(){await C.tool.activateTool(`${h.EXTENSIONID}/vision-tool`),I.toolStarted||(I.toolStarted=!0,await C.tool.setMetadata(`${h.EXTENSIONID}/vision-tool`,{[`${h.EXTENSIONID}/elevationEditor`]:!1}))}}),await C.tool.createMode({id:`${h.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],onToolDown:Pn.onToolClick,onToolMove:Pn.onToolMove,onKeyDown:Pn.onKeyDown,preventDrag:{dragging:!1}}),await C.tool.createMode({id:`${h.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],onToolDown:Mn.onToolClick,onToolMove:Mn.onToolMove,onKeyDown:Mn.onKeyDown,preventDrag:{dragging:!1}}),await C.tool.createMode({id:`${h.EXTENSIONID}/add-vision-brush-mode`,icons:[{icon:"/brush.svg",label:"Paint Obstructions by Grid",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],onToolDown:kt.onActivate,onToolUp:kt.onDeactivate,onToolDragStart:kt.onDragStart,onToolDragMove:kt.onDragMove,onToolDragEnd:kt.onDragEnd,onToolDragCancel:kt.onDragCancel}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-1`,icons:[{icon:"/mountain1.svg",label:"Create Map Elevation Layer-1",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{Ge.onToolClick(a,e,1)},onToolMove:Ge.onToolMove,onKeyDown:(a,e)=>{Ge.onKeyDown(a,e,1)},preventDrag:{dragging:!0}}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-2`,icons:[{icon:"/mountain2.svg",label:"Create Map Elevation Layer-2",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{Ge.onToolClick(a,e,2)},onToolMove:Ge.onToolMove,onKeyDown:(a,e)=>{Ge.onKeyDown(a,e,2)},preventDrag:{dragging:!0}}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-3`,icons:[{icon:"/mountain3.svg",label:"Create Map Elevation Layer-3",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{Ge.onToolClick(a,e,3)},onToolMove:Ge.onToolMove,onKeyDown:(a,e)=>{Ge.onKeyDown(a,e,3)},preventDrag:{dragging:!0}}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-4`,icons:[{icon:"/mountain4.svg",label:"Create Map Elevation Layer-4",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{Ge.onToolClick(a,e,4)},onToolMove:Ge.onToolMove,onKeyDown:(a,e)=>{Ge.onKeyDown(a,e,4)},preventDrag:{dragging:!0}}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-5`,icons:[{icon:"/mountain5.svg",label:"Create Map Elevation Layer-5",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{Ge.onToolClick(a,e,5)},onToolMove:Ge.onToolMove,onKeyDown:(a,e)=>{Ge.onKeyDown(a,e,5)},preventDrag:{dragging:!0}}),await C.tool.createMode({id:`${h.EXTENSIONID}/enter-elevation-mode-select`,icons:[{icon:"/mountain-select.svg",label:"Selector",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>!0,preventDrag:{dragging:!0}}),await C.tool.createAction({id:`${h.EXTENSIONID}/enter-elevation-mode`,icons:[{icon:"/eyeclosed.svg",label:"Activate Elevation Editor",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`],metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!0,operator:"!="}]}},{icon:"/eyeopen.svg",label:"De-Activate Elevation Editor",filter:{activeTools:[`${h.EXTENSIONID}/vision-tool`],metadata:[{key:[`${h.EXTENSIONID}/elevationEditor`],value:!0,operator:"=="}]}}],onClick:Ge.enterEditMode})}class ns{mainWindow=document.getElementById("app");mainUIDiv;playerListContainer;settingsUIDiv;visionCheckbox;hiddenListToggle;snapCheckbox;table;hiddenTable;message;mapHeight;mapWidth;mapSubmit;whatsNewButton;whatsNewIcon;processedIndicator;smokeViewToggle;spectreViewToggle;settingsViewToggle;debugViewToggle;helpViewToggle;smokeViewPanel;spectreViewPanel;settingsViewPanel;debugViewPanel;helpViewPanel;persistenceCheckbox;autodetectCheckbox;fowCheckbox;doorCheckbox;fowColor;resetButton;convertButton;boundryOptions;backgroundButton;lockFogButton;unlockFogButton;defaultMELDepth;toolWidth;toolColor;toolStyle;importButton;importFile;mapAlign;importErrors;dpiAutodetect;importDpi;importFormat;version;constructor(e){this.version=`SMOKEANDSPECTRE-${e}`}SetupGMElements(){this.mainWindow.innerHTML=`
            <div id="localStorageWarning"></div>
            <div id="tabControls">
                <div class="controlContainer">
                    <button class="view-button selected" id="smokeViewToggle">SMOKE</button>
                    <button class="view-button" id="spectreViewToggle">SPECTRE</button>
                    <button class="view-button" id="settingsViewToggle"><img class="menu_svg" src="./settings.svg"></button>
                    <button class="view-button" id="debugViewToggle">INFO</button>
                    <button class="view-button" id="helpViewToggle">HELP</button>
                    <div id="miniButtons">
                        <button class="circle-button" id="processedIndicator"></button>
                        <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">    
                        <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg id="whatsNewIcon" class="svgclickable" fill="#fff" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
                    </div>
                </div>
            </div>
            <div id="smokeViewPanel" class="panel"></div>
            <div id="spectreViewPanel" class="panel" style="display: none;"></div>
            <div id="settingsViewPanel" class="panel" style="display: none;"></div>
            <div id="debugViewPanel" class="panel" style="display: none;"></div>
            <div id="helpViewPanel" class="panel" style="display: none;">
                <div id="markdownHelpContainer"></div>
            </div>
        `,this.mainWindow.parentElement.style.placeItems="start",this.smokeViewToggle=document.getElementById("smokeViewToggle"),this.spectreViewToggle=document.getElementById("spectreViewToggle"),this.settingsViewToggle=document.getElementById("settingsViewToggle"),this.debugViewToggle=document.getElementById("debugViewToggle"),this.helpViewToggle=document.getElementById("helpViewToggle"),this.smokeViewPanel=document.getElementById("smokeViewPanel"),this.spectreViewPanel=document.getElementById("spectreViewPanel"),this.settingsViewPanel=document.getElementById("settingsViewPanel"),this.debugViewPanel=document.getElementById("debugViewPanel"),this.helpViewPanel=document.getElementById("helpViewPanel"),this.smokeViewPanel.innerHTML=h.SMOKEHTML,this.spectreViewPanel.innerHTML=h.SPECTREHTML,this.settingsViewPanel.innerHTML=h.SETTINGSHTML,this.debugViewPanel.innerHTML=h.DEBUGHTML,this.SetupHelpDocuments(),this.mainUIDiv=document.getElementById("main-ui"),this.settingsUIDiv=document.getElementById("settings-ui"),this.visionCheckbox=document.getElementById("vision_checkbox"),this.hiddenListToggle=document.getElementById("hideListToggle"),this.snapCheckbox=document.getElementById("snap_checkbox"),this.table=document.getElementById("token_list"),this.hiddenTable=document.getElementById("hidden_list"),this.message=document.getElementById("no_tokens_message"),this.mapHeight=document.getElementById("mapHeight"),this.mapWidth=document.getElementById("mapWidth"),this.mapSubmit=document.getElementById("mapSubmit"),this.whatsNewButton=document.getElementById("whatsnewbutton"),this.whatsNewIcon=document.getElementById("whatsNewIcon"),this.processedIndicator=document.getElementById("processedIndicator"),this.persistenceCheckbox=document.getElementById("persistence_checkbox"),this.autodetectCheckbox=document.getElementById("autodetect_checkbox"),this.fowCheckbox=document.getElementById("fow_checkbox"),this.doorCheckbox=document.getElementById("door_checkbox"),this.fowColor=document.getElementById("fow_color"),this.resetButton=document.getElementById("persistence_reset"),this.convertButton=document.getElementById("convert_button"),this.boundryOptions=document.getElementById("boundry_options"),this.backgroundButton=document.getElementById("background_button"),this.lockFogButton=document.getElementById("lock_button"),this.unlockFogButton=document.getElementById("unlock_button"),this.toolWidth=document.getElementById("tool_width"),this.toolColor=document.getElementById("tool_color"),this.toolStyle=document.getElementById("tool_style"),this.defaultMELDepth=document.getElementById("default_mel_depth"),this.importButton=document.getElementById("import_button"),this.importFile=document.getElementById("import_file"),this.mapAlign=document.getElementById("map_align"),this.importErrors=document.getElementById("import_errors"),this.dpiAutodetect=document.getElementById("dpi_autodetect"),this.importDpi=document.getElementById("import_dpi"),this.importFormat=document.getElementById("import_format");const e=document.getElementById("playerListing");e.appendChild(this.GetEmptyContextItem());for(const t of I.party){const n=document.createElement("li");n.id=t.id,n.textContent=t.name,n.style.color=t.color,e.appendChild(n)}at.init(),Ho()}SetupHelpDocuments(){const t=new za.Converter().makeHtml(h.MARKDOWNHELP),n=document.getElementById("markdownHelpContainer");n.innerHTML=t}async SetupPlayerElements(){this.mainWindow.innerHTML=`<div class="title">Configuration via GM.
            <div class="tooltip" id="helpButton" title="Need Help?"></div>
            </div>
            <hr><sub>You must have ownership of a token to see it.</sub></br></br>Tokens Owned By You:<div id="playerOwnedTokens"></div><div id="localStorageWarning"></div>`,await C.action.setHeight(300),await C.action.setWidth(350),this.playerListContainer=document.getElementById("playerOwnedTokens");const e=document.getElementById("helpButton"),t=document.createElement("input");t.classList.add("clickable"),t.src="/help.svg",t.height=15,t.width=15,t.type="image",t.title="Need Help?",t.onclick=async function(){await C.modal.open({id:h.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html?gethelp=true",height:500,width:350})},e.appendChild(t)}GetEmptyContextItem(){const e=document.createElement("li");return e.id=I.playerId,e.textContent="Self",e}async ResetPersistence(){const e=await C.scene.local.getItems(Un);await C.scene.local.deleteItems(e.map(n=>n.id));const t=I.sceneMetadata[`${h.EXTENSIONID}/sceneId`];localStorage.removeItem(`${h.EXTENSIONID}/fogCache/${I.playerId}/${t}`),await _t()}async UpdateUI(){const e=I.sceneItems.filter(y=>ya(y));Ga(I.sceneMetadata)||(this.defaultMELDepth&&(this.defaultMELDepth.value=I.sceneMetadata[`${h.EXTENSIONID}/defaultMELDepth`]??"0"),this.toolWidth&&(this.toolWidth.value=I.sceneMetadata[`${h.EXTENSIONID}/toolWidth`]??"8"),this.toolColor&&(this.toolColor.value=I.sceneMetadata[`${h.EXTENSIONID}/toolColor`]??"#000000"),this.toolStyle&&(this.toolStyle.value=I.sceneMetadata[`${h.EXTENSIONID}/toolStyle`]==="solid"?"solid":"dotted"),this.visionCheckbox&&(this.visionCheckbox.checked=I.sceneMetadata[`${h.EXTENSIONID}/visionEnabled`]==!0),this.autodetectCheckbox&&(this.autodetectCheckbox.checked=I.sceneMetadata[`${h.EXTENSIONID}/autodetectEnabled`]==!0),this.persistenceCheckbox&&(this.persistenceCheckbox.checked=I.sceneMetadata[`${h.EXTENSIONID}/persistenceEnabled`]==!0),this.fowCheckbox&&(this.fowCheckbox.checked=I.sceneMetadata[`${h.EXTENSIONID}/fowEnabled`]==!0),this.doorCheckbox&&(this.doorCheckbox.checked=I.sceneMetadata[`${h.EXTENSIONID}/playerDoors`]==!0),this.fowColor&&(this.fowColor.value=I.sceneMetadata[`${h.EXTENSIONID}/fowColor`]??"#00000088"),I.sceneMetadata[`${h.EXTENSIONID}/debug`]==!0),this.boundryOptions.style.display=this.autodetectCheckbox.checked?"none":"";const t=I.sceneItems.filter(y=>y.layer==="FOG"&&y.metadata[`${h.EXTENSIONID}/isBackgroundMap`]===!0),n=document.querySelectorAll(".fog-background-entry");for(const y of n){const b=y.id.slice(3);t.find(k=>k.id===b)===void 0&&y.remove()}for(const y of t)if(!document.querySelector(`#bg-${y.id}`)){const k=document.createElement("div");k.id=`bg-${y.id}`,k.className="fog-background-entry grid-3 grid-main",k.style.width="300",k.innerHTML=`<div class="token-name grid-2">${y.name}</div>
                    <div><label title="Unlock this fog background and turn it back into a map"><input type="button" value="Unlock"></label></div>`,document.querySelector("#fog_background_list").appendChild(k),k.querySelector("input").addEventListener("click",async L=>{if(!L||!L.target)return;const B=L.target.parentElement.parentElement.parentElement.id.slice(3);await C.scene.items.updateItems(O=>O.id===B&&O.layer=="FOG"&&O.metadata[`${h.EXTENSIONID}/isBackgroundMap`]===!0,O=>{for(let j=0;j<O.length;j++)O[j].layer="MAP",O[j].disableHit=!1,O[j].locked=!1,O[j].visible=!0,delete O[j].metadata[`${h.EXTENSIONID}/isBackgroundMap`]})})}const i=document.querySelector("#fog_backgrounds");t.length==0?i.style.display="none":i.style.display="block";const o=document.getElementsByClassName("token-table-entry"),l=[];for(const y of o){const b=y.id.slice(3);e.find(k=>k.id===b)===void 0&&l.push(y)}for(const y of l)y.remove();for(const y of e)Ya(y)}UpdatePlayerProcessUI(){I.party.every(t=>t.metadata[`${h.EXTENSIONID}/processed`]===!0)?(this.processedIndicator.style.backgroundColor="green",this.processedIndicator.title="Everything looks good."):(this.processedIndicator.style.backgroundColor="red",this.processedIndicator.title="A player is having trouble processing/seeing.")}UpdatePlayerVisionList(){const e=[];for(const t of I.sceneItems)if(Qt(t)&&t.createdUserId===I.playerId){const n=t.metadata[`${h.EXTENSIONID}/hasVision`]!==void 0;e.push(`<li>${t.name}${n?"":": <b>Vision Disabled</b>"}</li>`)}e.length===0&&e.push("<li>None found.</li>"),this.playerListContainer.innerHTML=`<ul>${e.join("")}</ul>`}HighlightWhatsNew(){let e=localStorage.getItem(this.version);(e==="false"||!e)&&(this.whatsNewIcon?.classList.add("new-shine"),localStorage.setItem(this.version,"true"))}async SoftReset(){I.playerRole==="GM"?(this.SetupGMElements(),Xr(),this.UpdatePlayerProcessUI(),Ln(this.mapAlign),await Promise.all([kr(),Fr(),lt.SetupSpectreGM(),tn(!1),this.UpdateUI()])):this.SetupPlayerElements(),I.sceneReady&&(await Xn(),await _t())}async Start(){Ka(),I.playerRole==="GM"?(this.SetupGMElements(),Xr(),this.UpdatePlayerProcessUI(),Ln(this.mapAlign),await Promise.all([kr(),Fr(),lt.SetupSpectreGM(),tn(!1),this.UpdateUI()])):(await this.SetupPlayerElements(),this.UpdatePlayerVisionList()),await Xn(),await $n(),await _t(),lt.SetupLocalSpecterHandlers(),I.SetupHandlers(),this.HighlightWhatsNew()}}const te=new ns("2.71");C.onReady(async()=>{const a=await C.scene.isReady();if(!document.getElementById("papp"))if(a===!1){const t=C.scene.onReadyChange(async n=>{n&&(t(),await jr())})}else await jr()});async function jr(){await I.InitializeCache(),await te.Start()}export{xr as i};
