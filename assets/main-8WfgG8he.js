import{b as Se,C as d,O as T,a as qt,c as Ca,d as Aa,e as Wn,f as $a,g as Ma,h as Pa,i as Tt,j as Ra,k as xa}from"./bsConstants-aZQT4emf.js";/* empty css              */const xe=(()=>{/*!
* Copyright (c) 2021-2024 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.24.0
* NPM: https://github.com/melloware/coloris-npm
*/return((i,e,t,n)=>{const r=e.createElement("canvas").getContext("2d"),o={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let s,l,p,h,E,_,N,D,O,X,H,V,M,j,a,c,u={};const f={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>n,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},y={};let v="",g={},m=!1;function L(I){if(typeof I=="object")for(const P in I)switch(P){case"el":$(I.el),I.wrap!==!1&&q(I.el);break;case"parent":s=I.parent instanceof HTMLElement?I.parent:e.querySelector(I.parent),s&&(s.appendChild(l),f.parent=I.parent,s===e.body&&(s=n));break;case"themeMode":f.themeMode=I.themeMode,I.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(f.themeMode="dark");case"theme":I.theme&&(f.theme=I.theme),l.className="clr-picker clr-"+f.theme+" clr-"+f.themeMode,f.inline&&B();break;case"rtl":f.rtl=!!I.rtl,Array.from(e.getElementsByClassName("clr-field")).forEach(S=>S.classList.toggle("clr-rtl",f.rtl));break;case"margin":I.margin*=1,f.margin=isNaN(I.margin)?f.margin:I.margin;break;case"wrap":I.el&&I.wrap&&q(I.el);break;case"formatToggle":f.formatToggle=!!I.formatToggle,fe("clr-format").style.display=f.formatToggle?"block":"none",f.formatToggle&&(f.format="auto");break;case"swatches":if(Array.isArray(I.swatches)){const S=fe("clr-swatches"),x=e.createElement("div");S.textContent="",I.swatches.forEach((U,K)=>{const W=e.createElement("button");W.setAttribute("type","button"),W.setAttribute("id","clr-swatch-"+K),W.setAttribute("aria-labelledby","clr-swatch-label clr-swatch-"+K),W.style.color=U,W.textContent=U,x.appendChild(W)}),I.swatches.length&&S.appendChild(x),f.swatches=I.swatches.slice()}break;case"swatchesOnly":f.swatchesOnly=!!I.swatchesOnly,l.setAttribute("data-minimal",f.swatchesOnly);break;case"alpha":f.alpha=!!I.alpha,l.setAttribute("data-alpha",f.alpha);break;case"inline":if(f.inline=!!I.inline,l.setAttribute("data-inline",f.inline),f.inline){const S=I.defaultColor||f.defaultColor;j=Z(S),B(),se(S)}break;case"clearButton":typeof I.clearButton=="object"&&(I.clearButton.label&&(f.clearLabel=I.clearButton.label,N.innerHTML=f.clearLabel),I.clearButton=I.clearButton.show),f.clearButton=!!I.clearButton,N.style.display=f.clearButton?"block":"none";break;case"clearLabel":f.clearLabel=I.clearLabel,N.innerHTML=f.clearLabel;break;case"closeButton":f.closeButton=!!I.closeButton,f.closeButton?l.insertBefore(D,E):E.appendChild(D);break;case"closeLabel":f.closeLabel=I.closeLabel,D.innerHTML=f.closeLabel;break;case"a11y":const R=I.a11y;let z=!1;if(typeof R=="object")for(const S in R)R[S]&&f.a11y[S]&&(f.a11y[S]=R[S],z=!0);if(z){const S=fe("clr-open-label"),x=fe("clr-swatch-label");S.innerHTML=f.a11y.open,x.innerHTML=f.a11y.swatch,D.setAttribute("aria-label",f.a11y.close),N.setAttribute("aria-label",f.a11y.clear),O.setAttribute("aria-label",f.a11y.hueSlider),H.setAttribute("aria-label",f.a11y.alphaSlider),_.setAttribute("aria-label",f.a11y.input),p.setAttribute("aria-label",f.a11y.instruction)}break;default:f[P]=I[P]}}function k(I,P){typeof I=="string"&&typeof P=="object"&&(y[I]=P,m=!0)}function C(I){delete y[I],Object.keys(y).length===0&&(m=!1,I===v&&w())}function A(I){if(m){const P=["el","wrap","rtl","inline","defaultColor","a11y"];for(let R in y){const z=y[R];if(I.matches(R)){v=R,g={},P.forEach(S=>delete z[S]);for(let S in z)g[S]=Array.isArray(f[S])?f[S].slice():f[S];L(z);break}}}}function w(){Object.keys(g).length>0&&(L(g),v="",g={})}function $(I){I instanceof HTMLElement&&(I=[I]),Array.isArray(I)?I.forEach(P=>{ee(P,"click",F),ee(P,"input",te)}):(ee(e,"click",I,F),ee(e,"input",I,te))}function F(I){f.inline||(A(I.target),M=I.target,a=M.value,j=Z(a),l.classList.add("clr-open"),B(),se(a),(f.focusInput||f.selectInput)&&(_.focus({preventScroll:!0}),_.setSelectionRange(M.selectionStart,M.selectionEnd)),f.selectInput&&_.select(),(c||f.swatchesOnly)&&We().shift().focus(),M.dispatchEvent(new Event("open",{bubbles:!0})))}function B(){if(!l||!M&&!f.inline)return;const I=s,P=i.scrollY,R=l.offsetWidth,z=l.offsetHeight,S={left:!1,top:!1};let x,U,K,W={x:0,y:0};if(I&&(x=i.getComputedStyle(I),U=parseFloat(x.marginTop),K=parseFloat(x.borderTopWidth),W=I.getBoundingClientRect(),W.y+=K+P),!f.inline){const ne=M.getBoundingClientRect();let ue=ne.x,ye=P+ne.y+ne.height+f.margin;I?(ue-=W.x,ye-=W.y,ue+R>I.clientWidth&&(ue+=ne.width-R,S.left=!0),ye+z>I.clientHeight-U&&z+f.margin<=ne.top-(W.y-P)&&(ye-=ne.height+z+f.margin*2,S.top=!0),ye+=I.scrollTop):(ue+R>e.documentElement.clientWidth&&(ue+=ne.width-R,S.left=!0),ye+z-P>e.documentElement.clientHeight&&z+f.margin<=ne.top&&(ye=P+ne.y-z-f.margin,S.top=!0)),l.classList.toggle("clr-left",S.left),l.classList.toggle("clr-top",S.top),l.style.left=ue+"px",l.style.top=ye+"px",W.x+=l.offsetLeft,W.y+=l.offsetTop}u={width:p.offsetWidth,height:p.offsetHeight,x:p.offsetLeft+W.x,y:p.offsetTop+W.y}}function q(I){I instanceof HTMLElement?G(I):Array.isArray(I)?I.forEach(G):e.querySelectorAll(I).forEach(G)}function G(I){const P=I.parentNode;if(!P.classList.contains("clr-field")){const R=e.createElement("div");let z="clr-field";(f.rtl||I.classList.contains("clr-rtl"))&&(z+=" clr-rtl"),R.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',P.insertBefore(R,I),R.className=z,R.style.color=I.value,R.appendChild(I)}}function te(I){const P=I.target.parentNode;P.classList.contains("clr-field")&&(P.style.color=I.target.value)}function ie(I){if(M&&!f.inline){const P=M;I&&(M=n,a!==P.value&&(P.value=a,P.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(()=>{a!==P.value&&P.dispatchEvent(new Event("change",{bubbles:!0}))}),l.classList.remove("clr-open"),m&&w(),P.dispatchEvent(new Event("close",{bubbles:!0})),f.focusInput&&P.focus({preventScroll:!0}),M=n}}function se(I){const P=dt(I),R=ot(P);oe(R.s,R.v),_e(P,R),O.value=R.h,l.style.color="hsl("+R.h+", 100%, 50%)",X.style.left=R.h/360*100+"%",h.style.left=u.width*R.s/100+"px",h.style.top=u.height-u.height*R.v/100+"px",H.value=R.a*100,V.style.left=R.a*100+"%"}function Z(I){const P=I.substring(0,3).toLowerCase();return P==="rgb"||P==="hsl"?P:"hex"}function Q(I){I=I!==n?I:_.value,M&&(M.value=I,M.dispatchEvent(new Event("input",{bubbles:!0}))),f.onChange&&f.onChange.call(i,I,M),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:I,currentEl:M}}))}function le(I,P){const R={h:O.value*1,s:I/u.width*100,v:100-P/u.height*100,a:H.value/100},z=Ye(R);oe(R.s,R.v),_e(z,R),Q()}function oe(I,P){let R=f.a11y.marker;I=I.toFixed(1)*1,P=P.toFixed(1)*1,R=R.replace("{s}",I),R=R.replace("{v}",P),h.setAttribute("aria-label",R)}function ke(I){return{pageX:I.changedTouches?I.changedTouches[0].pageX:I.pageX,pageY:I.changedTouches?I.changedTouches[0].pageY:I.pageY}}function ce(I){const P=ke(I);let R=P.pageX-u.x,z=P.pageY-u.y;s&&(z+=s.scrollTop),Me(R,z),I.preventDefault(),I.stopPropagation()}function $e(I,P){let R=h.style.left.replace("px","")*1+I,z=h.style.top.replace("px","")*1+P;Me(R,z)}function Me(I,P){I=I<0?0:I>u.width?u.width:I,P=P<0?0:P>u.height?u.height:P,h.style.left=I+"px",h.style.top=P+"px",le(I,P),h.focus()}function _e(I,P){I===void 0&&(I={}),P===void 0&&(P={});let R=f.format;for(const x in I)o[x]=I[x];for(const x in P)o[x]=P[x];const z=Pe(o),S=z.substring(0,7);switch(h.style.color=S,V.parentNode.style.color=S,V.style.color=z,E.style.color=z,p.style.display="none",p.offsetHeight,p.style.display="",V.nextElementSibling.style.display="none",V.nextElementSibling.offsetHeight,V.nextElementSibling.style.display="",R==="mixed"?R=o.a===1?"hex":"rgb":R==="auto"&&(R=j),R){case"hex":_.value=z;break;case"rgb":_.value=Xe(o);break;case"hsl":_.value=Je(Qe(o));break}e.querySelector('.clr-format [value="'+R+'"]').checked=!0}function rt(){const I=O.value*1,P=h.style.left.replace("px","")*1,R=h.style.top.replace("px","")*1;l.style.color="hsl("+I+", 100%, 50%)",X.style.left=I/360*100+"%",le(P,R)}function st(){const I=H.value/100;V.style.left=I*100+"%",_e({a:I}),Q()}function Ye(I){const P=I.s/100,R=I.v/100;let z=P*R,S=I.h/60,x=z*(1-t.abs(S%2-1)),U=R-z;z=z+U,x=x+U;const K=t.floor(S)%6,W=[z,x,U,U,x,z][K],ne=[x,z,z,x,U,U][K],ue=[U,U,x,z,z,x][K];return{r:t.round(W*255),g:t.round(ne*255),b:t.round(ue*255),a:I.a}}function Qe(I){const P=I.v/100,R=P*(1-I.s/100/2);let z;return R>0&&R<1&&(z=t.round((P-R)/t.min(R,1-R)*100)),{h:I.h,s:z||0,l:t.round(R*100),a:I.a}}function ot(I){const P=I.r/255,R=I.g/255,z=I.b/255,S=t.max(P,R,z),x=t.min(P,R,z),U=S-x,K=S;let W=0,ne=0;return U&&(S===P&&(W=(R-z)/U),S===R&&(W=2+(z-P)/U),S===z&&(W=4+(P-R)/U),S&&(ne=U/S)),W=t.floor(W*60),{h:W<0?W+360:W,s:t.round(ne*100),v:t.round(K*100),a:I.a}}function dt(I){const P=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let R,z;return r.fillStyle="#000",r.fillStyle=I,R=P.exec(r.fillStyle),R?z={r:R[3]*1,g:R[4]*1,b:R[5]*1,a:R[6]*1}:(R=r.fillStyle.replace("#","").match(/.{2}/g).map(S=>parseInt(S,16)),z={r:R[0],g:R[1],b:R[2],a:1}),z}function Pe(I){let P=I.r.toString(16),R=I.g.toString(16),z=I.b.toString(16),S="";if(I.r<16&&(P="0"+P),I.g<16&&(R="0"+R),I.b<16&&(z="0"+z),f.alpha&&(I.a<1||f.forceAlpha)){const x=I.a*255|0;S=x.toString(16),x<16&&(S="0"+S)}return"#"+P+R+z+S}function Xe(I){return!f.alpha||I.a===1&&!f.forceAlpha?"rgb("+I.r+", "+I.g+", "+I.b+")":"rgba("+I.r+", "+I.g+", "+I.b+", "+I.a+")"}function Je(I){return!f.alpha||I.a===1&&!f.forceAlpha?"hsl("+I.h+", "+I.s+"%, "+I.l+"%)":"hsla("+I.h+", "+I.s+"%, "+I.l+"%, "+I.a+")"}function Ue(){e.getElementById("clr-picker")||(s=n,l=e.createElement("div"),l.setAttribute("id","clr-picker"),l.className="clr-picker",l.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+f.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+f.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+f.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+f.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+f.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+f.a11y.clear+'">'+f.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+f.a11y.close+'">'+f.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+f.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+f.a11y.swatch+"</span>"),e.body.appendChild(l),p=fe("clr-color-area"),h=fe("clr-color-marker"),N=fe("clr-clear"),D=fe("clr-close"),E=fe("clr-color-preview"),_=fe("clr-color-value"),O=fe("clr-hue-slider"),X=fe("clr-hue-marker"),H=fe("clr-alpha-slider"),V=fe("clr-alpha-marker"),$(f.el),q(f.el),ee(l,"mousedown",I=>{l.classList.remove("clr-keyboard-nav"),I.stopPropagation()}),ee(p,"mousedown",I=>{ee(e,"mousemove",ce)}),ee(p,"contextmenu",I=>{I.preventDefault()}),ee(p,"touchstart",I=>{e.addEventListener("touchmove",ce,{passive:!1})}),ee(h,"mousedown",I=>{ee(e,"mousemove",ce)}),ee(h,"touchstart",I=>{e.addEventListener("touchmove",ce,{passive:!1})}),ee(_,"change",I=>{const P=_.value;if(M||f.inline){const R=P===""?P:se(P);Q(R)}}),ee(N,"click",I=>{Q(""),ie()}),ee(D,"click",I=>{Q(),ie()}),ee(fe("clr-format"),"click",".clr-format input",I=>{j=I.target.value,_e(),Q()}),ee(l,"click",".clr-swatches button",I=>{se(I.target.textContent),Q(),f.swatchesOnly&&ie()}),ee(e,"mouseup",I=>{e.removeEventListener("mousemove",ce)}),ee(e,"touchend",I=>{e.removeEventListener("touchmove",ce)}),ee(e,"mousedown",I=>{c=!1,l.classList.remove("clr-keyboard-nav"),ie()}),ee(e,"keydown",I=>{const P=I.key,R=I.target,z=I.shiftKey;if(P==="Escape"?ie(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(P)&&(c=!0,l.classList.add("clr-keyboard-nav")),P==="Tab"&&R.matches(".clr-picker *")){const x=We(),U=x.shift(),K=x.pop();z&&R===U?(K.focus(),I.preventDefault()):!z&&R===K&&(U.focus(),I.preventDefault())}}),ee(e,"click",".clr-field button",I=>{m&&w(),I.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),ee(h,"keydown",I=>{const P={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(P).includes(I.key)&&($e(...P[I.key]),I.preventDefault())}),ee(p,"click",ce),ee(O,"input",rt),ee(H,"input",st))}function We(){return Array.from(l.querySelectorAll("input, button")).filter(R=>!!R.offsetWidth)}function fe(I){return e.getElementById(I)}function ee(I,P,R,z){const S=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof R=="string"?I.addEventListener(P,x=>{S.call(x.target,R)&&z.call(x.target,x)}):(z=R,I.addEventListener(P,z))}function je(I,P){P=P!==n?P:[],e.readyState!=="loading"?I(...P):e.addEventListener("DOMContentLoaded",()=>{I(...P)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function lt(I,P){M=P,a=M.value,A(P),j=Z(I),B(),se(I),Q(),a!==I&&M.dispatchEvent(new Event("change",{bubbles:!0}))}const bt=(()=>{const I={init:Ue,set:L,wrap:q,close:ie,setInstance:k,setColor:lt,removeInstance:C,updatePosition:B,ready:je};function P(R){je(()=>{R&&(typeof R=="string"?$(R):L(R))})}for(const R in I)P[R]=function(){for(var z=arguments.length,S=new Array(z),x=0;x<z;x++)S[x]=arguments[x];je(I[R],S)};return je(()=>{i.addEventListener("resize",R=>{P.updatePosition()}),i.addEventListener("scroll",R=>{P.updatePosition()})}),P})();return bt.coloris=bt,bt})(window,document,Math)})();xe.coloris;xe.init;xe.set;xe.wrap;xe.close;xe.setInstance;xe.removeInstance;xe.updatePosition;var Xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Va(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Pi={exports:{}};(function(i){(function(){function e(a){var c={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `«««` and `»»»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(a===!1)return JSON.parse(JSON.stringify(c));var u={};for(var f in c)c.hasOwnProperty(f)&&(u[f]=c[f].defaultValue);return u}function t(){var a=e(!0),c={};for(var u in a)a.hasOwnProperty(u)&&(c[u]=!0);return c}var n={},r={},o={},s=e(!0),l="vanilla",p={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:t()};n.helper={},n.extensions={},n.setOption=function(a,c){return s[a]=c,this},n.getOption=function(a){return s[a]},n.getOptions=function(){return s},n.resetOptions=function(){s=e(!0)},n.setFlavor=function(a){if(!p.hasOwnProperty(a))throw Error(a+" flavor was not found");n.resetOptions();var c=p[a];l=a;for(var u in c)c.hasOwnProperty(u)&&(s[u]=c[u])},n.getFlavor=function(){return l},n.getFlavorOptions=function(a){if(p.hasOwnProperty(a))return p[a]},n.getDefaultOptions=function(a){return e(a)},n.subParser=function(a,c){if(n.helper.isString(a))if(typeof c<"u")r[a]=c;else{if(r.hasOwnProperty(a))return r[a];throw Error("SubParser named "+a+" not registered!")}},n.extension=function(a,c){if(!n.helper.isString(a))throw Error("Extension 'name' must be a string");if(a=n.helper.stdExtName(a),n.helper.isUndefined(c)){if(!o.hasOwnProperty(a))throw Error("Extension named "+a+" is not registered!");return o[a]}else{typeof c=="function"&&(c=c()),n.helper.isArray(c)||(c=[c]);var u=h(c,a);if(u.valid)o[a]=c;else throw Error(u.error)}},n.getAllExtensions=function(){return o},n.removeExtension=function(a){delete o[a]},n.resetExtensions=function(){o={}};function h(a,c){var u=c?"Error in "+c+" extension->":"Error in unnamed extension",f={valid:!0,error:""};n.helper.isArray(a)||(a=[a]);for(var y=0;y<a.length;++y){var v=u+" sub-extension "+y+": ",g=a[y];if(typeof g!="object")return f.valid=!1,f.error=v+"must be an object, but "+typeof g+" given",f;if(!n.helper.isString(g.type))return f.valid=!1,f.error=v+'property "type" must be a string, but '+typeof g.type+" given",f;var m=g.type=g.type.toLowerCase();if(m==="language"&&(m=g.type="lang"),m==="html"&&(m=g.type="output"),m!=="lang"&&m!=="output"&&m!=="listener")return f.valid=!1,f.error=v+"type "+m+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',f;if(m==="listener"){if(n.helper.isUndefined(g.listeners))return f.valid=!1,f.error=v+'. Extensions of type "listener" must have a property called "listeners"',f}else if(n.helper.isUndefined(g.filter)&&n.helper.isUndefined(g.regex))return f.valid=!1,f.error=v+m+' extensions must define either a "regex" property or a "filter" method',f;if(g.listeners){if(typeof g.listeners!="object")return f.valid=!1,f.error=v+'"listeners" property must be an object but '+typeof g.listeners+" given",f;for(var L in g.listeners)if(g.listeners.hasOwnProperty(L)&&typeof g.listeners[L]!="function")return f.valid=!1,f.error=v+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+L+" must be a function but "+typeof g.listeners[L]+" given",f}if(g.filter){if(typeof g.filter!="function")return f.valid=!1,f.error=v+'"filter" must be a function, but '+typeof g.filter+" given",f}else if(g.regex){if(n.helper.isString(g.regex)&&(g.regex=new RegExp(g.regex,"g")),!(g.regex instanceof RegExp))return f.valid=!1,f.error=v+'"regex" property must either be a string or a RegExp object, but '+typeof g.regex+" given",f;if(n.helper.isUndefined(g.replace))return f.valid=!1,f.error=v+'"regex" extensions must implement a replace string or function',f}}return f}n.validateExtension=function(a){var c=h(a,null);return c.valid?!0:(console.warn(c.error),!1)},n.hasOwnProperty("helper")||(n.helper={}),n.helper.isString=function(a){return typeof a=="string"||a instanceof String},n.helper.isFunction=function(a){var c={};return a&&c.toString.call(a)==="[object Function]"},n.helper.isArray=function(a){return Array.isArray(a)},n.helper.isUndefined=function(a){return typeof a>"u"},n.helper.forEach=function(a,c){if(n.helper.isUndefined(a))throw new Error("obj param is required");if(n.helper.isUndefined(c))throw new Error("callback param is required");if(!n.helper.isFunction(c))throw new Error("callback param must be a function/closure");if(typeof a.forEach=="function")a.forEach(c);else if(n.helper.isArray(a))for(var u=0;u<a.length;u++)c(a[u],u,a);else if(typeof a=="object")for(var f in a)a.hasOwnProperty(f)&&c(a[f],f,a);else throw new Error("obj does not seem to be an array or an iterable object")},n.helper.stdExtName=function(a){return a.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function E(a,c){var u=c.charCodeAt(0);return"¨E"+u+"E"}n.helper.escapeCharactersCallback=E,n.helper.escapeCharacters=function(a,c,u){var f="(["+c.replace(/([\[\]\\])/g,"\\$1")+"])";u&&(f="\\\\"+f);var y=new RegExp(f,"g");return a=a.replace(y,E),a},n.helper.unescapeHTMLEntities=function(a){return a.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var _=function(a,c,u,f){var y=f||"",v=y.indexOf("g")>-1,g=new RegExp(c+"|"+u,"g"+y.replace(/g/g,"")),m=new RegExp(c,y.replace(/g/g,"")),L=[],k,C,A,w,$;do for(k=0;A=g.exec(a);)if(m.test(A[0]))k++||(C=g.lastIndex,w=C-A[0].length);else if(k&&!--k){$=A.index+A[0].length;var F={left:{start:w,end:C},match:{start:C,end:A.index},right:{start:A.index,end:$},wholeMatch:{start:w,end:$}};if(L.push(F),!v)return L}while(k&&(g.lastIndex=C));return L};n.helper.matchRecursiveRegExp=function(a,c,u,f){for(var y=_(a,c,u,f),v=[],g=0;g<y.length;++g)v.push([a.slice(y[g].wholeMatch.start,y[g].wholeMatch.end),a.slice(y[g].match.start,y[g].match.end),a.slice(y[g].left.start,y[g].left.end),a.slice(y[g].right.start,y[g].right.end)]);return v},n.helper.replaceRecursiveRegExp=function(a,c,u,f,y){if(!n.helper.isFunction(c)){var v=c;c=function(){return v}}var g=_(a,u,f,y),m=a,L=g.length;if(L>0){var k=[];g[0].wholeMatch.start!==0&&k.push(a.slice(0,g[0].wholeMatch.start));for(var C=0;C<L;++C)k.push(c(a.slice(g[C].wholeMatch.start,g[C].wholeMatch.end),a.slice(g[C].match.start,g[C].match.end),a.slice(g[C].left.start,g[C].left.end),a.slice(g[C].right.start,g[C].right.end))),C<L-1&&k.push(a.slice(g[C].wholeMatch.end,g[C+1].wholeMatch.start));g[L-1].wholeMatch.end<a.length&&k.push(a.slice(g[L-1].wholeMatch.end)),m=k.join("")}return m},n.helper.regexIndexOf=function(a,c,u){if(!n.helper.isString(a))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(c instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var f=a.substring(u||0).search(c);return f>=0?f+(u||0):f},n.helper.splitAtIndex=function(a,c){if(!n.helper.isString(a))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[a.substring(0,c),a.substring(c)]},n.helper.encodeEmailAddress=function(a){var c=[function(u){return"&#"+u.charCodeAt(0)+";"},function(u){return"&#x"+u.charCodeAt(0).toString(16)+";"},function(u){return u}];return a=a.replace(/./g,function(u){if(u==="@")u=c[Math.floor(Math.random()*2)](u);else{var f=Math.random();u=f>.9?c[2](u):f>.45?c[1](u):c[0](u)}return u}),a},n.helper.padEnd=function(c,u,f){return u=u>>0,f=String(f||" "),c.length>u?String(c):(u=u-c.length,u>f.length&&(f+=f.repeat(u/f.length)),String(c)+f.slice(0,u))},typeof console>"u"&&(console={warn:function(a){alert(a)},log:function(a){alert(a)},error:function(a){throw a}}),n.helper.regexes={asteriskDashAndColon:/([*_:~])/g},n.helper.emojis={"+1":"👍","-1":"👎",100:"💯",1234:"🔢","1st_place_medal":"🥇","2nd_place_medal":"🥈","3rd_place_medal":"🥉","8ball":"🎱",a:"🅰️",ab:"🆎",abc:"🔤",abcd:"🔡",accept:"🉑",aerial_tramway:"🚡",airplane:"✈️",alarm_clock:"⏰",alembic:"⚗️",alien:"👽",ambulance:"🚑",amphora:"🏺",anchor:"⚓️",angel:"👼",anger:"💢",angry:"😠",anguished:"😧",ant:"🐜",apple:"🍎",aquarius:"♒️",aries:"♈️",arrow_backward:"◀️",arrow_double_down:"⏬",arrow_double_up:"⏫",arrow_down:"⬇️",arrow_down_small:"🔽",arrow_forward:"▶️",arrow_heading_down:"⤵️",arrow_heading_up:"⤴️",arrow_left:"⬅️",arrow_lower_left:"↙️",arrow_lower_right:"↘️",arrow_right:"➡️",arrow_right_hook:"↪️",arrow_up:"⬆️",arrow_up_down:"↕️",arrow_up_small:"🔼",arrow_upper_left:"↖️",arrow_upper_right:"↗️",arrows_clockwise:"🔃",arrows_counterclockwise:"🔄",art:"🎨",articulated_lorry:"🚛",artificial_satellite:"🛰",astonished:"😲",athletic_shoe:"👟",atm:"🏧",atom_symbol:"⚛️",avocado:"🥑",b:"🅱️",baby:"👶",baby_bottle:"🍼",baby_chick:"🐤",baby_symbol:"🚼",back:"🔙",bacon:"🥓",badminton:"🏸",baggage_claim:"🛄",baguette_bread:"🥖",balance_scale:"⚖️",balloon:"🎈",ballot_box:"🗳",ballot_box_with_check:"☑️",bamboo:"🎍",banana:"🍌",bangbang:"‼️",bank:"🏦",bar_chart:"📊",barber:"💈",baseball:"⚾️",basketball:"🏀",basketball_man:"⛹️",basketball_woman:"⛹️&zwj;♀️",bat:"🦇",bath:"🛀",bathtub:"🛁",battery:"🔋",beach_umbrella:"🏖",bear:"🐻",bed:"🛏",bee:"🐝",beer:"🍺",beers:"🍻",beetle:"🐞",beginner:"🔰",bell:"🔔",bellhop_bell:"🛎",bento:"🍱",biking_man:"🚴",bike:"🚲",biking_woman:"🚴&zwj;♀️",bikini:"👙",biohazard:"☣️",bird:"🐦",birthday:"🎂",black_circle:"⚫️",black_flag:"🏴",black_heart:"🖤",black_joker:"🃏",black_large_square:"⬛️",black_medium_small_square:"◾️",black_medium_square:"◼️",black_nib:"✒️",black_small_square:"▪️",black_square_button:"🔲",blonde_man:"👱",blonde_woman:"👱&zwj;♀️",blossom:"🌼",blowfish:"🐡",blue_book:"📘",blue_car:"🚙",blue_heart:"💙",blush:"😊",boar:"🐗",boat:"⛵️",bomb:"💣",book:"📖",bookmark:"🔖",bookmark_tabs:"📑",books:"📚",boom:"💥",boot:"👢",bouquet:"💐",bowing_man:"🙇",bow_and_arrow:"🏹",bowing_woman:"🙇&zwj;♀️",bowling:"🎳",boxing_glove:"🥊",boy:"👦",bread:"🍞",bride_with_veil:"👰",bridge_at_night:"🌉",briefcase:"💼",broken_heart:"💔",bug:"🐛",building_construction:"🏗",bulb:"💡",bullettrain_front:"🚅",bullettrain_side:"🚄",burrito:"🌯",bus:"🚌",business_suit_levitating:"🕴",busstop:"🚏",bust_in_silhouette:"👤",busts_in_silhouette:"👥",butterfly:"🦋",cactus:"🌵",cake:"🍰",calendar:"📆",call_me_hand:"🤙",calling:"📲",camel:"🐫",camera:"📷",camera_flash:"📸",camping:"🏕",cancer:"♋️",candle:"🕯",candy:"🍬",canoe:"🛶",capital_abcd:"🔠",capricorn:"♑️",car:"🚗",card_file_box:"🗃",card_index:"📇",card_index_dividers:"🗂",carousel_horse:"🎠",carrot:"🥕",cat:"🐱",cat2:"🐈",cd:"💿",chains:"⛓",champagne:"🍾",chart:"💹",chart_with_downwards_trend:"📉",chart_with_upwards_trend:"📈",checkered_flag:"🏁",cheese:"🧀",cherries:"🍒",cherry_blossom:"🌸",chestnut:"🌰",chicken:"🐔",children_crossing:"🚸",chipmunk:"🐿",chocolate_bar:"🍫",christmas_tree:"🎄",church:"⛪️",cinema:"🎦",circus_tent:"🎪",city_sunrise:"🌇",city_sunset:"🌆",cityscape:"🏙",cl:"🆑",clamp:"🗜",clap:"👏",clapper:"🎬",classical_building:"🏛",clinking_glasses:"🥂",clipboard:"📋",clock1:"🕐",clock10:"🕙",clock1030:"🕥",clock11:"🕚",clock1130:"🕦",clock12:"🕛",clock1230:"🕧",clock130:"🕜",clock2:"🕑",clock230:"🕝",clock3:"🕒",clock330:"🕞",clock4:"🕓",clock430:"🕟",clock5:"🕔",clock530:"🕠",clock6:"🕕",clock630:"🕡",clock7:"🕖",clock730:"🕢",clock8:"🕗",clock830:"🕣",clock9:"🕘",clock930:"🕤",closed_book:"📕",closed_lock_with_key:"🔐",closed_umbrella:"🌂",cloud:"☁️",cloud_with_lightning:"🌩",cloud_with_lightning_and_rain:"⛈",cloud_with_rain:"🌧",cloud_with_snow:"🌨",clown_face:"🤡",clubs:"♣️",cocktail:"🍸",coffee:"☕️",coffin:"⚰️",cold_sweat:"😰",comet:"☄️",computer:"💻",computer_mouse:"🖱",confetti_ball:"🎊",confounded:"😖",confused:"😕",congratulations:"㊗️",construction:"🚧",construction_worker_man:"👷",construction_worker_woman:"👷&zwj;♀️",control_knobs:"🎛",convenience_store:"🏪",cookie:"🍪",cool:"🆒",policeman:"👮",copyright:"©️",corn:"🌽",couch_and_lamp:"🛋",couple:"👫",couple_with_heart_woman_man:"💑",couple_with_heart_man_man:"👨&zwj;❤️&zwj;👨",couple_with_heart_woman_woman:"👩&zwj;❤️&zwj;👩",couplekiss_man_man:"👨&zwj;❤️&zwj;💋&zwj;👨",couplekiss_man_woman:"💏",couplekiss_woman_woman:"👩&zwj;❤️&zwj;💋&zwj;👩",cow:"🐮",cow2:"🐄",cowboy_hat_face:"🤠",crab:"🦀",crayon:"🖍",credit_card:"💳",crescent_moon:"🌙",cricket:"🏏",crocodile:"🐊",croissant:"🥐",crossed_fingers:"🤞",crossed_flags:"🎌",crossed_swords:"⚔️",crown:"👑",cry:"😢",crying_cat_face:"😿",crystal_ball:"🔮",cucumber:"🥒",cupid:"💘",curly_loop:"➰",currency_exchange:"💱",curry:"🍛",custard:"🍮",customs:"🛃",cyclone:"🌀",dagger:"🗡",dancer:"💃",dancing_women:"👯",dancing_men:"👯&zwj;♂️",dango:"🍡",dark_sunglasses:"🕶",dart:"🎯",dash:"💨",date:"📅",deciduous_tree:"🌳",deer:"🦌",department_store:"🏬",derelict_house:"🏚",desert:"🏜",desert_island:"🏝",desktop_computer:"🖥",male_detective:"🕵️",diamond_shape_with_a_dot_inside:"💠",diamonds:"♦️",disappointed:"😞",disappointed_relieved:"😥",dizzy:"💫",dizzy_face:"😵",do_not_litter:"🚯",dog:"🐶",dog2:"🐕",dollar:"💵",dolls:"🎎",dolphin:"🐬",door:"🚪",doughnut:"🍩",dove:"🕊",dragon:"🐉",dragon_face:"🐲",dress:"👗",dromedary_camel:"🐪",drooling_face:"🤤",droplet:"💧",drum:"🥁",duck:"🦆",dvd:"📀","e-mail":"📧",eagle:"🦅",ear:"👂",ear_of_rice:"🌾",earth_africa:"🌍",earth_americas:"🌎",earth_asia:"🌏",egg:"🥚",eggplant:"🍆",eight_pointed_black_star:"✴️",eight_spoked_asterisk:"✳️",electric_plug:"🔌",elephant:"🐘",email:"✉️",end:"🔚",envelope_with_arrow:"📩",euro:"💶",european_castle:"🏰",european_post_office:"🏤",evergreen_tree:"🌲",exclamation:"❗️",expressionless:"😑",eye:"👁",eye_speech_bubble:"👁&zwj;🗨",eyeglasses:"👓",eyes:"👀",face_with_head_bandage:"🤕",face_with_thermometer:"🤒",fist_oncoming:"👊",factory:"🏭",fallen_leaf:"🍂",family_man_woman_boy:"👪",family_man_boy:"👨&zwj;👦",family_man_boy_boy:"👨&zwj;👦&zwj;👦",family_man_girl:"👨&zwj;👧",family_man_girl_boy:"👨&zwj;👧&zwj;👦",family_man_girl_girl:"👨&zwj;👧&zwj;👧",family_man_man_boy:"👨&zwj;👨&zwj;👦",family_man_man_boy_boy:"👨&zwj;👨&zwj;👦&zwj;👦",family_man_man_girl:"👨&zwj;👨&zwj;👧",family_man_man_girl_boy:"👨&zwj;👨&zwj;👧&zwj;👦",family_man_man_girl_girl:"👨&zwj;👨&zwj;👧&zwj;👧",family_man_woman_boy_boy:"👨&zwj;👩&zwj;👦&zwj;👦",family_man_woman_girl:"👨&zwj;👩&zwj;👧",family_man_woman_girl_boy:"👨&zwj;👩&zwj;👧&zwj;👦",family_man_woman_girl_girl:"👨&zwj;👩&zwj;👧&zwj;👧",family_woman_boy:"👩&zwj;👦",family_woman_boy_boy:"👩&zwj;👦&zwj;👦",family_woman_girl:"👩&zwj;👧",family_woman_girl_boy:"👩&zwj;👧&zwj;👦",family_woman_girl_girl:"👩&zwj;👧&zwj;👧",family_woman_woman_boy:"👩&zwj;👩&zwj;👦",family_woman_woman_boy_boy:"👩&zwj;👩&zwj;👦&zwj;👦",family_woman_woman_girl:"👩&zwj;👩&zwj;👧",family_woman_woman_girl_boy:"👩&zwj;👩&zwj;👧&zwj;👦",family_woman_woman_girl_girl:"👩&zwj;👩&zwj;👧&zwj;👧",fast_forward:"⏩",fax:"📠",fearful:"😨",feet:"🐾",female_detective:"🕵️&zwj;♀️",ferris_wheel:"🎡",ferry:"⛴",field_hockey:"🏑",file_cabinet:"🗄",file_folder:"📁",film_projector:"📽",film_strip:"🎞",fire:"🔥",fire_engine:"🚒",fireworks:"🎆",first_quarter_moon:"🌓",first_quarter_moon_with_face:"🌛",fish:"🐟",fish_cake:"🍥",fishing_pole_and_fish:"🎣",fist_raised:"✊",fist_left:"🤛",fist_right:"🤜",flags:"🎏",flashlight:"🔦",fleur_de_lis:"⚜️",flight_arrival:"🛬",flight_departure:"🛫",floppy_disk:"💾",flower_playing_cards:"🎴",flushed:"😳",fog:"🌫",foggy:"🌁",football:"🏈",footprints:"👣",fork_and_knife:"🍴",fountain:"⛲️",fountain_pen:"🖋",four_leaf_clover:"🍀",fox_face:"🦊",framed_picture:"🖼",free:"🆓",fried_egg:"🍳",fried_shrimp:"🍤",fries:"🍟",frog:"🐸",frowning:"😦",frowning_face:"☹️",frowning_man:"🙍&zwj;♂️",frowning_woman:"🙍",middle_finger:"🖕",fuelpump:"⛽️",full_moon:"🌕",full_moon_with_face:"🌝",funeral_urn:"⚱️",game_die:"🎲",gear:"⚙️",gem:"💎",gemini:"♊️",ghost:"👻",gift:"🎁",gift_heart:"💝",girl:"👧",globe_with_meridians:"🌐",goal_net:"🥅",goat:"🐐",golf:"⛳️",golfing_man:"🏌️",golfing_woman:"🏌️&zwj;♀️",gorilla:"🦍",grapes:"🍇",green_apple:"🍏",green_book:"📗",green_heart:"💚",green_salad:"🥗",grey_exclamation:"❕",grey_question:"❔",grimacing:"😬",grin:"😁",grinning:"😀",guardsman:"💂",guardswoman:"💂&zwj;♀️",guitar:"🎸",gun:"🔫",haircut_woman:"💇",haircut_man:"💇&zwj;♂️",hamburger:"🍔",hammer:"🔨",hammer_and_pick:"⚒",hammer_and_wrench:"🛠",hamster:"🐹",hand:"✋",handbag:"👜",handshake:"🤝",hankey:"💩",hatched_chick:"🐥",hatching_chick:"🐣",headphones:"🎧",hear_no_evil:"🙉",heart:"❤️",heart_decoration:"💟",heart_eyes:"😍",heart_eyes_cat:"😻",heartbeat:"💓",heartpulse:"💗",hearts:"♥️",heavy_check_mark:"✔️",heavy_division_sign:"➗",heavy_dollar_sign:"💲",heavy_heart_exclamation:"❣️",heavy_minus_sign:"➖",heavy_multiplication_x:"✖️",heavy_plus_sign:"➕",helicopter:"🚁",herb:"🌿",hibiscus:"🌺",high_brightness:"🔆",high_heel:"👠",hocho:"🔪",hole:"🕳",honey_pot:"🍯",horse:"🐴",horse_racing:"🏇",hospital:"🏥",hot_pepper:"🌶",hotdog:"🌭",hotel:"🏨",hotsprings:"♨️",hourglass:"⌛️",hourglass_flowing_sand:"⏳",house:"🏠",house_with_garden:"🏡",houses:"🏘",hugs:"🤗",hushed:"😯",ice_cream:"🍨",ice_hockey:"🏒",ice_skate:"⛸",icecream:"🍦",id:"🆔",ideograph_advantage:"🉐",imp:"👿",inbox_tray:"📥",incoming_envelope:"📨",tipping_hand_woman:"💁",information_source:"ℹ️",innocent:"😇",interrobang:"⁉️",iphone:"📱",izakaya_lantern:"🏮",jack_o_lantern:"🎃",japan:"🗾",japanese_castle:"🏯",japanese_goblin:"👺",japanese_ogre:"👹",jeans:"👖",joy:"😂",joy_cat:"😹",joystick:"🕹",kaaba:"🕋",key:"🔑",keyboard:"⌨️",keycap_ten:"🔟",kick_scooter:"🛴",kimono:"👘",kiss:"💋",kissing:"😗",kissing_cat:"😽",kissing_closed_eyes:"😚",kissing_heart:"😘",kissing_smiling_eyes:"😙",kiwi_fruit:"🥝",koala:"🐨",koko:"🈁",label:"🏷",large_blue_circle:"🔵",large_blue_diamond:"🔷",large_orange_diamond:"🔶",last_quarter_moon:"🌗",last_quarter_moon_with_face:"🌜",latin_cross:"✝️",laughing:"😆",leaves:"🍃",ledger:"📒",left_luggage:"🛅",left_right_arrow:"↔️",leftwards_arrow_with_hook:"↩️",lemon:"🍋",leo:"♌️",leopard:"🐆",level_slider:"🎚",libra:"♎️",light_rail:"🚈",link:"🔗",lion:"🦁",lips:"👄",lipstick:"💄",lizard:"🦎",lock:"🔒",lock_with_ink_pen:"🔏",lollipop:"🍭",loop:"➿",loud_sound:"🔊",loudspeaker:"📢",love_hotel:"🏩",love_letter:"💌",low_brightness:"🔅",lying_face:"🤥",m:"Ⓜ️",mag:"🔍",mag_right:"🔎",mahjong:"🀄️",mailbox:"📫",mailbox_closed:"📪",mailbox_with_mail:"📬",mailbox_with_no_mail:"📭",man:"👨",man_artist:"👨&zwj;🎨",man_astronaut:"👨&zwj;🚀",man_cartwheeling:"🤸&zwj;♂️",man_cook:"👨&zwj;🍳",man_dancing:"🕺",man_facepalming:"🤦&zwj;♂️",man_factory_worker:"👨&zwj;🏭",man_farmer:"👨&zwj;🌾",man_firefighter:"👨&zwj;🚒",man_health_worker:"👨&zwj;⚕️",man_in_tuxedo:"🤵",man_judge:"👨&zwj;⚖️",man_juggling:"🤹&zwj;♂️",man_mechanic:"👨&zwj;🔧",man_office_worker:"👨&zwj;💼",man_pilot:"👨&zwj;✈️",man_playing_handball:"🤾&zwj;♂️",man_playing_water_polo:"🤽&zwj;♂️",man_scientist:"👨&zwj;🔬",man_shrugging:"🤷&zwj;♂️",man_singer:"👨&zwj;🎤",man_student:"👨&zwj;🎓",man_teacher:"👨&zwj;🏫",man_technologist:"👨&zwj;💻",man_with_gua_pi_mao:"👲",man_with_turban:"👳",tangerine:"🍊",mans_shoe:"👞",mantelpiece_clock:"🕰",maple_leaf:"🍁",martial_arts_uniform:"🥋",mask:"😷",massage_woman:"💆",massage_man:"💆&zwj;♂️",meat_on_bone:"🍖",medal_military:"🎖",medal_sports:"🏅",mega:"📣",melon:"🍈",memo:"📝",men_wrestling:"🤼&zwj;♂️",menorah:"🕎",mens:"🚹",metal:"🤘",metro:"🚇",microphone:"🎤",microscope:"🔬",milk_glass:"🥛",milky_way:"🌌",minibus:"🚐",minidisc:"💽",mobile_phone_off:"📴",money_mouth_face:"🤑",money_with_wings:"💸",moneybag:"💰",monkey:"🐒",monkey_face:"🐵",monorail:"🚝",moon:"🌔",mortar_board:"🎓",mosque:"🕌",motor_boat:"🛥",motor_scooter:"🛵",motorcycle:"🏍",motorway:"🛣",mount_fuji:"🗻",mountain:"⛰",mountain_biking_man:"🚵",mountain_biking_woman:"🚵&zwj;♀️",mountain_cableway:"🚠",mountain_railway:"🚞",mountain_snow:"🏔",mouse:"🐭",mouse2:"🐁",movie_camera:"🎥",moyai:"🗿",mrs_claus:"🤶",muscle:"💪",mushroom:"🍄",musical_keyboard:"🎹",musical_note:"🎵",musical_score:"🎼",mute:"🔇",nail_care:"💅",name_badge:"📛",national_park:"🏞",nauseated_face:"🤢",necktie:"👔",negative_squared_cross_mark:"❎",nerd_face:"🤓",neutral_face:"😐",new:"🆕",new_moon:"🌑",new_moon_with_face:"🌚",newspaper:"📰",newspaper_roll:"🗞",next_track_button:"⏭",ng:"🆖",no_good_man:"🙅&zwj;♂️",no_good_woman:"🙅",night_with_stars:"🌃",no_bell:"🔕",no_bicycles:"🚳",no_entry:"⛔️",no_entry_sign:"🚫",no_mobile_phones:"📵",no_mouth:"😶",no_pedestrians:"🚷",no_smoking:"🚭","non-potable_water":"🚱",nose:"👃",notebook:"📓",notebook_with_decorative_cover:"📔",notes:"🎶",nut_and_bolt:"🔩",o:"⭕️",o2:"🅾️",ocean:"🌊",octopus:"🐙",oden:"🍢",office:"🏢",oil_drum:"🛢",ok:"🆗",ok_hand:"👌",ok_man:"🙆&zwj;♂️",ok_woman:"🙆",old_key:"🗝",older_man:"👴",older_woman:"👵",om:"🕉",on:"🔛",oncoming_automobile:"🚘",oncoming_bus:"🚍",oncoming_police_car:"🚔",oncoming_taxi:"🚖",open_file_folder:"📂",open_hands:"👐",open_mouth:"😮",open_umbrella:"☂️",ophiuchus:"⛎",orange_book:"📙",orthodox_cross:"☦️",outbox_tray:"📤",owl:"🦉",ox:"🐂",package:"📦",page_facing_up:"📄",page_with_curl:"📃",pager:"📟",paintbrush:"🖌",palm_tree:"🌴",pancakes:"🥞",panda_face:"🐼",paperclip:"📎",paperclips:"🖇",parasol_on_ground:"⛱",parking:"🅿️",part_alternation_mark:"〽️",partly_sunny:"⛅️",passenger_ship:"🛳",passport_control:"🛂",pause_button:"⏸",peace_symbol:"☮️",peach:"🍑",peanuts:"🥜",pear:"🍐",pen:"🖊",pencil2:"✏️",penguin:"🐧",pensive:"😔",performing_arts:"🎭",persevere:"😣",person_fencing:"🤺",pouting_woman:"🙎",phone:"☎️",pick:"⛏",pig:"🐷",pig2:"🐖",pig_nose:"🐽",pill:"💊",pineapple:"🍍",ping_pong:"🏓",pisces:"♓️",pizza:"🍕",place_of_worship:"🛐",plate_with_cutlery:"🍽",play_or_pause_button:"⏯",point_down:"👇",point_left:"👈",point_right:"👉",point_up:"☝️",point_up_2:"👆",police_car:"🚓",policewoman:"👮&zwj;♀️",poodle:"🐩",popcorn:"🍿",post_office:"🏣",postal_horn:"📯",postbox:"📮",potable_water:"🚰",potato:"🥔",pouch:"👝",poultry_leg:"🍗",pound:"💷",rage:"😡",pouting_cat:"😾",pouting_man:"🙎&zwj;♂️",pray:"🙏",prayer_beads:"📿",pregnant_woman:"🤰",previous_track_button:"⏮",prince:"🤴",princess:"👸",printer:"🖨",purple_heart:"💜",purse:"👛",pushpin:"📌",put_litter_in_its_place:"🚮",question:"❓",rabbit:"🐰",rabbit2:"🐇",racehorse:"🐎",racing_car:"🏎",radio:"📻",radio_button:"🔘",radioactive:"☢️",railway_car:"🚃",railway_track:"🛤",rainbow:"🌈",rainbow_flag:"🏳️&zwj;🌈",raised_back_of_hand:"🤚",raised_hand_with_fingers_splayed:"🖐",raised_hands:"🙌",raising_hand_woman:"🙋",raising_hand_man:"🙋&zwj;♂️",ram:"🐏",ramen:"🍜",rat:"🐀",record_button:"⏺",recycle:"♻️",red_circle:"🔴",registered:"®️",relaxed:"☺️",relieved:"😌",reminder_ribbon:"🎗",repeat:"🔁",repeat_one:"🔂",rescue_worker_helmet:"⛑",restroom:"🚻",revolving_hearts:"💞",rewind:"⏪",rhinoceros:"🦏",ribbon:"🎀",rice:"🍚",rice_ball:"🍙",rice_cracker:"🍘",rice_scene:"🎑",right_anger_bubble:"🗯",ring:"💍",robot:"🤖",rocket:"🚀",rofl:"🤣",roll_eyes:"🙄",roller_coaster:"🎢",rooster:"🐓",rose:"🌹",rosette:"🏵",rotating_light:"🚨",round_pushpin:"📍",rowing_man:"🚣",rowing_woman:"🚣&zwj;♀️",rugby_football:"🏉",running_man:"🏃",running_shirt_with_sash:"🎽",running_woman:"🏃&zwj;♀️",sa:"🈂️",sagittarius:"♐️",sake:"🍶",sandal:"👡",santa:"🎅",satellite:"📡",saxophone:"🎷",school:"🏫",school_satchel:"🎒",scissors:"✂️",scorpion:"🦂",scorpius:"♏️",scream:"😱",scream_cat:"🙀",scroll:"📜",seat:"💺",secret:"㊙️",see_no_evil:"🙈",seedling:"🌱",selfie:"🤳",shallow_pan_of_food:"🥘",shamrock:"☘️",shark:"🦈",shaved_ice:"🍧",sheep:"🐑",shell:"🐚",shield:"🛡",shinto_shrine:"⛩",ship:"🚢",shirt:"👕",shopping:"🛍",shopping_cart:"🛒",shower:"🚿",shrimp:"🦐",signal_strength:"📶",six_pointed_star:"🔯",ski:"🎿",skier:"⛷",skull:"💀",skull_and_crossbones:"☠️",sleeping:"😴",sleeping_bed:"🛌",sleepy:"😪",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",slot_machine:"🎰",small_airplane:"🛩",small_blue_diamond:"🔹",small_orange_diamond:"🔸",small_red_triangle:"🔺",small_red_triangle_down:"🔻",smile:"😄",smile_cat:"😸",smiley:"😃",smiley_cat:"😺",smiling_imp:"😈",smirk:"😏",smirk_cat:"😼",smoking:"🚬",snail:"🐌",snake:"🐍",sneezing_face:"🤧",snowboarder:"🏂",snowflake:"❄️",snowman:"⛄️",snowman_with_snow:"☃️",sob:"😭",soccer:"⚽️",soon:"🔜",sos:"🆘",sound:"🔉",space_invader:"👾",spades:"♠️",spaghetti:"🍝",sparkle:"❇️",sparkler:"🎇",sparkles:"✨",sparkling_heart:"💖",speak_no_evil:"🙊",speaker:"🔈",speaking_head:"🗣",speech_balloon:"💬",speedboat:"🚤",spider:"🕷",spider_web:"🕸",spiral_calendar:"🗓",spiral_notepad:"🗒",spoon:"🥄",squid:"🦑",stadium:"🏟",star:"⭐️",star2:"🌟",star_and_crescent:"☪️",star_of_david:"✡️",stars:"🌠",station:"🚉",statue_of_liberty:"🗽",steam_locomotive:"🚂",stew:"🍲",stop_button:"⏹",stop_sign:"🛑",stopwatch:"⏱",straight_ruler:"📏",strawberry:"🍓",stuck_out_tongue:"😛",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue_winking_eye:"😜",studio_microphone:"🎙",stuffed_flatbread:"🥙",sun_behind_large_cloud:"🌥",sun_behind_rain_cloud:"🌦",sun_behind_small_cloud:"🌤",sun_with_face:"🌞",sunflower:"🌻",sunglasses:"😎",sunny:"☀️",sunrise:"🌅",sunrise_over_mountains:"🌄",surfing_man:"🏄",surfing_woman:"🏄&zwj;♀️",sushi:"🍣",suspension_railway:"🚟",sweat:"😓",sweat_drops:"💦",sweat_smile:"😅",sweet_potato:"🍠",swimming_man:"🏊",swimming_woman:"🏊&zwj;♀️",symbols:"🔣",synagogue:"🕍",syringe:"💉",taco:"🌮",tada:"🎉",tanabata_tree:"🎋",taurus:"♉️",taxi:"🚕",tea:"🍵",telephone_receiver:"📞",telescope:"🔭",tennis:"🎾",tent:"⛺️",thermometer:"🌡",thinking:"🤔",thought_balloon:"💭",ticket:"🎫",tickets:"🎟",tiger:"🐯",tiger2:"🐅",timer_clock:"⏲",tipping_hand_man:"💁&zwj;♂️",tired_face:"😫",tm:"™️",toilet:"🚽",tokyo_tower:"🗼",tomato:"🍅",tongue:"👅",top:"🔝",tophat:"🎩",tornado:"🌪",trackball:"🖲",tractor:"🚜",traffic_light:"🚥",train:"🚋",train2:"🚆",tram:"🚊",triangular_flag_on_post:"🚩",triangular_ruler:"📐",trident:"🔱",triumph:"😤",trolleybus:"🚎",trophy:"🏆",tropical_drink:"🍹",tropical_fish:"🐠",truck:"🚚",trumpet:"🎺",tulip:"🌷",tumbler_glass:"🥃",turkey:"🦃",turtle:"🐢",tv:"📺",twisted_rightwards_arrows:"🔀",two_hearts:"💕",two_men_holding_hands:"👬",two_women_holding_hands:"👭",u5272:"🈹",u5408:"🈴",u55b6:"🈺",u6307:"🈯️",u6708:"🈷️",u6709:"🈶",u6e80:"🈵",u7121:"🈚️",u7533:"🈸",u7981:"🈲",u7a7a:"🈳",umbrella:"☔️",unamused:"😒",underage:"🔞",unicorn:"🦄",unlock:"🔓",up:"🆙",upside_down_face:"🙃",v:"✌️",vertical_traffic_light:"🚦",vhs:"📼",vibration_mode:"📳",video_camera:"📹",video_game:"🎮",violin:"🎻",virgo:"♍️",volcano:"🌋",volleyball:"🏐",vs:"🆚",vulcan_salute:"🖖",walking_man:"🚶",walking_woman:"🚶&zwj;♀️",waning_crescent_moon:"🌘",waning_gibbous_moon:"🌖",warning:"⚠️",wastebasket:"🗑",watch:"⌚️",water_buffalo:"🐃",watermelon:"🍉",wave:"👋",wavy_dash:"〰️",waxing_crescent_moon:"🌒",wc:"🚾",weary:"😩",wedding:"💒",weight_lifting_man:"🏋️",weight_lifting_woman:"🏋️&zwj;♀️",whale:"🐳",whale2:"🐋",wheel_of_dharma:"☸️",wheelchair:"♿️",white_check_mark:"✅",white_circle:"⚪️",white_flag:"🏳️",white_flower:"💮",white_large_square:"⬜️",white_medium_small_square:"◽️",white_medium_square:"◻️",white_small_square:"▫️",white_square_button:"🔳",wilted_flower:"🥀",wind_chime:"🎐",wind_face:"🌬",wine_glass:"🍷",wink:"😉",wolf:"🐺",woman:"👩",woman_artist:"👩&zwj;🎨",woman_astronaut:"👩&zwj;🚀",woman_cartwheeling:"🤸&zwj;♀️",woman_cook:"👩&zwj;🍳",woman_facepalming:"🤦&zwj;♀️",woman_factory_worker:"👩&zwj;🏭",woman_farmer:"👩&zwj;🌾",woman_firefighter:"👩&zwj;🚒",woman_health_worker:"👩&zwj;⚕️",woman_judge:"👩&zwj;⚖️",woman_juggling:"🤹&zwj;♀️",woman_mechanic:"👩&zwj;🔧",woman_office_worker:"👩&zwj;💼",woman_pilot:"👩&zwj;✈️",woman_playing_handball:"🤾&zwj;♀️",woman_playing_water_polo:"🤽&zwj;♀️",woman_scientist:"👩&zwj;🔬",woman_shrugging:"🤷&zwj;♀️",woman_singer:"👩&zwj;🎤",woman_student:"👩&zwj;🎓",woman_teacher:"👩&zwj;🏫",woman_technologist:"👩&zwj;💻",woman_with_turban:"👳&zwj;♀️",womans_clothes:"👚",womans_hat:"👒",women_wrestling:"🤼&zwj;♀️",womens:"🚺",world_map:"🗺",worried:"😟",wrench:"🔧",writing_hand:"✍️",x:"❌",yellow_heart:"💛",yen:"💴",yin_yang:"☯️",yum:"😋",zap:"⚡️",zipper_mouth_face:"🤐",zzz:"💤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},n.Converter=function(a){var c={},u=[],f=[],y={},v=l,g={parsed:{},raw:"",format:""};m();function m(){a=a||{};for(var w in s)s.hasOwnProperty(w)&&(c[w]=s[w]);if(typeof a=="object")for(var $ in a)a.hasOwnProperty($)&&(c[$]=a[$]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof a+" was passed instead.");c.extensions&&n.helper.forEach(c.extensions,L)}function L(w,$){if($=$||null,n.helper.isString(w))if(w=n.helper.stdExtName(w),$=w,n.extensions[w]){console.warn("DEPRECATION WARNING: "+w+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),k(n.extensions[w],w);return}else if(!n.helper.isUndefined(o[w]))w=o[w];else throw Error('Extension "'+w+'" could not be loaded. It was either not found or is not a valid extension.');typeof w=="function"&&(w=w()),n.helper.isArray(w)||(w=[w]);var F=h(w,$);if(!F.valid)throw Error(F.error);for(var B=0;B<w.length;++B){switch(w[B].type){case"lang":u.push(w[B]);break;case"output":f.push(w[B]);break}if(w[B].hasOwnProperty("listeners"))for(var q in w[B].listeners)w[B].listeners.hasOwnProperty(q)&&C(q,w[B].listeners[q])}}function k(w,$){typeof w=="function"&&(w=w(new n.Converter)),n.helper.isArray(w)||(w=[w]);var F=h(w,$);if(!F.valid)throw Error(F.error);for(var B=0;B<w.length;++B)switch(w[B].type){case"lang":u.push(w[B]);break;case"output":f.push(w[B]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function C(w,$){if(!n.helper.isString(w))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof w+" given");if(typeof $!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof $+" given");y.hasOwnProperty(w)||(y[w]=[]),y[w].push($)}function A(w){var $=w.match(/^\s*/)[0].length,F=new RegExp("^\\s{0,"+$+"}","gm");return w.replace(F,"")}this._dispatch=function($,F,B,q){if(y.hasOwnProperty($))for(var G=0;G<y[$].length;++G){var te=y[$][G]($,F,this,B,q);te&&typeof te<"u"&&(F=te)}return F},this.listen=function(w,$){return C(w,$),this},this.makeHtml=function(w){if(!w)return w;var $={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:u,outputModifiers:f,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return w=w.replace(/¨/g,"¨T"),w=w.replace(/\$/g,"¨D"),w=w.replace(/\r\n/g,`
`),w=w.replace(/\r/g,`
`),w=w.replace(/\u00A0/g,"&nbsp;"),c.smartIndentationFix&&(w=A(w)),w=`

`+w+`

`,w=n.subParser("detab")(w,c,$),w=w.replace(/^[ \t]+$/mg,""),n.helper.forEach(u,function(F){w=n.subParser("runExtension")(F,w,c,$)}),w=n.subParser("metadata")(w,c,$),w=n.subParser("hashPreCodeTags")(w,c,$),w=n.subParser("githubCodeBlocks")(w,c,$),w=n.subParser("hashHTMLBlocks")(w,c,$),w=n.subParser("hashCodeTags")(w,c,$),w=n.subParser("stripLinkDefinitions")(w,c,$),w=n.subParser("blockGamut")(w,c,$),w=n.subParser("unhashHTMLSpans")(w,c,$),w=n.subParser("unescapeSpecialChars")(w,c,$),w=w.replace(/¨D/g,"$$"),w=w.replace(/¨T/g,"¨"),w=n.subParser("completeHTMLDocument")(w,c,$),n.helper.forEach(f,function(F){w=n.subParser("runExtension")(F,w,c,$)}),g=$.metadata,w},this.makeMarkdown=this.makeMd=function(w,$){if(w=w.replace(/\r\n/g,`
`),w=w.replace(/\r/g,`
`),w=w.replace(/>[ \t]+</,">¨NBSP;<"),!$)if(window&&window.document)$=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var F=$.createElement("div");F.innerHTML=w;var B={preList:se(F)};ie(F);for(var q=F.childNodes,G="",te=0;te<q.length;te++)G+=n.subParser("makeMarkdown.node")(q[te],B);function ie(Z){for(var Q=0;Q<Z.childNodes.length;++Q){var le=Z.childNodes[Q];le.nodeType===3?!/\S/.test(le.nodeValue)&&!/^[ ]+$/.test(le.nodeValue)?(Z.removeChild(le),--Q):(le.nodeValue=le.nodeValue.split(`
`).join(" "),le.nodeValue=le.nodeValue.replace(/(\s)+/g,"$1")):le.nodeType===1&&ie(le)}}function se(Z){for(var Q=Z.querySelectorAll("pre"),le=[],oe=0;oe<Q.length;++oe)if(Q[oe].childElementCount===1&&Q[oe].firstChild.tagName.toLowerCase()==="code"){var ke=Q[oe].firstChild.innerHTML.trim(),ce=Q[oe].firstChild.getAttribute("data-language")||"";if(ce==="")for(var $e=Q[oe].firstChild.className.split(" "),Me=0;Me<$e.length;++Me){var _e=$e[Me].match(/^language-(.+)$/);if(_e!==null){ce=_e[1];break}}ke=n.helper.unescapeHTMLEntities(ke),le.push(ke),Q[oe].outerHTML='<precode language="'+ce+'" precodenum="'+oe.toString()+'"></precode>'}else le.push(Q[oe].innerHTML),Q[oe].innerHTML="",Q[oe].setAttribute("prenum",oe.toString());return le}return G},this.setOption=function(w,$){c[w]=$},this.getOption=function(w){return c[w]},this.getOptions=function(){return c},this.addExtension=function(w,$){$=$||null,L(w,$)},this.useExtension=function(w){L(w)},this.setFlavor=function(w){if(!p.hasOwnProperty(w))throw Error(w+" flavor was not found");var $=p[w];v=w;for(var F in $)$.hasOwnProperty(F)&&(c[F]=$[F])},this.getFlavor=function(){return v},this.removeExtension=function(w){n.helper.isArray(w)||(w=[w]);for(var $=0;$<w.length;++$){for(var F=w[$],B=0;B<u.length;++B)u[B]===F&&u.splice(B,1);for(var q=0;q<f.length;++q)f[q]===F&&f.splice(q,1)}},this.getAllExtensions=function(){return{language:u,output:f}},this.getMetadata=function(w){return w?g.raw:g.parsed},this.getMetadataFormat=function(){return g.format},this._setMetadataPair=function(w,$){g.parsed[w]=$},this._setMetadataFormat=function(w){g.format=w},this._setMetadataRaw=function(w){g.raw=w}},n.subParser("anchors",function(a,c,u){a=u.converter._dispatch("anchors.before",a,c,u);var f=function(y,v,g,m,L,k,C){if(n.helper.isUndefined(C)&&(C=""),g=g.toLowerCase(),y.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)m="";else if(!m)if(g||(g=v.toLowerCase().replace(/ ?\n/g," ")),m="#"+g,!n.helper.isUndefined(u.gUrls[g]))m=u.gUrls[g],n.helper.isUndefined(u.gTitles[g])||(C=u.gTitles[g]);else return y;m=m.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var A='<a href="'+m+'"';return C!==""&&C!==null&&(C=C.replace(/"/g,"&quot;"),C=C.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),A+=' title="'+C+'"'),c.openLinksInNewWindow&&!/^#/.test(m)&&(A+=' rel="noopener noreferrer" target="¨E95Eblank"'),A+=">"+v+"</a>",A};return a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,f),a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,f),a=a.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,f),a=a.replace(/\[([^\[\]]+)]()()()()()/g,f),c.ghMentions&&(a=a.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(y,v,g,m,L){if(g==="\\")return v+m;if(!n.helper.isString(c.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var k=c.ghMentionsLink.replace(/\{u}/g,L),C="";return c.openLinksInNewWindow&&(C=' rel="noopener noreferrer" target="¨E95Eblank"'),v+'<a href="'+k+'"'+C+">"+m+"</a>"})),a=u.converter._dispatch("anchors.after",a,c,u),a});var N=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,D=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,O=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,X=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,H=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,V=function(a){return function(c,u,f,y,v,g,m){f=f.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var L=f,k="",C="",A=u||"",w=m||"";return/^www\./i.test(f)&&(f=f.replace(/^www\./i,"http://www.")),a.excludeTrailingPunctuationFromURLs&&g&&(k=g),a.openLinksInNewWindow&&(C=' rel="noopener noreferrer" target="¨E95Eblank"'),A+'<a href="'+f+'"'+C+">"+L+"</a>"+k+w}},M=function(a,c){return function(u,f,y){var v="mailto:";return f=f||"",y=n.subParser("unescapeSpecialChars")(y,a,c),a.encodeEmails?(v=n.helper.encodeEmailAddress(v+y),y=n.helper.encodeEmailAddress(y)):v=v+y,f+'<a href="'+v+'">'+y+"</a>"}};n.subParser("autoLinks",function(a,c,u){return a=u.converter._dispatch("autoLinks.before",a,c,u),a=a.replace(O,V(c)),a=a.replace(H,M(c,u)),a=u.converter._dispatch("autoLinks.after",a,c,u),a}),n.subParser("simplifiedAutoLinks",function(a,c,u){return c.simplifiedAutoLink&&(a=u.converter._dispatch("simplifiedAutoLinks.before",a,c,u),c.excludeTrailingPunctuationFromURLs?a=a.replace(D,V(c)):a=a.replace(N,V(c)),a=a.replace(X,M(c,u)),a=u.converter._dispatch("simplifiedAutoLinks.after",a,c,u)),a}),n.subParser("blockGamut",function(a,c,u){return a=u.converter._dispatch("blockGamut.before",a,c,u),a=n.subParser("blockQuotes")(a,c,u),a=n.subParser("headers")(a,c,u),a=n.subParser("horizontalRule")(a,c,u),a=n.subParser("lists")(a,c,u),a=n.subParser("codeBlocks")(a,c,u),a=n.subParser("tables")(a,c,u),a=n.subParser("hashHTMLBlocks")(a,c,u),a=n.subParser("paragraphs")(a,c,u),a=u.converter._dispatch("blockGamut.after",a,c,u),a}),n.subParser("blockQuotes",function(a,c,u){a=u.converter._dispatch("blockQuotes.before",a,c,u),a=a+`

`;var f=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return c.splitAdjacentBlockquotes&&(f=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),a=a.replace(f,function(y){return y=y.replace(/^[ \t]*>[ \t]?/gm,""),y=y.replace(/¨0/g,""),y=y.replace(/^[ \t]+$/gm,""),y=n.subParser("githubCodeBlocks")(y,c,u),y=n.subParser("blockGamut")(y,c,u),y=y.replace(/(^|\n)/g,"$1  "),y=y.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(v,g){var m=g;return m=m.replace(/^  /mg,"¨0"),m=m.replace(/¨0/g,""),m}),n.subParser("hashBlock")(`<blockquote>
`+y+`
</blockquote>`,c,u)}),a=u.converter._dispatch("blockQuotes.after",a,c,u),a}),n.subParser("codeBlocks",function(a,c,u){a=u.converter._dispatch("codeBlocks.before",a,c,u),a+="¨0";var f=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=¨0))/g;return a=a.replace(f,function(y,v,g){var m=v,L=g,k=`
`;return m=n.subParser("outdent")(m,c,u),m=n.subParser("encodeCode")(m,c,u),m=n.subParser("detab")(m,c,u),m=m.replace(/^\n+/g,""),m=m.replace(/\n+$/g,""),c.omitExtraWLInCodeBlocks&&(k=""),m="<pre><code>"+m+k+"</code></pre>",n.subParser("hashBlock")(m,c,u)+L}),a=a.replace(/¨0/,""),a=u.converter._dispatch("codeBlocks.after",a,c,u),a}),n.subParser("codeSpans",function(a,c,u){return a=u.converter._dispatch("codeSpans.before",a,c,u),typeof a>"u"&&(a=""),a=a.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(f,y,v,g){var m=g;return m=m.replace(/^([ \t]*)/g,""),m=m.replace(/[ \t]*$/g,""),m=n.subParser("encodeCode")(m,c,u),m=y+"<code>"+m+"</code>",m=n.subParser("hashHTMLSpans")(m,c,u),m}),a=u.converter._dispatch("codeSpans.after",a,c,u),a}),n.subParser("completeHTMLDocument",function(a,c,u){if(!c.completeHTMLDocument)return a;a=u.converter._dispatch("completeHTMLDocument.before",a,c,u);var f="html",y=`<!DOCTYPE HTML>
`,v="",g=`<meta charset="utf-8">
`,m="",L="";typeof u.metadata.parsed.doctype<"u"&&(y="<!DOCTYPE "+u.metadata.parsed.doctype+`>
`,f=u.metadata.parsed.doctype.toString().toLowerCase(),(f==="html"||f==="html5")&&(g='<meta charset="utf-8">'));for(var k in u.metadata.parsed)if(u.metadata.parsed.hasOwnProperty(k))switch(k.toLowerCase()){case"doctype":break;case"title":v="<title>"+u.metadata.parsed.title+`</title>
`;break;case"charset":f==="html"||f==="html5"?g='<meta charset="'+u.metadata.parsed.charset+`">
`:g='<meta name="charset" content="'+u.metadata.parsed.charset+`">
`;break;case"language":case"lang":m=' lang="'+u.metadata.parsed[k]+'"',L+='<meta name="'+k+'" content="'+u.metadata.parsed[k]+`">
`;break;default:L+='<meta name="'+k+'" content="'+u.metadata.parsed[k]+`">
`}return a=y+"<html"+m+`>
<head>
`+v+g+L+`</head>
<body>
`+a.trim()+`
</body>
</html>`,a=u.converter._dispatch("completeHTMLDocument.after",a,c,u),a}),n.subParser("detab",function(a,c,u){return a=u.converter._dispatch("detab.before",a,c,u),a=a.replace(/\t(?=\t)/g,"    "),a=a.replace(/\t/g,"¨A¨B"),a=a.replace(/¨B(.+?)¨A/g,function(f,y){for(var v=y,g=4-v.length%4,m=0;m<g;m++)v+=" ";return v}),a=a.replace(/¨A/g,"    "),a=a.replace(/¨B/g,""),a=u.converter._dispatch("detab.after",a,c,u),a}),n.subParser("ellipsis",function(a,c,u){return c.ellipsis&&(a=u.converter._dispatch("ellipsis.before",a,c,u),a=a.replace(/\.\.\./g,"…"),a=u.converter._dispatch("ellipsis.after",a,c,u)),a}),n.subParser("emoji",function(a,c,u){if(!c.emoji)return a;a=u.converter._dispatch("emoji.before",a,c,u);var f=/:([\S]+?):/g;return a=a.replace(f,function(y,v){return n.helper.emojis.hasOwnProperty(v)?n.helper.emojis[v]:y}),a=u.converter._dispatch("emoji.after",a,c,u),a}),n.subParser("encodeAmpsAndAngles",function(a,c,u){return a=u.converter._dispatch("encodeAmpsAndAngles.before",a,c,u),a=a.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),a=a.replace(/<(?![a-z\/?$!])/gi,"&lt;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=u.converter._dispatch("encodeAmpsAndAngles.after",a,c,u),a}),n.subParser("encodeBackslashEscapes",function(a,c,u){return a=u.converter._dispatch("encodeBackslashEscapes.before",a,c,u),a=a.replace(/\\(\\)/g,n.helper.escapeCharactersCallback),a=a.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,n.helper.escapeCharactersCallback),a=u.converter._dispatch("encodeBackslashEscapes.after",a,c,u),a}),n.subParser("encodeCode",function(a,c,u){return a=u.converter._dispatch("encodeCode.before",a,c,u),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,n.helper.escapeCharactersCallback),a=u.converter._dispatch("encodeCode.after",a,c,u),a}),n.subParser("escapeSpecialCharsWithinTagAttributes",function(a,c,u){a=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",a,c,u);var f=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,y=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return a=a.replace(f,function(v){return v.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),a=a.replace(y,function(v){return v.replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),a=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",a,c,u),a}),n.subParser("githubCodeBlocks",function(a,c,u){return c.ghCodeBlocks?(a=u.converter._dispatch("githubCodeBlocks.before",a,c,u),a+="¨0",a=a.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(f,y,v,g){var m=c.omitExtraWLInCodeBlocks?"":`
`;return g=n.subParser("encodeCode")(g,c,u),g=n.subParser("detab")(g,c,u),g=g.replace(/^\n+/g,""),g=g.replace(/\n+$/g,""),g="<pre><code"+(v?' class="'+v+" language-"+v+'"':"")+">"+g+m+"</code></pre>",g=n.subParser("hashBlock")(g,c,u),`

¨G`+(u.ghCodeBlocks.push({text:f,codeblock:g})-1)+`G

`}),a=a.replace(/¨0/,""),u.converter._dispatch("githubCodeBlocks.after",a,c,u)):a}),n.subParser("hashBlock",function(a,c,u){return a=u.converter._dispatch("hashBlock.before",a,c,u),a=a.replace(/(^\n+|\n+$)/g,""),a=`

¨K`+(u.gHtmlBlocks.push(a)-1)+`K

`,a=u.converter._dispatch("hashBlock.after",a,c,u),a}),n.subParser("hashCodeTags",function(a,c,u){a=u.converter._dispatch("hashCodeTags.before",a,c,u);var f=function(y,v,g,m){var L=g+n.subParser("encodeCode")(v,c,u)+m;return"¨C"+(u.gHtmlSpans.push(L)-1)+"C"};return a=n.helper.replaceRecursiveRegExp(a,f,"<code\\b[^>]*>","</code>","gim"),a=u.converter._dispatch("hashCodeTags.after",a,c,u),a}),n.subParser("hashElement",function(a,c,u){return function(f,y){var v=y;return v=v.replace(/\n\n/g,`
`),v=v.replace(/^\n/,""),v=v.replace(/\n+$/g,""),v=`

¨K`+(u.gHtmlBlocks.push(v)-1)+`K

`,v}}),n.subParser("hashHTMLBlocks",function(a,c,u){a=u.converter._dispatch("hashHTMLBlocks.before",a,c,u);var f=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],y=function(w,$,F,B){var q=w;return F.search(/\bmarkdown\b/)!==-1&&(q=F+u.converter.makeHtml($)+B),`

¨K`+(u.gHtmlBlocks.push(q)-1)+`K

`};c.backslashEscapesHTMLTags&&(a=a.replace(/\\<(\/?[^>]+?)>/g,function(w,$){return"&lt;"+$+"&gt;"}));for(var v=0;v<f.length;++v)for(var g,m=new RegExp("^ {0,3}(<"+f[v]+"\\b[^>]*>)","im"),L="<"+f[v]+"\\b[^>]*>",k="</"+f[v]+">";(g=n.helper.regexIndexOf(a,m))!==-1;){var C=n.helper.splitAtIndex(a,g),A=n.helper.replaceRecursiveRegExp(C[1],y,L,k,"im");if(A===C[1])break;a=C[0].concat(A)}return a=a.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(a,c,u)),a=n.helper.replaceRecursiveRegExp(a,function(w){return`

¨K`+(u.gHtmlBlocks.push(w)-1)+`K

`},"^ {0,3}<!--","-->","gm"),a=a.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(a,c,u)),a=u.converter._dispatch("hashHTMLBlocks.after",a,c,u),a}),n.subParser("hashHTMLSpans",function(a,c,u){a=u.converter._dispatch("hashHTMLSpans.before",a,c,u);function f(y){return"¨C"+(u.gHtmlSpans.push(y)-1)+"C"}return a=a.replace(/<[^>]+?\/>/gi,function(y){return f(y)}),a=a.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(y){return f(y)}),a=a.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(y){return f(y)}),a=a.replace(/<[^>]+?>/gi,function(y){return f(y)}),a=u.converter._dispatch("hashHTMLSpans.after",a,c,u),a}),n.subParser("unhashHTMLSpans",function(a,c,u){a=u.converter._dispatch("unhashHTMLSpans.before",a,c,u);for(var f=0;f<u.gHtmlSpans.length;++f){for(var y=u.gHtmlSpans[f],v=0;/¨C(\d+)C/.test(y);){var g=RegExp.$1;if(y=y.replace("¨C"+g+"C",u.gHtmlSpans[g]),v===10){console.error("maximum nesting of 10 spans reached!!!");break}++v}a=a.replace("¨C"+f+"C",y)}return a=u.converter._dispatch("unhashHTMLSpans.after",a,c,u),a}),n.subParser("hashPreCodeTags",function(a,c,u){a=u.converter._dispatch("hashPreCodeTags.before",a,c,u);var f=function(y,v,g,m){var L=g+n.subParser("encodeCode")(v,c,u)+m;return`

¨G`+(u.ghCodeBlocks.push({text:y,codeblock:L})-1)+`G

`};return a=n.helper.replaceRecursiveRegExp(a,f,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),a=u.converter._dispatch("hashPreCodeTags.after",a,c,u),a}),n.subParser("headers",function(a,c,u){a=u.converter._dispatch("headers.before",a,c,u);var f=isNaN(parseInt(c.headerLevelStart))?1:parseInt(c.headerLevelStart),y=c.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,v=c.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;a=a.replace(y,function(L,k){var C=n.subParser("spanGamut")(k,c,u),A=c.noHeaderId?"":' id="'+m(k)+'"',w=f,$="<h"+w+A+">"+C+"</h"+w+">";return n.subParser("hashBlock")($,c,u)}),a=a.replace(v,function(L,k){var C=n.subParser("spanGamut")(k,c,u),A=c.noHeaderId?"":' id="'+m(k)+'"',w=f+1,$="<h"+w+A+">"+C+"</h"+w+">";return n.subParser("hashBlock")($,c,u)});var g=c.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;a=a.replace(g,function(L,k,C){var A=C;c.customizedHeaderId&&(A=C.replace(/\s?\{([^{]+?)}\s*$/,""));var w=n.subParser("spanGamut")(A,c,u),$=c.noHeaderId?"":' id="'+m(C)+'"',F=f-1+k.length,B="<h"+F+$+">"+w+"</h"+F+">";return n.subParser("hashBlock")(B,c,u)});function m(L){var k,C;if(c.customizedHeaderId){var A=L.match(/\{([^{]+?)}\s*$/);A&&A[1]&&(L=A[1])}return k=L,n.helper.isString(c.prefixHeaderId)?C=c.prefixHeaderId:c.prefixHeaderId===!0?C="section-":C="",c.rawPrefixHeaderId||(k=C+k),c.ghCompatibleHeaderId?k=k.replace(/ /g,"-").replace(/&amp;/g,"").replace(/¨T/g,"").replace(/¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():c.rawHeaderId?k=k.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/¨T/g,"¨").replace(/¨D/g,"$").replace(/["']/g,"-").toLowerCase():k=k.replace(/[^\w]/g,"").toLowerCase(),c.rawPrefixHeaderId&&(k=C+k),u.hashLinkCounts[k]?k=k+"-"+u.hashLinkCounts[k]++:u.hashLinkCounts[k]=1,k}return a=u.converter._dispatch("headers.after",a,c,u),a}),n.subParser("horizontalRule",function(a,c,u){a=u.converter._dispatch("horizontalRule.before",a,c,u);var f=n.subParser("hashBlock")("<hr />",c,u);return a=a.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,f),a=a.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,f),a=a.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,f),a=u.converter._dispatch("horizontalRule.after",a,c,u),a}),n.subParser("images",function(a,c,u){a=u.converter._dispatch("images.before",a,c,u);var f=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,y=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,v=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,g=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,m=/!\[([^\[\]]+)]()()()()()/g;function L(C,A,w,$,F,B,q,G){return $=$.replace(/\s/g,""),k(C,A,w,$,F,B,q,G)}function k(C,A,w,$,F,B,q,G){var te=u.gUrls,ie=u.gTitles,se=u.gDimensions;if(w=w.toLowerCase(),G||(G=""),C.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)$="";else if($===""||$===null)if((w===""||w===null)&&(w=A.toLowerCase().replace(/ ?\n/g," ")),$="#"+w,!n.helper.isUndefined(te[w]))$=te[w],n.helper.isUndefined(ie[w])||(G=ie[w]),n.helper.isUndefined(se[w])||(F=se[w].width,B=se[w].height);else return C;A=A.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),$=$.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var Z='<img src="'+$+'" alt="'+A+'"';return G&&n.helper.isString(G)&&(G=G.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),Z+=' title="'+G+'"'),F&&B&&(F=F==="*"?"auto":F,B=B==="*"?"auto":B,Z+=' width="'+F+'"',Z+=' height="'+B+'"'),Z+=" />",Z}return a=a.replace(g,k),a=a.replace(v,L),a=a.replace(y,k),a=a.replace(f,k),a=a.replace(m,k),a=u.converter._dispatch("images.after",a,c,u),a}),n.subParser("italicsAndBold",function(a,c,u){a=u.converter._dispatch("italicsAndBold.before",a,c,u);function f(y,v,g){return v+y+g}return c.literalMidWordUnderscores?(a=a.replace(/\b___(\S[\s\S]*?)___\b/g,function(y,v){return f(v,"<strong><em>","</em></strong>")}),a=a.replace(/\b__(\S[\s\S]*?)__\b/g,function(y,v){return f(v,"<strong>","</strong>")}),a=a.replace(/\b_(\S[\s\S]*?)_\b/g,function(y,v){return f(v,"<em>","</em>")})):(a=a.replace(/___(\S[\s\S]*?)___/g,function(y,v){return/\S$/.test(v)?f(v,"<strong><em>","</em></strong>"):y}),a=a.replace(/__(\S[\s\S]*?)__/g,function(y,v){return/\S$/.test(v)?f(v,"<strong>","</strong>"):y}),a=a.replace(/_([^\s_][\s\S]*?)_/g,function(y,v){return/\S$/.test(v)?f(v,"<em>","</em>"):y})),c.literalMidWordAsterisks?(a=a.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(y,v,g){return f(g,v+"<strong><em>","</em></strong>")}),a=a.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(y,v,g){return f(g,v+"<strong>","</strong>")}),a=a.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(y,v,g){return f(g,v+"<em>","</em>")})):(a=a.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(y,v){return/\S$/.test(v)?f(v,"<strong><em>","</em></strong>"):y}),a=a.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(y,v){return/\S$/.test(v)?f(v,"<strong>","</strong>"):y}),a=a.replace(/\*([^\s*][\s\S]*?)\*/g,function(y,v){return/\S$/.test(v)?f(v,"<em>","</em>"):y})),a=u.converter._dispatch("italicsAndBold.after",a,c,u),a}),n.subParser("lists",function(a,c,u){function f(g,m){u.gListLevel++,g=g.replace(/\n{2,}$/,`
`),g+="¨0";var L=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,k=/\n[ \t]*\n(?!¨0)/.test(g);return c.disableForced4SpacesIndentedSublists&&(L=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(¨0|\2([*+-]|\d+[.])[ \t]+))/gm),g=g.replace(L,function(C,A,w,$,F,B,q){q=q&&q.trim()!=="";var G=n.subParser("outdent")(F,c,u),te="";return B&&c.tasklists&&(te=' class="task-list-item" style="list-style-type: none;"',G=G.replace(/^[ \t]*\[(x|X| )?]/m,function(){var ie='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return q&&(ie+=" checked"),ie+=">",ie})),G=G.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(ie){return"¨A"+ie}),A||G.search(/\n{2,}/)>-1?(G=n.subParser("githubCodeBlocks")(G,c,u),G=n.subParser("blockGamut")(G,c,u)):(G=n.subParser("lists")(G,c,u),G=G.replace(/\n$/,""),G=n.subParser("hashHTMLBlocks")(G,c,u),G=G.replace(/\n\n+/g,`

`),k?G=n.subParser("paragraphs")(G,c,u):G=n.subParser("spanGamut")(G,c,u)),G=G.replace("¨A",""),G="<li"+te+">"+G+`</li>
`,G}),g=g.replace(/¨0/g,""),u.gListLevel--,m&&(g=g.replace(/\s+$/,"")),g}function y(g,m){if(m==="ol"){var L=g.match(/^ *(\d+)\./);if(L&&L[1]!=="1")return' start="'+L[1]+'"'}return""}function v(g,m,L){var k=c.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,C=c.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,A=m==="ul"?k:C,w="";if(g.search(A)!==-1)(function F(B){var q=B.search(A),G=y(g,m);q!==-1?(w+=`

<`+m+G+`>
`+f(B.slice(0,q),!!L)+"</"+m+`>
`,m=m==="ul"?"ol":"ul",A=m==="ul"?k:C,F(B.slice(q))):w+=`

<`+m+G+`>
`+f(B,!!L)+"</"+m+`>
`})(g);else{var $=y(g,m);w=`

<`+m+$+`>
`+f(g,!!L)+"</"+m+`>
`}return w}return a=u.converter._dispatch("lists.before",a,c,u),a+="¨0",u.gListLevel?a=a.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(g,m,L){var k=L.search(/[*+-]/g)>-1?"ul":"ol";return v(m,k,!0)}):a=a.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(g,m,L,k){var C=k.search(/[*+-]/g)>-1?"ul":"ol";return v(L,C,!1)}),a=a.replace(/¨0/,""),a=u.converter._dispatch("lists.after",a,c,u),a}),n.subParser("metadata",function(a,c,u){if(!c.metadata)return a;a=u.converter._dispatch("metadata.before",a,c,u);function f(y){u.metadata.raw=y,y=y.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),y=y.replace(/\n {4}/g," "),y.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(v,g,m){return u.metadata.parsed[g]=m,""})}return a=a.replace(/^\s*«««+(\S*?)\n([\s\S]+?)\n»»»+\n/,function(y,v,g){return f(g),"¨M"}),a=a.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(y,v,g){return v&&(u.metadata.format=v),f(g),"¨M"}),a=a.replace(/¨M/g,""),a=u.converter._dispatch("metadata.after",a,c,u),a}),n.subParser("outdent",function(a,c,u){return a=u.converter._dispatch("outdent.before",a,c,u),a=a.replace(/^(\t|[ ]{1,4})/gm,"¨0"),a=a.replace(/¨0/g,""),a=u.converter._dispatch("outdent.after",a,c,u),a}),n.subParser("paragraphs",function(a,c,u){a=u.converter._dispatch("paragraphs.before",a,c,u),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,"");for(var f=a.split(/\n{2,}/g),y=[],v=f.length,g=0;g<v;g++){var m=f[g];m.search(/¨(K|G)(\d+)\1/g)>=0?y.push(m):m.search(/\S/)>=0&&(m=n.subParser("spanGamut")(m,c,u),m=m.replace(/^([ \t]*)/g,"<p>"),m+="</p>",y.push(m))}for(v=y.length,g=0;g<v;g++){for(var L="",k=y[g],C=!1;/¨(K|G)(\d+)\1/.test(k);){var A=RegExp.$1,w=RegExp.$2;A==="K"?L=u.gHtmlBlocks[w]:C?L=n.subParser("encodeCode")(u.ghCodeBlocks[w].text,c,u):L=u.ghCodeBlocks[w].codeblock,L=L.replace(/\$/g,"$$$$"),k=k.replace(/(\n\n)?¨(K|G)\d+\2(\n\n)?/,L),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(k)&&(C=!0)}y[g]=k}return a=y.join(`
`),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),u.converter._dispatch("paragraphs.after",a,c,u)}),n.subParser("runExtension",function(a,c,u,f){if(a.filter)c=a.filter(c,f.converter,u);else if(a.regex){var y=a.regex;y instanceof RegExp||(y=new RegExp(y,"g")),c=c.replace(y,a.replace)}return c}),n.subParser("spanGamut",function(a,c,u){return a=u.converter._dispatch("spanGamut.before",a,c,u),a=n.subParser("codeSpans")(a,c,u),a=n.subParser("escapeSpecialCharsWithinTagAttributes")(a,c,u),a=n.subParser("encodeBackslashEscapes")(a,c,u),a=n.subParser("images")(a,c,u),a=n.subParser("anchors")(a,c,u),a=n.subParser("autoLinks")(a,c,u),a=n.subParser("simplifiedAutoLinks")(a,c,u),a=n.subParser("emoji")(a,c,u),a=n.subParser("underline")(a,c,u),a=n.subParser("italicsAndBold")(a,c,u),a=n.subParser("strikethrough")(a,c,u),a=n.subParser("ellipsis")(a,c,u),a=n.subParser("hashHTMLSpans")(a,c,u),a=n.subParser("encodeAmpsAndAngles")(a,c,u),c.simpleLineBreaks?/\n\n¨K/.test(a)||(a=a.replace(/\n+/g,`<br />
`)):a=a.replace(/  +\n/g,`<br />
`),a=u.converter._dispatch("spanGamut.after",a,c,u),a}),n.subParser("strikethrough",function(a,c,u){function f(y){return c.simplifiedAutoLink&&(y=n.subParser("simplifiedAutoLinks")(y,c,u)),"<del>"+y+"</del>"}return c.strikethrough&&(a=u.converter._dispatch("strikethrough.before",a,c,u),a=a.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(y,v){return f(v)}),a=u.converter._dispatch("strikethrough.after",a,c,u)),a}),n.subParser("stripLinkDefinitions",function(a,c,u){var f=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=¨0))/gm,y=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=¨0)|(?=\n\[))/gm;a+="¨0";var v=function(g,m,L,k,C,A,w){return m=m.toLowerCase(),a.toLowerCase().split(m).length-1<2?g:(L.match(/^data:.+?\/.+?;base64,/)?u.gUrls[m]=L.replace(/\s/g,""):u.gUrls[m]=n.subParser("encodeAmpsAndAngles")(L,c,u),A?A+w:(w&&(u.gTitles[m]=w.replace(/"|'/g,"&quot;")),c.parseImgDimensions&&k&&C&&(u.gDimensions[m]={width:k,height:C}),""))};return a=a.replace(y,v),a=a.replace(f,v),a=a.replace(/¨0/,""),a}),n.subParser("tables",function(a,c,u){if(!c.tables)return a;var f=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|¨0)/gm,y=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|¨0)/gm;function v(C){return/^:[ \t]*--*$/.test(C)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(C)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(C)?' style="text-align:center;"':""}function g(C,A){var w="";return C=C.trim(),(c.tablesHeaderId||c.tableHeaderId)&&(w=' id="'+C.replace(/ /g,"_").toLowerCase()+'"'),C=n.subParser("spanGamut")(C,c,u),"<th"+w+A+">"+C+`</th>
`}function m(C,A){var w=n.subParser("spanGamut")(C,c,u);return"<td"+A+">"+w+`</td>
`}function L(C,A){for(var w=`<table>
<thead>
<tr>
`,$=C.length,F=0;F<$;++F)w+=C[F];for(w+=`</tr>
</thead>
<tbody>
`,F=0;F<A.length;++F){w+=`<tr>
`;for(var B=0;B<$;++B)w+=A[F][B];w+=`</tr>
`}return w+=`</tbody>
</table>
`,w}function k(C){var A,w=C.split(`
`);for(A=0;A<w.length;++A)/^ {0,3}\|/.test(w[A])&&(w[A]=w[A].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(w[A])&&(w[A]=w[A].replace(/\|[ \t]*$/,"")),w[A]=n.subParser("codeSpans")(w[A],c,u);var $=w[0].split("|").map(function(Z){return Z.trim()}),F=w[1].split("|").map(function(Z){return Z.trim()}),B=[],q=[],G=[],te=[];for(w.shift(),w.shift(),A=0;A<w.length;++A)w[A].trim()!==""&&B.push(w[A].split("|").map(function(Z){return Z.trim()}));if($.length<F.length)return C;for(A=0;A<F.length;++A)G.push(v(F[A]));for(A=0;A<$.length;++A)n.helper.isUndefined(G[A])&&(G[A]=""),q.push(g($[A],G[A]));for(A=0;A<B.length;++A){for(var ie=[],se=0;se<q.length;++se)n.helper.isUndefined(B[A][se]),ie.push(m(B[A][se],G[se]));te.push(ie)}return L(q,te)}return a=u.converter._dispatch("tables.before",a,c,u),a=a.replace(/\\(\|)/g,n.helper.escapeCharactersCallback),a=a.replace(f,k),a=a.replace(y,k),a=u.converter._dispatch("tables.after",a,c,u),a}),n.subParser("underline",function(a,c,u){return c.underline&&(a=u.converter._dispatch("underline.before",a,c,u),c.literalMidWordUnderscores?(a=a.replace(/\b___(\S[\s\S]*?)___\b/g,function(f,y){return"<u>"+y+"</u>"}),a=a.replace(/\b__(\S[\s\S]*?)__\b/g,function(f,y){return"<u>"+y+"</u>"})):(a=a.replace(/___(\S[\s\S]*?)___/g,function(f,y){return/\S$/.test(y)?"<u>"+y+"</u>":f}),a=a.replace(/__(\S[\s\S]*?)__/g,function(f,y){return/\S$/.test(y)?"<u>"+y+"</u>":f})),a=a.replace(/(_)/g,n.helper.escapeCharactersCallback),a=u.converter._dispatch("underline.after",a,c,u)),a}),n.subParser("unescapeSpecialChars",function(a,c,u){return a=u.converter._dispatch("unescapeSpecialChars.before",a,c,u),a=a.replace(/¨E(\d+)E/g,function(f,y){var v=parseInt(y);return String.fromCharCode(v)}),a=u.converter._dispatch("unescapeSpecialChars.after",a,c,u),a}),n.subParser("makeMarkdown.blockquote",function(a,c){var u="";if(a.hasChildNodes())for(var f=a.childNodes,y=f.length,v=0;v<y;++v){var g=n.subParser("makeMarkdown.node")(f[v],c);g!==""&&(u+=g)}return u=u.trim(),u="> "+u.split(`
`).join(`
> `),u}),n.subParser("makeMarkdown.codeBlock",function(a,c){var u=a.getAttribute("language"),f=a.getAttribute("precodenum");return"```"+u+`
`+c.preList[f]+"\n```"}),n.subParser("makeMarkdown.codeSpan",function(a){return"`"+a.innerHTML+"`"}),n.subParser("makeMarkdown.emphasis",function(a,c){var u="";if(a.hasChildNodes()){u+="*";for(var f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);u+="*"}return u}),n.subParser("makeMarkdown.header",function(a,c,u){var f=new Array(u+1).join("#"),y="";if(a.hasChildNodes()){y=f+" ";for(var v=a.childNodes,g=v.length,m=0;m<g;++m)y+=n.subParser("makeMarkdown.node")(v[m],c)}return y}),n.subParser("makeMarkdown.hr",function(){return"---"}),n.subParser("makeMarkdown.image",function(a){var c="";return a.hasAttribute("src")&&(c+="!["+a.getAttribute("alt")+"](",c+="<"+a.getAttribute("src")+">",a.hasAttribute("width")&&a.hasAttribute("height")&&(c+=" ="+a.getAttribute("width")+"x"+a.getAttribute("height")),a.hasAttribute("title")&&(c+=' "'+a.getAttribute("title")+'"'),c+=")"),c}),n.subParser("makeMarkdown.links",function(a,c){var u="";if(a.hasChildNodes()&&a.hasAttribute("href")){var f=a.childNodes,y=f.length;u="[";for(var v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);u+="](",u+="<"+a.getAttribute("href")+">",a.hasAttribute("title")&&(u+=' "'+a.getAttribute("title")+'"'),u+=")"}return u}),n.subParser("makeMarkdown.list",function(a,c,u){var f="";if(!a.hasChildNodes())return"";for(var y=a.childNodes,v=y.length,g=a.getAttribute("start")||1,m=0;m<v;++m)if(!(typeof y[m].tagName>"u"||y[m].tagName.toLowerCase()!=="li")){var L="";u==="ol"?L=g.toString()+". ":L="- ",f+=L+n.subParser("makeMarkdown.listItem")(y[m],c),++g}return f+=`
<!-- -->
`,f.trim()}),n.subParser("makeMarkdown.listItem",function(a,c){for(var u="",f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);return/\n$/.test(u)?u=u.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):u+=`
`,u}),n.subParser("makeMarkdown.node",function(a,c,u){u=u||!1;var f="";if(a.nodeType===3)return n.subParser("makeMarkdown.txt")(a,c);if(a.nodeType===8)return"<!--"+a.data+`-->

`;if(a.nodeType!==1)return"";var y=a.tagName.toLowerCase();switch(y){case"h1":u||(f=n.subParser("makeMarkdown.header")(a,c,1)+`

`);break;case"h2":u||(f=n.subParser("makeMarkdown.header")(a,c,2)+`

`);break;case"h3":u||(f=n.subParser("makeMarkdown.header")(a,c,3)+`

`);break;case"h4":u||(f=n.subParser("makeMarkdown.header")(a,c,4)+`

`);break;case"h5":u||(f=n.subParser("makeMarkdown.header")(a,c,5)+`

`);break;case"h6":u||(f=n.subParser("makeMarkdown.header")(a,c,6)+`

`);break;case"p":u||(f=n.subParser("makeMarkdown.paragraph")(a,c)+`

`);break;case"blockquote":u||(f=n.subParser("makeMarkdown.blockquote")(a,c)+`

`);break;case"hr":u||(f=n.subParser("makeMarkdown.hr")(a,c)+`

`);break;case"ol":u||(f=n.subParser("makeMarkdown.list")(a,c,"ol")+`

`);break;case"ul":u||(f=n.subParser("makeMarkdown.list")(a,c,"ul")+`

`);break;case"precode":u||(f=n.subParser("makeMarkdown.codeBlock")(a,c)+`

`);break;case"pre":u||(f=n.subParser("makeMarkdown.pre")(a,c)+`

`);break;case"table":u||(f=n.subParser("makeMarkdown.table")(a,c)+`

`);break;case"code":f=n.subParser("makeMarkdown.codeSpan")(a,c);break;case"em":case"i":f=n.subParser("makeMarkdown.emphasis")(a,c);break;case"strong":case"b":f=n.subParser("makeMarkdown.strong")(a,c);break;case"del":f=n.subParser("makeMarkdown.strikethrough")(a,c);break;case"a":f=n.subParser("makeMarkdown.links")(a,c);break;case"img":f=n.subParser("makeMarkdown.image")(a,c);break;default:f=a.outerHTML+`

`}return f}),n.subParser("makeMarkdown.paragraph",function(a,c){var u="";if(a.hasChildNodes())for(var f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);return u=u.trim(),u}),n.subParser("makeMarkdown.pre",function(a,c){var u=a.getAttribute("prenum");return"<pre>"+c.preList[u]+"</pre>"}),n.subParser("makeMarkdown.strikethrough",function(a,c){var u="";if(a.hasChildNodes()){u+="~~";for(var f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);u+="~~"}return u}),n.subParser("makeMarkdown.strong",function(a,c){var u="";if(a.hasChildNodes()){u+="**";for(var f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c);u+="**"}return u}),n.subParser("makeMarkdown.table",function(a,c){var u="",f=[[],[]],y=a.querySelectorAll("thead>tr>th"),v=a.querySelectorAll("tbody>tr"),g,m;for(g=0;g<y.length;++g){var L=n.subParser("makeMarkdown.tableCell")(y[g],c),k="---";if(y[g].hasAttribute("style")){var C=y[g].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(C){case"text-align:left;":k=":---";break;case"text-align:right;":k="---:";break;case"text-align:center;":k=":---:";break}}f[0][g]=L.trim(),f[1][g]=k}for(g=0;g<v.length;++g){var A=f.push([])-1,w=v[g].getElementsByTagName("td");for(m=0;m<y.length;++m){var $=" ";typeof w[m]<"u"&&($=n.subParser("makeMarkdown.tableCell")(w[m],c)),f[A].push($)}}var F=3;for(g=0;g<f.length;++g)for(m=0;m<f[g].length;++m){var B=f[g][m].length;B>F&&(F=B)}for(g=0;g<f.length;++g){for(m=0;m<f[g].length;++m)g===1?f[g][m].slice(-1)===":"?f[g][m]=n.helper.padEnd(f[g][m].slice(-1),F-1,"-")+":":f[g][m]=n.helper.padEnd(f[g][m],F,"-"):f[g][m]=n.helper.padEnd(f[g][m],F);u+="| "+f[g].join(" | ")+` |
`}return u.trim()}),n.subParser("makeMarkdown.tableCell",function(a,c){var u="";if(!a.hasChildNodes())return"";for(var f=a.childNodes,y=f.length,v=0;v<y;++v)u+=n.subParser("makeMarkdown.node")(f[v],c,!0);return u.trim()}),n.subParser("makeMarkdown.txt",function(a){var c=a.nodeValue;return c=c.replace(/ +/g," "),c=c.replace(/¨NBSP;/g," "),c=n.helper.unescapeHTMLEntities(c),c=c.replace(/([*_~|`])/g,"\\$1"),c=c.replace(/^(\s*)>/g,"\\$1>"),c=c.replace(/^#/gm,"\\#"),c=c.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),c=c.replace(/^( {0,3}\d+)\./gm,"$1\\."),c=c.replace(/^( {0,3})([+-])/gm,"$1\\$2"),c=c.replace(/]([\s]*)\(/g,"\\]$1\\("),c=c.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),c});var j=this;i.exports?i.exports=n:j.showdown=n}).call(Xa)})(Pi);var Fa=Pi.exports;function Ha(i){return i.type==="CURVE"}function Ba(i){return i.type==="IMAGE"}function qn(i,e){return Math.round(i/e)*e}function Kn(i,e){return Math.floor(i/e)*e}function bn(i){return i*(Math.PI/180)}function Ua(i){return i*(180/Math.PI)}function Yn(i,e,t){return i*(1-t)+e*t}class ja{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const r=Math.cos(bn(n)),o=Math.sin(bn(n)),s=this.subtract(e,t);return{x:t.x+r*s.x-o*s.y,y:t.y+o*s.x+r*s.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:qn(e.x,t.x),y:qn(e.y,t.y)}}static floorTo(e,t){return{x:Kn(e.x,t.x),y:Kn(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let h of e)t=h.x<t?h.x:t,n=h.x>n?h.x:n,r=h.y<r?h.y:r,o=h.y>o?h.y:o;let s=n-t,l=o-r,p={x:(t+n)/2,y:(r+o)/2};return{min:{x:t,y:r},max:{x:n,y:o},width:s,height:l,center:p}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let r=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){const l=t[o].y>e.y,p=t[s].y>e.y;l!==p&&e.x<(t[s].x-t[o].x)*(e.y-t[o].y)/(t[s].y-t[o].y)+t[o].x&&(r=!r)}return r}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:Yn(e.x,t.x,n),y:Yn(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Fe{static inverse(e){const[t,n,r,o,s,l,p,h,E]=e,_=t*(s*E-h*l)-n*(o*E-l*p)+r*(o*h-s*p);if(Math.abs(_)<1e-14)return e;const N=1/_,D=(s*E-h*l)*N,O=(r*h-n*E)*N,X=(n*l-r*s)*N,H=(l*p-o*E)*N,V=(t*E-r*p)*N,M=(o*r-t*l)*N,j=(o*h-p*s)*N,a=(p*n-t*h)*N,c=(t*s-o*n)*N;return[D,O,X,H,V,M,j,a,c]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=bn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Fe.fromPosition(e.position),n=Fe.fromScale(e.scale),r=Fe.fromRotation(e.rotation);return Fe.multiply(Fe.multiply(t,r),n)}static decompose(e){const[t,n,r,o,s,l]=e,p=t*s-o*n,h={position:{x:r,y:l},rotation:0,scale:{x:1,y:1}};if(t!=0||o!=0){var E=Math.sqrt(t*t+o*o);h.rotation=o>0?Math.acos(t/E):-Math.acos(t/E),h.scale={x:E,y:p/E}}else if(n!=0||s!=0){var _=Math.sqrt(n*n+s*s);h.rotation=Math.PI/2-(s>0?Math.acos(-n/_):-Math.acos(n/_)),h.scale={x:p/_,y:_}}return h.rotation=Ua(h.rotation),h}}function za(){const i=document.createElement("img");return i.id="PatreonButton",i.setAttribute("class","icon"),i.classList.add("patreon-clickable"),i.setAttribute("title",b.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),i.setAttribute("src",b.USER_REGISTERED?"/w-thankyou.svg":"/w-patreon-2.png"),i.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},i}function Tn(i,e){const t=i.x-e.x,n=i.y-e.y;return Math.sqrt(t*t+n*n)}function Qn(i,e){let t=!1;const n=e.length;let r=e[0];for(let o=1;o<=n;o++){const s=e[o%n];if(i.y>Math.min(r.y,s.y)&&i.y<=Math.max(r.y,s.y)&&i.x<=Math.max(r.x,s.x)&&r.y!=s.y){const l=(i.y-r.y)*(s.x-r.x)/(s.y-r.y)+r.x;(r.x==s.x||i.x<=l)&&(t=!t)}r=s}return t}function Ga(i,e){const t=i.points,n=e.points;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].x!==n[r].x||t[r].y!==n[r].y)return!1;return!0}function Jn(i,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",r=t.matches?"light":"dark";for(var o=0;o<e.styleSheets.length;o++)for(var s=0;s<e.styleSheets[o].cssRules.length;s++){let l=e.styleSheets[o].cssRules[s];l&&l.media&&l.media.mediaText.includes("prefers-color-scheme")&&(i.mode=="LIGHT"?(l.media.appendMedium(`(prefers-color-scheme: ${n})`),l.media.mediaText.includes(r)&&l.media.deleteMedium(`(prefers-color-scheme: ${r})`)):i.mode=="DARK"&&(l.media.appendMedium(`(prefers-color-scheme: ${r})`),l.media.mediaText.includes(n)&&l.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}function Wa(i,e,t,n,r){const o=[[],[]];let s={x:0,y:0},l={x:0,y:0},p=-1,h=-1,E=1/0,_=1/0;const N=ti(i,n,r);for(let V=0;V<N.length-1;V++){const M=N[V],j=N[V+1],a=Zn(M,j,e),c=Zn(M,j,t),u=Tn(e,a),f=Tn(t,c);u<E&&(p=V,s=a,E=u),f<_&&(h=V,l=c,_=f)}(p>h||p===h&&ei(s,N[p],N[p+1])>ei(l,N[h],N[h+1]))&&([p,h]=[h,p],[s,l]=[l,s]);let O=[...N];p<=h?(O.splice(p+1,0,s),O.splice(h+2,0,l),o[0]=_t(O,0,p+1),o[1]=_t(O,h+2,O.length)):(O.splice(h+1,0,l),O.splice(p+2,0,s),o[0]=_t(O,0,h+1),o[1]=_t(O,p+2,O.length));const X=_t(O,p+1,h+2),H=o.map(V=>ti(V,-n,r));return{extracted:X,remaining:H}}function _t(i,e,t){return i.slice(e,t+1)}function Zn(i,e,t){const n={x:e.x-i.x,y:e.y-i.y},r={x:t.x-i.x,y:t.y-i.y},o=r.x*n.x+r.y*n.y,s=n.x*n.x+n.y*n.y,l=o/s,p=Math.max(0,Math.min(1,l));return{x:i.x+p*n.x,y:i.y+p*n.y}}function ei(i,e,t){const n={x:i.x-e.x,y:i.y-e.y},r={x:t.x-e.x,y:t.y-e.y};return(n.x*r.x+n.y*r.y)/(r.x*r.x+r.y*r.y)}function qa(i,e,t){const n=e*(Math.PI/180),r=Math.cos(n),o=Math.sin(n),s=i.x-t.x,l=i.y-t.y;return{x:r*s-o*l+t.x,y:o*s+r*l+t.y}}function ti(i,e,t){return i.map(n=>qa(n,e,t))}function It(i){if(i.ctrlKey)return i.pointerPosition;const e=Math.round(b.gridDpi/b.gridSnap),t=Math.round(i.pointerPosition.x/b.gridDpi)*b.gridDpi,n=Math.round(i.pointerPosition.y/b.gridDpi)*b.gridDpi,r=Math.abs(t-i.pointerPosition.x),o=Math.abs(n-i.pointerPosition.y);let s,l;return r<=e?s=t:s=i.pointerPosition.x,o<=e?l=n:l=i.pointerPosition.y,{x:s,y:l}}let Ee=null;async function Ri(){await T.popover.close(d.LINETOOLID)}async function _n(){if(!Ee)return;const[i,e]=Ee;e(),Ee=null,await Ri()}async function Nn(){if(!Ee)return;const[i,e]=Ee,t=i(n=>{n.visible=!1,n.layer=d.LINELAYER,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,n.points.pop()});t.points.length>=2&&await T.scene.items.addItems([t]),e(),Ee=null,await Ri()}async function xi(){if(!Ee)return;const[i]=Ee;i(e=>{e.points.length>2&&e.points.pop()})}async function Ka(i,e){if(!e.transformer)if(Ee){const[t]=Ee;t(n=>{n.points.push(e.pointerPosition)})}else{const t=It(e),n=b.snap?t:e.pointerPosition,r=Se().tension(0).points([n,n]).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).build();Ee=await T.interaction.startItemInteraction(r);const o=await T.viewport.getWidth();await T.popover.open({id:d.LINETOOLID,url:"/pages/line.html",height:75,width:350,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Ya(i,e){if(!Ee||e.transformer)return;const[t]=Ee,n=It(e);t(r=>{r.points[r.points.length-1]=b.snap?n:e.pointerPosition})}function Qa(i,e){Ee&&(e.key=="Escape"?_n():e.key=="Enter"?Nn():e.key==="z"&&xi())}const on={onToolClick:Ka,onToolMove:Ya,onKeyDown:Qa};let we=null;async function Xi(){await T.popover.close(d.POLYTOOLID)}async function Sn(){if(!we)return;const[i,e]=we;e(),we=null,Xi(),await T.player.setMetadata({[`${d.EXTENSIONID}/cancelPoly`]:!1})}async function On(){if(!we)return;const[i,e]=we,t=i(n=>{n.visible=!1,n.layer=d.LINELAYER,n.style.fillOpacity=0,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&await T.scene.items.addItems([t]),e(),we=null,Xi(),await T.player.setMetadata({[`${d.EXTENSIONID}/finishPoly`]:!1})}async function Vi(){if(!we)return;const[i]=we;i(e=>{e.points.length>2&&e.points.pop()})}async function Ja(i,e){if(!e.transformer)if(we){const[t]=we;t(n=>{n.points.push(e.pointerPosition)})}else{const t=It(e),n=b.snap?t:e.pointerPosition,r=Se().tension(0).points([n,n]).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(.5).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Polygon)").locked(!0).build();we=await T.interaction.startItemInteraction(r);const o=await T.viewport.getWidth();await T.popover.open({id:d.POLYTOOLID,url:"/pages/polygon.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Za(i,e){if(!we||e.transformer)return;const[t]=we,n=It(e);t(r=>{r.points[r.points.length-1]=b.snap?n:e.pointerPosition})}function er(i,e){we&&(e.key=="Escape"?Sn():e.key=="Enter"?On():e.key==="z"&&Vi())}const dn={onToolClick:Ja,onToolMove:Za,onKeyDown:er};let Ie=null;const Fi=8,Hi=[];async function Bi(){await T.popover.close(d.ELEVATIONTOOLID)}async function Pn(){if(!Ie)return;const[i,e]=Ie;e(),Ie=null,Bi()}async function Ui(){if(!Ie)return;const[i,e]=Ie,t=i(n=>{n.visible=!1,n.points.pop(),n.points.push(n.points[0])});if(t.points.length>=4){await T.scene.local.addItems([t]);let n=b.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`];n||(n=[]);const r=t.metadata[`${d.EXTENSIONID}/elevation`]??0,o={Points:t.points,Depth:r};n.push(o),await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:n})}e(),Ie=null,Bi()}async function ji(){if(!Ie)return;const[i]=Ie;i(e=>{e.points.length>2&&e.points.pop()})}async function tr(i,e,t){if(!e.transformer)if(Ie){const[n]=Ie;n(r=>{r.points.push(e.pointerPosition)})}else{const n=It(e),r=b.snap?n:e.pointerPosition,o=Se().tension(0).points([r,r]).strokeColor(zi(t)).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??Hi).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??Fi).fillOpacity(.5).fillColor(Gi(t)).layer(d.LINELAYER).metadata({[`${d.EXTENSIONID}/elevation`]:t}).name(`Elevation-${t} Area`).zIndex(t).locked(!0).build();Ie=await T.interaction.startItemInteraction(o);const s=await T.viewport.getWidth();await T.popover.open({id:d.ELEVATIONTOOLID,url:"/pages/elevation.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:60,left:s/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function nr(i,e){if(!Ie||e.transformer)return;const[t]=Ie,n=It(e);t(r=>{r.points[r.points.length-1]=b.snap?n:e.pointerPosition})}function ir(i,e,t){Ie&&(e.key=="Escape"?Pn():e.key=="Enter"?Ui():e.key==="z"&&ji())}async function ar(i){const e=i.metadata[`${d.EXTENSIONID}/elevationEditor`]??!1;if(await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!e}),e)await T.popover.close(d.ELEVATIONWARNID),await sr();else{const t=await T.viewport.getWidth();await T.popover.open({id:d.ELEVATIONWARNID,url:"/pages/ewarning.html",height:45,width:400,disableClickAway:!0,anchorPosition:{top:120,left:t/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}}),await rr()}}async function rr(i){const t=(await T.scene.getMetadata())[`${d.EXTENSIONID}/elevationMapping`]??[];if(t&&t.length>0){const n=[];for(const r of t){const o=Se().tension(0).points(r.Points).strokeColor(zi(r.Depth)).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??Hi).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??Fi).fillOpacity(.5).fillColor(Gi(r.Depth)).layer(d.LINELAYER).name("Elevation-1 Area").locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/elevation`]:r.Depth}).zIndex(r.Depth).build();n.push(o)}await T.scene.local.addItems(n)}}async function sr(i){const e=b.sceneLocal.filter(t=>t.metadata[`${d.EXTENSIONID}/elevation`]!==void 0);if(e.length>0){const t=[];for(const n of e){let r=n.points;(n.position.x!==0||n.position.y!==0)&&(r=n.points.map(s=>{const l=s.x+n.position.x,p=s.y+n.position.y;return{x:l,y:p}}));const o={Points:r,Depth:n.metadata[`${d.EXTENSIONID}/elevation`]??0};t.push(o)}await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:t}),await T.scene.local.deleteItems(e.map(n=>n.id))}else await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:[]})}function zi(i){switch(i){case 1:return"#6454ac";case 2:return"#029658";case 3:return"#fcd444";case 4:return"#fc6404";case 5:return"#ff0000";default:return"#000000"}}function Gi(i){switch(i){case 1:return"#6454ac4F";case 2:return"#0296584F";case 3:return"#fcd4444F";case 4:return"#fc64044F";case 5:return"#ff00004F";default:return"#0000004F"}}const he={onToolClick:tr,onToolMove:nr,onKeyDown:ir,enterEditMode:ar,cancelDrawing:Pn};function ni(i){return i.metadata[`${d.EXTENSIONID}/isIndicatorRing`]}function or(i){return i.metadata[`${d.EXTENSIONID}/isDoor`]}function Nt(i){return i.metadata[`${d.EXTENSIONID}/isVisionLine`]}function dr(i){return i.metadata[`${d.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${d.EXTENSIONID}/disabled`]}function lr(i){return i.metadata[`${d.SPECTREID}/isLocalSpectre`]}function ur(i){return i.metadata[`${d.EXTENSIONID}/isVisionWall`]}function cr(i){return i.metadata[`${d.EXTENSIONID}/isVisionLight`]}function fr(i){return i.metadata[`${d.EXTENSIONID}/isPersistentLight`]}function pr(i){return i.metadata[`${d.EXTENSIONID}/isLocalDecal`]}function hr(i){return i.metadata[`${d.EXTENSIONID}/isDarkVision`]}function ln(i){return(i.layer==="CHARACTER"||i.layer==="MOUNT"||i.layer==="ATTACHMENT"||i.layer==="PROP")&&i.metadata[`${d.EXTENSIONID}/hasVision`]}function mr(i){return(i.layer==="CHARACTER"||i.layer==="MOUNT"||i.layer==="ATTACHMENT"||i.layer==="PROP")&&i.metadata[`${d.EXTENSIONID}/hasVision`]}function Wi(i){return(i.layer==="CHARACTER"||i.layer==="MOUNT"||i.layer==="ATTACHMENT"||i.layer==="PROP")&&i.createdUserId==b.playerId&&i.metadata[`${d.EXTENSIONID}/hasVision`]}function gr(i){return i.metadata[`${d.EXTENSIONID}/isBrushSquare`]}class vr{wallsToCreate=[];wallsToUpdate=[];wallsToDelete=[];lightsToCreate=[];lightsToUpdate=[];lightsToDelete=[];ringsToCreate=[];ringsToUpdate=[];ringsToDelete=[];decalsToCreate=[];decalsToUpdate=[];decalsToDelete=[];darkVisionToCreate=[];darkVisionToUpdate=[];darkVisionToDelete=[];persistentLights=[];persistenceCullingDistance=1;persistenceLimit=50;constructor(){}async Initialize(){if(b.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0){const e=localStorage.getItem("PersistentFogData");if(e){const t=JSON.parse(e);if(t.length>0)for(let n of t)n.id=n.metadata[`${d.EXTENSIONID}/isPersistentLight`],this.AddPersistentLightToQueue(n,n.zIndex)}}}async Reset(){this.persistentLights=[]}async Run(){await this.UpdateLights(),await this.UpdateWalls(),await this.UpdateDoors(),await this.UpdateOwnershipHighlights(),b.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&localStorage.setItem("PersistentFogData",JSON.stringify(this.persistentLights))}async ClearDoors(){if(b.playerRole!=="PLAYER")return;const e=b.sceneLocal.filter(t=>t.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);await T.scene.local.deleteItems(e.map(t=>t.id))}async UpdateDoors(){if(b.playerRole==="PLAYER"&&b.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]!==!0)return;const e=b.sceneItems.filter(n=>or(n)),t=b.sceneLocal.filter(n=>n.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);if(e.length>0){const n=[];for(const r of e)if(!t.some(o=>o.metadata[`${d.EXTENSIONID}/doorId`]===r.id)){const o=Fe.fromItem(r),s=[];for(let h=0;h<r.points.length;h++){const E=Fe.fromPosition(r.points[h]);s.push(Fe.decompose(Fe.multiply(o,E)).position)}const l=r.metadata[`${d.EXTENSIONID}/doorOpen`]===!0,p=ja.centroid(s);n.push(qt({height:100,width:100,url:l?d.DOOROPEN:d.DOORCLOSED,mime:"image/svg+xml"},{dpi:300,offset:{x:75,y:75}}).scale({x:1,y:1}).layer("DRAWING").locked(!0).name(l?"Opened Door":"Closed Door").position({x:p.x,y:p.y}).metadata({[`${d.EXTENSIONID}/doorId`]:r.id}).build())}n.length>0&&await T.scene.local.addItems(n)}else t.length>0&&await T.scene.local.deleteItems(t.map(n=>n.id));if(t.length>0){const n=[],r=[];for(const o of t){const s=b.sceneItems.find(l=>l.id===o.metadata[`${d.EXTENSIONID}/doorId`]);s?s.metadata[`${d.EXTENSIONID}/isDoor`]===void 0?r.push(o.id):(o.image.url===d.DOOROPEN&&s.metadata[`${d.EXTENSIONID}/doorOpen`]===void 0||o.image.url===d.DOORCLOSED&&s.metadata[`${d.EXTENSIONID}/doorOpen`]===!0)&&n.push(o.id):r.push(o.id)}n.length>0&&await T.scene.local.updateItems(o=>n.includes(o.id),o=>{for(let s of o)s.image.url===d.DOOROPEN?(s.image.url=d.DOORCLOSED,s.name="Closed Door"):(s.image.url=d.DOOROPEN,s.name="Open Door")}),r.length>0&&await T.scene.local.deleteItems(r)}}async ClearPersistence(){await T.scene.local.deleteItems(this.persistentLights.map(e=>e.id)),this.persistentLights=[]}async TogglePersistentLightVisibility(e){await T.scene.local.updateItems(t=>fr(t)!==void 0,t=>{for(let n of t)n.visible=!e})}async ClearOwnershipHighlights(){const e=b.sceneLocal.filter(t=>ni(t));await T.scene.local.deleteItems(e.map(t=>t.id))}async InitiateOwnerHighlight(){if(b.playerRole!=="GM"||b.fogFilled===!1)return;const e=b.sceneItems.filter(t=>ln(t));for(const t of e)this.CreateOwnerHighlight(t,!0)}CreateOwnerHighlight(e,t=!1){if((b.playerRole!=="GM"||b.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0)&&!t)return;if(b.sceneLocal.find(r=>r.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0&&r.attachedTo===e.id))this.UpdateOwnerHightlight(e);else{const r=b.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`],o=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT),s=Ca().strokeColor(r.color).fillOpacity(0).position({x:e.position.x,y:e.position.y}).width(o*2).height(o*2).shapeType("CIRCLE").metadata({[`${d.EXTENSIONID}/isIndicatorRing`]:!0}).attachedTo(e.id).locked(!0).layer(d.LINELAYER).disableAttachmentBehavior(["SCALE"]).zIndex(1).build();this.ringsToCreate.push(s)}}UpdateDarkVision(e){const t=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT),n=b.sceneLocal.find(r=>r.attachedTo===e.id&&r.metadata[`${d.EXTENSIONID}/isDarkVision`]===!0);if(n){const r={id:n.id,size:t};this.darkVisionToUpdate.push(r)}}UpdateOwnerHightlight(e){if(b.playerRole!=="GM"||b.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0)return;const t=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT),n=b.sceneLocal.find(r=>r.attachedTo===e.id&&r.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0);if(n){const r={id:n.id,height:t*2,width:t*2};this.ringsToUpdate.push(r)}}async UpdateOwnershipHighlights(){if(b.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0){if(this.ringsToCreate.length>0&&await T.scene.local.addItems(this.ringsToCreate),this.ringsToDelete.length>0&&await T.scene.local.deleteItems(this.ringsToDelete),this.ringsToUpdate.length>0){const e=b.sceneLocal.filter(t=>ni(t));await T.scene.local.updateItems(e.filter(t=>!this.ringsToDelete.includes(t.id)),t=>{for(let n of t){const r=this.ringsToUpdate.find(o=>o.id===n.id);r&&(n.height=r.height,n.width=r.width)}})}this.ringsToCreate=[],this.ringsToUpdate=[],this.ringsToDelete=[]}}async UpdateLights(){let e=[];if(b.playerRole==="GM"){const s=document.getElementById("preview_select");s?.value!==b.playerId?e=b.sceneItems.filter(l=>(l.layer==="CHARACTER"||l.layer==="MOUNT"||l.layer==="ATTACHMENT"||l.layer==="PROP")&&l.createdUserId===s.value&&l.metadata[`${d.EXTENSIONID}/hasVision`]):e=b.sceneItems.filter(l=>ln(l))}else{const s=b.party.filter(h=>h.role==="GM").map(h=>h.id),l=b.sceneItems.filter(h=>ln(h)&&s.includes(h.createdUserId));e=[...b.sceneItems.filter(h=>Wi(h)),...l]}b.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0&&(e=[]);const t=b.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`]??[];for(const s of e){let l=-10;for(const h of t)Qn(s.position,h.Points)&&h.Depth>l&&(l=h.Depth);const p=b.sceneLocal.find(h=>h.metadata[`${d.EXTENSIONID}/isVisionLight`]===s.id);if(!p)this.CreateLightToQueue(s,l);else{let h=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionRange`])===p.attenuationRadius;parseInt(s.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(s.metadata[`${d.EXTENSIONID}/visionRange`])&&(h=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionDark`])===p.attenuationRadius);const E=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionSourceRange`])===p.sourceRadius,_=s.metadata[`${d.EXTENSIONID}/visionFallOff`]===p.falloff.toString(),N=s.metadata[`${d.EXTENSIONID}/visionInAngle`]===p.innerAngle.toString(),D=s.metadata[`${d.EXTENSIONID}/visionOutAngle`]===p.outerAngle.toString(),O=s.metadata[`${d.EXTENSIONID}/visionBlind`]===p.metadata[`${d.EXTENSIONID}/visionOutAngle`],X=this.GetDepth(l,!1)===p.zIndex;(!h||!E||!_||!N||!D||!O||!X)&&this.UpdateLightToQueue(s,p,l);const H=b.sceneLocal.find(V=>V.metadata[`${d.EXTENSIONID}/isDarkVision`]===s.id&&V.attachedTo===s.id);H?this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionRange`])===H.width||this.UpdateDarkVision(s):this.CreateDarkVisionToQueue(s)}if(s.layer==="CHARACTER"&&(s.metadata[`${d.EXTENSIONID}/visionInAngle`]!=="360"||s.metadata[`${d.EXTENSIONID}/visionOutAngle`]!=="360")&&(b.sceneLocal.find(E=>E.metadata[`${d.EXTENSIONID}/isLocalDecal`]===s.id)||this.CreateDecalToQueue(s)),b.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&!this.persistentLights.find(h=>h.position===s.position)&&this.IsPositionClear(s.position)){if(this.persistenceLimit===this.persistentLights.length){const h=this.persistentLights.shift();this.lightsToDelete.push(h.id)}this.AddPersistentLightToQueue(s,l)}}const n=b.sceneLocal.filter(s=>cr(s));for(const s of n)if(!e.find(p=>p.id===s.metadata[`${d.EXTENSIONID}/isVisionLight`])){this.lightsToDelete.push(s.id);const p=b.sceneLocal.find(h=>h.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0&&h.attachedTo===s.metadata[`${d.EXTENSIONID}/isVisionLight`]);p&&this.ringsToDelete.push(p.id)}const r=b.sceneLocal.filter(s=>pr(s));for(const s of r){const l=e.find(p=>p.id===s.metadata[`${d.EXTENSIONID}/isLocalDecal`]);l?l.metadata[`${d.EXTENSIONID}/visionInAngle`]==="360"||l.metadata[`${d.EXTENSIONID}/visionOutAngle`]==="360"?this.decalsToDelete.push(s.id):l.image.url!==s.image.url&&this.decalsToUpdate.push({id:s.id,imageUrl:l.image.url}):this.decalsToDelete.push(s.id)}const o=b.sceneLocal.filter(s=>hr(s));for(const s of o){const l=e.find(p=>p.id===s.metadata[`${d.EXTENSIONID}/isDarkVision`]);l?parseInt(l.metadata[`${d.EXTENSIONID}/visionDark`])<parseInt(l.metadata[`${d.EXTENSIONID}/visionRange`])&&this.decalsToDelete.push(s.id):this.decalsToDelete.push(s.id)}this.lightsToCreate.length>0&&await T.scene.local.addItems(this.lightsToCreate),this.lightsToDelete.length>0&&await T.scene.local.deleteItems(this.lightsToDelete),this.lightsToUpdate.length>0&&await T.scene.local.updateItems(n.filter(s=>!this.lightsToDelete.includes(s.id)),s=>{for(let l of s){const p=this.lightsToUpdate.find(h=>h.id===l.id);p&&(l.attenuationRadius=p.attenuationRadius,l.sourceRadius=p.sourceRadius,l.falloff=p.falloff,l.innerAngle=p.innerAngle,l.outerAngle=p.outerAngle,l.metadata[`${d.EXTENSIONID}/visionBlind`]=p.blind,l.zIndex=p.zIndex)}}),this.decalsToCreate.length>0&&await T.scene.local.addItems(this.decalsToCreate),this.decalsToDelete.length>0&&await T.scene.local.deleteItems(this.decalsToDelete),this.decalsToUpdate.length>0&&await T.scene.local.updateItems(r.filter(s=>!this.decalsToDelete.includes(s.id)),s=>{for(let l of s){const p=this.decalsToUpdate.find(h=>h.id===l.id);p&&(l.image.url=p.imageUrl)}}),this.darkVisionToCreate.length>0&&await T.scene.local.addItems(this.darkVisionToCreate),this.darkVisionToDelete.length>0&&await T.scene.local.deleteItems(this.darkVisionToDelete),this.darkVisionToUpdate.length>0&&await T.scene.local.updateItems(o.filter(s=>!this.darkVisionToDelete.includes(s.id)),s=>{for(let l of s){const p=this.darkVisionToUpdate.find(h=>h.id===l.id);p&&(l.width=p.size,l.height=p.size)}}),this.lightsToCreate=[],this.lightsToUpdate=[],this.lightsToDelete=[],this.decalsToCreate=[],this.decalsToDelete=[],this.decalsToUpdate=[],this.darkVisionToCreate=[],this.darkVisionToUpdate=[],this.darkVisionToDelete=[]}async UpdateWalls(){const e=b.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`]??[],t=b.sceneItems.filter(r=>dr(r));for(const r of t){let o=-10;for(const l of e)Qn(r.points[0],l.Points)&&l.Depth>o&&(o=l.Depth);const s=b.sceneLocal.find(l=>l.metadata[`${d.EXTENSIONID}/isVisionWall`]===r.id);if(!s)this.CreateWallToQueue(r,o);else{const l=Ga(r,s),p=r.position.x===s.position.x&&r.position.y===s.position.y,h=r.metadata[`${d.EXTENSIONID}/blocking`]===s.blocking,E=r.metadata[`${d.EXTENSIONID}/doubleSided`]===s.doubleSided,_=this.GetDepth(o,!0)===s.zIndex;(!l||!p||!h||!E||!_)&&this.UpdateWallToQueue(r,s,o)}}const n=b.sceneLocal.filter(r=>ur(r));for(const r of n)t.find(s=>s.id===r.metadata[`${d.EXTENSIONID}/isVisionWall`])||this.wallsToDelete.push(r.id);this.wallsToCreate.length>0&&await T.scene.local.addItems(this.wallsToCreate),this.wallsToDelete.length>0&&await T.scene.local.deleteItems(this.wallsToDelete),this.wallsToUpdate.length>0&&await T.scene.local.updateItems(n.filter(r=>!this.wallsToDelete.includes(r.id)),r=>{for(let o of r){const s=this.wallsToUpdate.find(l=>l.id===o.id);s&&(o.points=s.points,o.position=s.position,o.blocking=s.blocking,o.doubleSided=s.doubleSided,o.zIndex=s.zIndex)}}),this.wallsToCreate=[],this.wallsToUpdate=[],this.wallsToDelete=[]}CreateWallToQueue(e,t){const n=Aa().points(e.points).position(e.position).locked(!0).blocking(e.metadata[`${d.EXTENSIONID}/blocking`]??!1).doubleSided(e.metadata[`${d.EXTENSIONID}/doubleSided`]??!1).zIndex(this.GetDepth(t,!0)).metadata({[`${d.EXTENSIONID}/isVisionWall`]:e.id}).build();this.wallsToCreate.push(n)}AddPersistentLightToQueue(e,t){if((e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY")==="SECONDARY")return;const r=Wn().position(e.position).lightType("AUXILIARY").attenuationRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT)).sourceRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??d.SOURCEDEFAULT)).falloff(parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??d.FALLOFFDEFAULT)).innerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??d.INANGLEDEFAULT)).outerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??d.OUTANGLEDEFAULT)).zIndex(this.GetDepth(t,!1)).metadata({[`${d.EXTENSIONID}/isPersistentLight`]:e.id}).build();this.lightsToCreate.push(r),this.persistentLights.push({id:r.id,position:r.position,zIndex:t,metadata:e.metadata})}CreateLightToQueue(e,t){const n=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",r=e.metadata[`${d.EXTENSIONID}/visionBlind`]===!0?1:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT),o=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),s=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]),l=Wn().position(e.position).lightType(n).attenuationRadius(o?s:r).sourceRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??d.SOURCEDEFAULT)).falloff(parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??d.FALLOFFDEFAULT)).innerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??d.INANGLEDEFAULT)).outerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??d.OUTANGLEDEFAULT)).zIndex(this.GetDepth(t,!1)).metadata({[`${d.EXTENSIONID}/isVisionLight`]:e.id,[`${d.EXTENSIONID}/visionBlind`]:e.metadata[`${d.EXTENSIONID}/visionBlind`]??!1}).attachedTo(e.id).disableAttachmentBehavior(["SCALE"]).build();this.lightsToCreate.push(l),n==="PRIMARY"&&(this.CreateDarkVisionToQueue(e),this.CreateOwnerHighlight(e))}CreateDarkVisionToQueue(e){const t=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`]),n=parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]);if(!t||!n||t<n)return;const r=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`])*2,o=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`])*2,s=r*.9/o/2,l=$a().position({x:e.position.x-o/2,y:e.position.y-o/2}).attachedTo(e.id).width(o).height(o).blendMode("SATURATION").effectType("STANDALONE").attachedTo(e.id).sksl(d.DARKVISIONSHADER).metadata({[`${d.EXTENSIONID}/isDarkVision`]:!0}).disableHit(!0).disableAttachmentBehavior(["SCALE"]).uniforms([{name:"center",value:{x:.5,y:.5}},{name:"radius",value:.5},{name:"clear",value:s},{name:"smoothwidth",value:.075}]).build();this.darkVisionToCreate.push(l)}CreateDecalToQueue(e){const t=qt({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).position(e.position).attachedTo(e.id).layer("FOG").visible(!1).metadata({[`${d.EXTENSIONID}/isLocalDecal`]:e.id}).disableHit(!0).build();this.decalsToCreate.push(t)}UpdateWallToQueue(e,t,n){const r={id:t.id,points:e.points,position:e.position,blocking:e.metadata[`${d.EXTENSIONID}/blocking`]??!1,doubleSided:e.metadata[`${d.EXTENSIONID}/doubleSided`]??!1,zIndex:this.GetDepth(n,!0)};this.wallsToUpdate.push(r)}UpdateLightToQueue(e,t,n){const r=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",o=e.metadata[`${d.EXTENSIONID}/visionBlind`]===!0?1:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??d.ATTENUATIONDEFAULT),s=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),l=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]),p={id:t.id,attenuationRadius:s?l:o,sourceRadius:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??d.SOURCEDEFAULT),falloff:parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??d.FALLOFFDEFAULT),innerAngle:parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??d.INANGLEDEFAULT),outerAngle:parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??d.OUTANGLEDEFAULT),blind:e.metadata[`${d.EXTENSIONID}/visionBlind`]??!1,zIndex:this.GetDepth(n,!1)};this.lightsToUpdate.push(p),r==="PRIMARY"&&this.UpdateOwnerHightlight(e)}GetLightRange(e){return parseInt(e)/b.gridScale*b.gridDpi}GetDepth(e,t){switch(e){case 1:return t?-4:-5;case 2:return t?-5:-6;case 3:return t?-6:-7;case 4:return t?-7:-8;case 5:return t?-8:-9;default:return-1}}IsPositionClear(e){const t=(b.gridDpi-10)*this.persistenceCullingDistance;for(const n of this.persistentLights)if(Tn(e,n.position)<=t)return!1;return!0}async ToggleDoor(e){const t=b.sceneLocal.filter(n=>n.id===e&&n.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);if(t.length===1){const n=b.sceneItems.filter(r=>r.id===t[0].metadata[`${d.EXTENSIONID}/doorId`]);if(n.length===1){const r=n[0];if(b.playerRole!=="GM"&&r.metadata[`${d.EXTENSIONID}/isDoorLocked`])return;await T.scene.items.updateItems(n,o=>{for(let s of o)s.metadata[`${d.EXTENSIONID}/isVisionLine`]&&s.metadata[`${d.EXTENSIONID}/disabled`]?(delete s.metadata[`${d.EXTENSIONID}/disabled`],delete s.metadata[`${d.EXTENSIONID}/doorOpen`]):s.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(s.metadata[`${d.EXTENSIONID}/disabled`]=!0,s.metadata[`${d.EXTENSIONID}/doorOpen`]=!0,delete s.metadata[`${d.EXTENSIONID}/isDoorLocked`])}),await T.player.deselect([e])}}}}const Ne=new vr;function un(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class yr{constructor(){this._events=void 0,this._events={}}on(e,t){un(e,n=>{const r=this._events[n]||[];r.push(t),this._events[n]=r})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}un(e,r=>{if(n===1){delete this._events[r];return}const o=this._events[r];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[r]=o)})}trigger(e,...t){var n=this;un(e,r=>{const o=n._events[r];o!==void 0&&o.forEach(s=>{s.apply(n,t)})})}}function Er(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const r=this,o=[];if(Array.isArray(e))e.forEach(s=>{typeof s=="string"?o.push(s):(r.plugins.settings[s.name]=s.options,o.push(s.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(r.plugins.settings[t]=e[t],o.push(t));for(;n=o.shift();)r.require(n)}loadPlugin(e){var t=this,n=t.plugins,r=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=r.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const tn=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Ir(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),qi=i=>{if(!wr(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((r,o)=>{if(r===i[o-1]){t++;return}n(),e+=r,t=1}),n(),e},Ki=i=>{let e=Rn(i);return tn(e)},wr=i=>new Set(i).size!==i.length,Ct=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Ir=i=>i.reduce((e,t)=>Math.max(e,br(t)),0),br=i=>Rn(i).length,Rn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Yi=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Yi(t).forEach(function(r){let o=r.slice(0);o[0]=i.charAt(0)+o[0],e.push(o),o=r.slice(0),o.unshift(i.charAt(0)),e.push(o)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Tr=[[0,65535]],_r="[̀-ͯ·ʾʼ]";let Kt,Qi;const Nr=3,xn={},ii={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in ii){let e=ii[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);xn[n]=i}}const Sr=new RegExp(Object.keys(xn).join("|")+"|"+_r,"gu"),Or=i=>{Kt===void 0&&(Kt=Cr(Tr))},ai=(i,e="NFKD")=>i.normalize(e),Yt=i=>Rn(i).reduce((e,t)=>e+kr(t),""),kr=i=>(i=ai(i).toLowerCase().replace(Sr,e=>xn[e]||""),ai(i,"NFC"));function*Dr(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let r=String.fromCharCode(n),o=Yt(r);o!=r.toLowerCase()&&(o.length>Nr||o.length!=0&&(yield{folded:o,composed:r,code_point:n}))}}const Lr=i=>{const e={},t=(n,r)=>{const o=e[n]||new Set,s=new RegExp("^"+Ki(o)+"$","iu");r.match(s)||(o.add(Ct(r)),e[n]=o)};for(let n of Dr(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},Cr=i=>{const e=Lr(i),t={};let n=[];for(let o in e){let s=e[o];s&&(t[o]=Ki(s)),o.length>1&&n.push(Ct(o))}n.sort((o,s)=>s.length-o.length);const r=tn(n);return Qi=new RegExp("^"+r,"u"),t},Ar=(i,e=1)=>{let t=0;return i=i.map(n=>(Kt[n]&&(t+=n.length),Kt[n]||n)),t>=e?qi(i):""},$r=(i,e=1)=>(e=Math.max(e,i.length-1),tn(Yi(i).map(t=>Ar(t,e)))),ri=(i,e=!0)=>{let t=i.length>1?1:0;return tn(i.map(n=>{let r=[];const o=e?n.length():n.length()-1;for(let s=0;s<o;s++)r.push($r(n.substrs[s]||"",t));return qi(r)}))},Mr=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const r=s=>{for(const l of n){if(l.start===s.start&&l.substr===s.substr)return!1;if(!(s.length==1||l.length==1)&&(s.start<l.start&&s.end>l.start||l.start<s.start&&l.end>s.start))return!0}return!1};if(!(t.parts.filter(r).length>0))return!0}return!1};class Qt{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new Qt,r=JSON.parse(JSON.stringify(this.parts)),o=r.pop();for(const p of r)n.add(p);let s=t.substr.substring(0,e-o.start),l=s.length;return n.add({start:o.start,end:o.start+l,length:l,substr:s}),n}}const Pr=i=>{Or(),i=Yt(i);let e="",t=[new Qt];for(let n=0;n<i.length;n++){let o=i.substring(n).match(Qi);const s=i.substring(n,n+1),l=o?o[0]:null;let p=[],h=new Set;for(const E of t){const _=E.last();if(!_||_.length==1||_.end<=n)if(l){const N=l.length;E.add({start:n,end:n+N,length:N,substr:l}),h.add("1")}else E.add({start:n,end:n+1,length:1,substr:s}),h.add("2");else if(l){let N=E.clone(n,_);const D=l.length;N.add({start:n,end:n+D,length:D,substr:l}),p.push(N)}else h.add("3")}if(p.length>0){p=p.sort((E,_)=>E.length()-_.length());for(let E of p)Mr(E,t)||t.push(E);continue}if(n>0&&h.size==1&&!h.has("3")){e+=ri(t,!1);let E=new Qt;const _=t[0];_&&E.add(_.last()),t=[E]}}return e+=ri(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Rr=(i,e)=>{if(i)return i[e]},xr=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},cn=(i,e,t)=>{var n,r;return!i||(i=i+"",e.regex==null)||(r=i.search(e.regex),r===-1)?0:(n=e.string.length/i.length,r===0&&(n+=.5),n*t)},fn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},ge=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Xr=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=Yt(i+"").toLowerCase(),e=Yt(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Vr{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const r=[],o=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(Ct).join("|")+"):(.*)$")),o.forEach(l=>{let p,h=null,E=null;s&&(p=l.match(s))&&(h=p[1],l=p[2]),l.length>0&&(this.settings.diacritics?E=Pr(l)||null:E=Ct(l),E&&t&&(E="\\b"+E)),r.push({string:l,regex:E?new RegExp(E,"iu"):null,field:h})}),r}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const r=e.options.fields,o=e.weights,s=r.length,l=e.getAttrFn;if(!s)return function(){return 1};const p=function(){return s===1?function(h,E){const _=r[0].field;return cn(l(E,_),h,o[_]||1)}:function(h,E){var _=0;if(h.field){const N=l(E,h.field);!h.regex&&N?_+=1/s:_+=cn(N,h,1)}else ge(o,(N,D)=>{_+=cn(l(E,D),h,N)});return _/s}}();return n===1?function(h){return p(t[0],h)}:e.options.conjunction==="and"?function(h){var E,_=0;for(let N of t){if(E=p(N,h),E<=0)return 0;_+=E}return _/n}:function(h){var E=0;return ge(t,_=>{E+=p(_,h)}),E/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const r=this,o=e.options,s=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof s=="function")return s.bind(this);const l=function(E,_){return E==="$score"?_.score:e.getAttrFn(r.items[_.id],E)};if(s)for(let h of s)(e.query||h.field!=="$score")&&n.push(h);if(e.query){t=!0;for(let h of n)if(h.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(h=>h.field!=="$score");return n.length?function(h,E){var _,N;for(let D of n)if(N=D.field,_=(D.direction==="desc"?-1:1)*Xr(l(N,h),l(N,E)),_)return _;return 0}:null}prepareSearch(e,t){const n={};var r=Object.assign({},t);if(fn(r,"sort"),fn(r,"sort_empty"),r.fields){fn(r,"fields");const o=[];r.fields.forEach(s=>{typeof s=="string"&&(s={field:s,weight:1}),o.push(s),n[s.field]="weight"in s?s.weight:1}),r.fields=o}return{options:r,query:e.toLowerCase().trim(),tokens:this.tokenize(e,r.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:r.nesting?xr:Rr}}search(e,t){var n=this,r,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const s=t.score||n._getScoreFunction(o);e.length?ge(n.items,(p,h)=>{r=s(p),(t.filter===!1||r>0)&&o.items.push({score:r,id:h})}):ge(n.items,(p,h)=>{o.items.push({score:1,id:h})});const l=n._getSortFunction(o);return l&&o.items.sort(l),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const ht=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},pe=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(Ji(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},Ji=i=>typeof i=="string"&&i.indexOf("<")>-1,Fr=i=>i.replace(/['"\\]/g,"\\$&"),pn=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Vt=(i,e)=>{Object.assign(i.style,e)},me=(i,...e)=>{var t=Zi(e);i=ea(i),i.map(n=>{t.map(r=>{n.classList.add(r)})})},ze=(i,...e)=>{var t=Zi(e);i=ea(i),i.map(n=>{t.map(r=>{n.classList.remove(r)})})},Zi=i=>{var e=[];return ht(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},ea=i=>(Array.isArray(i)||(i=[i]),i),jt=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},si=(i,e=0)=>e>0?i[i.length-1]:i[0],Hr=i=>Object.keys(i).length===0,Jt=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},de=(i,e)=>{ht(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},kn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Br=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var s=o.data.match(e);if(s&&o.data.length>0){var l=document.createElement("span");l.className="highlight";var p=o.splitText(s.index);p.splitText(s[0].length);var h=p.cloneNode(!0);return l.appendChild(h),kn(p,l),1}return 0},n=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(s=>{r(s)})},r=o=>o.nodeType===3?t(o):(n(o),0);r(i)},Ur=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},jr=65,zr=13,ta=27,Dn=37,Gr=38,na=39,Wr=40,oi=8,qr=46,Ln=9,Kr=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Ft=Kr?"metaKey":"ctrlKey";var di={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const De=i=>typeof i>"u"||i===null?null:zt(i),zt=i=>typeof i=="boolean"?i?"1":"0":i+"",Gt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Yr=(i,e)=>e>0?setTimeout(i,e):(i.call(null),null),Qr=(i,e)=>{var t;return function(n,r){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[n]=!0,i.call(o,n,r)},e)}},li=(i,e,t)=>{var n,r=i.trigger,o={};i.trigger=function(){var s=arguments[0];if(e.indexOf(s)!==-1)o[s]=arguments;else return r.apply(i,arguments)},t.apply(i,[]),i.trigger=r;for(n of e)n in o&&r.apply(i,o[n])},Jr=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),ae=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},re=(i,e,t,n)=>{i.addEventListener(e,t,n)},et=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},hn=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},ui=i=>i.replace(/[\\"']/g,"\\$&"),tt=(i,e)=>{e&&i.append(e)};function ci(i,e){var t=Object.assign({},di,e),n=t.dataAttr,r=t.labelField,o=t.valueField,s=t.disabledField,l=t.optgroupField,p=t.optgroupLabelField,h=t.optgroupValueField,E=i.tagName.toLowerCase(),_=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!_&&!t.allowEmptyOption){let X=i.querySelector('option[value=""]');X&&(_=X.textContent)}var N={placeholder:_,options:[],optgroups:[],items:[],maxItems:null},D=()=>{var X,H=N.options,V={},M=1;let j=0;var a=f=>{var y=Object.assign({},f.dataset),v=n&&y[n];return typeof v=="string"&&v.length&&(y=Object.assign(y,JSON.parse(v))),y},c=(f,y)=>{var v=De(f.value);if(v!=null&&!(!v&&!t.allowEmptyOption)){if(V.hasOwnProperty(v)){if(y){var g=V[v][l];g?Array.isArray(g)?g.push(y):V[v][l]=[g,y]:V[v][l]=y}}else{var m=a(f);m[r]=m[r]||f.textContent,m[o]=m[o]||v,m[s]=m[s]||f.disabled,m[l]=m[l]||y,m.$option=f,m.$order=m.$order||++j,V[v]=m,H.push(m)}f.selected&&N.items.push(v)}},u=f=>{var y,v;v=a(f),v[p]=v[p]||f.getAttribute("label")||"",v[h]=v[h]||M++,v[s]=v[s]||f.disabled,v.$order=v.$order||++j,N.optgroups.push(v),y=v[h],ht(f.children,g=>{c(g,y)})};N.maxItems=i.hasAttribute("multiple")?null:1,ht(i.children,f=>{X=f.tagName.toLowerCase(),X==="optgroup"?u(f):X==="option"&&c(f)})},O=()=>{const X=i.getAttribute(n);if(X)N.options=JSON.parse(X),ht(N.options,V=>{N.items.push(V[o])});else{var H=i.value.trim()||"";if(!t.allowEmptyOption&&!H.length)return;const V=H.split(t.delimiter);ht(V,M=>{const j={};j[r]=M,j[o]=M,N.options.push(j)}),N.items=V}};return E==="select"?D():O(),Object.assign({},di,N,e)}var fi=0;class ve extends Er(yr){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,fi++;var n,r=pe(e);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(r,null);n=o.getPropertyValue("direction");const s=ci(r,t);this.settings=s,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=hn(r,"tomselect-"+fi),this.isRequired=r.required,this.sifter=new Vr(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(s.maxItems===1?"single":"multi"),typeof s.hideSelected!="boolean"&&(s.hideSelected=s.mode==="multi"),typeof s.hidePlaceholder!="boolean"&&(s.hidePlaceholder=s.mode!=="multi");var l=s.createFilter;typeof l!="function"&&(typeof l=="string"&&(l=new RegExp(l)),l instanceof RegExp?s.createFilter=H=>l.test(H):s.createFilter=H=>this.settings.duplicates||!this.options[H]),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const p=pe("<div>"),h=pe("<div>"),E=this._render("dropdown"),_=pe('<div role="listbox" tabindex="-1">'),N=this.input.getAttribute("class")||"",D=s.mode;var O;if(me(p,s.wrapperClass,N,D),me(h,s.controlClass),tt(p,h),me(E,s.dropdownClass,D),s.copyClassesToDropdown&&me(E,N),me(_,s.dropdownContentClass),tt(E,_),pe(s.dropdownParent||p).appendChild(E),Ji(s.controlInput)){O=pe(s.controlInput);var X=["autocorrect","autocapitalize","autocomplete","spellcheck"];ge(X,H=>{r.getAttribute(H)&&de(O,{[H]:r.getAttribute(H)})}),O.tabIndex=-1,h.appendChild(O),this.focus_node=O}else s.controlInput?(O=pe(s.controlInput),this.focus_node=O):(O=pe("<input/>"),this.focus_node=h);this.wrapper=p,this.dropdown=E,this.dropdown_content=_,this.control=h,this.control_input=O,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,r=e.dropdown,o=e.dropdown_content,s=e.wrapper,l=e.control,p=e.input,h=e.focus_node,E={passive:!0},_=e.inputId+"-ts-dropdown";de(o,{id:_}),de(h,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":_});const N=hn(h,e.inputId+"-ts-control"),D="label[for='"+Fr(e.inputId)+"']",O=document.querySelector(D),X=e.focus.bind(e);if(O){re(O,"click",X),de(O,{for:N});const M=hn(O,e.inputId+"-ts-label");de(h,{"aria-labelledby":M}),de(o,{"aria-labelledby":M})}if(s.style.width=p.style.width,e.plugins.names.length){const M="plugin-"+e.plugins.names.join(" plugin-");me([s,r],M)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&de(p,{multiple:"multiple"}),t.placeholder&&de(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Ct(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Qr(t.load,t.loadThrottle)),re(r,"mousemove",()=>{e.ignoreHover=!1}),re(r,"mouseenter",M=>{var j=jt(M.target,"[data-selectable]",r);j&&e.onOptionHover(M,j)},{capture:!0}),re(r,"click",M=>{const j=jt(M.target,"[data-selectable]");j&&(e.onOptionSelect(M,j),ae(M,!0))}),re(l,"click",M=>{var j=jt(M.target,"[data-ts-item]",l);if(j&&e.onItemSelect(M,j)){ae(M,!0);return}n.value==""&&(e.onClick(),ae(M,!0))}),re(h,"keydown",M=>e.onKeyDown(M)),re(n,"keypress",M=>e.onKeyPress(M)),re(n,"input",M=>e.onInput(M)),re(h,"blur",M=>e.onBlur(M)),re(h,"focus",M=>e.onFocus(M)),re(n,"paste",M=>e.onPaste(M));const H=M=>{const j=M.composedPath()[0];if(!s.contains(j)&&!r.contains(j)){e.isFocused&&e.blur(),e.inputState();return}j==n&&e.isOpen?M.stopPropagation():ae(M,!0)},V=()=>{e.isOpen&&e.positionDropdown()};re(document,"mousedown",H),re(window,"scroll",V,E),re(window,"resize",V,E),this._destroy=()=>{document.removeEventListener("mousedown",H),window.removeEventListener("scroll",V),window.removeEventListener("resize",V),O&&O.removeEventListener("click",X)},this.revertSettings={innerHTML:p.innerHTML,tabIndex:p.tabIndex},p.tabIndex=-1,p.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,re(p,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,p.disabled?e.disable():p.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),me(p,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),ge(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,r={optgroup:o=>{let s=document.createElement("div");return s.className="optgroup",s.appendChild(o.options),s},optgroup_header:(o,s)=>'<div class="optgroup-header">'+s(o[n])+"</div>",option:(o,s)=>"<div>"+s(o[t])+"</div>",item:(o,s)=>"<div>"+s(o[t])+"</div>",option_create:(o,s)=>'<div class="create">Add <strong>'+s(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},r,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?ci(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){pn(this.input,"input"),pn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){ae(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var r=n.trim().split(t.settings.splitOn);ge(r,o=>{De(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){ae(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),ae(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Ln&&ae(e);return}switch(e.keyCode){case jr:if(et(Ft,e)&&t.control_input.value==""){ae(e),t.selectAll();return}break;case ta:t.isOpen&&(ae(e,!0),t.close()),t.clearActiveItems();return;case Wr:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}ae(e);return;case Gr:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}ae(e);return;case zr:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),ae(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&ae(e);return;case Dn:t.advanceSelection(-1,e);return;case na:t.advanceSelection(1,e);return;case Ln:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),ae(e)),t.settings.create&&t.createItem()&&ae(e));return;case oi:case qr:t.deleteSelection(e);return}t.isInputHidden&&!et(Ft,e)&&ae(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=Yr(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),ae(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,r=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?r.createItem(null,()=>{r.settings.closeAfterSelect&&r.close()}):(n=t.dataset.value,typeof n<"u"&&(r.lastQuery=null,r.addItem(n),r.settings.closeAfterSelect&&r.close(),!r.settings.hideSelected&&e.type&&/click/.test(e.type)&&r.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(ae(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;me(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||ze(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,pn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];li(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,r,o,s,l,p,h;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(r=t&&t.type.toLowerCase(),r==="click"&&et("shiftKey",t)&&n.activeItems.length){for(h=n.getLastActive(),s=Array.prototype.indexOf.call(n.control.children,h),l=Array.prototype.indexOf.call(n.control.children,e),s>l&&(p=s,s=l,l=p),o=s;o<=l;o++)e=n.control.children[o],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);ae(t)}else r==="click"&&et(Ft,t)||r==="keydown"&&et("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&ze(n,"last-active"),me(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),ze(e,"active")}clearActiveItems(){ze(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,de(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),de(e,{"aria-selected":"true"}),me(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,r=n.clientHeight,o=n.scrollTop||0,s=e.offsetHeight,l=e.getBoundingClientRect().top-n.getBoundingClientRect().top+o;l+s>r+o?this.scroll(l-r+s,t):l<o&&this.scroll(l,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(ze(this.activeOption,"active"),de(this.activeOption,{"aria-selected":null})),this.activeOption=null,de(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,ge(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(de(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&de(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,r=this,o=this.getSearchOptions();if(r.settings.score&&(n=r.settings.score.call(r,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==r.lastQuery?(r.lastQuery=e,t=r.sifter.search(e,Object.assign(o,{score:n})),r.currentResults=t):t=Object.assign({},r.currentResults),r.settings.hideSelected&&(t.items=t.items.filter(s=>{let l=De(s.id);return!(l&&r.items.indexOf(l)!==-1)})),t}refreshOptions(e=!0){var t,n,r,o,s,l,p,h,E,_;const N={},D=[];var O=this,X=O.inputValue();const H=X===O.lastQuery||X==""&&O.lastQuery==null;var V=O.search(X),M=null,j=O.settings.shouldOpen||!1,a=O.dropdown_content;H&&(M=O.activeOption,M&&(E=M.closest("[data-group]"))),o=V.items.length,typeof O.settings.maxOptions=="number"&&(o=Math.min(o,O.settings.maxOptions)),o>0&&(j=!0);const c=(f,y)=>{let v=N[f];if(v!==void 0){let m=D[v];if(m!==void 0)return[v,m.fragment]}let g=document.createDocumentFragment();return v=D.length,D.push({fragment:g,order:y,optgroup:f}),[v,g]};for(t=0;t<o;t++){let f=V.items[t];if(!f)continue;let y=f.id,v=O.options[y];if(v===void 0)continue;let g=zt(y),m=O.getOption(g,!0);for(O.settings.hideSelected||m.classList.toggle("selected",O.items.includes(g)),s=v[O.settings.optgroupField]||"",l=Array.isArray(s)?s:[s],n=0,r=l&&l.length;n<r;n++){s=l[n];let L=v.$order,k=O.optgroups[s];k===void 0?s="":L=k.$order;const[C,A]=c(s,L);n>0&&(m=m.cloneNode(!0),de(m,{id:v.$id+"-clone-"+n,"aria-selected":null}),m.classList.add("ts-cloned"),ze(m,"active"),O.activeOption&&O.activeOption.dataset.value==y&&E&&E.dataset.group===s.toString()&&(M=m)),A.appendChild(m),s!=""&&(N[s]=C)}}O.settings.lockOptgroupOrder&&D.sort((f,y)=>f.order-y.order),p=document.createDocumentFragment(),ge(D,f=>{let y=f.fragment,v=f.optgroup;if(!y||!y.children.length)return;let g=O.optgroups[v];if(g!==void 0){let m=document.createDocumentFragment(),L=O.render("optgroup_header",g);tt(m,L),tt(m,y);let k=O.render("optgroup",{group:g,options:m});tt(p,k)}else tt(p,y)}),a.innerHTML="",tt(a,p),O.settings.highlight&&(Ur(a),V.query.length&&V.tokens.length&&ge(V.tokens,f=>{Br(a,f.regex)}));var u=f=>{let y=O.render(f,{input:X});return y&&(j=!0,a.insertBefore(y,a.firstChild)),y};if(O.loading?u("loading"):O.settings.shouldLoad.call(O,X)?V.items.length===0&&u("no_results"):u("not_loading"),h=O.canCreate(X),h&&(_=u("option_create")),O.hasOptions=V.items.length>0||h,j){if(V.items.length>0){if(!M&&O.settings.mode==="single"&&O.items[0]!=null&&(M=O.getOption(O.items[0])),!a.contains(M)){let f=0;_&&!O.settings.addPrecedence&&(f=1),M=O.selectable()[f]}}else _&&(M=_);e&&!O.isOpen&&(O.open(),O.scrollToOption(M,"auto")),O.setActiveOption(M)}else O.clearActiveOption(),e&&O.isOpen&&O.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const r=De(e[n.settings.valueField]);return r===null||n.options.hasOwnProperty(r)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[r]=e,n.lastQuery=null,t&&(n.userOptions[r]=t,n.trigger("option_add",r,e)),r)}addOptions(e,t=!1){ge(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=De(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var r,o;const s=De(e),l=De(t[n.settings.valueField]);if(s===null)return;const p=n.options[s];if(p==null)return;if(typeof l!="string")throw new Error("Value must be set in option data");const h=n.getOption(s),E=n.getItem(s);if(t.$order=t.$order||p.$order,delete n.options[s],n.uncacheValue(l),n.options[l]=t,h){if(n.dropdown_content.contains(h)){const _=n._render("option",t);kn(h,_),n.activeOption===h&&n.setActiveOption(_)}h.remove()}E&&(o=n.items.indexOf(s),o!==-1&&n.items.splice(o,1,l),r=n._render("item",t),E.classList.contains("active")&&me(r,"active"),kn(E,r)),n.lastQuery=null}removeOption(e,t){const n=this;e=zt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};ge(this.options,(r,o)=>{t(r,o)&&(n[o]=r)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=De(e);if(n===null)return null;const r=this.options[n];if(r!=null){if(r.$div)return r.$div;if(t)return this._render("option",r)}return null}getAdjacent(e,t,n="option"){var r=this,o;if(!e)return null;n=="item"?o=r.controlChildren():o=r.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<o.length;s++)if(o[s]==e)return t>0?o[s+1]:o[s-1];return null}getItem(e){if(typeof e=="object")return e;var t=De(e);return t!==null?this.control.querySelector(`[data-value="${ui(t)}"]`):null}addItems(e,t){var n=this,r=Array.isArray(e)?e:[e];r=r.filter(s=>n.items.indexOf(s)===-1);const o=r[r.length-1];r.forEach(s=>{n.isPending=s!==o,n.addItem(s,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];li(this,n,()=>{var r,o;const s=this,l=s.settings.mode,p=De(e);if(!(p&&s.items.indexOf(p)!==-1&&(l==="single"&&s.close(),l==="single"||!s.settings.duplicates))&&!(p===null||!s.options.hasOwnProperty(p))&&(l==="single"&&s.clear(t),!(l==="multi"&&s.isFull()))){if(r=s._render("item",s.options[p]),s.control.contains(r)&&(r=r.cloneNode(!0)),o=s.isFull(),s.items.splice(s.caretPos,0,p),s.insertAtCaret(r),s.isSetup){if(!s.isPending&&s.settings.hideSelected){let h=s.getOption(p),E=s.getAdjacent(h,1);E&&s.setActiveOption(E)}!s.isPending&&!s.settings.closeAfterSelect&&s.refreshOptions(s.isFocused&&l!=="single"),s.settings.closeAfterSelect!=!1&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",p,r),s.isPending||s.updateOriginalInput({silent:t})}(!s.isPending||!o&&s.isFull())&&(s.inputState(),s.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var r,o;const s=e.dataset.value;r=Jt(e),e.remove(),e.classList.contains("active")&&(o=n.activeItems.indexOf(e),n.activeItems.splice(o,1),ze(e,"active")),n.items.splice(r,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(s)&&n.removeOption(s,t),r<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",s,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,r=n.caretPos,o;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var s=!1,l=p=>{if(n.unlock(),!p||typeof p!="object")return t();var h=De(p[n.settings.valueField]);if(typeof h!="string")return t();n.setTextboxValue(),n.addOption(p,!0),n.setCaret(r),n.addItem(h),t(p),s=!0};return typeof n.settings.create=="function"?o=n.settings.create.call(this,e,l):o={[n.settings.labelField]:e,[n.settings.valueField]:e},s||l(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const r=e.wrapper.classList;r.toggle("focus",e.isFocused),r.toggle("disabled",e.isDisabled),r.toggle("readonly",e.isReadOnly),r.toggle("required",e.isRequired),r.toggle("invalid",!e.isValid),r.toggle("locked",n),r.toggle("full",t),r.toggle("input-active",e.isFocused&&!e.isInputHidden),r.toggle("dropdown-active",e.isOpen),r.toggle("has-options",Hr(e.options)),r.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,r;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let p=function(h,E,_){return h||(h=pe('<option value="'+Gt(E)+'">'+Gt(_)+"</option>")),h!=o&&t.input.append(h),s.push(h),(h!=o||l>0)&&(h.selected=!0),h};const s=[],l=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(h=>{h.selected=!1}),t.items.length==0&&t.settings.mode=="single"?p(o,"",""):t.items.forEach(h=>{if(n=t.options[h],r=n[t.settings.labelField]||"",s.includes(n.$option)){const E=t.input.querySelector(`option[value="${ui(h)}"]:not(:checked)`);p(E,h,r)}else n.$option=p(n.$option,h,r)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,de(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Vt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Vt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,de(t.focus_node,{"aria-expanded":"false"}),Vt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,r=t.left+window.scrollX;Vt(this.dropdown,{width:t.width+"px",top:n+"px",left:r+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();ge(n,r=>{t.removeItem(r,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,r=t.control;r.insertBefore(e,r.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,r,o,s=this;t=e&&e.keyCode===oi?-1:1,n=Jr(s.control_input);const l=[];if(s.activeItems.length)o=si(s.activeItems,t),r=Jt(o),t>0&&r++,ge(s.activeItems,p=>l.push(p));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const p=s.controlChildren();let h;t<0&&n.start===0&&n.length===0?h=p[s.caretPos-1]:t>0&&n.start===s.inputValue().length&&(h=p[s.caretPos]),h!==void 0&&l.push(h)}if(!s.shouldDelete(l,e))return!1;for(ae(e,!0),typeof r<"u"&&s.setCaret(r);l.length;)s.removeItem(l.pop());return s.inputState(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(r=>r.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,r,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(et(Ft,t)||et("shiftKey",t)?(n=o.getLastActive(e),n?n.classList.contains("active")?r=o.getAdjacent(n,e,"item"):r=n:e>0?r=o.control_input.nextElementSibling:r=o.control_input.previousElementSibling,r&&(r.classList.contains("active")&&o.removeActiveItem(n),o.setActiveItemClass(r))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return si(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,ze(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,r;const o=this;if(typeof this.settings.render[e]!="function"||(r=o.settings.render[e].call(this,t,Gt),!r))return null;if(r=pe(r),e==="option"||e==="option_create"?t[o.settings.disabledField]?de(r,{"aria-disabled":"true"}):de(r,{"data-selectable":""}):e==="optgroup"&&(n=t.group[o.settings.optgroupValueField],de(r,{"data-group":n}),t.group[o.settings.disabledField]&&de(r,{"data-disabled":""})),e==="option"||e==="item"){const s=zt(t[o.settings.valueField]);de(r,{"data-value":s}),e==="item"?(me(r,o.settings.itemClass),de(r,{"data-ts-item":""})):(me(r,o.settings.optionClass),de(r,{role:"option",id:t.$id}),t.$div=r,o.options[s]=t)}return r}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){ge(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var r=this,o=r[t];r[t]=function(){var s,l;return e==="after"&&(s=o.apply(r,arguments)),l=n.apply(r,arguments),e==="instead"?l:(e==="before"&&(s=o.apply(r,arguments)),s)}}}function Zr(){re(this.input,"change",()=>{this.sync()})}function es(i){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},i);var r=function(l,p){p?(l.checked=!0,n.uncheckedClassNames&&l.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&l.classList.add(...n.checkedClassNames)):(l.checked=!1,n.checkedClassNames&&l.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&l.classList.add(...n.uncheckedClassNames))},o=function(l){setTimeout(()=>{var p=l.querySelector("input."+n.className);p instanceof HTMLInputElement&&r(p,l.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var s=e.settings.render.option;e.settings.render.option=(l,p)=>{var h=pe(s.call(e,l,p)),E=document.createElement("input");n.className&&E.classList.add(n.className),E.addEventListener("click",function(N){ae(N)}),E.type="checkbox";const _=De(l[e.settings.valueField]);return r(E,!!(_&&e.items.indexOf(_)>-1)),h.prepend(E),h}}),e.on("item_remove",s=>{var l=e.getOption(s);l&&(l.classList.remove("selected"),o(l))}),e.on("item_add",s=>{var l=e.getOption(s);l&&o(l)}),e.hook("instead","onOptionSelect",(s,l)=>{if(l.classList.contains("selected")){l.classList.remove("selected"),e.removeItem(l.dataset.value),e.refreshOptions(),ae(s,!0);return}t.call(e,s,l),o(l)})}function ts(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=pe(t.html(t));n.addEventListener("click",r=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),r.preventDefault(),r.stopPropagation())}),e.control.appendChild(n)})}const ns=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i.nextSibling)},is=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i)},as=(i,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,i==e)return!0}while(e&&e.previousElementSibling);return!1};function rs(){var i=this;if(i.settings.mode!=="multi")return;var e=i.lock,t=i.unlock;let n=!0,r;i.hook("after","setupTemplates",()=>{var o=i.settings.render.item;i.settings.render.item=(s,l)=>{const p=pe(o.call(i,s,l));de(p,{draggable:"true"});const h=X=>{n||ae(X),X.stopPropagation()},E=X=>{r=p,setTimeout(()=>{p.classList.add("ts-dragging")},0)},_=X=>{X.preventDefault(),p.classList.add("ts-drag-over"),D(p,r)},N=()=>{p.classList.remove("ts-drag-over")},D=(X,H)=>{H!==void 0&&(as(H,p)?ns(X,H):is(X,H))},O=()=>{var X;document.querySelectorAll(".ts-drag-over").forEach(V=>V.classList.remove("ts-drag-over")),(X=r)==null||X.classList.remove("ts-dragging"),r=void 0;var H=[];i.control.querySelectorAll("[data-value]").forEach(V=>{if(V.dataset.value){let M=V.dataset.value;M&&H.push(M)}}),i.setValue(H)};return re(p,"mousedown",h),re(p,"dragstart",E),re(p,"dragenter",_),re(p,"dragover",_),re(p,"dragleave",N),re(p,"dragend",O),p}}),i.hook("instead","lock",()=>(n=!1,e.call(i))),i.hook("instead","unlock",()=>(n=!0,t.call(i)))}function ss(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=pe(t.html(t)),r=n.querySelector("."+t.closeClass);r&&r.addEventListener("click",o=>{ae(o,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function os(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=Jt(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),ze(t,"last-active")}else i.setCaret(i.caretPos+e)})}function ds(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,me(i.control_input,"dropdown-input");const e=pe('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=pe('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case ta:i.isOpen&&(ae(t,!0),i.close()),i.clearActiveItems();return;case Ln:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),re(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function ls(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of n)e.style[o]=t.style[o];var r=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};r(),i.on("update item_add item_remove",r),re(t,"input",r),re(t,"keyup",r),re(t,"blur",r),re(t,"update",r)})}function us(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function cs(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function fs(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,r,o,s;if(!i.isOpen||!(t.keyCode===Dn||t.keyCode===na))return e.call(i,t);i.ignoreHover=!0,s=jt(i.activeOption,"[data-group]"),n=Jt(i.activeOption,"[data-selectable]"),s&&(t.keyCode===Dn?s=s.previousSibling:s=s.nextSibling,s&&(o=s.querySelectorAll("[data-selectable]"),r=o[Math.min(o.length-1,n)],r&&i.setActiveOption(r)))})}function ps(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Gt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var r=t.settings.render.item;t.settings.render.item=(o,s)=>{var l=pe(r.call(t,o,s)),p=pe(n);return l.appendChild(p),re(p,"mousedown",h=>{ae(h,!0)}),re(p,"click",h=>{t.isLocked||(ae(h,!0),!t.isLocked&&t.shouldDelete([l],h)&&(t.removeItem(l),t.refreshOptions(!1),t.inputState()))}),l}})}}function hs(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var r=e.options[n];r&&e.setTextboxValue(t.text.call(e,r))}})}function ms(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var r={},o,s=!1,l,p=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(i.activeOption){var N=i.selectable(),D=Array.from(N).indexOf(i.activeOption);if(D>=N.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const h=_=>typeof i.settings.maxOptions=="number"&&o.children.length>=i.settings.maxOptions?!1:!!(_ in r&&r[_]),E=(_,N)=>i.items.indexOf(N)>=0||p.indexOf(N)>=0;i.setNextUrl=(_,N)=>{r[_]=N},i.getUrl=_=>{if(_ in r){const N=r[_];return r[_]=!1,N}return i.clearPagination(),i.settings.firstUrl.call(i,_)},i.clearPagination=()=>{r={}},i.hook("instead","clearActiveOption",()=>{if(!s)return t.call(i)}),i.hook("instead","canLoad",_=>_ in r?h(_):e.call(i,_)),i.hook("instead","loadCallback",(_,N)=>{if(!s)i.clearOptions(E);else if(l){const D=_[0];D!==void 0&&(l.dataset.value=D[i.settings.valueField])}n.call(i,_,N),s=!1}),i.hook("after","refreshOptions",()=>{const _=i.lastValue;var N;h(_)?(N=i.render("loading_more",{query:_}),N&&(N.setAttribute("data-selectable",""),l=N)):_ in r&&!o.querySelector(".no-results")&&(N=i.render("no_more_results",{query:_})),N&&(me(N,i.settings.optionClass),o.append(N))}),i.on("initialize",()=>{p=Object.keys(i.options),o=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),o.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&h(i.lastValue)&&(s||(s=!0,i.load.call(i,i.lastValue)))})})}ve.define("change_listener",Zr);ve.define("checkbox_options",es);ve.define("clear_button",ts);ve.define("drag_drop",rs);ve.define("dropdown_header",ss);ve.define("caret_position",os);ve.define("dropdown_input",ds);ve.define("input_autogrow",ls);ve.define("no_backspace_delete",us);ve.define("no_active_items",cs);ve.define("optgroup_columns",fs);ve.define("remove_button",ps);ve.define("restore_on_backspace",hs);ve.define("virtual_scroll",ms);class gs{spectresToCreate=[];spectresToDelete=[];spectresToUpdate=[];constructor(){}async Initialize(){const e=b.sceneItems.filter(t=>t.metadata[`${d.SPECTREID}/isSpectre`]===!0);for(const t of e)await this.SetupGhostSelect(t)}async Run(){const t=b.sceneItems.filter(n=>n.metadata[`${d.SPECTREID}/isSpectre`]===!0).filter(n=>n.metadata[`${d.SPECTREID}/spectreViewers`].includes(b.playerId));if(t.length>0){for(const r of t){const o=b.sceneLocal.find(s=>s.metadata[`${d.SPECTREID}/isLocalSpectre`]===r.id);if(!o)this.CreateSpectreToQueue(r);else{const s=r.position.x===o.position.x&&r.position.y===o.position.y,l=r.scale.x===o.scale.x&&r.scale.y===o.scale.y,p=r.rotation===o.rotation,h=r.layer===o.layer;(!p||!l||!h||!s)&&this.UpdateSpectreToQueue(r,o)}}const n=b.sceneLocal.filter(r=>lr(r));for(const r of n)t.find(s=>s.id===r.metadata[`${d.SPECTREID}/isLocalSpectre`])||this.spectresToDelete.push(r.id);this.spectresToCreate.length>0&&await T.scene.local.addItems(this.spectresToCreate),this.spectresToDelete.length>0&&await T.scene.local.deleteItems(this.spectresToDelete),this.spectresToUpdate.length>0&&await T.scene.local.updateItems(n.filter(r=>!this.spectresToDelete.includes(r.id)),r=>{for(let o of r){const s=this.spectresToUpdate.find(l=>l.id===o.id);s&&(o.layer=s.layer,o.scale=s.scale,o.rotation=s.rotation,o.position=s.position)}}),this.spectresToCreate=[],this.spectresToUpdate=[],this.spectresToDelete=[]}else{const n=b.sceneLocal.filter(r=>r.metadata[`${d.SPECTREID}/isLocalSpectre`]!==void 0);n.length>0&&await T.scene.local.deleteItems(n.map(r=>r.id))}}CreateSpectreToQueue(e){const t=qt({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).position(e.position).attachedTo(e.id).layer(e.layer).metadata({[`${d.SPECTREID}/isLocalSpectre`]:e.id}).disableHit(!1).build();b.playerRole==="GM"&&(t.attachedTo=e.id,t.disableHit=!0),this.spectresToCreate.push(t)}UpdateSpectreToQueue(e,t){const n={id:t.id,position:e.position,rotation:e.rotation,scale:e.scale,layer:e.layer};this.spectresToUpdate.push(n)}async HandleLocalMovement(e){const t=e.filter(n=>n.metadata[`${d.SPECTREID}/isLocalSpectre`]!==void 0);if(t.length>0){const n=[];for(const r of t){const o=b.sceneLocal.find(h=>h.id===r.id);if(!o)continue;const s=r.position.x===o.position.x&&r.position.y===o.position.y,l=r.scale.x===o.scale.x&&r.scale.y===o.scale.y,p=r.rotation===o.rotation;if(!s||!l||!p){const h=b.sceneItems.find(E=>E.id===o.metadata[`${d.SPECTREID}/isLocalSpectre`]);if(h){const E={id:h.id,position:o.position,scale:o.scale,rotation:o.rotation};n.push(E)}}}n.length>0&&await T.scene.items.updateItems(n.map(r=>r.id),r=>{for(let o of r){const s=n.find(l=>l.id===o.id);s&&(o.position=s.position,o.scale=s.scale,o.rotation=s.rotation)}})}}async SetupGhostSelect(e){const t=e.text?.plainText||e.name,n=document.getElementById("ghostList"),r=document.createElement("tr");r.id=`tr-${e.id}`,r.className="ghost-table-entry",r.innerHTML=`<td class="token-name">${t}</td>
            <td><select id="select-${e.id}" class="tSelects" multiple autocomplete="off" /></td>
            <td><input type="button" class="mysteryButton" id="deleteGhost-${e.id}" value="Delete"/></td>`,n.appendChild(r);const o=document.getElementById(`select-${e.id}`);for(const E of b.party){const _=document.createElement("option");_.value=E.id,_.text=E.name,o.appendChild(_)}const s={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:b.party.length==0?"No Players Present":"Choose..",maxItems:null,create:!1,onDelete:async function(E,_){const N=_.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await T.scene.items.updateItems([N],D=>{const O=D[0].metadata[`${d.SPECTREID}/spectreViewers`],X=O.findIndex(H=>H==E);O.splice(X,1),D[0].metadata[`${d.SPECTREID}/spectreViewers`]=O})},onItemAdd:async function(E,_){const N=_.parentElement.parentElement.parentElement.parentElement.id.slice(3);await T.scene.items.updateItems([N],D=>{const O=D[0].metadata[`${d.SPECTREID}/spectreViewers`];O.push(E),D[0].metadata[`${d.SPECTREID}/spectreViewers`]=O})}},l=e.metadata[`${d.SPECTREID}/spectreViewers`],p=new ve(`#select-${e.id}`,s);if(l.length>1)for(const E of l){if(!b.party.find(N=>N.id===E)){const N=b.sceneMetadata[`${d.EXTENSIONID}/USER-${E}`],D=[];D.push({value:E,text:N.name}),p.addOption(D)}p.addItem(E,!0)}const h=document.getElementById(`deleteGhost-${e.id}`);h.onclick=async()=>{const E=b.sceneLocal.findIndex(_=>_.id===e.id);b.sceneLocal.splice(E,1),r.remove(),await T.scene.items.deleteItems([e.id])}}}const Ot=new gs;class Y{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENELOCAL="SCENELOCAL";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static SCENEFOG="SCENEFOG";static ROOMMETA="ROOMMETADATA";playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;fogFilled;fogColor;fogStroke;gridDpi;gridScale;gridSnap;gridType;storedMetaItems;sceneItems;sceneLocal;sceneSelected;sceneMetadata;sceneReady;roomMetadata;theme;caches;snap;torchActive;busy;USER_REGISTERED;toolStarted;sceneMetadataHandler;sceneItemsHandler;sceneLocalHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;fogHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.fogFilled=!1,this.fogColor="#000",this.fogStroke=5,this.storedMetaItems=[],this.sceneItems=[],this.sceneLocal=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.gridSnap=10,this.gridType="ft",this.sceneReady=!1,this.theme="DARK",this.roomMetadata={},this.snap=!1,this.busy=!1,this.torchActive=!1,this.toolStarted=!1,this.USER_REGISTERED=!1,this.caches=e}async RefreshCache(){if(this.caches.includes(Y.PLAYER)&&(this.playerId=await T.player.getId(),this.playerName=await T.player.getName(),this.playerColor=await T.player.getColor(),this.playerMetadata=await T.player.getMetadata(),this.playerRole=await T.player.getRole()),this.caches.includes(Y.PARTY)&&(this.party=await T.party.getPlayers()),this.caches.includes(Y.SCENEFOG)&&this.sceneReady&&(this.fogColor=await T.scene.fog.getColor(),this.fogFilled=await T.scene.fog.getFilled()),this.caches.includes(Y.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await T.scene.items.getItems(),this.sceneLocal=await T.scene.local.getItems()),this.caches.includes(Y.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await T.scene.getMetadata();const e=this.sceneMetadata[`${d.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e)}if(this.caches.includes(Y.SCENEGRID)&&this.sceneReady){this.gridDpi=await T.scene.grid.getDpi();const e=await T.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(Y.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await T.room.getMetadata()),await this.CheckRegistration()}async InitializeCache(){if(this.sceneReady=await T.scene.isReady(),this.theme=await T.theme.getTheme(),Jn(this.theme,document),this.caches.includes(Y.PLAYER)&&(this.playerId=await T.player.getId(),this.playerName=await T.player.getName(),this.playerColor=await T.player.getColor(),this.playerMetadata=await T.player.getMetadata(),this.playerRole=await T.player.getRole()),this.caches.includes(Y.PARTY)&&(this.party=await T.party.getPlayers()),this.caches.includes(Y.SCENEFOG)&&this.sceneReady&&(this.fogColor=await T.scene.fog.getColor(),this.fogFilled=await T.scene.fog.getFilled()),this.caches.includes(Y.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await T.scene.items.getItems(),this.sceneLocal=await T.scene.local.getItems()),this.caches.includes(Y.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await T.scene.getMetadata();const e=this.sceneMetadata[`${d.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e)}if(this.caches.includes(Y.SCENEGRID)&&this.sceneReady){this.gridDpi=await T.scene.grid.getDpi();const e=await T.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(Y.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await T.room.getMetadata()),T.broadcast.onMessage(`${d.EXTENSIONID}/ELEVATIONEVENT`,e=>{switch(e.data){case"CANCEL":Pn();break;case"FINISH":Ui();break;case"UNDO":ji();break}}),T.broadcast.onMessage(`${d.EXTENSIONID}/LINEEVENT`,e=>{switch(e.data){case"CANCEL":_n();break;case"FINISH":Nn();break;case"UNDO":xi();break}}),T.broadcast.onMessage(`${d.EXTENSIONID}/POLYGONEVENT`,e=>{switch(e.data){case"CANCEL":Sn();break;case"FINISH":On();break;case"UNDO":Vi();break}}),T.broadcast.onMessage(d.RESETPERSISTID,async e=>{await Ne.ClearPersistence()}),await this.SaveUserToScene()}async SaveUserToScene(){await T.scene.setMetadata({[`${d.EXTENSIONID}/USER-${this.playerId}`]:{role:this.playerRole,name:this.playerName,color:this.playerColor}})}KillHandlers(){this.caches.includes(Y.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(Y.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(Y.SCENEITEMS)&&this.sceneLocalHandler!==void 0&&this.sceneLocalHandler(),this.caches.includes(Y.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(Y.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(Y.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(Y.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.caches.includes(Y.SCENEFOG)&&this.fogHandler!==void 0&&this.fogHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(Y.SCENEMETA)&&(this.sceneMetadataHandler=T.scene.onMetadataChange(async e=>{this.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]===!0&&e[`${d.EXTENSIONID}/playerDoors`]===!1&&Ne.ClearDoors(),this.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&e[`${d.EXTENSIONID}/persistence`]===!1&&Ne.ClearPersistence(),this.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!1&&e[`${d.EXTENSIONID}/toggleOwnerLines`]===!0?Ne.InitiateOwnerHighlight():this.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0&&e[`${d.EXTENSIONID}/toggleOwnerLines`]===!1&&Ne.ClearOwnershipHighlights();const t=e[`${d.EXTENSIONID}/disableVision`];t!==void 0&&(this.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0&&e[`${d.EXTENSIONID}/disableVision`]===!1||this.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!1&&e[`${d.EXTENSIONID}/disableVision`]===!0)&&Ne.TogglePersistentLightVisibility(t),this.sceneMetadata=e,await this.OnSceneMetadataChanges(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(Y.SCENEITEMS)&&(this.sceneItemsHandler=T.scene.items.onChange(async e=>{this.sceneItems=e,await this.OnSceneItemsChange(e)}),this.sceneLocalHandler=T.scene.local.onChange(async e=>{const t=[...this.sceneLocal];this.sceneLocal=e,await this.OnSceneLocalChange(t)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(Y.SCENEGRID)&&(this.sceneGridHandler=T.scene.grid.onChange(async e=>{await this.OnSceneGridChange(e),this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(Y.PLAYER)&&(this.playerHandler=T.player.onChange(async e=>{const t=this.playerRole;let n=!1;(this.playerName!==e.name||this.playerColor!==e.color||this.playerRole!==e.role)&&(n=!0),this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e,t),n&&await this.SaveUserToScene()})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(Y.PARTY)&&(this.partyHandler=T.party.onChange(async e=>{this.party=e.filter(t=>t.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(Y.ROOMMETA)&&(this.roomHandler=T.room.onMetadataChange(async e=>{await this.OnRoomMetadataChange(e),this.roomMetadata=e})),(this.fogHandler===void 0||this.fogHandler.length===0)&&this.caches.includes(Y.SCENEFOG)&&(this.fogHandler=T.scene.fog.onChange(async e=>{await this.OnFogChange(e),this.fogColor=e.style.color,this.fogFilled=e.filled})),this.themeHandler===void 0&&(this.themeHandler=T.theme.onChange(async e=>{this.theme=e.mode,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=T.scene.onReadyChange(async e=>{this.sceneReady=e,await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){this.playerRole,await J.OnDataChange()}async OnSceneItemsChange(e){await J.OnDataChange()}async OnSceneLocalChange(e){await Ot.HandleLocalMovement(e)}async OnSceneGridChange(e){await J.OnDataChange()}async OnSceneReadyChange(e){e?(await this.SaveUserToScene(),await this.RefreshCache(),await Ne.Reset(),await J.Start(),this.SetupHandlers()):(this.KillHandlers(),await J.Stop(),this.sceneItems=[],this.sceneMetadata={},this.playerRole==="GM"&&(this.toolStarted=!1),await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!1}))}async OnPlayerChange(e,t){if(this.playerRole!==t&&(await J.Stop(),await Ne.Reset(),await J.Start()),e.role==="GM"){const n=document.querySelectorAll(".token-table-entry");for(let h of n){let E=h.id.substring(3);e.selection!==void 0&&e.selection.includes(E)?h.classList.add("token-table-selected"):h.classList.remove("token-table-selected")}const r=e.metadata;(r[`${d.EXTENSIONID}/finishLine`]??!1)===!0&&Nn(),(r[`${d.EXTENSIONID}/cancelLine`]??!1)===!0&&_n(),(r[`${d.EXTENSIONID}/finishPoly`]??!1)===!0&&On(),(r[`${d.EXTENSIONID}/cancelPoly`]??!1)===!0&&Sn()}e.selection!==void 0&&e.selection.length===1&&Ne.ToggleDoor(e.selection[0])}async OnPartyChange(e){if(this.playerRole!=="PLAYER"){const t=document.getElementById("playerListing");t.innerHTML="",t.appendChild(J.GetEmptyContextItem("Self"));const n=document.getElementById("preview_select");n.innerHTML="";const r=document.createElement("option");r.value=b.playerId,r.textContent="View As: Self",n.appendChild(r);for(const o of this.party){const s=document.createElement("li");s.id=o.id,s.textContent=o.name,s.style.color=o.color,t.appendChild(s);const l=document.createElement("option");l.value=o.id,l.textContent=`View As: ${o.name}`,l.style.color=o.color,n.appendChild(l)}}}async OnFogChange(e){const t=document.getElementById("toggle_fogfill");t&&(t.checked=e.filled)}async OnRoomMetadataChange(e){}async OnThemeChange(e){Jn(e,document)}async ToggleBusy(e){const t=document.getElementById("preview_select");if(t.value!==b.playerId&&!e){const n=b.party.find(r=>r.id===t.value);n&&await T.action.setBadgeText(`Viewing as: ${n.name}`)}else await T.action.setBadgeText(e?"⏱️":void 0),b.busy=e}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",t={owlbearid:b.playerId},n={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:d.ANONAUTH,"x-manuel":e}),body:JSON.stringify(t)},r=await fetch(d.CHECKREGISTRATION,n);if(!r.ok){const s=await r.json();console.error("Error:",s);return}(await r.json()).Data==="OK"?(this.USER_REGISTERED=!0,console.log("Connected")):console.log("Not Registered")}catch(e){console.error("Error:",e)}}}const b=new Y([Y.SCENEITEMS,Y.SCENEMETA,Y.SCENEFOG,Y.SCENEGRID,Y.PLAYER,Y.PARTY]);async function vs(){await T.contextMenu.create({id:`${d.EXTENSIONID}/convert-curve`,icons:[{icon:"/opendoor.svg",label:"Convert to Obstruction",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${d.EXTENSIONID}/elevation`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:void 0}],roles:["GM"]}}],async onClick(i){const e="#000000",n=[],r=[],o=[];for(const s of i.items){if(s.type==="CURVE"){const l=s;if(l.points.length>2){const p=Se().tension(0).points(mn(l.points,l.position)).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??n).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();l.style.closed&&p.points.push(l.points[0]),r.push(p),o.push(l.id)}}else if(s.type==="LINE"){const l=s,p=Se().tension(0).points(mn([l.startPosition,l.endPosition],l.position)).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??n).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();r.push(p),o.push(l.id)}else if(s.type==="SHAPE"){const l=s,p=[];if(l.shapeType==="CIRCLE"){const h=Math.min(l.width,l.height)/2,E=2*Math.PI/20;for(let _=0;_<20;_++){const N=_*E,D=h*Math.cos(N),O=h*Math.sin(N);p.push({x:D,y:O})}}else if(l.shapeType==="RECTANGLE"){const _=0+l.width,N=0+l.height;p.push({x:0,y:0}),p.push({x:_,y:0}),p.push({x:_,y:N}),p.push({x:0,y:N})}else if(l.shapeType==="HEXAGON"){const h=l.width/2,E=[Math.PI/2,Math.PI/6,11*Math.PI/6,3*Math.PI/2,7*Math.PI/6,5*Math.PI/6];for(let _=0;_<6;_++){const N=E[_],D=h*Math.cos(N),O=h*Math.sin(N);p.push({x:D,y:O})}}else l.shapeType==="TRIANGLE"&&(p.push({x:0,y:0}),p.push({x:0-l.width/2,y:0+l.height}),p.push({x:0+l.width/2,y:0+l.height}));if(p.length>0){const h=Se().tension(0).points(mn(p,{x:1,y:1})).position(l.position).rotation(l.rotation).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??n).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??8).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();h.points.push(p[0]),r.push(h),o.push(l.id)}}r.length>0&&(await T.scene.items.addItems(r),await T.scene.items.deleteItems(o))}}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.EXTENSIONID}/hasVision`]===void 0);await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/hasVision`]=!0,n.metadata[`${d.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${d.EXTENSIONID}/visionRange`]=d.ATTENUATIONDEFAULT,n.metadata[`${d.EXTENSIONID}/visionSourceRange`]=d.SOURCEDEFAULT,n.metadata[`${d.EXTENSIONID}/visionFallOff`]=d.FALLOFFDEFAULT,n.metadata[`${d.EXTENSIONID}/visionInAngle`]=d.INANGLEDEFAULT,n.metadata[`${d.EXTENSIONID}/visionOutAngle`]=d.OUTANGLEDEFAULT)):delete n.metadata[`${d.EXTENSIONID}/hasVision`]})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(i){await T.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/disabled`]?delete t.metadata[`${d.EXTENSIONID}/disabled`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/disabled`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Swap to Double-sided",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"Swap to One-sided",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:!0}]}}],async onClick(i){await T.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/doubleSided`]?delete t.metadata[`${d.EXTENSIONID}/doubleSided`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/doubleSided`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-obstructing-side`,icons:[{icon:"/flip.svg",label:"Swap Obstructing Side",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:"type",value:"CURVE",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:void 0}]}}],async onClick(i){await T.scene.items.updateItems(i.items,e=>{for(const t of e){const n=t.points.reverse();t.points=n}})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-blockage`,icons:[{icon:"/blocked.svg",label:"Swap to Unpassable",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/blocking`],value:void 0}]}},{icon:"/unblock.svg",label:"Swap to Passable",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/blocking`],value:!0}]}}],async onClick(i){await T.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/blocking`]?delete t.metadata[`${d.EXTENSIONID}/blocking`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/blocking`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"},{key:["metadata",`${d.EXTENSIONID}/isFogMap`],value:void 0}]}},{icon:"/fog-background.svg",label:"Convert To Normal Background",filter:{every:[{key:"layer",value:"FOG"},{key:["metadata",`${d.EXTENSIONID}/isFogMap`],value:!0}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.EXTENSIONID}/isFogMap`]===void 0);await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.layer="FOG",n.zIndex=-1,n.metadata[`${d.EXTENSIONID}/isFogMap`]=!0):(n.layer="MAP",n.zIndex=-1,delete n.metadata[`${d.EXTENSIONID}/isFogMap`])})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/create-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/grid`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/grid`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.EXTENSIONID}/isDoor`]===void 0);await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/isDoor`]=!0,n.style.strokeColor=d.DOORCOLOR):(delete n.metadata[`${d.EXTENSIONID}/isDoor`],n.style.strokeColor=b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/open-door`,icons:[{icon:"/opendoor.svg",label:"Open Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}},{icon:"/closedoor.svg",label:"Close Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}}],async onClick(i){await T.scene.items.updateItems(i.items,e=>{for(let t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/disabled`]?(delete t.metadata[`${d.EXTENSIONID}/disabled`],delete t.metadata[`${d.EXTENSIONID}/doorOpen`]):t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/disabled`]=!0,t.metadata[`${d.EXTENSIONID}/doorOpen`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-door-lock`,icons:[{icon:"/locked-door.svg",label:"Lock Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/unlocked-door.svg",label:"Unlock Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.EXTENSIONID}/isDoorLocked`]===void 0);await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${d.EXTENSIONID}/isDoorLocked`]=!0:delete n.metadata[`${d.EXTENSIONID}/isDoorLocked`]})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-torch`,icons:[{icon:"/light.svg",label:"Enable Torchlight",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isTorch`],operator:"==",value:void 0},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0},{key:"layer",value:"PROP"}]}},{icon:"/no-light.svg",label:"Disable Torchlight",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isTorch`],operator:"==",value:!0},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0},{key:"layer",value:"PROP"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.EXTENSIONID}/isTorch`]===void 0);await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/isTorch`]=!0,n.metadata[`${d.EXTENSIONID}/hasVision`]=!0):(delete n.metadata[`${d.EXTENSIONID}/isTorch`],delete n.metadata[`${d.EXTENSIONID}/hasVision`])})}}),await T.contextMenu.create({id:`${d.SPECTREID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${d.SPECTREID}/isSpectre`],value:void 0,operator:"==",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${d.SPECTREID}/isSpectre`],value:void 0,operator:"!=",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${d.SPECTREID}/isSpectre`]===!0);if(await T.scene.items.updateItems(i.items,t=>{for(const n of t)e?(delete n.metadata[`${d.SPECTREID}/isSpectre`],delete n.metadata[`${d.SPECTREID}/spectreViewers`],n.visible=!0):(n.metadata[`${d.SPECTREID}/isSpectre`]=!0,n.metadata[`${d.SPECTREID}/spectreViewers`]=[b.playerId],n.visible=!1)}),!e)for(const t of i.items)await Ot.SetupGhostSelect(t)}})}function mn(i,e){return i.map(t=>({x:t.x+e.x,y:t.y+e.y}))}var ia={exports:{}};(function(i){(function(){function e(l,p){var h=l.x-p.x,E=l.y-p.y;return h*h+E*E}function t(l,p,h){var E=p.x,_=p.y,N=h.x-E,D=h.y-_;if(N!==0||D!==0){var O=((l.x-E)*N+(l.y-_)*D)/(N*N+D*D);O>1?(E=h.x,_=h.y):O>0&&(E+=N*O,_+=D*O)}return N=l.x-E,D=l.y-_,N*N+D*D}function n(l,p){for(var h=l[0],E=[h],_,N=1,D=l.length;N<D;N++)_=l[N],e(_,h)>p&&(E.push(_),h=_);return h!==_&&E.push(_),E}function r(l,p,h,E,_){for(var N=E,D,O=p+1;O<h;O++){var X=t(l[O],l[p],l[h]);X>N&&(D=O,N=X)}N>E&&(D-p>1&&r(l,p,D,E,_),_.push(l[D]),h-D>1&&r(l,D,h,E,_))}function o(l,p){var h=l.length-1,E=[l[0]];return r(l,0,h,p,E),E.push(l[h]),E}function s(l,p,h){if(l.length<=2)return l;var E=p!==void 0?p*p:1;return l=h?l:n(l,E),l=o(l,E),l}i.exports=s,i.exports.default=s})()})(ia);var ys=ia.exports;const Es=Va(ys);function pi(){const i=document.getElementById("map_align");if(!i)return;const e=b.sceneItems.filter(r=>r.layer==="MAP"),t={};for(let r=0;r<e.length;r++){let o=i.querySelector("#map-"+e[r].id);o===null&&(o=document.createElement("option"),o.id="map-"+e[r].id,o.value=e[r].id,o.innerText=e[r].name,i.appendChild(o)),t[e[r].id]=e[r].name}let n=i.querySelectorAll("option");for(let r=0;r<n.length;r++)t[n[r].value]===void 0&&i.removeChild(n[r])}async function ws(i,e,t,n,r){if(r.innerText="",Number.isNaN(t)||t<0){r.innerText="Invalid DPI";return}let o=b.gridDpi/t,s,l=[];if(l[0]=0,l[1]=0,n!==""){let p=await T.scene.items.getItems([n]);if(p.length>0)s=p[0],t===0&&(t=s.grid.dpi),o=b.gridDpi/t,l[0]=s.position.x-s.grid.offset.x*o,l[1]=s.position.y-s.grid.offset.y*o;else{r.innerText="Unable to find map";return}}else{r.innerText="No map selected";return}i==="foundry"?_s(e,o,l,r):i==="uvtt"&&Ts(e,o,l,r)}function hi(i){const e=[];for(const t of i){const n=[];for(const o of t)n.push({x:o.x*b.gridDpi,y:o.y*b.gridDpi});const r=Se().tension(0).points(n).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0}).build();e.push(r)}return e}function Is(i){const e=[];for(const t of i){const n=[];for(const o of t.bounds)n.push({x:o.x*b.gridDpi,y:o.y*b.gridDpi});const r=Se().tension(0).points(n).strokeColor(d.DOORCOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Door)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/isDoor`]:!0}).build();e.push(r)}return e}async function bs(i,e){let t=[];i.objects_line_of_sight?.length>0&&(t=t.concat(hi(i.objects_line_of_sight))),i.line_of_sight?.length>0&&(t=t.concat(hi(i.line_of_sight))),i.portals?.length>0&&(t=t.concat(Is(i.portals)));try{if(i.lights?.length>0){const p=[];for(const h of i.lights){const E=qt({height:150,width:150,url:"https://upload.wikimedia.org/wikipedia/commons/5/59/Empty.png",mime:"image/png"},{dpi:300,offset:{x:150,y:150}}).position({x:h.position.x*b.gridDpi,y:h.position.y*b.gridDpi}).layer("PROP").metadata({[`${d.EXTENSIONID}/hasVision`]:!0,[`${d.EXTENSIONID}/isTorch`]:!0,[`${d.EXTENSIONID}/hiddenToken`]:!0,[`${d.EXTENSIONID}/visionRange`]:h.range.toString()}).name("Imported Light Source").build();p.push(E)}t=t.concat(p)}const n=atob(i.image),r=new Uint8Array(n.length);for(let p=0;p<n.length;p++)r[p]=n.charCodeAt(p);const o=new Blob([r],{type:"image/png"}),s=Ma(o).grid({dpi:i.resolution.pixels_per_grid,offset:{x:0,y:0}}).build(),l=Pa().baseMap(s).name("New UVTT Scene").items(t).build();await T.assets.uploadScenes([l],!0)}catch(n){await T.notification.show("There was an error: "+n,"ERROR")}}async function aa(i,e,t,n,r){let o=0,s=0,l=0;const p=[];for(let h=0;h<i.length;h++){let E=[],_=!1;for(let N=0;N<i[h].length-1;N++){let D=i[h][N].x*e,O=i[h][N].y*e,X=i[h][N+1].x*e,H=i[h][N+1].y*e;E.push({x:D*t+n[0],y:O*t+n[1]}),E.push({x:X*t+n[0],y:H*t+n[1]}),s++,!_&&i[h][N].door&&(_=!0)}E.length>128&&(E.length,E=Es(E,8,!1));for(let N=0;N<E.length;N+=256){const D=E.slice(N>0?N-1:0,N+256),O=Se().tension(0).points(D).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Import)").closed(!1).locked(!0).build();O.visible=!1,O.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,_&&(O.metadata[`${d.EXTENSIONID}/isDoor`]=!0),p.push(O),l+=D.length,(l>512||p.length>64)&&(o+=p.length,await T.scene.items.addItems(p),p.length=0,l=0)}}p.length>0&&(o+=p.length,await T.scene.items.addItems(p)),r.innerText="Finished importing "+o+" walls, "+s+" points."}function Ts(i,e,t,n){if(i.resolution.map_origin!==void 0&&(t[0]-=i.resolution.map_origin.x*i.resolution.pixels_per_grid,t[1]-=i.resolution.map_origin.y*i.resolution.pixels_per_grid),i.portals&&i.portals.length)for(let o=0;o<i.portals.length;o++){let s=i.portals[o].bounds;s[0].door=!0,s[1].door=!0,i.line_of_sight.push(s)}const r=i.line_of_sight.concat(i.objects_line_of_sight);aa(r,i.resolution.pixels_per_grid,e,t,n)}function _s(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const r=[];for(var o=0;o<i.walls.length;o++)r.push([{x:i.walls[o].c[0],y:i.walls[o].c[1],door:!!i.walls[o].door},{x:i.walls[o].c[2],y:i.walls[o].c[3],door:!!i.walls[o].door}]);aa(r,1,e,t,n)}function Ns(){const i=document.getElementById("hideListToggle");J.hiddenList=document.getElementById("hidden_list"),J.tokenList=document.getElementById("token_list"),i.onclick=async()=>{J.hiddenList.style.display==="none"?(J.hiddenList&&(J.hiddenList.style.display="table-row-group"),i&&(i.value="Out-of-Sight List: Click to Hide")):(J.hiddenList&&(J.hiddenList.style.display="none"),i&&(i.value="Out-of-Sight List: Click to Show"))};const e=document.getElementById("snap_checkbox");b.snap=!0,e.checked=!0,e.onclick=async m=>{if(!b.sceneReady){m.preventDefault();return}const L=m.target;b.snap=L.checked};const t=document.getElementById("disable_vision");t.checked=b.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0,t.onclick=async m=>{{if(!m||!m.target)return;const L=m.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/disableVision`]:L.checked})}};const n=document.getElementById("toggle_fogfill");n.checked=b.fogFilled,n.onclick=async m=>{if(!m||!m.target)return;const L=m.target;await T.scene.fog.setFilled(L.checked)};const r=document.getElementById("toggle_persistence");r.checked=b.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0,r.onclick=async m=>{if(!m||!m.target)return;const L=m.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/persistence`]:L.checked})};const o=document.getElementById("reset_persistence");o.onclick=async m=>{!m||!m.target||await T.broadcast.sendMessage(d.RESETPERSISTID,!0,{destination:"ALL"})};const s=document.getElementById("toggle_ownerlines");s.checked=b.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0,s.onclick=async m=>{if(!m||!m.target)return;const L=m.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/toggleOwnerLines`]:L.checked})};const l=document.getElementById("door_checkbox");l.checked=b.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]===!0,l.onclick=async m=>{if(!m||!m.target)return;const L=m.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/playerDoors`]:L.checked})};const p=document.getElementById("lock_button"),h=document.getElementById("unlock_button");h.onclick=async m=>{if(!m||!m.target)return;const L=b.sceneItems.filter(k=>Nt(k));await b.ToggleBusy(!0);for(let k=0;k<L.length;k+=64){const C=L.slice(k,k+64);await T.scene.items.updateItems(C,A=>{for(let w of A)w.locked=!1})}b.ToggleBusy(!1)},p.onclick=async m=>{if(!m||!m.target)return;const L=b.sceneItems.filter(k=>Nt(k));await b.ToggleBusy(!0);for(let k=0;k<L.length;k+=64){const C=L.slice(k,k+64);await T.scene.items.updateItems(C,A=>{for(let w of A)w.locked=!0})}await b.ToggleBusy(!1)};const E=document.getElementById("doublewall_button");E.onclick=async m=>{if(!m||!m.target)return;const L=b.sceneItems.filter(k=>Nt(k));await b.ToggleBusy(!0);for(let k=0;k<L.length;k+=64){const C=L.slice(k,k+64);await T.scene.items.updateItems(C,A=>{for(let w of A)w.metadata[`${d.EXTENSIONID}/doubleSided`]=!0})}b.ToggleBusy(!1)};const _=document.getElementById("block_button"),N=document.getElementById("unblock_button");N.onclick=async m=>{if(!m||!m.target)return;const L=b.sceneItems.filter(k=>Nt(k));await b.ToggleBusy(!0);for(let k=0;k<L.length;k+=64){const C=L.slice(k,k+64);await T.scene.items.updateItems(C,A=>{for(let w of A)w.metadata[`${d.EXTENSIONID}/blocking`]=void 0})}b.ToggleBusy(!1)},_.onclick=async m=>{if(!m||!m.target)return;const L=b.sceneItems.filter(k=>Nt(k));await b.ToggleBusy(!0);for(let k=0;k<L.length;k+=64){const C=L.slice(k,k+64);await T.scene.items.updateItems(C,A=>{for(let w of A)w.metadata[`${d.EXTENSIONID}/blocking`]=!0})}await b.ToggleBusy(!1)};var D;const O=document.getElementById("import_button"),X=document.getElementById("import_file"),H=document.getElementById("import_errors"),V=document.getElementById("import_dpi"),M=document.getElementById("import_format"),j=document.getElementById("dpi_autodetect"),a=document.getElementById("map_align");X.onchange=m=>{if(O.disabled=!0,!m||!m.target)return;const L=m.target;if(!L.files)return;const k=L.files[0];if(k.type!=="text/javascript"&&k.type,k){const A=document.getElementById("import_file_name");A&&(A.textContent=k.name);var C=new FileReader;C.onload=function(w){if(!w||!w.target){H.innerText="Invalid import event";return}const $=w.target;if(!$.result){H.innerText="Unable to read imported file";return}const F=$.result;D=JSON.parse(F),D&&(D.walls&&D.walls.length||D.line_of_sight&&D.line_of_sight.length||D.objects_line_of_sight&&D.objects_line_of_sight.length)?O.disabled=!1:H.innerText="Imported file has no walls"},C.readAsText(k)}else H.innerText="Failed to load file"},j.onclick=async m=>{!m||!m.target||(V.disabled=j.checked)},O.onclick=async m=>{!m||!m.target||(await b.ToggleBusy(!0),M.value==="scene"?await bs(D):await ws(M.value,D,j.checked?0:Number.parseInt(V.value),a.value,H),await b.ToggleBusy(!1))};const c=document.getElementById("tool_width"),u=document.getElementById("tool_color"),f=document.getElementById("tool_style");let y;const v=document.getElementById("preview_select");v.onchange=async m=>{m.currentTarget,await b.ToggleBusy(!1),await Ne.Run()},u.onclick=async m=>{xe({el:`#${u.id}`,alpha:!1,forceAlpha:!1})},u.oninput=async m=>{if(!m||!m.target)return;const L=m.target;clearTimeout(y),y=setTimeout(async()=>{/#[a-f0-9]{6}/.test(L.value)&&await T.scene.setMetadata({[`${d.EXTENSIONID}/toolColor`]:L.value})},400)},f.onchange=async m=>{const L=m.currentTarget;await T.scene.setMetadata({[`${d.EXTENSIONID}/toolStyle`]:L.value=="solid"?[]:[25,25]})},c.onchange=m=>{const L=m.currentTarget;clearTimeout(y),y=setTimeout(async()=>{await T.scene.setMetadata({[`${d.EXTENSIONID}/toolWidth`]:L.value})},400)};const g=b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??"#000000";u&&(u.value=g),xe({themeMode:"dark",alpha:!1,forceAlpha:!1,el:"#tool_color",defaultColor:g})}let qe=[];async function ra(){qe=[];const i=await T.scene.local.getItems(gr);await T.scene.local.deleteItems(i.map(e=>e.id)),await T.popover.close(d.BRUSHTOOLID)}async function Ss(i,e){await sa(e.pointerPosition)}async function Os(){const i=await T.viewport.getWidth();await T.popover.open({id:d.BRUSHTOOLID,url:"/pages/brush.html",height:80,width:350,disableClickAway:!0,anchorPosition:{top:60,left:i/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}async function ks(){await T.popover.close(d.BRUSHTOOLID)}async function Ds(i,e){await sa(e.pointerPosition)}async function Ls(i,e){await As(),await ra()}async function Cs(i,e){await ra()}async function sa(i){const e={x:Math.floor(i.x/b.gridDpi),y:Math.floor(i.y/b.gridDpi)};if(!qe.some(n=>n.x===e.x&&n.y===e.y)){const n={x:e.x*b.gridDpi,y:e.y*b.gridDpi},r={x:(e.x+1)*b.gridDpi,y:e.y*b.gridDpi},o={x:e.x*b.gridDpi,y:(e.y+1)*b.gridDpi},s={x:(e.x+1)*b.gridDpi,y:(e.y+1)*b.gridDpi},l=[[Tt.MOVE,n.x,n.y],[Tt.LINE,r.x,r.y],[Tt.LINE,s.x,s.y],[Tt.LINE,o.x,o.y],[Tt.CLOSE]],p=Ra().commands(l).strokeOpacity(0).fillOpacity(.5).fillColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).build();p.metadata[`${d.EXTENSIONID}/isBrushSquare`]=!0,p.layer="POINTER",qe.push(e),await T.scene.local.addItems([p])}}async function As(){const i=[];for(const s of qe){const{x:l,y:p}=s,h={x:l*b.gridDpi,y:p*b.gridDpi},E={x:(l+1)*b.gridDpi,y:p*b.gridDpi},_={x:l*b.gridDpi,y:(p+1)*b.gridDpi},N={x:(l+1)*b.gridDpi,y:(p+1)*b.gridDpi};if(!qe.some(D=>D.x===l&&D.y===p-1)){const D=h,O=E;i.push({Start:D,End:O})}if(!qe.some(D=>D.x===l&&D.y===p+1)){const D=_,O=N;i.push({Start:D,End:O})}if(!qe.some(D=>D.x===l-1&&D.y===p)){const D=h,O=_;i.push({Start:D,End:O})}if(!qe.some(D=>D.x===l+1&&D.y===p)){const D=E,O=N;i.push({Start:D,End:O})}}const e=da(i),t=oa(e),n=Ps(t),r=25,o=n.length;for(let s=0;s<o;s+=r){const l=n.slice(s,s+r);await T.scene.items.addItems(l)}}function oa(i){let e=[],t=[],n=!1;for(const r of i){const o=r.Start.x===r.End.x?i.filter(p=>p.Start.x===p.End.x):i.filter(p=>p.Start.y===p.End.y),s=r.Start.x===r.End.x?o.filter(p=>p.Start.x===r.Start.x&&p.End.x===r.End.x):o.filter(p=>p.Start.y===r.Start.y&&p.End.y===r.End.y),l=r.Start.x!==r.End.x?s.find(p=>p.Start.x>r.Start.x&&p.Start.x<r.End.x):s.find(p=>p.Start.y>r.Start.y&&p.Start.y<r.End.y);if(l){const p=Ms(r,l);t.push(p),e.push(r),e.push(l),t=t.filter(h=>h!==r&&h!==l),n=!0}else e.includes(r)||t.push(r)}return n?oa(t):t}function da(i){let e=[],t=[],n=!1;for(const r of i){const s=(r.Start.x===r.End.x?i.filter(l=>l.Start.x===l.End.x):i.filter(l=>l.Start.y===l.End.y)).find(l=>l.Start.x===r.End.x&&l.Start.y===r.End.y);if(s){const l=$s(r,s);t.push(l),e.push(r),e.push(s),t=t.filter(p=>p!==r&&p!==s),n=!0}else e.includes(r)||t.push(r)}return n?da(t):t}function $s(i,e){return{Start:i.Start,End:e.End}}function Ms(i,e){const t=Math.min(i.Start.x,e.Start.x),n=Math.min(i.Start.y,e.Start.y),r=Math.max(i.End.x,e.End.x),o=Math.max(i.End.y,e.End.y);return{Start:{x:t,y:n},End:{x:r,y:o}}}function Ps(i){const e=[];for(const t of i){const n=Se().tension(0).points([t.Start,t.End]).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Brushed)").closed(!1).locked(!0).build();n.visible=!1,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,e.push(n)}return e}const ct={onActivate:Os,onDeactivate:ks,onDragStart:Ss,onDragMove:Ds,onDragEnd:Ls,onDragCancel:Cs};let mt=[],la="",gt="",ft=null,Ht=!1,gn=!1;async function ua(){mt=[],gt="",await T.scene.local.deleteItems([la])}async function Rs(i){const e=i.position.x!==0&&i.position.y!==0,t=e?mi(i.points,i.position,!0):i.points,n=Wa(t,mt[0],mt[1],i.rotation,i.position),r=[],o=Se().tension(0).points(n.extracted).strokeColor("red").strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0,[`${d.EXTENSIONID}/blocking`]:!0}).closed(!1).visible(!1).locked(!0).build();r.push(o);for(const s of n.remaining){const l=Se().tension(0).position(i.position).strokeColor(b.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(b.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH).fillOpacity(0).rotation(i.rotation).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0,[`${d.EXTENSIONID}/blocking`]:!0}).closed(!1).visible(!1).locked(!0).build();l.points=e?mi(s,i.position,!1):s,r.push(l)}await T.scene.items.deleteItems([i.id]),await T.scene.items.addItems(r),ua()}async function xs(i,e){if(!e.transformer&&!(!e.target||e.target.type!=="CURVE"||gt!==""&&gt!==e.target.id)){if(gt=e.target.id,mt.push(e.pointerPosition),mt.length===1){const t=ca();t.position=e.pointerPosition,la=t.id,await T.scene.local.addItems([t])}mt.length===2&&Rs(e.target)}}async function Xs(i,e){if(e.target&&e.target.type==="CURVE"&&(gt===""||gt===e.target.id)){if(!Ht&&!gn){ft||(gn=!0,ft=await T.interaction.startItemInteraction(ca()));const[t]=ft;t(n=>{n.position=e.pointerPosition}),gn=!1}}else if(ft&&(!e.target||e.target&&e.target.type!=="CURVE")){const[t,n]=ft;n(),ft=null,Ht||(setTimeout(()=>{Ht=!1},50),Ht=!0)}}function Vs(i,e){e.key=="Escape"&&ua()}function ca(){return xa().color("red").radius((b.sceneMetadata[`${d.EXTENSIONID}/toolWidth`]??d.DEFAULTLINEWIDTH)+4).disableHit(!0).build()}function mi(i,e,t){return i.map(n=>({x:t?n.x+e.x:n.x-e.x,y:t?n.y+e.y:n.y-e.y}))}const vn={onToolClick:xs,onToolMove:Xs,onKeyDown:Vs};async function Fs(){await T.tool.create({id:`${d.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],defaultMetadata:{[`${d.EXTENSIONID}/elevationEditor`]:!1},async onClick(){await T.tool.activateTool(`${d.EXTENSIONID}/vision-tool`),b.toolStarted||(b.toolStarted=!0,await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!1}))}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:on.onToolClick,onToolMove:on.onToolMove,onKeyDown:on.onKeyDown,preventDrag:{dragging:!1}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:dn.onToolClick,onToolMove:dn.onToolMove,onKeyDown:dn.onKeyDown,preventDrag:{dragging:!1}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-brush-mode`,icons:[{icon:"/brush.svg",label:"Paint Obstructions by Grid",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:ct.onActivate,onToolUp:ct.onDeactivate,onToolDragStart:ct.onDragStart,onToolDragMove:ct.onDragMove,onToolDragEnd:ct.onDragEnd,onToolDragCancel:ct.onDragCancel}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-line-cutter-mode`,icons:[{icon:"/cutter.svg",label:"Trim Line",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:vn.onToolClick,onToolMove:vn.onToolMove,onKeyDown:vn.onKeyDown,preventDrag:{dragging:!1},cursors:[{cursor:"crosshair"}]}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-1`,icons:[{icon:"/mountain1.svg",label:"Create Map Elevation Layer-1",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>{he.onToolClick(i,e,1)},onToolMove:he.onToolMove,onKeyDown:(i,e)=>{he.onKeyDown(i,e,1)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-2`,icons:[{icon:"/mountain2.svg",label:"Create Map Elevation Layer-2",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>{he.onToolClick(i,e,2)},onToolMove:he.onToolMove,onKeyDown:(i,e)=>{he.onKeyDown(i,e,2)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-3`,icons:[{icon:"/mountain3.svg",label:"Create Map Elevation Layer-3",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>{he.onToolClick(i,e,3)},onToolMove:he.onToolMove,onKeyDown:(i,e)=>{he.onKeyDown(i,e,3)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-4`,icons:[{icon:"/mountain4.svg",label:"Create Map Elevation Layer-4",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>{he.onToolClick(i,e,4)},onToolMove:he.onToolMove,onKeyDown:(i,e)=>{he.onKeyDown(i,e,4)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-5`,icons:[{icon:"/mountain5.svg",label:"Create Map Elevation Layer-5",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>{he.onToolClick(i,e,5)},onToolMove:he.onToolMove,onKeyDown:(i,e)=>{he.onKeyDown(i,e,5)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-select`,icons:[{icon:"/mountain-select.svg",label:"Selector",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(i,e)=>!0,preventDrag:{dragging:!0}}),await T.tool.createAction({id:`${d.EXTENSIONID}/enter-elevation-mode`,icons:[{icon:"/eyeclosed.svg",label:"Activate Elevation Editor",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`],metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!0,operator:"!="}]}},{icon:"/eyeopen.svg",label:"De-Activate Elevation Editor",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`],metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!0,operator:"=="}]}}],onClick:he.enterEditMode})}var be="top",Ce="bottom",Ae="right",Te="left",Xn="auto",Mt=[be,Ce,Ae,Te],vt="start",At="end",Hs="clippingParents",fa="viewport",St="popper",Bs="reference",gi=Mt.reduce(function(i,e){return i.concat([e+"-"+vt,e+"-"+At])},[]),pa=[].concat(Mt,[Xn]).reduce(function(i,e){return i.concat([e,e+"-"+vt,e+"-"+At])},[]),Us="beforeRead",js="read",zs="afterRead",Gs="beforeMain",Ws="main",qs="afterMain",Ks="beforeWrite",Ys="write",Qs="afterWrite",Js=[Us,js,zs,Gs,Ws,qs,Ks,Ys,Qs];function Be(i){return i?(i.nodeName||"").toLowerCase():null}function Oe(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var e=i.ownerDocument;return e&&e.defaultView||window}return i}function at(i){var e=Oe(i).Element;return i instanceof e||i instanceof Element}function Le(i){var e=Oe(i).HTMLElement;return i instanceof e||i instanceof HTMLElement}function Vn(i){if(typeof ShadowRoot>"u")return!1;var e=Oe(i).ShadowRoot;return i instanceof e||i instanceof ShadowRoot}function Zs(i){var e=i.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];!Le(o)||!Be(o)||(Object.assign(o.style,n),Object.keys(r).forEach(function(s){var l=r[s];l===!1?o.removeAttribute(s):o.setAttribute(s,l===!0?"":l)}))})}function eo(i){var e=i.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],o=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),l=s.reduce(function(p,h){return p[h]="",p},{});!Le(r)||!Be(r)||(Object.assign(r.style,l),Object.keys(o).forEach(function(p){r.removeAttribute(p)}))})}}const ha={name:"applyStyles",enabled:!0,phase:"write",fn:Zs,effect:eo,requires:["computeStyles"]};function He(i){return i.split("-")[0]}var it=Math.max,Zt=Math.min,yt=Math.round;function Cn(){var i=navigator.userAgentData;return i!=null&&i.brands&&Array.isArray(i.brands)?i.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function ma(){return!/^((?!chrome|android).)*safari/i.test(Cn())}function Et(i,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=i.getBoundingClientRect(),r=1,o=1;e&&Le(i)&&(r=i.offsetWidth>0&&yt(n.width)/i.offsetWidth||1,o=i.offsetHeight>0&&yt(n.height)/i.offsetHeight||1);var s=at(i)?Oe(i):window,l=s.visualViewport,p=!ma()&&t,h=(n.left+(p&&l?l.offsetLeft:0))/r,E=(n.top+(p&&l?l.offsetTop:0))/o,_=n.width/r,N=n.height/o;return{width:_,height:N,top:E,right:h+_,bottom:E+N,left:h,x:h,y:E}}function Fn(i){var e=Et(i),t=i.offsetWidth,n=i.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:i.offsetLeft,y:i.offsetTop,width:t,height:n}}function ga(i,e){var t=e.getRootNode&&e.getRootNode();if(i.contains(e))return!0;if(t&&Vn(t)){var n=e;do{if(n&&i.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Ge(i){return Oe(i).getComputedStyle(i)}function to(i){return["table","td","th"].indexOf(Be(i))>=0}function Ke(i){return((at(i)?i.ownerDocument:i.document)||window.document).documentElement}function nn(i){return Be(i)==="html"?i:i.assignedSlot||i.parentNode||(Vn(i)?i.host:null)||Ke(i)}function vi(i){return!Le(i)||Ge(i).position==="fixed"?null:i.offsetParent}function no(i){var e=/firefox/i.test(Cn()),t=/Trident/i.test(Cn());if(t&&Le(i)){var n=Ge(i);if(n.position==="fixed")return null}var r=nn(i);for(Vn(r)&&(r=r.host);Le(r)&&["html","body"].indexOf(Be(r))<0;){var o=Ge(r);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return r;r=r.parentNode}return null}function Pt(i){for(var e=Oe(i),t=vi(i);t&&to(t)&&Ge(t).position==="static";)t=vi(t);return t&&(Be(t)==="html"||Be(t)==="body"&&Ge(t).position==="static")?e:t||no(i)||e}function Hn(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function kt(i,e,t){return it(i,Zt(e,t))}function io(i,e,t){var n=kt(i,e,t);return n>t?t:n}function va(){return{top:0,right:0,bottom:0,left:0}}function ya(i){return Object.assign({},va(),i)}function Ea(i,e){return e.reduce(function(t,n){return t[n]=i,t},{})}var ao=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,ya(typeof e!="number"?e:Ea(e,Mt))};function ro(i){var e,t=i.state,n=i.name,r=i.options,o=t.elements.arrow,s=t.modifiersData.popperOffsets,l=He(t.placement),p=Hn(l),h=[Te,Ae].indexOf(l)>=0,E=h?"height":"width";if(!(!o||!s)){var _=ao(r.padding,t),N=Fn(o),D=p==="y"?be:Te,O=p==="y"?Ce:Ae,X=t.rects.reference[E]+t.rects.reference[p]-s[p]-t.rects.popper[E],H=s[p]-t.rects.reference[p],V=Pt(o),M=V?p==="y"?V.clientHeight||0:V.clientWidth||0:0,j=X/2-H/2,a=_[D],c=M-N[E]-_[O],u=M/2-N[E]/2+j,f=kt(a,u,c),y=p;t.modifiersData[n]=(e={},e[y]=f,e.centerOffset=f-u,e)}}function so(i){var e=i.state,t=i.options,n=t.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||ga(e.elements.popper,r)&&(e.elements.arrow=r))}const oo={name:"arrow",enabled:!0,phase:"main",fn:ro,effect:so,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function wt(i){return i.split("-")[1]}var lo={top:"auto",right:"auto",bottom:"auto",left:"auto"};function uo(i,e){var t=i.x,n=i.y,r=e.devicePixelRatio||1;return{x:yt(t*r)/r||0,y:yt(n*r)/r||0}}function yi(i){var e,t=i.popper,n=i.popperRect,r=i.placement,o=i.variation,s=i.offsets,l=i.position,p=i.gpuAcceleration,h=i.adaptive,E=i.roundOffsets,_=i.isFixed,N=s.x,D=N===void 0?0:N,O=s.y,X=O===void 0?0:O,H=typeof E=="function"?E({x:D,y:X}):{x:D,y:X};D=H.x,X=H.y;var V=s.hasOwnProperty("x"),M=s.hasOwnProperty("y"),j=Te,a=be,c=window;if(h){var u=Pt(t),f="clientHeight",y="clientWidth";if(u===Oe(t)&&(u=Ke(t),Ge(u).position!=="static"&&l==="absolute"&&(f="scrollHeight",y="scrollWidth")),u=u,r===be||(r===Te||r===Ae)&&o===At){a=Ce;var v=_&&u===c&&c.visualViewport?c.visualViewport.height:u[f];X-=v-n.height,X*=p?1:-1}if(r===Te||(r===be||r===Ce)&&o===At){j=Ae;var g=_&&u===c&&c.visualViewport?c.visualViewport.width:u[y];D-=g-n.width,D*=p?1:-1}}var m=Object.assign({position:l},h&&lo),L=E===!0?uo({x:D,y:X},Oe(t)):{x:D,y:X};if(D=L.x,X=L.y,p){var k;return Object.assign({},m,(k={},k[a]=M?"0":"",k[j]=V?"0":"",k.transform=(c.devicePixelRatio||1)<=1?"translate("+D+"px, "+X+"px)":"translate3d("+D+"px, "+X+"px, 0)",k))}return Object.assign({},m,(e={},e[a]=M?X+"px":"",e[j]=V?D+"px":"",e.transform="",e))}function co(i){var e=i.state,t=i.options,n=t.gpuAcceleration,r=n===void 0?!0:n,o=t.adaptive,s=o===void 0?!0:o,l=t.roundOffsets,p=l===void 0?!0:l,h={placement:He(e.placement),variation:wt(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,yi(Object.assign({},h,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:p})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,yi(Object.assign({},h,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:p})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const fo={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:co,data:{}};var Bt={passive:!0};function po(i){var e=i.state,t=i.instance,n=i.options,r=n.scroll,o=r===void 0?!0:r,s=n.resize,l=s===void 0?!0:s,p=Oe(e.elements.popper),h=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&h.forEach(function(E){E.addEventListener("scroll",t.update,Bt)}),l&&p.addEventListener("resize",t.update,Bt),function(){o&&h.forEach(function(E){E.removeEventListener("scroll",t.update,Bt)}),l&&p.removeEventListener("resize",t.update,Bt)}}const ho={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:po,data:{}};var mo={left:"right",right:"left",bottom:"top",top:"bottom"};function Wt(i){return i.replace(/left|right|bottom|top/g,function(e){return mo[e]})}var go={start:"end",end:"start"};function Ei(i){return i.replace(/start|end/g,function(e){return go[e]})}function Bn(i){var e=Oe(i),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function Un(i){return Et(Ke(i)).left+Bn(i).scrollLeft}function vo(i,e){var t=Oe(i),n=Ke(i),r=t.visualViewport,o=n.clientWidth,s=n.clientHeight,l=0,p=0;if(r){o=r.width,s=r.height;var h=ma();(h||!h&&e==="fixed")&&(l=r.offsetLeft,p=r.offsetTop)}return{width:o,height:s,x:l+Un(i),y:p}}function yo(i){var e,t=Ke(i),n=Bn(i),r=(e=i.ownerDocument)==null?void 0:e.body,o=it(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=it(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),l=-n.scrollLeft+Un(i),p=-n.scrollTop;return Ge(r||t).direction==="rtl"&&(l+=it(t.clientWidth,r?r.clientWidth:0)-o),{width:o,height:s,x:l,y:p}}function jn(i){var e=Ge(i),t=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+n)}function wa(i){return["html","body","#document"].indexOf(Be(i))>=0?i.ownerDocument.body:Le(i)&&jn(i)?i:wa(nn(i))}function Dt(i,e){var t;e===void 0&&(e=[]);var n=wa(i),r=n===((t=i.ownerDocument)==null?void 0:t.body),o=Oe(n),s=r?[o].concat(o.visualViewport||[],jn(n)?n:[]):n,l=e.concat(s);return r?l:l.concat(Dt(nn(s)))}function An(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function Eo(i,e){var t=Et(i,!1,e==="fixed");return t.top=t.top+i.clientTop,t.left=t.left+i.clientLeft,t.bottom=t.top+i.clientHeight,t.right=t.left+i.clientWidth,t.width=i.clientWidth,t.height=i.clientHeight,t.x=t.left,t.y=t.top,t}function wi(i,e,t){return e===fa?An(vo(i,t)):at(e)?Eo(e,t):An(yo(Ke(i)))}function wo(i){var e=Dt(nn(i)),t=["absolute","fixed"].indexOf(Ge(i).position)>=0,n=t&&Le(i)?Pt(i):i;return at(n)?e.filter(function(r){return at(r)&&ga(r,n)&&Be(r)!=="body"}):[]}function Io(i,e,t,n){var r=e==="clippingParents"?wo(i):[].concat(e),o=[].concat(r,[t]),s=o[0],l=o.reduce(function(p,h){var E=wi(i,h,n);return p.top=it(E.top,p.top),p.right=Zt(E.right,p.right),p.bottom=Zt(E.bottom,p.bottom),p.left=it(E.left,p.left),p},wi(i,s,n));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function Ia(i){var e=i.reference,t=i.element,n=i.placement,r=n?He(n):null,o=n?wt(n):null,s=e.x+e.width/2-t.width/2,l=e.y+e.height/2-t.height/2,p;switch(r){case be:p={x:s,y:e.y-t.height};break;case Ce:p={x:s,y:e.y+e.height};break;case Ae:p={x:e.x+e.width,y:l};break;case Te:p={x:e.x-t.width,y:l};break;default:p={x:e.x,y:e.y}}var h=r?Hn(r):null;if(h!=null){var E=h==="y"?"height":"width";switch(o){case vt:p[h]=p[h]-(e[E]/2-t[E]/2);break;case At:p[h]=p[h]+(e[E]/2-t[E]/2);break}}return p}function $t(i,e){e===void 0&&(e={});var t=e,n=t.placement,r=n===void 0?i.placement:n,o=t.strategy,s=o===void 0?i.strategy:o,l=t.boundary,p=l===void 0?Hs:l,h=t.rootBoundary,E=h===void 0?fa:h,_=t.elementContext,N=_===void 0?St:_,D=t.altBoundary,O=D===void 0?!1:D,X=t.padding,H=X===void 0?0:X,V=ya(typeof H!="number"?H:Ea(H,Mt)),M=N===St?Bs:St,j=i.rects.popper,a=i.elements[O?M:N],c=Io(at(a)?a:a.contextElement||Ke(i.elements.popper),p,E,s),u=Et(i.elements.reference),f=Ia({reference:u,element:j,strategy:"absolute",placement:r}),y=An(Object.assign({},j,f)),v=N===St?y:u,g={top:c.top-v.top+V.top,bottom:v.bottom-c.bottom+V.bottom,left:c.left-v.left+V.left,right:v.right-c.right+V.right},m=i.modifiersData.offset;if(N===St&&m){var L=m[r];Object.keys(g).forEach(function(k){var C=[Ae,Ce].indexOf(k)>=0?1:-1,A=[be,Ce].indexOf(k)>=0?"y":"x";g[k]+=L[A]*C})}return g}function bo(i,e){e===void 0&&(e={});var t=e,n=t.placement,r=t.boundary,o=t.rootBoundary,s=t.padding,l=t.flipVariations,p=t.allowedAutoPlacements,h=p===void 0?pa:p,E=wt(n),_=E?l?gi:gi.filter(function(O){return wt(O)===E}):Mt,N=_.filter(function(O){return h.indexOf(O)>=0});N.length===0&&(N=_);var D=N.reduce(function(O,X){return O[X]=$t(i,{placement:X,boundary:r,rootBoundary:o,padding:s})[He(X)],O},{});return Object.keys(D).sort(function(O,X){return D[O]-D[X]})}function To(i){if(He(i)===Xn)return[];var e=Wt(i);return[Ei(i),e,Ei(e)]}function _o(i){var e=i.state,t=i.options,n=i.name;if(!e.modifiersData[n]._skip){for(var r=t.mainAxis,o=r===void 0?!0:r,s=t.altAxis,l=s===void 0?!0:s,p=t.fallbackPlacements,h=t.padding,E=t.boundary,_=t.rootBoundary,N=t.altBoundary,D=t.flipVariations,O=D===void 0?!0:D,X=t.allowedAutoPlacements,H=e.options.placement,V=He(H),M=V===H,j=p||(M||!O?[Wt(H)]:To(H)),a=[H].concat(j).reduce(function(se,Z){return se.concat(He(Z)===Xn?bo(e,{placement:Z,boundary:E,rootBoundary:_,padding:h,flipVariations:O,allowedAutoPlacements:X}):Z)},[]),c=e.rects.reference,u=e.rects.popper,f=new Map,y=!0,v=a[0],g=0;g<a.length;g++){var m=a[g],L=He(m),k=wt(m)===vt,C=[be,Ce].indexOf(L)>=0,A=C?"width":"height",w=$t(e,{placement:m,boundary:E,rootBoundary:_,altBoundary:N,padding:h}),$=C?k?Ae:Te:k?Ce:be;c[A]>u[A]&&($=Wt($));var F=Wt($),B=[];if(o&&B.push(w[L]<=0),l&&B.push(w[$]<=0,w[F]<=0),B.every(function(se){return se})){v=m,y=!1;break}f.set(m,B)}if(y)for(var q=O?3:1,G=function(Z){var Q=a.find(function(le){var oe=f.get(le);if(oe)return oe.slice(0,Z).every(function(ke){return ke})});if(Q)return v=Q,"break"},te=q;te>0;te--){var ie=G(te);if(ie==="break")break}e.placement!==v&&(e.modifiersData[n]._skip=!0,e.placement=v,e.reset=!0)}}const No={name:"flip",enabled:!0,phase:"main",fn:_o,requiresIfExists:["offset"],data:{_skip:!1}};function Ii(i,e,t){return t===void 0&&(t={x:0,y:0}),{top:i.top-e.height-t.y,right:i.right-e.width+t.x,bottom:i.bottom-e.height+t.y,left:i.left-e.width-t.x}}function bi(i){return[be,Ae,Ce,Te].some(function(e){return i[e]>=0})}function So(i){var e=i.state,t=i.name,n=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,s=$t(e,{elementContext:"reference"}),l=$t(e,{altBoundary:!0}),p=Ii(s,n),h=Ii(l,r,o),E=bi(p),_=bi(h);e.modifiersData[t]={referenceClippingOffsets:p,popperEscapeOffsets:h,isReferenceHidden:E,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":E,"data-popper-escaped":_})}const Oo={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:So};function ko(i,e,t){var n=He(i),r=[Te,be].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:i})):t,s=o[0],l=o[1];return s=s||0,l=(l||0)*r,[Te,Ae].indexOf(n)>=0?{x:l,y:s}:{x:s,y:l}}function Do(i){var e=i.state,t=i.options,n=i.name,r=t.offset,o=r===void 0?[0,0]:r,s=pa.reduce(function(E,_){return E[_]=ko(_,e.rects,o),E},{}),l=s[e.placement],p=l.x,h=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=p,e.modifiersData.popperOffsets.y+=h),e.modifiersData[n]=s}const Lo={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Do};function Co(i){var e=i.state,t=i.name;e.modifiersData[t]=Ia({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Ao={name:"popperOffsets",enabled:!0,phase:"read",fn:Co,data:{}};function $o(i){return i==="x"?"y":"x"}function Mo(i){var e=i.state,t=i.options,n=i.name,r=t.mainAxis,o=r===void 0?!0:r,s=t.altAxis,l=s===void 0?!1:s,p=t.boundary,h=t.rootBoundary,E=t.altBoundary,_=t.padding,N=t.tether,D=N===void 0?!0:N,O=t.tetherOffset,X=O===void 0?0:O,H=$t(e,{boundary:p,rootBoundary:h,padding:_,altBoundary:E}),V=He(e.placement),M=wt(e.placement),j=!M,a=Hn(V),c=$o(a),u=e.modifiersData.popperOffsets,f=e.rects.reference,y=e.rects.popper,v=typeof X=="function"?X(Object.assign({},e.rects,{placement:e.placement})):X,g=typeof v=="number"?{mainAxis:v,altAxis:v}:Object.assign({mainAxis:0,altAxis:0},v),m=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,L={x:0,y:0};if(u){if(o){var k,C=a==="y"?be:Te,A=a==="y"?Ce:Ae,w=a==="y"?"height":"width",$=u[a],F=$+H[C],B=$-H[A],q=D?-y[w]/2:0,G=M===vt?f[w]:y[w],te=M===vt?-y[w]:-f[w],ie=e.elements.arrow,se=D&&ie?Fn(ie):{width:0,height:0},Z=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:va(),Q=Z[C],le=Z[A],oe=kt(0,f[w],se[w]),ke=j?f[w]/2-q-oe-Q-g.mainAxis:G-oe-Q-g.mainAxis,ce=j?-f[w]/2+q+oe+le+g.mainAxis:te+oe+le+g.mainAxis,$e=e.elements.arrow&&Pt(e.elements.arrow),Me=$e?a==="y"?$e.clientTop||0:$e.clientLeft||0:0,_e=(k=m?.[a])!=null?k:0,rt=$+ke-_e-Me,st=$+ce-_e,Ye=kt(D?Zt(F,rt):F,$,D?it(B,st):B);u[a]=Ye,L[a]=Ye-$}if(l){var Qe,ot=a==="x"?be:Te,dt=a==="x"?Ce:Ae,Pe=u[c],Xe=c==="y"?"height":"width",Je=Pe+H[ot],Ue=Pe-H[dt],We=[be,Te].indexOf(V)!==-1,fe=(Qe=m?.[c])!=null?Qe:0,ee=We?Je:Pe-f[Xe]-y[Xe]-fe+g.altAxis,je=We?Pe+f[Xe]+y[Xe]-fe-g.altAxis:Ue,lt=D&&We?io(ee,Pe,je):kt(D?ee:Je,Pe,D?je:Ue);u[c]=lt,L[c]=lt-Pe}e.modifiersData[n]=L}}const Po={name:"preventOverflow",enabled:!0,phase:"main",fn:Mo,requiresIfExists:["offset"]};function Ro(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function xo(i){return i===Oe(i)||!Le(i)?Bn(i):Ro(i)}function Xo(i){var e=i.getBoundingClientRect(),t=yt(e.width)/i.offsetWidth||1,n=yt(e.height)/i.offsetHeight||1;return t!==1||n!==1}function Vo(i,e,t){t===void 0&&(t=!1);var n=Le(e),r=Le(e)&&Xo(e),o=Ke(e),s=Et(i,r,t),l={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(n||!n&&!t)&&((Be(e)!=="body"||jn(o))&&(l=xo(e)),Le(e)?(p=Et(e,!0),p.x+=e.clientLeft,p.y+=e.clientTop):o&&(p.x=Un(o))),{x:s.left+l.scrollLeft-p.x,y:s.top+l.scrollTop-p.y,width:s.width,height:s.height}}function Fo(i){var e=new Map,t=new Set,n=[];i.forEach(function(o){e.set(o.name,o)});function r(o){t.add(o.name);var s=[].concat(o.requires||[],o.requiresIfExists||[]);s.forEach(function(l){if(!t.has(l)){var p=e.get(l);p&&r(p)}}),n.push(o)}return i.forEach(function(o){t.has(o.name)||r(o)}),n}function Ho(i){var e=Fo(i);return Js.reduce(function(t,n){return t.concat(e.filter(function(r){return r.phase===n}))},[])}function Bo(i){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(i())})})),e}}function Uo(i){var e=i.reduce(function(t,n){var r=t[n.name];return t[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Ti={placement:"bottom",modifiers:[],strategy:"absolute"};function _i(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function jo(i){i===void 0&&(i={});var e=i,t=e.defaultModifiers,n=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?Ti:r;return function(l,p,h){h===void 0&&(h=o);var E={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ti,o),modifiersData:{},elements:{reference:l,popper:p},attributes:{},styles:{}},_=[],N=!1,D={state:E,setOptions:function(V){var M=typeof V=="function"?V(E.options):V;X(),E.options=Object.assign({},o,E.options,M),E.scrollParents={reference:at(l)?Dt(l):l.contextElement?Dt(l.contextElement):[],popper:Dt(p)};var j=Ho(Uo([].concat(n,E.options.modifiers)));return E.orderedModifiers=j.filter(function(a){return a.enabled}),O(),D.update()},forceUpdate:function(){if(!N){var V=E.elements,M=V.reference,j=V.popper;if(_i(M,j)){E.rects={reference:Vo(M,Pt(j),E.options.strategy==="fixed"),popper:Fn(j)},E.reset=!1,E.placement=E.options.placement,E.orderedModifiers.forEach(function(g){return E.modifiersData[g.name]=Object.assign({},g.data)});for(var a=0;a<E.orderedModifiers.length;a++){if(E.reset===!0){E.reset=!1,a=-1;continue}var c=E.orderedModifiers[a],u=c.fn,f=c.options,y=f===void 0?{}:f,v=c.name;typeof u=="function"&&(E=u({state:E,options:y,name:v,instance:D})||E)}}}},update:Bo(function(){return new Promise(function(H){D.forceUpdate(),H(E)})}),destroy:function(){X(),N=!0}};if(!_i(l,p))return D;D.setOptions(h).then(function(H){!N&&h.onFirstUpdate&&h.onFirstUpdate(H)});function O(){E.orderedModifiers.forEach(function(H){var V=H.name,M=H.options,j=M===void 0?{}:M,a=H.effect;if(typeof a=="function"){var c=a({state:E,name:V,instance:D,options:j}),u=function(){};_.push(c||u)}})}function X(){_.forEach(function(H){return H()}),_=[]}return D}}var zo=[ho,Ao,fo,ha,Lo,No,Po,oo,Oo],Go=jo({defaultModifiers:zo}),Wo="tippy-box",ba="tippy-content",qo="tippy-backdrop",Ta="tippy-arrow",_a="tippy-svg-arrow",nt={passive:!0,capture:!0},Na=function(){return document.body};function yn(i,e,t){if(Array.isArray(i)){var n=i[e];return n??(Array.isArray(t)?t[e]:t)}return i}function zn(i,e){var t={}.toString.call(i);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Sa(i,e){return typeof i=="function"?i.apply(void 0,e):i}function Ni(i,e){if(e===0)return i;var t;return function(n){clearTimeout(t),t=setTimeout(function(){i(n)},e)}}function Ko(i){return i.split(/\s+/).filter(Boolean)}function pt(i){return[].concat(i)}function Si(i,e){i.indexOf(e)===-1&&i.push(e)}function Yo(i){return i.filter(function(e,t){return i.indexOf(e)===t})}function Qo(i){return i.split("-")[0]}function en(i){return[].slice.call(i)}function Oi(i){return Object.keys(i).reduce(function(e,t){return i[t]!==void 0&&(e[t]=i[t]),e},{})}function Lt(){return document.createElement("div")}function an(i){return["Element","Fragment"].some(function(e){return zn(i,e)})}function Jo(i){return zn(i,"NodeList")}function Zo(i){return zn(i,"MouseEvent")}function ed(i){return!!(i&&i._tippy&&i._tippy.reference===i)}function td(i){return an(i)?[i]:Jo(i)?en(i):Array.isArray(i)?i:en(document.querySelectorAll(i))}function En(i,e){i.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function ki(i,e){i.forEach(function(t){t&&t.setAttribute("data-state",e)})}function nd(i){var e,t=pt(i),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function id(i,e){var t=e.clientX,n=e.clientY;return i.every(function(r){var o=r.popperRect,s=r.popperState,l=r.props,p=l.interactiveBorder,h=Qo(s.placement),E=s.modifiersData.offset;if(!E)return!0;var _=h==="bottom"?E.top.y:0,N=h==="top"?E.bottom.y:0,D=h==="right"?E.left.x:0,O=h==="left"?E.right.x:0,X=o.top-n+_>p,H=n-o.bottom-N>p,V=o.left-t+D>p,M=t-o.right-O>p;return X||H||V||M})}function wn(i,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){i[n](r,t)})}function Di(i,e){for(var t=e;t;){var n;if(i.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Ve={isTouch:!1},Li=0;function ad(){Ve.isTouch||(Ve.isTouch=!0,window.performance&&document.addEventListener("mousemove",Oa))}function Oa(){var i=performance.now();i-Li<20&&(Ve.isTouch=!1,document.removeEventListener("mousemove",Oa)),Li=i}function rd(){var i=document.activeElement;if(ed(i)){var e=i._tippy;i.blur&&!e.state.isVisible&&i.blur()}}function sd(){document.addEventListener("touchstart",ad,nt),window.addEventListener("blur",rd)}var od=typeof window<"u"&&typeof document<"u",dd=od?!!window.msCrypto:!1,ld={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},ud={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Re=Object.assign({appendTo:Na,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},ld,ud),cd=Object.keys(Re),fd=function(e){var t=Object.keys(e);t.forEach(function(n){Re[n]=e[n]})};function ka(i){var e=i.plugins||[],t=e.reduce(function(n,r){var o=r.name,s=r.defaultValue;if(o){var l;n[o]=i[o]!==void 0?i[o]:(l=Re[o])!=null?l:s}return n},{});return Object.assign({},i,t)}function pd(i,e){var t=e?Object.keys(ka(Object.assign({},Re,{plugins:e}))):cd,n=t.reduce(function(r,o){var s=(i.getAttribute("data-tippy-"+o)||"").trim();if(!s)return r;if(o==="content")r[o]=s;else try{r[o]=JSON.parse(s)}catch{r[o]=s}return r},{});return n}function Ci(i,e){var t=Object.assign({},e,{content:Sa(e.content,[i])},e.ignoreAttributes?{}:pd(i,e.plugins));return t.aria=Object.assign({},Re.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var hd=function(){return"innerHTML"};function $n(i,e){i[hd()]=e}function Ai(i){var e=Lt();return i===!0?e.className=Ta:(e.className=_a,an(i)?e.appendChild(i):$n(e,i)),e}function $i(i,e){an(e.content)?($n(i,""),i.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?$n(i,e.content):i.textContent=e.content)}function Mn(i){var e=i.firstElementChild,t=en(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(ba)}),arrow:t.find(function(n){return n.classList.contains(Ta)||n.classList.contains(_a)}),backdrop:t.find(function(n){return n.classList.contains(qo)})}}function Da(i){var e=Lt(),t=Lt();t.className=Wo,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Lt();n.className=ba,n.setAttribute("data-state","hidden"),$i(n,i.props),e.appendChild(t),t.appendChild(n),r(i.props,i.props);function r(o,s){var l=Mn(e),p=l.box,h=l.content,E=l.arrow;s.theme?p.setAttribute("data-theme",s.theme):p.removeAttribute("data-theme"),typeof s.animation=="string"?p.setAttribute("data-animation",s.animation):p.removeAttribute("data-animation"),s.inertia?p.setAttribute("data-inertia",""):p.removeAttribute("data-inertia"),p.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?p.setAttribute("role",s.role):p.removeAttribute("role"),(o.content!==s.content||o.allowHTML!==s.allowHTML)&&$i(h,i.props),s.arrow?E?o.arrow!==s.arrow&&(p.removeChild(E),p.appendChild(Ai(s.arrow))):p.appendChild(Ai(s.arrow)):E&&p.removeChild(E)}return{popper:e,onUpdate:r}}Da.$$tippy=!0;var md=1,Ut=[],In=[];function gd(i,e){var t=Ci(i,Object.assign({},Re,ka(Oi(e)))),n,r,o,s=!1,l=!1,p=!1,h=!1,E,_,N,D=[],O=Ni(rt,t.interactiveDebounce),X,H=md++,V=null,M=Yo(t.plugins),j={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},a={id:H,reference:i,popper:Lt(),popperInstance:V,props:t,state:j,plugins:M,clearDelayTimeouts:ee,setProps:je,setContent:lt,show:bt,hide:I,hideWithInteractivity:P,enable:We,disable:fe,unmount:R,destroy:z};if(!t.render)return a;var c=t.render(a),u=c.popper,f=c.onUpdate;u.setAttribute("data-tippy-root",""),u.id="tippy-"+a.id,a.popper=u,i._tippy=a,u._tippy=a;var y=M.map(function(S){return S.fn(a)}),v=i.hasAttribute("aria-expanded");return $e(),q(),$(),F("onCreate",[a]),t.showOnCreate&&Je(),u.addEventListener("mouseenter",function(){a.props.interactive&&a.state.isVisible&&a.clearDelayTimeouts()}),u.addEventListener("mouseleave",function(){a.props.interactive&&a.props.trigger.indexOf("mouseenter")>=0&&C().addEventListener("mousemove",O)}),a;function g(){var S=a.props.touch;return Array.isArray(S)?S:[S,0]}function m(){return g()[0]==="hold"}function L(){var S;return!!((S=a.props.render)!=null&&S.$$tippy)}function k(){return X||i}function C(){var S=k().parentNode;return S?nd(S):document}function A(){return Mn(u)}function w(S){return a.state.isMounted&&!a.state.isVisible||Ve.isTouch||E&&E.type==="focus"?0:yn(a.props.delay,S?0:1,Re.delay)}function $(S){S===void 0&&(S=!1),u.style.pointerEvents=a.props.interactive&&!S?"":"none",u.style.zIndex=""+a.props.zIndex}function F(S,x,U){if(U===void 0&&(U=!0),y.forEach(function(W){W[S]&&W[S].apply(W,x)}),U){var K;(K=a.props)[S].apply(K,x)}}function B(){var S=a.props.aria;if(S.content){var x="aria-"+S.content,U=u.id,K=pt(a.props.triggerTarget||i);K.forEach(function(W){var ne=W.getAttribute(x);if(a.state.isVisible)W.setAttribute(x,ne?ne+" "+U:U);else{var ue=ne&&ne.replace(U,"").trim();ue?W.setAttribute(x,ue):W.removeAttribute(x)}})}}function q(){if(!(v||!a.props.aria.expanded)){var S=pt(a.props.triggerTarget||i);S.forEach(function(x){a.props.interactive?x.setAttribute("aria-expanded",a.state.isVisible&&x===k()?"true":"false"):x.removeAttribute("aria-expanded")})}}function G(){C().removeEventListener("mousemove",O),Ut=Ut.filter(function(S){return S!==O})}function te(S){if(!(Ve.isTouch&&(p||S.type==="mousedown"))){var x=S.composedPath&&S.composedPath()[0]||S.target;if(!(a.props.interactive&&Di(u,x))){if(pt(a.props.triggerTarget||i).some(function(U){return Di(U,x)})){if(Ve.isTouch||a.state.isVisible&&a.props.trigger.indexOf("click")>=0)return}else F("onClickOutside",[a,S]);a.props.hideOnClick===!0&&(a.clearDelayTimeouts(),a.hide(),l=!0,setTimeout(function(){l=!1}),a.state.isMounted||Q())}}}function ie(){p=!0}function se(){p=!1}function Z(){var S=C();S.addEventListener("mousedown",te,!0),S.addEventListener("touchend",te,nt),S.addEventListener("touchstart",se,nt),S.addEventListener("touchmove",ie,nt)}function Q(){var S=C();S.removeEventListener("mousedown",te,!0),S.removeEventListener("touchend",te,nt),S.removeEventListener("touchstart",se,nt),S.removeEventListener("touchmove",ie,nt)}function le(S,x){ke(S,function(){!a.state.isVisible&&u.parentNode&&u.parentNode.contains(u)&&x()})}function oe(S,x){ke(S,x)}function ke(S,x){var U=A().box;function K(W){W.target===U&&(wn(U,"remove",K),x())}if(S===0)return x();wn(U,"remove",_),wn(U,"add",K),_=K}function ce(S,x,U){U===void 0&&(U=!1);var K=pt(a.props.triggerTarget||i);K.forEach(function(W){W.addEventListener(S,x,U),D.push({node:W,eventType:S,handler:x,options:U})})}function $e(){m()&&(ce("touchstart",_e,{passive:!0}),ce("touchend",st,{passive:!0})),Ko(a.props.trigger).forEach(function(S){if(S!=="manual")switch(ce(S,_e),S){case"mouseenter":ce("mouseleave",st);break;case"focus":ce(dd?"focusout":"blur",Ye);break;case"focusin":ce("focusout",Ye);break}})}function Me(){D.forEach(function(S){var x=S.node,U=S.eventType,K=S.handler,W=S.options;x.removeEventListener(U,K,W)}),D=[]}function _e(S){var x,U=!1;if(!(!a.state.isEnabled||Qe(S)||l)){var K=((x=E)==null?void 0:x.type)==="focus";E=S,X=S.currentTarget,q(),!a.state.isVisible&&Zo(S)&&Ut.forEach(function(W){return W(S)}),S.type==="click"&&(a.props.trigger.indexOf("mouseenter")<0||s)&&a.props.hideOnClick!==!1&&a.state.isVisible?U=!0:Je(S),S.type==="click"&&(s=!U),U&&!K&&Ue(S)}}function rt(S){var x=S.target,U=k().contains(x)||u.contains(x);if(!(S.type==="mousemove"&&U)){var K=Xe().concat(u).map(function(W){var ne,ue=W._tippy,ye=(ne=ue.popperInstance)==null?void 0:ne.state;return ye?{popperRect:W.getBoundingClientRect(),popperState:ye,props:t}:null}).filter(Boolean);id(K,S)&&(G(),Ue(S))}}function st(S){var x=Qe(S)||a.props.trigger.indexOf("click")>=0&&s;if(!x){if(a.props.interactive){a.hideWithInteractivity(S);return}Ue(S)}}function Ye(S){a.props.trigger.indexOf("focusin")<0&&S.target!==k()||a.props.interactive&&S.relatedTarget&&u.contains(S.relatedTarget)||Ue(S)}function Qe(S){return Ve.isTouch?m()!==S.type.indexOf("touch")>=0:!1}function ot(){dt();var S=a.props,x=S.popperOptions,U=S.placement,K=S.offset,W=S.getReferenceClientRect,ne=S.moveTransition,ue=L()?Mn(u).arrow:null,ye=W?{getBoundingClientRect:W,contextElement:W.contextElement||k()}:i,Gn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(xt){var ut=xt.state;if(L()){var La=A(),sn=La.box;["placement","reference-hidden","escaped"].forEach(function(Xt){Xt==="placement"?sn.setAttribute("data-placement",ut.placement):ut.attributes.popper["data-popper-"+Xt]?sn.setAttribute("data-"+Xt,""):sn.removeAttribute("data-"+Xt)}),ut.attributes.popper={}}}},Ze=[{name:"offset",options:{offset:K}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ne}},Gn];L()&&ue&&Ze.push({name:"arrow",options:{element:ue,padding:3}}),Ze.push.apply(Ze,x?.modifiers||[]),a.popperInstance=Go(ye,u,Object.assign({},x,{placement:U,onFirstUpdate:N,modifiers:Ze}))}function dt(){a.popperInstance&&(a.popperInstance.destroy(),a.popperInstance=null)}function Pe(){var S=a.props.appendTo,x,U=k();a.props.interactive&&S===Na||S==="parent"?x=U.parentNode:x=Sa(S,[U]),x.contains(u)||x.appendChild(u),a.state.isMounted=!0,ot()}function Xe(){return en(u.querySelectorAll("[data-tippy-root]"))}function Je(S){a.clearDelayTimeouts(),S&&F("onTrigger",[a,S]),Z();var x=w(!0),U=g(),K=U[0],W=U[1];Ve.isTouch&&K==="hold"&&W&&(x=W),x?n=setTimeout(function(){a.show()},x):a.show()}function Ue(S){if(a.clearDelayTimeouts(),F("onUntrigger",[a,S]),!a.state.isVisible){Q();return}if(!(a.props.trigger.indexOf("mouseenter")>=0&&a.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(S.type)>=0&&s)){var x=w(!1);x?r=setTimeout(function(){a.state.isVisible&&a.hide()},x):o=requestAnimationFrame(function(){a.hide()})}}function We(){a.state.isEnabled=!0}function fe(){a.hide(),a.state.isEnabled=!1}function ee(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(o)}function je(S){if(!a.state.isDestroyed){F("onBeforeUpdate",[a,S]),Me();var x=a.props,U=Ci(i,Object.assign({},x,Oi(S),{ignoreAttributes:!0}));a.props=U,$e(),x.interactiveDebounce!==U.interactiveDebounce&&(G(),O=Ni(rt,U.interactiveDebounce)),x.triggerTarget&&!U.triggerTarget?pt(x.triggerTarget).forEach(function(K){K.removeAttribute("aria-expanded")}):U.triggerTarget&&i.removeAttribute("aria-expanded"),q(),$(),f&&f(x,U),a.popperInstance&&(ot(),Xe().forEach(function(K){requestAnimationFrame(K._tippy.popperInstance.forceUpdate)})),F("onAfterUpdate",[a,S])}}function lt(S){a.setProps({content:S})}function bt(){var S=a.state.isVisible,x=a.state.isDestroyed,U=!a.state.isEnabled,K=Ve.isTouch&&!a.props.touch,W=yn(a.props.duration,0,Re.duration);if(!(S||x||U||K)&&!k().hasAttribute("disabled")&&(F("onShow",[a],!1),a.props.onShow(a)!==!1)){if(a.state.isVisible=!0,L()&&(u.style.visibility="visible"),$(),Z(),a.state.isMounted||(u.style.transition="none"),L()){var ne=A(),ue=ne.box,ye=ne.content;En([ue,ye],0)}N=function(){var Ze;if(!(!a.state.isVisible||h)){if(h=!0,u.offsetHeight,u.style.transition=a.props.moveTransition,L()&&a.props.animation){var rn=A(),xt=rn.box,ut=rn.content;En([xt,ut],W),ki([xt,ut],"visible")}B(),q(),Si(In,a),(Ze=a.popperInstance)==null||Ze.forceUpdate(),F("onMount",[a]),a.props.animation&&L()&&oe(W,function(){a.state.isShown=!0,F("onShown",[a])})}},Pe()}}function I(){var S=!a.state.isVisible,x=a.state.isDestroyed,U=!a.state.isEnabled,K=yn(a.props.duration,1,Re.duration);if(!(S||x||U)&&(F("onHide",[a],!1),a.props.onHide(a)!==!1)){if(a.state.isVisible=!1,a.state.isShown=!1,h=!1,s=!1,L()&&(u.style.visibility="hidden"),G(),Q(),$(!0),L()){var W=A(),ne=W.box,ue=W.content;a.props.animation&&(En([ne,ue],K),ki([ne,ue],"hidden"))}B(),q(),a.props.animation?L()&&le(K,a.unmount):a.unmount()}}function P(S){C().addEventListener("mousemove",O),Si(Ut,O),O(S)}function R(){a.state.isVisible&&a.hide(),a.state.isMounted&&(dt(),Xe().forEach(function(S){S._tippy.unmount()}),u.parentNode&&u.parentNode.removeChild(u),In=In.filter(function(S){return S!==a}),a.state.isMounted=!1,F("onHidden",[a]))}function z(){a.state.isDestroyed||(a.clearDelayTimeouts(),a.unmount(),Me(),delete i._tippy,a.state.isDestroyed=!0,F("onDestroy",[a]))}}function Rt(i,e){e===void 0&&(e={});var t=Re.plugins.concat(e.plugins||[]);sd();var n=Object.assign({},e,{plugins:t}),r=td(i),o=r.reduce(function(s,l){var p=l&&gd(l,n);return p&&s.push(p),s},[]);return an(i)?o[0]:o}Rt.defaultProps=Re;Rt.setDefaultProps=fd;Rt.currentInput=Ve;Object.assign({},ha,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});Rt.setDefaultProps({render:Da});function vd(i,e){const t=document.getElementById(`${i}`);t&&Rt(t,{content:e,theme:"battlesystem"})}function yd(){const i=new Map;i.set("tip_gmtokens","Note: GM-owned tokens give universal vision."),i.set("visionRangeHeader","Range: How far this token can see."),i.set("visionFalloffHeader","Falloff: The blurred edge of the vision range."),i.set("visionBlindHeader","Blind: If this token is temporarily without sight."),i.set("visionHideHeader","Move token to the 'Out-of-Sight' list"),i.set("visionBumperHeader","Collision Distance: How close this token can get to an active wall."),i.set("visionInAngleHeader","Inner Angle: Inner angle of token vision, for hard edge, match with Outer Angle"),i.set("visionOutAngleHeader","Outer Angle:  Outer angle of token vision, for hard edge, match with Inner Angle"),i.set("visionDarkHeader","Greyscale: Add an 'outer-ring' of visible greyscale outside of your vision (Darkvision-Esque)."),i.set("tip_spectretokens","Spectre tokens are only visible to specific players. Enable vision here after it has been Spectred."),i.set("tip_fogfill","Toggle to enable/disable fog fill for the scene."),i.set("tip_disablevision","Toggle to enable/disable vision for all tokens in scene."),i.set("tip_persistence","Toggle to enable/disable persistence vision for tokens. This will leave the map revealed as they travel."),i.set("tip_playerdoors","Toggle to enable/disable players being able to see and use doors on their own."),i.set("tip_ownerrings","Toggle to enable/disable the colored rings seen around a player to indicate their vision radius. GM-Only."),i.set("tip_gridsnap","Toggle to enable/disable grid snapping when drawing Obstruction Lines and Objects. This is separate from the default OBR Snap setting."),i.set("doublewall_button","This will change ALL walls within the scene to be double-sided, so they cannot be passed from either side."),i.set("block_button","This will set all walls to be Blocking walls, so that tokens cannot move past them."),i.set("unblock_button","This will set all walls to be Passable walls, so that tokens can move through them."),i.set("lock_button","This will lock all obstruction lines, so they cannot be accidentally (or purposefully) moved."),i.set("unlock_button","This will unlock all obstruction lines so they can be moved and/or editted."),i.set("reset_persistence","This will reset all persistence on a map, for all players in the room."),i.set("preview_select","This will allow you to view fog as the selected Player would see it."),i.forEach((e,t)=>{vd(t,e)})}class Ed{static async CenterViewportOnImage(e){const t=await T.scene.grid.getDpi(),n=await T.viewport.getScale(),r=await T.viewport.getWidth(),o=await T.viewport.getHeight(),s={x:r/2,y:o/2},l={x:s.x/n,y:s.y/n},p=await this.GetImageCenter(e,t),h={x:p.x-l.x,y:p.y-l.y},E={x:h.x*n*-1,y:h.y*n*-1};await T.viewport.animateTo({position:E,scale:n})}static async GetImageCenter(e,t){if(Ba(e)){const n=t/e.grid.dpi,r=e.image.width*n,o=e.image.height*n,s=e.grid.offset.x/e.image.width*r,l=e.grid.offset.y/e.image.height*o;return{x:e.position.x-s+r/2,y:e.position.y-l+o/2}}else return Ha(e)&&e.points.length>0?{x:e.points[0].x,y:e.points[0].y}:{x:e.position.x,y:e.position.y}}}class wd{mainWindow=document.getElementById("app");smokeViewToggle;spectreViewToggle;settingsViewToggle;helpViewToggle;smokeViewPanel;spectreViewPanel;settingsViewPanel;helpViewPanel;patreonContainer;onVisionPanelMain=!0;visionPanelMain;visionPanelSub;smokeUnitTablePrime;smokeUnitTableSub;tokenList;hiddenList;version;constructor(e){this.version=`SMOKEANDSPECTRE-${e}`}async Stop(){await T.action.setHeight(100),await T.action.setWidth(300),this.mainWindow.innerHTML=`
        <div id="stopScreen">
            Awaiting Scene...
        </div>
        `}async Start(){if(localStorage.getItem("NOTICED")!=="true"&&(await T.modal.open({id:d.EXTENSIONNOTICE,url:`/src/notice/notice.html?subscriber=${b.USER_REGISTERED}`,height:400,width:500}),localStorage.setItem("NOTICED","true")),b.playerRole==="GM"){await T.action.setHeight(530),await T.action.setWidth(420),this.mainWindow.innerHTML=`
            <div id="tabControls">
                <div class="controlContainer">
                    <button class="view-button selected" id="smokeViewToggle">Smoke</button>
                    <button class="view-button" id="spectreViewToggle">Spectre</button>
                    <button class="view-button" id="helpViewToggle">Help</button>
                    <button class="view-button" id="settingsViewToggle">Settings</button>
                    <div id="patreonContainer"></div>
                </div>
            </div>
            <div id="smokeViewPanel" class="panel"></div>
            <div id="spectreViewPanel" class="panel" style="display: none;"></div>
            <div id="settingsViewPanel" class="panel" style="display: none;"></div>
            <div id="helpViewPanel" class="panel" style="display: none;">
                <div id="markdownHelpContainer"></div>
            </div>
            `,this.smokeViewToggle=document.getElementById("smokeViewToggle"),this.spectreViewToggle=document.getElementById("spectreViewToggle"),this.settingsViewToggle=document.getElementById("settingsViewToggle"),this.helpViewToggle=document.getElementById("helpViewToggle"),this.smokeViewPanel=document.getElementById("smokeViewPanel"),this.spectreViewPanel=document.getElementById("spectreViewPanel"),this.settingsViewPanel=document.getElementById("settingsViewPanel"),this.helpViewPanel=document.getElementById("helpViewPanel"),this.patreonContainer=document.getElementById("patreonContainer"),this.smokeViewPanel.innerHTML=d.SMOKEHTML,this.spectreViewPanel.innerHTML=d.SPECTREHTML,this.settingsViewPanel.innerHTML=d.SETTINGSHTML;const t=document.getElementById("playerListing");t.appendChild(this.GetEmptyContextItem("Self"));const n=document.getElementById("preview_select");n.innerHTML="";const r=document.createElement("option");r.value=b.playerId,r.textContent="View As: Self",n.appendChild(r);for(const o of b.party){const s=document.createElement("li");s.id=o.id,s.textContent=o.name,s.style.color=o.color,t.appendChild(s);const l=document.createElement("option");l.value=o.id,l.textContent=`View As: ${o.name}`,l.style.color=o.color,n.appendChild(l)}xe.init(),await vs(),this.SetupHelpDocuments(),this.SetupGMPanelHandlers(),this.UpdateVisionList(),Ns(),pi(),Fs(),yd(),await Ot.Initialize()}else await T.action.setHeight(300),await T.action.setWidth(300),this.mainWindow.innerHTML=`
                <div id="titleHolder" style="display: flex; width: 100%;">
                    <div style="width:60%;">Tokens You Own</div>
                    <div style="width:30%;">Vision</div>
                    <div style="width:10%;" id="patreonContainer"></div>
                </div>
                <div id="playerView" class="scrollable-table">
                    <table id="playerViewTable">
                    <thead>
                        <tr id="playerViewTableHeader">
                            <th style="width: 70%;"></th>
                            <th style="width: 20%;"></th>
                            <th style="width: 10%;"></th>
                        </tr>
                    </thead>
                        <tbody id="playerViewTableBody">
                        </tbody>
                    </table>
                </div>
            `,this.UpdatePlayerView(),this.patreonContainer=document.getElementById("patreonContainer");await this.InitializeScene(),this.patreonContainer?.appendChild(za())}UpdatePlayerView(){const e=b.sceneItems.filter(r=>Wi(r)),t=document.getElementsByClassName("token-table-entry");this.CleanVisionList(e,t);const n=document.getElementById("playerViewTable");for(const r of e){const o=document.getElementById(`pl-${r.id}`);if(o){const s=o.getElementsByClassName("token-name")[0],l=o.getElementsByClassName("token-aradius")[0],p=o.getElementsByClassName("token-distancetype")[0];s&&(s.textContent=r.text?.plainText||r.name),l&&(l.textContent=r.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?r.metadata[`${d.EXTENSIONID}/visionRange`]:d.ATTENUATIONDEFAULT),p&&(p.textContent=b.gridType)}else{const s=document.createElement("tr");s.id=`pl-${r.id}`,s.classList.add("token-table-entry");const l=document.createElement("td");l.textContent=r.text?.plainText||r.name,l.classList.add("player-token-name"),s.appendChild(l);const p=document.createElement("td");p.textContent=r.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?r.metadata[`${d.EXTENSIONID}/visionRange`]:d.ATTENUATIONDEFAULT,s.appendChild(p);const h=document.createElement("td");h.textContent=b.gridType,s.appendChild(h),n.appendChild(s)}}}GetEmptyContextItem(e){const t=document.createElement("li");return t.id=b.playerId,t.textContent=e,t}SetupGMPanelHandlers(){this.SetupViewPanel(),this.smokeViewToggle.onclick=t=>{t.preventDefault(),e(J.smokeViewToggle,J.smokeViewPanel)},this.spectreViewToggle.onclick=t=>{t.preventDefault(),e(J.spectreViewToggle,J.spectreViewPanel)},this.settingsViewToggle.onclick=t=>{t.preventDefault(),e(J.settingsViewToggle,J.settingsViewPanel)},this.helpViewToggle.onclick=t=>{t.preventDefault(),e(J.helpViewToggle,J.helpViewPanel)};function e(t,n){J.smokeViewToggle?.classList.remove("selected"),J.spectreViewToggle?.classList.remove("selected"),J.settingsViewToggle?.classList.remove("selected"),J.helpViewToggle?.classList.remove("selected"),J.smokeViewPanel.style.display="none",J.spectreViewPanel.style.display="none",J.settingsViewPanel.style.display="none",J.helpViewPanel.style.display="none",t.classList.add("selected"),n.style.display="block"}}async OnDataChange(){await Ne.Run(),await Ot.Run(),b.playerRole==="GM"?(this.UpdateVisionList(),pi()):this.UpdatePlayerView()}async InitializeScene(){await Ne.Initialize(),await Ne.Run(),await Ot.Run()}UpdateVisionList(){const e=b.sceneItems.filter(n=>mr(n)),t=document.getElementsByClassName("token-table-entry");this.CleanVisionList(e,t);for(const n of e){const r=document.getElementById(`tr-${n.id}`);r?this.UpdateTokenOnVisionList(n,r):this.AddTokenToVisionList(n)}}SetupViewPanel(){const e=document.getElementById("visionPanelToggleContainer");this.visionPanelMain=document.getElementById("visionPanelMain"),this.visionPanelSub=document.getElementById("visionPanelSub"),this.smokeUnitTablePrime=document.getElementById("smokeUnitTablePrime"),this.smokeUnitTableSub=document.getElementById("smokeUnitTableSub");const t=document.createElement("input");t.type="button",t.value="Show Advanced",t.classList.add("view-panel-toggle"),t.onclick=()=>{this.visionPanelMain.style.display=this.onVisionPanelMain?"none":"table-row",this.visionPanelSub.style.display=this.onVisionPanelMain?"table-row":"none";const n=document.getElementsByClassName("vision-panel-main-input"),r=document.getElementsByClassName("vision-panel-sub-input");for(let o=0;o<n.length;o++)this.onVisionPanelMain?this.fadeOut(n[o],()=>this.fadeIn(r[o],"inline-block")):this.fadeOut(r[o],()=>this.fadeIn(n[o],"inline-block"));t.value=this.onVisionPanelMain?"Show Basic":"Show Advanced",this.onVisionPanelMain=!this.onVisionPanelMain},e.appendChild(t)}AddTokenToVisionList(e){let t=b.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`],n=t?.color,r=t?.name?`This token is owned by ${t.name}.`:"This token is owned by you.";!n&&e.createdUserId!==b.playerId&&(n="#aeb0af",r="This tokens owner is not in the room currently.");const o=document.getElementById("token_list"),s=document.getElementById("hidden_list"),l=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0,p=document.createElement("tr");p.id=`tr-${e.id}`,p.className="token-table-entry",p.classList.add("slide-row");const h=document.createElement("td");h.id=`name-${e.id}`,l?(h.innerText=`🔦${e.name} `,h.title="This is a torch, which can be seen by other tokens with vision when in range."):(h.innerText=e.name,h.title=r,h.setAttribute("data-color",n),h.style.textShadow=`
                -2px -2px 2px ${n},
                2px -2px 2px ${n},
                -2px 2px 2px ${n},
                2px 2px 2px ${n}`),h.classList.add("token-name"),n==="#aeb0af"&&(h.style.color="black !important",h.style.fontStyle="italic"),h.onclick=async()=>{Ed.CenterViewportOnImage(e),await T.player.select([e.id])};const E=document.createElement("td"),_=document.createElement("input");_.type="number",_.value=e.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionRange`]:d.ATTENUATIONDEFAULT,_.classList.add("token-aradius"),_.classList.add("vision-panel-main-input"),_.style.display=this.onVisionPanelMain?"inline-block":"none",_.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseInt(v.value);g<0&&(v.value="0"),g>999&&(v.value="999"),isNaN(g)&&(v.value=d.ATTENUATIONDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionRange`]=v.value})};const N=document.createElement("input");N.type="number",N.style.display="none",N.value=e.metadata[`${d.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionSourceRange`]:d.SOURCEDEFAULT,N.classList.add("token-sradius"),N.classList.add("vision-panel-sub-input"),N.style.display=this.onVisionPanelMain?"none":"inline-block",N.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseInt(v.value);g<0&&(v.value="0"),g>999&&(v.value="999"),isNaN(g)&&(v.value=d.SOURCEDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionSourceRange`]=v.value})},E.appendChild(_),E.appendChild(N);const D=document.createElement("td"),O=document.createElement("input");O.type="number",O.value=e.metadata[`${d.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionFallOff`]:d.FALLOFFDEFAULT,O.classList.add("token-falloff"),O.classList.add("vision-panel-main-input"),O.style.display=this.onVisionPanelMain?"inline-block":"none",O.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseFloat(v.value);g<0&&(v.value="0"),g>10&&(v.value="10"),isNaN(g)&&(v.value=d.FALLOFFDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionFallOff`]=v.value})};const X=document.createElement("input");X.type="number",X.style.display="none",X.value=e.metadata[`${d.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionInAngle`]:d.INANGLEDEFAULT,X.classList.add("token-innerang"),X.classList.add("vision-panel-sub-input"),X.style.display=this.onVisionPanelMain?"none":"inline-block",X.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseInt(v.value);g<0&&(v.value="0"),g>360&&(v.value="360"),isNaN(g)&&(v.value=d.INANGLEDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionInAngle`]=v.value})},D.appendChild(O),D.appendChild(X);const H=document.createElement("td"),V=document.createElement("input");V.type="checkbox",V.checked=e.metadata[`${d.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionBlind`]:!1,V.classList.add("token-blind"),V.classList.add("vision-panel-main-input"),V.style.display=this.onVisionPanelMain?"inline-block":"none",V.onchange=async f=>{if(!f||!f.target)return;const y=f.target,v=b.sceneItems.find(g=>g.id===e.id);await T.scene.items.updateItems([v],g=>{g[0].metadata[`${d.EXTENSIONID}/visionBlind`]=y.checked})};const M=document.createElement("input");M.type="number",M.style.display="none",M.value=e.metadata[`${d.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionOutAngle`]:d.OUTANGLEDEFAULT,M.classList.add("token-outerang"),M.classList.add("vision-panel-sub-input"),M.style.display=this.onVisionPanelMain?"none":"inline-block",M.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseInt(v.value);g<0&&(v.value="0"),g>360&&(v.value="360"),isNaN(g)&&(v.value=d.OUTANGLEDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionOutAngle`]=v.value})},H.appendChild(V),H.appendChild(M);const j=document.createElement("td"),a=document.createElement("input");a.type="image",a.src="/swap.svg",a.checked=e.metadata[`${d.EXTENSIONID}/hiddenToken`]!==void 0?e.metadata[`${d.EXTENSIONID}/hiddenToken`]:!1,a.classList.add("token-hide"),a.classList.add("vision-panel-main-input"),a.style.display=this.onVisionPanelMain?"inline-block":"none",a.onclick=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target;v.checked=!v.checked;const g=document.getElementById(`tr-${e.id}`);v.checked?(g.classList.add("slide-out"),setTimeout(()=>{J.hiddenList.prepend(g),g.classList.remove("slide-out"),g.classList.add("slide-in"),setTimeout(async()=>{g.classList.remove("slide-in"),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/hiddenToken`]=v.checked})},10)},250)):(g.classList.add("slide-out"),setTimeout(()=>{J.tokenList.appendChild(g),g.classList.remove("slide-out"),g.classList.add("slide-in"),setTimeout(async()=>{g.classList.remove("slide-in"),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/hiddenToken`]=v.checked})},10)},250))};const c=document.createElement("input");c.type="number",c.value=e.metadata[`${d.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionDark`]:d.DARKVISIONDEFAULT,c.classList.add("token-darkvision"),c.classList.add("vision-panel-sub-input"),c.style.display=this.onVisionPanelMain?"none":"inline-block",c.onchange=async f=>{if(!f||!f.target)return;const y=b.sceneItems.find(m=>m.id===e.id),v=f.target,g=parseInt(v.value);g<0&&(v.value="0"),g>999&&(v.value="999"),isNaN(g)&&(v.value=d.ATTENUATIONDEFAULT),await T.scene.items.updateItems([y],m=>{m[0].metadata[`${d.EXTENSIONID}/visionDark`]=v.value})},j.appendChild(a),j.appendChild(c),p.appendChild(h),p.appendChild(E),p.appendChild(D),p.appendChild(H),p.appendChild(j),e.metadata[`${d.EXTENSIONID}/hiddenToken`]===!0?s.prepend(p):o.appendChild(p);function u(){document.getElementById("contextMenu").style.display="none"}p.oncontextmenu=async function(f){f.preventDefault();const y=f.currentTarget,v=document.getElementById("contextMenu"),g=k=>{k.preventDefault()},m=async k=>{const C=[...b.party,{id:b.playerId,color:b.playerColor,name:b.playerName}],A=k.target,w=v.getAttribute("currentUnit"),F=document.getElementById(`tr-${w}`).getElementsByClassName("token-name")[0],B=C.find(q=>A.id===q.id);if(B){const q=B.name!==b.playerName?`This token is owned by ${B.name}.`:"This token is owned by you.";F.title=q,F.setAttribute("data-color",n),F.style.textShadow=`
                    -2px -2px 2px ${B.color},
                    2px -2px 2px ${B.color},
                    -2px 2px 2px ${B.color},
                    2px 2px 2px ${B.color}`}else F.title="Unable to update owner name",F.style.textShadow="";await T.scene.items.updateItems([w],q=>{for(const G of q)G.createdUserId=A.id}),v.style.display="none",k.stopPropagation(),window.removeEventListener("click",L),v.removeEventListener("click",m),v.removeEventListener("contextmenu",g)};v.setAttribute("currentUnit",y.id.substring(3));const L=()=>{v.style.display="none",window.removeEventListener("click",L),v.removeEventListener("click",m),v.removeEventListener("contextmenu",g)};if(v.addEventListener("click",m),v.addEventListener("contextmenu",g),window.addEventListener("click",L),v.style.display=="block")u();else{const C=(document.getElementById("playerListing").children.length+1)*34,A=Math.min(f.pageX,window.innerWidth-150);let w=Math.min(f.pageY,(window.innerHeight>300?window.innerHeight-50:window.innerHeight)-120);window.innerHeight<C+w&&(w=window.innerHeight-C),v.style.display="block",v.style.left=A+"px",v.style.top=w+"px"}}}UpdateTokenOnVisionList(e,t){const n=b.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`];let r=n?.color,o=n?.name?`This token is owned by ${n.name}.`:"This token is owned by you.";const s=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0;!r&&e.createdUserId!==b.playerId&&(r="#aeb0af",o="This tokens owner is not in the room currently.");const l=t.getElementsByClassName("token-name")[0],p=t.getElementsByClassName("token-aradius")[0],h=t.getElementsByClassName("token-sradius")[0],E=t.getElementsByClassName("token-falloff")[0],_=t.getElementsByClassName("token-innerang")[0],N=t.getElementsByClassName("token-outerang")[0],D=t.getElementsByClassName("token-blind")[0],O=t.getElementsByClassName("token-darkvision")[0];l&&(s?(l.innerText=`🔦${e.name} `,l.title="This is a torch, which can be seen by other tokens with vision when in range."):(l.innerText=e.name,l.title=o,l.setAttribute("data-color",r),l.style.textShadow=`
                    -2px -2px 2px ${r},
                    2px -2px 2px ${r},
                    -2px 2px 2px ${r},
                    2px 2px 2px ${r}`)),p&&(p.value=e.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionRange`]:d.ATTENUATIONDEFAULT),h&&(h.value=e.metadata[`${d.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionSourceRange`]:d.SOURCEDEFAULT),E&&(E.value=e.metadata[`${d.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionFallOff`]:d.FALLOFFDEFAULT),_&&(_.value=e.metadata[`${d.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionInAngle`]:d.INANGLEDEFAULT),N&&(N.value=e.metadata[`${d.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionOutAngle`]:d.OUTANGLEDEFAULT),D&&(D.checked=e.metadata[`${d.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionBlind`]:!1),O&&(O.value=e.metadata[`${d.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionDark`]:d.DARKVISIONDEFAULT)}CleanVisionList(e,t){for(const n of t){const r=n.id.slice(3);e.some(o=>o.id===r)||n.remove()}}SetupHelpDocuments(){const t=new Fa.Converter().makeHtml(d.MARKDOWNHELP),n=document.getElementById("markdownHelpContainer");n.innerHTML=t}fadeOut=(e,t)=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none",t()},300)};fadeIn=(e,t)=>{e.style.opacity="0",e.style.display=t,setTimeout(()=>{e.style.opacity="1"},10)}}const J=new wd("3.01");T.onReady(async()=>{const i=await T.scene.isReady();if(!document.getElementById("papp"))if(i===!1){const t=T.scene.onReadyChange(async n=>{n&&(t(),await Mi())})}else await Mi()});async function Mi(){await b.InitializeCache(),b.SetupHandlers(),await J.Start()}
