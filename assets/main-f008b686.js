import{C as I,b as Kt,a as Wn,O as $,c as vt,d as Tt,i as Dr}from"./constants-0f2f31d6.js";var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Pr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),t}function $r(i){return i.type==="CURVE"}function qn(i){return i.type==="IMAGE"}function pi(i,e){return Math.round(i/e)*e}function hi(i,e){return Math.floor(i/e)*e}function Rn(i){return i*(Math.PI/180)}function Lr(i){return i*(180/Math.PI)}function gi(i,e,t){return i*(1-t)+e*t}class jt{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const o=Math.cos(Rn(n)),r=Math.sin(Rn(n)),l=this.subtract(e,t);return{x:t.x+o*l.x-r*l.y,y:t.y+r*l.x+o*l.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:pi(e.x,t.x),y:pi(e.y,t.y)}}static floorTo(e,t){return{x:hi(e.x,t.x),y:hi(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let m of e)t=m.x<t?m.x:t,n=m.x>n?m.x:n,o=m.y<o?m.y:o,r=m.y>r?m.y:r;let l=n-t,f=r-o,v={x:(t+n)/2,y:(o+r)/2};return{min:{x:t,y:o},max:{x:n,y:r},width:l,height:f,center:v}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let o=!1;for(let r=0,l=t.length-1;r<t.length;l=r++){const f=t[r].y>e.y,v=t[l].y>e.y;f!==v&&e.x<(t[l].x-t[r].x)*(e.y-t[r].y)/(t[l].y-t[r].y)+t[r].x&&(o=!o)}return o}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:gi(e.x,t.x,n),y:gi(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Xe{static inverse(e){const[t,n,o,r,l,f,v,m,_]=e,x=t*(l*_-m*f)-n*(r*_-f*v)+o*(r*m-l*v);if(Math.abs(x)<1e-14)return e;const A=1/x,H=(l*_-m*f)*A,N=(o*m-n*_)*A,M=(n*f-o*l)*A,S=(f*v-r*_)*A,D=(t*_-o*v)*A,C=(r*o-t*f)*A,B=(r*m-v*l)*A,F=(v*n-t*m)*A,Q=(t*l-r*n)*A;return[H,N,M,S,D,C,B,F,Q]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Rn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Xe.fromPosition(e.position),n=Xe.fromScale(e.scale),o=Xe.fromRotation(e.rotation);return Xe.multiply(Xe.multiply(t,o),n)}static decompose(e){const[t,n,o,r,l,f]=e,v=t*l-r*n,m={position:{x:o,y:f},rotation:0,scale:{x:1,y:1}};if(t!=0||r!=0){var _=Math.sqrt(t*t+r*r);m.rotation=r>0?Math.acos(t/_):-Math.acos(t/_),m.scale={x:_,y:v/_}}else if(n!=0||l!=0){var x=Math.sqrt(n*n+l*l);m.rotation=Math.PI/2-(l>0?Math.acos(-n/x):-Math.acos(n/x)),m.scale={x:v/x,y:x}}return m.rotation=Lr(m.rotation),m}}class Mr{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const R=new Mr;function Rr(i){return i.layer=="MAP"&&(i.metadata[`${I.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${I.ARMINDOID}/isBackgroundImage`])}function gt(i){return i.metadata[`${I.EXTENSIONID}/isVisionFog`]||i.metadata[`${I.ARMINDOID}/isVisionFog`]}function Fr(i){return i.metadata[`${I.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${I.ARMINDOID}/isIndicatorRing`]}function Br(i){return i.metadata[`${I.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${I.EXTENSIONID}/disabled`]||i.metadata[`${I.ARMINDOID}/isVisionLine`]&&!i.metadata[`${I.ARMINDOID}/disabled`]}function Fi(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${I.EXTENSIONID}/hasVision`]||i.metadata[`${I.ARMINDOID}/hasVision`])}function Xr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${I.EXTENSIONID}/hasVision`]||i.metadata[`${I.ARMINDOID}/hasVision`])&&!i.metadata[`${I.EXTENSIONID}/visionBlind`]}function Vr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&i.createdUserId==R.userId&&(i.metadata[`${I.EXTENSIONID}/hasVision`]||i.metadata[`${I.ARMINDOID}/hasVision`])&&!i.metadata[`${I.EXTENSIONID}/visionBlind`]}function Bi(i){return i.layer=="DRAWING"&&(i.metadata[`${I.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${I.ARMINDOID}/isBackgroundImage`])}function Ut(i){return i.metadata[`${I.EXTENSIONID}/isTrailingFog`]}function Fn(i){return i.metadata[`${I.EXTENSIONID}/isTrailingFog`]||i.metadata[`${I.EXTENSIONID}/isVisionFog`]||i.metadata[`${I.ARMINDOID}/isVisionFog`]||i.metadata[`${I.EXTENSIONID}/isIndicatorRing`]}function xt(i){return i.metadata[`${I.EXTENSIONID}/visionTorch`]}function Xi(i){return i.layer=="CHARACTER"&&!Fi(i)&&i.metadata[`${I.EXTENSIONID}/hasAutohide`]===!0}var Vi={exports:{}};const jr={},Ur=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"})),_n=Pr(Ur);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var l=Object.assign,f,v;r.ready=new Promise(function(s,a){f=s,v=a}),function(s){var a={};s.loadCmdsTypedArray=function(j){for(var z=0,Z=0;Z<j.length;Z++)z+=j[Z].length;if(a[z])var J=a[z];else J=new Float32Array(z),a[z]=J;var ie=0;for(Z=0;Z<j.length;Z++)for(var Se=0;Se<j[Z].length;Se++){var De=j[Z][Se];typeof De=="string"&&(De=s.SkBits2FloatUnsigned(parseInt(De))),J[ie]=De,ie++}return j=s._malloc(J.length*J.BYTES_PER_ELEMENT),s.HEAPF32.set(J,j/J.BYTES_PER_ELEMENT),[j,z]},s.FromCmds=function(j){j=s.loadCmdsTypedArray(j);var z=s._FromCmds(j[0],j[1]);return s._free(j[0]),z};var c,y,k,L,q;s.cubicYFromX=function(j,z,Z,J,ie){return c&&y===j&&k===z&&L===Z&&q===J||(c&&c.delete(),c=new s._SkCubicMap([j,z],[Z,J]),y=j,k=z,L=Z,q=J),c.computeYFromX(ie)},s.cubicPtFromT=function(j,z,Z,J,ie){return c&&y===j&&k===z&&L===Z&&q===J||(c&&c.delete(),c=new s._SkCubicMap([j,z],[Z,J]),y=j,k=z,L=Z,q=J),c.computePtFromT(ie)}}(r),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var a=arguments[0];if(arguments.length===1)this._addPath(a,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var c=arguments[1];this._addPath(a,c.a,c.c,c.e,c.b,c.d,c.f,0,0,1)}else if(arguments.length===7)c=arguments,this._addPath(a,c[1],c[3],c[5],c[2],c[4],c[6],0,0,1);else if(arguments.length===10)c=arguments,this._addPath(a,c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(a,c,y,k,L,q){return this._arc(a,c,y,k,L,!!q),this},s.SkPath.prototype.arcTo=function(a,c,y,k,L){return this._arcTo(a,c,y,k,L),this},s.SkPath.prototype.bezierCurveTo=function(a,c,y,k,L,q){return this._cubicTo(a,c,y,k,L,q),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(a,c,y,k,L){return this._conicTo(a,c,y,k,L),this},s.SkPath.prototype.cubicTo=function(a,c,y,k,L,q){return this._cubicTo(a,c,y,k,L,q),this},s.SkPath.prototype.dash=function(a,c,y){return this._dash(a,c,y)?this:null},s.SkPath.prototype.ellipse=function(a,c,y,k,L,q,j,z){return this._ellipse(a,c,y,k,L,q,j,!!z),this},s.SkPath.prototype.lineTo=function(a,c){return this._lineTo(a,c),this},s.SkPath.prototype.moveTo=function(a,c){return this._moveTo(a,c),this},s.SkPath.prototype.op=function(a,c){return this._op(a,c)?this:null},s.SkPath.prototype.quadraticCurveTo=function(a,c,y,k){return this._quadTo(a,c,y,k),this},s.SkPath.prototype.quadTo=function(a,c,y,k){return this._quadTo(a,c,y,k),this},s.SkPath.prototype.rect=function(a,c,y,k){return this._rect(a,c,y,k),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(a){return a=a||{},a.width=a.width||1,a.miter_limit=a.miter_limit||4,a.cap=a.cap||s.StrokeCap.BUTT,a.join=a.join||s.StrokeJoin.MITER,this._stroke(a)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var a=arguments;this._transform(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(a,c,y){return this._trim(a,c,!!y)?this:null}}}(r);var m=l({},r),_=typeof window=="object",x=typeof importScripts=="function",A="",H,N,M,S,D,C;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(A=x?_n.dirname(A)+"/":__dirname+"/",C=()=>{D||(S=_n,D=_n)},H=function(s,a){return C(),s=D.normalize(s),S.readFileSync(s,a?null:"utf8")},M=s=>(s=H(s,!0),s.buffer||(s=new Uint8Array(s)),s),N=(s,a,c)=>{C(),s=D.normalize(s),S.readFile(s,function(y,k){y?c(y):a(k.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),r.inspect=function(){return"[Emscripten Module object]"}):(_||x)&&(x?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),n&&(A=n),A.indexOf("blob:")!==0?A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):A="",H=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},x&&(M=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),N=(s,a,c)=>{var y=new XMLHttpRequest;y.open("GET",s,!0),y.responseType="arraybuffer",y.onload=()=>{y.status==200||y.status==0&&y.response?a(y.response):c()},y.onerror=c,y.send(null)});var B=r.print||console.log.bind(console),F=r.printErr||console.warn.bind(console);l(r,m),m=null;var Q;r.wasmBinary&&(Q=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ae("no native wasm support detected");var O,h=!1,p=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(s,a,c){var y=a+c;for(c=a;s[c]&&!(c>=y);)++c;if(16<c-a&&s.subarray&&p)return p.decode(s.subarray(a,c));for(y="";a<c;){var k=s[a++];if(k&128){var L=s[a++]&63;if((k&224)==192)y+=String.fromCharCode((k&31)<<6|L);else{var q=s[a++]&63;k=(k&240)==224?(k&15)<<12|L<<6|q:(k&7)<<18|L<<12|q<<6|s[a++]&63,65536>k?y+=String.fromCharCode(k):(k-=65536,y+=String.fromCharCode(55296|k>>10,56320|k&1023))}}else y+=String.fromCharCode(k)}return y}function g(s,a,c){var y=oe;if(0<c){c=a+c-1;for(var k=0;k<s.length;++k){var L=s.charCodeAt(k);if(55296<=L&&57343>=L){var q=s.charCodeAt(++k);L=65536+((L&1023)<<10)|q&1023}if(127>=L){if(a>=c)break;y[a++]=L}else{if(2047>=L){if(a+1>=c)break;y[a++]=192|L>>6}else{if(65535>=L){if(a+2>=c)break;y[a++]=224|L>>12}else{if(a+3>=c)break;y[a++]=240|L>>18,y[a++]=128|L>>12&63}y[a++]=128|L>>6&63}y[a++]=128|L&63}}y[a]=0}}var T=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function P(s,a){for(var c=s>>1,y=c+a/2;!(c>=y)&&Re[c];)++c;if(c<<=1,32<c-s&&T)return T.decode(oe.subarray(s,c));for(c="",y=0;!(y>=a/2);++y){var k=we[s+2*y>>1];if(k==0)break;c+=String.fromCharCode(k)}return c}function ne(s,a,c){if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var y=a;c=c<2*s.length?c/2:s.length;for(var k=0;k<c;++k)we[a>>1]=s.charCodeAt(k),a+=2;return we[a>>1]=0,a-y}function te(s){return 2*s.length}function re(s,a){for(var c=0,y="";!(c>=a/4);){var k=le[s+4*c>>2];if(k==0)break;++c,65536<=k?(k-=65536,y+=String.fromCharCode(55296|k>>10,56320|k&1023)):y+=String.fromCharCode(k)}return y}function Y(s,a,c){if(c===void 0&&(c=2147483647),4>c)return 0;var y=a;c=y+c-4;for(var k=0;k<s.length;++k){var L=s.charCodeAt(k);if(55296<=L&&57343>=L){var q=s.charCodeAt(++k);L=65536+((L&1023)<<10)|q&1023}if(le[a>>2]=L,a+=4,a+4>c)break}return le[a>>2]=0,a-y}function ge(s){for(var a=0,c=0;c<s.length;++c){var y=s.charCodeAt(c);55296<=y&&57343>=y&&++c,a+=4}return a}var ve,fe,oe,we,Re,le,xe,Ke,qe;function Fe(){var s=O.buffer;ve=s,r.HEAP8=fe=new Int8Array(s),r.HEAP16=we=new Int16Array(s),r.HEAP32=le=new Int32Array(s),r.HEAPU8=oe=new Uint8Array(s),r.HEAPU16=Re=new Uint16Array(s),r.HEAPU32=xe=new Uint32Array(s),r.HEAPF32=Ke=new Float32Array(s),r.HEAPF64=qe=new Float64Array(s)}var K,d=[],u=[],w=[];function X(){var s=r.preRun.shift();d.unshift(s)}var V=0,G=null;r.preloadedImages={},r.preloadedAudios={};function ae(s){throw r.onAbort&&r.onAbort(s),s="Aborted("+s+")",F(s),h=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),v(s),s}function ce(){return se.startsWith("data:application/octet-stream;base64,")}var se;if(se="pathkit.wasm",!ce()){var Ie=se;se=r.locateFile?r.locateFile(Ie,A):A+Ie}function Oe(){var s=se;try{if(s==se&&Q)return new Uint8Array(Q);if(M)return M(s);throw"both async and sync fetching of the wasm failed"}catch(a){ae(a)}}function Ae(){if(!Q&&(_||x)){if(typeof fetch=="function"&&!se.startsWith("file://"))return fetch(se,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+se+"'";return s.arrayBuffer()}).catch(function(){return Oe()});if(N)return new Promise(function(s,a){N(se,function(c){s(new Uint8Array(c))},a)})}return Promise.resolve().then(function(){return Oe()})}function Te(s){for(;0<s.length;){var a=s.shift();if(typeof a=="function")a(r);else{var c=a.Wa;typeof c=="number"?a.xa===void 0?K.get(c)():K.get(c)(a.xa):c(a.xa===void 0?null:a.xa)}}}var pe={};function Ee(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function ze(s){return this.fromWireType(xe[s>>2])}var st={},et={},b={};function U(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?"_"+s:s}function W(s,a){return s=U(s),function(){return a.apply(this,arguments)}}function ee(s){var a=Error,c=W(s,function(y){this.name=s,this.message=y,y=Error(y).stack,y!==void 0&&(this.stack=this.toString()+`
`+y.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var ue=void 0;function he(s){throw new ue(s)}function de(s,a,c){function y(j){j=c(j),j.length!==s.length&&he("Mismatched type converter count");for(var z=0;z<s.length;++z)nt(s[z],j[z])}s.forEach(function(j){b[j]=a});var k=Array(a.length),L=[],q=0;a.forEach(function(j,z){et.hasOwnProperty(j)?k[z]=et[j]:(L.push(j),st.hasOwnProperty(j)||(st[j]=[]),st[j].push(function(){k[z]=et[j],++q,q===L.length&&y(k)}))}),L.length===0&&y(k)}var Ce={};function me(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Le=void 0;function be(s){for(var a="";oe[s];)a+=Le[oe[s++]];return a}var Me=void 0;function ye(s){throw new Me(s)}function nt(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var y=a.name;if(s||ye('type "'+y+'" must have a positive integer typeid pointer'),et.hasOwnProperty(s)){if(c.Qa)return;ye("Cannot register type '"+y+"' twice")}et[s]=a,delete b[s],st.hasOwnProperty(s)&&(a=st[s],delete st[s],a.forEach(function(k){k()}))}function cn(s){ye(s.ea.ha.fa.name+" instance already deleted")}var un=!1;function Zn(){}function Jn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function It(s){return typeof FinalizationGroup>"u"?(It=a=>a,s):(un=new FinalizationGroup(function(a){for(var c=a.next();!c.done;c=a.next())c=c.value,c.ga?Jn(c):console.warn("object already deleted: "+c.ga)}),It=a=>(un.register(a,a.ea,a.ea),a),Zn=a=>{un.unregister(a.ea)},It(s))}var Et=void 0,wt=[];function dn(){for(;wt.length;){var s=wt.pop();s.ea.pa=!1,s.delete()}}function lt(){}var Qn={};function ei(s,a,c){if(s[a].ia===void 0){var y=s[a];s[a]=function(){return s[a].ia.hasOwnProperty(arguments.length)||ye("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].ia+")!"),s[a].ia[arguments.length].apply(this,arguments)},s[a].ia=[],s[a].ia[y.ua]=y}}function fn(s,a,c){r.hasOwnProperty(s)?((c===void 0||r[s].ia!==void 0&&r[s].ia[c]!==void 0)&&ye("Cannot register public name '"+s+"' twice"),ei(r,s,s),r.hasOwnProperty(c)&&ye("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[s].ia[c]=a):(r[s]=a,c!==void 0&&(r[s].Xa=c))}function yr(s,a,c,y,k,L,q,j){this.name=s,this.constructor=a,this.qa=c,this.la=y,this.na=k,this.Oa=L,this.ta=q,this.La=j,this.Ta=[]}function pn(s,a,c){for(;a!==c;)a.ta||ye("Expected null or instance of "+c.name+", got an instance of "+a.name),s=a.ta(s),a=a.na;return s}function vr(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+vn(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),pn(a.ea.ga,a.ea.ha.fa,this.fa))}function Ir(s,a){if(a===null){if(this.Ba&&ye("null is not a valid "+this.name),this.wa){var c=this.sa();return s!==null&&s.push(this.la,c),c}return 0}if(a.ea||ye('Cannot pass "'+vn(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&a.ea.ha.va&&ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name),c=pn(a.ea.ga,a.ea.ha.fa,this.fa),this.wa)switch(a.ea.ka===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:a.ea.ma===this?c=a.ea.ka:ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name);break;case 1:c=a.ea.ka;break;case 2:if(a.ea.ma===this)c=a.ea.ka;else{var y=a.clone();c=this.Ua(c,ct(function(){y.delete()})),s!==null&&s.push(this.la,c)}break;default:ye("Unsupporting sharing policy")}return c}function Er(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+vn(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),a.ea.ha.va&&ye("Cannot convert argument of type "+a.ea.ha.name+" to parameter type "+this.name),pn(a.ea.ga,a.ea.ha.fa,this.fa))}function ti(s,a,c){return a===c?s:c.na===void 0?null:(s=ti(s,a,c.na),s===null?null:c.La(s))}var bt={};function wr(s,a){for(a===void 0&&ye("ptr should not be undefined");s.na;)a=s.ta(a),s=s.na;return bt[a]}function Ct(s,a){return a.ha&&a.ga||he("makeClassHandle requires ptr and ptrType"),!!a.ma!=!!a.ka&&he("Both smartPtrType and smartPtr must be specified"),a.count={value:1},It(Object.create(s,{ea:{value:a}}))}function rt(s,a,c,y){this.name=s,this.fa=a,this.Ba=c,this.va=y,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,a.na!==void 0?this.toWireType=Ir:(this.toWireType=y?vr:Er,this.ja=null)}function ni(s,a,c){r.hasOwnProperty(s)||he("Replacing nonexistant public symbol"),r[s].ia!==void 0&&c!==void 0?r[s].ia[c]=a:(r[s]=a,r[s].ua=c)}function br(s,a){var c=[];return function(){c.length=arguments.length;for(var y=0;y<arguments.length;y++)c[y]=arguments[y];return s.includes("j")?(y=r["dynCall_"+s],y=c&&c.length?y.apply(null,[a].concat(c)):y.call(null,a)):y=K.get(a).apply(null,c),y}}function Ve(s,a){s=be(s);var c=s.includes("j")?br(s,a):K.get(a);return typeof c!="function"&&ye("unknown function pointer with signature "+s+": "+a),c}var ii=void 0;function ri(s){s=ui(s);var a=be(s);return ot(s),a}function Dt(s,a){function c(L){k[L]||et[L]||(b[L]?b[L].forEach(c):(y.push(L),k[L]=!0))}var y=[],k={};throw a.forEach(c),new ii(s+": "+y.map(ri).join([", "]))}function hn(s,a){for(var c=[],y=0;y<s;y++)c.push(le[(a>>2)+y]);return c}function gn(s,a,c,y,k){var L=a.length;2>L&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");var q=a[1]!==null&&c!==null,j=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].ja===void 0){j=!0;break}var z=a[0].name!=="void",Z=L-2,J=Array(Z),ie=[],Se=[];return function(){if(arguments.length!==Z&&ye("function "+s+" called with "+arguments.length+" arguments, expected "+Z+" args!"),Se.length=0,ie.length=q?2:1,ie[0]=k,q){var De=a[1].toWireType(Se,this);ie[1]=De}for(var _e=0;_e<Z;++_e)J[_e]=a[_e+2].toWireType(Se,arguments[_e]),ie.push(J[_e]);if(_e=y.apply(null,ie),j)Ee(Se);else for(var je=q?1:2;je<a.length;je++){var Ue=je===1?De:J[je-2];a[je].ja!==null&&a[je].ja(Ue)}return De=z?a[0].fromWireType(_e):void 0,De}}var mn=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function oi(s){4<s&&--tt[s].Ca===0&&(tt[s]=void 0,mn.push(s))}function yn(s){return s||ye("Cannot use deleted val. handle = "+s),tt[s].value}function ct(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var a=mn.length?mn.pop():tt.length;return tt[a]={Ca:1,value:s},a}}function Sr(s,a,c){switch(a){case 0:return function(y){return this.fromWireType((c?fe:oe)[y])};case 1:return function(y){return this.fromWireType((c?we:Re)[y>>1])};case 2:return function(y){return this.fromWireType((c?le:xe)[y>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Pt(s,a){var c=et[s];return c===void 0&&ye(a+" has unknown type "+ri(s)),c}function vn(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function _r(s,a){switch(a){case 2:return function(c){return this.fromWireType(Ke[c>>2])};case 3:return function(c){return this.fromWireType(qe[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Tr(s,a,c){switch(a){case 0:return c?function(y){return fe[y]}:function(y){return oe[y]};case 1:return c?function(y){return we[y>>1]}:function(y){return Re[y>>1]};case 2:return c?function(y){return le[y>>2]}:function(y){return xe[y>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Or={};function In(s){var a=Or[s];return a===void 0?be(s):a}var En=[];function ai(){function s(a){a.$$$embind_global$$$=a;var c=typeof $$$embind_global$$$=="object"&&a.$$$embind_global$$$===a;return c||delete a.$$$embind_global$$$,c}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof Sn=="object"&&s(Sn)?$$$embind_global$$$=Sn:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Nr(s){var a=En.length;return En.push(s),a}function kr(s,a){for(var c=Array(s),y=0;y<s;++y)c[y]=Pt(le[(a>>2)+y],"parameter "+y);return c}var si=[];function xr(s){var a=Array(s+1);return function(c,y,k){a[0]=c;for(var L=0;L<s;++L){var q=Pt(le[(y>>2)+L],"parameter "+L);a[L+1]=q.readValueFromPointer(k),k+=q.argPackAdvance}return c=new(c.bind.apply(c,a)),ct(c)}}var li={},Ar=[null,[],[]];ue=r.InternalError=ee("InternalError");for(var ci=Array(256),$t=0;256>$t;++$t)ci[$t]=String.fromCharCode($t);Le=ci,Me=r.BindingError=ee("BindingError"),lt.prototype.isAliasOf=function(s){if(!(this instanceof lt&&s instanceof lt))return!1;var a=this.ea.ha.fa,c=this.ea.ga,y=s.ea.ha.fa;for(s=s.ea.ga;a.na;)c=a.ta(c),a=a.na;for(;y.na;)s=y.ta(s),y=y.na;return a===y&&c===s},lt.prototype.clone=function(){if(this.ea.ga||cn(this),this.ea.ra)return this.ea.count.value+=1,this;var s=It,a=Object,c=a.create,y=Object.getPrototypeOf(this),k=this.ea;return s=s(c.call(a,y,{ea:{value:{count:k.count,pa:k.pa,ra:k.ra,ga:k.ga,ha:k.ha,ka:k.ka,ma:k.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},lt.prototype.delete=function(){this.ea.ga||cn(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),Zn(this),Jn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},lt.prototype.isDeleted=function(){return!this.ea.ga},lt.prototype.deleteLater=function(){return this.ea.ga||cn(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),wt.push(this),wt.length===1&&Et&&Et(dn),this.ea.pa=!0,this},rt.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},rt.prototype.Ga=function(s){this.la&&this.la(s)},rt.prototype.argPackAdvance=8,rt.prototype.readValueFromPointer=ze,rt.prototype.deleteObject=function(s){s!==null&&s.delete()},rt.prototype.fromWireType=function(s){function a(){return this.wa?Ct(this.fa.qa,{ha:this.Sa,ga:c,ma:this,ka:s}):Ct(this.fa.qa,{ha:this,ga:s})}var c=this.Pa(s);if(!c)return this.Ga(s),null;var y=wr(this.fa,c);if(y!==void 0)return y.ea.count.value===0?(y.ea.ga=c,y.ea.ka=s,y.clone()):(y=y.clone(),this.Ga(s),y);if(y=this.fa.Oa(c),y=Qn[y],!y)return a.call(this);y=this.va?y.Ja:y.pointerType;var k=ti(c,this.fa,y.fa);return k===null?a.call(this):this.wa?Ct(y.fa.qa,{ha:y,ga:k,ma:this,ka:s}):Ct(y.fa.qa,{ha:y,ga:k})},r.getInheritedInstanceCount=function(){return Object.keys(bt).length},r.getLiveInheritedInstances=function(){var s=[],a;for(a in bt)bt.hasOwnProperty(a)&&s.push(bt[a]);return s},r.flushPendingDeletes=dn,r.setDelayFunction=function(s){Et=s,wt.length&&Et&&Et(dn)},ii=r.UnboundTypeError=ee("UnboundTypeError"),r.count_emval_handles=function(){for(var s=0,a=5;a<tt.length;++a)tt[a]!==void 0&&++s;return s},r.get_first_emval=function(){for(var s=5;s<tt.length;++s)if(tt[s]!==void 0)return tt[s];return null};var Cr={r:function(s){var a=pe[s];delete pe[s];var c=a.elements,y=c.length,k=c.map(function(j){return j.Aa}).concat(c.map(function(j){return j.Ea})),L=a.sa,q=a.la;de([s],k,function(j){return c.forEach(function(z,Z){var J=j[Z],ie=z.ya,Se=z.za,De=j[Z+y],_e=z.Da,je=z.Fa;z.read=Ue=>J.fromWireType(ie(Se,Ue)),z.write=(Ue,dt)=>{var Ye=[];_e(je,Ue,De.toWireType(Ye,dt)),Ee(Ye)}}),[{name:a.name,fromWireType:function(z){for(var Z=Array(y),J=0;J<y;++J)Z[J]=c[J].read(z);return q(z),Z},toWireType:function(z,Z){if(y!==Z.length)throw new TypeError("Incorrect number of tuple elements for "+a.name+": expected="+y+", actual="+Z.length);for(var J=L(),ie=0;ie<y;++ie)c[ie].write(J,Z[ie]);return z!==null&&z.push(q,J),J},argPackAdvance:8,readValueFromPointer:ze,ja:q}]})},u:function(s){var a=Ce[s];delete Ce[s];var c=a.sa,y=a.la,k=a.Ha,L=k.map(function(q){return q.Aa}).concat(k.map(function(q){return q.Ea}));de([s],L,function(q){var j={};return k.forEach(function(z,Z){var J=q[Z],ie=z.ya,Se=z.za,De=q[Z+k.length],_e=z.Da,je=z.Fa;j[z.Na]={read:function(Ue){return J.fromWireType(ie(Se,Ue))},write:function(Ue,dt){var Ye=[];_e(je,Ue,De.toWireType(Ye,dt)),Ee(Ye)}}}),[{name:a.name,fromWireType:function(z){var Z={},J;for(J in j)Z[J]=j[J].read(z);return y(z),Z},toWireType:function(z,Z){for(var J in j)if(!(J in Z))throw new TypeError('Missing field:  "'+J+'"');var ie=c();for(J in j)j[J].write(ie,Z[J]);return z!==null&&z.push(y,ie),ie},argPackAdvance:8,readValueFromPointer:ze,ja:y}]})},z:function(){},F:function(s,a,c,y,k){var L=me(c);a=be(a),nt(s,{name:a,fromWireType:function(q){return!!q},toWireType:function(q,j){return j?y:k},argPackAdvance:8,readValueFromPointer:function(q){if(c===1)var j=fe;else if(c===2)j=we;else if(c===4)j=le;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(j[q>>L])},ja:null})},l:function(s,a,c,y,k,L,q,j,z,Z,J,ie,Se){J=be(J),L=Ve(k,L),j&&(j=Ve(q,j)),Z&&(Z=Ve(z,Z)),Se=Ve(ie,Se);var De=U(J);fn(De,function(){Dt("Cannot construct "+J+" due to unbound types",[y])}),de([s,a,c],y?[y]:[],function(_e){if(_e=_e[0],y)var je=_e.fa,Ue=je.qa;else Ue=lt.prototype;_e=W(De,function(){if(Object.getPrototypeOf(this)!==dt)throw new Me("Use 'new' to construct "+J);if(Ye.oa===void 0)throw new Me(J+" has no accessible constructor");var fi=Ye.oa[arguments.length];if(fi===void 0)throw new Me("Tried to invoke ctor of "+J+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ye.oa).toString()+") parameters instead!");return fi.apply(this,arguments)});var dt=Object.create(Ue,{constructor:{value:_e}});_e.prototype=dt;var Ye=new yr(J,_e,dt,Se,je,L,j,Z);je=new rt(J,Ye,!0,!1),Ue=new rt(J+"*",Ye,!1,!1);var di=new rt(J+" const*",Ye,!1,!0);return Qn[s]={pointerType:Ue,Ja:di},ni(De,_e),[je,Ue,di]})},i:function(s,a,c,y,k,L){0<a||ae(void 0);var q=hn(a,c);k=Ve(y,k),de([],[s],function(j){j=j[0];var z="constructor "+j.name;if(j.fa.oa===void 0&&(j.fa.oa=[]),j.fa.oa[a-1]!==void 0)throw new Me("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+j.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return j.fa.oa[a-1]=()=>{Dt("Cannot construct "+j.name+" due to unbound types",q)},de([],q,function(Z){return Z.splice(1,0,null),j.fa.oa[a-1]=gn(z,Z,null,k,L),[]}),[]})},a:function(s,a,c,y,k,L,q,j){var z=hn(c,y);a=be(a),L=Ve(k,L),de([],[s],function(Z){function J(){Dt("Cannot call "+ie+" due to unbound types",z)}Z=Z[0];var ie=Z.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),j&&Z.fa.Ta.push(a);var Se=Z.fa.qa,De=Se[a];return De===void 0||De.ia===void 0&&De.className!==Z.name&&De.ua===c-2?(J.ua=c-2,J.className=Z.name,Se[a]=J):(ei(Se,a,ie),Se[a].ia[c-2]=J),de([],z,function(_e){return _e=gn(ie,_e,Z,L,q),Se[a].ia===void 0?(_e.ua=c-2,Se[a]=_e):Se[a].ia[c-2]=_e,[]}),[]})},I:function(s,a,c){s=be(s),de([],[a],function(y){return y=y[0],r[s]=y.fromWireType(c),[]})},E:function(s,a){a=be(a),nt(s,{name:a,fromWireType:function(c){var y=yn(c);return oi(c),y},toWireType:function(c,y){return ct(y)},argPackAdvance:8,readValueFromPointer:ze,ja:null})},h:function(s,a,c,y){function k(){}c=me(c),a=be(a),k.values={},nt(s,{name:a,constructor:k,fromWireType:function(L){return this.constructor.values[L]},toWireType:function(L,q){return q.value},argPackAdvance:8,readValueFromPointer:Sr(a,c,y),ja:null}),fn(a,k)},k:function(s,a,c){var y=Pt(s,"enum");a=be(a),s=y.constructor,y=Object.create(y.constructor.prototype,{value:{value:c},constructor:{value:W(y.name+"_"+a,function(){})}}),s.values[c]=y,s[a]=y},q:function(s,a,c){c=me(c),a=be(a),nt(s,{name:a,fromWireType:function(y){return y},toWireType:function(y,k){return k},argPackAdvance:8,readValueFromPointer:_r(a,c),ja:null})},f:function(s,a,c,y,k,L){var q=hn(a,c);s=be(s),k=Ve(y,k),fn(s,function(){Dt("Cannot call "+s+" due to unbound types",q)},a-1),de([],q,function(j){return j=[j[0],null].concat(j.slice(1)),ni(s,gn(s,j,null,k,L),a-1),[]})},e:function(s,a,c,y,k){a=be(a),k===-1&&(k=4294967295),k=me(c);var L=j=>j;if(y===0){var q=32-8*c;L=j=>j<<q>>>q}c=a.includes("unsigned")?function(j,z){return z>>>0}:function(j,z){return z},nt(s,{name:a,fromWireType:L,toWireType:c,argPackAdvance:8,readValueFromPointer:Tr(a,k,y!==0),ja:null})},b:function(s,a,c){function y(L){L>>=2;var q=xe;return new k(ve,q[L+1],q[L])}var k=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=be(c),nt(s,{name:c,fromWireType:y,argPackAdvance:8,readValueFromPointer:y},{Qa:!0})},p:function(s,a){a=be(a);var c=a==="std::string";nt(s,{name:a,fromWireType:function(y){var k=xe[y>>2];if(c)for(var L=y+4,q=0;q<=k;++q){var j=y+4+q;if(q==k||oe[j]==0){if(L=L?E(oe,L,j-L):"",z===void 0)var z=L;else z+=String.fromCharCode(0),z+=L;L=j+1}}else{for(z=Array(k),q=0;q<k;++q)z[q]=String.fromCharCode(oe[y+4+q]);z=z.join("")}return ot(y),z},toWireType:function(y,k){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var L=typeof k=="string";L||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int8Array||ye("Cannot pass non-string to std::string");var q=(c&&L?()=>{for(var Z=0,J=0;J<k.length;++J){var ie=k.charCodeAt(J);55296<=ie&&57343>=ie&&(ie=65536+((ie&1023)<<10)|k.charCodeAt(++J)&1023),127>=ie?++Z:Z=2047>=ie?Z+2:65535>=ie?Z+3:Z+4}return Z}:()=>k.length)(),j=wn(4+q+1);if(xe[j>>2]=q,c&&L)g(k,j+4,q+1);else if(L)for(L=0;L<q;++L){var z=k.charCodeAt(L);255<z&&(ot(j),ye("String has UTF-16 code units that do not fit in 8 bits")),oe[j+4+L]=z}else for(L=0;L<q;++L)oe[j+4+L]=k[L];return y!==null&&y.push(ot,j),j},argPackAdvance:8,readValueFromPointer:ze,ja:function(y){ot(y)}})},m:function(s,a,c){if(c=be(c),a===2)var y=P,k=ne,L=te,q=()=>Re,j=1;else a===4&&(y=re,k=Y,L=ge,q=()=>xe,j=2);nt(s,{name:c,fromWireType:function(z){for(var Z=xe[z>>2],J=q(),ie,Se=z+4,De=0;De<=Z;++De){var _e=z+4+De*a;(De==Z||J[_e>>j]==0)&&(Se=y(Se,_e-Se),ie===void 0?ie=Se:(ie+=String.fromCharCode(0),ie+=Se),Se=_e+a)}return ot(z),ie},toWireType:function(z,Z){typeof Z!="string"&&ye("Cannot pass non-string to C++ string type "+c);var J=L(Z),ie=wn(4+J+a);return xe[ie>>2]=J>>j,k(Z,ie+4,J+a),z!==null&&z.push(ot,ie),ie},argPackAdvance:8,readValueFromPointer:ze,ja:function(z){ot(z)}})},t:function(s,a,c,y,k,L){pe[s]={name:be(a),sa:Ve(c,y),la:Ve(k,L),elements:[]}},s:function(s,a,c,y,k,L,q,j,z){pe[s].elements.push({Aa:a,ya:Ve(c,y),za:k,Ea:L,Da:Ve(q,j),Fa:z})},v:function(s,a,c,y,k,L){Ce[s]={name:be(a),sa:Ve(c,y),la:Ve(k,L),Ha:[]}},j:function(s,a,c,y,k,L,q,j,z,Z){Ce[s].Ha.push({Na:be(a),Aa:c,ya:Ve(y,k),za:L,Ea:q,Da:Ve(j,z),Fa:Z})},G:function(s,a){a=be(a),nt(s,{Ra:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,a,c,y){s=En[s],a=yn(a),c=In(c),s(a,c,null,y)},J:oi,x:function(s){return s===0?ct(ai()):(s=In(s),ct(ai()[s]))},c:function(s,a){var c=kr(s,a),y=c[0];a=y.name+"_$"+c.slice(1).map(function(q){return q.name}).join("_")+"$";var k=si[a];if(k!==void 0)return k;var L=Array(s-1);return k=Nr((q,j,z,Z)=>{for(var J=0,ie=0;ie<s-1;++ie)L[ie]=c[ie+1].readValueFromPointer(Z+J),J+=c[ie+1].argPackAdvance;for(q=q[j].apply(q,L),ie=0;ie<s-1;++ie)c[ie+1].Ka&&c[ie+1].Ka(L[ie]);if(!y.Ra)return y.toWireType(z,q)}),si[a]=k},n:function(s){4<s&&(tt[s].Ca+=1)},w:function(s,a,c,y){s=yn(s);var k=li[a];return k||(k=xr(a),li[a]=k),k(s,c,y)},K:function(){return ct([])},D:function(s){return ct(In(s))},H:function(s,a){return s=Pt(s,"_emval_take_value"),s=s.readValueFromPointer(a),ct(s)},g:function(){ae("")},B:function(s){var a=oe.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var y=a*(1+.2/c);y=Math.min(y,s+100663296),y=Math.max(s,y),0<y%65536&&(y+=65536-y%65536);e:{try{O.grow(Math.min(2147483648,y)-ve.byteLength+65535>>>16),Fe();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,a,c,y){for(var k=0,L=0;L<c;L++){var q=le[a>>2],j=le[a+4>>2];a+=8;for(var z=0;z<j;z++){var Z=oe[q+z],J=Ar[s];Z===0||Z===10?((s===1?B:F)(E(J,0)),J.length=0):J.push(Z)}k+=j}return le[y>>2]=k,0},A:function(){}};(function(){function s(k){r.asm=k.exports,O=r.asm.L,Fe(),K=r.asm._,u.unshift(r.asm.M),V--,r.monitorRunDependencies&&r.monitorRunDependencies(V),V==0&&G&&(k=G,G=null,k())}function a(k){s(k.instance)}function c(k){return Ae().then(function(L){return WebAssembly.instantiate(L,y)}).then(function(L){return L}).then(k,function(L){F("failed to asynchronously prepare wasm: "+L),ae(L)})}var y={a:Cr};if(V++,r.monitorRunDependencies&&r.monitorRunDependencies(V),r.instantiateWasm)try{return r.instantiateWasm(y,s)}catch(k){return F("Module.instantiateWasm callback failed with error: "+k),!1}return function(){return Q||typeof WebAssembly.instantiateStreaming!="function"||ce()||se.startsWith("file://")||typeof fetch!="function"?c(a):fetch(se,{credentials:"same-origin"}).then(function(k){return WebAssembly.instantiateStreaming(k,y).then(a,function(L){return F("wasm streaming compile failed: "+L),F("falling back to ArrayBuffer instantiation"),c(a)})})}().catch(v),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var ot=r._free=function(){return(ot=r._free=r.asm.$).apply(null,arguments)},wn=r._malloc=function(){return(wn=r._malloc=r.asm.aa).apply(null,arguments)},ui=r.___getTypeName=function(){return(ui=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Lt;G=function s(){Lt||bn(),Lt||(G=s)};function bn(){function s(){if(!Lt&&(Lt=!0,r.calledRun=!0,!h)){if(Te(u),f(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var a=r.postRun.shift();w.unshift(a)}Te(w)}}if(!(0<V)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)X();Te(d),0<V||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),s()},1)):s())}}if(r.run=bn,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return bn(),o.ready}})();i.exports=t})(Vi);var Hr=Vi.exports;const Wr=Gn(Hr),Gr="/assets/pathkit-1356ccfa.wasm";let Je=null,Yt="",Zt="",Jt="",Qt="";async function ji(){await $.scene.local.deleteItems([Qt,Yt,Zt,Jt]),Yt="",Zt="",Qt="",Jt="",await $.popover.close(I.POLYTOOLID)}async function Ui(){if(!Je)return;const[i,e]=Je;e(),Je=null,ji()}async function Hi(){if(!Je)return;const[i,e]=Je,t=i(n=>{n.visible=!1,n.metadata[`${I.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&$.scene.items.addItems([t]),e(),Je=null,ji()}async function qr(i,e){if(!e.transformer)if(Je)if(e.target&&(e.target.id===Yt||e.target.id===Zt))Hi();else if(e.target&&(e.target.id===Qt||e.target.id===Jt))Ui();else{const[t]=Je;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Kt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Wn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Je=await $.interaction.startItemInteraction(n);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Kt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await $.scene.local.addItems([t,o,r,l]),Yt=t.id,Zt=o.id,Qt=l.id,Jt=r.id,await $.popover.open({id:I.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function zr(i,e){if(!Je||e.transformer)return;const[t]=Je,n=Math.round(R.gridDpi/R.gridSnap),o=Math.round(e.pointerPosition.x/R.gridDpi)*R.gridDpi,r=Math.round(e.pointerPosition.y/R.gridDpi)*R.gridDpi,l=Math.abs(o-e.pointerPosition.x),f=Math.abs(r-e.pointerPosition.y);let v,m;l<=n?v=o:v=e.pointerPosition.x,f<=n?m=r:m=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=R.snap?{x:v,y:m}:e.pointerPosition})}function Kr(i,e){Je&&(e.key=="Escape"?Ui():e.key=="Enter"&&Hi())}const Tn={onToolClick:qr,onToolMove:zr,onKeyDown:Kr};let Qe=null,Ot="",Nt="",en="",tn="";async function Wi(){await $.scene.local.deleteItems([tn,Ot,Nt,en]),Ot="",Nt="",tn="",en="",await $.popover.close(I.LINETOOLID)}async function Gi(){if(!Qe)return;const[i,e]=Qe;e(),Qe=null,await Wi()}async function qi(){if(!Qe)return;const[i,e]=Qe,t=i(n=>{n.visible=!1,n.metadata[`${I.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await $.scene.items.addItems([t]),e(),Qe=null,await Wi()}async function Yr(i,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===Ot||e.target.id===Nt))await qi();else if(e.target&&(e.target.id===tn||e.target.id===en))await Gi();else{const[t]=Qe;t(n=>{n.points.push(e.pointerPosition)}),await $.scene.local.updateItems(n=>n.id==Nt||n.id==Ot,n=>{for(const o of n)o.position=e.pointerPosition})}else{const t=Kt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Wn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Qe=await $.interaction.startItemInteraction(n);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Kt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await $.scene.local.addItems([t,o,r,l]),Ot=t.id,Nt=o.id,tn=l.id,en=r.id,await $.popover.open({id:I.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function Zr(i,e){if(!Qe||e.transformer)return;const[t]=Qe,n=Math.round(R.gridDpi/R.gridSnap),o=Math.round(e.pointerPosition.x/R.gridDpi)*R.gridDpi,r=Math.round(e.pointerPosition.y/R.gridDpi)*R.gridDpi,l=Math.abs(o-e.pointerPosition.x),f=Math.abs(r-e.pointerPosition.y);let v,m;l<=n?v=o:v=e.pointerPosition.x,f<=n?m=r:m=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=R.snap?{x:v,y:m}:e.pointerPosition})}function Jr(i,e){Qe&&(e.key=="Escape"?Gi():e.key=="Enter"&&qi())}const On={onToolClick:Yr,onToolMove:Zr,onKeyDown:Jr};class Bn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Mt(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zi={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,o,r){function l(m,_){if(!o[m]){if(!n[m]){var x=typeof Mt=="function"&&Mt;if(!_&&x)return x(m,!0);if(f)return f(m,!0);throw new Error("Cannot find module '"+m+"'")}_=o[m]={exports:{}},n[m][0].call(_.exports,function(A){var H=n[m][1][A];return l(H||A)},_,_.exports,t,n,o,r)}return o[m].exports}for(var f=typeof Mt=="function"&&Mt,v=0;v<r.length;v++)l(r[v]);return l}({1:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){var N=t("crypto");function M(O,h){h=C(O,h);var p;return(p=h.algorithm!=="passthrough"?N.createHash(h.algorithm):new Q).write===void 0&&(p.write=p.update,p.end=p.update),F(h,p).dispatch(O),p.update||p.end(""),p.digest?p.digest(h.encoding==="buffer"?void 0:h.encoding):(O=p.read(),h.encoding!=="buffer"?O.toString(h.encoding):O)}(o=n.exports=M).sha1=function(O){return M(O)},o.keys=function(O){return M(O,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(O){return M(O,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(O){return M(O,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var S=N.getHashes?N.getHashes().slice():["sha1","md5"],D=(S.push("passthrough"),["buffer","hex","binary","base64"]);function C(O,h){var p={};if(p.algorithm=(h=h||{}).algorithm||"sha1",p.encoding=h.encoding||"hex",p.excludeValues=!!h.excludeValues,p.algorithm=p.algorithm.toLowerCase(),p.encoding=p.encoding.toLowerCase(),p.ignoreUnknown=h.ignoreUnknown===!0,p.respectType=h.respectType!==!1,p.respectFunctionNames=h.respectFunctionNames!==!1,p.respectFunctionProperties=h.respectFunctionProperties!==!1,p.unorderedArrays=h.unorderedArrays===!0,p.unorderedSets=h.unorderedSets!==!1,p.unorderedObjects=h.unorderedObjects!==!1,p.replacer=h.replacer||void 0,p.excludeKeys=h.excludeKeys||void 0,O===void 0)throw new Error("Object argument required.");for(var E=0;E<S.length;++E)S[E].toLowerCase()===p.algorithm.toLowerCase()&&(p.algorithm=S[E]);if(S.indexOf(p.algorithm)===-1)throw new Error('Algorithm "'+p.algorithm+'"  not supported. supported values: '+S.join(", "));if(D.indexOf(p.encoding)===-1&&p.algorithm!=="passthrough")throw new Error('Encoding "'+p.encoding+'"  not supported. supported values: '+D.join(", "));return p}function B(O){if(typeof O=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(O))!=null}function F(O,h,p){p=p||[];function E(g){return h.update?h.update(g,"utf8"):h.write(g,"utf8")}return{dispatch:function(g){return this["_"+((g=O.replacer?O.replacer(g):g)===null?"null":typeof g)](g)},_object:function(g){var T,P=Object.prototype.toString.call(g),ne=/\[object (.*)\]/i.exec(P);if(ne=(ne=ne?ne[1]:"unknown:["+P+"]").toLowerCase(),0<=(P=p.indexOf(g)))return this.dispatch("[CIRCULAR:"+P+"]");if(p.push(g),f!==void 0&&f.isBuffer&&f.isBuffer(g))return E("buffer:"),E(g);if(ne==="object"||ne==="function"||ne==="asyncfunction")return P=Object.keys(g),O.unorderedObjects&&(P=P.sort()),O.respectType===!1||B(g)||P.splice(0,0,"prototype","__proto__","constructor"),O.excludeKeys&&(P=P.filter(function(te){return!O.excludeKeys(te)})),E("object:"+P.length+":"),T=this,P.forEach(function(te){T.dispatch(te),E(":"),O.excludeValues||T.dispatch(g[te]),E(",")});if(!this["_"+ne]){if(O.ignoreUnknown)return E("["+ne+"]");throw new Error('Unknown object type "'+ne+'"')}this["_"+ne](g)},_array:function(g,te){te=te!==void 0?te:O.unorderedArrays!==!1;var P=this;if(E("array:"+g.length+":"),!te||g.length<=1)return g.forEach(function(re){return P.dispatch(re)});var ne=[],te=g.map(function(re){var Y=new Q,ge=p.slice();return F(O,Y,ge).dispatch(re),ne=ne.concat(ge.slice(p.length)),Y.read().toString()});return p=p.concat(ne),te.sort(),this._array(te,!1)},_date:function(g){return E("date:"+g.toJSON())},_symbol:function(g){return E("symbol:"+g.toString())},_error:function(g){return E("error:"+g.toString())},_boolean:function(g){return E("bool:"+g.toString())},_string:function(g){E("string:"+g.length+":"),E(g.toString())},_function:function(g){E("fn:"),B(g)?this.dispatch("[native]"):this.dispatch(g.toString()),O.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(g.name)),O.respectFunctionProperties&&this._object(g)},_number:function(g){return E("number:"+g.toString())},_xml:function(g){return E("xml:"+g.toString())},_null:function(){return E("Null")},_undefined:function(){return E("Undefined")},_regexp:function(g){return E("regex:"+g.toString())},_uint8array:function(g){return E("uint8array:"),this.dispatch(Array.prototype.slice.call(g))},_uint8clampedarray:function(g){return E("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(g))},_int8array:function(g){return E("int8array:"),this.dispatch(Array.prototype.slice.call(g))},_uint16array:function(g){return E("uint16array:"),this.dispatch(Array.prototype.slice.call(g))},_int16array:function(g){return E("int16array:"),this.dispatch(Array.prototype.slice.call(g))},_uint32array:function(g){return E("uint32array:"),this.dispatch(Array.prototype.slice.call(g))},_int32array:function(g){return E("int32array:"),this.dispatch(Array.prototype.slice.call(g))},_float32array:function(g){return E("float32array:"),this.dispatch(Array.prototype.slice.call(g))},_float64array:function(g){return E("float64array:"),this.dispatch(Array.prototype.slice.call(g))},_arraybuffer:function(g){return E("arraybuffer:"),this.dispatch(new Uint8Array(g))},_url:function(g){return E("url:"+g.toString())},_map:function(g){return E("map:"),g=Array.from(g),this._array(g,O.unorderedSets!==!1)},_set:function(g){return E("set:"),g=Array.from(g),this._array(g,O.unorderedSets!==!1)},_file:function(g){return E("file:"),this.dispatch([g.name,g.size,g.type,g.lastModfied])},_blob:function(){if(O.ignoreUnknown)return E("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return E("domwindow")},_bigint:function(g){return E("bigint:"+g.toString())},_process:function(){return E("process")},_timer:function(){return E("timer")},_pipe:function(){return E("pipe")},_tcp:function(){return E("tcp")},_udp:function(){return E("udp")},_tty:function(){return E("tty")},_statwatcher:function(){return E("statwatcher")},_securecontext:function(){return E("securecontext")},_connection:function(){return E("connection")},_zlib:function(){return E("zlib")},_context:function(){return E("context")},_nodescript:function(){return E("nodescript")},_httpparser:function(){return E("httpparser")},_dataview:function(){return E("dataview")},_signal:function(){return E("signal")},_fsevent:function(){return E("fsevent")},_tlswrap:function(){return E("tlswrap")}}}function Q(){return{buf:"",write:function(O){this.buf+=O},end:function(O){this.buf+=O},read:function(){return this.buf}}}o.writeToStream=function(O,h,p){return p===void 0&&(p=h,h={}),F(h=C(O,h),p).dispatch(O)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){(function(N){var M=typeof Uint8Array<"u"?Uint8Array:Array,S="+".charCodeAt(0),D="/".charCodeAt(0),C="0".charCodeAt(0),B="a".charCodeAt(0),F="A".charCodeAt(0),Q="-".charCodeAt(0),O="_".charCodeAt(0);function h(p){return p=p.charCodeAt(0),p===S||p===Q?62:p===D||p===O?63:p<C?-1:p<C+10?p-C+26+26:p<F+26?p-F:p<B+26?p-B+26:void 0}N.toByteArray=function(p){var E,g;if(0<p.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var T=p.length,T=p.charAt(T-2)==="="?2:p.charAt(T-1)==="="?1:0,P=new M(3*p.length/4-T),ne=0<T?p.length-4:p.length,te=0;function re(Y){P[te++]=Y}for(E=0;E<ne;E+=4,0)re((16711680&(g=h(p.charAt(E))<<18|h(p.charAt(E+1))<<12|h(p.charAt(E+2))<<6|h(p.charAt(E+3))))>>16),re((65280&g)>>8),re(255&g);return T==2?re(255&(g=h(p.charAt(E))<<2|h(p.charAt(E+1))>>4)):T==1&&(re((g=h(p.charAt(E))<<10|h(p.charAt(E+1))<<4|h(p.charAt(E+2))>>2)>>8&255),re(255&g)),P},N.fromByteArray=function(p){var E,g,T,P,ne=p.length%3,te="";function re(Y){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Y)}for(E=0,T=p.length-ne;E<T;E+=3)g=(p[E]<<16)+(p[E+1]<<8)+p[E+2],te+=re((P=g)>>18&63)+re(P>>12&63)+re(P>>6&63)+re(63&P);switch(ne){case 1:te=(te+=re((g=p[p.length-1])>>2))+re(g<<4&63)+"==";break;case 2:te=(te=(te+=re((g=(p[p.length-2]<<8)+p[p.length-1])>>10))+re(g>>4&63))+re(g<<2&63)+"="}return te}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,o){(function(r,l,S,v,m,_,x,A,H){var N=t("base64-js"),M=t("ieee754");function S(d,u,w){if(!(this instanceof S))return new S(d,u,w);var X,V,G,ae,ce=typeof d;if(u==="base64"&&ce=="string")for(d=(ae=d).trim?ae.trim():ae.replace(/^\s+|\s+$/g,"");d.length%4!=0;)d+="=";if(ce=="number")X=ve(d);else if(ce=="string")X=S.byteLength(d,u);else{if(ce!="object")throw new Error("First argument needs to be a number, array or string.");X=ve(d.length)}if(S._useTypedArrays?V=S._augment(new Uint8Array(X)):((V=this).length=X,V._isBuffer=!0),S._useTypedArrays&&typeof d.byteLength=="number")V._set(d);else if(fe(ae=d)||S.isBuffer(ae)||ae&&typeof ae=="object"&&typeof ae.length=="number")for(G=0;G<X;G++)S.isBuffer(d)?V[G]=d.readUInt8(G):V[G]=d[G];else if(ce=="string")V.write(d,0,u);else if(ce=="number"&&!S._useTypedArrays&&!w)for(G=0;G<X;G++)V[G]=0;return V}function D(d,u,w,X){return S._charsWritten=le(function(V){for(var G=[],ae=0;ae<V.length;ae++)G.push(255&V.charCodeAt(ae));return G}(u),d,w,X)}function C(d,u,w,X){return S._charsWritten=le(function(V){for(var G,ae,ce=[],se=0;se<V.length;se++)ae=V.charCodeAt(se),G=ae>>8,ae=ae%256,ce.push(ae),ce.push(G);return ce}(u),d,w,X)}function B(d,u,w){var X="";w=Math.min(d.length,w);for(var V=u;V<w;V++)X+=String.fromCharCode(d[V]);return X}function F(d,u,w,G){G||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+1<d.length,"Trying to read beyond buffer length"));var V,G=d.length;if(!(G<=u))return w?(V=d[u],u+1<G&&(V|=d[u+1]<<8)):(V=d[u]<<8,u+1<G&&(V|=d[u+1])),V}function Q(d,u,w,G){G||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+3<d.length,"Trying to read beyond buffer length"));var V,G=d.length;if(!(G<=u))return w?(u+2<G&&(V=d[u+2]<<16),u+1<G&&(V|=d[u+1]<<8),V|=d[u],u+3<G&&(V+=d[u+3]<<24>>>0)):(u+1<G&&(V=d[u+1]<<16),u+2<G&&(V|=d[u+2]<<8),u+3<G&&(V|=d[u+3]),V+=d[u]<<24>>>0),V}function O(d,u,w,X){if(X||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+1<d.length,"Trying to read beyond buffer length")),!(d.length<=u))return X=F(d,u,w,!0),32768&X?-1*(65535-X+1):X}function h(d,u,w,X){if(X||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+3<d.length,"Trying to read beyond buffer length")),!(d.length<=u))return X=Q(d,u,w,!0),2147483648&X?-1*(4294967295-X+1):X}function p(d,u,w,X){return X||(K(typeof w=="boolean","missing or invalid endian"),K(u+3<d.length,"Trying to read beyond buffer length")),M.read(d,u,w,23,4)}function E(d,u,w,X){return X||(K(typeof w=="boolean","missing or invalid endian"),K(u+7<d.length,"Trying to read beyond buffer length")),M.read(d,u,w,52,8)}function g(d,u,w,X,V){if(V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+1<d.length,"trying to write beyond buffer length"),Ke(u,65535)),V=d.length,!(V<=w))for(var G=0,ae=Math.min(V-w,2);G<ae;G++)d[w+G]=(u&255<<8*(X?G:1-G))>>>8*(X?G:1-G)}function T(d,u,w,X,V){if(V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"trying to write beyond buffer length"),Ke(u,4294967295)),V=d.length,!(V<=w))for(var G=0,ae=Math.min(V-w,4);G<ae;G++)d[w+G]=u>>>8*(X?G:3-G)&255}function P(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+1<d.length,"Trying to write beyond buffer length"),qe(u,32767,-32768)),d.length<=w||g(d,0<=u?u:65535+u+1,w,X,V)}function ne(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"Trying to write beyond buffer length"),qe(u,2147483647,-2147483648)),d.length<=w||T(d,0<=u?u:4294967295+u+1,w,X,V)}function te(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"Trying to write beyond buffer length"),Fe(u,34028234663852886e22,-34028234663852886e22)),d.length<=w||M.write(d,u,w,X,23,4)}function re(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+7<d.length,"Trying to write beyond buffer length"),Fe(u,17976931348623157e292,-17976931348623157e292)),d.length<=w||M.write(d,u,w,X,52,8)}o.Buffer=S,o.SlowBuffer=S,o.INSPECT_MAX_BYTES=50,S.poolSize=8192,S._useTypedArrays=function(){try{var d=new ArrayBuffer(0),u=new Uint8Array(d);return u.foo=function(){return 42},u.foo()===42&&typeof u.subarray=="function"}catch{return!1}}(),S.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.isBuffer=function(d){return!(d==null||!d._isBuffer)},S.byteLength=function(d,u){var w;switch(d+="",u||"utf8"){case"hex":w=d.length/2;break;case"utf8":case"utf-8":w=we(d).length;break;case"ascii":case"binary":case"raw":w=d.length;break;case"base64":w=Re(d).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":w=2*d.length;break;default:throw new Error("Unknown encoding")}return w},S.concat=function(d,u){if(K(fe(d),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),d.length===0)return new S(0);if(d.length===1)return d[0];if(typeof u!="number")for(V=u=0;V<d.length;V++)u+=d[V].length;for(var w=new S(u),X=0,V=0;V<d.length;V++){var G=d[V];G.copy(w,X),X+=G.length}return w},S.prototype.write=function(d,u,w,X){isFinite(u)?isFinite(w)||(X=w,w=void 0):(se=X,X=u,u=w,w=se),u=Number(u)||0;var V,G,ae,ce,se=this.length-u;switch((!w||se<(w=Number(w)))&&(w=se),X=String(X||"utf8").toLowerCase()){case"hex":V=function(Ie,Oe,Ae,Te){Ae=Number(Ae)||0;var pe=Ie.length-Ae;(!Te||pe<(Te=Number(Te)))&&(Te=pe),K((pe=Oe.length)%2==0,"Invalid hex string"),pe/2<Te&&(Te=pe/2);for(var Ee=0;Ee<Te;Ee++){var ze=parseInt(Oe.substr(2*Ee,2),16);K(!isNaN(ze),"Invalid hex string"),Ie[Ae+Ee]=ze}return S._charsWritten=2*Ee,Ee}(this,d,u,w);break;case"utf8":case"utf-8":G=this,ae=u,ce=w,V=S._charsWritten=le(we(d),G,ae,ce);break;case"ascii":case"binary":V=D(this,d,u,w);break;case"base64":G=this,ae=u,ce=w,V=S._charsWritten=le(Re(d),G,ae,ce);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":V=C(this,d,u,w);break;default:throw new Error("Unknown encoding")}return V},S.prototype.toString=function(d,u,w){var X,V,G,ae,ce=this;if(d=String(d||"utf8").toLowerCase(),u=Number(u)||0,(w=w!==void 0?Number(w):ce.length)===u)return"";switch(d){case"hex":X=function(se,Ie,Oe){var Ae=se.length;(!Ie||Ie<0)&&(Ie=0),(!Oe||Oe<0||Ae<Oe)&&(Oe=Ae);for(var Te="",pe=Ie;pe<Oe;pe++)Te+=oe(se[pe]);return Te}(ce,u,w);break;case"utf8":case"utf-8":X=function(se,Ie,Oe){var Ae="",Te="";Oe=Math.min(se.length,Oe);for(var pe=Ie;pe<Oe;pe++)se[pe]<=127?(Ae+=xe(Te)+String.fromCharCode(se[pe]),Te=""):Te+="%"+se[pe].toString(16);return Ae+xe(Te)}(ce,u,w);break;case"ascii":case"binary":X=B(ce,u,w);break;case"base64":V=ce,ae=w,X=(G=u)===0&&ae===V.length?N.fromByteArray(V):N.fromByteArray(V.slice(G,ae));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":X=function(se,Ie,Oe){for(var Ae=se.slice(Ie,Oe),Te="",pe=0;pe<Ae.length;pe+=2)Te+=String.fromCharCode(Ae[pe]+256*Ae[pe+1]);return Te}(ce,u,w);break;default:throw new Error("Unknown encoding")}return X},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},S.prototype.copy=function(d,u,w,X){if(u=u||0,(X=X||X===0?X:this.length)!==(w=w||0)&&d.length!==0&&this.length!==0){K(w<=X,"sourceEnd < sourceStart"),K(0<=u&&u<d.length,"targetStart out of bounds"),K(0<=w&&w<this.length,"sourceStart out of bounds"),K(0<=X&&X<=this.length,"sourceEnd out of bounds"),X>this.length&&(X=this.length);var V=(X=d.length-u<X-w?d.length-u+w:X)-w;if(V<100||!S._useTypedArrays)for(var G=0;G<V;G++)d[G+u]=this[G+w];else d._set(this.subarray(w,w+V),u)}},S.prototype.slice=function(d,u){var w=this.length;if(d=ge(d,w,0),u=ge(u,w,w),S._useTypedArrays)return S._augment(this.subarray(d,u));for(var X=u-d,V=new S(X,void 0,!0),G=0;G<X;G++)V[G]=this[G+d];return V},S.prototype.get=function(d){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(d)},S.prototype.set=function(d,u){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(d,u)},S.prototype.readUInt8=function(d,u){if(u||(K(d!=null,"missing offset"),K(d<this.length,"Trying to read beyond buffer length")),!(d>=this.length))return this[d]},S.prototype.readUInt16LE=function(d,u){return F(this,d,!0,u)},S.prototype.readUInt16BE=function(d,u){return F(this,d,!1,u)},S.prototype.readUInt32LE=function(d,u){return Q(this,d,!0,u)},S.prototype.readUInt32BE=function(d,u){return Q(this,d,!1,u)},S.prototype.readInt8=function(d,u){if(u||(K(d!=null,"missing offset"),K(d<this.length,"Trying to read beyond buffer length")),!(d>=this.length))return 128&this[d]?-1*(255-this[d]+1):this[d]},S.prototype.readInt16LE=function(d,u){return O(this,d,!0,u)},S.prototype.readInt16BE=function(d,u){return O(this,d,!1,u)},S.prototype.readInt32LE=function(d,u){return h(this,d,!0,u)},S.prototype.readInt32BE=function(d,u){return h(this,d,!1,u)},S.prototype.readFloatLE=function(d,u){return p(this,d,!0,u)},S.prototype.readFloatBE=function(d,u){return p(this,d,!1,u)},S.prototype.readDoubleLE=function(d,u){return E(this,d,!0,u)},S.prototype.readDoubleBE=function(d,u){return E(this,d,!1,u)},S.prototype.writeUInt8=function(d,u,w){w||(K(d!=null,"missing value"),K(u!=null,"missing offset"),K(u<this.length,"trying to write beyond buffer length"),Ke(d,255)),u>=this.length||(this[u]=d)},S.prototype.writeUInt16LE=function(d,u,w){g(this,d,u,!0,w)},S.prototype.writeUInt16BE=function(d,u,w){g(this,d,u,!1,w)},S.prototype.writeUInt32LE=function(d,u,w){T(this,d,u,!0,w)},S.prototype.writeUInt32BE=function(d,u,w){T(this,d,u,!1,w)},S.prototype.writeInt8=function(d,u,w){w||(K(d!=null,"missing value"),K(u!=null,"missing offset"),K(u<this.length,"Trying to write beyond buffer length"),qe(d,127,-128)),u>=this.length||(0<=d?this.writeUInt8(d,u,w):this.writeUInt8(255+d+1,u,w))},S.prototype.writeInt16LE=function(d,u,w){P(this,d,u,!0,w)},S.prototype.writeInt16BE=function(d,u,w){P(this,d,u,!1,w)},S.prototype.writeInt32LE=function(d,u,w){ne(this,d,u,!0,w)},S.prototype.writeInt32BE=function(d,u,w){ne(this,d,u,!1,w)},S.prototype.writeFloatLE=function(d,u,w){te(this,d,u,!0,w)},S.prototype.writeFloatBE=function(d,u,w){te(this,d,u,!1,w)},S.prototype.writeDoubleLE=function(d,u,w){re(this,d,u,!0,w)},S.prototype.writeDoubleBE=function(d,u,w){re(this,d,u,!1,w)},S.prototype.fill=function(d,u,w){if(u=u||0,w=w||this.length,K(typeof(d=typeof(d=d||0)=="string"?d.charCodeAt(0):d)=="number"&&!isNaN(d),"value is not a number"),K(u<=w,"end < start"),w!==u&&this.length!==0){K(0<=u&&u<this.length,"start out of bounds"),K(0<=w&&w<=this.length,"end out of bounds");for(var X=u;X<w;X++)this[X]=d}},S.prototype.inspect=function(){for(var d=[],u=this.length,w=0;w<u;w++)if(d[w]=oe(this[w]),w===o.INSPECT_MAX_BYTES){d[w+1]="...";break}return"<Buffer "+d.join(" ")+">"},S.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(S._useTypedArrays)return new S(this).buffer;for(var d=new Uint8Array(this.length),u=0,w=d.length;u<w;u+=1)d[u]=this[u];return d.buffer};var Y=S.prototype;function ge(d,u,w){return typeof d!="number"?w:u<=(d=~~d)?u:0<=d||0<=(d+=u)?d:0}function ve(d){return(d=~~Math.ceil(+d))<0?0:d}function fe(d){return(Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"})(d)}function oe(d){return d<16?"0"+d.toString(16):d.toString(16)}function we(d){for(var u=[],w=0;w<d.length;w++){var X=d.charCodeAt(w);if(X<=127)u.push(d.charCodeAt(w));else for(var V=w,G=(55296<=X&&X<=57343&&w++,encodeURIComponent(d.slice(V,w+1)).substr(1).split("%")),ae=0;ae<G.length;ae++)u.push(parseInt(G[ae],16))}return u}function Re(d){return N.toByteArray(d)}function le(d,u,w,X){for(var V=0;V<X&&!(V+w>=u.length||V>=d.length);V++)u[V+w]=d[V];return V}function xe(d){try{return decodeURIComponent(d)}catch{return String.fromCharCode(65533)}}function Ke(d,u){K(typeof d=="number","cannot write a non-number as a number"),K(0<=d,"specified a negative value for writing an unsigned value"),K(d<=u,"value is larger than maximum value for type"),K(Math.floor(d)===d,"value has a fractional component")}function qe(d,u,w){K(typeof d=="number","cannot write a non-number as a number"),K(d<=u,"value larger than maximum allowed value"),K(w<=d,"value smaller than minimum allowed value"),K(Math.floor(d)===d,"value has a fractional component")}function Fe(d,u,w){K(typeof d=="number","cannot write a non-number as a number"),K(d<=u,"value larger than maximum allowed value"),K(w<=d,"value smaller than minimum allowed value")}function K(d,u){if(!d)throw new Error(u||"Failed assertion")}S._augment=function(d){return d._isBuffer=!0,d._get=d.get,d._set=d.set,d.get=Y.get,d.set=Y.set,d.write=Y.write,d.toString=Y.toString,d.toLocaleString=Y.toString,d.toJSON=Y.toJSON,d.copy=Y.copy,d.slice=Y.slice,d.readUInt8=Y.readUInt8,d.readUInt16LE=Y.readUInt16LE,d.readUInt16BE=Y.readUInt16BE,d.readUInt32LE=Y.readUInt32LE,d.readUInt32BE=Y.readUInt32BE,d.readInt8=Y.readInt8,d.readInt16LE=Y.readInt16LE,d.readInt16BE=Y.readInt16BE,d.readInt32LE=Y.readInt32LE,d.readInt32BE=Y.readInt32BE,d.readFloatLE=Y.readFloatLE,d.readFloatBE=Y.readFloatBE,d.readDoubleLE=Y.readDoubleLE,d.readDoubleBE=Y.readDoubleBE,d.writeUInt8=Y.writeUInt8,d.writeUInt16LE=Y.writeUInt16LE,d.writeUInt16BE=Y.writeUInt16BE,d.writeUInt32LE=Y.writeUInt32LE,d.writeUInt32BE=Y.writeUInt32BE,d.writeInt8=Y.writeInt8,d.writeInt16LE=Y.writeInt16LE,d.writeInt16BE=Y.writeInt16BE,d.writeInt32LE=Y.writeInt32LE,d.writeInt32BE=Y.writeInt32BE,d.writeFloatLE=Y.writeFloatLE,d.writeFloatBE=Y.writeFloatBE,d.writeDoubleLE=Y.writeDoubleLE,d.writeDoubleBE=Y.writeDoubleBE,d.fill=Y.fill,d.inspect=Y.inspect,d.toArrayBuffer=Y.toArrayBuffer,d}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,o){(function(r,l,N,v,m,_,x,A,H){var N=t("buffer").Buffer,M=4,S=new N(M);S.fill(0),n.exports={hash:function(D,C,B,F){for(var Q=C(function(g,T){g.length%M!=0&&(P=g.length+(M-g.length%M),g=N.concat([g,S],P));for(var P,ne=[],te=T?g.readInt32BE:g.readInt32LE,re=0;re<g.length;re+=M)ne.push(te.call(g,re));return ne}(D=N.isBuffer(D)?D:new N(D),F),8*D.length),C=F,O=new N(B),h=C?O.writeInt32BE:O.writeInt32LE,p=0;p<Q.length;p++)h.call(O,Q[p],4*p,!0);return O}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,o){(function(r,l,N,v,m,_,x,A,H){var N=t("buffer").Buffer,M=t("./sha"),S=t("./sha256"),D=t("./rng"),C={sha1:M,sha256:S,md5:t("./md5")},B=64,F=new N(B);function Q(g,T){var P=C[g=g||"sha1"],ne=[];return P||O("algorithm:",g,"is not yet supported"),{update:function(te){return N.isBuffer(te)||(te=new N(te)),ne.push(te),te.length,this},digest:function(te){var re=N.concat(ne),re=T?function(Y,ge,ve){N.isBuffer(ge)||(ge=new N(ge)),N.isBuffer(ve)||(ve=new N(ve)),ge.length>B?ge=Y(ge):ge.length<B&&(ge=N.concat([ge,F],B));for(var fe=new N(B),oe=new N(B),we=0;we<B;we++)fe[we]=54^ge[we],oe[we]=92^ge[we];return ve=Y(N.concat([fe,ve])),Y(N.concat([oe,ve]))}(P,T,re):P(re);return ne=null,te?re.toString(te):re}}}function O(){var g=[].slice.call(arguments).join(" ");throw new Error([g,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}F.fill(0),o.createHash=function(g){return Q(g)},o.createHmac=Q,o.randomBytes=function(g,T){if(!T||!T.call)return new N(D(g));try{T.call(this,void 0,new N(D(g)))}catch(P){T(P)}};var h,p=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],E=function(g){o[g]=function(){O("sorry,",g,"is not implemented yet")}};for(h in p)E(p[h])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){var N=t("./helpers");function M(O,h){O[h>>5]|=128<<h%32,O[14+(h+64>>>9<<4)]=h;for(var p=1732584193,E=-271733879,g=-1732584194,T=271733878,P=0;P<O.length;P+=16){var ne=p,te=E,re=g,Y=T,p=D(p,E,g,T,O[P+0],7,-680876936),T=D(T,p,E,g,O[P+1],12,-389564586),g=D(g,T,p,E,O[P+2],17,606105819),E=D(E,g,T,p,O[P+3],22,-1044525330);p=D(p,E,g,T,O[P+4],7,-176418897),T=D(T,p,E,g,O[P+5],12,1200080426),g=D(g,T,p,E,O[P+6],17,-1473231341),E=D(E,g,T,p,O[P+7],22,-45705983),p=D(p,E,g,T,O[P+8],7,1770035416),T=D(T,p,E,g,O[P+9],12,-1958414417),g=D(g,T,p,E,O[P+10],17,-42063),E=D(E,g,T,p,O[P+11],22,-1990404162),p=D(p,E,g,T,O[P+12],7,1804603682),T=D(T,p,E,g,O[P+13],12,-40341101),g=D(g,T,p,E,O[P+14],17,-1502002290),p=C(p,E=D(E,g,T,p,O[P+15],22,1236535329),g,T,O[P+1],5,-165796510),T=C(T,p,E,g,O[P+6],9,-1069501632),g=C(g,T,p,E,O[P+11],14,643717713),E=C(E,g,T,p,O[P+0],20,-373897302),p=C(p,E,g,T,O[P+5],5,-701558691),T=C(T,p,E,g,O[P+10],9,38016083),g=C(g,T,p,E,O[P+15],14,-660478335),E=C(E,g,T,p,O[P+4],20,-405537848),p=C(p,E,g,T,O[P+9],5,568446438),T=C(T,p,E,g,O[P+14],9,-1019803690),g=C(g,T,p,E,O[P+3],14,-187363961),E=C(E,g,T,p,O[P+8],20,1163531501),p=C(p,E,g,T,O[P+13],5,-1444681467),T=C(T,p,E,g,O[P+2],9,-51403784),g=C(g,T,p,E,O[P+7],14,1735328473),p=B(p,E=C(E,g,T,p,O[P+12],20,-1926607734),g,T,O[P+5],4,-378558),T=B(T,p,E,g,O[P+8],11,-2022574463),g=B(g,T,p,E,O[P+11],16,1839030562),E=B(E,g,T,p,O[P+14],23,-35309556),p=B(p,E,g,T,O[P+1],4,-1530992060),T=B(T,p,E,g,O[P+4],11,1272893353),g=B(g,T,p,E,O[P+7],16,-155497632),E=B(E,g,T,p,O[P+10],23,-1094730640),p=B(p,E,g,T,O[P+13],4,681279174),T=B(T,p,E,g,O[P+0],11,-358537222),g=B(g,T,p,E,O[P+3],16,-722521979),E=B(E,g,T,p,O[P+6],23,76029189),p=B(p,E,g,T,O[P+9],4,-640364487),T=B(T,p,E,g,O[P+12],11,-421815835),g=B(g,T,p,E,O[P+15],16,530742520),p=F(p,E=B(E,g,T,p,O[P+2],23,-995338651),g,T,O[P+0],6,-198630844),T=F(T,p,E,g,O[P+7],10,1126891415),g=F(g,T,p,E,O[P+14],15,-1416354905),E=F(E,g,T,p,O[P+5],21,-57434055),p=F(p,E,g,T,O[P+12],6,1700485571),T=F(T,p,E,g,O[P+3],10,-1894986606),g=F(g,T,p,E,O[P+10],15,-1051523),E=F(E,g,T,p,O[P+1],21,-2054922799),p=F(p,E,g,T,O[P+8],6,1873313359),T=F(T,p,E,g,O[P+15],10,-30611744),g=F(g,T,p,E,O[P+6],15,-1560198380),E=F(E,g,T,p,O[P+13],21,1309151649),p=F(p,E,g,T,O[P+4],6,-145523070),T=F(T,p,E,g,O[P+11],10,-1120210379),g=F(g,T,p,E,O[P+2],15,718787259),E=F(E,g,T,p,O[P+9],21,-343485551),p=Q(p,ne),E=Q(E,te),g=Q(g,re),T=Q(T,Y)}return Array(p,E,g,T)}function S(O,h,p,E,g,T){return Q((h=Q(Q(h,O),Q(E,T)))<<g|h>>>32-g,p)}function D(O,h,p,E,g,T,P){return S(h&p|~h&E,O,h,g,T,P)}function C(O,h,p,E,g,T,P){return S(h&E|p&~E,O,h,g,T,P)}function B(O,h,p,E,g,T,P){return S(h^p^E,O,h,g,T,P)}function F(O,h,p,E,g,T,P){return S(p^(h|~E),O,h,g,T,P)}function Q(O,h){var p=(65535&O)+(65535&h);return(O>>16)+(h>>16)+(p>>16)<<16|65535&p}n.exports=function(O){return N.hash(O,M,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){n.exports=function(N){for(var M,S=new Array(N),D=0;D<N;D++)!(3&D)&&(M=4294967296*Math.random()),S[D]=M>>>((3&D)<<3)&255;return S}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){var N=t("./helpers");function M(C,B){C[B>>5]|=128<<24-B%32,C[15+(B+64>>9<<4)]=B;for(var F,Q,O,h=Array(80),p=1732584193,E=-271733879,g=-1732584194,T=271733878,P=-1009589776,ne=0;ne<C.length;ne+=16){for(var te=p,re=E,Y=g,ge=T,ve=P,fe=0;fe<80;fe++){h[fe]=fe<16?C[ne+fe]:D(h[fe-3]^h[fe-8]^h[fe-14]^h[fe-16],1);var oe=S(S(D(p,5),(oe=E,Q=g,O=T,(F=fe)<20?oe&Q|~oe&O:!(F<40)&&F<60?oe&Q|oe&O|Q&O:oe^Q^O)),S(S(P,h[fe]),(F=fe)<20?1518500249:F<40?1859775393:F<60?-1894007588:-899497514)),P=T,T=g,g=D(E,30),E=p,p=oe}p=S(p,te),E=S(E,re),g=S(g,Y),T=S(T,ge),P=S(P,ve)}return Array(p,E,g,T,P)}function S(C,B){var F=(65535&C)+(65535&B);return(C>>16)+(B>>16)+(F>>16)<<16|65535&F}function D(C,B){return C<<B|C>>>32-B}n.exports=function(C){return N.hash(C,M,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){function N(B,F){var Q=(65535&B)+(65535&F);return(B>>16)+(F>>16)+(Q>>16)<<16|65535&Q}function M(B,F){var Q,O=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),h=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),p=new Array(64);B[F>>5]|=128<<24-F%32,B[15+(F+64>>9<<4)]=F;for(var E,g,T=0;T<B.length;T+=16){for(var P=h[0],ne=h[1],te=h[2],re=h[3],Y=h[4],ge=h[5],ve=h[6],fe=h[7],oe=0;oe<64;oe++)p[oe]=oe<16?B[oe+T]:N(N(N((g=p[oe-2],D(g,17)^D(g,19)^C(g,10)),p[oe-7]),(g=p[oe-15],D(g,7)^D(g,18)^C(g,3))),p[oe-16]),Q=N(N(N(N(fe,D(g=Y,6)^D(g,11)^D(g,25)),Y&ge^~Y&ve),O[oe]),p[oe]),E=N(D(E=P,2)^D(E,13)^D(E,22),P&ne^P&te^ne&te),fe=ve,ve=ge,ge=Y,Y=N(re,Q),re=te,te=ne,ne=P,P=N(Q,E);h[0]=N(P,h[0]),h[1]=N(ne,h[1]),h[2]=N(te,h[2]),h[3]=N(re,h[3]),h[4]=N(Y,h[4]),h[5]=N(ge,h[5]),h[6]=N(ve,h[6]),h[7]=N(fe,h[7])}return h}var S=t("./helpers"),D=function(B,F){return B>>>F|B<<32-F},C=function(B,F){return B>>>F};n.exports=function(B){return S.hash(B,M,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){o.read=function(N,M,S,D,T){var B,F,Q=8*T-D-1,O=(1<<Q)-1,h=O>>1,p=-7,E=S?T-1:0,g=S?-1:1,T=N[M+E];for(E+=g,B=T&(1<<-p)-1,T>>=-p,p+=Q;0<p;B=256*B+N[M+E],E+=g,p-=8);for(F=B&(1<<-p)-1,B>>=-p,p+=D;0<p;F=256*F+N[M+E],E+=g,p-=8);if(B===0)B=1-h;else{if(B===O)return F?NaN:1/0*(T?-1:1);F+=Math.pow(2,D),B-=h}return(T?-1:1)*F*Math.pow(2,B-D)},o.write=function(N,M,S,D,C,P){var F,Q,O=8*P-C-1,h=(1<<O)-1,p=h>>1,E=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=D?0:P-1,T=D?1:-1,P=M<0||M===0&&1/M<0?1:0;for(M=Math.abs(M),isNaN(M)||M===1/0?(Q=isNaN(M)?1:0,F=h):(F=Math.floor(Math.log(M)/Math.LN2),M*(D=Math.pow(2,-F))<1&&(F--,D*=2),2<=(M+=1<=F+p?E/D:E*Math.pow(2,1-p))*D&&(F++,D/=2),h<=F+p?(Q=0,F=h):1<=F+p?(Q=(M*D-1)*Math.pow(2,C),F+=p):(Q=M*Math.pow(2,p-1)*Math.pow(2,C),F=0));8<=C;N[S+g]=255&Q,g+=T,Q/=256,C-=8);for(F=F<<C|Q,O+=C;0<O;N[S+g]=255&F,g+=T,F/=256,O-=8);N[S+g-T]|=128*P}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,o){(function(r,l,f,v,m,_,x,A,H){var N,M,S;function D(){}(r=n.exports={}).nextTick=(M=typeof window<"u"&&window.setImmediate,S=typeof window<"u"&&window.postMessage&&window.addEventListener,M?function(C){return window.setImmediate(C)}:S?(N=[],window.addEventListener("message",function(C){var B=C.source;B!==window&&B!==null||C.data!=="process-tick"||(C.stopPropagation(),0<N.length&&N.shift()())},!0),function(C){N.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=D,r.addListener=D,r.once=D,r.off=D,r.removeListener=D,r.removeAllListeners=D,r.emit=D,r.binding=function(C){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(zi);var Qr=zi.exports;const Rt=Gn(Qr);class eo{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Rt(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Rt(e):String(e)]}getValue(e){return this.cache[this.useHash?Rt(e):String(e)]}isCached(e){return(this.useHash?Rt(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Ft(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Ki(i,e){return i.x==e.x&&i.y==e.y}function Bt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function Nn(i,e){return(i%e+e)%e}async function to(){await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${I.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${I.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${I.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${I.EXTENSIONID}/isDoor`]===void 0);await $.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${I.EXTENSIONID}/isDoor`]=!0:delete n.metadata[`${I.EXTENSIONID}/isDoor`]}),e?await nn(i.items):await no(i.items)}})}async function no(i){const e=await $.scene.local.getItems(n=>n.metadata[`${I.EXTENSIONID}/doorId`]!==void 0),t=[];for(let n of e){let o=!1;for(const r of i)n.metadata[`${I.EXTENSIONID}/doorId`]==r.id&&(o=!0);o&&t.push(n.id)}await $.scene.local.deleteItems(t)}async function nn(i){const e=[],t=await $.scene.local.getItems(n=>n.metadata[`${I.EXTENSIONID}/doorId`]!==void 0);for(const n of i){if(!$r(n)||t.some(l=>l.metadata[`${I.EXTENSIONID}/doorId`]===n.id))continue;const o=Xe.fromItem(n),r=[];for(let l=0;l<n.points.length;l++){const f=Xe.fromPosition(n.points[l]);r.push(Xe.decompose(Xe.multiply(o,f)).position)}e.push(Tt().locked(!0).commands(Yi(n.metadata[`${I.EXTENSIONID}/disabled`]===!0)).scale({x:.2,y:.2}).name("Door").position(jt.centroid(r)).metadata({[`${I.EXTENSIONID}/doorId`]:n.id}).build())}e.length>0&&$.scene.local.addItems(e)}async function io(i){const e=await $.scene.local.getItems(t=>t.id===i&&t.metadata[`${I.EXTENSIONID}/doorId`]!==void 0);if(e.length===1){const t=e[0].metadata[`${I.EXTENSIONID}/doorId`],n=R.items.filter(o=>o.id===t);await $.scene.items.updateItems(n,o=>{const r=o[0];r.metadata[`${I.EXTENSIONID}/isVisionLine`]&&r.metadata[`${I.EXTENSIONID}/disabled`]?(delete r.metadata[`${I.EXTENSIONID}/disabled`],delete r.metadata[`${I.EXTENSIONID}/doorOpen`]):r.metadata[`${I.EXTENSIONID}/isVisionLine`]&&(r.metadata[`${I.EXTENSIONID}/disabled`]=!0,r.metadata[`${I.EXTENSIONID}/doorOpen`]=!0)}),await $.player.deselect([i])}}async function ro(){const i=await $.scene.items.getItems(e=>e.metadata[`${I.EXTENSIONID}/isDoor`]===!0);nn(i)}function Yi(i){return i?I.DOOROPEN:I.DOORCLOSED}async function oo(i){i?await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${I.EXTENSIONID}/hasAutohide`],value:void 0}],roles:["GM"]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"}],roles:["GM"]}}],async onClick(e){const t=e.items.every(n=>n.metadata[`${I.EXTENSIONID}/hasAutohide`]===void 0);await $.scene.items.updateItems(e.items,n=>{for(const o of n)t?o.metadata[`${I.EXTENSIONID}/hasAutohide`]=!0:delete o.metadata[`${I.EXTENSIONID}/hasAutohide`]})}}):await $.contextMenu.remove(`${I.EXTENSIONID}/toggle-autohide-menu`)}async function ao(){await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"&&"},{key:["metadata",`${I.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"||"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${I.EXTENSIONID}/hasVision`]===void 0);await $.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${I.EXTENSIONID}/hasVision`]=!0,n.metadata[`${I.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${I.EXTENSIONID}/visionRange`]=I.VISIONDEFAULT)):delete n.metadata[`${I.EXTENSIONID}/hasVision`]})}}),await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${I.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await $.scene.items.getItemAttachments(e);await $.scene.items.updateItems(t,n=>{for(const o of n)e.includes(o.attachedTo)&&(o.metadata[`${I.EXTENSIONID}/hasVision`]&&(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")?delete o.metadata[`${I.EXTENSIONID}/hasVision`]:(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")&&(o.metadata[`${I.EXTENSIONID}/hasVision`]=!0,o.metadata[`${I.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${I.EXTENSIONID}/visionRange`]=I.VISIONDEFAULT)))})}}}),await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${I.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${I.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${I.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${I.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await $.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${I.EXTENSIONID}/isVisionLine`]&&t.metadata[`${I.EXTENSIONID}/disabled`]?delete t.metadata[`${I.EXTENSIONID}/disabled`]:t.metadata[`${I.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${I.EXTENSIONID}/disabled`]=!0)})}}),await $.contextMenu.create({id:`${I.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${I.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${I.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${I.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${I.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${I.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${I.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${I.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await $.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${I.EXTENSIONID}/isVisionLine`]||t.metadata[`${I.ARMINDOID}/isVisionLine`])&&(t.metadata[`${I.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${I.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${I.EXTENSIONID}/oneSided`],delete t.metadata[`${I.ARMINDOID}/oneSided`]):(t.metadata[`${I.EXTENSIONID}/isVisionLine`]||t.metadata[`${I.ARMINDOID}/isVisionLine`])&&(t.metadata[`${I.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${I.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${I.EXTENSIONID}/oneSided`]="right",t.metadata[`${I.ARMINDOID}/oneSided`]="right"):(t.metadata[`${I.EXTENSIONID}/isVisionLine`]||t.metadata[`${I.ARMINDOID}/isVisionLine`])&&(t.metadata[`${I.EXTENSIONID}/oneSided`]="left",t.metadata[`${I.ARMINDOID}/oneSided`]="left")})}}),await $.contextMenu.create({id:`${I.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"}]}}],async onClick(i){i.items.length>0&&await $.scene.items.updateItems(i.items,e=>{for(let t=0;t<e.length;t++)e[t].zIndex=1,e[t].layer="FOG",e[t].disableHit=!0,e[t].locked=!1,e[t].visible=!1,e[t].metadata[`${I.EXTENSIONID}/isBackgroundMap`]=!0})}})}async function so(){await $.tool.create({id:`${I.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await $.tool.activateTool(`${I.EXTENSIONID}/vision-tool`)}})}async function lo(){await $.tool.createMode({id:`${I.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${I.EXTENSIONID}/vision-tool`]}}],onToolClick:Tn.onToolClick,onToolMove:Tn.onToolMove,onKeyDown:Tn.onKeyDown}),await $.tool.createMode({id:`${I.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${I.EXTENSIONID}/vision-tool`]}}],onToolClick:On.onToolClick,onToolMove:On.onToolMove,onKeyDown:On.onKeyDown})}function co(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function uo(i){let e=[];for(const t of i)if(!(!t.points||t.points.length<=1))for(let n=0;n<t.points.length-1;n++){let o,r;const l=Xe.fromItem(t),f=Xe.fromPosition(t.points[n]),v=Xe.fromPosition(t.points[n+1]);o=Xe.decompose(Xe.multiply(l,f)).position,r=Xe.decompose(Xe.multiply(l,v)).position,e.push({startPosition:o,endPosition:r,originalShape:t,oneSided:t.metadata[`${I.EXTENSIONID}/oneSided`]})}return e}function fo(i,e,t,n,o,r){let l=[],f=[t,n];const v=R.players.filter(D=>D.role=="GM"),m=R.metadata[`${I.EXTENSIONID}/quality`]!="accurate",_=e.some(xt);for(const D of e){const C=R.userId===D.createdUserId,B=v.some(h=>h.id==D.createdUserId);if(!C&&R.role!=="GM"&&!B)continue;const F=D.metadata[`${I.EXTENSIONID}/visionRange`],Q=mt.getValue(D.id);if(l.push([]),Q!==void 0&&Ki(Q.player.position,D.position)&&Q.player.metadata[`${I.EXTENSIONID}/visionRange`]===F)continue;let O=1e3*R.gridDpi;F&&(O=R.gridDpi*(F/R.gridScale+.5));for(const h of i){const p=(D.position.x-h.startPosition.x)*(h.endPosition.y-h.startPosition.y)-(D.position.y-h.startPosition.y)*(h.endPosition.x-h.startPosition.x);if(h.oneSided!==void 0&&(h.oneSided=="right"&&p>0||h.oneSided=="left"&&p<0))continue;let E=h.startPosition.x,g=h.startPosition.y,T=h.endPosition.x,P=h.endPosition.y;if(E<o[0]||g<o[1]||E>o[0]+f[0]||g>o[1]+f[1]||T<o[0]||P<o[1]||T>o[0]+f[0]||P>o[1]+f[1])continue;if(m&&(!_||xt(D))){const le=[h.startPosition,h.endPosition],xe=jt.distance(h.startPosition,h.endPosition),qe=Math.floor(xe/(O/3));for(let K=1;K<qe;K++)le.push(jt.lerp(h.startPosition,h.endPosition,K/qe));let Fe=!0;for(const K of le)jt.compare(D.position,K,O)&&(Fe=!1);if(Fe)continue}const ne={x:h.startPosition.x-D.position.x,y:h.startPosition.y-D.position.y},te={x:h.endPosition.x-D.position.x,y:h.endPosition.y-D.position.y};var x={x:0,y:0},A={x:0,y:0},H=0,N=0,M=0,S=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ne.x<0?H=o[0]*r[0]:H=(t+o[0])*r[0],ne.y<0?N=o[1]*r[1]:N=(n+o[1])*r[1],te.x<0?M=o[0]*r[0]:M=(t+o[0])*r[0],te.y<0?S=o[1]*r[1]:S=(n+o[1])*r[1];const re=[],Y=[];if(ne.x!=0){const le=ne.y/ne.x,xe=h.startPosition.y-le*h.startPosition.x;re.push({x:H,y:le*H+xe})}if(ne.y!=0){const le=ne.x/ne.y,xe=le*h.startPosition.y-h.startPosition.x;re.push({x:le*N-xe,y:N})}if(te.x!=0){const le=te.y/te.x,xe=h.endPosition.y-le*h.endPosition.x;Y.push({x:M,y:le*M+xe})}if(te.y!=0){const le=te.x/te.y,xe=le*h.endPosition.y-h.endPosition.x;Y.push({x:le*S-xe,y:S})}re.length==1||Ft(re[0],h.startPosition)<Ft(re[1],h.startPosition)?x=re[0]:x=re[1],Y.length==1||Ft(Y[0],h.endPosition)<Ft(Y[1],h.endPosition)?A=Y[0]:A=Y[1];const ge=[{x:h.startPosition.x,y:h.startPosition.y},x,A,{x:h.endPosition.x,y:h.endPosition.y}],ve=[{x:(t+o[0])*r[0],y:o[1]*r[1]},{x:(t+o[0])*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:o[1]*r[1]}],fe=[0,0];let oe=0;for(const le of[x,A])Bt(le.y,o[1]*r[1])?fe[oe]=0:Bt(le.y,(n+o[1])*r[1])?fe[oe]=2:Bt(le.x,o[0]*r[0])?fe[oe]=3:Bt(le.x,(t+o[0])*r[0])&&(fe[oe]=1),oe++;let we=Math.sign(p);we=we==0?1:-we;const Re=we==1?fe[1]:Nn(fe[1]-1,4);for(let le=fe[0]+(we==1?0:-1);Nn(le,4)!=Re;le+=we)ge.splice(ge.length-2,0,ve[Nn(le,4)]);l[l.length-1].push({pointset:ge,fromShape:h.originalShape})}}return l}var Pe,ut=!1;const mt=new eo(!1);async function po(i){if(ut=!0,Pe||(Pe=await Wr({locateFile:()=>Gr})),!await $.scene.isReady()){mt.invalidate((u,w)=>w.shadowPath.delete()),ut=!1;return}const e=[];for(let u=0;u<=6;u++)e.push(new Bn);e[1].start();const{awaitTimer:t,computeTimer:n,metadata:o,visionShapes:r,tokensWithVision:l,invalidateCache:f}=i.detail;let v=i.detail.size,m=i.detail.offset,_=i.detail.scale,[x,A]=v;if(R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]===!0){const u=await $.scene.items.getItems(X=>X.layer==="MAP"&&qn(X));let w=[];for(let X of u){let V=R.gridDpi/X.grid.dpi,G=X.position.x-V*X.grid.offset.x*X.scale.x,ae=X.position.y-V*X.grid.offset.y*X.scale.y,ce=G+V*X.image.width*X.scale.x,se=ae+V*X.image.height*X.scale.y;w.length?(G<w[0]&&(w[0]=G),ae<w[1]&&(w[1]=ae),ce>w[2]&&(w[2]=ce),se>w[3]&&(w[3]=se)):(w[0]=G,w[1]=ae,w[2]=ce,w[3]=se)}m=[w[0],w[1]],v=[w[2]-w[0],w[3]-w[1]],_=[1,1],[x,A]=v}let N=0,M=0;if(f&&mt.invalidate((u,w)=>w.shadowPath.delete()),n.resume(),!(o[`${I.EXTENSIONID}/visionEnabled`]===!0)||l.length==0){const u=await $.scene.local.getItems(Fn);await $.scene.local.deleteItems(u.map(w=>w.id)),ut=!1;return}const D=uo(r),C=fo(D,l,x,A,m,_);if(C.length==0){ut=!1;return}const B=[];e[1].pause(),e[2].start();const F={};for(let u=0;u<C.length;u++){const w=l[u];let X=mt.getValue(w.id);if(X!==void 0&&Ki(X.player.position,w.position)&&X.player.metadata[`${I.EXTENSIONID}/visionRange`]===w.metadata[`${I.EXTENSIONID}/visionRange`]){F[u]=X.shadowPath.copy(),N++;continue}M++;const V=C[u],G=new Pe.SkOpBuilder,ae=Pe.NewPath().rect(m[0],m[1],v[0],v[1]);G.add(ae,Pe.PathOp.UNION),ae.delete();for(const se of V){const Ie=se.fromShape,Oe=Pe.NewPath();Oe.moveTo(se.pointset[0].x,se.pointset[0].y);for(let Ae=1;Ae<se.pointset.length;Ae++)Oe.lineTo(se.pointset[Ae].x,se.pointset[Ae].y);if(Ie.style.closed!=!1){const Ae=Pe.NewPath();Ae.moveTo(Ie.points[0].x*Ie.scale.x+Ie.position.x,Ie.points[0].y*Ie.scale.y+Ie.position.y);for(let Te=1;Te<Ie.points.length-1;Te++)Ae.lineTo(Ie.points[Te].x*Ie.scale.x+Ie.position.x,Ie.points[Te].y*Ie.scale.y+Ie.position.y);Oe.op(Ae,Pe.PathOp.DIFFERENCE),Ae.delete()}G.add(Oe,Pe.PathOp.DIFFERENCE),Oe.delete()}const ce=G.resolve();if(!ce){console.error("Couldn't compute fog"),ut=!1;return}if(G.delete(),ce!==void 0){ce.simplify(),F[u]=ce;let se=mt.getValue(w.id);se!==void 0&&se.shadowPath.delete(),mt.cacheValue(w.id,{shadowPath:ce.copy(),player:w})}}e[2].pause(),e[3].start();const Q=[],O=Pe.NewPath();for(let u=0;u<l.length;u++){const w=l[u],X=w.metadata[`${I.EXTENSIONID}/visionRange`],V=R.players.filter(ce=>ce.role=="GM"),G=R.userId===l[u].createdUserId,ae=V.some(ce=>ce.id==l[u].createdUserId);if(xt(w)?Q[u]=!0:O.op(F[u],Pe.PathOp.UNION),X){if(!G&&R.role!=="GM"&&!ae)continue;const ce=R.gridDpi*(X/R.gridScale+.5),se=Pe.NewPath().ellipse(w.position.x,w.position.y,ce,ce,0,0,2*Math.PI);F[u]?.op(se,Pe.PathOp.INTERSECT),se.delete();const Ie=R.players.find(Oe=>Oe.id===w.createdUserId);if(Ie&&R.role==="GM"&&!xt(w)){const Oe=vt().strokeColor(Ie.color).fillOpacity(0).position({x:w.position.x,y:w.position.y}).width(ce*2).height(ce*2).shapeType("CIRCLE").metadata({[`${I.EXTENSIONID}/isIndicatorRing`]:!0}).build();B.push(Oe)}}}O.simplify();for(let u=0;u<Q.length;u++)Q[u]===!0&&(F[u].op(O,Pe.PathOp.INTERSECT),F[u].simplify());O.delete(),e[3].pause(),e[4].start();const h=[],p=[],E=R.metadata[`${I.EXTENSIONID}/persistenceEnabled`]===!0,g=R.metadata[`${I.EXTENSIONID}/fowEnabled`]===!0,T=R.metadata[`${I.EXTENSIONID}/playerDoors`]===!0,P=Pe.NewPath(),ne={},te=await $.scene.local.getItems(Fn),re=await $.scene.local.getItems(Fr);g&&P.rect(m[0],m[1],v[0],v[1]);let Y=E&&R.metadata[`${I.EXTENSIONID}/quality`]!="accurate",ge=[],ve;if(Y)if(ge=await $.scene.local.getItems(gt),ve=new Pe.SkOpBuilder,ne.reuse=!0,ge.length===0){const u=Tt().commands([]).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${I.EXTENSIONID}/isVisionFog`]:!0,[`${I.EXTENSIONID}/digest`]:"reuse"}).build();u.zIndex=3,await $.scene.local.addItems([u]),ge=await $.scene.local.getItems(gt)}else{let u=Pe.FromCmds(ge[0].commands);ve.add(u,Pe.PathOp.UNION),u.delete()}const fe=new Pe.SkOpBuilder;let oe=!1;for(const u of Object.keys(F)){const w=F[u],V=new TextEncoder().encode(w.toCmds().toString()),G=await crypto.subtle.digest("SHA-1",V).then(ce=>[...new Uint8Array(ce)].map(se=>se.toString(16).padStart(2,"0")).join(""));te.filter(ce=>gt(ce)&&ce.metadata[`${I.EXTENSIONID}/digest`]===G).length===0?Y?ve.add(w,Pe.PathOp.UNION):h.push({cmds:w.toCmds(),visible:!1,zIndex:3,playerId:l[u].id,digest:G}):ne[G]=!0,g&&(P.op(w,Pe.PathOp.DIFFERENCE),R.role==="GM"&&(oe=!0,fe.add(w,Pe.PathOp.UNION))),w.delete()}const we=R.metadata[`${I.EXTENSIONID}/sceneId`];if(Y){const u=ve.resolve();u.setFillType(Pe.FillType.EVENODD);const w=u.toCmds();await $.scene.local.updateItems([ge[0].id],X=>{X[0].commands=w});try{localStorage.setItem(`${I.EXTENSIONID}/fogCache/${R.userId}/${we}`,JSON.stringify([{digest:"reuse",commands:w}]))}catch{}u.delete(),ve.delete()}else if(E){const u=te.filter(gt);try{localStorage.setItem(`${I.EXTENSIONID}/fogCache/${R.userId}/${we}`,JSON.stringify(u.map(w=>({digest:w.metadata[`${I.EXTENSIONID}/digest`],commands:w.commands}))))}catch{}}let Re;oe&&(Re=fe.resolve()),fe.delete();const le=te.filter(Ut),xe=te.filter(u=>{const w=u.metadata[`${I.EXTENSIONID}/digest`];return gt(u)&&ne[w]===void 0});if(g){let u=R.metadata[`${I.EXTENSIONID}/fowColor`]?R.metadata[`${I.EXTENSIONID}/fowColor`]:"#00000088",w=.5;u.length==9&&(w=Number.parseInt(u.substring(7),16)/255,u=u.substring(0,7));const X=Tt().commands(P.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(u).fillOpacity(w).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${I.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();X.disableHit=!0,le.length>0?$.scene.local.updateItems(Ut,V=>{for(const G of V)G.commands=X.commands},!1):p.push($.scene.local.addItems([X]))}else p.push($.scene.local.deleteItems(te.filter(Ut).map(u=>u.id)));if(P.delete(),e[4].pause(),e[5].start(),T||R.role=="GM")ro();else{const u=await $.scene.local.getItems(w=>w.metadata[`${I.EXTENSIONID}/doorId`]!==void 0);u.length>0&&await $.scene.local.deleteItems(u.map(w=>w.id))}const Ke=await $.scene.local.getItems(u=>u.metadata[`${I.EXTENSIONID}/doorId`]!==void 0);for(const u of Ke){const w=u.metadata[`${I.EXTENSIONID}/doorId`],X=R.items.find(V=>V.id===w);if(X){const G=u.commands.length==I.DOOROPEN.length,ae=!!X.metadata[`${I.EXTENSIONID}/doorOpen`];if(G===ae)continue;p.push($.scene.local.updateItems([u.id],ce=>{const se=ce[0];Dr(se)&&(se.commands=Yi(ae))}))}}n.pause(),t.resume(),p.push($.scene.local.deleteItems(re.map(u=>u.id))),p.push($.scene.local.addItems(h.map(u=>{const w=Tt().commands(u.cmds).locked(!0).visible(u.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${I.EXTENSIONID}/isVisionFog`]:!0,[`${I.EXTENSIONID}/digest`]:u.digest}).build();return w.zIndex=u.zIndex,w}))),E||p.push($.scene.local.deleteItems(xe.map(u=>u.id))),B.length>0&&p.push($.scene.local.addItems(B)),R.fog.filled||p.push($.scene.fog.setFilled(!0)),await Promise.all(p);let qe=0;e[5].pause(),e[6].start(),oe&&(ho(Re),Re.delete()),e[6].pause();const[Fe,K]=[t.stop(),n.stop()],d={compute_time:`${K} ms`,communication_time:`${Fe} ms`,cache_hits:N.toString(),cache_misses:M.toString(),item_counter:qe.toString()};for(let u=1;u<=6;u++){const w=e[u].stop();d["stage"+u]=`${w} ms`}co(d),ut=!1}document.addEventListener("updateVision",po);async function ho(i){const e=[],t=R.items.filter(n=>Xi(n)&&qn(n));i.simplify();for(const n of t){const o=new Pe.SkOpBuilder,r=Pe.NewPath(),l=R.gridDpi/n.grid.dpi*(n.image.width/2)*n.scale.x;for(let m=0;m<6;m++){const _=m*60*Math.PI/180,x=n.position.x+l*Math.cos(_),A=n.position.y+l*Math.sin(_);m==0?r.moveTo(x,A):r.lineTo(x,A)}r.closePath(),o.add(r,Pe.PathOp.UNION),o.add(i,Pe.PathOp.INTERSECT);const f=o.resolve(),v=!f.toCmds().length;n.visible==v&&e.push(n),r.delete(),o.delete(),f.delete()}await $.scene.items.updateItems(e.map(n=>n.id),n=>{for(let o=0;o<n.length;o++)n[o].visible=!n[o].visible})}let kn,go,mi,St=[],yi,xn,vi,Ii,Ei,wi;async function ht(i){if(ut||!await $.scene.isReady())return;document.querySelector("#debug_div");const[e,t]=[new Bn,new Bn];e.start(),e.pause(),t.start();const n=R.players.filter(p=>p.role=="GM"),o=R.items.filter(p=>(p.layer=="CHARACTER"||p.layer=="ATTACHMENT")&&n.some(E=>p.createdUserId===E.id)&&(p.metadata[`${I.EXTENSIONID}/hasVision`]||p.metadata[`${I.ARMINDOID}/hasVision`])&&!p.metadata[`${I.EXTENSIONID}/visionBlind`]),l=(R.role=="GM"?R.items.filter(Xr):R.items.filter(Vr).concat(o)).filter(p=>!xt(p)||p.visible===!0),f=R.items.filter(Br),v=R.items.filter(Xi),m=R.items.filter(Bi)?.[0],_=R.metadata[`${I.EXTENSIONID}/visionEnabled`]===!0,x=R.metadata[`${I.EXTENSIONID}/persistenceEnabled`]===!0,A=R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]===!0,H=R.metadata[`${I.EXTENSIONID}/fowEnabled`]===!0,N=R.metadata[`${I.EXTENSIONID}/fowColor`],M=[],S=[],D=[];if(m===void 0?(M[0]=0,M[1]=0,S[0]=1,S[1]=1,D[0]=0,D[1]=0):(M[0]=m.width*m.scale.x,M[1]=m.height*m.scale.y,S[0]=m.scale.x,S[1]=m.scale.y,D[0]=m.position.x,D[1]=m.position.y),R.role=="GM"){const p=document.getElementById("mapHeight"),E=document.getElementById("mapWidth");E.value=(Math.round(M[0])/R.gridDpi).toString(),p.value=(Math.round(M[1])/R.gridDpi).toString()}const C=JSON.stringify(f),B=JSON.stringify(v),F=JSON.stringify(l),Q=JSON.stringify(m);if(Q==xn&&_==yi&&wi==N&&vi==A&&Ii==H&&Ei==x&&kn==C&&go==B&&mi==F&&M[0]==St[0]&&M[1]==St[1]&&i!==!0)return;let O=!1;(Q!=xn||kn!=C||M[0]!=St[0]||M[1]!=St[1])&&(O=!0),xn=Q,mi=F,kn=C,St=M,yi=_,vi=A,Ii=H,wi=N,Ei=x,t.pause();const h=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:R.items,metadata:R.metadata,size:M,offset:D,scale:S,tokensWithVision:l,visionShapes:f,invalidateCache:O}});ut||document.dispatchEvent(h)}function An(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class mo{constructor(){this._events=void 0,this._events={}}on(e,t){An(e,n=>{const o=this._events[n]||[];o.push(t),this._events[n]=o})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}An(e,o=>{if(n===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var n=this;An(e,o=>{const r=n._events[o];r!==void 0&&r.forEach(l=>{l.apply(n,t)})})}}function yo(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const o=this,r=[];if(Array.isArray(e))e.forEach(l=>{typeof l=="string"?r.push(l):(o.plugins.settings[l.name]=l.options,r.push(l.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;n=r.shift();)o.require(n)}loadPlugin(e){var t=this,n=t.plugins,o=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const ln=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Io(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Zi=i=>{if(!vo(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((o,r)=>{if(o===i[r-1]){t++;return}n(),e+=o,t=1}),n(),e},Ji=i=>{let e=zn(i);return ln(e)},vo=i=>new Set(i).size!==i.length,At=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Io=i=>i.reduce((e,t)=>Math.max(e,Eo(t)),0),Eo=i=>zn(i).length,zn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Qi=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Qi(t).forEach(function(o){let r=o.slice(0);r[0]=i.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(i.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const wo=[[0,65535]],bo="[̀-ͯ·ʾʼ]";let rn,er;const So=3,Kn={},bi={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in bi){let e=bi[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Kn[n]=i}}const _o=new RegExp(Object.keys(Kn).join("|")+"|"+bo,"gu"),To=i=>{rn===void 0&&(rn=xo(i||wo))},Si=(i,e="NFKD")=>i.normalize(e),on=i=>zn(i).reduce((e,t)=>e+Oo(t),""),Oo=i=>(i=Si(i).toLowerCase().replace(_o,e=>Kn[e]||""),Si(i,"NFC"));function*No(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let o=String.fromCharCode(n),r=on(o);r!=o.toLowerCase()&&(r.length>So||r.length!=0&&(yield{folded:r,composed:o,code_point:n}))}}const ko=i=>{const e={},t=(n,o)=>{const r=e[n]||new Set,l=new RegExp("^"+Ji(r)+"$","iu");o.match(l)||(r.add(At(o)),e[n]=r)};for(let n of No(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},xo=i=>{const e=ko(i),t={};let n=[];for(let r in e){let l=e[r];l&&(t[r]=Ji(l)),r.length>1&&n.push(At(r))}n.sort((r,l)=>l.length-r.length);const o=ln(n);return er=new RegExp("^"+o,"u"),t},Ao=(i,e=1)=>{let t=0;return i=i.map(n=>(rn[n]&&(t+=n.length),rn[n]||n)),t>=e?Zi(i):""},Co=(i,e=1)=>(e=Math.max(e,i.length-1),ln(Qi(i).map(t=>Ao(t,e)))),_i=(i,e=!0)=>{let t=i.length>1?1:0;return ln(i.map(n=>{let o=[];const r=e?n.length():n.length()-1;for(let l=0;l<r;l++)o.push(Co(n.substrs[l]||"",t));return Zi(o)}))},Do=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const o=l=>{for(const f of n){if(f.start===l.start&&f.substr===l.substr)return!1;if(!(l.length==1||f.length==1)&&(l.start<f.start&&l.end>f.start||f.start<l.start&&f.end>l.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class an{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new an,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const v of o)n.add(v);let l=t.substr.substring(0,e-r.start),f=l.length;return n.add({start:r.start,end:r.start+f,length:f,substr:l}),n}}const Po=i=>{To(),i=on(i);let e="",t=[new an];for(let n=0;n<i.length;n++){let r=i.substring(n).match(er);const l=i.substring(n,n+1),f=r?r[0]:null;let v=[],m=new Set;for(const _ of t){const x=_.last();if(!x||x.length==1||x.end<=n)if(f){const A=f.length;_.add({start:n,end:n+A,length:A,substr:f}),m.add("1")}else _.add({start:n,end:n+1,length:1,substr:l}),m.add("2");else if(f){let A=_.clone(n,x);const H=f.length;A.add({start:n,end:n+H,length:H,substr:f}),v.push(A)}else m.add("3")}if(v.length>0){v=v.sort((_,x)=>_.length()-x.length());for(let _ of v)Do(_,t)||t.push(_);continue}if(n>0&&m.size==1&&!m.has("3")){e+=_i(t,!1);let _=new an;const x=t[0];x&&_.add(x.last()),t=[_]}}return e+=_i(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const $o=(i,e)=>{if(i)return i[e]},Lo=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},Cn=(i,e,t)=>{var n,o;return!i||(i=i+"",e.regex==null)||(o=i.search(e.regex),o===-1)?0:(n=e.string.length/i.length,o===0&&(n+=.5),n*t)},Dn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},We=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Mo=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=on(i+"").toLowerCase(),e=on(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Ro{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var l;return n&&(l=new RegExp("^("+Object.keys(n).map(At).join("|")+"):(.*)$")),r.forEach(f=>{let v,m=null,_=null;l&&(v=f.match(l))&&(m=v[1],f=v[2]),f.length>0&&(this.settings.diacritics?_=Po(f)||null:_=At(f),_&&t&&(_="\\b"+_)),o.push({string:f,regex:_?new RegExp(_,"iu"):null,field:m})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const o=e.options.fields,r=e.weights,l=o.length,f=e.getAttrFn;if(!l)return function(){return 1};const v=function(){return l===1?function(m,_){const x=o[0].field;return Cn(f(_,x),m,r[x]||1)}:function(m,_){var x=0;if(m.field){const A=f(_,m.field);!m.regex&&A?x+=1/l:x+=Cn(A,m,1)}else We(r,(A,H)=>{x+=Cn(f(_,H),m,A)});return x/l}}();return n===1?function(m){return v(t[0],m)}:e.options.conjunction==="and"?function(m){var _,x=0;for(let A of t){if(_=v(A,m),_<=0)return 0;x+=_}return x/n}:function(m){var _=0;return We(t,x=>{_+=v(x,m)}),_/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const o=this,r=e.options,l=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof l=="function")return l.bind(this);const f=function(_,x){return _==="$score"?x.score:e.getAttrFn(o.items[x.id],_)};if(l)for(let m of l)(e.query||m.field!=="$score")&&n.push(m);if(e.query){t=!0;for(let m of n)if(m.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(m=>m.field!=="$score");return n.length?function(m,_){var x,A;for(let H of n)if(A=H.field,x=(H.direction==="desc"?-1:1)*Mo(f(A,m),f(A,_)),x)return x;return 0}:null}prepareSearch(e,t){const n={};var o=Object.assign({},t);if(Dn(o,"sort"),Dn(o,"sort_empty"),o.fields){Dn(o,"fields");const r=[];o.fields.forEach(l=>{typeof l=="string"&&(l={field:l,weight:1}),r.push(l),n[l.field]="weight"in l?l.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:o.nesting?Lo:$o}}search(e,t){var n=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const l=t.score||n._getScoreFunction(r);e.length?We(n.items,(v,m)=>{o=l(v),(t.filter===!1||o>0)&&r.items.push({score:o,id:m})}):We(n.items,(v,m)=>{r.items.push({score:1,id:m})});const f=n._getSortFunction(r);return f&&r.items.sort(f),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const yt=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Be=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(tr(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},tr=i=>typeof i=="string"&&i.indexOf("<")>-1,Fo=i=>i.replace(/['"\\]/g,"\\$&"),Pn=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Xt=(i,e)=>{Object.assign(i.style,e)},He=(i,...e)=>{var t=nr(e);i=ir(i),i.map(n=>{t.map(o=>{n.classList.add(o)})})},at=(i,...e)=>{var t=nr(e);i=ir(i),i.map(n=>{t.map(o=>{n.classList.remove(o)})})},nr=i=>{var e=[];return yt(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},ir=i=>(Array.isArray(i)||(i=[i]),i),Ht=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},Ti=(i,e=0)=>e>0?i[i.length-1]:i[0],Bo=i=>Object.keys(i).length===0,sn=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},$e=(i,e)=>{yt(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},Xn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Xo=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var l=r.data.match(e);if(l&&r.data.length>0){var f=document.createElement("span");f.className="highlight";var v=r.splitText(l.index);v.splitText(l[0].length);var m=v.cloneNode(!0);return f.appendChild(m),Xn(v,f),1}return 0},n=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(l=>{o(l)})},o=r=>r.nodeType===3?t(r):(n(r),0);o(i)},Vo=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},jo=65,Uo=13,rr=27,Vn=37,Ho=38,or=39,Wo=40,Oi=8,Go=46,jn=9,qo=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Vt=qo?"metaKey":"ctrlKey";var Ni={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Ze=i=>typeof i>"u"||i===null?null:Wt(i),Wt=i=>typeof i=="boolean"?i?"1":"0":i+"",Gt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),zo=(i,e)=>e>0?setTimeout(i,e):(i.call(null),null),Ko=(i,e)=>{var t;return function(n,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[n]=!0,i.call(r,n,o)},e)}},ki=(i,e,t)=>{var n,o=i.trigger,r={};i.trigger=function(){var l=arguments[0];if(e.indexOf(l)!==-1)r[l]=arguments;else return o.apply(i,arguments)},t.apply(i,[]),i.trigger=o;for(n of e)n in r&&o.apply(i,r[n])},Yo=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),Ne=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},ke=(i,e,t,n)=>{i.addEventListener(e,t,n)},ft=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},$n=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},xi=i=>i.replace(/[\\"']/g,"\\$&"),pt=(i,e)=>{e&&i.append(e)};function Ai(i,e){var t=Object.assign({},Ni,e),n=t.dataAttr,o=t.labelField,r=t.valueField,l=t.disabledField,f=t.optgroupField,v=t.optgroupLabelField,m=t.optgroupValueField,_=i.tagName.toLowerCase(),x=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!x&&!t.allowEmptyOption){let M=i.querySelector('option[value=""]');M&&(x=M.textContent)}var A={placeholder:x,options:[],optgroups:[],items:[],maxItems:null},H=()=>{var M,S=A.options,D={},C=1;let B=0;var F=h=>{var p=Object.assign({},h.dataset),E=n&&p[n];return typeof E=="string"&&E.length&&(p=Object.assign(p,JSON.parse(E))),p},Q=(h,p)=>{var E=Ze(h.value);if(E!=null&&!(!E&&!t.allowEmptyOption)){if(D.hasOwnProperty(E)){if(p){var g=D[E][f];g?Array.isArray(g)?g.push(p):D[E][f]=[g,p]:D[E][f]=p}}else{var T=F(h);T[o]=T[o]||h.textContent,T[r]=T[r]||E,T[l]=T[l]||h.disabled,T[f]=T[f]||p,T.$option=h,T.$order=T.$order||++B,D[E]=T,S.push(T)}h.selected&&A.items.push(E)}},O=h=>{var p,E;E=F(h),E[v]=E[v]||h.getAttribute("label")||"",E[m]=E[m]||C++,E[l]=E[l]||h.disabled,E.$order=E.$order||++B,A.optgroups.push(E),p=E[m],yt(h.children,g=>{Q(g,p)})};A.maxItems=i.hasAttribute("multiple")?null:1,yt(i.children,h=>{M=h.tagName.toLowerCase(),M==="optgroup"?O(h):M==="option"&&Q(h)})},N=()=>{const M=i.getAttribute(n);if(M)A.options=JSON.parse(M),yt(A.options,D=>{A.items.push(D[r])});else{var S=i.value.trim()||"";if(!t.allowEmptyOption&&!S.length)return;const D=S.split(t.delimiter);yt(D,C=>{const B={};B[o]=C,B[r]=C,A.options.push(B)}),A.items=D}};return _==="select"?H():N(),Object.assign({},Ni,A,e)}var Ci=0;class Ge extends yo(mo){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Ci++;var n,o=Be(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);n=r.getPropertyValue("direction");const l=Ai(o,t);this.settings=l,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=$n(o,"tomselect-"+Ci),this.isRequired=o.required,this.sifter=new Ro(this.options,{diacritics:l.diacritics}),l.mode=l.mode||(l.maxItems===1?"single":"multi"),typeof l.hideSelected!="boolean"&&(l.hideSelected=l.mode==="multi"),typeof l.hidePlaceholder!="boolean"&&(l.hidePlaceholder=l.mode!=="multi");var f=l.createFilter;typeof f!="function"&&(typeof f=="string"&&(f=new RegExp(f)),f instanceof RegExp?l.createFilter=S=>f.test(S):l.createFilter=S=>this.settings.duplicates||!this.options[S]),this.initializePlugins(l.plugins),this.setupCallbacks(),this.setupTemplates();const v=Be("<div>"),m=Be("<div>"),_=this._render("dropdown"),x=Be('<div role="listbox" tabindex="-1">'),A=this.input.getAttribute("class")||"",H=l.mode;var N;if(He(v,l.wrapperClass,A,H),He(m,l.controlClass),pt(v,m),He(_,l.dropdownClass,H),l.copyClassesToDropdown&&He(_,A),He(x,l.dropdownContentClass),pt(_,x),Be(l.dropdownParent||v).appendChild(_),tr(l.controlInput)){N=Be(l.controlInput);var M=["autocorrect","autocapitalize","autocomplete","spellcheck"];We(M,S=>{o.getAttribute(S)&&$e(N,{[S]:o.getAttribute(S)})}),N.tabIndex=-1,m.appendChild(N),this.focus_node=N}else l.controlInput?(N=Be(l.controlInput),this.focus_node=N):(N=Be("<input/>"),this.focus_node=m);this.wrapper=v,this.dropdown=_,this.dropdown_content=x,this.control=m,this.control_input=N,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,o=e.dropdown,r=e.dropdown_content,l=e.wrapper,f=e.control,v=e.input,m=e.focus_node,_={passive:!0},x=e.inputId+"-ts-dropdown";$e(r,{id:x}),$e(m,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":x});const A=$n(m,e.inputId+"-ts-control"),H="label[for='"+Fo(e.inputId)+"']",N=document.querySelector(H),M=e.focus.bind(e);if(N){ke(N,"click",M),$e(N,{for:A});const C=$n(N,e.inputId+"-ts-label");$e(m,{"aria-labelledby":C}),$e(r,{"aria-labelledby":C})}if(l.style.width=v.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");He([l,o],C)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&$e(v,{multiple:"multiple"}),t.placeholder&&$e(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+At(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=Ko(t.load,t.loadThrottle)),ke(o,"mousemove",()=>{e.ignoreHover=!1}),ke(o,"mouseenter",C=>{var B=Ht(C.target,"[data-selectable]",o);B&&e.onOptionHover(C,B)},{capture:!0}),ke(o,"click",C=>{const B=Ht(C.target,"[data-selectable]");B&&(e.onOptionSelect(C,B),Ne(C,!0))}),ke(f,"click",C=>{var B=Ht(C.target,"[data-ts-item]",f);if(B&&e.onItemSelect(C,B)){Ne(C,!0);return}n.value==""&&(e.onClick(),Ne(C,!0))}),ke(m,"keydown",C=>e.onKeyDown(C)),ke(n,"keypress",C=>e.onKeyPress(C)),ke(n,"input",C=>e.onInput(C)),ke(m,"blur",C=>e.onBlur(C)),ke(m,"focus",C=>e.onFocus(C)),ke(n,"paste",C=>e.onPaste(C));const S=C=>{const B=C.composedPath()[0];if(!l.contains(B)&&!o.contains(B)){e.isFocused&&e.blur(),e.inputState();return}B==n&&e.isOpen?C.stopPropagation():Ne(C,!0)},D=()=>{e.isOpen&&e.positionDropdown()};ke(document,"mousedown",S),ke(window,"scroll",D,_),ke(window,"resize",D,_),this._destroy=()=>{document.removeEventListener("mousedown",S),window.removeEventListener("scroll",D),window.removeEventListener("resize",D),N&&N.removeEventListener("click",M)},this.revertSettings={innerHTML:v.innerHTML,tabIndex:v.tabIndex},v.tabIndex=-1,v.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,ke(v,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,v.disabled?e.disable():v.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),He(v,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),We(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,o={optgroup:r=>{let l=document.createElement("div");return l.className="optgroup",l.appendChild(r.options),l},optgroup_header:(r,l)=>'<div class="optgroup-header">'+l(r[n])+"</div>",option:(r,l)=>"<div>"+l(r[t])+"</div>",item:(r,l)=>"<div>"+l(r[t])+"</div>",option_create:(r,l)=>'<div class="create">Add <strong>'+l(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Ai(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Pn(this.input,"input"),Pn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Ne(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var o=n.trim().split(t.settings.splitOn);We(o,r=>{Ze(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Ne(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),Ne(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==jn&&Ne(e);return}switch(e.keyCode){case jo:if(ft(Vt,e)&&t.control_input.value==""){Ne(e),t.selectAll();return}break;case rr:t.isOpen&&(Ne(e,!0),t.close()),t.clearActiveItems();return;case Wo:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}Ne(e);return;case Ho:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}Ne(e);return;case Uo:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Ne(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Ne(e);return;case Vn:t.advanceSelection(-1,e);return;case or:t.advanceSelection(1,e);return;case jn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Ne(e)),t.settings.create&&t.createItem()&&Ne(e));return;case Oi:case Go:t.deleteSelection(e);return}t.isInputHidden&&!ft(Vt,e)&&Ne(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=zo(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),Ne(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(n=t.dataset.value,typeof n<"u"&&(o.lastQuery=null,o.addItem(n),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(Ne(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;He(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||at(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Pn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];ki(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,o,r,l,f,v,m;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(o=t&&t.type.toLowerCase(),o==="click"&&ft("shiftKey",t)&&n.activeItems.length){for(m=n.getLastActive(),l=Array.prototype.indexOf.call(n.control.children,m),f=Array.prototype.indexOf.call(n.control.children,e),l>f&&(v=l,l=f,f=v),r=l;r<=f;r++)e=n.control.children[r],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);Ne(t)}else o==="click"&&ft(Vt,t)||o==="keydown"&&ft("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&at(n,"last-active"),He(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),at(e,"active")}clearActiveItems(){at(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,$e(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),$e(e,{"aria-selected":"true"}),He(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,o=n.clientHeight,r=n.scrollTop||0,l=e.offsetHeight,f=e.getBoundingClientRect().top-n.getBoundingClientRect().top+r;f+l>o+r?this.scroll(f-o+l,t):f<r&&this.scroll(f,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(at(this.activeOption,"active"),$e(this.activeOption,{"aria-selected":null})),this.activeOption=null,$e(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,We(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&($e(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&$e(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,o=this,r=this.getSearchOptions();if(o.settings.score&&(n=o.settings.score.call(o,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:n})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(l=>{let f=Ze(l.id);return!(f&&o.items.indexOf(f)!==-1)})),t}refreshOptions(e=!0){var t,n,o,r,l,f,v,m,_,x;const A={},H=[];var N=this,M=N.inputValue();const S=M===N.lastQuery||M==""&&N.lastQuery==null;var D=N.search(M),C=null,B=N.settings.shouldOpen||!1,F=N.dropdown_content;S&&(C=N.activeOption,C&&(_=C.closest("[data-group]"))),r=D.items.length,typeof N.settings.maxOptions=="number"&&(r=Math.min(r,N.settings.maxOptions)),r>0&&(B=!0);const Q=(h,p)=>{let E=A[h];if(E!==void 0){let T=H[E];if(T!==void 0)return[E,T.fragment]}let g=document.createDocumentFragment();return E=H.length,H.push({fragment:g,order:p,optgroup:h}),[E,g]};for(t=0;t<r;t++){let h=D.items[t];if(!h)continue;let p=h.id,E=N.options[p];if(E===void 0)continue;let g=Wt(p),T=N.getOption(g,!0);for(N.settings.hideSelected||T.classList.toggle("selected",N.items.includes(g)),l=E[N.settings.optgroupField]||"",f=Array.isArray(l)?l:[l],n=0,o=f&&f.length;n<o;n++){l=f[n];let P=E.$order,ne=N.optgroups[l];ne===void 0?l="":P=ne.$order;const[te,re]=Q(l,P);n>0&&(T=T.cloneNode(!0),$e(T,{id:E.$id+"-clone-"+n,"aria-selected":null}),T.classList.add("ts-cloned"),at(T,"active"),N.activeOption&&N.activeOption.dataset.value==p&&_&&_.dataset.group===l.toString()&&(C=T)),re.appendChild(T),l!=""&&(A[l]=te)}}N.settings.lockOptgroupOrder&&H.sort((h,p)=>h.order-p.order),v=document.createDocumentFragment(),We(H,h=>{let p=h.fragment,E=h.optgroup;if(!p||!p.children.length)return;let g=N.optgroups[E];if(g!==void 0){let T=document.createDocumentFragment(),P=N.render("optgroup_header",g);pt(T,P),pt(T,p);let ne=N.render("optgroup",{group:g,options:T});pt(v,ne)}else pt(v,p)}),F.innerHTML="",pt(F,v),N.settings.highlight&&(Vo(F),D.query.length&&D.tokens.length&&We(D.tokens,h=>{Xo(F,h.regex)}));var O=h=>{let p=N.render(h,{input:M});return p&&(B=!0,F.insertBefore(p,F.firstChild)),p};if(N.loading?O("loading"):N.settings.shouldLoad.call(N,M)?D.items.length===0&&O("no_results"):O("not_loading"),m=N.canCreate(M),m&&(x=O("option_create")),N.hasOptions=D.items.length>0||m,B){if(D.items.length>0){if(!C&&N.settings.mode==="single"&&N.items[0]!=null&&(C=N.getOption(N.items[0])),!F.contains(C)){let h=0;x&&!N.settings.addPrecedence&&(h=1),C=N.selectable()[h]}}else x&&(C=x);e&&!N.isOpen&&(N.open(),N.scrollToOption(C,"auto")),N.setActiveOption(C)}else N.clearActiveOption(),e&&N.isOpen&&N.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const o=Ze(e[n.settings.valueField]);return o===null||n.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[o]=e,n.lastQuery=null,t&&(n.userOptions[o]=t,n.trigger("option_add",o,e)),o)}addOptions(e,t=!1){We(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ze(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var o,r;const l=Ze(e),f=Ze(t[n.settings.valueField]);if(l===null)return;const v=n.options[l];if(v==null)return;if(typeof f!="string")throw new Error("Value must be set in option data");const m=n.getOption(l),_=n.getItem(l);if(t.$order=t.$order||v.$order,delete n.options[l],n.uncacheValue(f),n.options[f]=t,m){if(n.dropdown_content.contains(m)){const x=n._render("option",t);Xn(m,x),n.activeOption===m&&n.setActiveOption(x)}m.remove()}_&&(r=n.items.indexOf(l),r!==-1&&n.items.splice(r,1,f),o=n._render("item",t),_.classList.contains("active")&&He(o,"active"),Xn(_,o)),n.lastQuery=null}removeOption(e,t){const n=this;e=Wt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};We(this.options,(o,r)=>{t(o,r)&&(n[r]=o)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Ze(e);if(n===null)return null;const o=this.options[n];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,n="option"){var o=this,r;if(!e)return null;n=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let l=0;l<r.length;l++)if(r[l]==e)return t>0?r[l+1]:r[l-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ze(e);return t!==null?this.control.querySelector(`[data-value="${xi(t)}"]`):null}addItems(e,t){var n=this,o=Array.isArray(e)?e:[e];o=o.filter(l=>n.items.indexOf(l)===-1);const r=o[o.length-1];o.forEach(l=>{n.isPending=l!==r,n.addItem(l,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];ki(this,n,()=>{var o,r;const l=this,f=l.settings.mode,v=Ze(e);if(!(v&&l.items.indexOf(v)!==-1&&(f==="single"&&l.close(),f==="single"||!l.settings.duplicates))&&!(v===null||!l.options.hasOwnProperty(v))&&(f==="single"&&l.clear(t),!(f==="multi"&&l.isFull()))){if(o=l._render("item",l.options[v]),l.control.contains(o)&&(o=o.cloneNode(!0)),r=l.isFull(),l.items.splice(l.caretPos,0,v),l.insertAtCaret(o),l.isSetup){if(!l.isPending&&l.settings.hideSelected){let m=l.getOption(v),_=l.getAdjacent(m,1);_&&l.setActiveOption(_)}!l.isPending&&!l.settings.closeAfterSelect&&l.refreshOptions(l.isFocused&&f!=="single"),l.settings.closeAfterSelect!=!1&&l.isFull()?l.close():l.isPending||l.positionDropdown(),l.trigger("item_add",v,o),l.isPending||l.updateOriginalInput({silent:t})}(!l.isPending||!r&&l.isFull())&&(l.inputState(),l.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var o,r;const l=e.dataset.value;o=sn(e),e.remove(),e.classList.contains("active")&&(r=n.activeItems.indexOf(e),n.activeItems.splice(r,1),at(e,"active")),n.items.splice(o,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(l)&&n.removeOption(l,t),o<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",l,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,o=n.caretPos,r;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var l=!1,f=v=>{if(n.unlock(),!v||typeof v!="object")return t();var m=Ze(v[n.settings.valueField]);if(typeof m!="string")return t();n.setTextboxValue(),n.addOption(v,!0),n.setCaret(o),n.addItem(m),t(v),l=!0};return typeof n.settings.create=="function"?r=n.settings.create.call(this,e,f):r={[n.settings.labelField]:e,[n.settings.valueField]:e},l||f(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("readonly",e.isReadOnly),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",n),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",Bo(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let v=function(m,_,x){return m||(m=Be('<option value="'+Gt(_)+'">'+Gt(x)+"</option>")),m!=r&&t.input.append(m),l.push(m),(m!=r||f>0)&&(m.selected=!0),m};const l=[],f=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(m=>{m.selected=!1}),t.items.length==0&&t.settings.mode=="single"?v(r,"",""):t.items.forEach(m=>{if(n=t.options[m],o=n[t.settings.labelField]||"",l.includes(n.$option)){const _=t.input.querySelector(`option[value="${xi(m)}"]:not(:checked)`);v(_,m,o)}else n.$option=v(n.$option,m,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,$e(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Xt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Xt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,$e(t.focus_node,{"aria-expanded":"false"}),Xt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Xt(this.dropdown,{width:t.width+"px",top:n+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();We(n,o=>{t.removeItem(o,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,o=t.control;o.insertBefore(e,o.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,o,r,l=this;t=e&&e.keyCode===Oi?-1:1,n=Yo(l.control_input);const f=[];if(l.activeItems.length)r=Ti(l.activeItems,t),o=sn(r),t>0&&o++,We(l.activeItems,v=>f.push(v));else if((l.isFocused||l.settings.mode==="single")&&l.items.length){const v=l.controlChildren();let m;t<0&&n.start===0&&n.length===0?m=v[l.caretPos-1]:t>0&&n.start===l.inputValue().length&&(m=v[l.caretPos]),m!==void 0&&f.push(m)}if(!l.shouldDelete(f,e))return!1;for(Ne(e,!0),typeof o<"u"&&l.setCaret(o);f.length;)l.removeItem(f.pop());return l.inputState(),l.positionDropdown(),l.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(o=>o.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(ft(Vt,t)||ft("shiftKey",t)?(n=r.getLastActive(e),n?n.classList.contains("active")?o=r.getAdjacent(n,e,"item"):o=n:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(n),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Ti(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,at(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,Gt),!o))return null;if(o=Be(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?$e(o,{"aria-disabled":"true"}):$e(o,{"data-selectable":""}):e==="optgroup"&&(n=t.group[r.settings.optgroupValueField],$e(o,{"data-group":n}),t.group[r.settings.disabledField]&&$e(o,{"data-disabled":""})),e==="option"||e==="item"){const l=Wt(t[r.settings.valueField]);$e(o,{"data-value":l}),e==="item"?(He(o,r.settings.itemClass),$e(o,{"data-ts-item":""})):(He(o,r.settings.optionClass),$e(o,{role:"option",id:t.$id}),t.$div=o,r.options[l]=t)}return o}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){We(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var o=this,r=o[t];o[t]=function(){var l,f;return e==="after"&&(l=r.apply(o,arguments)),f=n.apply(o,arguments),e==="instead"?f:(e==="before"&&(l=r.apply(o,arguments)),l)}}}function Zo(){ke(this.input,"change",()=>{this.sync()})}function Jo(i){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},i);var o=function(f,v){v?(f.checked=!0,n.uncheckedClassNames&&f.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&f.classList.add(...n.checkedClassNames)):(f.checked=!1,n.checkedClassNames&&f.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&f.classList.add(...n.uncheckedClassNames))},r=function(f){setTimeout(()=>{var v=f.querySelector("input."+n.className);v instanceof HTMLInputElement&&o(v,f.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var l=e.settings.render.option;e.settings.render.option=(f,v)=>{var m=Be(l.call(e,f,v)),_=document.createElement("input");n.className&&_.classList.add(n.className),_.addEventListener("click",function(A){Ne(A)}),_.type="checkbox";const x=Ze(f[e.settings.valueField]);return o(_,!!(x&&e.items.indexOf(x)>-1)),m.prepend(_),m}}),e.on("item_remove",l=>{var f=e.getOption(l);f&&(f.classList.remove("selected"),r(f))}),e.on("item_add",l=>{var f=e.getOption(l);f&&r(f)}),e.hook("instead","onOptionSelect",(l,f)=>{if(f.classList.contains("selected")){f.classList.remove("selected"),e.removeItem(f.dataset.value),e.refreshOptions(),Ne(l,!0);return}t.call(e,l,f),r(f)})}function Qo(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Be(t.html(t));n.addEventListener("click",o=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(n)})}const ea=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i.nextSibling)},ta=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i)},na=(i,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,i==e)return!0}while(e&&e.previousElementSibling);return!1};function ia(){var i=this;if(i.settings.mode!=="multi")return;var e=i.lock,t=i.unlock;let n=!0,o;i.hook("after","setupTemplates",()=>{var r=i.settings.render.item;i.settings.render.item=(l,f)=>{const v=Be(r.call(i,l,f));$e(v,{draggable:"true"});const m=M=>{n||Ne(M),M.stopPropagation()},_=M=>{o=v,setTimeout(()=>{v.classList.add("ts-dragging")},0)},x=M=>{M.preventDefault(),v.classList.add("ts-drag-over"),H(v,o)},A=()=>{v.classList.remove("ts-drag-over")},H=(M,S)=>{S!==void 0&&(na(S,v)?ea(M,S):ta(M,S))},N=()=>{var M;document.querySelectorAll(".ts-drag-over").forEach(D=>D.classList.remove("ts-drag-over")),(M=o)==null||M.classList.remove("ts-dragging"),o=void 0;var S=[];i.control.querySelectorAll("[data-value]").forEach(D=>{if(D.dataset.value){let C=D.dataset.value;C&&S.push(C)}}),i.setValue(S)};return ke(v,"mousedown",m),ke(v,"dragstart",_),ke(v,"dragenter",x),ke(v,"dragover",x),ke(v,"dragleave",A),ke(v,"dragend",N),v}}),i.hook("instead","lock",()=>(n=!1,e.call(i))),i.hook("instead","unlock",()=>(n=!0,t.call(i)))}function ra(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Be(t.html(t)),o=n.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Ne(r,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function oa(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=sn(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),at(t,"last-active")}else i.setCaret(i.caretPos+e)})}function aa(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,He(i.control_input,"dropdown-input");const e=Be('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Be('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case rr:i.isOpen&&(Ne(t,!0),i.close()),i.clearActiveItems();return;case jn:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),ke(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function sa(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of n)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),i.on("update item_add item_remove",o),ke(t,"input",o),ke(t,"keyup",o),ke(t,"blur",o),ke(t,"update",o)})}function la(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function ca(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function ua(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,o,r,l;if(!i.isOpen||!(t.keyCode===Vn||t.keyCode===or))return e.call(i,t);i.ignoreHover=!0,l=Ht(i.activeOption,"[data-group]"),n=sn(i.activeOption,"[data-selectable]"),l&&(t.keyCode===Vn?l=l.previousSibling:l=l.nextSibling,l&&(r=l.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,n)],o&&i.setActiveOption(o)))})}function da(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Gt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,l)=>{var f=Be(o.call(t,r,l)),v=Be(n);return f.appendChild(v),ke(v,"mousedown",m=>{Ne(m,!0)}),ke(v,"click",m=>{t.isLocked||(Ne(m,!0),!t.isLocked&&t.shouldDelete([f],m)&&(t.removeItem(f),t.refreshOptions(!1),t.inputState()))}),f}})}}function fa(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[n];o&&e.setTextboxValue(t.text.call(e,o))}})}function pa(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var o={},r,l=!1,f,v=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(i.activeOption){var A=i.selectable(),H=Array.from(A).indexOf(i.activeOption);if(H>=A.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const m=x=>typeof i.settings.maxOptions=="number"&&r.children.length>=i.settings.maxOptions?!1:!!(x in o&&o[x]),_=(x,A)=>i.items.indexOf(A)>=0||v.indexOf(A)>=0;i.setNextUrl=(x,A)=>{o[x]=A},i.getUrl=x=>{if(x in o){const A=o[x];return o[x]=!1,A}return i.clearPagination(),i.settings.firstUrl.call(i,x)},i.clearPagination=()=>{o={}},i.hook("instead","clearActiveOption",()=>{if(!l)return t.call(i)}),i.hook("instead","canLoad",x=>x in o?m(x):e.call(i,x)),i.hook("instead","loadCallback",(x,A)=>{if(!l)i.clearOptions(_);else if(f){const H=x[0];H!==void 0&&(f.dataset.value=H[i.settings.valueField])}n.call(i,x,A),l=!1}),i.hook("after","refreshOptions",()=>{const x=i.lastValue;var A;m(x)?(A=i.render("loading_more",{query:x}),A&&(A.setAttribute("data-selectable",""),f=A)):x in o&&!r.querySelector(".no-results")&&(A=i.render("no_more_results",{query:x})),A&&(He(A,i.settings.optionClass),r.append(A))}),i.on("initialize",()=>{v=Object.keys(i.options),r=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),r.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&m(i.lastValue)&&(l||(l=!0,i.load.call(i,i.lastValue)))})})}Ge.define("change_listener",Zo);Ge.define("checkbox_options",Jo);Ge.define("clear_button",Qo);Ge.define("drag_drop",ia);Ge.define("dropdown_header",ra);Ge.define("caret_position",oa);Ge.define("dropdown_input",aa);Ge.define("input_autogrow",sa);Ge.define("no_backspace_delete",la);Ge.define("no_active_items",ca);Ge.define("optgroup_columns",ua);Ge.define("remove_button",da);Ge.define("restore_on_backspace",fa);Ge.define("virtual_scroll",pa);async function ha(i){if(!await $.scene.isReady())return;const n=(await $.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of i){const l=r.metadata[`${I.EXTENSIONID}/metadata_ghosts`];if(l?.length>0){o=!0;const f=l.map(m=>m.id);for(const m of l){const _=m.metadata[`${I.EXTENSIONID}/viewers`];_&&(_.includes(R.userId)?await $.scene.local.addItems([m]):n.includes(m.id)&&await $.scene.local.deleteItems([m.id]))}const v=n.filter(m=>!f.includes(m));v?.length>0&&await $.scene.local.deleteItems(v)}}o||await $.scene.local.deleteItems(n)}function ga(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const o of R.players)n.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function ma(){let i=R.metadata[`${I.SPECTREID}/stored`];i&&(await $.scene.local.addItems(i),i.forEach(e=>{sr(e)}))}async function ya(){$.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${I.EXTENSIONID}/metadata_ghosts`]=e,await $.player.setMetadata(t)}),await $.contextMenu.create({id:`${I.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${I.SPECTREID}/spectred`],value:void 0,operator:"==",coordinator:"&&"}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${I.SPECTREID}/spectred`],value:void 0,operator:"!=",coordinator:"&&"}]}}],async onClick(i){if(i.items.every(t=>t.metadata[`${I.SPECTREID}/spectred`]===void 0)){document.getElementById("spectreWarning").style.display="none";for(const t of i.items)sr(t)}else for(const t of i.items){const n=t;n.metadata[`${I.SPECTREID}/spectred`]=void 0,document.getElementById(`deleteGhost-${n.id}`);const o=R.ghosts.findIndex(l=>l.id===n.id);R.ghosts.splice(o,1),document.getElementById(`tr-${n.id}`)?.remove(),await $.scene.local.updateItems([n.id],l=>{l[0].metadata[`${I.EXTENSIONID}/viewers`]=[]}),await ar(n),await $.scene.items.addItems([n])}}})}async function ar(i){const t=R.metadata[`${I.SPECTREID}/stored`].filter(n=>n.id!==i.id);await $.scene.setMetadata({[`${I.SPECTREID}/stored`]:t}),await $.scene.local.deleteItems([i.id])}async function va(i){let e=R.metadata[`${I.SPECTREID}/stored`];if(!e)e=[i];else{if(e.find(n=>n.id===i.id))return;e.push(i)}await $.scene.setMetadata({[`${I.SPECTREID}/stored`]:e})}async function sr(i){const e=i.text?.plainText||i.name;i.metadata[`${I.SPECTREID}/spectred`]=!0,await $.scene.items.deleteItems([i.id]),await $.scene.local.addItems([i]),await va(i),R.ghosts.push(i);const t=document.getElementById("ghostList"),n=document.createElement("tr");n.id=`tr-${i.id}`,n.className="ghost-table-entry",n.innerHTML=`<td class="token-name">${e}</td>
<td><select id="select-${i.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${i.id}" value="Delete"/></td>`,t.appendChild(n);const o=document.getElementById(`select-${i.id}`);for(const f of R.players){const v=document.createElement("option");v.value=f.id,v.text=f.name,o.appendChild(v)}const r={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:R.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(f,v){const m=v.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await $.scene.local.updateItems([m],_=>{const x=_[0].metadata[`${I.EXTENSIONID}/viewers`],A=x.findIndex(H=>H==f);x.splice(A,1),_[0].metadata[`${I.EXTENSIONID}/viewers`]=x})},onItemAdd:async function(f,v){const m=v.parentElement.parentElement.parentElement.parentElement.id.slice(3);await $.scene.local.updateItems([m],_=>{const x=_[0].metadata[`${I.EXTENSIONID}/viewers`];x?(x.push(f),_[0].metadata[`${I.EXTENSIONID}/viewers`]=x):_[0].metadata[`${I.EXTENSIONID}/viewers`]=[f]})}};new Ge(`#select-${i.id}`,r);const l=document.getElementById(`deleteGhost-${i.id}`);l.onclick=async()=>{const f=R.ghosts.findIndex(v=>v.id===i.id);R.ghosts.splice(f,1),n.remove(),await $.scene.local.updateItems([i.id],v=>{v[0].metadata[`${I.EXTENSIONID}/viewers`]=[]}),await ar(i)}}var lr={exports:{}};(function(i){(function(){function e(f,v){var m=f.x-v.x,_=f.y-v.y;return m*m+_*_}function t(f,v,m){var _=v.x,x=v.y,A=m.x-_,H=m.y-x;if(A!==0||H!==0){var N=((f.x-_)*A+(f.y-x)*H)/(A*A+H*H);N>1?(_=m.x,x=m.y):N>0&&(_+=A*N,x+=H*N)}return A=f.x-_,H=f.y-x,A*A+H*H}function n(f,v){for(var m=f[0],_=[m],x,A=1,H=f.length;A<H;A++)x=f[A],e(x,m)>v&&(_.push(x),m=x);return m!==x&&_.push(x),_}function o(f,v,m,_,x){for(var A=_,H,N=v+1;N<m;N++){var M=t(f[N],f[v],f[m]);M>A&&(H=N,A=M)}A>_&&(H-v>1&&o(f,v,H,_,x),x.push(f[H]),m-H>1&&o(f,H,m,_,x))}function r(f,v){var m=f.length-1,_=[f[0]];return o(f,0,m,v,_),_.push(f[m]),_}function l(f,v,m){if(f.length<=2)return f;var _=v!==void 0?v*v:1;return f=m?f:n(f,_),f=r(f,_),f}i.exports=l,i.exports.default=l})()})(lr);var Ia=lr.exports;const Ea=Gn(Ia);async function Di(i){const e=await $.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=i.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,i.appendChild(r)),t[e[o].id]=e[o].name}let n=i.querySelectorAll("option");for(let o=0;o<n.length;o++)t[n[o].value]===void 0&&i.removeChild(n[o])}async function wa(i,e,t,n,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=R.gridDpi/t,l,f=[];if(f[0]=0,f[1]=0,n!==""){let v=await $.scene.items.getItems([n]);if(v.length>0)l=v[0],t===0&&(t=l.grid.dpi),r=R.gridDpi/t,f[0]=l.position.x-l.grid.offset.x*r,f[1]=l.position.y-l.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}i==="foundry"?Sa(e,r,f,o):i==="uvtt"&&ba(e,r,f,o)}function cr(i,e,t,n,o){let r=0,l=0,f=0;const v=[];for(let m=0;m<i.length;m++){let _=[],x=!1;for(let A=0;A<i[m].length-1;A++){let H=i[m][A].x*e,N=i[m][A].y*e,M=i[m][A+1].x*e,S=i[m][A+1].y*e;_.push({x:H*t+n[0],y:N*t+n[1]}),_.push({x:M*t+n[0],y:S*t+n[1]}),l++,!x&&i[m][A].door&&(x=!0)}if(_.length>128){let A=_.length;_=Ea(_,8,!1),console.log("simplified points from "+A+" to "+_.length)}for(let A=0;A<_.length;A+=256){const H=_.slice(A>0?A-1:0,A+256),N=Wn().tension(0).points(H).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();if(N.visible=!1,N.metadata[`${I.EXTENSIONID}/isVisionLine`]=!0,x&&(N.metadata[`${I.EXTENSIONID}/isDoor`]=!0),v.push(N),f+=H.length,f>512||v.length>64){r+=v.length,$.scene.items.addItems(v);const M=v.filter(S=>S.metadata[`${I.EXTENSIONID}/isDoor`]===!0);nn(M),v.length=0,f=0}}}if(v.length>0){r+=v.length,$.scene.items.addItems(v);const m=v.filter(_=>_.metadata[`${I.EXTENSIONID}/isDoor`]===!0);nn(m)}o.innerText="Finished importing "+r+" walls, "+l+" points."}function ba(i,e,t,n){if(!i.line_of_sight||i.line_of_sight.length===0){n.innerText="No walls / los found";return}if(i.resolution.map_origin!==void 0&&(t[0]-=i.resolution.map_origin.x*i.resolution.pixels_per_grid,t[1]-=i.resolution.map_origin.y*i.resolution.pixels_per_grid),i.portals&&i.portals.length)for(let o=0;o<i.portals.length;o++){let r=i.portals[o].bounds;r[0].door=!0,r[1].door=!0,i.line_of_sight.push(r)}cr(i.line_of_sight,i.resolution.pixels_per_grid,e,t,n)}function Sa(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const o=[];for(var r=0;r<i.walls.length;r++)o.push([{x:i.walls[r].c[0],y:i.walls[r].c[1],door:!!i.walls[r].door},{x:i.walls[r].c[2],y:i.walls[r].c[3],door:!!i.walls[r].door}]);cr(o,1,e,t,n)}function Pi(i,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",o=t.matches?"light":"dark";for(var r=0;r<e.styleSheets.length;r++)for(var l=0;l<e.styleSheets[r].cssRules.length;l++){let f=e.styleSheets[r].cssRules[l];f&&f.media&&f.media.mediaText.includes("prefers-color-scheme")&&(i.mode=="LIGHT"?(f.media.appendMedium(`(prefers-color-scheme: ${n})`),f.media.mediaText.includes(o)&&f.media.deleteMedium(`(prefers-color-scheme: ${o})`)):i.mode=="DARK"&&(f.media.appendMedium(`(prefers-color-scheme: ${o})`),f.media.mediaText.includes(n)&&f.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}var it=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(i,e,t,n){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},l,f,v,m,_,x,A,H,N,M,S,D,C,B,F,Q,O={},h={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},p={},E="",g={},T=!1;function P(b){if(typeof b=="object"){var U=function(){switch(W){case"el":ge(b.el),b.wrap!==!1&&fe(b.el);break;case"parent":l=e.querySelector(b.parent),l&&(l.appendChild(f),h.parent=b.parent,l===e.body&&(l=n));break;case"themeMode":h.themeMode=b.themeMode,b.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(h.themeMode="dark");case"theme":b.theme&&(h.theme=b.theme),f.className="clr-picker clr-"+h.theme+" clr-"+h.themeMode,h.inline&&ve();break;case"rtl":h.rtl=!!b.rtl,e.querySelectorAll(".clr-field").forEach(function(Me){return Me.classList.toggle("clr-rtl",h.rtl)});break;case"margin":b.margin*=1,h.margin=isNaN(b.margin)?h.margin:b.margin;break;case"wrap":b.el&&b.wrap&&fe(b.el);break;case"formatToggle":h.formatToggle=!!b.formatToggle,pe("clr-format").style.display=h.formatToggle?"block":"none",h.formatToggle&&(h.format="auto");break;case"swatches":if(Array.isArray(b.swatches)){var ue=[];b.swatches.forEach(function(Me,ye){ue.push('<button type="button" id="clr-swatch-'+ye+'" aria-labelledby="clr-swatch-label clr-swatch-'+ye+'" style="color: '+Me+';">'+Me+"</button>")}),pe("clr-swatches").innerHTML=ue.length?"<div>"+ue.join("")+"</div>":"",h.swatches=b.swatches.slice()}break;case"swatchesOnly":h.swatchesOnly=!!b.swatchesOnly,f.setAttribute("data-minimal",h.swatchesOnly);break;case"alpha":h.alpha=!!b.alpha,f.setAttribute("data-alpha",h.alpha);break;case"inline":if(h.inline=!!b.inline,f.setAttribute("data-inline",h.inline),h.inline){var he=b.defaultColor||h.defaultColor;B=Re(he),ve(),we(he)}break;case"clearButton":typeof b.clearButton=="object"&&(b.clearButton.label&&(h.clearLabel=b.clearButton.label,A.innerHTML=h.clearLabel),b.clearButton=b.clearButton.show),h.clearButton=!!b.clearButton,A.style.display=h.clearButton?"block":"none";break;case"clearLabel":h.clearLabel=b.clearLabel,A.innerHTML=h.clearLabel;break;case"closeButton":h.closeButton=!!b.closeButton,h.closeButton?f.insertBefore(H,_):_.appendChild(H);break;case"closeLabel":h.closeLabel=b.closeLabel,H.innerHTML=h.closeLabel;break;case"a11y":var de=b.a11y,Ce=!1;if(typeof de=="object")for(var me in de)de[me]&&h.a11y[me]&&(h.a11y[me]=de[me],Ce=!0);if(Ce){var Le=pe("clr-open-label"),be=pe("clr-swatch-label");Le.innerHTML=h.a11y.open,be.innerHTML=h.a11y.swatch,H.setAttribute("aria-label",h.a11y.close),A.setAttribute("aria-label",h.a11y.clear),N.setAttribute("aria-label",h.a11y.hueSlider),S.setAttribute("aria-label",h.a11y.alphaSlider),x.setAttribute("aria-label",h.a11y.input),v.setAttribute("aria-label",h.a11y.instruction)}break;default:h[W]=b[W]}};for(var W in b)U()}}function ne(b,U){typeof b=="string"&&typeof U=="object"&&(p[b]=U,T=!0)}function te(b){delete p[b],Object.keys(p).length===0&&(T=!1,b===E&&Y())}function re(b){if(T){var U=["el","wrap","rtl","inline","defaultColor","a11y"],W=function(){var de=p[ee];if(b.matches(ee)){E=ee,g={},U.forEach(function(me){return delete de[me]});for(var Ce in de)g[Ce]=Array.isArray(h[Ce])?h[Ce].slice():h[Ce];return P(de),"break"}};for(var ee in p){var ue=W();if(ue==="break")break}}}function Y(){Object.keys(g).length>0&&(P(g),E="",g={})}function ge(b){Ee(e,"click",b,function(U){h.inline||(re(U.target),C=U.target,F=C.value,B=Re(F),f.classList.add("clr-open"),ve(),we(F),(h.focusInput||h.selectInput)&&(x.focus({preventScroll:!0}),x.setSelectionRange(C.selectionStart,C.selectionEnd)),h.selectInput&&x.select(),(Q||h.swatchesOnly)&&Te().shift().focus(),C.dispatchEvent(new Event("open",{bubbles:!0})))}),Ee(e,"input",b,function(U){var W=U.target.parentNode;W.classList.contains("clr-field")&&(W.style.color=U.target.value)})}function ve(){if(!(!f||!C&&!h.inline)){var b=l,U=i.scrollY,W=f.offsetWidth,ee=f.offsetHeight,ue={left:!1,top:!1},he,de,Ce,me={x:0,y:0};if(b&&(he=i.getComputedStyle(b),de=parseFloat(he.marginTop),Ce=parseFloat(he.borderTopWidth),me=b.getBoundingClientRect(),me.y+=Ce+U),!h.inline){var Le=C.getBoundingClientRect(),be=Le.x,Me=U+Le.y+Le.height+h.margin;b?(be-=me.x,Me-=me.y,be+W>b.clientWidth&&(be+=Le.width-W,ue.left=!0),Me+ee>b.clientHeight-de&&ee+h.margin<=Le.top-(me.y-U)&&(Me-=Le.height+ee+h.margin*2,ue.top=!0),Me+=b.scrollTop):(be+W>e.documentElement.clientWidth&&(be+=Le.width-W,ue.left=!0),Me+ee-U>e.documentElement.clientHeight&&ee+h.margin<=Le.top&&(Me=U+Le.y-ee-h.margin,ue.top=!0)),f.classList.toggle("clr-left",ue.left),f.classList.toggle("clr-top",ue.top),f.style.left=be+"px",f.style.top=Me+"px",me.x+=f.offsetLeft,me.y+=f.offsetTop}O={width:v.offsetWidth,height:v.offsetHeight,x:v.offsetLeft+me.x,y:v.offsetTop+me.y}}}function fe(b){e.querySelectorAll(b).forEach(function(U){var W=U.parentNode;if(!W.classList.contains("clr-field")){var ee=e.createElement("div"),ue="clr-field";(h.rtl||U.classList.contains("clr-rtl"))&&(ue+=" clr-rtl"),ee.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',W.insertBefore(ee,U),ee.setAttribute("class",ue),ee.style.color=U.value,ee.appendChild(U)}})}function oe(b){if(C&&!h.inline){var U=C;b&&(C=n,F!==U.value&&(U.value=F,U.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){F!==U.value&&U.dispatchEvent(new Event("change",{bubbles:!0}))}),f.classList.remove("clr-open"),T&&Y(),U.dispatchEvent(new Event("close",{bubbles:!0})),h.focusInput&&U.focus({preventScroll:!0}),C=n}}function we(b){var U=ce(b),W=ae(U);Ke(W.s,W.v),u(U,W),N.value=W.h,f.style.color="hsl("+W.h+", 100%, 50%)",M.style.left=W.h/360*100+"%",m.style.left=O.width*W.s/100+"px",m.style.top=O.height-O.height*W.v/100+"px",S.value=W.a*100,D.style.left=W.a*100+"%"}function Re(b){var U=b.substring(0,3).toLowerCase();return U==="rgb"||U==="hsl"?U:"hex"}function le(b){b=b!==n?b:x.value,C&&(C.value=b,C.dispatchEvent(new Event("input",{bubbles:!0}))),h.onChange&&h.onChange.call(i,b,C),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:b,currentEl:C}}))}function xe(b,U){var W={h:N.value*1,s:b/O.width*100,v:100-U/O.height*100,a:S.value/100},ee=V(W);Ke(W.s,W.v),u(ee,W),le()}function Ke(b,U){var W=h.a11y.marker;b=b.toFixed(1)*1,U=U.toFixed(1)*1,W=W.replace("{s}",b),W=W.replace("{v}",U),m.setAttribute("aria-label",W)}function qe(b){return{pageX:b.changedTouches?b.changedTouches[0].pageX:b.pageX,pageY:b.changedTouches?b.changedTouches[0].pageY:b.pageY}}function Fe(b){var U=qe(b),W=U.pageX-O.x,ee=U.pageY-O.y;l&&(ee+=l.scrollTop),d(W,ee),b.preventDefault(),b.stopPropagation()}function K(b,U){var W=m.style.left.replace("px","")*1+b,ee=m.style.top.replace("px","")*1+U;d(W,ee)}function d(b,U){b=b<0?0:b>O.width?O.width:b,U=U<0?0:U>O.height?O.height:U,m.style.left=b+"px",m.style.top=U+"px",xe(b,U),m.focus()}function u(b,U){b===void 0&&(b={}),U===void 0&&(U={});var W=h.format;for(var ee in b)r[ee]=b[ee];for(var ue in U)r[ue]=U[ue];var he=se(r),de=he.substring(0,7);switch(m.style.color=de,D.parentNode.style.color=de,D.style.color=he,_.style.color=he,v.style.display="none",v.offsetHeight,v.style.display="",D.nextElementSibling.style.display="none",D.nextElementSibling.offsetHeight,D.nextElementSibling.style.display="",W==="mixed"?W=r.a===1?"hex":"rgb":W==="auto"&&(W=B),W){case"hex":x.value=he;break;case"rgb":x.value=Ie(r);break;case"hsl":x.value=Oe(G(r));break}e.querySelector('.clr-format [value="'+W+'"]').checked=!0}function w(){var b=N.value*1,U=m.style.left.replace("px","")*1,W=m.style.top.replace("px","")*1;f.style.color="hsl("+b+", 100%, 50%)",M.style.left=b/360*100+"%",xe(U,W)}function X(){var b=S.value/100;D.style.left=b*100+"%",u({a:b}),le()}function V(b){var U=b.s/100,W=b.v/100,ee=U*W,ue=b.h/60,he=ee*(1-t.abs(ue%2-1)),de=W-ee;ee=ee+de,he=he+de;var Ce=t.floor(ue)%6,me=[ee,he,de,de,he,ee][Ce],Le=[he,ee,ee,he,de,de][Ce],be=[de,de,he,ee,ee,he][Ce];return{r:t.round(me*255),g:t.round(Le*255),b:t.round(be*255),a:b.a}}function G(b){var U=b.v/100,W=U*(1-b.s/100/2),ee;return W>0&&W<1&&(ee=t.round((U-W)/t.min(W,1-W)*100)),{h:b.h,s:ee||0,l:t.round(W*100),a:b.a}}function ae(b){var U=b.r/255,W=b.g/255,ee=b.b/255,ue=t.max(U,W,ee),he=t.min(U,W,ee),de=ue-he,Ce=ue,me=0,Le=0;return de&&(ue===U&&(me=(W-ee)/de),ue===W&&(me=2+(ee-U)/de),ue===ee&&(me=4+(U-W)/de),ue&&(Le=de/ue)),me=t.floor(me*60),{h:me<0?me+360:me,s:t.round(Le*100),v:t.round(Ce*100),a:b.a}}function ce(b){var U=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,W,ee;return o.fillStyle="#000",o.fillStyle=b,W=U.exec(o.fillStyle),W?(ee={r:W[3]*1,g:W[4]*1,b:W[5]*1,a:W[6]*1},ee.a=+ee.a.toFixed(2)):(W=o.fillStyle.replace("#","").match(/.{2}/g).map(function(ue){return parseInt(ue,16)}),ee={r:W[0],g:W[1],b:W[2],a:1}),ee}function se(b){var U=b.r.toString(16),W=b.g.toString(16),ee=b.b.toString(16),ue="";if(b.r<16&&(U="0"+U),b.g<16&&(W="0"+W),b.b<16&&(ee="0"+ee),h.alpha&&(b.a<1||h.forceAlpha)){var he=b.a*255|0;ue=he.toString(16),he<16&&(ue="0"+ue)}return"#"+U+W+ee+ue}function Ie(b){return!h.alpha||b.a===1&&!h.forceAlpha?"rgb("+b.r+", "+b.g+", "+b.b+")":"rgba("+b.r+", "+b.g+", "+b.b+", "+b.a+")"}function Oe(b){return!h.alpha||b.a===1&&!h.forceAlpha?"hsl("+b.h+", "+b.s+"%, "+b.l+"%)":"hsla("+b.h+", "+b.s+"%, "+b.l+"%, "+b.a+")"}function Ae(){e.getElementById("clr-picker")||(l=n,f=e.createElement("div"),f.setAttribute("id","clr-picker"),f.className="clr-picker",f.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+h.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+h.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+h.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+h.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+h.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+h.a11y.clear+'">'+h.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+h.a11y.close+'">'+h.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+h.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+h.a11y.swatch+"</span>"),e.body.appendChild(f),v=pe("clr-color-area"),m=pe("clr-color-marker"),A=pe("clr-clear"),H=pe("clr-close"),_=pe("clr-color-preview"),x=pe("clr-color-value"),N=pe("clr-hue-slider"),M=pe("clr-hue-marker"),S=pe("clr-alpha-slider"),D=pe("clr-alpha-marker"),ge(h.el),fe(h.el),Ee(f,"mousedown",function(b){f.classList.remove("clr-keyboard-nav"),b.stopPropagation()}),Ee(v,"mousedown",function(b){Ee(e,"mousemove",Fe)}),Ee(v,"touchstart",function(b){e.addEventListener("touchmove",Fe,{passive:!1})}),Ee(m,"mousedown",function(b){Ee(e,"mousemove",Fe)}),Ee(m,"touchstart",function(b){e.addEventListener("touchmove",Fe,{passive:!1})}),Ee(x,"change",function(b){var U=x.value;if(C||h.inline){var W=U===""?U:we(U);le(W)}}),Ee(A,"click",function(b){le(""),oe()}),Ee(H,"click",function(b){le(),oe()}),Ee(pe("clr-format"),"click",".clr-format input",function(b){B=b.target.value,u(),le()}),Ee(f,"click",".clr-swatches button",function(b){we(b.target.textContent),le(),h.swatchesOnly&&oe()}),Ee(e,"mouseup",function(b){e.removeEventListener("mousemove",Fe)}),Ee(e,"touchend",function(b){e.removeEventListener("touchmove",Fe)}),Ee(e,"mousedown",function(b){Q=!1,f.classList.remove("clr-keyboard-nav"),oe()}),Ee(e,"keydown",function(b){var U=b.key,W=b.target,ee=b.shiftKey,ue=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(U==="Escape"?oe(!0):ue.includes(U)&&(Q=!0,f.classList.add("clr-keyboard-nav")),U==="Tab"&&W.matches(".clr-picker *")){var he=Te(),de=he.shift(),Ce=he.pop();ee&&W===de?(Ce.focus(),b.preventDefault()):!ee&&W===Ce&&(de.focus(),b.preventDefault())}}),Ee(e,"click",".clr-field button",function(b){T&&Y(),b.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),Ee(m,"keydown",function(b){var U={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(U).includes(b.key)&&(K.apply(void 0,U[b.key]),b.preventDefault())}),Ee(v,"click",Fe),Ee(N,"input",w),Ee(S,"input",X))}function Te(){var b=Array.from(f.querySelectorAll("input, button")),U=b.filter(function(W){return!!W.offsetWidth});return U}function pe(b){return e.getElementById(b)}function Ee(b,U,W,ee){var ue=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof W=="string"?b.addEventListener(U,function(he){ue.call(he.target,W)&&ee.call(he.target,he)}):(ee=W,b.addEventListener(U,ee))}function ze(b,U){U=U!==n?U:[],e.readyState!=="loading"?b.apply(void 0,U):e.addEventListener("DOMContentLoaded",function(){b.apply(void 0,U)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function st(b,U){C=U,F=C.value,re(U),B=Re(b),ve(),we(b),le(),F!==b&&C.dispatchEvent(new Event("change",{bubbles:!0}))}var et=function(){var b={init:Ae,set:P,wrap:fe,close:oe,setInstance:ne,setColor:st,removeInstance:te,updatePosition:ve};function U(ue){ze(function(){ue&&(typeof ue=="string"?ge(ue):P(ue))})}var W=function(he){U[he]=function(){for(var de=arguments.length,Ce=new Array(de),me=0;me<de;me++)Ce[me]=arguments[me];ze(b[he],Ce)}};for(var ee in b)W(ee);return ze(function(){i.addEventListener("resize",function(ue){U.updatePosition()}),i.addEventListener("scroll",function(ue){U.updatePosition()})}),U}();return et.coloris=et,et}(window,document,Math)}();it.coloris;it.init;it.set;it.wrap;it.close;it.setInstance;it.removeInstance;it.updatePosition;const Yn=document.getElementById("app");Yn.innerHTML=`
<div>
    <div>
        <div id="localStorageWarning"></div>
        <div class="title">
            Smoke! ˣ Dynamic Fog
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings"><svg class="svgclickable" fill="#fff" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.63 11.08zm.21.41v-.1zm.23.38L1 11.68zM1 11.68l-.11-.19zm-.21-.29c-.06-.1-.11-.21-.16-.31.05.1.1.21.16.31zm.32.54v-.06z"/><path d="m11.26 12.63 1.83 1.09a7.34 7.34 0 0 0 1-.94 7.48 7.48 0 0 0 1.56-2.86l-1.74-1A5.29 5.29 0 0 0 14 8a5.29 5.29 0 0 0-.08-.9l1.74-1a7.45 7.45 0 0 0-1.33-2.58 7.54 7.54 0 0 0-1.24-1.22l-1.83 1.04a6 6 0 0 0-1.11-.53v-2A8.55 8.55 0 0 0 7.94.53a8.39 8.39 0 0 0-2.26.3v2a7.23 7.23 0 0 0-1.12.54L2.78 2.28A7.46 7.46 0 0 0 .2 6.06l1.72 1a5.29 5.29 0 0 0-.08.9 5.29 5.29 0 0 0 .08.9l-1.73 1a8 8 0 0 0 .43 1.15c.05.1.1.21.16.31v.1l.11.19.12.19v.06a7.69 7.69 0 0 0 1.64 1.78l1.81-1.08a7.23 7.23 0 0 0 1.12.54v2a8.39 8.39 0 0 0 2.26.31 8.56 8.56 0 0 0 2.22-.3v-2a6 6 0 0 0 1.2-.48zm-2.39 1.52a7.57 7.57 0 0 1-.95.06 7.73 7.73 0 0 1-1-.06v-1.69a4.92 4.92 0 0 1-2.53-1.27l-1.54.92a6.22 6.22 0 0 1-1.08-1.61l1.56-.93a4.27 4.27 0 0 1 0-3.17l-1.56-.92a6.11 6.11 0 0 1 1.12-1.62l1.56.93A5 5 0 0 1 7 3.53V1.82a7.73 7.73 0 0 1 1-.06 7.57 7.57 0 0 1 .95.06v1.72a4.9 4.9 0 0 1 2.4 1.26l1.59-.94a6.31 6.31 0 0 1 1.11 1.62l-1.6.94a4.35 4.35 0 0 1 .3 1.58 4.44 4.44 0 0 1-.29 1.55l1.56.93a6.43 6.43 0 0 1-1.11 1.61l-1.58-.93a5 5 0 0 1-2.49 1.28z"/><path d="M7.92 5.49A2.59 2.59 0 0 0 5.25 8a2.59 2.59 0 0 0 2.67 2.51A2.6 2.6 0 0 0 10.6 8a2.6 2.6 0 0 0-2.68-2.51zM8 9.2A1.35 1.35 0 0 1 6.55 8 1.35 1.35 0 0 1 8 6.7 1.35 1.35 0 0 1 9.39 8 1.35 1.35 0 0 1 8 9.2z"/></svg></div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg class="svgclickable"  fill="#fff" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
        </div>
        <hr>
        ${I.SETTINGSPAGE}
        ${I.MAINPAGE}
        ${I.DEBUGPAGE}
    </div>
</div>
`;Yn.parentElement.style.placeItems="start";const $i=document.getElementById("main-ui"),Ln=document.getElementById("settings-ui"),ur=document.getElementById("vision_checkbox"),Li=document.getElementById("snap_checkbox"),_a=document.getElementById("token_list"),Ta=document.getElementById("no_tokens_message"),Oa=document.getElementById("mapHeight"),Na=document.getElementById("mapWidth"),ka=document.getElementById("mapSubmit"),dr=document.getElementById("persistence_checkbox"),kt=document.getElementById("autodetect_checkbox"),Un=document.getElementById("fow_checkbox"),fr=document.getElementById("door_checkbox"),pr=document.getElementById("fow_color"),hr=document.getElementById("quality"),xa=document.getElementById("persistence_reset"),Aa=document.getElementById("convert_button"),Ca=document.getElementById("settings_button"),gr=document.getElementById("boundry_options"),qt=document.getElementById("debug_div"),Da=document.getElementById("debug_button"),Pa=document.getElementById("background_button"),Mn=document.getElementById("import_button"),$a=document.getElementById("import_file"),Hn=document.getElementById("map_align"),_t=document.getElementById("import_errors"),La=document.getElementById("dpi_autodetect"),Ma=document.getElementById("import_dpi"),Ra=document.getElementById("import_format");it.init();async function Fa(){ur.addEventListener("click",async t=>{if(!R.ready||!t.target){t.preventDefault();return}const n=t.target;await $.scene.setMetadata({[`${I.EXTENSIONID}/visionEnabled`]:n.checked}),n.checked||await $.scene.fog.setFilled(!1)},!1),Li.checked=!0,Li.addEventListener("click",async t=>{if(!R.ready||!t.target){t.preventDefault();return}const n=t.target;R.snap=n.checked},!1),Ca.addEventListener("click",async t=>{!t||!t.target||(Ln.style.display==="block"?(Ln.style.display="none",$i.style.display="block"):(Ln.style.display="block",$i.style.display="none"))},!1),dr.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${I.EXTENSIONID}/persistenceEnabled`]:n.checked})},!1),kt.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;if(await $.scene.setMetadata({[`${I.EXTENSIONID}/autodetectEnabled`]:n.checked}),gr.style.display=n.checked?"none":"",!n.checked){let o=mr();o&&await $.scene.items.addItems([o])}},!1),Un.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${I.EXTENSIONID}/fowEnabled`]:n.checked})},!1),fr.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${I.EXTENSIONID}/playerDoors`]:n.checked})},!1),hr.addEventListener("change",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${I.EXTENSIONID}/quality`]:n.value})},!1),xa.addEventListener("click",async t=>{!t||!t.target||($.scene.setMetadata({[`${I.EXTENSIONID}/forceReset`]:!0}),$.scene.setMetadata({[`${I.EXTENSIONID}/forceReset`]:void 0}))},!1),Da.addEventListener("click",async t=>{!t||!t.target||(t.target,qt.style.display=qt.style.display=="none"?"grid":"none",await $.scene.setMetadata({[`${I.EXTENSIONID}/debug`]:qt.style.display==="grid"}))},!1),Pa.addEventListener("click",async t=>{!t||!t.target||(t.target,await $.scene.items.updateItems(n=>n.layer=="FOG"&&n.metadata[`${I.EXTENSIONID}/isBackgroundMap`]===!0,n=>{for(let o=0;o<n.length;o++)n[o].layer="MAP",n[o].disableHit=!1,n[o].locked=!1,n[o].visible=!0,delete n[o].metadata[`${I.EXTENSIONID}/isBackgroundMap`]}))},!1);let i;pr.addEventListener("input",async t=>{if(!t||!t.target)return;const n=t.target;clearTimeout(i),i=setTimeout(async()=>{if(/#[a-f0-9]{8}/.test(n.value)){await $.scene.setMetadata({[`${I.EXTENSIONID}/fowColor`]:n.value});const r=await $.scene.local.getItems(Ut);await $.scene.local.deleteItems(r.map(l=>l.id))}},500)},!1),Aa.addEventListener("click",async t=>{if(!(!t||!t.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const n=await $.scene.getMetadata();for(const r in n)r.substring(0,r.indexOf("/"))==I.ARMINDOID&&$.scene.setMetadata({[`${r}`]:void 0});const o=await $.scene.items.getItems();await $.scene.items.updateItems(o,r=>{for(const l of r)l.metadata[`${I.ARMINDOID}/isVisionLine`]!==void 0&&(l.metadata[`${I.EXTENSIONID}/isVisionLine`]=l.metadata[`${I.ARMINDOID}/isVisionLine`],delete l.metadata[`${I.ARMINDOID}/isVisionLine`]),l.metadata[`${I.ARMINDOID}/disabled`]!==void 0&&(l.metadata[`${I.EXTENSIONID}/disabled`]=l.metadata[`${I.ARMINDOID}/disabled`],delete l.metadata[`${I.ARMINDOID}/disabled`])})}},!1);var e;$a.addEventListener("change",async t=>{if(Mn.disabled=!0,!t||!t.target)return;const n=t.target;if(!n.files)return;const o=n.files[0];if(o.type!=="text/javascript"&&o.type,o){var r=new FileReader;r.onload=function(l){if(!l||!l.target){_t.innerText="Invalid import event";return}const f=l.target;if(!f.result){_t.innerText="Unable to read imported file";return}const v=f.result;e=JSON.parse(v),e&&(e.walls&&e.walls.length||e.line_of_sight&&e.line_of_sight.length)?Mn.disabled=!1:_t.innerText="Imported file has no walls"},r.readAsText(o)}else _t.innerText="Failed to load file"}),Mn.addEventListener("click",async t=>{!t||!t.target||(t.target,wa(Ra.value,e,La.checked?0:Number.parseInt(Ma.value),Hn.value,_t))},!1)}function zt(i){const e=i.filter(Fi);let t=!1;R.metadata&&(ur.checked=R.metadata[`${I.EXTENSIONID}/visionEnabled`]==!0,kt.checked=R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]==!0,dr.checked=R.metadata[`${I.EXTENSIONID}/persistenceEnabled`]==!0,kt.checked=R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]==!0,Un.checked=R.metadata[`${I.EXTENSIONID}/fowEnabled`]==!0,fr.checked=R.metadata[`${I.EXTENSIONID}/playerDoors`]==!0,pr.value=R.metadata[`${I.EXTENSIONID}/fowColor`]?R.metadata[`${I.EXTENSIONID}/fowColor`]:"#00000088",t=R.metadata[`${I.EXTENSIONID}/debug`]==!0,hr.value=R.metadata[`${I.EXTENSIONID}/quality`]),qt.style.display=t?"grid":"none",gr.style.display=kt.checked?"none":"",Ta.style.display=e.length>0?"none":"block",oo(Un.checked),to();const n=R.items.filter(v=>v.layer==="FOG"&&v.metadata[`${I.EXTENSIONID}/isBackgroundMap`]===!0),o=document.querySelectorAll(".fog-background-entry");for(const v of o){const m=v.id.slice(3);n.find(_=>_.id===m)===void 0&&v.remove()}for(const v of n)if(!document.querySelector(`#bg-${v.id}`)){const _=document.createElement("div");_.id=`bg-${v.id}`,_.className="fog-background-entry grid-3 grid-main",_.style.width="300",_.innerHTML=`<div class="token-name grid-2">${v.name}</div>
                <div><label title="Unlock this fog background and turn it back into a map"><input type="button" value="Unlock"></label></div>`,document.querySelector("#fog_background_list").appendChild(_),_.querySelector("input").addEventListener("click",async A=>{if(!A||!A.target)return;const N=A.target.parentElement.parentElement.parentElement.id.slice(3);await $.scene.items.updateItems(M=>M.id===N&&M.layer=="FOG"&&M.metadata[`${I.EXTENSIONID}/isBackgroundMap`]===!0,M=>{for(let S=0;S<M.length;S++)M[S].layer="MAP",M[S].disableHit=!1,M[S].locked=!1,M[S].visible=!0,delete M[S].metadata[`${I.EXTENSIONID}/isBackgroundMap`]})})}const r=document.querySelector("#fog_backgrounds");n.length==0?r.style.display="none":r.style.display="block";const l=document.getElementsByClassName("token-table-entry"),f=[];for(const v of l){const m=v.id.slice(3);e.find(_=>_.id===m)===void 0&&f.push(v)}for(const v of f)v.remove();for(const v of e){const m=document.getElementById(`tr-${v.id}`);if(m){const _=m.getElementsByClassName("token-name")[0],x=m.getElementsByClassName("token-vision-range")[0],A=m.getElementsByClassName("unlimited-vision")[0],H=m.getElementsByClassName("no-vision")[0];_&&(_.innerText=v.name),x&&!A.checked&&!H.checked&&(x.value=v.metadata[`${I.EXTENSIONID}/visionRange`]?v.metadata[`${I.EXTENSIONID}/visionRange`]:I.VISIONDEFAULT),A&&(A.checked=v.metadata[`${I.EXTENSIONID}/visionRange`]===0),H&&(H.checked=v.metadata[`${I.EXTENSIONID}/visionBlind`]),A.checked||H.checked?x.setAttribute("disabled","disabled"):x.removeAttribute("disabled")}else{const _=R.items.find(S=>S.id===v.id),x=document.createElement("tr");x.id=`tr-${_.id}`,x.className="token-table-entry",x.innerHTML=`<td class="token-name">${_.name}</td>
                               <td><input class="token-vision-range" type="number" value=${I.VISIONDEFAULT}><span class="unit">ft</span></td>
                               <td>
                                <div class="cbutton"><label title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span>&infin;</span></label></div>
                                <div class="cbutton"><label title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span>&#128294;</span></label></div>
                                <div class="cbutton"><label title="Disable vision on this token"><input type="checkbox" class="no-vision"><span>None</span></label></div>
                               </td>`,_a.appendChild(x);const A=x.getElementsByClassName("token-vision-range")[0],H=x.getElementsByClassName("unlimited-vision")[0],N=x.getElementsByClassName("torch-vision")[0],M=x.getElementsByClassName("no-vision")[0];A&&!H.checked&&!M.checked&&(A.value=v.metadata[`${I.EXTENSIONID}/visionRange`]?v.metadata[`${I.EXTENSIONID}/visionRange`]:I.VISIONDEFAULT),H&&(H.checked=v.metadata[`${I.EXTENSIONID}/visionRange`]===0),N&&(N.checked=v.metadata[`${I.EXTENSIONID}/visionTorch`]),M&&(M.checked=v.metadata[`${I.EXTENSIONID}/visionBlind`]),H.checked||M.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),A.addEventListener("change",async S=>{if(!S||!S.target)return;const D=R.items.find(F=>F.id===v.id),C=S.target,B=parseInt(C.value);B<0&&(C.value="0"),B>999&&(C.value="999"),await $.scene.items.updateItems([D],F=>{F[0].metadata[`${I.EXTENSIONID}/visionRange`]=B})},!1),H.addEventListener("click",async S=>{if(!S||!S.target)return;const D=R.items.find(F=>F.id===v.id);let C=0;S.target.checked?(A.setAttribute("disabled","disabled"),M.checked=!1):(C=parseInt(A.value),A.removeAttribute("disabled")),await $.scene.items.updateItems([D],F=>{F[0].metadata[`${I.EXTENSIONID}/visionRange`]=C})},!1),M.addEventListener("click",async S=>{if(!S||!S.target)return;const D=R.items.find(B=>B.id===v.id),C=S.target;C.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),await $.scene.items.updateItems([D],B=>{B[0].metadata[`${I.EXTENSIONID}/visionBlind`]=C.checked})},!1),N.addEventListener("click",async S=>{if(!S||!S.target)return;const D=R.items.find(B=>B.id===v.id),C=S.target;await $.scene.items.updateItems([D],B=>{B[0].metadata[`${I.EXTENSIONID}/visionTorch`]=C.checked})},!1),A.addEventListener("mousewheel",async()=>{})}}}function mr(){let i;return R.items.filter(Bi).length==0&&(i=vt().width(R.gridDpi*30).height(R.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),i.metadata[`${I.EXTENSIONID}/isBackgroundImage`]=!0,i.id=I.GRIDID,R.items.push(i)),i}async function Mi(i){let e,t;[R.items,R.metadata,R.gridDpi,R.gridScale,e,t]=await Promise.all([$.scene.items.getItems(),$.scene.getMetadata(),$.scene.grid.getDpi(),$.scene.grid.getScale(),$.scene.fog.getFilled(),$.scene.fog.getColor()]),await $.scene.items.deleteItems(R.items.filter(gt).map(r=>r.id)),R.snap=!0,R.gridScale=R.gridScale.parsed.multiplier,R.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(R.items.filter(Rr).length==0){const r=R.items.filter(f=>f.layer=="MAP"&&f.type=="IMAGE"),l=r.map(f=>f.image.width*f.image.height/Math.pow(f.grid.dpi,2));n=r[l.indexOf(Math.max(...l))]}let o;if(R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]===void 0?(kt.checked=!0,await $.scene.setMetadata({[`${I.EXTENSIONID}/autodetectEnabled`]:!0})):R.metadata[`${I.EXTENSIONID}/autodetectEnabled`]===!1&&(o=mr()),R.metadata[`${I.EXTENSIONID}/sceneId`]===void 0)await $.scene.setMetadata({[`${I.EXTENSIONID}/sceneId`]:crypto.randomUUID()});else try{const r=R.metadata[`${I.EXTENSIONID}/sceneId`],l=localStorage.getItem(`${I.EXTENSIONID}/fogCache/${R.userId}/${r}`);if(l!==null&&R.metadata[`${I.EXTENSIONID}/persistenceEnabled`]===!0){const f=JSON.parse(l);console.log("unfreezing "+f.length+" fog paths from localStorage");const v=[];for(let m=0;m<f.length;m++){const _=Tt().commands(f[m].commands).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${I.EXTENSIONID}/isVisionFog`]:!0,[`${I.EXTENSIONID}/digest`]:f[m].digest}).build();_.zIndex=3,v.push($.scene.local.addItems([_]))}await Promise.all(v)}}catch{}if(i=="GM"){await ma(),o&&await $.scene.items.addItems([o]),ka.onclick=async()=>{await $.scene.items.updateItems([I.GRIDID],l=>{for(const f of l){const v=f;v.width=R.gridDpi*+Na.value,v.height=R.gridDpi*+Oa.value,v.scale={x:1,y:1}}})};const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await $.modal.open({id:I.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},zt(R.items),it({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),n!==void 0&&await $.scene.items.updateItems([n],l=>{l[0].metadata[`${I.EXTENSIONID}/isBackgroundImage`]=!0})}}async function Ri(){try{localStorage.setItem("STORAGECHECK","test")}catch{const e=document.getElementById("localStorageWarning");e.innerText="Local Storage disabled. Some features will not function."}}async function Ba(i){const e=document.getElementById("playerOwnedTokens"),t=[];for(const n of i)if(qn(n)&&n.createdUserId===R.userId){const o=n.metadata[`${I.EXTENSIONID}/hasVision`]!==void 0;t.push(`<li>${n.name}${o?"":": <b>Vision Disabled</b>"}</li>`)}t.length===0&&t.push("<li>None found.</li>"),e.innerHTML=`<ul>${t.join("")}</ul>`}$.onReady(async()=>{const i=await $.theme.getTheme();Pi(i,document),await $.player.getRole().then(async e=>{if(e=="GM")R.role="GM",await Ri(),await Fa(),await ao(),await so(),await lo(),await ya();else{Yn.innerHTML=`<div class="title">Configuration via GM.
            <div class="tooltip" id="helpButton" title="Need Help?"></div>
            </div>
            <hr><sub>You must have ownership of a token to see it.</sub></br></br>Tokens Owned By You:<div id="playerOwnedTokens"></div><div id="localStorageWarning"></div>`,await Ri(),await $.action.setHeight(300),await $.action.setWidth(350);const t=document.getElementById("helpButton"),n=document.createElement("input");n.classList.add("clickable"),n.src="/help.svg",n.height=15,n.width=15,n.type="image",n.title="Need Help?",n.onclick=async function(){await $.modal.open({id:I.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html?gethelp=true",height:500,width:350})},t.appendChild(n)}$.scene.fog.onChange(t=>{R.fog=t}),$.player.onChange(async t=>{const n=document.querySelectorAll(".token-table-entry");for(let o of n){let r=o.id.substring(3);t.selection!==void 0&&t.selection.includes(r)?o.classList.add("token-table-selected"):o.classList.remove("token-table-selected")}t.selection!==void 0&&t.selection.length===1&&io(t.selection[0])}),$.scene.items.onChange(async t=>{const n=t;R.items=n,R.ready&&(e=="GM"?(zt(n),await Di(Hn)):Ba(t),await ht())}),R.userId=await $.player.getId(),R.players=await $.party.getPlayers(),$.party.onChange(async t=>{R.players=t,e==="PLAYER"?await ha(t):ga()}),$.scene.grid.onChange(async t=>{R.gridDpi=t.dpi,R.gridScale=parseInt(t.scale),R.ready&&await ht()}),$.scene.onMetadataChange(async t=>{if(t[`${I.EXTENSIONID}/forceReset`]===!0){const n=await $.scene.local.getItems(Fn);$.scene.local.deleteItems(n.map(r=>r.id));const o=R.metadata[`${I.EXTENSIONID}/sceneId`];localStorage.removeItem(`${I.EXTENSIONID}/fogCache/${R.userId}/${o}`),ht(!0)}else R.metadata=t,R.ready&&await ht()}),$.scene.onReadyChange(async t=>{R.ready=t,t?(await Mi(e),await ht()):e=="GM"&&zt([])}),R.ready=await $.scene.isReady(),R.ready?(await Mi(e),await ht(),e=="GM"&&await Di(Hn)):e=="GM"&&zt([]),$.theme.onChange(t=>{Pi(t,document)})})});
