/* empty css              */import{C as o,O as m,P as ve,c as Oe,d as Je,b as Ea,a as vs,e as ys,f as Nn,L as ct,g as Es,h as Is,i as Ue,j as un,k as ws}from"./bsConstants-BBf8oFU1.js";const We=(()=>{/*!
* Copyright (c) 2021-2024 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.24.0
* NPM: https://github.com/melloware/coloris-npm
*/return((n,e,t,a)=>{const i=e.createElement("canvas").getContext("2d"),s={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let d,l,c,f,g,y,N,D,k,M,P,F,$,G,r,p,u={};const h={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>a,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},b={};let E="",I={},w=!1;function _(S){if(typeof S=="object")for(const X in S)switch(X){case"el":R(S.el),S.wrap!==!1&&Q(S.el);break;case"parent":d=S.parent instanceof HTMLElement?S.parent:e.querySelector(S.parent),d&&(d.appendChild(l),h.parent=S.parent,d===e.body&&(d=a));break;case"themeMode":h.themeMode=S.themeMode,S.themeMode==="auto"&&n.matchMedia&&n.matchMedia("(prefers-color-scheme: dark)").matches&&(h.themeMode="dark");case"theme":S.theme&&(h.theme=S.theme),l.className="clr-picker clr-"+h.theme+" clr-"+h.themeMode,h.inline&&j();break;case"rtl":h.rtl=!!S.rtl,Array.from(e.getElementsByClassName("clr-field")).forEach(O=>O.classList.toggle("clr-rtl",h.rtl));break;case"margin":S.margin*=1,h.margin=isNaN(S.margin)?h.margin:S.margin;break;case"wrap":S.el&&S.wrap&&Q(S.el);break;case"formatToggle":h.formatToggle=!!S.formatToggle,me("clr-format").style.display=h.formatToggle?"block":"none",h.formatToggle&&(h.format="auto");break;case"swatches":if(Array.isArray(S.swatches)){const O=me("clr-swatches"),B=e.createElement("div");O.textContent="",S.swatches.forEach((Y,Z)=>{const K=e.createElement("button");K.setAttribute("type","button"),K.setAttribute("id","clr-swatch-"+Z),K.setAttribute("aria-labelledby","clr-swatch-label clr-swatch-"+Z),K.style.color=Y,K.textContent=Y,B.appendChild(K)}),S.swatches.length&&O.appendChild(B),h.swatches=S.swatches.slice()}break;case"swatchesOnly":h.swatchesOnly=!!S.swatchesOnly,l.setAttribute("data-minimal",h.swatchesOnly);break;case"alpha":h.alpha=!!S.alpha,l.setAttribute("data-alpha",h.alpha);break;case"inline":if(h.inline=!!S.inline,l.setAttribute("data-inline",h.inline),h.inline){const O=S.defaultColor||h.defaultColor;G=ee(O),j(),de(O)}break;case"clearButton":typeof S.clearButton=="object"&&(S.clearButton.label&&(h.clearLabel=S.clearButton.label,N.innerHTML=h.clearLabel),S.clearButton=S.clearButton.show),h.clearButton=!!S.clearButton,N.style.display=h.clearButton?"block":"none";break;case"clearLabel":h.clearLabel=S.clearLabel,N.innerHTML=h.clearLabel;break;case"closeButton":h.closeButton=!!S.closeButton,h.closeButton?l.insertBefore(D,g):g.appendChild(D);break;case"closeLabel":h.closeLabel=S.closeLabel,D.innerHTML=h.closeLabel;break;case"a11y":const V=S.a11y;let q=!1;if(typeof V=="object")for(const O in V)V[O]&&h.a11y[O]&&(h.a11y[O]=V[O],q=!0);if(q){const O=me("clr-open-label"),B=me("clr-swatch-label");O.innerHTML=h.a11y.open,B.innerHTML=h.a11y.swatch,D.setAttribute("aria-label",h.a11y.close),N.setAttribute("aria-label",h.a11y.clear),k.setAttribute("aria-label",h.a11y.hueSlider),P.setAttribute("aria-label",h.a11y.alphaSlider),y.setAttribute("aria-label",h.a11y.input),c.setAttribute("aria-label",h.a11y.instruction)}break;default:h[X]=S[X]}}function C(S,X){typeof S=="string"&&typeof X=="object"&&(b[S]=X,w=!0)}function L(S){delete b[S],Object.keys(b).length===0&&(w=!1,S===E&&T())}function x(S){if(w){const X=["el","wrap","rtl","inline","defaultColor","a11y"];for(let V in b){const q=b[V];if(S.matches(V)){E=V,I={},X.forEach(O=>delete q[O]);for(let O in q)I[O]=Array.isArray(h[O])?h[O].slice():h[O];_(q);break}}}}function T(){Object.keys(I).length>0&&(_(I),E="",I={})}function R(S){S instanceof HTMLElement&&(S=[S]),Array.isArray(S)?S.forEach(X=>{re(X,"click",U),re(X,"input",J)}):(re(e,"click",S,U),re(e,"input",S,J))}function U(S){h.inline||(x(S.target),$=S.target,r=$.value,G=ee(r),l.classList.add("clr-open"),j(),de(r),(h.focusInput||h.selectInput)&&(y.focus({preventScroll:!0}),y.setSelectionRange($.selectionStart,$.selectionEnd)),h.selectInput&&y.select(),(p||h.swatchesOnly)&&lt().shift().focus(),$.dispatchEvent(new Event("open",{bubbles:!0})))}function j(){if(!l||!$&&!h.inline)return;const S=d,X=n.scrollY,V=l.offsetWidth,q=l.offsetHeight,O={left:!1,top:!1};let B,Y,Z,K={x:0,y:0};if(S&&(B=n.getComputedStyle(S),Y=parseFloat(B.marginTop),Z=parseFloat(B.borderTopWidth),K=S.getBoundingClientRect(),K.y+=Z+X),!h.inline){const oe=$.getBoundingClientRect();let ge=oe.x,Se=X+oe.y+oe.height+h.margin;S?(ge-=K.x,Se-=K.y,ge+V>S.clientWidth&&(ge+=oe.width-V,O.left=!0),Se+q>S.clientHeight-Y&&q+h.margin<=oe.top-(K.y-X)&&(Se-=oe.height+q+h.margin*2,O.top=!0),Se+=S.scrollTop):(ge+V>e.documentElement.clientWidth&&(ge+=oe.width-V,O.left=!0),Se+q-X>e.documentElement.clientHeight&&q+h.margin<=oe.top&&(Se=X+oe.y-q-h.margin,O.top=!0)),l.classList.toggle("clr-left",O.left),l.classList.toggle("clr-top",O.top),l.style.left=ge+"px",l.style.top=Se+"px",K.x+=l.offsetLeft,K.y+=l.offsetTop}u={width:c.offsetWidth,height:c.offsetHeight,x:c.offsetLeft+K.x,y:c.offsetTop+K.y}}function Q(S){S instanceof HTMLElement?W(S):Array.isArray(S)?S.forEach(W):e.querySelectorAll(S).forEach(W)}function W(S){const X=S.parentNode;if(!X.classList.contains("clr-field")){const V=e.createElement("div");let q="clr-field";(h.rtl||S.classList.contains("clr-rtl"))&&(q+=" clr-rtl"),V.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',X.insertBefore(V,S),V.className=q,V.style.color=S.value,V.appendChild(S)}}function J(S){const X=S.target.parentNode;X.classList.contains("clr-field")&&(X.style.color=S.target.value)}function te(S){if($&&!h.inline){const X=$;S&&($=a,r!==X.value&&(X.value=r,X.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(()=>{r!==X.value&&X.dispatchEvent(new Event("change",{bubbles:!0}))}),l.classList.remove("clr-open"),w&&T(),X.dispatchEvent(new Event("close",{bubbles:!0})),h.focusInput&&X.focus({preventScroll:!0}),$=a}}function de(S){const X=Ot(S),V=Nt(X);A(V.s,V.v),ce(X,V),k.value=V.h,l.style.color="hsl("+V.h+", 100%, 50%)",M.style.left=V.h/360*100+"%",f.style.left=u.width*V.s/100+"px",f.style.top=u.height-u.height*V.v/100+"px",P.value=V.a*100,F.style.left=V.a*100+"%"}function ee(S){const X=S.substring(0,3).toLowerCase();return X==="rgb"||X==="hsl"?X:"hex"}function ie(S){S=S!==a?S:y.value,$&&($.value=S,$.dispatchEvent(new Event("input",{bubbles:!0}))),h.onChange&&h.onChange.call(n,S,$),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:S,currentEl:$}}))}function le(S,X){const V={h:k.value*1,s:S/u.width*100,v:100-X/u.height*100,a:P.value/100},q=gt(V);A(V.s,V.v),ce(q,V),ie()}function A(S,X){let V=h.a11y.marker;S=S.toFixed(1)*1,X=X.toFixed(1)*1,V=V.replace("{s}",S),V=V.replace("{v}",X),f.setAttribute("aria-label",V)}function H(S){return{pageX:S.changedTouches?S.changedTouches[0].pageX:S.pageX,pageY:S.changedTouches?S.changedTouches[0].pageY:S.pageY}}function z(S){const X=H(S);let V=X.pageX-u.x,q=X.pageY-u.y;d&&(q+=d.scrollTop),se(V,q),S.preventDefault(),S.stopPropagation()}function ue(S,X){let V=f.style.left.replace("px","")*1+S,q=f.style.top.replace("px","")*1+X;se(V,q)}function se(S,X){S=S<0?0:S>u.width?u.width:S,X=X<0?0:X>u.height?u.height:X,f.style.left=S+"px",f.style.top=X+"px",le(S,X),f.focus()}function ce(S,X){S===void 0&&(S={}),X===void 0&&(X={});let V=h.format;for(const B in S)s[B]=S[B];for(const B in X)s[B]=X[B];const q=Fe(s),O=q.substring(0,7);switch(f.style.color=O,F.parentNode.style.color=O,F.style.color=q,g.style.color=q,c.style.display="none",c.offsetHeight,c.style.display="",F.nextElementSibling.style.display="none",F.nextElementSibling.offsetHeight,F.nextElementSibling.style.display="",V==="mixed"?V=s.a===1?"hex":"rgb":V==="auto"&&(V=G),V){case"hex":y.value=q;break;case"rgb":y.value=Ye(s);break;case"hsl":y.value=vt(mt(s));break}e.querySelector('.clr-format [value="'+V+'"]').checked=!0}function nt(){const S=k.value*1,X=f.style.left.replace("px","")*1,V=f.style.top.replace("px","")*1;l.style.color="hsl("+S+", 100%, 50%)",M.style.left=S/360*100+"%",le(X,V)}function dt(){const S=P.value/100;F.style.left=S*100+"%",ce({a:S}),ie()}function gt(S){const X=S.s/100,V=S.v/100;let q=X*V,O=S.h/60,B=q*(1-t.abs(O%2-1)),Y=V-q;q=q+Y,B=B+Y;const Z=t.floor(O)%6,K=[q,B,Y,Y,B,q][Z],oe=[B,q,q,B,Y,Y][Z],ge=[Y,Y,B,q,q,B][Z];return{r:t.round(K*255),g:t.round(oe*255),b:t.round(ge*255),a:S.a}}function mt(S){const X=S.v/100,V=X*(1-S.s/100/2);let q;return V>0&&V<1&&(q=t.round((X-V)/t.min(V,1-V)*100)),{h:S.h,s:q||0,l:t.round(V*100),a:S.a}}function Nt(S){const X=S.r/255,V=S.g/255,q=S.b/255,O=t.max(X,V,q),B=t.min(X,V,q),Y=O-B,Z=O;let K=0,oe=0;return Y&&(O===X&&(K=(V-q)/Y),O===V&&(K=2+(q-X)/Y),O===q&&(K=4+(X-V)/Y),O&&(oe=Y/O)),K=t.floor(K*60),{h:K<0?K+360:K,s:t.round(oe*100),v:t.round(Z*100),a:S.a}}function Ot(S){const X=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let V,q;return i.fillStyle="#000",i.fillStyle=S,V=X.exec(i.fillStyle),V?q={r:V[3]*1,g:V[4]*1,b:V[5]*1,a:V[6]*1}:(V=i.fillStyle.replace("#","").match(/.{2}/g).map(O=>parseInt(O,16)),q={r:V[0],g:V[1],b:V[2],a:1}),q}function Fe(S){let X=S.r.toString(16),V=S.g.toString(16),q=S.b.toString(16),O="";if(S.r<16&&(X="0"+X),S.g<16&&(V="0"+V),S.b<16&&(q="0"+q),h.alpha&&(S.a<1||h.forceAlpha)){const B=S.a*255|0;O=B.toString(16),B<16&&(O="0"+O)}return"#"+X+V+q+O}function Ye(S){return!h.alpha||S.a===1&&!h.forceAlpha?"rgb("+S.r+", "+S.g+", "+S.b+")":"rgba("+S.r+", "+S.g+", "+S.b+", "+S.a+")"}function vt(S){return!h.alpha||S.a===1&&!h.forceAlpha?"hsl("+S.h+", "+S.s+"%, "+S.l+"%)":"hsla("+S.h+", "+S.s+"%, "+S.l+"%, "+S.a+")"}function it(){e.getElementById("clr-picker")||(d=a,l=e.createElement("div"),l.setAttribute("id","clr-picker"),l.className="clr-picker",l.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+h.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+h.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+h.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+h.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+h.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+h.a11y.clear+'">'+h.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+h.a11y.close+'">'+h.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+h.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+h.a11y.swatch+"</span>"),e.body.appendChild(l),c=me("clr-color-area"),f=me("clr-color-marker"),N=me("clr-clear"),D=me("clr-close"),g=me("clr-color-preview"),y=me("clr-color-value"),k=me("clr-hue-slider"),M=me("clr-hue-marker"),P=me("clr-alpha-slider"),F=me("clr-alpha-marker"),R(h.el),Q(h.el),re(l,"mousedown",S=>{l.classList.remove("clr-keyboard-nav"),S.stopPropagation()}),re(c,"mousedown",S=>{re(e,"mousemove",z)}),re(c,"contextmenu",S=>{S.preventDefault()}),re(c,"touchstart",S=>{e.addEventListener("touchmove",z,{passive:!1})}),re(f,"mousedown",S=>{re(e,"mousemove",z)}),re(f,"touchstart",S=>{e.addEventListener("touchmove",z,{passive:!1})}),re(y,"change",S=>{const X=y.value;if($||h.inline){const V=X===""?X:de(X);ie(V)}}),re(N,"click",S=>{ie(""),te()}),re(D,"click",S=>{ie(),te()}),re(me("clr-format"),"click",".clr-format input",S=>{G=S.target.value,ce(),ie()}),re(l,"click",".clr-swatches button",S=>{de(S.target.textContent),ie(),h.swatchesOnly&&te()}),re(e,"mouseup",S=>{e.removeEventListener("mousemove",z)}),re(e,"touchend",S=>{e.removeEventListener("touchmove",z)}),re(e,"mousedown",S=>{p=!1,l.classList.remove("clr-keyboard-nav"),te()}),re(e,"keydown",S=>{const X=S.key,V=S.target,q=S.shiftKey;if(X==="Escape"?te(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(X)&&(p=!0,l.classList.add("clr-keyboard-nav")),X==="Tab"&&V.matches(".clr-picker *")){const B=lt(),Y=B.shift(),Z=B.pop();q&&V===Y?(Z.focus(),S.preventDefault()):!q&&V===Z&&(Y.focus(),S.preventDefault())}}),re(e,"click",".clr-field button",S=>{w&&T(),S.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),re(f,"keydown",S=>{const X={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(X).includes(S.key)&&(ue(...X[S.key]),S.preventDefault())}),re(c,"click",z),re(k,"input",nt),re(P,"input",dt))}function lt(){return Array.from(l.querySelectorAll("input, button")).filter(V=>!!V.offsetWidth)}function me(S){return e.getElementById(S)}function re(S,X,V,q){const O=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof V=="string"?S.addEventListener(X,B=>{O.call(B.target,V)&&q.call(B.target,B)}):(q=V,S.addEventListener(X,q))}function st(S,X){X=X!==a?X:[],e.readyState!=="loading"?S(...X):e.addEventListener("DOMContentLoaded",()=>{S(...X)})}NodeList!==a&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function Dt(S,X){$=X,r=$.value,x(X),G=ee(S),j(),de(S),ie(),r!==S&&$.dispatchEvent(new Event("change",{bubbles:!0}))}const Bt=(()=>{const S={init:it,set:_,wrap:Q,close:te,setInstance:C,setColor:Dt,removeInstance:L,updatePosition:j,ready:st};function X(V){st(()=>{V&&(typeof V=="string"?R(V):_(V))})}for(const V in S)X[V]=function(){for(var q=arguments.length,O=new Array(q),B=0;B<q;B++)O[B]=arguments[B];st(S[V],O)};return st(()=>{n.addEventListener("resize",V=>{X.updatePosition()}),n.addEventListener("scroll",V=>{X.updatePosition()})}),X})();return Bt.coloris=Bt,Bt})(window,document,Math)})();We.coloris;We.init;We.set;We.wrap;We.close;We.setInstance;We.removeInstance;We.updatePosition;function bs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ga={exports:{}},Ts=ga.exports,On;function Ss(){return On||(On=1,(function(n){(function(){function e(r){var p={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `Â«Â«Â«` and `Â»Â»Â»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(r===!1)return JSON.parse(JSON.stringify(p));var u={};for(var h in p)p.hasOwnProperty(h)&&(u[h]=p[h].defaultValue);return u}function t(){var r=e(!0),p={};for(var u in r)r.hasOwnProperty(u)&&(p[u]=!0);return p}var a={},i={},s={},d=e(!0),l="vanilla",c={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:t()};a.helper={},a.extensions={},a.setOption=function(r,p){return d[r]=p,this},a.getOption=function(r){return d[r]},a.getOptions=function(){return d},a.resetOptions=function(){d=e(!0)},a.setFlavor=function(r){if(!c.hasOwnProperty(r))throw Error(r+" flavor was not found");a.resetOptions();var p=c[r];l=r;for(var u in p)p.hasOwnProperty(u)&&(d[u]=p[u])},a.getFlavor=function(){return l},a.getFlavorOptions=function(r){if(c.hasOwnProperty(r))return c[r]},a.getDefaultOptions=function(r){return e(r)},a.subParser=function(r,p){if(a.helper.isString(r))if(typeof p<"u")i[r]=p;else{if(i.hasOwnProperty(r))return i[r];throw Error("SubParser named "+r+" not registered!")}},a.extension=function(r,p){if(!a.helper.isString(r))throw Error("Extension 'name' must be a string");if(r=a.helper.stdExtName(r),a.helper.isUndefined(p)){if(!s.hasOwnProperty(r))throw Error("Extension named "+r+" is not registered!");return s[r]}else{typeof p=="function"&&(p=p()),a.helper.isArray(p)||(p=[p]);var u=f(p,r);if(u.valid)s[r]=p;else throw Error(u.error)}},a.getAllExtensions=function(){return s},a.removeExtension=function(r){delete s[r]},a.resetExtensions=function(){s={}};function f(r,p){var u=p?"Error in "+p+" extension->":"Error in unnamed extension",h={valid:!0,error:""};a.helper.isArray(r)||(r=[r]);for(var b=0;b<r.length;++b){var E=u+" sub-extension "+b+": ",I=r[b];if(typeof I!="object")return h.valid=!1,h.error=E+"must be an object, but "+typeof I+" given",h;if(!a.helper.isString(I.type))return h.valid=!1,h.error=E+'property "type" must be a string, but '+typeof I.type+" given",h;var w=I.type=I.type.toLowerCase();if(w==="language"&&(w=I.type="lang"),w==="html"&&(w=I.type="output"),w!=="lang"&&w!=="output"&&w!=="listener")return h.valid=!1,h.error=E+"type "+w+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',h;if(w==="listener"){if(a.helper.isUndefined(I.listeners))return h.valid=!1,h.error=E+'. Extensions of type "listener" must have a property called "listeners"',h}else if(a.helper.isUndefined(I.filter)&&a.helper.isUndefined(I.regex))return h.valid=!1,h.error=E+w+' extensions must define either a "regex" property or a "filter" method',h;if(I.listeners){if(typeof I.listeners!="object")return h.valid=!1,h.error=E+'"listeners" property must be an object but '+typeof I.listeners+" given",h;for(var _ in I.listeners)if(I.listeners.hasOwnProperty(_)&&typeof I.listeners[_]!="function")return h.valid=!1,h.error=E+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+_+" must be a function but "+typeof I.listeners[_]+" given",h}if(I.filter){if(typeof I.filter!="function")return h.valid=!1,h.error=E+'"filter" must be a function, but '+typeof I.filter+" given",h}else if(I.regex){if(a.helper.isString(I.regex)&&(I.regex=new RegExp(I.regex,"g")),!(I.regex instanceof RegExp))return h.valid=!1,h.error=E+'"regex" property must either be a string or a RegExp object, but '+typeof I.regex+" given",h;if(a.helper.isUndefined(I.replace))return h.valid=!1,h.error=E+'"regex" extensions must implement a replace string or function',h}}return h}a.validateExtension=function(r){var p=f(r,null);return p.valid?!0:(console.warn(p.error),!1)},a.hasOwnProperty("helper")||(a.helper={}),a.helper.isString=function(r){return typeof r=="string"||r instanceof String},a.helper.isFunction=function(r){var p={};return r&&p.toString.call(r)==="[object Function]"},a.helper.isArray=function(r){return Array.isArray(r)},a.helper.isUndefined=function(r){return typeof r>"u"},a.helper.forEach=function(r,p){if(a.helper.isUndefined(r))throw new Error("obj param is required");if(a.helper.isUndefined(p))throw new Error("callback param is required");if(!a.helper.isFunction(p))throw new Error("callback param must be a function/closure");if(typeof r.forEach=="function")r.forEach(p);else if(a.helper.isArray(r))for(var u=0;u<r.length;u++)p(r[u],u,r);else if(typeof r=="object")for(var h in r)r.hasOwnProperty(h)&&p(r[h],h,r);else throw new Error("obj does not seem to be an array or an iterable object")},a.helper.stdExtName=function(r){return r.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function g(r,p){var u=p.charCodeAt(0);return"Â¨E"+u+"E"}a.helper.escapeCharactersCallback=g,a.helper.escapeCharacters=function(r,p,u){var h="(["+p.replace(/([\[\]\\])/g,"\\$1")+"])";u&&(h="\\\\"+h);var b=new RegExp(h,"g");return r=r.replace(b,g),r},a.helper.unescapeHTMLEntities=function(r){return r.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var y=function(r,p,u,h){var b=h||"",E=b.indexOf("g")>-1,I=new RegExp(p+"|"+u,"g"+b.replace(/g/g,"")),w=new RegExp(p,b.replace(/g/g,"")),_=[],C,L,x,T,R;do for(C=0;x=I.exec(r);)if(w.test(x[0]))C++||(L=I.lastIndex,T=L-x[0].length);else if(C&&!--C){R=x.index+x[0].length;var U={left:{start:T,end:L},match:{start:L,end:x.index},right:{start:x.index,end:R},wholeMatch:{start:T,end:R}};if(_.push(U),!E)return _}while(C&&(I.lastIndex=L));return _};a.helper.matchRecursiveRegExp=function(r,p,u,h){for(var b=y(r,p,u,h),E=[],I=0;I<b.length;++I)E.push([r.slice(b[I].wholeMatch.start,b[I].wholeMatch.end),r.slice(b[I].match.start,b[I].match.end),r.slice(b[I].left.start,b[I].left.end),r.slice(b[I].right.start,b[I].right.end)]);return E},a.helper.replaceRecursiveRegExp=function(r,p,u,h,b){if(!a.helper.isFunction(p)){var E=p;p=function(){return E}}var I=y(r,u,h,b),w=r,_=I.length;if(_>0){var C=[];I[0].wholeMatch.start!==0&&C.push(r.slice(0,I[0].wholeMatch.start));for(var L=0;L<_;++L)C.push(p(r.slice(I[L].wholeMatch.start,I[L].wholeMatch.end),r.slice(I[L].match.start,I[L].match.end),r.slice(I[L].left.start,I[L].left.end),r.slice(I[L].right.start,I[L].right.end))),L<_-1&&C.push(r.slice(I[L].wholeMatch.end,I[L+1].wholeMatch.start));I[_-1].wholeMatch.end<r.length&&C.push(r.slice(I[_-1].wholeMatch.end)),w=C.join("")}return w},a.helper.regexIndexOf=function(r,p,u){if(!a.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(p instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var h=r.substring(u||0).search(p);return h>=0?h+(u||0):h},a.helper.splitAtIndex=function(r,p){if(!a.helper.isString(r))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[r.substring(0,p),r.substring(p)]},a.helper.encodeEmailAddress=function(r){var p=[function(u){return"&#"+u.charCodeAt(0)+";"},function(u){return"&#x"+u.charCodeAt(0).toString(16)+";"},function(u){return u}];return r=r.replace(/./g,function(u){if(u==="@")u=p[Math.floor(Math.random()*2)](u);else{var h=Math.random();u=h>.9?p[2](u):h>.45?p[1](u):p[0](u)}return u}),r},a.helper.padEnd=function(p,u,h){return u=u>>0,h=String(h||" "),p.length>u?String(p):(u=u-p.length,u>h.length&&(h+=h.repeat(u/h.length)),String(p)+h.slice(0,u))},typeof console>"u"&&(console={warn:function(r){alert(r)},log:function(r){alert(r)},error:function(r){throw r}}),a.helper.regexes={asteriskDashAndColon:/([*_:~])/g},a.helper.emojis={"+1":"ğŸ‘","-1":"ğŸ‘",100:"ğŸ’¯",1234:"ğŸ”¢","1st_place_medal":"ğŸ¥‡","2nd_place_medal":"ğŸ¥ˆ","3rd_place_medal":"ğŸ¥‰","8ball":"ğŸ±",a:"ğŸ…°ï¸",ab:"ğŸ†",abc:"ğŸ”¤",abcd:"ğŸ”¡",accept:"ğŸ‰‘",aerial_tramway:"ğŸš¡",airplane:"âœˆï¸",alarm_clock:"â°",alembic:"âš—ï¸",alien:"ğŸ‘½",ambulance:"ğŸš‘",amphora:"ğŸº",anchor:"âš“ï¸",angel:"ğŸ‘¼",anger:"ğŸ’¢",angry:"ğŸ˜ ",anguished:"ğŸ˜§",ant:"ğŸœ",apple:"ğŸ",aquarius:"â™’ï¸",aries:"â™ˆï¸",arrow_backward:"â—€ï¸",arrow_double_down:"â¬",arrow_double_up:"â«",arrow_down:"â¬‡ï¸",arrow_down_small:"ğŸ”½",arrow_forward:"â–¶ï¸",arrow_heading_down:"â¤µï¸",arrow_heading_up:"â¤´ï¸",arrow_left:"â¬…ï¸",arrow_lower_left:"â†™ï¸",arrow_lower_right:"â†˜ï¸",arrow_right:"â¡ï¸",arrow_right_hook:"â†ªï¸",arrow_up:"â¬†ï¸",arrow_up_down:"â†•ï¸",arrow_up_small:"ğŸ”¼",arrow_upper_left:"â†–ï¸",arrow_upper_right:"â†—ï¸",arrows_clockwise:"ğŸ”ƒ",arrows_counterclockwise:"ğŸ”„",art:"ğŸ¨",articulated_lorry:"ğŸš›",artificial_satellite:"ğŸ›°",astonished:"ğŸ˜²",athletic_shoe:"ğŸ‘Ÿ",atm:"ğŸ§",atom_symbol:"âš›ï¸",avocado:"ğŸ¥‘",b:"ğŸ…±ï¸",baby:"ğŸ‘¶",baby_bottle:"ğŸ¼",baby_chick:"ğŸ¤",baby_symbol:"ğŸš¼",back:"ğŸ”™",bacon:"ğŸ¥“",badminton:"ğŸ¸",baggage_claim:"ğŸ›„",baguette_bread:"ğŸ¥–",balance_scale:"âš–ï¸",balloon:"ğŸˆ",ballot_box:"ğŸ—³",ballot_box_with_check:"â˜‘ï¸",bamboo:"ğŸ",banana:"ğŸŒ",bangbang:"â€¼ï¸",bank:"ğŸ¦",bar_chart:"ğŸ“Š",barber:"ğŸ’ˆ",baseball:"âš¾ï¸",basketball:"ğŸ€",basketball_man:"â›¹ï¸",basketball_woman:"â›¹ï¸&zwj;â™€ï¸",bat:"ğŸ¦‡",bath:"ğŸ›€",bathtub:"ğŸ›",battery:"ğŸ”‹",beach_umbrella:"ğŸ–",bear:"ğŸ»",bed:"ğŸ›",bee:"ğŸ",beer:"ğŸº",beers:"ğŸ»",beetle:"ğŸ",beginner:"ğŸ”°",bell:"ğŸ””",bellhop_bell:"ğŸ›",bento:"ğŸ±",biking_man:"ğŸš´",bike:"ğŸš²",biking_woman:"ğŸš´&zwj;â™€ï¸",bikini:"ğŸ‘™",biohazard:"â˜£ï¸",bird:"ğŸ¦",birthday:"ğŸ‚",black_circle:"âš«ï¸",black_flag:"ğŸ´",black_heart:"ğŸ–¤",black_joker:"ğŸƒ",black_large_square:"â¬›ï¸",black_medium_small_square:"â—¾ï¸",black_medium_square:"â—¼ï¸",black_nib:"âœ’ï¸",black_small_square:"â–ªï¸",black_square_button:"ğŸ”²",blonde_man:"ğŸ‘±",blonde_woman:"ğŸ‘±&zwj;â™€ï¸",blossom:"ğŸŒ¼",blowfish:"ğŸ¡",blue_book:"ğŸ“˜",blue_car:"ğŸš™",blue_heart:"ğŸ’™",blush:"ğŸ˜Š",boar:"ğŸ—",boat:"â›µï¸",bomb:"ğŸ’£",book:"ğŸ“–",bookmark:"ğŸ”–",bookmark_tabs:"ğŸ“‘",books:"ğŸ“š",boom:"ğŸ’¥",boot:"ğŸ‘¢",bouquet:"ğŸ’",bowing_man:"ğŸ™‡",bow_and_arrow:"ğŸ¹",bowing_woman:"ğŸ™‡&zwj;â™€ï¸",bowling:"ğŸ³",boxing_glove:"ğŸ¥Š",boy:"ğŸ‘¦",bread:"ğŸ",bride_with_veil:"ğŸ‘°",bridge_at_night:"ğŸŒ‰",briefcase:"ğŸ’¼",broken_heart:"ğŸ’”",bug:"ğŸ›",building_construction:"ğŸ—",bulb:"ğŸ’¡",bullettrain_front:"ğŸš…",bullettrain_side:"ğŸš„",burrito:"ğŸŒ¯",bus:"ğŸšŒ",business_suit_levitating:"ğŸ•´",busstop:"ğŸš",bust_in_silhouette:"ğŸ‘¤",busts_in_silhouette:"ğŸ‘¥",butterfly:"ğŸ¦‹",cactus:"ğŸŒµ",cake:"ğŸ°",calendar:"ğŸ“†",call_me_hand:"ğŸ¤™",calling:"ğŸ“²",camel:"ğŸ«",camera:"ğŸ“·",camera_flash:"ğŸ“¸",camping:"ğŸ•",cancer:"â™‹ï¸",candle:"ğŸ•¯",candy:"ğŸ¬",canoe:"ğŸ›¶",capital_abcd:"ğŸ” ",capricorn:"â™‘ï¸",car:"ğŸš—",card_file_box:"ğŸ—ƒ",card_index:"ğŸ“‡",card_index_dividers:"ğŸ—‚",carousel_horse:"ğŸ ",carrot:"ğŸ¥•",cat:"ğŸ±",cat2:"ğŸˆ",cd:"ğŸ’¿",chains:"â›“",champagne:"ğŸ¾",chart:"ğŸ’¹",chart_with_downwards_trend:"ğŸ“‰",chart_with_upwards_trend:"ğŸ“ˆ",checkered_flag:"ğŸ",cheese:"ğŸ§€",cherries:"ğŸ’",cherry_blossom:"ğŸŒ¸",chestnut:"ğŸŒ°",chicken:"ğŸ”",children_crossing:"ğŸš¸",chipmunk:"ğŸ¿",chocolate_bar:"ğŸ«",christmas_tree:"ğŸ„",church:"â›ªï¸",cinema:"ğŸ¦",circus_tent:"ğŸª",city_sunrise:"ğŸŒ‡",city_sunset:"ğŸŒ†",cityscape:"ğŸ™",cl:"ğŸ†‘",clamp:"ğŸ—œ",clap:"ğŸ‘",clapper:"ğŸ¬",classical_building:"ğŸ›",clinking_glasses:"ğŸ¥‚",clipboard:"ğŸ“‹",clock1:"ğŸ•",clock10:"ğŸ•™",clock1030:"ğŸ•¥",clock11:"ğŸ•š",clock1130:"ğŸ•¦",clock12:"ğŸ•›",clock1230:"ğŸ•§",clock130:"ğŸ•œ",clock2:"ğŸ•‘",clock230:"ğŸ•",clock3:"ğŸ•’",clock330:"ğŸ•",clock4:"ğŸ•“",clock430:"ğŸ•Ÿ",clock5:"ğŸ•”",clock530:"ğŸ• ",clock6:"ğŸ••",clock630:"ğŸ•¡",clock7:"ğŸ•–",clock730:"ğŸ•¢",clock8:"ğŸ•—",clock830:"ğŸ•£",clock9:"ğŸ•˜",clock930:"ğŸ•¤",closed_book:"ğŸ“•",closed_lock_with_key:"ğŸ”",closed_umbrella:"ğŸŒ‚",cloud:"â˜ï¸",cloud_with_lightning:"ğŸŒ©",cloud_with_lightning_and_rain:"â›ˆ",cloud_with_rain:"ğŸŒ§",cloud_with_snow:"ğŸŒ¨",clown_face:"ğŸ¤¡",clubs:"â™£ï¸",cocktail:"ğŸ¸",coffee:"â˜•ï¸",coffin:"âš°ï¸",cold_sweat:"ğŸ˜°",comet:"â˜„ï¸",computer:"ğŸ’»",computer_mouse:"ğŸ–±",confetti_ball:"ğŸŠ",confounded:"ğŸ˜–",confused:"ğŸ˜•",congratulations:"ãŠ—ï¸",construction:"ğŸš§",construction_worker_man:"ğŸ‘·",construction_worker_woman:"ğŸ‘·&zwj;â™€ï¸",control_knobs:"ğŸ›",convenience_store:"ğŸª",cookie:"ğŸª",cool:"ğŸ†’",policeman:"ğŸ‘®",copyright:"Â©ï¸",corn:"ğŸŒ½",couch_and_lamp:"ğŸ›‹",couple:"ğŸ‘«",couple_with_heart_woman_man:"ğŸ’‘",couple_with_heart_man_man:"ğŸ‘¨&zwj;â¤ï¸&zwj;ğŸ‘¨",couple_with_heart_woman_woman:"ğŸ‘©&zwj;â¤ï¸&zwj;ğŸ‘©",couplekiss_man_man:"ğŸ‘¨&zwj;â¤ï¸&zwj;ğŸ’‹&zwj;ğŸ‘¨",couplekiss_man_woman:"ğŸ’",couplekiss_woman_woman:"ğŸ‘©&zwj;â¤ï¸&zwj;ğŸ’‹&zwj;ğŸ‘©",cow:"ğŸ®",cow2:"ğŸ„",cowboy_hat_face:"ğŸ¤ ",crab:"ğŸ¦€",crayon:"ğŸ–",credit_card:"ğŸ’³",crescent_moon:"ğŸŒ™",cricket:"ğŸ",crocodile:"ğŸŠ",croissant:"ğŸ¥",crossed_fingers:"ğŸ¤",crossed_flags:"ğŸŒ",crossed_swords:"âš”ï¸",crown:"ğŸ‘‘",cry:"ğŸ˜¢",crying_cat_face:"ğŸ˜¿",crystal_ball:"ğŸ”®",cucumber:"ğŸ¥’",cupid:"ğŸ’˜",curly_loop:"â°",currency_exchange:"ğŸ’±",curry:"ğŸ›",custard:"ğŸ®",customs:"ğŸ›ƒ",cyclone:"ğŸŒ€",dagger:"ğŸ—¡",dancer:"ğŸ’ƒ",dancing_women:"ğŸ‘¯",dancing_men:"ğŸ‘¯&zwj;â™‚ï¸",dango:"ğŸ¡",dark_sunglasses:"ğŸ•¶",dart:"ğŸ¯",dash:"ğŸ’¨",date:"ğŸ“…",deciduous_tree:"ğŸŒ³",deer:"ğŸ¦Œ",department_store:"ğŸ¬",derelict_house:"ğŸš",desert:"ğŸœ",desert_island:"ğŸ",desktop_computer:"ğŸ–¥",male_detective:"ğŸ•µï¸",diamond_shape_with_a_dot_inside:"ğŸ’ ",diamonds:"â™¦ï¸",disappointed:"ğŸ˜",disappointed_relieved:"ğŸ˜¥",dizzy:"ğŸ’«",dizzy_face:"ğŸ˜µ",do_not_litter:"ğŸš¯",dog:"ğŸ¶",dog2:"ğŸ•",dollar:"ğŸ’µ",dolls:"ğŸ",dolphin:"ğŸ¬",door:"ğŸšª",doughnut:"ğŸ©",dove:"ğŸ•Š",dragon:"ğŸ‰",dragon_face:"ğŸ²",dress:"ğŸ‘—",dromedary_camel:"ğŸª",drooling_face:"ğŸ¤¤",droplet:"ğŸ’§",drum:"ğŸ¥",duck:"ğŸ¦†",dvd:"ğŸ“€","e-mail":"ğŸ“§",eagle:"ğŸ¦…",ear:"ğŸ‘‚",ear_of_rice:"ğŸŒ¾",earth_africa:"ğŸŒ",earth_americas:"ğŸŒ",earth_asia:"ğŸŒ",egg:"ğŸ¥š",eggplant:"ğŸ†",eight_pointed_black_star:"âœ´ï¸",eight_spoked_asterisk:"âœ³ï¸",electric_plug:"ğŸ”Œ",elephant:"ğŸ˜",email:"âœ‰ï¸",end:"ğŸ”š",envelope_with_arrow:"ğŸ“©",euro:"ğŸ’¶",european_castle:"ğŸ°",european_post_office:"ğŸ¤",evergreen_tree:"ğŸŒ²",exclamation:"â—ï¸",expressionless:"ğŸ˜‘",eye:"ğŸ‘",eye_speech_bubble:"ğŸ‘&zwj;ğŸ—¨",eyeglasses:"ğŸ‘“",eyes:"ğŸ‘€",face_with_head_bandage:"ğŸ¤•",face_with_thermometer:"ğŸ¤’",fist_oncoming:"ğŸ‘Š",factory:"ğŸ­",fallen_leaf:"ğŸ‚",family_man_woman_boy:"ğŸ‘ª",family_man_boy:"ğŸ‘¨&zwj;ğŸ‘¦",family_man_boy_boy:"ğŸ‘¨&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_girl:"ğŸ‘¨&zwj;ğŸ‘§",family_man_girl_boy:"ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_girl_girl:"ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘§",family_man_man_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘¦",family_man_man_boy_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_man_girl:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§",family_man_man_girl_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_man_girl_girl:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘§",family_man_woman_boy_boy:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_woman_girl:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§",family_man_woman_girl_boy:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_woman_girl_girl:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",family_woman_boy:"ğŸ‘©&zwj;ğŸ‘¦",family_woman_boy_boy:"ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_woman_girl:"ğŸ‘©&zwj;ğŸ‘§",family_woman_girl_boy:"ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_woman_girl_girl:"ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",family_woman_woman_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘¦",family_woman_woman_boy_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_woman_woman_girl:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§",family_woman_woman_girl_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_woman_woman_girl_girl:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",fast_forward:"â©",fax:"ğŸ“ ",fearful:"ğŸ˜¨",feet:"ğŸ¾",female_detective:"ğŸ•µï¸&zwj;â™€ï¸",ferris_wheel:"ğŸ¡",ferry:"â›´",field_hockey:"ğŸ‘",file_cabinet:"ğŸ—„",file_folder:"ğŸ“",film_projector:"ğŸ“½",film_strip:"ğŸ",fire:"ğŸ”¥",fire_engine:"ğŸš’",fireworks:"ğŸ†",first_quarter_moon:"ğŸŒ“",first_quarter_moon_with_face:"ğŸŒ›",fish:"ğŸŸ",fish_cake:"ğŸ¥",fishing_pole_and_fish:"ğŸ£",fist_raised:"âœŠ",fist_left:"ğŸ¤›",fist_right:"ğŸ¤œ",flags:"ğŸ",flashlight:"ğŸ”¦",fleur_de_lis:"âšœï¸",flight_arrival:"ğŸ›¬",flight_departure:"ğŸ›«",floppy_disk:"ğŸ’¾",flower_playing_cards:"ğŸ´",flushed:"ğŸ˜³",fog:"ğŸŒ«",foggy:"ğŸŒ",football:"ğŸˆ",footprints:"ğŸ‘£",fork_and_knife:"ğŸ´",fountain:"â›²ï¸",fountain_pen:"ğŸ–‹",four_leaf_clover:"ğŸ€",fox_face:"ğŸ¦Š",framed_picture:"ğŸ–¼",free:"ğŸ†“",fried_egg:"ğŸ³",fried_shrimp:"ğŸ¤",fries:"ğŸŸ",frog:"ğŸ¸",frowning:"ğŸ˜¦",frowning_face:"â˜¹ï¸",frowning_man:"ğŸ™&zwj;â™‚ï¸",frowning_woman:"ğŸ™",middle_finger:"ğŸ–•",fuelpump:"â›½ï¸",full_moon:"ğŸŒ•",full_moon_with_face:"ğŸŒ",funeral_urn:"âš±ï¸",game_die:"ğŸ²",gear:"âš™ï¸",gem:"ğŸ’",gemini:"â™Šï¸",ghost:"ğŸ‘»",gift:"ğŸ",gift_heart:"ğŸ’",girl:"ğŸ‘§",globe_with_meridians:"ğŸŒ",goal_net:"ğŸ¥…",goat:"ğŸ",golf:"â›³ï¸",golfing_man:"ğŸŒï¸",golfing_woman:"ğŸŒï¸&zwj;â™€ï¸",gorilla:"ğŸ¦",grapes:"ğŸ‡",green_apple:"ğŸ",green_book:"ğŸ“—",green_heart:"ğŸ’š",green_salad:"ğŸ¥—",grey_exclamation:"â•",grey_question:"â”",grimacing:"ğŸ˜¬",grin:"ğŸ˜",grinning:"ğŸ˜€",guardsman:"ğŸ’‚",guardswoman:"ğŸ’‚&zwj;â™€ï¸",guitar:"ğŸ¸",gun:"ğŸ”«",haircut_woman:"ğŸ’‡",haircut_man:"ğŸ’‡&zwj;â™‚ï¸",hamburger:"ğŸ”",hammer:"ğŸ”¨",hammer_and_pick:"âš’",hammer_and_wrench:"ğŸ› ",hamster:"ğŸ¹",hand:"âœ‹",handbag:"ğŸ‘œ",handshake:"ğŸ¤",hankey:"ğŸ’©",hatched_chick:"ğŸ¥",hatching_chick:"ğŸ£",headphones:"ğŸ§",hear_no_evil:"ğŸ™‰",heart:"â¤ï¸",heart_decoration:"ğŸ’Ÿ",heart_eyes:"ğŸ˜",heart_eyes_cat:"ğŸ˜»",heartbeat:"ğŸ’“",heartpulse:"ğŸ’—",hearts:"â™¥ï¸",heavy_check_mark:"âœ”ï¸",heavy_division_sign:"â—",heavy_dollar_sign:"ğŸ’²",heavy_heart_exclamation:"â£ï¸",heavy_minus_sign:"â–",heavy_multiplication_x:"âœ–ï¸",heavy_plus_sign:"â•",helicopter:"ğŸš",herb:"ğŸŒ¿",hibiscus:"ğŸŒº",high_brightness:"ğŸ”†",high_heel:"ğŸ‘ ",hocho:"ğŸ”ª",hole:"ğŸ•³",honey_pot:"ğŸ¯",horse:"ğŸ´",horse_racing:"ğŸ‡",hospital:"ğŸ¥",hot_pepper:"ğŸŒ¶",hotdog:"ğŸŒ­",hotel:"ğŸ¨",hotsprings:"â™¨ï¸",hourglass:"âŒ›ï¸",hourglass_flowing_sand:"â³",house:"ğŸ ",house_with_garden:"ğŸ¡",houses:"ğŸ˜",hugs:"ğŸ¤—",hushed:"ğŸ˜¯",ice_cream:"ğŸ¨",ice_hockey:"ğŸ’",ice_skate:"â›¸",icecream:"ğŸ¦",id:"ğŸ†”",ideograph_advantage:"ğŸ‰",imp:"ğŸ‘¿",inbox_tray:"ğŸ“¥",incoming_envelope:"ğŸ“¨",tipping_hand_woman:"ğŸ’",information_source:"â„¹ï¸",innocent:"ğŸ˜‡",interrobang:"â‰ï¸",iphone:"ğŸ“±",izakaya_lantern:"ğŸ®",jack_o_lantern:"ğŸƒ",japan:"ğŸ—¾",japanese_castle:"ğŸ¯",japanese_goblin:"ğŸ‘º",japanese_ogre:"ğŸ‘¹",jeans:"ğŸ‘–",joy:"ğŸ˜‚",joy_cat:"ğŸ˜¹",joystick:"ğŸ•¹",kaaba:"ğŸ•‹",key:"ğŸ”‘",keyboard:"âŒ¨ï¸",keycap_ten:"ğŸ”Ÿ",kick_scooter:"ğŸ›´",kimono:"ğŸ‘˜",kiss:"ğŸ’‹",kissing:"ğŸ˜—",kissing_cat:"ğŸ˜½",kissing_closed_eyes:"ğŸ˜š",kissing_heart:"ğŸ˜˜",kissing_smiling_eyes:"ğŸ˜™",kiwi_fruit:"ğŸ¥",koala:"ğŸ¨",koko:"ğŸˆ",label:"ğŸ·",large_blue_circle:"ğŸ”µ",large_blue_diamond:"ğŸ”·",large_orange_diamond:"ğŸ”¶",last_quarter_moon:"ğŸŒ—",last_quarter_moon_with_face:"ğŸŒœ",latin_cross:"âœï¸",laughing:"ğŸ˜†",leaves:"ğŸƒ",ledger:"ğŸ“’",left_luggage:"ğŸ›…",left_right_arrow:"â†”ï¸",leftwards_arrow_with_hook:"â†©ï¸",lemon:"ğŸ‹",leo:"â™Œï¸",leopard:"ğŸ†",level_slider:"ğŸš",libra:"â™ï¸",light_rail:"ğŸšˆ",link:"ğŸ”—",lion:"ğŸ¦",lips:"ğŸ‘„",lipstick:"ğŸ’„",lizard:"ğŸ¦",lock:"ğŸ”’",lock_with_ink_pen:"ğŸ”",lollipop:"ğŸ­",loop:"â¿",loud_sound:"ğŸ”Š",loudspeaker:"ğŸ“¢",love_hotel:"ğŸ©",love_letter:"ğŸ’Œ",low_brightness:"ğŸ”…",lying_face:"ğŸ¤¥",m:"â“‚ï¸",mag:"ğŸ”",mag_right:"ğŸ”",mahjong:"ğŸ€„ï¸",mailbox:"ğŸ“«",mailbox_closed:"ğŸ“ª",mailbox_with_mail:"ğŸ“¬",mailbox_with_no_mail:"ğŸ“­",man:"ğŸ‘¨",man_artist:"ğŸ‘¨&zwj;ğŸ¨",man_astronaut:"ğŸ‘¨&zwj;ğŸš€",man_cartwheeling:"ğŸ¤¸&zwj;â™‚ï¸",man_cook:"ğŸ‘¨&zwj;ğŸ³",man_dancing:"ğŸ•º",man_facepalming:"ğŸ¤¦&zwj;â™‚ï¸",man_factory_worker:"ğŸ‘¨&zwj;ğŸ­",man_farmer:"ğŸ‘¨&zwj;ğŸŒ¾",man_firefighter:"ğŸ‘¨&zwj;ğŸš’",man_health_worker:"ğŸ‘¨&zwj;âš•ï¸",man_in_tuxedo:"ğŸ¤µ",man_judge:"ğŸ‘¨&zwj;âš–ï¸",man_juggling:"ğŸ¤¹&zwj;â™‚ï¸",man_mechanic:"ğŸ‘¨&zwj;ğŸ”§",man_office_worker:"ğŸ‘¨&zwj;ğŸ’¼",man_pilot:"ğŸ‘¨&zwj;âœˆï¸",man_playing_handball:"ğŸ¤¾&zwj;â™‚ï¸",man_playing_water_polo:"ğŸ¤½&zwj;â™‚ï¸",man_scientist:"ğŸ‘¨&zwj;ğŸ”¬",man_shrugging:"ğŸ¤·&zwj;â™‚ï¸",man_singer:"ğŸ‘¨&zwj;ğŸ¤",man_student:"ğŸ‘¨&zwj;ğŸ“",man_teacher:"ğŸ‘¨&zwj;ğŸ«",man_technologist:"ğŸ‘¨&zwj;ğŸ’»",man_with_gua_pi_mao:"ğŸ‘²",man_with_turban:"ğŸ‘³",tangerine:"ğŸŠ",mans_shoe:"ğŸ‘",mantelpiece_clock:"ğŸ•°",maple_leaf:"ğŸ",martial_arts_uniform:"ğŸ¥‹",mask:"ğŸ˜·",massage_woman:"ğŸ’†",massage_man:"ğŸ’†&zwj;â™‚ï¸",meat_on_bone:"ğŸ–",medal_military:"ğŸ–",medal_sports:"ğŸ…",mega:"ğŸ“£",melon:"ğŸˆ",memo:"ğŸ“",men_wrestling:"ğŸ¤¼&zwj;â™‚ï¸",menorah:"ğŸ•",mens:"ğŸš¹",metal:"ğŸ¤˜",metro:"ğŸš‡",microphone:"ğŸ¤",microscope:"ğŸ”¬",milk_glass:"ğŸ¥›",milky_way:"ğŸŒŒ",minibus:"ğŸš",minidisc:"ğŸ’½",mobile_phone_off:"ğŸ“´",money_mouth_face:"ğŸ¤‘",money_with_wings:"ğŸ’¸",moneybag:"ğŸ’°",monkey:"ğŸ’",monkey_face:"ğŸµ",monorail:"ğŸš",moon:"ğŸŒ”",mortar_board:"ğŸ“",mosque:"ğŸ•Œ",motor_boat:"ğŸ›¥",motor_scooter:"ğŸ›µ",motorcycle:"ğŸ",motorway:"ğŸ›£",mount_fuji:"ğŸ—»",mountain:"â›°",mountain_biking_man:"ğŸšµ",mountain_biking_woman:"ğŸšµ&zwj;â™€ï¸",mountain_cableway:"ğŸš ",mountain_railway:"ğŸš",mountain_snow:"ğŸ”",mouse:"ğŸ­",mouse2:"ğŸ",movie_camera:"ğŸ¥",moyai:"ğŸ—¿",mrs_claus:"ğŸ¤¶",muscle:"ğŸ’ª",mushroom:"ğŸ„",musical_keyboard:"ğŸ¹",musical_note:"ğŸµ",musical_score:"ğŸ¼",mute:"ğŸ”‡",nail_care:"ğŸ’…",name_badge:"ğŸ“›",national_park:"ğŸ",nauseated_face:"ğŸ¤¢",necktie:"ğŸ‘”",negative_squared_cross_mark:"â",nerd_face:"ğŸ¤“",neutral_face:"ğŸ˜",new:"ğŸ†•",new_moon:"ğŸŒ‘",new_moon_with_face:"ğŸŒš",newspaper:"ğŸ“°",newspaper_roll:"ğŸ—",next_track_button:"â­",ng:"ğŸ†–",no_good_man:"ğŸ™…&zwj;â™‚ï¸",no_good_woman:"ğŸ™…",night_with_stars:"ğŸŒƒ",no_bell:"ğŸ”•",no_bicycles:"ğŸš³",no_entry:"â›”ï¸",no_entry_sign:"ğŸš«",no_mobile_phones:"ğŸ“µ",no_mouth:"ğŸ˜¶",no_pedestrians:"ğŸš·",no_smoking:"ğŸš­","non-potable_water":"ğŸš±",nose:"ğŸ‘ƒ",notebook:"ğŸ““",notebook_with_decorative_cover:"ğŸ“”",notes:"ğŸ¶",nut_and_bolt:"ğŸ”©",o:"â­•ï¸",o2:"ğŸ…¾ï¸",ocean:"ğŸŒŠ",octopus:"ğŸ™",oden:"ğŸ¢",office:"ğŸ¢",oil_drum:"ğŸ›¢",ok:"ğŸ†—",ok_hand:"ğŸ‘Œ",ok_man:"ğŸ™†&zwj;â™‚ï¸",ok_woman:"ğŸ™†",old_key:"ğŸ—",older_man:"ğŸ‘´",older_woman:"ğŸ‘µ",om:"ğŸ•‰",on:"ğŸ”›",oncoming_automobile:"ğŸš˜",oncoming_bus:"ğŸš",oncoming_police_car:"ğŸš”",oncoming_taxi:"ğŸš–",open_file_folder:"ğŸ“‚",open_hands:"ğŸ‘",open_mouth:"ğŸ˜®",open_umbrella:"â˜‚ï¸",ophiuchus:"â›",orange_book:"ğŸ“™",orthodox_cross:"â˜¦ï¸",outbox_tray:"ğŸ“¤",owl:"ğŸ¦‰",ox:"ğŸ‚",package:"ğŸ“¦",page_facing_up:"ğŸ“„",page_with_curl:"ğŸ“ƒ",pager:"ğŸ“Ÿ",paintbrush:"ğŸ–Œ",palm_tree:"ğŸŒ´",pancakes:"ğŸ¥",panda_face:"ğŸ¼",paperclip:"ğŸ“",paperclips:"ğŸ–‡",parasol_on_ground:"â›±",parking:"ğŸ…¿ï¸",part_alternation_mark:"ã€½ï¸",partly_sunny:"â›…ï¸",passenger_ship:"ğŸ›³",passport_control:"ğŸ›‚",pause_button:"â¸",peace_symbol:"â˜®ï¸",peach:"ğŸ‘",peanuts:"ğŸ¥œ",pear:"ğŸ",pen:"ğŸ–Š",pencil2:"âœï¸",penguin:"ğŸ§",pensive:"ğŸ˜”",performing_arts:"ğŸ­",persevere:"ğŸ˜£",person_fencing:"ğŸ¤º",pouting_woman:"ğŸ™",phone:"â˜ï¸",pick:"â›",pig:"ğŸ·",pig2:"ğŸ–",pig_nose:"ğŸ½",pill:"ğŸ’Š",pineapple:"ğŸ",ping_pong:"ğŸ“",pisces:"â™“ï¸",pizza:"ğŸ•",place_of_worship:"ğŸ›",plate_with_cutlery:"ğŸ½",play_or_pause_button:"â¯",point_down:"ğŸ‘‡",point_left:"ğŸ‘ˆ",point_right:"ğŸ‘‰",point_up:"â˜ï¸",point_up_2:"ğŸ‘†",police_car:"ğŸš“",policewoman:"ğŸ‘®&zwj;â™€ï¸",poodle:"ğŸ©",popcorn:"ğŸ¿",post_office:"ğŸ£",postal_horn:"ğŸ“¯",postbox:"ğŸ“®",potable_water:"ğŸš°",potato:"ğŸ¥”",pouch:"ğŸ‘",poultry_leg:"ğŸ—",pound:"ğŸ’·",rage:"ğŸ˜¡",pouting_cat:"ğŸ˜¾",pouting_man:"ğŸ™&zwj;â™‚ï¸",pray:"ğŸ™",prayer_beads:"ğŸ“¿",pregnant_woman:"ğŸ¤°",previous_track_button:"â®",prince:"ğŸ¤´",princess:"ğŸ‘¸",printer:"ğŸ–¨",purple_heart:"ğŸ’œ",purse:"ğŸ‘›",pushpin:"ğŸ“Œ",put_litter_in_its_place:"ğŸš®",question:"â“",rabbit:"ğŸ°",rabbit2:"ğŸ‡",racehorse:"ğŸ",racing_car:"ğŸ",radio:"ğŸ“»",radio_button:"ğŸ”˜",radioactive:"â˜¢ï¸",railway_car:"ğŸšƒ",railway_track:"ğŸ›¤",rainbow:"ğŸŒˆ",rainbow_flag:"ğŸ³ï¸&zwj;ğŸŒˆ",raised_back_of_hand:"ğŸ¤š",raised_hand_with_fingers_splayed:"ğŸ–",raised_hands:"ğŸ™Œ",raising_hand_woman:"ğŸ™‹",raising_hand_man:"ğŸ™‹&zwj;â™‚ï¸",ram:"ğŸ",ramen:"ğŸœ",rat:"ğŸ€",record_button:"âº",recycle:"â™»ï¸",red_circle:"ğŸ”´",registered:"Â®ï¸",relaxed:"â˜ºï¸",relieved:"ğŸ˜Œ",reminder_ribbon:"ğŸ—",repeat:"ğŸ”",repeat_one:"ğŸ”‚",rescue_worker_helmet:"â›‘",restroom:"ğŸš»",revolving_hearts:"ğŸ’",rewind:"âª",rhinoceros:"ğŸ¦",ribbon:"ğŸ€",rice:"ğŸš",rice_ball:"ğŸ™",rice_cracker:"ğŸ˜",rice_scene:"ğŸ‘",right_anger_bubble:"ğŸ—¯",ring:"ğŸ’",robot:"ğŸ¤–",rocket:"ğŸš€",rofl:"ğŸ¤£",roll_eyes:"ğŸ™„",roller_coaster:"ğŸ¢",rooster:"ğŸ“",rose:"ğŸŒ¹",rosette:"ğŸµ",rotating_light:"ğŸš¨",round_pushpin:"ğŸ“",rowing_man:"ğŸš£",rowing_woman:"ğŸš£&zwj;â™€ï¸",rugby_football:"ğŸ‰",running_man:"ğŸƒ",running_shirt_with_sash:"ğŸ½",running_woman:"ğŸƒ&zwj;â™€ï¸",sa:"ğŸˆ‚ï¸",sagittarius:"â™ï¸",sake:"ğŸ¶",sandal:"ğŸ‘¡",santa:"ğŸ…",satellite:"ğŸ“¡",saxophone:"ğŸ·",school:"ğŸ«",school_satchel:"ğŸ’",scissors:"âœ‚ï¸",scorpion:"ğŸ¦‚",scorpius:"â™ï¸",scream:"ğŸ˜±",scream_cat:"ğŸ™€",scroll:"ğŸ“œ",seat:"ğŸ’º",secret:"ãŠ™ï¸",see_no_evil:"ğŸ™ˆ",seedling:"ğŸŒ±",selfie:"ğŸ¤³",shallow_pan_of_food:"ğŸ¥˜",shamrock:"â˜˜ï¸",shark:"ğŸ¦ˆ",shaved_ice:"ğŸ§",sheep:"ğŸ‘",shell:"ğŸš",shield:"ğŸ›¡",shinto_shrine:"â›©",ship:"ğŸš¢",shirt:"ğŸ‘•",shopping:"ğŸ›",shopping_cart:"ğŸ›’",shower:"ğŸš¿",shrimp:"ğŸ¦",signal_strength:"ğŸ“¶",six_pointed_star:"ğŸ”¯",ski:"ğŸ¿",skier:"â›·",skull:"ğŸ’€",skull_and_crossbones:"â˜ ï¸",sleeping:"ğŸ˜´",sleeping_bed:"ğŸ›Œ",sleepy:"ğŸ˜ª",slightly_frowning_face:"ğŸ™",slightly_smiling_face:"ğŸ™‚",slot_machine:"ğŸ°",small_airplane:"ğŸ›©",small_blue_diamond:"ğŸ”¹",small_orange_diamond:"ğŸ”¸",small_red_triangle:"ğŸ”º",small_red_triangle_down:"ğŸ”»",smile:"ğŸ˜„",smile_cat:"ğŸ˜¸",smiley:"ğŸ˜ƒ",smiley_cat:"ğŸ˜º",smiling_imp:"ğŸ˜ˆ",smirk:"ğŸ˜",smirk_cat:"ğŸ˜¼",smoking:"ğŸš¬",snail:"ğŸŒ",snake:"ğŸ",sneezing_face:"ğŸ¤§",snowboarder:"ğŸ‚",snowflake:"â„ï¸",snowman:"â›„ï¸",snowman_with_snow:"â˜ƒï¸",sob:"ğŸ˜­",soccer:"âš½ï¸",soon:"ğŸ”œ",sos:"ğŸ†˜",sound:"ğŸ”‰",space_invader:"ğŸ‘¾",spades:"â™ ï¸",spaghetti:"ğŸ",sparkle:"â‡ï¸",sparkler:"ğŸ‡",sparkles:"âœ¨",sparkling_heart:"ğŸ’–",speak_no_evil:"ğŸ™Š",speaker:"ğŸ”ˆ",speaking_head:"ğŸ—£",speech_balloon:"ğŸ’¬",speedboat:"ğŸš¤",spider:"ğŸ•·",spider_web:"ğŸ•¸",spiral_calendar:"ğŸ—“",spiral_notepad:"ğŸ—’",spoon:"ğŸ¥„",squid:"ğŸ¦‘",stadium:"ğŸŸ",star:"â­ï¸",star2:"ğŸŒŸ",star_and_crescent:"â˜ªï¸",star_of_david:"âœ¡ï¸",stars:"ğŸŒ ",station:"ğŸš‰",statue_of_liberty:"ğŸ—½",steam_locomotive:"ğŸš‚",stew:"ğŸ²",stop_button:"â¹",stop_sign:"ğŸ›‘",stopwatch:"â±",straight_ruler:"ğŸ“",strawberry:"ğŸ“",stuck_out_tongue:"ğŸ˜›",stuck_out_tongue_closed_eyes:"ğŸ˜",stuck_out_tongue_winking_eye:"ğŸ˜œ",studio_microphone:"ğŸ™",stuffed_flatbread:"ğŸ¥™",sun_behind_large_cloud:"ğŸŒ¥",sun_behind_rain_cloud:"ğŸŒ¦",sun_behind_small_cloud:"ğŸŒ¤",sun_with_face:"ğŸŒ",sunflower:"ğŸŒ»",sunglasses:"ğŸ˜",sunny:"â˜€ï¸",sunrise:"ğŸŒ…",sunrise_over_mountains:"ğŸŒ„",surfing_man:"ğŸ„",surfing_woman:"ğŸ„&zwj;â™€ï¸",sushi:"ğŸ£",suspension_railway:"ğŸšŸ",sweat:"ğŸ˜“",sweat_drops:"ğŸ’¦",sweat_smile:"ğŸ˜…",sweet_potato:"ğŸ ",swimming_man:"ğŸŠ",swimming_woman:"ğŸŠ&zwj;â™€ï¸",symbols:"ğŸ”£",synagogue:"ğŸ•",syringe:"ğŸ’‰",taco:"ğŸŒ®",tada:"ğŸ‰",tanabata_tree:"ğŸ‹",taurus:"â™‰ï¸",taxi:"ğŸš•",tea:"ğŸµ",telephone_receiver:"ğŸ“",telescope:"ğŸ”­",tennis:"ğŸ¾",tent:"â›ºï¸",thermometer:"ğŸŒ¡",thinking:"ğŸ¤”",thought_balloon:"ğŸ’­",ticket:"ğŸ«",tickets:"ğŸŸ",tiger:"ğŸ¯",tiger2:"ğŸ…",timer_clock:"â²",tipping_hand_man:"ğŸ’&zwj;â™‚ï¸",tired_face:"ğŸ˜«",tm:"â„¢ï¸",toilet:"ğŸš½",tokyo_tower:"ğŸ—¼",tomato:"ğŸ…",tongue:"ğŸ‘…",top:"ğŸ”",tophat:"ğŸ©",tornado:"ğŸŒª",trackball:"ğŸ–²",tractor:"ğŸšœ",traffic_light:"ğŸš¥",train:"ğŸš‹",train2:"ğŸš†",tram:"ğŸšŠ",triangular_flag_on_post:"ğŸš©",triangular_ruler:"ğŸ“",trident:"ğŸ”±",triumph:"ğŸ˜¤",trolleybus:"ğŸš",trophy:"ğŸ†",tropical_drink:"ğŸ¹",tropical_fish:"ğŸ ",truck:"ğŸšš",trumpet:"ğŸº",tulip:"ğŸŒ·",tumbler_glass:"ğŸ¥ƒ",turkey:"ğŸ¦ƒ",turtle:"ğŸ¢",tv:"ğŸ“º",twisted_rightwards_arrows:"ğŸ”€",two_hearts:"ğŸ’•",two_men_holding_hands:"ğŸ‘¬",two_women_holding_hands:"ğŸ‘­",u5272:"ğŸˆ¹",u5408:"ğŸˆ´",u55b6:"ğŸˆº",u6307:"ğŸˆ¯ï¸",u6708:"ğŸˆ·ï¸",u6709:"ğŸˆ¶",u6e80:"ğŸˆµ",u7121:"ğŸˆšï¸",u7533:"ğŸˆ¸",u7981:"ğŸˆ²",u7a7a:"ğŸˆ³",umbrella:"â˜”ï¸",unamused:"ğŸ˜’",underage:"ğŸ”",unicorn:"ğŸ¦„",unlock:"ğŸ”“",up:"ğŸ†™",upside_down_face:"ğŸ™ƒ",v:"âœŒï¸",vertical_traffic_light:"ğŸš¦",vhs:"ğŸ“¼",vibration_mode:"ğŸ“³",video_camera:"ğŸ“¹",video_game:"ğŸ®",violin:"ğŸ»",virgo:"â™ï¸",volcano:"ğŸŒ‹",volleyball:"ğŸ",vs:"ğŸ†š",vulcan_salute:"ğŸ––",walking_man:"ğŸš¶",walking_woman:"ğŸš¶&zwj;â™€ï¸",waning_crescent_moon:"ğŸŒ˜",waning_gibbous_moon:"ğŸŒ–",warning:"âš ï¸",wastebasket:"ğŸ—‘",watch:"âŒšï¸",water_buffalo:"ğŸƒ",watermelon:"ğŸ‰",wave:"ğŸ‘‹",wavy_dash:"ã€°ï¸",waxing_crescent_moon:"ğŸŒ’",wc:"ğŸš¾",weary:"ğŸ˜©",wedding:"ğŸ’’",weight_lifting_man:"ğŸ‹ï¸",weight_lifting_woman:"ğŸ‹ï¸&zwj;â™€ï¸",whale:"ğŸ³",whale2:"ğŸ‹",wheel_of_dharma:"â˜¸ï¸",wheelchair:"â™¿ï¸",white_check_mark:"âœ…",white_circle:"âšªï¸",white_flag:"ğŸ³ï¸",white_flower:"ğŸ’®",white_large_square:"â¬œï¸",white_medium_small_square:"â—½ï¸",white_medium_square:"â—»ï¸",white_small_square:"â–«ï¸",white_square_button:"ğŸ”³",wilted_flower:"ğŸ¥€",wind_chime:"ğŸ",wind_face:"ğŸŒ¬",wine_glass:"ğŸ·",wink:"ğŸ˜‰",wolf:"ğŸº",woman:"ğŸ‘©",woman_artist:"ğŸ‘©&zwj;ğŸ¨",woman_astronaut:"ğŸ‘©&zwj;ğŸš€",woman_cartwheeling:"ğŸ¤¸&zwj;â™€ï¸",woman_cook:"ğŸ‘©&zwj;ğŸ³",woman_facepalming:"ğŸ¤¦&zwj;â™€ï¸",woman_factory_worker:"ğŸ‘©&zwj;ğŸ­",woman_farmer:"ğŸ‘©&zwj;ğŸŒ¾",woman_firefighter:"ğŸ‘©&zwj;ğŸš’",woman_health_worker:"ğŸ‘©&zwj;âš•ï¸",woman_judge:"ğŸ‘©&zwj;âš–ï¸",woman_juggling:"ğŸ¤¹&zwj;â™€ï¸",woman_mechanic:"ğŸ‘©&zwj;ğŸ”§",woman_office_worker:"ğŸ‘©&zwj;ğŸ’¼",woman_pilot:"ğŸ‘©&zwj;âœˆï¸",woman_playing_handball:"ğŸ¤¾&zwj;â™€ï¸",woman_playing_water_polo:"ğŸ¤½&zwj;â™€ï¸",woman_scientist:"ğŸ‘©&zwj;ğŸ”¬",woman_shrugging:"ğŸ¤·&zwj;â™€ï¸",woman_singer:"ğŸ‘©&zwj;ğŸ¤",woman_student:"ğŸ‘©&zwj;ğŸ“",woman_teacher:"ğŸ‘©&zwj;ğŸ«",woman_technologist:"ğŸ‘©&zwj;ğŸ’»",woman_with_turban:"ğŸ‘³&zwj;â™€ï¸",womans_clothes:"ğŸ‘š",womans_hat:"ğŸ‘’",women_wrestling:"ğŸ¤¼&zwj;â™€ï¸",womens:"ğŸšº",world_map:"ğŸ—º",worried:"ğŸ˜Ÿ",wrench:"ğŸ”§",writing_hand:"âœï¸",x:"âŒ",yellow_heart:"ğŸ’›",yen:"ğŸ’´",yin_yang:"â˜¯ï¸",yum:"ğŸ˜‹",zap:"âš¡ï¸",zipper_mouth_face:"ğŸ¤",zzz:"ğŸ’¤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},a.Converter=function(r){var p={},u=[],h=[],b={},E=l,I={parsed:{},raw:"",format:""};w();function w(){r=r||{};for(var T in d)d.hasOwnProperty(T)&&(p[T]=d[T]);if(typeof r=="object")for(var R in r)r.hasOwnProperty(R)&&(p[R]=r[R]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof r+" was passed instead.");p.extensions&&a.helper.forEach(p.extensions,_)}function _(T,R){if(R=R||null,a.helper.isString(T))if(T=a.helper.stdExtName(T),R=T,a.extensions[T]){console.warn("DEPRECATION WARNING: "+T+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),C(a.extensions[T],T);return}else if(!a.helper.isUndefined(s[T]))T=s[T];else throw Error('Extension "'+T+'" could not be loaded. It was either not found or is not a valid extension.');typeof T=="function"&&(T=T()),a.helper.isArray(T)||(T=[T]);var U=f(T,R);if(!U.valid)throw Error(U.error);for(var j=0;j<T.length;++j){switch(T[j].type){case"lang":u.push(T[j]);break;case"output":h.push(T[j]);break}if(T[j].hasOwnProperty("listeners"))for(var Q in T[j].listeners)T[j].listeners.hasOwnProperty(Q)&&L(Q,T[j].listeners[Q])}}function C(T,R){typeof T=="function"&&(T=T(new a.Converter)),a.helper.isArray(T)||(T=[T]);var U=f(T,R);if(!U.valid)throw Error(U.error);for(var j=0;j<T.length;++j)switch(T[j].type){case"lang":u.push(T[j]);break;case"output":h.push(T[j]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function L(T,R){if(!a.helper.isString(T))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof T+" given");if(typeof R!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof R+" given");b.hasOwnProperty(T)||(b[T]=[]),b[T].push(R)}function x(T){var R=T.match(/^\s*/)[0].length,U=new RegExp("^\\s{0,"+R+"}","gm");return T.replace(U,"")}this._dispatch=function(R,U,j,Q){if(b.hasOwnProperty(R))for(var W=0;W<b[R].length;++W){var J=b[R][W](R,U,this,j,Q);J&&typeof J<"u"&&(U=J)}return U},this.listen=function(T,R){return L(T,R),this},this.makeHtml=function(T){if(!T)return T;var R={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:u,outputModifiers:h,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return T=T.replace(/Â¨/g,"Â¨T"),T=T.replace(/\$/g,"Â¨D"),T=T.replace(/\r\n/g,`
`),T=T.replace(/\r/g,`
`),T=T.replace(/\u00A0/g,"&nbsp;"),p.smartIndentationFix&&(T=x(T)),T=`

`+T+`

`,T=a.subParser("detab")(T,p,R),T=T.replace(/^[ \t]+$/mg,""),a.helper.forEach(u,function(U){T=a.subParser("runExtension")(U,T,p,R)}),T=a.subParser("metadata")(T,p,R),T=a.subParser("hashPreCodeTags")(T,p,R),T=a.subParser("githubCodeBlocks")(T,p,R),T=a.subParser("hashHTMLBlocks")(T,p,R),T=a.subParser("hashCodeTags")(T,p,R),T=a.subParser("stripLinkDefinitions")(T,p,R),T=a.subParser("blockGamut")(T,p,R),T=a.subParser("unhashHTMLSpans")(T,p,R),T=a.subParser("unescapeSpecialChars")(T,p,R),T=T.replace(/Â¨D/g,"$$"),T=T.replace(/Â¨T/g,"Â¨"),T=a.subParser("completeHTMLDocument")(T,p,R),a.helper.forEach(h,function(U){T=a.subParser("runExtension")(U,T,p,R)}),I=R.metadata,T},this.makeMarkdown=this.makeMd=function(T,R){if(T=T.replace(/\r\n/g,`
`),T=T.replace(/\r/g,`
`),T=T.replace(/>[ \t]+</,">Â¨NBSP;<"),!R)if(window&&window.document)R=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var U=R.createElement("div");U.innerHTML=T;var j={preList:de(U)};te(U);for(var Q=U.childNodes,W="",J=0;J<Q.length;J++)W+=a.subParser("makeMarkdown.node")(Q[J],j);function te(ee){for(var ie=0;ie<ee.childNodes.length;++ie){var le=ee.childNodes[ie];le.nodeType===3?!/\S/.test(le.nodeValue)&&!/^[ ]+$/.test(le.nodeValue)?(ee.removeChild(le),--ie):(le.nodeValue=le.nodeValue.split(`
`).join(" "),le.nodeValue=le.nodeValue.replace(/(\s)+/g,"$1")):le.nodeType===1&&te(le)}}function de(ee){for(var ie=ee.querySelectorAll("pre"),le=[],A=0;A<ie.length;++A)if(ie[A].childElementCount===1&&ie[A].firstChild.tagName.toLowerCase()==="code"){var H=ie[A].firstChild.innerHTML.trim(),z=ie[A].firstChild.getAttribute("data-language")||"";if(z==="")for(var ue=ie[A].firstChild.className.split(" "),se=0;se<ue.length;++se){var ce=ue[se].match(/^language-(.+)$/);if(ce!==null){z=ce[1];break}}H=a.helper.unescapeHTMLEntities(H),le.push(H),ie[A].outerHTML='<precode language="'+z+'" precodenum="'+A.toString()+'"></precode>'}else le.push(ie[A].innerHTML),ie[A].innerHTML="",ie[A].setAttribute("prenum",A.toString());return le}return W},this.setOption=function(T,R){p[T]=R},this.getOption=function(T){return p[T]},this.getOptions=function(){return p},this.addExtension=function(T,R){R=R||null,_(T,R)},this.useExtension=function(T){_(T)},this.setFlavor=function(T){if(!c.hasOwnProperty(T))throw Error(T+" flavor was not found");var R=c[T];E=T;for(var U in R)R.hasOwnProperty(U)&&(p[U]=R[U])},this.getFlavor=function(){return E},this.removeExtension=function(T){a.helper.isArray(T)||(T=[T]);for(var R=0;R<T.length;++R){for(var U=T[R],j=0;j<u.length;++j)u[j]===U&&u.splice(j,1);for(var Q=0;Q<h.length;++Q)h[Q]===U&&h.splice(Q,1)}},this.getAllExtensions=function(){return{language:u,output:h}},this.getMetadata=function(T){return T?I.raw:I.parsed},this.getMetadataFormat=function(){return I.format},this._setMetadataPair=function(T,R){I.parsed[T]=R},this._setMetadataFormat=function(T){I.format=T},this._setMetadataRaw=function(T){I.raw=T}},a.subParser("anchors",function(r,p,u){r=u.converter._dispatch("anchors.before",r,p,u);var h=function(b,E,I,w,_,C,L){if(a.helper.isUndefined(L)&&(L=""),I=I.toLowerCase(),b.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)w="";else if(!w)if(I||(I=E.toLowerCase().replace(/ ?\n/g," ")),w="#"+I,!a.helper.isUndefined(u.gUrls[I]))w=u.gUrls[I],a.helper.isUndefined(u.gTitles[I])||(L=u.gTitles[I]);else return b;w=w.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback);var x='<a href="'+w+'"';return L!==""&&L!==null&&(L=L.replace(/"/g,"&quot;"),L=L.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback),x+=' title="'+L+'"'),p.openLinksInNewWindow&&!/^#/.test(w)&&(x+=' rel="noopener noreferrer" target="Â¨E95Eblank"'),x+=">"+E+"</a>",x};return r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,h),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,h),r=r.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,h),r=r.replace(/\[([^\[\]]+)]()()()()()/g,h),p.ghMentions&&(r=r.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(b,E,I,w,_){if(I==="\\")return E+w;if(!a.helper.isString(p.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var C=p.ghMentionsLink.replace(/\{u}/g,_),L="";return p.openLinksInNewWindow&&(L=' rel="noopener noreferrer" target="Â¨E95Eblank"'),E+'<a href="'+C+'"'+L+">"+w+"</a>"})),r=u.converter._dispatch("anchors.after",r,p,u),r});var N=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,D=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,k=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,M=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,P=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,F=function(r){return function(p,u,h,b,E,I,w){h=h.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback);var _=h,C="",L="",x=u||"",T=w||"";return/^www\./i.test(h)&&(h=h.replace(/^www\./i,"http://www.")),r.excludeTrailingPunctuationFromURLs&&I&&(C=I),r.openLinksInNewWindow&&(L=' rel="noopener noreferrer" target="Â¨E95Eblank"'),x+'<a href="'+h+'"'+L+">"+_+"</a>"+C+T}},$=function(r,p){return function(u,h,b){var E="mailto:";return h=h||"",b=a.subParser("unescapeSpecialChars")(b,r,p),r.encodeEmails?(E=a.helper.encodeEmailAddress(E+b),b=a.helper.encodeEmailAddress(b)):E=E+b,h+'<a href="'+E+'">'+b+"</a>"}};a.subParser("autoLinks",function(r,p,u){return r=u.converter._dispatch("autoLinks.before",r,p,u),r=r.replace(k,F(p)),r=r.replace(P,$(p,u)),r=u.converter._dispatch("autoLinks.after",r,p,u),r}),a.subParser("simplifiedAutoLinks",function(r,p,u){return p.simplifiedAutoLink&&(r=u.converter._dispatch("simplifiedAutoLinks.before",r,p,u),p.excludeTrailingPunctuationFromURLs?r=r.replace(D,F(p)):r=r.replace(N,F(p)),r=r.replace(M,$(p,u)),r=u.converter._dispatch("simplifiedAutoLinks.after",r,p,u)),r}),a.subParser("blockGamut",function(r,p,u){return r=u.converter._dispatch("blockGamut.before",r,p,u),r=a.subParser("blockQuotes")(r,p,u),r=a.subParser("headers")(r,p,u),r=a.subParser("horizontalRule")(r,p,u),r=a.subParser("lists")(r,p,u),r=a.subParser("codeBlocks")(r,p,u),r=a.subParser("tables")(r,p,u),r=a.subParser("hashHTMLBlocks")(r,p,u),r=a.subParser("paragraphs")(r,p,u),r=u.converter._dispatch("blockGamut.after",r,p,u),r}),a.subParser("blockQuotes",function(r,p,u){r=u.converter._dispatch("blockQuotes.before",r,p,u),r=r+`

`;var h=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return p.splitAdjacentBlockquotes&&(h=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),r=r.replace(h,function(b){return b=b.replace(/^[ \t]*>[ \t]?/gm,""),b=b.replace(/Â¨0/g,""),b=b.replace(/^[ \t]+$/gm,""),b=a.subParser("githubCodeBlocks")(b,p,u),b=a.subParser("blockGamut")(b,p,u),b=b.replace(/(^|\n)/g,"$1  "),b=b.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(E,I){var w=I;return w=w.replace(/^  /mg,"Â¨0"),w=w.replace(/Â¨0/g,""),w}),a.subParser("hashBlock")(`<blockquote>
`+b+`
</blockquote>`,p,u)}),r=u.converter._dispatch("blockQuotes.after",r,p,u),r}),a.subParser("codeBlocks",function(r,p,u){r=u.converter._dispatch("codeBlocks.before",r,p,u),r+="Â¨0";var h=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=Â¨0))/g;return r=r.replace(h,function(b,E,I){var w=E,_=I,C=`
`;return w=a.subParser("outdent")(w,p,u),w=a.subParser("encodeCode")(w,p,u),w=a.subParser("detab")(w,p,u),w=w.replace(/^\n+/g,""),w=w.replace(/\n+$/g,""),p.omitExtraWLInCodeBlocks&&(C=""),w="<pre><code>"+w+C+"</code></pre>",a.subParser("hashBlock")(w,p,u)+_}),r=r.replace(/Â¨0/,""),r=u.converter._dispatch("codeBlocks.after",r,p,u),r}),a.subParser("codeSpans",function(r,p,u){return r=u.converter._dispatch("codeSpans.before",r,p,u),typeof r>"u"&&(r=""),r=r.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(h,b,E,I){var w=I;return w=w.replace(/^([ \t]*)/g,""),w=w.replace(/[ \t]*$/g,""),w=a.subParser("encodeCode")(w,p,u),w=b+"<code>"+w+"</code>",w=a.subParser("hashHTMLSpans")(w,p,u),w}),r=u.converter._dispatch("codeSpans.after",r,p,u),r}),a.subParser("completeHTMLDocument",function(r,p,u){if(!p.completeHTMLDocument)return r;r=u.converter._dispatch("completeHTMLDocument.before",r,p,u);var h="html",b=`<!DOCTYPE HTML>
`,E="",I=`<meta charset="utf-8">
`,w="",_="";typeof u.metadata.parsed.doctype<"u"&&(b="<!DOCTYPE "+u.metadata.parsed.doctype+`>
`,h=u.metadata.parsed.doctype.toString().toLowerCase(),(h==="html"||h==="html5")&&(I='<meta charset="utf-8">'));for(var C in u.metadata.parsed)if(u.metadata.parsed.hasOwnProperty(C))switch(C.toLowerCase()){case"doctype":break;case"title":E="<title>"+u.metadata.parsed.title+`</title>
`;break;case"charset":h==="html"||h==="html5"?I='<meta charset="'+u.metadata.parsed.charset+`">
`:I='<meta name="charset" content="'+u.metadata.parsed.charset+`">
`;break;case"language":case"lang":w=' lang="'+u.metadata.parsed[C]+'"',_+='<meta name="'+C+'" content="'+u.metadata.parsed[C]+`">
`;break;default:_+='<meta name="'+C+'" content="'+u.metadata.parsed[C]+`">
`}return r=b+"<html"+w+`>
<head>
`+E+I+_+`</head>
<body>
`+r.trim()+`
</body>
</html>`,r=u.converter._dispatch("completeHTMLDocument.after",r,p,u),r}),a.subParser("detab",function(r,p,u){return r=u.converter._dispatch("detab.before",r,p,u),r=r.replace(/\t(?=\t)/g,"    "),r=r.replace(/\t/g,"Â¨AÂ¨B"),r=r.replace(/Â¨B(.+?)Â¨A/g,function(h,b){for(var E=b,I=4-E.length%4,w=0;w<I;w++)E+=" ";return E}),r=r.replace(/Â¨A/g,"    "),r=r.replace(/Â¨B/g,""),r=u.converter._dispatch("detab.after",r,p,u),r}),a.subParser("ellipsis",function(r,p,u){return p.ellipsis&&(r=u.converter._dispatch("ellipsis.before",r,p,u),r=r.replace(/\.\.\./g,"â€¦"),r=u.converter._dispatch("ellipsis.after",r,p,u)),r}),a.subParser("emoji",function(r,p,u){if(!p.emoji)return r;r=u.converter._dispatch("emoji.before",r,p,u);var h=/:([\S]+?):/g;return r=r.replace(h,function(b,E){return a.helper.emojis.hasOwnProperty(E)?a.helper.emojis[E]:b}),r=u.converter._dispatch("emoji.after",r,p,u),r}),a.subParser("encodeAmpsAndAngles",function(r,p,u){return r=u.converter._dispatch("encodeAmpsAndAngles.before",r,p,u),r=r.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),r=r.replace(/<(?![a-z\/?$!])/gi,"&lt;"),r=r.replace(/</g,"&lt;"),r=r.replace(/>/g,"&gt;"),r=u.converter._dispatch("encodeAmpsAndAngles.after",r,p,u),r}),a.subParser("encodeBackslashEscapes",function(r,p,u){return r=u.converter._dispatch("encodeBackslashEscapes.before",r,p,u),r=r.replace(/\\(\\)/g,a.helper.escapeCharactersCallback),r=r.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,a.helper.escapeCharactersCallback),r=u.converter._dispatch("encodeBackslashEscapes.after",r,p,u),r}),a.subParser("encodeCode",function(r,p,u){return r=u.converter._dispatch("encodeCode.before",r,p,u),r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,a.helper.escapeCharactersCallback),r=u.converter._dispatch("encodeCode.after",r,p,u),r}),a.subParser("escapeSpecialCharsWithinTagAttributes",function(r,p,u){r=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",r,p,u);var h=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,b=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return r=r.replace(h,function(E){return E.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,a.helper.escapeCharactersCallback)}),r=r.replace(b,function(E){return E.replace(/([\\`*_~=|])/g,a.helper.escapeCharactersCallback)}),r=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",r,p,u),r}),a.subParser("githubCodeBlocks",function(r,p,u){return p.ghCodeBlocks?(r=u.converter._dispatch("githubCodeBlocks.before",r,p,u),r+="Â¨0",r=r.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(h,b,E,I){var w=p.omitExtraWLInCodeBlocks?"":`
`;return I=a.subParser("encodeCode")(I,p,u),I=a.subParser("detab")(I,p,u),I=I.replace(/^\n+/g,""),I=I.replace(/\n+$/g,""),I="<pre><code"+(E?' class="'+E+" language-"+E+'"':"")+">"+I+w+"</code></pre>",I=a.subParser("hashBlock")(I,p,u),`

Â¨G`+(u.ghCodeBlocks.push({text:h,codeblock:I})-1)+`G

`}),r=r.replace(/Â¨0/,""),u.converter._dispatch("githubCodeBlocks.after",r,p,u)):r}),a.subParser("hashBlock",function(r,p,u){return r=u.converter._dispatch("hashBlock.before",r,p,u),r=r.replace(/(^\n+|\n+$)/g,""),r=`

Â¨K`+(u.gHtmlBlocks.push(r)-1)+`K

`,r=u.converter._dispatch("hashBlock.after",r,p,u),r}),a.subParser("hashCodeTags",function(r,p,u){r=u.converter._dispatch("hashCodeTags.before",r,p,u);var h=function(b,E,I,w){var _=I+a.subParser("encodeCode")(E,p,u)+w;return"Â¨C"+(u.gHtmlSpans.push(_)-1)+"C"};return r=a.helper.replaceRecursiveRegExp(r,h,"<code\\b[^>]*>","</code>","gim"),r=u.converter._dispatch("hashCodeTags.after",r,p,u),r}),a.subParser("hashElement",function(r,p,u){return function(h,b){var E=b;return E=E.replace(/\n\n/g,`
`),E=E.replace(/^\n/,""),E=E.replace(/\n+$/g,""),E=`

Â¨K`+(u.gHtmlBlocks.push(E)-1)+`K

`,E}}),a.subParser("hashHTMLBlocks",function(r,p,u){r=u.converter._dispatch("hashHTMLBlocks.before",r,p,u);var h=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],b=function(T,R,U,j){var Q=T;return U.search(/\bmarkdown\b/)!==-1&&(Q=U+u.converter.makeHtml(R)+j),`

Â¨K`+(u.gHtmlBlocks.push(Q)-1)+`K

`};p.backslashEscapesHTMLTags&&(r=r.replace(/\\<(\/?[^>]+?)>/g,function(T,R){return"&lt;"+R+"&gt;"}));for(var E=0;E<h.length;++E)for(var I,w=new RegExp("^ {0,3}(<"+h[E]+"\\b[^>]*>)","im"),_="<"+h[E]+"\\b[^>]*>",C="</"+h[E]+">";(I=a.helper.regexIndexOf(r,w))!==-1;){var L=a.helper.splitAtIndex(r,I),x=a.helper.replaceRecursiveRegExp(L[1],b,_,C,"im");if(x===L[1])break;r=L[0].concat(x)}return r=r.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,a.subParser("hashElement")(r,p,u)),r=a.helper.replaceRecursiveRegExp(r,function(T){return`

Â¨K`+(u.gHtmlBlocks.push(T)-1)+`K

`},"^ {0,3}<!--","-->","gm"),r=r.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,a.subParser("hashElement")(r,p,u)),r=u.converter._dispatch("hashHTMLBlocks.after",r,p,u),r}),a.subParser("hashHTMLSpans",function(r,p,u){r=u.converter._dispatch("hashHTMLSpans.before",r,p,u);function h(b){return"Â¨C"+(u.gHtmlSpans.push(b)-1)+"C"}return r=r.replace(/<[^>]+?\/>/gi,function(b){return h(b)}),r=r.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(b){return h(b)}),r=r.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(b){return h(b)}),r=r.replace(/<[^>]+?>/gi,function(b){return h(b)}),r=u.converter._dispatch("hashHTMLSpans.after",r,p,u),r}),a.subParser("unhashHTMLSpans",function(r,p,u){r=u.converter._dispatch("unhashHTMLSpans.before",r,p,u);for(var h=0;h<u.gHtmlSpans.length;++h){for(var b=u.gHtmlSpans[h],E=0;/Â¨C(\d+)C/.test(b);){var I=RegExp.$1;if(b=b.replace("Â¨C"+I+"C",u.gHtmlSpans[I]),E===10){console.error("maximum nesting of 10 spans reached!!!");break}++E}r=r.replace("Â¨C"+h+"C",b)}return r=u.converter._dispatch("unhashHTMLSpans.after",r,p,u),r}),a.subParser("hashPreCodeTags",function(r,p,u){r=u.converter._dispatch("hashPreCodeTags.before",r,p,u);var h=function(b,E,I,w){var _=I+a.subParser("encodeCode")(E,p,u)+w;return`

Â¨G`+(u.ghCodeBlocks.push({text:b,codeblock:_})-1)+`G

`};return r=a.helper.replaceRecursiveRegExp(r,h,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),r=u.converter._dispatch("hashPreCodeTags.after",r,p,u),r}),a.subParser("headers",function(r,p,u){r=u.converter._dispatch("headers.before",r,p,u);var h=isNaN(parseInt(p.headerLevelStart))?1:parseInt(p.headerLevelStart),b=p.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,E=p.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;r=r.replace(b,function(_,C){var L=a.subParser("spanGamut")(C,p,u),x=p.noHeaderId?"":' id="'+w(C)+'"',T=h,R="<h"+T+x+">"+L+"</h"+T+">";return a.subParser("hashBlock")(R,p,u)}),r=r.replace(E,function(_,C){var L=a.subParser("spanGamut")(C,p,u),x=p.noHeaderId?"":' id="'+w(C)+'"',T=h+1,R="<h"+T+x+">"+L+"</h"+T+">";return a.subParser("hashBlock")(R,p,u)});var I=p.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;r=r.replace(I,function(_,C,L){var x=L;p.customizedHeaderId&&(x=L.replace(/\s?\{([^{]+?)}\s*$/,""));var T=a.subParser("spanGamut")(x,p,u),R=p.noHeaderId?"":' id="'+w(L)+'"',U=h-1+C.length,j="<h"+U+R+">"+T+"</h"+U+">";return a.subParser("hashBlock")(j,p,u)});function w(_){var C,L;if(p.customizedHeaderId){var x=_.match(/\{([^{]+?)}\s*$/);x&&x[1]&&(_=x[1])}return C=_,a.helper.isString(p.prefixHeaderId)?L=p.prefixHeaderId:p.prefixHeaderId===!0?L="section-":L="",p.rawPrefixHeaderId||(C=L+C),p.ghCompatibleHeaderId?C=C.replace(/ /g,"-").replace(/&amp;/g,"").replace(/Â¨T/g,"").replace(/Â¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^Â¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():p.rawHeaderId?C=C.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/Â¨T/g,"Â¨").replace(/Â¨D/g,"$").replace(/["']/g,"-").toLowerCase():C=C.replace(/[^\w]/g,"").toLowerCase(),p.rawPrefixHeaderId&&(C=L+C),u.hashLinkCounts[C]?C=C+"-"+u.hashLinkCounts[C]++:u.hashLinkCounts[C]=1,C}return r=u.converter._dispatch("headers.after",r,p,u),r}),a.subParser("horizontalRule",function(r,p,u){r=u.converter._dispatch("horizontalRule.before",r,p,u);var h=a.subParser("hashBlock")("<hr />",p,u);return r=r.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,h),r=r.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,h),r=r.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,h),r=u.converter._dispatch("horizontalRule.after",r,p,u),r}),a.subParser("images",function(r,p,u){r=u.converter._dispatch("images.before",r,p,u);var h=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,b=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,E=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,I=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,w=/!\[([^\[\]]+)]()()()()()/g;function _(L,x,T,R,U,j,Q,W){return R=R.replace(/\s/g,""),C(L,x,T,R,U,j,Q,W)}function C(L,x,T,R,U,j,Q,W){var J=u.gUrls,te=u.gTitles,de=u.gDimensions;if(T=T.toLowerCase(),W||(W=""),L.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)R="";else if(R===""||R===null)if((T===""||T===null)&&(T=x.toLowerCase().replace(/ ?\n/g," ")),R="#"+T,!a.helper.isUndefined(J[T]))R=J[T],a.helper.isUndefined(te[T])||(W=te[T]),a.helper.isUndefined(de[T])||(U=de[T].width,j=de[T].height);else return L;x=x.replace(/"/g,"&quot;").replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback),R=R.replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback);var ee='<img src="'+R+'" alt="'+x+'"';return W&&a.helper.isString(W)&&(W=W.replace(/"/g,"&quot;").replace(a.helper.regexes.asteriskDashAndColon,a.helper.escapeCharactersCallback),ee+=' title="'+W+'"'),U&&j&&(U=U==="*"?"auto":U,j=j==="*"?"auto":j,ee+=' width="'+U+'"',ee+=' height="'+j+'"'),ee+=" />",ee}return r=r.replace(I,C),r=r.replace(E,_),r=r.replace(b,C),r=r.replace(h,C),r=r.replace(w,C),r=u.converter._dispatch("images.after",r,p,u),r}),a.subParser("italicsAndBold",function(r,p,u){r=u.converter._dispatch("italicsAndBold.before",r,p,u);function h(b,E,I){return E+b+I}return p.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(b,E){return h(E,"<strong><em>","</em></strong>")}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(b,E){return h(E,"<strong>","</strong>")}),r=r.replace(/\b_(\S[\s\S]*?)_\b/g,function(b,E){return h(E,"<em>","</em>")})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(b,E){return/\S$/.test(E)?h(E,"<strong><em>","</em></strong>"):b}),r=r.replace(/__(\S[\s\S]*?)__/g,function(b,E){return/\S$/.test(E)?h(E,"<strong>","</strong>"):b}),r=r.replace(/_([^\s_][\s\S]*?)_/g,function(b,E){return/\S$/.test(E)?h(E,"<em>","</em>"):b})),p.literalMidWordAsterisks?(r=r.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(b,E,I){return h(I,E+"<strong><em>","</em></strong>")}),r=r.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(b,E,I){return h(I,E+"<strong>","</strong>")}),r=r.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(b,E,I){return h(I,E+"<em>","</em>")})):(r=r.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(b,E){return/\S$/.test(E)?h(E,"<strong><em>","</em></strong>"):b}),r=r.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(b,E){return/\S$/.test(E)?h(E,"<strong>","</strong>"):b}),r=r.replace(/\*([^\s*][\s\S]*?)\*/g,function(b,E){return/\S$/.test(E)?h(E,"<em>","</em>"):b})),r=u.converter._dispatch("italicsAndBold.after",r,p,u),r}),a.subParser("lists",function(r,p,u){function h(I,w){u.gListLevel++,I=I.replace(/\n{2,}$/,`
`),I+="Â¨0";var _=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(Â¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,C=/\n[ \t]*\n(?!Â¨0)/.test(I);return p.disableForced4SpacesIndentedSublists&&(_=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(Â¨0|\2([*+-]|\d+[.])[ \t]+))/gm),I=I.replace(_,function(L,x,T,R,U,j,Q){Q=Q&&Q.trim()!=="";var W=a.subParser("outdent")(U,p,u),J="";return j&&p.tasklists&&(J=' class="task-list-item" style="list-style-type: none;"',W=W.replace(/^[ \t]*\[(x|X| )?]/m,function(){var te='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return Q&&(te+=" checked"),te+=">",te})),W=W.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(te){return"Â¨A"+te}),x||W.search(/\n{2,}/)>-1?(W=a.subParser("githubCodeBlocks")(W,p,u),W=a.subParser("blockGamut")(W,p,u)):(W=a.subParser("lists")(W,p,u),W=W.replace(/\n$/,""),W=a.subParser("hashHTMLBlocks")(W,p,u),W=W.replace(/\n\n+/g,`

`),C?W=a.subParser("paragraphs")(W,p,u):W=a.subParser("spanGamut")(W,p,u)),W=W.replace("Â¨A",""),W="<li"+J+">"+W+`</li>
`,W}),I=I.replace(/Â¨0/g,""),u.gListLevel--,w&&(I=I.replace(/\s+$/,"")),I}function b(I,w){if(w==="ol"){var _=I.match(/^ *(\d+)\./);if(_&&_[1]!=="1")return' start="'+_[1]+'"'}return""}function E(I,w,_){var C=p.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,L=p.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,x=w==="ul"?C:L,T="";if(I.search(x)!==-1)(function U(j){var Q=j.search(x),W=b(I,w);Q!==-1?(T+=`

<`+w+W+`>
`+h(j.slice(0,Q),!!_)+"</"+w+`>
`,w=w==="ul"?"ol":"ul",x=w==="ul"?C:L,U(j.slice(Q))):T+=`

<`+w+W+`>
`+h(j,!!_)+"</"+w+`>
`})(I);else{var R=b(I,w);T=`

<`+w+R+`>
`+h(I,!!_)+"</"+w+`>
`}return T}return r=u.converter._dispatch("lists.before",r,p,u),r+="Â¨0",u.gListLevel?r=r.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(Â¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(I,w,_){var C=_.search(/[*+-]/g)>-1?"ul":"ol";return E(w,C,!0)}):r=r.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(Â¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(I,w,_,C){var L=C.search(/[*+-]/g)>-1?"ul":"ol";return E(_,L,!1)}),r=r.replace(/Â¨0/,""),r=u.converter._dispatch("lists.after",r,p,u),r}),a.subParser("metadata",function(r,p,u){if(!p.metadata)return r;r=u.converter._dispatch("metadata.before",r,p,u);function h(b){u.metadata.raw=b,b=b.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),b=b.replace(/\n {4}/g," "),b.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(E,I,w){return u.metadata.parsed[I]=w,""})}return r=r.replace(/^\s*Â«Â«Â«+(\S*?)\n([\s\S]+?)\nÂ»Â»Â»+\n/,function(b,E,I){return h(I),"Â¨M"}),r=r.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(b,E,I){return E&&(u.metadata.format=E),h(I),"Â¨M"}),r=r.replace(/Â¨M/g,""),r=u.converter._dispatch("metadata.after",r,p,u),r}),a.subParser("outdent",function(r,p,u){return r=u.converter._dispatch("outdent.before",r,p,u),r=r.replace(/^(\t|[ ]{1,4})/gm,"Â¨0"),r=r.replace(/Â¨0/g,""),r=u.converter._dispatch("outdent.after",r,p,u),r}),a.subParser("paragraphs",function(r,p,u){r=u.converter._dispatch("paragraphs.before",r,p,u),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,"");for(var h=r.split(/\n{2,}/g),b=[],E=h.length,I=0;I<E;I++){var w=h[I];w.search(/Â¨(K|G)(\d+)\1/g)>=0?b.push(w):w.search(/\S/)>=0&&(w=a.subParser("spanGamut")(w,p,u),w=w.replace(/^([ \t]*)/g,"<p>"),w+="</p>",b.push(w))}for(E=b.length,I=0;I<E;I++){for(var _="",C=b[I],L=!1;/Â¨(K|G)(\d+)\1/.test(C);){var x=RegExp.$1,T=RegExp.$2;x==="K"?_=u.gHtmlBlocks[T]:L?_=a.subParser("encodeCode")(u.ghCodeBlocks[T].text,p,u):_=u.ghCodeBlocks[T].codeblock,_=_.replace(/\$/g,"$$$$"),C=C.replace(/(\n\n)?Â¨(K|G)\d+\2(\n\n)?/,_),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(C)&&(L=!0)}b[I]=C}return r=b.join(`
`),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),u.converter._dispatch("paragraphs.after",r,p,u)}),a.subParser("runExtension",function(r,p,u,h){if(r.filter)p=r.filter(p,h.converter,u);else if(r.regex){var b=r.regex;b instanceof RegExp||(b=new RegExp(b,"g")),p=p.replace(b,r.replace)}return p}),a.subParser("spanGamut",function(r,p,u){return r=u.converter._dispatch("spanGamut.before",r,p,u),r=a.subParser("codeSpans")(r,p,u),r=a.subParser("escapeSpecialCharsWithinTagAttributes")(r,p,u),r=a.subParser("encodeBackslashEscapes")(r,p,u),r=a.subParser("images")(r,p,u),r=a.subParser("anchors")(r,p,u),r=a.subParser("autoLinks")(r,p,u),r=a.subParser("simplifiedAutoLinks")(r,p,u),r=a.subParser("emoji")(r,p,u),r=a.subParser("underline")(r,p,u),r=a.subParser("italicsAndBold")(r,p,u),r=a.subParser("strikethrough")(r,p,u),r=a.subParser("ellipsis")(r,p,u),r=a.subParser("hashHTMLSpans")(r,p,u),r=a.subParser("encodeAmpsAndAngles")(r,p,u),p.simpleLineBreaks?/\n\nÂ¨K/.test(r)||(r=r.replace(/\n+/g,`<br />
`)):r=r.replace(/  +\n/g,`<br />
`),r=u.converter._dispatch("spanGamut.after",r,p,u),r}),a.subParser("strikethrough",function(r,p,u){function h(b){return p.simplifiedAutoLink&&(b=a.subParser("simplifiedAutoLinks")(b,p,u)),"<del>"+b+"</del>"}return p.strikethrough&&(r=u.converter._dispatch("strikethrough.before",r,p,u),r=r.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(b,E){return h(E)}),r=u.converter._dispatch("strikethrough.after",r,p,u)),r}),a.subParser("stripLinkDefinitions",function(r,p,u){var h=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=Â¨0))/gm,b=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=Â¨0)|(?=\n\[))/gm;r+="Â¨0";var E=function(I,w,_,C,L,x,T){return w=w.toLowerCase(),r.toLowerCase().split(w).length-1<2?I:(_.match(/^data:.+?\/.+?;base64,/)?u.gUrls[w]=_.replace(/\s/g,""):u.gUrls[w]=a.subParser("encodeAmpsAndAngles")(_,p,u),x?x+T:(T&&(u.gTitles[w]=T.replace(/"|'/g,"&quot;")),p.parseImgDimensions&&C&&L&&(u.gDimensions[w]={width:C,height:L}),""))};return r=r.replace(b,E),r=r.replace(h,E),r=r.replace(/Â¨0/,""),r}),a.subParser("tables",function(r,p,u){if(!p.tables)return r;var h=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|Â¨0)/gm,b=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|Â¨0)/gm;function E(L){return/^:[ \t]*--*$/.test(L)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(L)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(L)?' style="text-align:center;"':""}function I(L,x){var T="";return L=L.trim(),(p.tablesHeaderId||p.tableHeaderId)&&(T=' id="'+L.replace(/ /g,"_").toLowerCase()+'"'),L=a.subParser("spanGamut")(L,p,u),"<th"+T+x+">"+L+`</th>
`}function w(L,x){var T=a.subParser("spanGamut")(L,p,u);return"<td"+x+">"+T+`</td>
`}function _(L,x){for(var T=`<table>
<thead>
<tr>
`,R=L.length,U=0;U<R;++U)T+=L[U];for(T+=`</tr>
</thead>
<tbody>
`,U=0;U<x.length;++U){T+=`<tr>
`;for(var j=0;j<R;++j)T+=x[U][j];T+=`</tr>
`}return T+=`</tbody>
</table>
`,T}function C(L){var x,T=L.split(`
`);for(x=0;x<T.length;++x)/^ {0,3}\|/.test(T[x])&&(T[x]=T[x].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(T[x])&&(T[x]=T[x].replace(/\|[ \t]*$/,"")),T[x]=a.subParser("codeSpans")(T[x],p,u);var R=T[0].split("|").map(function(ee){return ee.trim()}),U=T[1].split("|").map(function(ee){return ee.trim()}),j=[],Q=[],W=[],J=[];for(T.shift(),T.shift(),x=0;x<T.length;++x)T[x].trim()!==""&&j.push(T[x].split("|").map(function(ee){return ee.trim()}));if(R.length<U.length)return L;for(x=0;x<U.length;++x)W.push(E(U[x]));for(x=0;x<R.length;++x)a.helper.isUndefined(W[x])&&(W[x]=""),Q.push(I(R[x],W[x]));for(x=0;x<j.length;++x){for(var te=[],de=0;de<Q.length;++de)a.helper.isUndefined(j[x][de]),te.push(w(j[x][de],W[de]));J.push(te)}return _(Q,J)}return r=u.converter._dispatch("tables.before",r,p,u),r=r.replace(/\\(\|)/g,a.helper.escapeCharactersCallback),r=r.replace(h,C),r=r.replace(b,C),r=u.converter._dispatch("tables.after",r,p,u),r}),a.subParser("underline",function(r,p,u){return p.underline&&(r=u.converter._dispatch("underline.before",r,p,u),p.literalMidWordUnderscores?(r=r.replace(/\b___(\S[\s\S]*?)___\b/g,function(h,b){return"<u>"+b+"</u>"}),r=r.replace(/\b__(\S[\s\S]*?)__\b/g,function(h,b){return"<u>"+b+"</u>"})):(r=r.replace(/___(\S[\s\S]*?)___/g,function(h,b){return/\S$/.test(b)?"<u>"+b+"</u>":h}),r=r.replace(/__(\S[\s\S]*?)__/g,function(h,b){return/\S$/.test(b)?"<u>"+b+"</u>":h})),r=r.replace(/(_)/g,a.helper.escapeCharactersCallback),r=u.converter._dispatch("underline.after",r,p,u)),r}),a.subParser("unescapeSpecialChars",function(r,p,u){return r=u.converter._dispatch("unescapeSpecialChars.before",r,p,u),r=r.replace(/Â¨E(\d+)E/g,function(h,b){var E=parseInt(b);return String.fromCharCode(E)}),r=u.converter._dispatch("unescapeSpecialChars.after",r,p,u),r}),a.subParser("makeMarkdown.blockquote",function(r,p){var u="";if(r.hasChildNodes())for(var h=r.childNodes,b=h.length,E=0;E<b;++E){var I=a.subParser("makeMarkdown.node")(h[E],p);I!==""&&(u+=I)}return u=u.trim(),u="> "+u.split(`
`).join(`
> `),u}),a.subParser("makeMarkdown.codeBlock",function(r,p){var u=r.getAttribute("language"),h=r.getAttribute("precodenum");return"```"+u+`
`+p.preList[h]+"\n```"}),a.subParser("makeMarkdown.codeSpan",function(r){return"`"+r.innerHTML+"`"}),a.subParser("makeMarkdown.emphasis",function(r,p){var u="";if(r.hasChildNodes()){u+="*";for(var h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);u+="*"}return u}),a.subParser("makeMarkdown.header",function(r,p,u){var h=new Array(u+1).join("#"),b="";if(r.hasChildNodes()){b=h+" ";for(var E=r.childNodes,I=E.length,w=0;w<I;++w)b+=a.subParser("makeMarkdown.node")(E[w],p)}return b}),a.subParser("makeMarkdown.hr",function(){return"---"}),a.subParser("makeMarkdown.image",function(r){var p="";return r.hasAttribute("src")&&(p+="!["+r.getAttribute("alt")+"](",p+="<"+r.getAttribute("src")+">",r.hasAttribute("width")&&r.hasAttribute("height")&&(p+=" ="+r.getAttribute("width")+"x"+r.getAttribute("height")),r.hasAttribute("title")&&(p+=' "'+r.getAttribute("title")+'"'),p+=")"),p}),a.subParser("makeMarkdown.links",function(r,p){var u="";if(r.hasChildNodes()&&r.hasAttribute("href")){var h=r.childNodes,b=h.length;u="[";for(var E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);u+="](",u+="<"+r.getAttribute("href")+">",r.hasAttribute("title")&&(u+=' "'+r.getAttribute("title")+'"'),u+=")"}return u}),a.subParser("makeMarkdown.list",function(r,p,u){var h="";if(!r.hasChildNodes())return"";for(var b=r.childNodes,E=b.length,I=r.getAttribute("start")||1,w=0;w<E;++w)if(!(typeof b[w].tagName>"u"||b[w].tagName.toLowerCase()!=="li")){var _="";u==="ol"?_=I.toString()+". ":_="- ",h+=_+a.subParser("makeMarkdown.listItem")(b[w],p),++I}return h+=`
<!-- -->
`,h.trim()}),a.subParser("makeMarkdown.listItem",function(r,p){for(var u="",h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);return/\n$/.test(u)?u=u.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):u+=`
`,u}),a.subParser("makeMarkdown.node",function(r,p,u){u=u||!1;var h="";if(r.nodeType===3)return a.subParser("makeMarkdown.txt")(r,p);if(r.nodeType===8)return"<!--"+r.data+`-->

`;if(r.nodeType!==1)return"";var b=r.tagName.toLowerCase();switch(b){case"h1":u||(h=a.subParser("makeMarkdown.header")(r,p,1)+`

`);break;case"h2":u||(h=a.subParser("makeMarkdown.header")(r,p,2)+`

`);break;case"h3":u||(h=a.subParser("makeMarkdown.header")(r,p,3)+`

`);break;case"h4":u||(h=a.subParser("makeMarkdown.header")(r,p,4)+`

`);break;case"h5":u||(h=a.subParser("makeMarkdown.header")(r,p,5)+`

`);break;case"h6":u||(h=a.subParser("makeMarkdown.header")(r,p,6)+`

`);break;case"p":u||(h=a.subParser("makeMarkdown.paragraph")(r,p)+`

`);break;case"blockquote":u||(h=a.subParser("makeMarkdown.blockquote")(r,p)+`

`);break;case"hr":u||(h=a.subParser("makeMarkdown.hr")(r,p)+`

`);break;case"ol":u||(h=a.subParser("makeMarkdown.list")(r,p,"ol")+`

`);break;case"ul":u||(h=a.subParser("makeMarkdown.list")(r,p,"ul")+`

`);break;case"precode":u||(h=a.subParser("makeMarkdown.codeBlock")(r,p)+`

`);break;case"pre":u||(h=a.subParser("makeMarkdown.pre")(r,p)+`

`);break;case"table":u||(h=a.subParser("makeMarkdown.table")(r,p)+`

`);break;case"code":h=a.subParser("makeMarkdown.codeSpan")(r,p);break;case"em":case"i":h=a.subParser("makeMarkdown.emphasis")(r,p);break;case"strong":case"b":h=a.subParser("makeMarkdown.strong")(r,p);break;case"del":h=a.subParser("makeMarkdown.strikethrough")(r,p);break;case"a":h=a.subParser("makeMarkdown.links")(r,p);break;case"img":h=a.subParser("makeMarkdown.image")(r,p);break;default:h=r.outerHTML+`

`}return h}),a.subParser("makeMarkdown.paragraph",function(r,p){var u="";if(r.hasChildNodes())for(var h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);return u=u.trim(),u}),a.subParser("makeMarkdown.pre",function(r,p){var u=r.getAttribute("prenum");return"<pre>"+p.preList[u]+"</pre>"}),a.subParser("makeMarkdown.strikethrough",function(r,p){var u="";if(r.hasChildNodes()){u+="~~";for(var h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);u+="~~"}return u}),a.subParser("makeMarkdown.strong",function(r,p){var u="";if(r.hasChildNodes()){u+="**";for(var h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p);u+="**"}return u}),a.subParser("makeMarkdown.table",function(r,p){var u="",h=[[],[]],b=r.querySelectorAll("thead>tr>th"),E=r.querySelectorAll("tbody>tr"),I,w;for(I=0;I<b.length;++I){var _=a.subParser("makeMarkdown.tableCell")(b[I],p),C="---";if(b[I].hasAttribute("style")){var L=b[I].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(L){case"text-align:left;":C=":---";break;case"text-align:right;":C="---:";break;case"text-align:center;":C=":---:";break}}h[0][I]=_.trim(),h[1][I]=C}for(I=0;I<E.length;++I){var x=h.push([])-1,T=E[I].getElementsByTagName("td");for(w=0;w<b.length;++w){var R=" ";typeof T[w]<"u"&&(R=a.subParser("makeMarkdown.tableCell")(T[w],p)),h[x].push(R)}}var U=3;for(I=0;I<h.length;++I)for(w=0;w<h[I].length;++w){var j=h[I][w].length;j>U&&(U=j)}for(I=0;I<h.length;++I){for(w=0;w<h[I].length;++w)I===1?h[I][w].slice(-1)===":"?h[I][w]=a.helper.padEnd(h[I][w].slice(-1),U-1,"-")+":":h[I][w]=a.helper.padEnd(h[I][w],U,"-"):h[I][w]=a.helper.padEnd(h[I][w],U);u+="| "+h[I].join(" | ")+` |
`}return u.trim()}),a.subParser("makeMarkdown.tableCell",function(r,p){var u="";if(!r.hasChildNodes())return"";for(var h=r.childNodes,b=h.length,E=0;E<b;++E)u+=a.subParser("makeMarkdown.node")(h[E],p,!0);return u.trim()}),a.subParser("makeMarkdown.txt",function(r){var p=r.nodeValue;return p=p.replace(/ +/g," "),p=p.replace(/Â¨NBSP;/g," "),p=a.helper.unescapeHTMLEntities(p),p=p.replace(/([*_~|`])/g,"\\$1"),p=p.replace(/^(\s*)>/g,"\\$1>"),p=p.replace(/^#/gm,"\\#"),p=p.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),p=p.replace(/^( {0,3}\d+)\./gm,"$1\\."),p=p.replace(/^( {0,3})([+-])/gm,"$1\\$2"),p=p.replace(/]([\s]*)\(/g,"\\]$1\\("),p=p.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),p});var G=this;n.exports?n.exports=a:G.showdown=a}).call(Ts)})(ga)),ga.exports}var Ns=Ss();function Os(n){return n.type==="CURVE"}function Ds(n){return n.type==="IMAGE"}function Dn(n,e){return Math.round(n/e)*e}function kn(n,e){return Math.floor(n/e)*e}function Ja(n){return n*(Math.PI/180)}function ks(n){return n*(180/Math.PI)}function _n(n,e,t){return n*(1-t)+e*t}class Ke{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,a){const i=Math.cos(Ja(a)),s=Math.sin(Ja(a)),d=this.subtract(e,t);return{x:t.x+i*d.x-s*d.y,y:t.y+s*d.x+i*d.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:Dn(e.x,t.x),y:Dn(e.y,t.y)}}static floorTo(e,t){return{x:kn(e.x,t.x),y:kn(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,a){return{x:Math.min(Math.max(e.x,t),a),y:Math.min(Math.max(e.y,t),a)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let f of e)t=f.x<t?f.x:t,a=f.x>a?f.x:a,i=f.y<i?f.y:i,s=f.y>s?f.y:s;let d=a-t,l=s-i,c={x:(t+a)/2,y:(i+s)/2};return{min:{x:t,y:i},max:{x:a,y:s},width:d,height:l,center:c}}static pointInPolygon(e,t){const a=this.boundingBox(t);if(e.x<a.min.x||e.x>a.max.x||e.y<a.min.y||e.y>a.max.y)return!1;let i=!1;for(let s=0,d=t.length-1;s<t.length;d=s++){const l=t[s].y>e.y,c=t[d].y>e.y;l!==c&&e.x<(t[d].x-t[s].x)*(e.y-t[s].y)/(t[d].y-t[s].y)+t[s].x&&(i=!i)}return i}static compare(e,t,a){return this.magnitudeSquared(this.subtract(e,t))<a*a}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,a){return{x:_n(e.x,t.x,a),y:_n(e.y,t.y,a)}}static centroid(e){let t={x:0,y:0};for(let a of e)t.x+=a.x,t.y+=a.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Ze{static inverse(e){const[t,a,i,s,d,l,c,f,g]=e,y=t*(d*g-f*l)-a*(s*g-l*c)+i*(s*f-d*c);if(Math.abs(y)<1e-14)return e;const N=1/y,D=(d*g-f*l)*N,k=(i*f-a*g)*N,M=(a*l-i*d)*N,P=(l*c-s*g)*N,F=(t*g-i*c)*N,$=(s*i-t*l)*N,G=(s*f-c*d)*N,r=(c*a-t*f)*N,p=(t*d-s*a)*N;return[D,k,M,P,F,$,G,r,p]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Ja(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Ze.fromPosition(e.position),a=Ze.fromScale(e.scale),i=Ze.fromRotation(e.rotation);return Ze.multiply(Ze.multiply(t,i),a)}static decompose(e){const[t,a,i,s,d,l]=e,c=t*d-s*a,f={position:{x:i,y:l},rotation:0,scale:{x:1,y:1}};if(t!=0||s!=0){var g=Math.sqrt(t*t+s*s);f.rotation=s>0?Math.acos(t/g):-Math.acos(t/g),f.scale={x:g,y:c/g}}else if(a!=0||d!=0){var y=Math.sqrt(a*a+d*d);f.rotation=Math.PI/2-(d>0?Math.acos(-a/y):-Math.acos(a/y)),f.scale={x:c/y,y}}return f.rotation=ks(f.rotation),f}}var xa={exports:{}},Cn;function _s(){return Cn||(Cn=1,(function(n){(function(){function e(l,c){var f=l.x-c.x,g=l.y-c.y;return f*f+g*g}function t(l,c,f){var g=c.x,y=c.y,N=f.x-g,D=f.y-y;if(N!==0||D!==0){var k=((l.x-g)*N+(l.y-y)*D)/(N*N+D*D);k>1?(g=f.x,y=f.y):k>0&&(g+=N*k,y+=D*k)}return N=l.x-g,D=l.y-y,N*N+D*D}function a(l,c){for(var f=l[0],g=[f],y,N=1,D=l.length;N<D;N++)y=l[N],e(y,f)>c&&(g.push(y),f=y);return f!==y&&g.push(y),g}function i(l,c,f,g,y){for(var N=g,D,k=c+1;k<f;k++){var M=t(l[k],l[c],l[f]);M>N&&(D=k,N=M)}N>g&&(D-c>1&&i(l,c,D,g,y),y.push(l[D]),f-D>1&&i(l,D,f,g,y))}function s(l,c){var f=l.length-1,g=[l[0]];return i(l,0,f,c,g),g.push(l[f]),g}function d(l,c,f){if(l.length<=2)return l;var g=c!==void 0?c*c:1;return l=f?l:a(l,g),l=s(l,g),l}n.exports=d,n.exports.default=d})()})(xa)),xa.exports}var Cs=_s();const Ni=bs(Cs);function ze(n){return new Promise(e=>setTimeout(e,n))}function Ls(n,e){if(!n||!e)return!1;const t=n[e];return!t||typeof t!="string"?!1:!isNaN(Number(t))&&t.trim()!==""}async function As(n,e=.8,t,a){const i=await createImageBitmap(n),s=document.createElement("canvas"),d=s.getContext("2d");return s.width=t,s.height=a,d.drawImage(i,0,0,i.width,i.height,0,0,t,a),new Promise(l=>{s.toBlob(c=>{l(c)},"image/webp",e)})}function Ra(){return`${o.EXTENSIONID}/Persistence/${v.playerId}/${v.sceneId}`}async function ma(n,e){if(v.sceneMetadata[`${o.EXTENSIONID}/showWarnings`]===void 0?!0:v.sceneMetadata[`${o.EXTENSIONID}/showWarnings`]===!0){if(n)await m.notification.show("Your browser may have Hardware Acceleration disabled.  Fog and other effects requiring Hardware Acceleration may not display correctly.","WARNING"),await m.action.setBadgeText("âš ï¸"),await m.action.setBadgeBackgroundColor("black");else if(e){const a=e.filter(i=>i.metadata[`${o.EXTENSIONID}/hardwareAcceleration`]!==!0);a.length>0&&await m.notification.show(`Player(s) [${a.map(i=>i.name).join(", ")}] may have Hardware Acceleration disabled on their browsers. Fog and other effects may not display properly for them.`,"WARNING")}}}function Ms(){try{const n=document.createElement("canvas");n.width=100,n.height=100;const e=n.getContext("webgl");if(e){const l=e.getExtension("WEBGL_debug_renderer_info");if(l){const c=e.getParameter(l.UNMASKED_RENDERER_WEBGL),f=e.getParameter(l.UNMASKED_VENDOR_WEBGL);if(c&&["swiftshader","llvmpipe","software","virtualbox","microsoft basic render"].some(y=>c.toLowerCase().includes(y)))return{hasHardwareAcceleration:!1,reason:`Software rendering detected: ${c}`}}}const t=document.createElement("div");t.style.cssText=`
            position: absolute;
            left: -9999px;
            width: 100px;
            height: 100px;
            transform: translateZ(0);
            backface-visibility: hidden;
        `,document.body.appendChild(t);let a=performance.now();const i=100;for(let l=0;l<i;l++)t.style.transform=`translate3d(0, 0, ${l}px)`,t.offsetHeight;const s=performance.now()-a;if(document.body.removeChild(t),s>500)return{hasHardwareAcceleration:!1,reason:`Transform performance indicates software rendering (${s.toFixed(2)}ms)`};const d=n.getContext("2d");if(d){a=performance.now();for(let f=0;f<50;f++)d.filter=`blur(${f%5}px)`,d.fillStyle=`rgba(${f}, ${f}, ${f}, 0.5)`,d.fillRect(0,0,100,100);const l=d.getImageData(0,0,100,100),c=performance.now()-a;if(c>300)return{hasHardwareAcceleration:!1,reason:`Canvas performance indicates software rendering (${c.toFixed(2)}ms)`}}if(navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Vivaldi")){const c=document.createElement("canvas").getContext("2d");if(c&&(c.fillStyle="rgba(0, 0, 0, 0.1)",c.fillRect(0,0,1,1),c.getImageData(0,0,1,1).data[3]!==26))return{hasHardwareAcceleration:!1,reason:"Color handling indicates software rendering"}}return{hasHardwareAcceleration:!0}}catch(n){return console.warn("Error during hardware acceleration detection:",n),{hasHardwareAcceleration:!1,reason:`Detection error: ${n.message}`}}}function $s(){const n=document.createElement("img");return n.id="PatreonButton",n.setAttribute("class","icon"),n.classList.add("patreon-clickable"),n.setAttribute("title",v.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),n.setAttribute("src",v.USER_REGISTERED?"/w-thankyou.svg":"/w-patreon-2.png"),n.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},n}function Pa(n,e,t={curveSegments:10}){const a=[],{curveSegments:i}=t,s=n.length*i;a.length=s;let d=0;function l(c,f){d<s?(a[d]={x:c+e.x,y:f+e.y},d++):a.push({x:c+e.x,y:f+e.y})}for(const c of n){if(c.length<1)throw new Error("Invalid command array: empty array");const f=c[0],g={[ve.MOVE]:3,[ve.LINE]:3,[ve.QUAD]:5,[ve.CONIC]:6,[ve.CUBIC]:7,[ve.CLOSE]:1}[f];if(g===void 0)throw new Error(`Unknown command type: ${f}`);if(c.length!==g)throw new Error(`Invalid command length for type ${f}: expected ${g}, got ${c.length}`);switch(f){case ve.MOVE:{const[y,N,D]=c;l(N,D);break}case ve.LINE:{const[y,N,D]=c;l(N,D);break}case ve.QUAD:{const[y,N,D,k,M]=c,P=a[d-1];if(!P)throw new Error("No starting point for QUAD command");const F={x:P.x-e.x,y:P.y-e.y},$={x:N,y:D},G={x:k,y:M};for(let r=1;r<=i;r++){const p=r/i,u=xs(p,F,$,G);l(u.x,u.y)}break}case ve.CONIC:{const[y,N,D,k,M,P]=c,F=a[d-1];if(!F)throw new Error("No starting point for CONIC command");const $={x:F.x-e.x,y:F.y-e.y},G={x:N,y:D},r={x:k,y:M};for(let p=1;p<=i;p++){const u=p/i,h=Rs(u,$,G,r,P);l(h.x,h.y)}break}case ve.CUBIC:{const[y,N,D,k,M,P,F]=c,$=a[d-1];if(!$)throw new Error("No starting point for CUBIC command");const G={x:$.x-e.x,y:$.y-e.y},r={x:N,y:D},p={x:k,y:M},u={x:P,y:F};for(let h=1;h<=i;h++){const b=h/i,E=Ps(b,G,r,p,u);l(E.x,E.y)}break}case ve.CLOSE:{if(d>0){const y=a[0];l(y.x-e.x,y.y-e.y)}break}}}return a.length=d,Ni(a)}const xs=(n,e,t,a)=>{const i=1-n,s=n*n,d=i*i;return{x:d*e.x+2*i*n*t.x+s*a.x,y:d*e.y+2*i*n*t.y+s*a.y}},Rs=(n,e,t,a,i)=>{const s=1-n,d=s*s+2*s*n*i+n*n;return{x:(s*s*e.x+2*s*n*i*t.x+n*n*a.x)/d,y:(s*s*e.y+2*s*n*i*t.y+n*n*a.y)/d}},Ps=(n,e,t,a,i)=>{const s=1-n,d=n*n,l=s*s,c=l*s,f=d*n;return{x:c*e.x+3*l*n*t.x+3*s*d*a.x+f*i.x,y:c*e.y+3*l*n*t.y+3*s*d*a.y+f*i.y}};function Ia(n,e){const t=n.x-e.x,a=n.y-e.y;return Math.sqrt(t*t+a*a)}function Xs(n,e){let t=!1;const a=e.length;let i=e[0];for(let s=1;s<=a;s++){const d=e[s%a];if(n.y>Math.min(i.y,d.y)&&n.y<=Math.max(i.y,d.y)&&n.x<=Math.max(i.x,d.x)&&i.y!=d.y){const l=(n.y-i.y)*(d.x-i.x)/(d.y-i.y)+i.x;(i.x==d.x||n.x<=l)&&(t=!t)}i=d}return t}function Vs(n,e){const t=n.points,a=e.points;if(t.length!==a.length)return!1;for(let i=0;i<t.length;i++)if(t[i].x!==a[i].x||t[i].y!==a[i].y)return!1;return!0}function Xa(n){n=n.replace(/^#/,"");let e=parseInt(n,16),t=e>>16&255,a=e>>8&255,i=e&255;return{x:t/255,y:a/255,z:i/255}}function Hs(n,e=!1){if(n.indexOf("#")===0&&(n=n.slice(1)),n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error("Invalid HEX color.");var t=parseInt(n.slice(0,2),16),a=parseInt(n.slice(2,4),16),i=parseInt(n.slice(4,6),16);return e?t*.299+a*.587+i*.114>186?"#000000":"#FFFFFF":(t=(255-t).toString(16),a=(255-a).toString(16),i=(255-i).toString(16),"#"+Va(t)+Va(a)+Va(i))}function Va(n,e=0){e=e||2;var t=new Array(e).join("0");return(t+n).slice(-e)}function Ln(n,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),a=t.matches?"dark":"light",i=t.matches?"light":"dark";for(var s=0;s<e.styleSheets.length;s++)for(var d=0;d<e.styleSheets[s].cssRules.length;d++){let l=e.styleSheets[s].cssRules[d];l&&l.media&&l.media.mediaText.includes("prefers-color-scheme")&&(n.mode=="LIGHT"?(l.media.appendMedium(`(prefers-color-scheme: ${a})`),l.media.mediaText.includes(i)&&l.media.deleteMedium(`(prefers-color-scheme: ${i})`)):n.mode=="DARK"&&(l.media.appendMedium(`(prefers-color-scheme: ${i})`),l.media.mediaText.includes(a)&&l.media.deleteMedium(`(prefers-color-scheme: ${a})`)))}}function be(){const n=v.sceneMetadata[`${o.EXTENSIONID}/toolWidth`],e=n!==void 0?parseInt(n):NaN;return Number.isNaN(e)?o.DEFAULTLINEWIDTH:e}function Ne(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionRangeDefault`];return n||o.ATTENUATIONDEFAULT}function Ge(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionSourceDefault`];return n||o.SOURCEDEFAULT}function rt(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionFallOffDefault`];return n||o.FALLOFFDEFAULT}function wa(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionDarkDefault`];return n||o.DARKVISIONDEFAULT}function ft(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionInAngleDefault`];return n||o.INANGLEDEFAULT}function et(){const n=v.sceneMetadata[`${o.EXTENSIONID}/visionOutAngleDefault`];return n||o.OUTANGLEDEFAULT}function Fs(n,e,t,a,i){const s=[[],[]];let d={x:0,y:0},l={x:0,y:0},c=-1,f=-1,g=1/0,y=1/0;const N=$n(n,a,i);for(let F=0;F<N.length-1;F++){const $=N[F],G=N[F+1],r=An($,G,e),p=An($,G,t),u=Ia(e,r),h=Ia(t,p);u<g&&(c=F,d=r,g=u),h<y&&(f=F,l=p,y=h)}(c>f||c===f&&Mn(d,N[c],N[c+1])>Mn(l,N[f],N[f+1]))&&([c,f]=[f,c],[d,l]=[l,d]);let k=[...N];c<=f?(k.splice(c+1,0,d),k.splice(f+2,0,l),s[0]=Ut(k,0,c+1),s[1]=Ut(k,f+2,k.length)):(k.splice(f+1,0,l),k.splice(c+2,0,d),s[0]=Ut(k,0,f+1),s[1]=Ut(k,c+2,k.length));const M=Ut(k,c+1,f+2),P=s.map(F=>$n(F,-a,i));return{extracted:M,remaining:P}}function Ut(n,e,t){return n.slice(e,t+1)}function An(n,e,t){const a={x:e.x-n.x,y:e.y-n.y},i={x:t.x-n.x,y:t.y-n.y},s=i.x*a.x+i.y*a.y,d=a.x*a.x+a.y*a.y,l=s/d,c=Math.max(0,Math.min(1,l));return{x:n.x+c*a.x,y:n.y+c*a.y}}function Mn(n,e,t){const a={x:n.x-e.x,y:n.y-e.y},i={x:t.x-e.x,y:t.y-e.y};return(a.x*i.x+a.y*i.y)/(i.x*i.x+i.y*i.y)}function Bs(n,e,t){const a=e*(Math.PI/180),i=Math.cos(a),s=Math.sin(a),d=n.x-t.x,l=n.y-t.y;return{x:i*d-s*l+t.x,y:s*d+i*l+t.y}}function $n(n,e,t){return n.map(a=>Bs(a,e,t))}function Ft(n){if(n.ctrlKey)return n.pointerPosition;const e=Math.round(v.gridDpi/v.gridSnap),t=Math.round(n.pointerPosition.x/v.gridDpi)*v.gridDpi,a=Math.round(n.pointerPosition.y/v.gridDpi)*v.gridDpi,i=Math.abs(t-n.pointerPosition.x),s=Math.abs(a-n.pointerPosition.y);let d,l;return i<=e?d=t:d=n.pointerPosition.x,s<=e?l=a:l=n.pointerPosition.y,{x:d,y:l}}const Us=100;let Wt=0,De=null;async function Oi(){Wt=0,await m.popover.close(o.LINETOOLID)}async function en(){if(!De)return;const[n,e]=De;e(),De=null,await Oi()}async function ba(){if(!De)return;const[n,e]=De,t=n(a=>{a.visible=!1,a.layer=o.LINELAYER,a.metadata[`${o.EXTENSIONID}/isVisionLine`]=!0,a.metadata[`${o.EXTENSIONID}/blocking`]=!0,a.metadata[`${o.EXTENSIONID}/doubleSided`]=!0,a.points.pop()});t.points.length>=2&&await m.scene.items.addItems([t]),e(),De=null,await Oi()}async function Di(){if(!De)return;const[n]=De;n(e=>{e.points.length>2&&(e.points.pop(),Wt--)})}async function ki(n,e){if(!e.transformer)if(De){if(Wt>=Us){await m.notification.show("Maximum line length reached.","ERROR");return}const[t]=De;t(a=>{a.points.push(e.pointerPosition),Wt++})}else{const t=Ft(e),a=v.snap?t:e.pointerPosition,i=Oe().tension(0).points([a,a]).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).build();De=await m.interaction.startItemInteraction(i),Wt=i.points.length;const s=await m.viewport.getWidth();await m.popover.open({id:o.LINETOOLID,url:"/pages/line.html",height:75,width:350,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:s/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function zs(n,e){if(!De||e.transformer)return;const[t]=De,a=Ft(e);t(i=>{i.points[i.points.length-1]=v.snap?a:e.pointerPosition})}async function Gs(n,e){await ki(n,e),await ba()}function js(n,e){De&&(e.key=="Escape"?en():e.key=="Enter"?ba():e.key==="z"&&Di())}const ra={onToolClick:ki,onToolDouble:Gs,onToolMove:zs,onKeyDown:js},Ws=100;let Yt=0,ke=null;async function _i(){Yt=0,await m.popover.close(o.POLYTOOLID)}async function tn(){if(!ke)return;const[n,e]=ke;e(),ke=null,_i(),await m.player.setMetadata({[`${o.EXTENSIONID}/cancelPoly`]:!1})}async function Ta(){if(!ke)return;const[n,e]=ke,t=n(a=>{a.visible=!1,a.layer=o.LINELAYER,a.style.fillOpacity=0,a.metadata[`${o.EXTENSIONID}/isVisionLine`]=!0,a.metadata[`${o.EXTENSIONID}/blocking`]=!0,a.metadata[`${o.EXTENSIONID}/doubleSided`]=!0,a.points.pop(),a.points.push(a.points[0])});t.points.length>=4&&await m.scene.items.addItems([t]),e(),ke=null,_i(),await m.player.setMetadata({[`${o.EXTENSIONID}/finishPoly`]:!1})}async function Ci(){if(!ke)return;const[n]=ke;n(e=>{e.points.length>2&&(e.points.pop(),Yt--)})}async function Li(n,e){if(!e.transformer)if(ke){if(Yt>=Ws){await m.notification.show("Maximum line length reached.","ERROR");return}const[t]=ke;t(a=>{a.points.push(e.pointerPosition),Yt++})}else{const t=Ft(e),a=v.snap?t:e.pointerPosition,i=Oe().tension(0).points([a,a]).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(.5).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Polygon)").locked(!0).build();ke=await m.interaction.startItemInteraction(i),Yt=i.points.length;const s=await m.viewport.getWidth();await m.popover.open({id:o.POLYTOOLID,url:"/pages/polygon.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:s/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Ys(n,e){if(!ke||e.transformer)return;const[t]=ke,a=Ft(e);t(i=>{i.points[i.points.length-1]=v.snap?a:e.pointerPosition})}async function qs(n,e){await Li(n,e),await Ta()}function Ks(n,e){ke&&(e.key=="Escape"?tn():e.key=="Enter"?Ta():e.key==="z"&&Ci())}const oa={onToolClick:Li,onToolDouble:qs,onToolMove:Ys,onKeyDown:Ks};let _e=null;const Ai=[];async function Mi(){await m.popover.close(o.ELEVATIONTOOLID)}async function fn(){if(!_e)return;const[n,e]=_e;e(),_e=null,Mi()}async function $i(){if(!_e)return;const[n,e]=_e,t=n(a=>{a.visible=!1,a.points.pop(),a.points.push(a.points[0])});if(t.points.length>=4){await m.scene.local.addItems([t]);let a=v.sceneMetadata[`${o.EXTENSIONID}/elevationMapping`];a||(a=[]);const i=t.metadata[`${o.EXTENSIONID}/elevation`]??0,s={Points:t.points,Depth:i};a.push(s),await m.scene.setMetadata({[`${o.EXTENSIONID}/elevationMapping`]:a}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})}e(),_e=null,Mi()}async function xi(){if(!_e)return;const[n]=_e;n(e=>{e.points.length>2&&e.points.pop()})}async function Qs(n,e,t){if(!e.transformer)if(_e){const[a]=_e;a(i=>{i.points.push(e.pointerPosition)})}else{const a=Ft(e),i=v.snap?a:e.pointerPosition,s=Oe().tension(0).points([i,i]).strokeColor(Ri(t)).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??Ai).strokeWidth(be()).fillOpacity(.5).fillColor(Pi(t)).layer(o.LINELAYER).metadata({[`${o.EXTENSIONID}/elevation`]:t}).name(`Elevation-${t} Area`).zIndex(t).locked(!0).build();_e=await m.interaction.startItemInteraction(s);const d=await m.viewport.getWidth();await m.popover.open({id:o.ELEVATIONTOOLID,url:"/pages/elevation.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:60,left:d/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function Zs(n,e){if(!_e||e.transformer)return;const[t]=_e,a=Ft(e);t(i=>{i.points[i.points.length-1]=v.snap?a:e.pointerPosition})}function Js(n,e,t){_e&&(e.key=="Escape"?fn():e.key=="Enter"?$i():e.key==="z"&&xi())}async function er(n){const e=n.metadata[`${o.EXTENSIONID}/elevationEditor`]??!1;if(await m.tool.setMetadata(`${o.EXTENSIONID}/vision-tool`,{[`${o.EXTENSIONID}/elevationEditor`]:!e}),e)await m.popover.close(o.ELEVATIONWARNID),await ar();else{const t=await m.viewport.getWidth();await m.popover.open({id:o.ELEVATIONWARNID,url:"/pages/ewarning.html",height:45,width:430,disableClickAway:!0,anchorPosition:{top:120,left:t/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}}),await tr()}}async function tr(n){const t=(await m.scene.getMetadata())[`${o.EXTENSIONID}/elevationMapping`]??[];if(t&&t.length>0){const a=[];for(const i of t){const s=Oe().tension(0).points(i.Points).strokeColor(Ri(i.Depth)).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??Ai).strokeWidth(be()).fillOpacity(.5).fillColor(Pi(i.Depth)).layer(o.LINELAYER).name("Elevation-1 Area").locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/elevation`]:i.Depth}).zIndex(i.Depth).build();a.push(s)}await m.scene.local.addItems(a)}}async function ar(n){const e=v.sceneLocal.filter(t=>t.metadata[`${o.EXTENSIONID}/elevation`]!==void 0);if(e.length>0){const t=[];for(const a of e){let i=a.points;(a.position.x!==0||a.position.y!==0)&&(i=a.points.map(d=>{const l=d.x+a.position.x,c=d.y+a.position.y;return{x:l,y:c}}));const s={Points:i,Depth:a.metadata[`${o.EXTENSIONID}/elevation`]??0};t.push(s)}await m.scene.setMetadata({[`${o.EXTENSIONID}/elevationMapping`]:t}),await m.scene.local.deleteItems(e.map(a=>a.id)),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})}else await m.scene.setMetadata({[`${o.EXTENSIONID}/elevationMapping`]:[]}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})}function Ri(n){switch(n){case 1:return"#6454ac";case 2:return"#029658";case 3:return"#fcd444";case 4:return"#fc6404";case 5:return"#ff0000";default:return"#000000"}}function Pi(n){switch(n){case 1:return"#6454ac4F";case 2:return"#0296584F";case 3:return"#fcd4444F";case 4:return"#fc64044F";case 5:return"#ff00004F";default:return"#0000004F"}}const Ee={onToolClick:Qs,onToolMove:Zs,onKeyDown:Js,enterEditMode:er,cancelDrawing:fn};function xn(n){return n.metadata[`${o.EXTENSIONID}/isIndicatorRing`]}function zt(n){return n.metadata[`${o.EXTENSIONID}/isVisionLine`]}function nr(n){return n.metadata[`${o.EXTENSIONID}/isVisionLine`]&&!n.metadata[`${o.EXTENSIONID}/disabled`]}function ir(n){return n.metadata[`${o.SPECTREID}/isLocalSpectre`]}function sr(n){return n.metadata[`${o.EXTENSIONID}/isVisionWall`]}function rr(n){return n.metadata[`${o.EXTENSIONID}/isVisionLight`]}function or(n){return n.metadata[`${o.EXTENSIONID}/isPersistentLight`]}function dr(n){return n.metadata[`${o.EXTENSIONID}/isLocalDecal`]}function lr(n){return n.metadata[`${o.EXTENSIONID}/isDarkVision`]}function _t(n){return n.metadata[`${o.EXTENSIONID}/isTorch`]}function Gt(n){return(n.layer==="CHARACTER"||n.layer==="MOUNT"||n.layer==="ATTACHMENT"||n.layer==="PROP")&&n.metadata[`${o.EXTENSIONID}/hasVision`]}function Ae(n){return(n.layer==="CHARACTER"||n.layer==="MOUNT"||n.layer==="ATTACHMENT"||n.layer==="PROP")&&n.metadata[`${o.EXTENSIONID}/hasVision`]}function cr(n){return(n.layer==="CHARACTER"||n.layer==="MOUNT"||n.layer==="ATTACHMENT"||n.layer==="PROP")&&n.createdUserId==v.playerId&&n.metadata[`${o.EXTENSIONID}/hasVision`]}function ur(n){return n.metadata[`${o.EXTENSIONID}/isBrushSquare`]}async function Xi(n,e){const t=await m.scene.local.getItems(a=>a.metadata[`${o.EXTENSIONID}/isFogEffect`]===n.id);t.length>0&&await m.scene.local.deleteItems(t.map(a=>a.id)),e===o.SPOOKYSTYLE?await pr(n):e===o.FOGGYSTYLE?await hr(n):e===o.COSMICSTYLE?await fr(n):e===o.WEIRDSTYLE?await gr(n):e===o.FLESHSTYLE?await mr(n):e===o.DRIPSTYLE?await vr(n):e===o.WATERSTYLE&&await yr(n)}async function fr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.COSMICSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function pr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).blendMode("MULTIPLY").effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.SPOOKYSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function hr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.FOGGYSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function gr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.WEIRDSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function mr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.FLESHSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function vr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.ANNIHILATIONSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}async function yr(n){const e=Je().scale(n.scale).rotation(n.rotation).attachedTo(n.id).effectType("ATTACHMENT").layer("FOG").metadata({[`${o.EXTENSIONID}/isFogEffect`]:n.id}).sksl(o.WATERSHADER).disableHit(!0).zIndex(-.5).build();await m.scene.local.addItems([e])}class Er{cachedWallSegments=[];constructor(){}distanceSquared(e,t){const a=t.x-e.x,i=t.y-e.y;return a*a+i*i}rotatePoint(e,t,a){const i=a*Math.PI/180,s=Math.cos(i),d=Math.sin(i),l=e.x-t.x,c=e.y-t.y;return{x:t.x+(l*s-c*d),y:t.y+(l*d+c*s)}}async UpdateWallSegments(){const e=await m.scene.local.getItems(t=>t.metadata[`${o.EXTENSIONID}/isVisionWall`]===!0);this.cachedWallSegments=[];for(const t of e){if(t.metadata[`${o.EXTENSIONID}/isWindow`]===!0)continue;const a=new Array(t.points.length);for(let i=0;i<t.points.length;i++){const s=t.points[i];a[i]=this.rotatePoint({x:s.x+t.position.x,y:s.y+t.position.y},t.position,t.rotation)}for(let i=0;i<a.length-1;i++)this.cachedWallSegments.push({start:a[i],end:a[i+1]})}}lineIntersects(e,t,a,i){function s(y,N,D){const k=(N.y-y.y)*(D.x-N.x)-(N.x-y.x)*(D.y-N.y);return k===0?0:k>0?1:2}function d(y,N,D){return N.x<=Math.max(y.x,D.x)&&N.x>=Math.min(y.x,D.x)&&N.y<=Math.max(y.y,D.y)&&N.y>=Math.min(y.y,D.y)}const l=s(e,t,a),c=s(e,t,i),f=s(a,i,e),g=s(a,i,t);return!!(l!==c&&f!==g||l===0&&d(e,a,t)||c===0&&d(e,i,t)||f===0&&d(a,e,i)||g===0&&d(a,t,i))}isLineOfSightBlocked(e,t){const a=this.GetDepth(this.GetMappedDepth(t.position),!1),i=e.zIndex;return a>i?!1:this.IsLineOfSightBlocked(e.position,t.position)}IsLineOfSightBlocked(e,t,a){const i=Math.min(e.x,t.x),s=Math.max(e.x,t.x),d=Math.min(e.y,t.y),l=Math.max(e.y,t.y);for(const c of this.cachedWallSegments){if(a&&a.points.length>1){const f={x:a.points[0].x+a.position.x,y:a.points[0].y+a.position.y},g={x:a.points[1].x+a.position.x,y:a.points[1].y+a.position.y},y=(N,D)=>N.x===D.x&&N.y===D.y;if(y(c.start,f)&&y(c.end,g)||y(c.start,g)&&y(c.end,f))continue}if(!(Math.max(c.start.x,c.end.x)<i||Math.min(c.start.x,c.end.x)>s||Math.max(c.start.y,c.end.y)<d||Math.min(c.start.y,c.end.y)>l)&&this.lineIntersects(e,t,c.start,c.end))return!0}return!1}GetDepth(e,t){if(e===-10){const i=v.sceneMetadata[`${o.EXTENSIONID}/defaultElevation`];typeof i=="string"&&(e=parseInt(i))}if(v.sceneMetadata[`${o.EXTENSIONID}/elevationComplex`]===!0)switch(e){case 1:return-5;case 2:return-6;case 3:return-7;case 4:return-8;case 5:return-9;case 6:return-10;default:return-1}else switch(e){case 1:return t?-4:-5;case 2:return t?-5:-6;case 3:return t?-6:-7;case 4:return t?-7:-8;case 5:return t?-8:-9;case 6:return t?-9:-10;default:return-1}}GetMappedDepth(e){const t=v.sceneMetadata[`${o.EXTENSIONID}/elevationMapping`]??[];let a=-10;if(!t||!t.length||t.length===0)return a;for(const i of t){if(i.Depth<=a)continue;const s=this.getPolygonBounds(i.Points);if(e.x<s.minX||e.x>s.maxX||e.y<s.minY||e.y>s.maxY)continue;Xs(e,i.Points)&&i.Depth>a&&(a=i.Depth)}return a}getPolygonBounds(e){if(e.length===0)return{minX:0,maxX:0,minY:0,maxY:0};let t=e[0].x,a=e[0].x,i=e[0].y,s=e[0].y;for(let d=1;d<e.length;d++){const l=e[d];l.x<t&&(t=l.x),l.x>a&&(a=l.x),l.y<i&&(i=l.y),l.y>s&&(s=l.y)}return{minX:t,maxX:a,minY:i,maxY:s}}async UpdateWindowVisibility(e,t){v.disableWindows=[],v.enableWindows=[];for(const a of t){const i=a.points.map(l=>({x:l.x+a.position.x,y:l.y+a.position.y})),s=Ke.centroid(i),d=this.GetMappedDepth(s);for(const l of e){const c=this.GetMappedDepth(l.position),f=l.attenuationRadius,g=f*f;this.distanceSquared(l.position,s)<=g&&(c>=d?a.visible&&v.enableWindows.push(a.id):a.visible||v.disableWindows.push(a.id))}}}async HideEnemies(e,t){const a=[],i=[];for(const s of t)for(const d of e){const l=d.attenuationRadius,c=l*l;if(this.distanceSquared(d.position,s.position)<=c&&!this.isLineOfSightBlocked(d,s)){i.push(s.id);continue}a.push(s.id)}await m.scene.items.updateItems(t.map(s=>s.id),s=>{for(let d of s)a.includes(d.id)&&!i.includes(d.id)?d.visible&&(d.visible=!1):d.visible||(d.visible=!0)})}}class Ir{VisibilityChecker;wallsToCreate=[];wallsToUpdate=[];wallsToDelete=[];wallsToError=[];wallsNotOwner=[];lightsToCreate=[];lightsToUpdate=[];lightsToDelete=[];ringsToCreate=[];ringsToUpdate=[];ringsToDelete=[];decalsToCreate=[];decalsToUpdate=[];decalsToDelete=[];darkVisionToCreate=[];darkVisionToUpdate=[];darkVisionToDelete=[];revealersToCreate=[];revealersToUpdate=[];revealersToDelete=[];persistentLights=[];persistenceCullingDistance=1;persistenceLimit=50;trailingFoggedMaps=[];trailingFogTokens=[];constructor(){this.VisibilityChecker=new Er}async Initialize(){if(v.sceneMetadata[`${o.EXTENSIONID}/persistence`]===!0){const t=localStorage.getItem(Ra());if(t){const a=JSON.parse(t);if(a.length>0)for(let i of a)i.id=i.metadata[`${o.EXTENSIONID}/isPersistentLight`],this.AddPersistentLightToQueue(i,i.zIndex)}}const e=v.sceneItems.filter(t=>t.metadata[`${o.EXTENSIONID}/FogBackgroundId`]!==void 0);for(const t of e){const a=t.metadata[`${o.EXTENSIONID}/FogBackgroundId`],i=t.metadata[`${o.EXTENSIONID}/hasFogBackground`],s=v.sceneItems.filter(d=>d.id===a);if(s.length>0){const d=s[0];await Xi(d,i)}}}async Reset(){this.persistentLights=[],this.trailingFogTokens=[],this.trailingFoggedMaps=[]}async Run(){await this.UpdateTrailingFogMaps(),await this.UpdateWindowVisibility(),await this.UpdateWalls(),await this.UpdateDoors(),await this.UpdateLights(),await this.UpdateOwnershipHighlights(),await this.UpdateTrailingFogTokens(),await this.UpdateAutoHideTokens(),v.sceneMetadata[`${o.EXTENSIONID}/persistence`]===!0&&localStorage.setItem(Ra(),JSON.stringify(this.persistentLights))}async UpdateWindowVisibility(){const e=(await m.scene.local.getItems(a=>a.metadata[`${o.EXTENSIONID}/isVisionLight`]===!0)).filter(a=>a.lightType==="PRIMARY"),t=await m.scene.local.getItems(a=>a.metadata[`${o.EXTENSIONID}/isWindow`]===!0);await this.VisibilityChecker.UpdateWindowVisibility(e,t)}async UpdateAutoHideTokens(){if(v.sceneMetadata[`${o.EXTENSIONID}/autoHide`]===!0&&v.playerRole==="GM"){const e=(await m.scene.local.getItems(a=>a.metadata[`${o.EXTENSIONID}/isVisionLight`]===!0)).filter(a=>a.lightType==="PRIMARY"),t=await m.scene.items.getItems(a=>a.metadata[`${o.EXTENSIONID}/isAutoHidden`]===!0);await this.VisibilityChecker.HideEnemies(e,t)}}async UpdateTrailingFogMaps(){v.sceneMetadata[`${o.EXTENSIONID}/trailingFog`]===!0&&v.fogFilled&&await this.CreateTrailingFogOverlay()}async UpdateTrailingFogTokens(){if(v.sceneMetadata[`${o.EXTENSIONID}/trailingFog`]===!0&&v.fogFilled)this.revealersToCreate.length>0&&(await m.scene.local.addItems(this.revealersToCreate),this.revealersToCreate=[]);else if(this.trailingFogTokens.length>0||this.trailingFoggedMaps.length>0){const e=v.sceneLocal.filter(a=>a.metadata[`${o.EXTENSIONID}/isTrailingFogLight`]!==void 0),t=v.sceneLocal.filter(a=>a.metadata[`${o.EXTENSIONID}/isTrailingFogger`]!==void 0);t.length>0&&await m.scene.local.deleteItems(t.map(a=>a.id)),e.length>0&&await m.scene.local.deleteItems(e.map(a=>a.id)),this.trailingFogTokens=[],this.trailingFoggedMaps=[]}}async UpdateTrailingFogColor(e){const t=v.sceneLocal.filter(i=>i.metadata[`${o.EXTENSIONID}/isTrailingFogLight`]!==void 0);await m.scene.local.updateItems(t.map(i=>i.id),i=>{for(let s of i)s.uniforms=[{name:"darknessLevel",value:.65},{name:"darknessColor",value:Xa(e)},{name:"radiusRatio",value:1}]});const a=v.sceneLocal.filter(i=>i.metadata[`${o.EXTENSIONID}/isTrailingFogger`]!==void 0);await m.scene.local.updateItems(a.map(i=>i.id),i=>{for(let s of i)s.uniforms=[{name:"darknessLevel",value:.65},{name:"darknessColor",value:Xa(e)}]})}CreateTrailingFogRevealer(e){if(v.sceneMetadata[`${o.EXTENSIONID}/trailingFog`]===!0&&!this.trailingFogTokens.includes(e.id)){const t=Je().position(e.position).attachedTo(e.id).rotation(e.rotation).scale(e.scale).width(200).height(200).effectType("ATTACHMENT").layer("POST_PROCESS").sksl(o.TRAILINGFOGREVEALSHADER).uniforms([{name:"radiusRatio",value:1},{name:"rotation",value:e.rotation}]).metadata({[`${o.EXTENSIONID}/isTrailingFogLight`]:e.id}).disableHit(!0).disableAutoZIndex(!0).zIndex(200).build();this.revealersToCreate.push(t),this.trailingFogTokens.push(e.id)}}async CreateTrailingFogOverlay(){const e=[],t=v.sceneItems.filter(a=>a.layer==="MAP"&&a.type==="IMAGE");for(const a of t)if(!this.trailingFoggedMaps.includes(a.id)){const i=Je().position(a.position).attachedTo(a.id).scale(a.scale).width(a.image.width).height(a.image.height).effectType("ATTACHMENT").layer("POST_PROCESS").sksl(o.TRAILINGFOGSHADER).uniforms([{name:"darknessLevel",value:.65},{name:"darknessColor",value:Xa(v.fogColor)}]).metadata({[`${o.EXTENSIONID}/isTrailingFogger`]:a.id}).disableHit(!0).disableAutoZIndex(!0).zIndex(100).build();e.push(i),this.trailingFoggedMaps.push(a.id)}e.length>0&&await m.scene.local.addItems(e)}async ClearDoors(){if(v.playerRole!=="PLAYER")return;const e=v.sceneLocal.filter(t=>t.metadata[`${o.EXTENSIONID}/localDoor`]===!0);await m.scene.local.deleteItems(e.map(t=>t.id))}async UpdateDoors(){this.IsPlayerNearDoor(),this.ShowGMDoors()}async IsPlayerNearDoor(){if(v.playerRole==="GM"||v.sceneMetadata[`${o.EXTENSIONID}/playerDoors`]!==!0)return;let e=this.getTokensICanSeeThrough();e=e.filter(i=>i.layer==="CHARACTER"||i.layer==="MOUNT");const t=await m.scene.items.getItems(i=>i.type==="CURVE"&&i.metadata[`${o.EXTENSIONID}/isDoor`]===!0),a=[];for(const i of e){const s=i.position,d=this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionRange`]??Ne());for(const l of t){const c=l.points.map(D=>({x:D.x+l.position.x,y:D.y+l.position.y})),f=Ke.centroid(c),g=f.x-s.x,y=f.y-s.y;Math.sqrt(g*g+y*y)<=d&&(this.VisibilityChecker.IsLineOfSightBlocked(i.position,f,l)||a.push(l))}}this.UpdateVisibleDoors(a)}async ShowGMDoors(){if(v.playerRole==="PLAYER")return;const e=await m.scene.items.getItems(t=>t.type==="CURVE"&&t.metadata[`${o.EXTENSIONID}/isDoor`]===!0);this.UpdateVisibleDoors(e)}async UpdateVisibleDoors(e){const t=v.sceneLocal.filter(a=>a.metadata[`${o.EXTENSIONID}/localDoor`]===!0);if(e.length>0){const a=[];for(const i of e)if(!t.some(s=>s.attachedTo===i.id)){const s=i.metadata[`${o.EXTENSIONID}/doorOpen`]===!0,d=i.metadata[`${o.EXTENSIONID}/isDoorLocked`]===!0,l=Ze.fromItem(i),c=[];for(let N=0;N<i.points.length;N++){const D=Ze.fromPosition(i.points[N]);c.push(Ze.decompose(Ze.multiply(l,D)).position)}let f=o.DOOROPEN,g="Opened Door";v.playerRole==="GM"&&d?(f=o.DOORLOCKED,g="Locked Door"):s||(f=o.DOORCLOSED,g="Closed Door");const y=Ke.centroid(c);a.push(Ea({height:100,width:100,url:f,mime:"image/svg+xml"},{dpi:150,offset:{x:50,y:50}}).scale({x:.75,y:.75}).attachedTo(i.id).layer(o.LINELAYER).zIndex(i.zIndex+10).locked(!0).name(g).position({x:y.x,y:y.y}).metadata({[`${o.EXTENSIONID}/localDoor`]:!0}).build())}a.length>0&&await m.scene.local.addItems(a)}else t.length>0&&await m.scene.local.deleteItems(t.map(a=>a.id));if(t.length>0){const a=[],i=[],s=[],d=[];for(const l of t){const c=e.find(f=>f.id===l.attachedTo&&f.metadata[`${o.EXTENSIONID}/isDoor`]===!0);c?v.playerRole==="GM"&&l.image.url!==o.DOORLOCKED&&c.metadata[`${o.EXTENSIONID}/isDoorLocked`]===!0?s.push(l.id):l.image.url!==o.DOOROPEN&&c.metadata[`${o.EXTENSIONID}/doorOpen`]===!0?a.push(l.id):l.image.url!==o.DOORCLOSED&&c.metadata[`${o.EXTENSIONID}/doorOpen`]!==!0&&(v.playerRole==="GM"&&c.metadata[`${o.EXTENSIONID}/isDoorLocked`]!==!0||v.playerRole==="PLAYER")&&i.push(l.id):d.push(l.id)}s.length>0&&await m.scene.local.updateItems(l=>s.includes(l.id),l=>{for(let c of l)c.image.url=o.DOORLOCKED,c.name="Locked Door"}),a.length>0&&await m.scene.local.updateItems(l=>a.includes(l.id),l=>{for(let c of l)c.image.url=o.DOOROPEN,c.name="Opened Door"}),i.length>0&&await m.scene.local.updateItems(l=>i.includes(l.id),l=>{for(let c of l)c.image.url=o.DOORCLOSED,c.name="Closed Door"}),d.length>0&&await m.scene.local.deleteItems(d)}}async ClearPersistence(){const e=await m.scene.local.getItems(t=>t.metadata[`${o.EXTENSIONID}/getPersistentLight`]===!0);await m.scene.local.deleteItems(e.map(t=>t.id)),this.persistentLights=[],localStorage.setItem(Ra(),JSON.stringify(this.persistentLights))}async TogglePersistentLightVisibility(e){await m.scene.local.updateItems(t=>or(t)!==void 0,t=>{for(let a of t)a.visible=!e})}async ClearOwnershipHighlights(){const e=v.sceneLocal.filter(t=>xn(t));await m.scene.local.deleteItems(e.map(t=>t.id))}async InitiateOwnerHighlight(){if(v.playerRole!=="GM"||v.fogFilled===!1)return;const e=v.sceneItems.filter(t=>Gt(t));for(const t of e){const a=v.sceneItems.find(i=>i.id===t.metadata[`${o.EXTENSIONID}/linkedTo`]);this.CreateOwnerHighlight(t,a,!0)}}CreateOwnerHighlight(e,t,a=!1){const i=t??e;if((v.playerRole!=="GM"||v.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]!==!0)&&!a)return;const s=parseInt(i.metadata[`${o.EXTENSIONID}/visionDark`])>parseInt(i.metadata[`${o.EXTENSIONID}/visionRange`]),d=this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionDark`]);if(v.sceneLocal.find(c=>c.metadata[`${o.EXTENSIONID}/isIndicatorRing`]===!0&&c.attachedTo===e.id))this.UpdateOwnerHightlight(e);else{const c=v.sceneMetadata[`${o.EXTENSIONID}/USER-${e.createdUserId}`],f=this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionRange`]??Ne()),g=vs().strokeColor(c.color).fillOpacity(0).position({x:e.position.x,y:e.position.y}).width(s?d*2:f*2).height(s?d*2:f*2).shapeType("CIRCLE").metadata({[`${o.EXTENSIONID}/isIndicatorRing`]:!0}).attachedTo(e.id).locked(!0).layer(o.LINELAYER).disableAttachmentBehavior(["SCALE"]).zIndex(1).build();this.ringsToCreate.push(g)}}UpdateDarkVision(e,t){const a=t??e,i=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionDark`])*2,d=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionRange`])*2/i/2,l={x:e.position.x-i/2,y:e.position.y-i/2},c=[{name:"center",value:{x:.5,y:.5}},{name:"radius",value:.5},{name:"clear",value:d},{name:"smoothwidth",value:.0075}],f=v.sceneLocal.find(g=>g.attachedTo===e.id&&g.metadata[`${o.EXTENSIONID}/isDarkVision`]===!0);if(f){const g={id:f.id,size:i,position:l,uniforms:c};this.darkVisionToUpdate.push(g)}}UpdateOwnerHightlight(e,t){const a=t??e;if(v.playerRole!=="GM"||v.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]!==!0)return;const i=parseInt(a.metadata[`${o.EXTENSIONID}/visionDark`])>parseInt(a.metadata[`${o.EXTENSIONID}/visionRange`]),s=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionDark`]),d=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionRange`]??Ne()),l=v.sceneLocal.find(c=>c.attachedTo===e.id&&c.metadata[`${o.EXTENSIONID}/isIndicatorRing`]===!0);if(l){const c={id:l.id,height:i?s*2:d*2,width:i?s*2:d*2};this.ringsToUpdate.push(c)}}async UpdateOwnershipHighlights(){if(v.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]===!0){if(this.ringsToCreate.length>0&&await m.scene.local.addItems(this.ringsToCreate),this.ringsToDelete.length>0&&await m.scene.local.deleteItems(this.ringsToDelete),this.ringsToUpdate.length>0){const e=v.sceneLocal.filter(t=>xn(t));await m.scene.local.updateItems(e.filter(t=>!this.ringsToDelete.includes(t.id)),t=>{for(let a of t){const i=this.ringsToUpdate.find(s=>s.id===a.id);i&&(a.height=i.height,a.width=i.width)}})}this.ringsToCreate=[],this.ringsToUpdate=[],this.ringsToDelete=[]}}async UpdateLights(){let e=[];if(v.playerRole==="GM"){const s=document.getElementById("preview_select");if(s&&s.value!==v.playerId){const d=v.sceneItems.filter(f=>Gt(f)),l=[],c=[];for(const f of d)f.createdUserId===s.value?l.push(f):v.sceneMetadata[`${o.EXTENSIONID}/USER-${f.createdUserId}`]?.role==="GM"&&c.push(f);e=[...l,...c]}else e=v.sceneItems.filter(d=>Gt(d))}else{const s=v.sceneItems.filter(c=>Gt(c)),d=[],l=[];for(const c of s)c.createdUserId===v.playerId?d.push(c):v.sceneMetadata[`${o.EXTENSIONID}/USER-${c.createdUserId}`]?.role==="GM"&&l.push(c);e=[...d,...l]}v.sceneMetadata[`${o.EXTENSIONID}/disableVision`]===!0&&(e=[]);for(const s of e){let d=this.VisibilityChecker.GetMappedDepth(s.position);const l=v.sceneItems.find(g=>g.id===s.metadata[`${o.EXTENSIONID}/linkedTo`]),c=s.metadata[`${o.EXTENSIONID}/unitDepth`];c&&(d=parseInt(c));const f=v.sceneLocal.find(g=>g.attachedTo===s.id&&g.metadata[`${o.EXTENSIONID}/isVisionLight`]===!0);if(!f)this.CreateLightToQueue(s,d,l);else{const g=l??s,y=g.metadata[`${o.EXTENSIONID}/visionRange`]===f.metadata[`${o.EXTENSIONID}/visionRange`],N=g.metadata[`${o.EXTENSIONID}/visionSourceRange`]===f.metadata[`${o.EXTENSIONID}/visionSourceRange`],D=g.metadata[`${o.EXTENSIONID}/visionFallOff`]===f.falloff?.toString(),k=g.metadata[`${o.EXTENSIONID}/visionInAngle`]===f.innerAngle?.toString(),M=g.metadata[`${o.EXTENSIONID}/visionOutAngle`]===f.outerAngle?.toString(),P=g.metadata[`${o.EXTENSIONID}/visionBlind`]===!0===f.metadata[`${o.EXTENSIONID}/visionBlind`],F=g.metadata[`${o.EXTENSIONID}/visionDark`]===f.metadata[`${o.EXTENSIONID}/visionDark`],$=this.VisibilityChecker.GetDepth(d,!1)===f.zIndex,G=g.metadata[`${o.EXTENSIONID}/visionFacing`]===f.metadata[`${o.EXTENSIONID}/visionFacing`],r=v.sceneLocal.find(p=>p.metadata[`${o.EXTENSIONID}/isDarkVision`]===!0&&p.attachedTo===s.id);(!y||!N||!D||!k||!M||!P||!$||!F||!G)&&(this.UpdateLightToQueue(s,f,d,l),r&&(!F||!y?this.UpdateDarkVision(s,l):g.metadata[`${o.EXTENSIONID}/visionDark`]&&!r&&this.CreateDarkVisionToQueue(s,l))),f.lightType==="PRIMARY"&&this.CreateTrailingFogRevealer(f)}s.layer==="CHARACTER"&&(s.metadata[`${o.EXTENSIONID}/visionInAngle`]!=="360"||s.metadata[`${o.EXTENSIONID}/visionOutAngle`]!=="360")&&(v.sceneLocal.find(y=>y.metadata[`${o.EXTENSIONID}/isLocalDecal`]===s.id)||this.CreateDecalToQueue(s)),v.sceneMetadata[`${o.EXTENSIONID}/persistence`]===!0&&s.metadata[`${o.EXTENSIONID}/visionBlind`]!==!0&&(this.persistentLights.find(y=>y.position.x===s.position.x&&y.position.y===s.position.y)?(s.metadata[`${o.EXTENSIONID}/visionInAngle`]!==360||s.metadata[`${o.EXTENSIONID}/visionInAngle`]!==360)&&this.IsPositionAndRotationClear(s.rotation,s.position)&&this.AddPersistentLightToQueue(s,d,l):this.IsPositionClear(s.position)&&this.AddPersistentLightToQueue(s,d,l))}const t=v.sceneLocal.filter(s=>rr(s));for(const s of t)if(!e.find(l=>l.id===s.attachedTo)){this.lightsToDelete.push(s.id);const l=v.sceneLocal.find(c=>c.metadata[`${o.EXTENSIONID}/isIndicatorRing`]===!0&&c.attachedTo===s.attachedTo);l&&this.ringsToDelete.push(l.id)}const a=v.sceneLocal.filter(s=>dr(s));for(const s of a){const d=e.find(l=>l.id===s.metadata[`${o.EXTENSIONID}/isLocalDecal`]);d?d.metadata[`${o.EXTENSIONID}/visionInAngle`]==="360"||d.metadata[`${o.EXTENSIONID}/visionOutAngle`]==="360"?this.decalsToDelete.push(s.id):d.image.url!==s.image.url&&this.decalsToUpdate.push({id:s.id,imageUrl:d.image.url}):this.decalsToDelete.push(s.id)}const i=v.sceneLocal.filter(s=>lr(s));for(const s of i){const d=e.find(l=>s.metadata[`${o.EXTENSIONID}/isDarkVision`]===!0&&s.attachedTo===l.id);d?parseInt(d.metadata[`${o.EXTENSIONID}/visionDark`])<parseInt(d.metadata[`${o.EXTENSIONID}/visionRange`])&&this.decalsToDelete.push(s.id):this.decalsToDelete.push(s.id)}this.lightsToDelete.length>0&&await m.scene.local.deleteItems(this.lightsToDelete),this.lightsToCreate.length>0&&await m.scene.local.addItems(this.lightsToCreate),this.lightsToUpdate.length>0&&await m.scene.local.updateItems(t.filter(s=>!this.lightsToDelete.includes(s.id)),s=>{for(let d of s){const l=this.lightsToUpdate.find(c=>c.id===d.id);l&&(d.attenuationRadius=l.attenuationRadius,d.sourceRadius=l.sourceRadius,d.falloff=l.falloff,d.innerAngle=l.innerAngle,d.outerAngle=l.outerAngle,d.rotation=l.tokenFacing+this.findLightDirection(l.visionFacing),d.metadata[`${o.EXTENSIONID}/visionFacing`]=l.visionFacing,d.metadata[`${o.EXTENSIONID}/visionBlind`]=l.blind,d.metadata[`${o.EXTENSIONID}/visionRange`]=l.visionRange,d.metadata[`${o.EXTENSIONID}/visionSourceRange`]=l.visionSourceRange,d.zIndex=l.zIndex)}}),this.decalsToCreate.length>0&&await m.scene.local.addItems(this.decalsToCreate),this.decalsToDelete.length>0&&await m.scene.local.deleteItems(this.decalsToDelete),this.decalsToUpdate.length>0&&await m.scene.local.updateItems(a.filter(s=>!this.decalsToDelete.includes(s.id)),s=>{for(let d of s){const l=this.decalsToUpdate.find(c=>c.id===d.id);l&&(d.image.url=l.imageUrl)}}),this.darkVisionToCreate.length>0&&await m.scene.local.addItems(this.darkVisionToCreate),this.darkVisionToDelete.length>0&&await m.scene.local.deleteItems(this.darkVisionToDelete),this.darkVisionToUpdate.length>0&&await m.scene.local.updateItems(i.filter(s=>!this.darkVisionToDelete.includes(s.id)),s=>{for(let d of s){const l=this.darkVisionToUpdate.find(c=>c.id===d.id);l&&(d.width=l.size,d.height=l.size,d.position=l.position,d.uniforms=l.uniforms)}}),this.lightsToCreate=[],this.lightsToUpdate=[],this.lightsToDelete=[],this.decalsToCreate=[],this.decalsToDelete=[],this.decalsToUpdate=[],this.darkVisionToCreate=[],this.darkVisionToUpdate=[],this.darkVisionToDelete=[]}async UpdateWalls(){const e=v.sceneMetadata[`${o.EXTENSIONID}/passWallsGM`]===!0&&v.playerRole==="GM",t=v.sceneItems.filter(s=>nr(s));for(const s of t){if(s.type!=="CURVE"||s.points===void 0){this.wallsToError.push(s.id);continue}const d=s.metadata[`${o.EXTENSIONID}/wallViewers`];if(!d||d&&d.length>0&&d[0]===v.playerId||v.playerRole==="GM"){let l=this.VisibilityChecker.GetMappedDepth({x:s.points[0].x+s.position.x,y:s.points[0].y+s.position.y});const c=s.metadata[`${o.EXTENSIONID}/wallDepth`];c&&(l=parseInt(c));const f=v.sceneLocal.find(g=>g.attachedTo===s.id&&g.metadata[`${o.EXTENSIONID}/isVisionWall`]===!0);if(!f)this.CreateWallToQueue(s,l);else{const g=Vs(s,f),y=s.rotation===f.rotation,N=s.scale.x===f.scale.x&&s.scale.y===f.scale.y,D=s.position.x===f.position.x&&s.position.y===f.position.y,k=s.metadata[`${o.EXTENSIONID}/doubleSided`]===f.doubleSided,M=this.VisibilityChecker.GetDepth(l,!0)===f.zIndex,P=s.metadata[`${o.EXTENSIONID}/isWindow`]===f.metadata[`${o.EXTENSIONID}/isWindow`];let F=(e?!1:s.metadata[`${o.EXTENSIONID}/blocking`])===f.blocking;(!g||!D||!y||!N||!F||!k||!M||!P)&&this.UpdateWallToQueue(s,f,l)}}else this.wallsNotOwner.push(s.id)}const a=v.sceneLocal.filter(s=>sr(s));for(const s of a){if(!t.find(l=>l.id===s.attachedTo)){this.wallsToDelete.push(s.id);continue}this.wallsNotOwner.includes(s.attachedTo)&&this.wallsToDelete.push(s.id)}let i=!1;this.wallsToCreate.length>0&&(await m.scene.local.addItems(this.wallsToCreate),i=!0),this.wallsToDelete.length>0&&(await m.scene.local.deleteItems(this.wallsToDelete),i=!0),(this.wallsToUpdate.length>0||v.disableWindows.length>0||v.enableWindows.length>0)&&(await m.scene.local.updateItems(a.filter(s=>!this.wallsToDelete.includes(s.id)),s=>{for(let d of s){const l=v.disableWindows.includes(d.id),c=v.enableWindows.includes(d.id),f=this.wallsToUpdate.find(g=>g.id===d.id);f&&(d.points=f.points,d.position=f.position,d.rotation=f.rotation,d.scale=f.scale,d.blocking=f.blocking,d.visible=f.visible,d.doubleSided=f.doubleSided,d.zIndex=f.zIndex,d.metadata[`${o.EXTENSIONID}/isWindow`]=f.window),l&&(d.visible=!0),c&&(d.visible=!1)}}),i=!0),this.wallsToError.length>0&&(await m.scene.items.updateItems(this.wallsToError,s=>{for(let d of s)d.style.strokeDash=[10,30],d.style.strokeColor="red",delete d.metadata[`${o.EXTENSIONID}/isDoorLocked`],delete d.metadata[`${o.EXTENSIONID}/doorOpen`],delete d.metadata[`${o.EXTENSIONID}/disabled`],delete d.metadata[`${o.EXTENSIONID}/isDoor`],delete d.metadata[`${o.EXTENSIONID}/doubleSided`],delete d.metadata[`${o.EXTENSIONID}/disabled`],delete d.metadata[`${o.EXTENSIONID}/isVisionLine`],delete d.metadata[`${o.EXTENSIONID}/blocking`]}),i=!0),this.wallsToCreate=[],this.wallsToUpdate=[],this.wallsToDelete=[],this.wallsToError=[],this.wallsNotOwner=[],i&&(await this.VisibilityChecker.UpdateWallSegments(),i=!1)}CreateWallToQueue(e,t){if(!e.points)return;let a=e.metadata[`${o.EXTENSIONID}/blocking`]===!0;const i=e.metadata[`${o.EXTENSIONID}/isWindow`]===!0,s=e.metadata[`${o.EXTENSIONID}/doubleSided`]===!0;v.playerRole==="GM"&&v.sceneMetadata[`${o.EXTENSIONID}/passWallsGM`]===!0&&(a=!1);const d=ys().points(e.points).attachedTo(e.id).rotation(e.rotation).position(e.position).locked(!0).scale(e.scale).blocking(a).doubleSided(s).visible(!i).disableAttachmentBehavior(["VISIBLE"]).zIndex(this.VisibilityChecker.GetDepth(t,!0)).metadata({[`${o.EXTENSIONID}/isVisionWall`]:!0,[`${o.EXTENSIONID}/isWindow`]:i}).build();this.wallsToCreate.push(d)}AddPersistentLightToQueue(e,t,a){const i=a??e;if((i.metadata[`${o.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY")==="SECONDARY")return;const d=this.findLightDirection(i.metadata[`${o.EXTENSIONID}/visionFacing`]),l=Nn().position(e.position).lightType("AUXILIARY").rotation(e.rotation+d).attenuationRadius(this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionRange`]??Ne())).sourceRadius(this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionSourceRange`]??Ge(),!0)).falloff(parseFloat(i.metadata[`${o.EXTENSIONID}/visionFallOff`]??rt())).innerAngle(parseInt(i.metadata[`${o.EXTENSIONID}/visionInAngle`]??ft())).outerAngle(parseInt(i.metadata[`${o.EXTENSIONID}/visionOutAngle`]??et())).zIndex(this.VisibilityChecker.GetDepth(t,!1)).metadata({[`${o.EXTENSIONID}/isPersistentLight`]:e.id,[`${o.EXTENSIONID}/getPersistentLight`]:!0,[`${o.EXTENSIONID}/visionFacing`]:i.metadata[`${o.EXTENSIONID}/visionFacing`]}).build();if(this.lightsToCreate.push(l),this.persistentLights.push({id:l.id,position:l.position,rotation:l.rotation,zIndex:t,metadata:e.metadata}),this.persistenceLimit===this.persistentLights.length){const c=this.persistentLights.shift();this.lightsToDelete.push(c.id)}}CreateLightToQueue(e,t,a){const i=a??e,s=i.metadata[`${o.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",d=i.metadata[`${o.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionRange`]??Ne()),l=parseInt(i.metadata[`${o.EXTENSIONID}/visionDark`])>parseInt(i.metadata[`${o.EXTENSIONID}/visionRange`]),c=i.metadata[`${o.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionDark`]),f=this.findLightDirection(i.metadata[`${o.EXTENSIONID}/visionFacing`]),g=Nn().position(e.position).rotation(e.rotation+f).lightType(s).attenuationRadius(l?c:d).sourceRadius(this.GetLightRange(i.metadata[`${o.EXTENSIONID}/visionSourceRange`]??Ge(),!0)).falloff(parseFloat(i.metadata[`${o.EXTENSIONID}/visionFallOff`]??rt())).innerAngle(parseInt(i.metadata[`${o.EXTENSIONID}/visionInAngle`]??ft())).outerAngle(parseInt(i.metadata[`${o.EXTENSIONID}/visionOutAngle`]??et())).zIndex(this.VisibilityChecker.GetDepth(t,!1)).metadata({[`${o.EXTENSIONID}/visionSourceRange`]:i.metadata[`${o.EXTENSIONID}/visionSourceRange`],[`${o.EXTENSIONID}/visionRange`]:i.metadata[`${o.EXTENSIONID}/visionRange`],[`${o.EXTENSIONID}/isVisionLight`]:!0,[`${o.EXTENSIONID}/visionFacing`]:i.metadata[`${o.EXTENSIONID}/visionFacing`],[`${o.EXTENSIONID}/visionDark`]:i.metadata[`${o.EXTENSIONID}/visionDark`],[`${o.EXTENSIONID}/visionBlind`]:i.metadata[`${o.EXTENSIONID}/visionBlind`]===!0}).attachedTo(e.id).disableAttachmentBehavior(["SCALE","VISIBLE"]).build();this.lightsToCreate.push(g),s==="PRIMARY"&&(this.CreateTrailingFogRevealer(g),this.CreateDarkVisionToQueue(e,a),this.CreateOwnerHighlight(e,a))}CreateDarkVisionToQueue(e,t){const a=t??e,i=a.metadata[`${o.EXTENSIONID}/visionBlind`]===!0,s=parseInt(a.metadata[`${o.EXTENSIONID}/visionDark`]),d=parseInt(a.metadata[`${o.EXTENSIONID}/visionRange`]);if(!s||s<d||i)return;const l=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionDark`])*2,f=this.GetLightRange(a.metadata[`${o.EXTENSIONID}/visionRange`])*2/l/2,g=Je().position({x:e.position.x-l/2,y:e.position.y-l/2}).attachedTo(e.id).width(l).height(l).blendMode("SATURATION").effectType("STANDALONE").sksl(o.DARKVISIONSHADER).metadata({[`${o.EXTENSIONID}/isDarkVision`]:!0,[`${o.EXTENSIONID}/visionDark`]:s}).disableHit(!0).disableAttachmentBehavior(["SCALE"]).uniforms([{name:"center",value:{x:.5,y:.5}},{name:"radius",value:.5},{name:"clear",value:f},{name:"smoothwidth",value:.0075}]).build();this.darkVisionToCreate.push(g)}CreateDecalToQueue(e){const t=Ea({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).rotation(e.rotation).scale(e.scale).position(e.position).attachedTo(e.id).layer("FOG").locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isLocalDecal`]:e.id}).build();this.decalsToCreate.push(t)}UpdateWallToQueue(e,t,a){if(!e.points)return;let i=e.metadata[`${o.EXTENSIONID}/blocking`]===!0;v.playerRole==="GM"&&v.sceneMetadata[`${o.EXTENSIONID}/passWallsGM`]===!0&&(i=!1);const s={id:t.id,points:e.points,rotation:e.rotation,position:e.position,scale:e.scale,blocking:i,visible:!e.metadata[`${o.EXTENSIONID}/isWindow`],window:e.metadata[`${o.EXTENSIONID}/isWindow`],doubleSided:e.metadata[`${o.EXTENSIONID}/doubleSided`]===!0,zIndex:this.VisibilityChecker.GetDepth(a,!0)};this.wallsToUpdate.push(s)}UpdateLightToQueue(e,t,a,i){const s=i??e,d=s.metadata[`${o.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",l=s.metadata[`${o.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(s.metadata[`${o.EXTENSIONID}/visionRange`]??Ne()),c=parseInt(s.metadata[`${o.EXTENSIONID}/visionDark`])>parseInt(s.metadata[`${o.EXTENSIONID}/visionRange`]),f=s.metadata[`${o.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(s.metadata[`${o.EXTENSIONID}/visionDark`]),g={id:t.id,visionRange:s.metadata[`${o.EXTENSIONID}/visionRange`],visionSourceRange:s.metadata[`${o.EXTENSIONID}/visionSourceRange`],attenuationRadius:c?f:l,sourceRadius:this.GetLightRange(s.metadata[`${o.EXTENSIONID}/visionSourceRange`]??Ge(),!0),falloff:parseFloat(s.metadata[`${o.EXTENSIONID}/visionFallOff`]??rt()),innerAngle:parseInt(s.metadata[`${o.EXTENSIONID}/visionInAngle`]??ft()),outerAngle:parseInt(s.metadata[`${o.EXTENSIONID}/visionOutAngle`]??et()),blind:s.metadata[`${o.EXTENSIONID}/visionBlind`]===!0,tokenFacing:e.rotation,visionFacing:s.metadata[`${o.EXTENSIONID}/visionFacing`]??"NORTH",zIndex:this.VisibilityChecker.GetDepth(a,!1)};this.lightsToUpdate.push(g),d==="PRIMARY"&&this.UpdateOwnerHightlight(e,i)}GetLightRange(e,t=!1){return(t?parseFloat(e):parseInt(e))/v.gridScale*v.gridDpi}IsPositionClear(e){const t=(v.gridDpi-10)*this.persistenceCullingDistance;for(const a of this.persistentLights)if(Ia(e,a.position)<=t)return!1;return!0}IsPositionAndRotationClear(e,t){const a=(v.gridDpi-10)*this.persistenceCullingDistance;for(const i of this.persistentLights)if(Ia(t,i.position)<=a&&e===i.rotation)return!1;return!0}getTokensICanSeeThrough(){const e=v.sceneItems.filter(i=>Gt(i)),t=[],a=[];for(const i of e)i.createdUserId===v.playerId?t.push(i):v.sceneMetadata[`${o.EXTENSIONID}/USER-${i.createdUserId}`]?.role==="GM"&&a.push(i);return[...t,...a]}async ToggleDoor(e){const t=v.sceneLocal.filter(a=>a.id===e&&a.metadata[`${o.EXTENSIONID}/localDoor`]===!0);if(t.length===1){const a=v.sceneItems.filter(i=>i.id===t[0].attachedTo);if(a.length===1){const i=a[0];if(v.playerRole!=="GM"&&i.metadata[`${o.EXTENSIONID}/isDoorLocked`])return;await m.scene.items.updateItems(a,s=>{for(let d of s)d.metadata[`${o.EXTENSIONID}/isVisionLine`]&&d.metadata[`${o.EXTENSIONID}/disabled`]?(delete d.metadata[`${o.EXTENSIONID}/disabled`],delete d.metadata[`${o.EXTENSIONID}/doorOpen`]):d.metadata[`${o.EXTENSIONID}/isVisionLine`]&&(d.metadata[`${o.EXTENSIONID}/disabled`]=!0,d.metadata[`${o.EXTENSIONID}/doorOpen`]=!0,delete d.metadata[`${o.EXTENSIONID}/isDoorLocked`])}),await m.player.deselect([e])}}}findLightDirection(e){switch(e){case ct.North:return 0;case ct.Northeast:return 45;case ct.East:return 90;case ct.Southeast:return 135;case ct.South:return 180;case ct.Southwest:return 225;case ct.West:return 270;case ct.Northwest:return 315;default:return 0}}}const Ie=new Ir;function Ha(n,e){n.split(/\s+/).forEach(t=>{e(t)})}class wr{constructor(){this._events={}}on(e,t){Ha(e,a=>{const i=this._events[a]||[];i.push(t),this._events[a]=i})}off(e,t){var a=arguments.length;if(a===0){this._events={};return}Ha(e,i=>{if(a===1){delete this._events[i];return}const s=this._events[i];s!==void 0&&(s.splice(s.indexOf(t),1),this._events[i]=s)})}trigger(e,...t){var a=this;Ha(e,i=>{const s=a._events[i];s!==void 0&&s.forEach(d=>{d.apply(a,t)})})}}function br(n){return n.plugins={},class extends n{constructor(){super(...arguments),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){n.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,a;const i=this,s=[];if(Array.isArray(e))e.forEach(d=>{typeof d=="string"?s.push(d):(i.plugins.settings[d.name]=d.options,s.push(d.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(i.plugins.settings[t]=e[t],s.push(t));for(;a=s.shift();)i.require(a)}loadPlugin(e){var t=this,a=t.plugins,i=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');a.requested[e]=!0,a.loaded[e]=i.fn.apply(t,[t.plugins.settings[e]||{}]),a.names.push(e)}require(e){var t=this,a=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(a.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return a.loaded[e]}}}const Ca=n=>(n=n.filter(Boolean),n.length<2?n[0]||"":Sr(n)==1?"["+n.join("")+"]":"(?:"+n.join("|")+")"),Vi=n=>{if(!Tr(n))return n.join("");let e="",t=0;const a=()=>{t>1&&(e+="{"+t+"}")};return n.forEach((i,s)=>{if(i===n[s-1]){t++;return}a(),e+=i,t=1}),a(),e},Hi=n=>{let e=Array.from(n);return Ca(e)},Tr=n=>new Set(n).size!==n.length,Zt=n=>(n+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Sr=n=>n.reduce((e,t)=>Math.max(e,Nr(t)),0),Nr=n=>Array.from(n).length,Fi=n=>{if(n.length===1)return[[n]];let e=[];const t=n.substring(1);return Fi(t).forEach(function(i){let s=i.slice(0);s[0]=n.charAt(0)+s[0],e.push(s),s=i.slice(0),s.unshift(n.charAt(0)),e.push(s)}),e},Or=[[0,65535]],Dr="[Ì€-Í¯Â·Ê¾Ê¼]";let Sa,Bi;const kr=3,pn={},Rn={"/":"â„âˆ•",0:"ß€",a:"â±¥ÉÉ‘",aa:"êœ³",ae:"Ã¦Ç½Ç£",ao:"êœµ",au:"êœ·",av:"êœ¹êœ»",ay:"êœ½",b:"Æ€É“Æƒ",c:"êœ¿ÆˆÈ¼â†„",d:"Ä‘É—É–á´…ÆŒê®·ÔÉ¦",e:"É›Çá´‡É‡",f:"ê¼Æ’",g:"Ç¥É ê¡áµ¹ê¿É¢",h:"Ä§â±¨â±¶É¥",i:"É¨Ä±",j:"É‰È·",k:"Æ™â±ªêêƒê…ê£",l:"Å‚ÆšÉ«â±¡ê‰ê‡êÉ­",m:"É±É¯Ï»",n:"ê¥ÆÉ²ê‘á´Ğ»Ô‰",o:"Ã¸Ç¿É”Éµê‹êá´‘",oe:"Å“",oi:"Æ£",oo:"ê",ou:"È£",p:"Æ¥áµ½ê‘ê“ê•Ï",q:"ê—ê™É‹",r:"ÉÉ½ê›ê§êƒ",s:"ÃŸÈ¿ê©ê…Ê‚",t:"Å§Æ­Êˆâ±¦ê‡",th:"Ã¾",tz:"êœ©",u:"Ê‰",v:"Ê‹êŸÊŒ",vy:"ê¡",w:"â±³",y:"Æ´Éá»¿",z:"Æ¶È¥É€â±¬ê£",hv:"Æ•"};for(let n in Rn){let e=Rn[n]||"";for(let t=0;t<e.length;t++){let a=e.substring(t,t+1);pn[a]=n}}const _r=new RegExp(Object.keys(pn).join("|")+"|"+Dr,"gu"),Cr=n=>{Sa===void 0&&(Sa=$r(Or))},Pn=(n,e="NFKD")=>n.normalize(e),Na=n=>Array.from(n).reduce((e,t)=>e+Lr(t),""),Lr=n=>(n=Pn(n).toLowerCase().replace(_r,e=>pn[e]||""),Pn(n,"NFC"));function*Ar(n){for(const[e,t]of n)for(let a=e;a<=t;a++){let i=String.fromCharCode(a),s=Na(i);s!=i.toLowerCase()&&(s.length>kr||s.length!=0&&(yield{folded:s,composed:i,code_point:a}))}}const Mr=n=>{const e={},t=(a,i)=>{const s=e[a]||new Set,d=new RegExp("^"+Hi(s)+"$","iu");i.match(d)||(s.add(Zt(i)),e[a]=s)};for(let a of Ar(n))t(a.folded,a.folded),t(a.folded,a.composed);return e},$r=n=>{const e=Mr(n),t={};let a=[];for(let s in e){let d=e[s];d&&(t[s]=Hi(d)),s.length>1&&a.push(Zt(s))}a.sort((s,d)=>d.length-s.length);const i=Ca(a);return Bi=new RegExp("^"+i,"u"),t},xr=(n,e=1)=>{let t=0;return n=n.map(a=>(Sa[a]&&(t+=a.length),Sa[a]||a)),t>=e?Vi(n):""},Rr=(n,e=1)=>(e=Math.max(e,n.length-1),Ca(Fi(n).map(t=>xr(t,e)))),Xn=(n,e=!0)=>{let t=n.length>1?1:0;return Ca(n.map(a=>{let i=[];const s=e?a.length():a.length()-1;for(let d=0;d<s;d++)i.push(Rr(a.substrs[d]||"",t));return Vi(i)}))},Pr=(n,e)=>{for(const t of e){if(t.start!=n.start||t.end!=n.end||t.substrs.join("")!==n.substrs.join(""))continue;let a=n.parts;const i=d=>{for(const l of a){if(l.start===d.start&&l.substr===d.substr)return!1;if(!(d.length==1||l.length==1)&&(d.start<l.start&&d.end>l.start||l.start<d.start&&l.end>d.start))return!0}return!1};if(!(t.parts.filter(i).length>0))return!0}return!1};class Oa{parts;substrs;start;end;constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let a=new Oa,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const c of i)a.add(c);let d=t.substr.substring(0,e-s.start),l=d.length;return a.add({start:s.start,end:s.start+l,length:l,substr:d}),a}}const Xr=n=>{Cr(),n=Na(n);let e="",t=[new Oa];for(let a=0;a<n.length;a++){let s=n.substring(a).match(Bi);const d=n.substring(a,a+1),l=s?s[0]:null;let c=[],f=new Set;for(const g of t){const y=g.last();if(!y||y.length==1||y.end<=a)if(l){const N=l.length;g.add({start:a,end:a+N,length:N,substr:l}),f.add("1")}else g.add({start:a,end:a+1,length:1,substr:d}),f.add("2");else if(l){let N=g.clone(a,y);const D=l.length;N.add({start:a,end:a+D,length:D,substr:l}),c.push(N)}else f.add("3")}if(c.length>0){c=c.sort((g,y)=>g.length()-y.length());for(let g of c)Pr(g,t)||t.push(g);continue}if(a>0&&f.size==1&&!f.has("3")){e+=Xn(t,!1);let g=new Oa;const y=t[0];y&&g.add(y.last()),t=[g]}}return e+=Xn(t,!0),e},Vr=(n,e)=>{if(n)return n[e]},Hr=(n,e)=>{if(n){for(var t,a=e.split(".");(t=a.shift())&&(n=n[t]););return n}},Fa=(n,e,t)=>{var a,i;return!n||(n=n+"",e.regex==null)||(i=n.search(e.regex),i===-1)?0:(a=e.string.length/n.length,i===0&&(a+=.5),a*t)},Ba=(n,e)=>{var t=n[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(n[e]=[t])},da=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},Fr=(n,e)=>typeof n=="number"&&typeof e=="number"?n>e?1:n<e?-1:0:(n=Na(n+"").toLowerCase(),e=Na(e+"").toLowerCase(),n>e?1:e>n?-1:0);class Br{items;settings;constructor(e,t){this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,a){if(!e||!e.length)return[];const i=[],s=e.split(/\s+/);var d;return a&&(d=new RegExp("^("+Object.keys(a).map(Zt).join("|")+"):(.*)$")),s.forEach(l=>{let c,f=null,g=null;d&&(c=l.match(d))&&(f=c[1],l=c[2]),l.length>0&&(this.settings.diacritics?g=Xr(l)||null:g=Zt(l),g&&t&&(g="\\b"+g)),i.push({string:l,regex:g?new RegExp(g,"iu"):null,field:f})}),i}getScoreFunction(e,t){var a=this.prepareSearch(e,t);return this._getScoreFunction(a)}_getScoreFunction(e){const t=e.tokens,a=t.length;if(!a)return function(){return 0};const i=e.options.fields,s=e.weights,d=i.length,l=e.getAttrFn;if(!d)return function(){return 1};const c=(function(){return d===1?function(f,g){const y=i[0].field;return Fa(l(g,y),f,s[y]||1)}:function(f,g){var y=0;if(f.field){const N=l(g,f.field);!f.regex&&N?y+=1/d:y+=Fa(N,f,1)}else da(s,(N,D)=>{y+=Fa(l(g,D),f,N)});return y/d}})();return a===1?function(f){return c(t[0],f)}:e.options.conjunction==="and"?function(f){var g,y=0;for(let N of t){if(g=c(N,f),g<=0)return 0;y+=g}return y/a}:function(f){var g=0;return da(t,y=>{g+=c(y,f)}),g/a}}getSortFunction(e,t){var a=this.prepareSearch(e,t);return this._getSortFunction(a)}_getSortFunction(e){var t,a=[];const i=this,s=e.options,d=!e.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof d=="function")return d.bind(this);const l=function(f,g){return f==="$score"?g.score:e.getAttrFn(i.items[g.id],f)};if(d)for(let f of d)(e.query||f.field!=="$score")&&a.push(f);if(e.query){t=!0;for(let f of a)if(f.field==="$score"){t=!1;break}t&&a.unshift({field:"$score",direction:"desc"})}else a=a.filter(f=>f.field!=="$score");return a.length?function(f,g){var y,N;for(let D of a)if(N=D.field,y=(D.direction==="desc"?-1:1)*Fr(l(N,f),l(N,g)),y)return y;return 0}:null}prepareSearch(e,t){const a={};var i=Object.assign({},t);if(Ba(i,"sort"),Ba(i,"sort_empty"),i.fields){Ba(i,"fields");const s=[];i.fields.forEach(d=>{typeof d=="string"&&(d={field:d,weight:1}),s.push(d),a[d.field]="weight"in d?d.weight:1}),i.fields=s}return{options:i,query:e.toLowerCase().trim(),tokens:this.tokenize(e,i.respect_word_boundaries,a),total:0,items:[],weights:a,getAttrFn:i.nesting?Hr:Vr}}search(e,t){var a=this,i,s;s=this.prepareSearch(e,t),t=s.options,e=s.query;const d=t.score||a._getScoreFunction(s);e.length?da(a.items,(c,f)=>{i=d(c),(t.filter===!1||i>0)&&s.items.push({score:i,id:f})}):da(a.items,(c,f)=>{s.items.push({score:1,id:f})});const l=a._getSortFunction(s);return l&&s.items.sort(l),s.total=s.items.length,typeof t.limit=="number"&&(s.items=s.items.slice(0,t.limit)),s}}const Be=n=>typeof n>"u"||n===null?null:va(n),va=n=>typeof n=="boolean"?n?"1":"0":n+"",Ua=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Ur=(n,e)=>e>0?window.setTimeout(n,e):(n.call(null),null),zr=(n,e)=>{var t;return function(a,i){var s=this;t&&(s.loading=Math.max(s.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,s.loadedSearches[a]=!0,n.call(s,a,i)},e)}},Vn=(n,e,t)=>{var a,i=n.trigger,s={};n.trigger=function(){var d=arguments[0];if(e.indexOf(d)!==-1)s[d]=arguments;else return i.apply(n,arguments)},t.apply(n,[]),n.trigger=i;for(a of e)a in s&&i.apply(n,s[a])},Gr=n=>({start:n.selectionStart||0,length:(n.selectionEnd||0)-(n.selectionStart||0)}),he=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},we=(n,e,t,a)=>{n.addEventListener(e,t,a)},Et=(n,e)=>{if(!e||!e[n])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},za=(n,e)=>{const t=n.getAttribute("id");return t||(n.setAttribute("id",e),e)},Hn=n=>n.replace(/[\\"']/g,"\\$&"),It=(n,e)=>{e&&n.append(e)},ye=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},qe=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Ui(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Ui=n=>typeof n=="string"&&n.indexOf("<")>-1,jr=n=>n.replace(/['"\\]/g,"\\$&"),Ga=(n,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),n.dispatchEvent(t)},la=(n,e)=>{Object.assign(n.style,e)},Me=(n,...e)=>{var t=zi(e);n=Gi(n),n.map(a=>{t.map(i=>{a.classList.add(i)})})},ut=(n,...e)=>{var t=zi(e);n=Gi(n),n.map(a=>{t.map(i=>{a.classList.remove(i)})})},zi=n=>{var e=[];return ye(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Gi=n=>(Array.isArray(n)||(n=[n]),n),ja=(n,e,t)=>{if(!(t&&!t.contains(n)))for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Fn=(n,e=0)=>e>0?n[n.length-1]:n[0],Wr=n=>Object.keys(n).length===0,Bn=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t},fe=(n,e)=>{ye(e,(t,a)=>{t==null?n.removeAttribute(a):n.setAttribute(a,""+t)})},an=(n,e)=>{n.parentNode&&n.parentNode.replaceChild(e,n)},Yr=(n,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=s=>{var d=s.data.match(e);if(d&&s.data.length>0){var l=document.createElement("span");l.className="highlight";var c=s.splitText(d.index);c.splitText(d[0].length);var f=c.cloneNode(!0);return l.appendChild(f),an(c,l),1}return 0},a=s=>{s.nodeType===1&&s.childNodes&&!/(script|style)/i.test(s.tagName)&&(s.className!=="highlight"||s.tagName!=="SPAN")&&Array.from(s.childNodes).forEach(d=>{i(d)})},i=s=>s.nodeType===3?t(s):(a(s),0);i(n)},qr=n=>{var e=n.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var a=t.parentNode;a.replaceChild(t.firstChild,t),a.normalize()})},Kr=65,Qr=13,Zr=27,Jr=37,eo=38,to=39,ao=40,Un=8,no=46,zn=9,io=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),ca=io?"metaKey":"ctrlKey",Gn={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(n){return n.length>0},render:{}};function jn(n,e){var t=Object.assign({},Gn,e),a=t.dataAttr,i=t.labelField,s=t.valueField,d=t.disabledField,l=t.optgroupField,c=t.optgroupLabelField,f=t.optgroupValueField,g=n.tagName.toLowerCase(),y=n.getAttribute("placeholder")||n.getAttribute("data-placeholder");if(!y&&!t.allowEmptyOption){let M=n.querySelector('option[value=""]');M&&(y=M.textContent)}var N={placeholder:y,options:[],optgroups:[],items:[],maxItems:null},D=()=>{var M,P=N.options,F={},$=1;let G=0;var r=h=>{var b=Object.assign({},h.dataset),E=a&&b[a];return typeof E=="string"&&E.length&&(b=Object.assign(b,JSON.parse(E))),b},p=(h,b)=>{var E=Be(h.value);if(E!=null&&!(!E&&!t.allowEmptyOption)){if(F.hasOwnProperty(E)){if(b){var I=F[E][l];I?Array.isArray(I)?I.push(b):F[E][l]=[I,b]:F[E][l]=b}}else{var w=r(h);w[i]=w[i]||h.textContent,w[s]=w[s]||E,w[d]=w[d]||h.disabled,w[l]=w[l]||b,w.$option=h,w.$order=w.$order||++G,F[E]=w,P.push(w)}h.selected&&N.items.push(E)}},u=h=>{var b,E;E=r(h),E[c]=E[c]||h.getAttribute("label")||"",E[f]=E[f]||$++,E[d]=E[d]||h.disabled,E.$order=E.$order||++G,N.optgroups.push(E),b=E[f],ye(h.children,I=>{p(I,b)})};N.maxItems=n.hasAttribute("multiple")?null:1,ye(n.children,h=>{M=h.tagName.toLowerCase(),M==="optgroup"?u(h):M==="option"&&p(h)})},k=()=>{const M=n.getAttribute(a);if(M)N.options=JSON.parse(M),ye(N.options,F=>{N.items.push(F[s])});else{var P=n.value.trim()||"";if(!t.allowEmptyOption&&!P.length)return;const F=P.split(t.delimiter);ye(F,$=>{const G={};G[i]=$,G[s]=$,N.options.push(G)}),N.items=F}};return g==="select"?D():k(),Object.assign({},Gn,N,e)}var Wn=0;class Te extends br(wr){constructor(e,t){super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Wn++;var a,i=qe(e);if(i.tomselect)throw new Error("Tom Select already initialized on this element");i.tomselect=this;var s=window.getComputedStyle&&window.getComputedStyle(i,null);a=s.getPropertyValue("direction");const d=jn(i,t);this.settings=d,this.input=i,this.tabIndex=i.tabIndex||0,this.is_select_tag=i.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(a),this.inputId=za(i,"tomselect-"+Wn),this.isRequired=i.required,this.sifter=new Br(this.options,{diacritics:d.diacritics}),d.mode=d.mode||(d.maxItems===1?"single":"multi"),typeof d.hideSelected!="boolean"&&(d.hideSelected=d.mode==="multi"),typeof d.hidePlaceholder!="boolean"&&(d.hidePlaceholder=d.mode!=="multi");var l=d.createFilter;typeof l!="function"&&(typeof l=="string"&&(l=new RegExp(l)),l instanceof RegExp?d.createFilter=P=>l.test(P):d.createFilter=P=>this.settings.duplicates||!this.options[P]),this.initializePlugins(d.plugins),this.setupCallbacks(),this.setupTemplates();const c=qe("<div>"),f=qe("<div>"),g=this._render("dropdown"),y=qe('<div role="listbox" tabindex="-1">'),N=this.input.getAttribute("class")||"",D=d.mode;var k;if(Me(c,d.wrapperClass,N,D),Me(f,d.controlClass),It(c,f),Me(g,d.dropdownClass,D),d.copyClassesToDropdown&&Me(g,N),Me(y,d.dropdownContentClass),It(g,y),qe(d.dropdownParent||c).appendChild(g),Ui(d.controlInput)){k=qe(d.controlInput);var M=["autocorrect","autocapitalize","autocomplete","spellcheck"];ye(M,P=>{i.getAttribute(P)&&fe(k,{[P]:i.getAttribute(P)})}),k.tabIndex=-1,f.appendChild(k),this.focus_node=k}else d.controlInput?(k=qe(d.controlInput),this.focus_node=k):(k=qe("<input/>"),this.focus_node=f);this.wrapper=c,this.dropdown=g,this.dropdown_content=y,this.control=f,this.control_input=k,this.setup()}setup(){const e=this,t=e.settings,a=e.control_input,i=e.dropdown,s=e.dropdown_content,d=e.wrapper,l=e.control,c=e.input,f=e.focus_node,g={passive:!0},y=e.inputId+"-ts-dropdown";fe(s,{id:y}),fe(f,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":y});const N=za(f,e.inputId+"-ts-control"),D="label[for='"+jr(e.inputId)+"']",k=document.querySelector(D),M=e.focus.bind(e);if(k){we(k,"click",M),fe(k,{for:N});const $=za(k,e.inputId+"-ts-label");fe(f,{"aria-labelledby":$}),fe(s,{"aria-labelledby":$})}if(d.style.width=c.style.width,e.plugins.names.length){const $="plugin-"+e.plugins.names.join(" plugin-");Me([d,i],$)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&fe(c,{multiple:"multiple"}),t.placeholder&&fe(a,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Zt(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=zr(t.load,t.loadThrottle)),we(i,"mousemove",()=>{e.ignoreHover=!1}),we(i,"mouseenter",$=>{var G=ja($.target,"[data-selectable]",i);G&&e.onOptionHover($,G)},{capture:!0}),we(i,"click",$=>{const G=ja($.target,"[data-selectable]");G&&(e.onOptionSelect($,G),he($,!0))}),we(l,"click",$=>{var G=ja($.target,"[data-ts-item]",l);if(G&&e.onItemSelect($,G)){he($,!0);return}a.value==""&&(e.onClick(),he($,!0))}),we(f,"keydown",$=>e.onKeyDown($)),we(a,"keypress",$=>e.onKeyPress($)),we(a,"input",$=>e.onInput($)),we(f,"blur",$=>e.onBlur($)),we(f,"focus",$=>e.onFocus($)),we(a,"paste",$=>e.onPaste($));const P=$=>{const G=$.composedPath()[0];if(!d.contains(G)&&!i.contains(G)){e.isFocused&&e.blur(),e.inputState();return}G==a&&e.isOpen?$.stopPropagation():he($,!0)},F=()=>{e.isOpen&&e.positionDropdown()};we(document,"mousedown",P),we(window,"scroll",F,g),we(window,"resize",F,g),this._destroy=()=>{document.removeEventListener("mousedown",P),window.removeEventListener("scroll",F),window.removeEventListener("resize",F),k&&k.removeEventListener("click",M)},this.revertSettings={innerHTML:c.innerHTML,tabIndex:c.tabIndex},c.tabIndex=-1,c.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,we(c,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,c.disabled?e.disable():c.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),Me(c,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),ye(t,a=>{this.registerOptionGroup(a)})}setupTemplates(){var e=this,t=e.settings.labelField,a=e.settings.optgroupLabelField,i={optgroup:s=>{let d=document.createElement("div");return d.className="optgroup",d.appendChild(s.options),d},optgroup_header:(s,d)=>'<div class="optgroup-header">'+d(s[a])+"</div>",option:(s,d)=>"<div>"+d(s[t])+"</div>",item:(s,d)=>"<div>"+d(s[t])+"</div>",option_create:(s,d)=>'<div class="create">Add <strong>'+d(s.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},i,e.settings.render)}setupCallbacks(){var e,t,a={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in a)t=this.settings[a[e]],t&&this.on(e,t)}sync(e=!0){const t=this,a=e?jn(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(a.options,a.optgroups),t.setValue(a.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Ga(this.input,"input"),Ga(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){he(e);return}t.settings.splitOn&&setTimeout(()=>{var a=t.inputValue();if(a.match(t.settings.splitOn)){var i=a.trim().split(t.settings.splitOn);ye(i,s=>{Be(s)&&(this.options[s]?t.addItem(s):t.createItem(s))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){he(e);return}var a=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&a===t.settings.delimiter){t.createItem(),he(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==zn&&he(e);return}switch(e.keyCode){case Kr:if(Et(ca,e)&&t.control_input.value==""){he(e),t.selectAll();return}break;case Zr:t.isOpen&&(he(e,!0),t.close()),t.clearActiveItems();return;case ao:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let a=t.getAdjacent(t.activeOption,1);a&&t.setActiveOption(a)}he(e);return;case eo:if(t.activeOption){let a=t.getAdjacent(t.activeOption,-1);a&&t.setActiveOption(a)}he(e);return;case Qr:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),he(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&he(e);return;case Jr:t.advanceSelection(-1,e);return;case to:t.advanceSelection(1,e);return;case zn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),he(e)),t.settings.create&&t.createItem()&&he(e));return;case Un:case no:t.deleteSelection(e);return}t.isInputHidden&&!Et(ca,e)&&he(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=Ur(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,a=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),he(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),a||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var a=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,a):a()}}}onOptionSelect(e,t){var a,i=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?i.createItem(null,()=>{i.settings.closeAfterSelect&&i.close()}):(a=t.dataset.value,typeof a<"u"&&(i.lastQuery=null,i.addItem(a),i.settings.closeAfterSelect&&i.close(),!i.settings.hideSelected&&e.type&&/click/.test(e.type)&&i.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var a=this;return!a.isLocked&&a.settings.mode==="multi"?(he(e),a.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;Me(t.wrapper,t.settings.loadingClass),t.loading++;const a=t.loadCallback.bind(t);t.settings.load.call(t,e,a)}loadCallback(e,t){const a=this;a.loading=Math.max(a.loading-1,0),a.lastQuery=null,a.clearActiveOption(),a.setupOptions(e,t),a.refreshOptions(a.isFocused&&!a.isInputHidden),a.loading||ut(a.wrapper,a.settings.loadingClass),a.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,a=t.value!==e;a&&(t.value=e,Ga(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var a=t?[]:["change"];Vn(this,a,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var a=this,i,s,d,l,c,f;if(a.settings.mode!=="single"){if(!e){a.clearActiveItems(),a.isFocused&&a.inputState();return}if(i=t&&t.type.toLowerCase(),i==="click"&&Et("shiftKey",t)&&a.activeItems.length){for(f=a.getLastActive(),d=Array.prototype.indexOf.call(a.control.children,f),l=Array.prototype.indexOf.call(a.control.children,e),d>l&&(c=d,d=l,l=c),s=d;s<=l;s++)e=a.control.children[s],a.activeItems.indexOf(e)===-1&&a.setActiveItemClass(e);he(t)}else i==="click"&&Et(ca,t)||i==="keydown"&&Et("shiftKey",t)?e.classList.contains("active")?a.removeActiveItem(e):a.setActiveItemClass(e):(a.clearActiveItems(),a.setActiveItemClass(e));a.inputState(),a.isFocused||a.focus()}}setActiveItemClass(e){const t=this,a=t.control.querySelector(".last-active");a&&ut(a,"last-active"),Me(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),ut(e,"active")}clearActiveItems(){ut(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,fe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),fe(e,{"aria-selected":"true"}),Me(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const a=this.dropdown_content,i=a.clientHeight,s=a.scrollTop||0,d=e.offsetHeight,l=e.getBoundingClientRect().top-a.getBoundingClientRect().top+s;l+d>i+s?this.scroll(l-i+d,t):l<s&&this.scroll(l,t)}scroll(e,t){const a=this.dropdown_content;t&&(a.style.scrollBehavior=t),a.scrollTop=e,a.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(ut(this.activeOption,"active"),fe(this.activeOption,{"aria-selected":null})),this.activeOption=null,fe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,ye(t,a=>{e.setActiveItemClass(a)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(fe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&fe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,a,i=this,s=this.getSearchOptions();if(i.settings.score&&(a=i.settings.score.call(i,e),typeof a!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==i.lastQuery?(i.lastQuery=e,t=i.sifter.search(e,Object.assign(s,{score:a})),i.currentResults=t):t=Object.assign({},i.currentResults),i.settings.hideSelected&&(t.items=t.items.filter(d=>{let l=Be(d.id);return!(l&&i.items.indexOf(l)!==-1)})),t}refreshOptions(e=!0){var t,a,i,s,d,l,c,f,g,y;const N={},D=[];var k=this,M=k.inputValue();const P=M===k.lastQuery||M==""&&k.lastQuery==null;var F=k.search(M),$=null,G=k.settings.shouldOpen||!1,r=k.dropdown_content;P&&($=k.activeOption,$&&(g=$.closest("[data-group]"))),s=F.items.length,typeof k.settings.maxOptions=="number"&&(s=Math.min(s,k.settings.maxOptions)),s>0&&(G=!0);const p=(h,b)=>{let E=N[h];if(E!==void 0){let w=D[E];if(w!==void 0)return[E,w.fragment]}let I=document.createDocumentFragment();return E=D.length,D.push({fragment:I,order:b,optgroup:h}),[E,I]};for(t=0;t<s;t++){let h=F.items[t];if(!h)continue;let b=h.id,E=k.options[b];if(E===void 0)continue;let I=va(b),w=k.getOption(I,!0);for(k.settings.hideSelected||w.classList.toggle("selected",k.items.includes(I)),d=E[k.settings.optgroupField]||"",l=Array.isArray(d)?d:[d],a=0,i=l&&l.length;a<i;a++){d=l[a];let _=E.$order,C=k.optgroups[d];C===void 0?d="":_=C.$order;const[L,x]=p(d,_);a>0&&(w=w.cloneNode(!0),fe(w,{id:E.$id+"-clone-"+a,"aria-selected":null}),w.classList.add("ts-cloned"),ut(w,"active"),k.activeOption&&k.activeOption.dataset.value==b&&g&&g.dataset.group===d.toString()&&($=w)),x.appendChild(w),d!=""&&(N[d]=L)}}k.settings.lockOptgroupOrder&&D.sort((h,b)=>h.order-b.order),c=document.createDocumentFragment(),ye(D,h=>{let b=h.fragment,E=h.optgroup;if(!b||!b.children.length)return;let I=k.optgroups[E];if(I!==void 0){let w=document.createDocumentFragment(),_=k.render("optgroup_header",I);It(w,_),It(w,b);let C=k.render("optgroup",{group:I,options:w});It(c,C)}else It(c,b)}),r.innerHTML="",It(r,c),k.settings.highlight&&(qr(r),F.query.length&&F.tokens.length&&ye(F.tokens,h=>{Yr(r,h.regex)}));var u=h=>{let b=k.render(h,{input:M});return b&&(G=!0,r.insertBefore(b,r.firstChild)),b};if(k.loading?u("loading"):k.settings.shouldLoad.call(k,M)?F.items.length===0&&u("no_results"):u("not_loading"),f=k.canCreate(M),f&&(y=u("option_create")),k.hasOptions=F.items.length>0||f,G){if(F.items.length>0){if(!$&&k.settings.mode==="single"&&k.items[0]!=null&&($=k.getOption(k.items[0])),!r.contains($)){let h=0;y&&!k.settings.addPrecedence&&(h=1),$=k.selectable()[h]}}else y&&($=y);e&&!k.isOpen&&(k.open(),k.scrollToOption($,"auto")),k.setActiveOption($)}else k.clearActiveOption(),e&&k.isOpen&&k.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const a=this;if(Array.isArray(e))return a.addOptions(e,t),!1;const i=Be(e[a.settings.valueField]);return i===null||a.options.hasOwnProperty(i)?!1:(e.$order=e.$order||++a.order,e.$id=a.inputId+"-opt-"+e.$order,a.options[i]=e,a.lastQuery=null,t&&(a.userOptions[i]=t,a.trigger("option_add",i,e)),i)}addOptions(e,t=!1){ye(e,a=>{this.addOption(a,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Be(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var a;t[this.settings.optgroupValueField]=e,(a=this.registerOptionGroup(t))&&this.trigger("optgroup_add",a,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const a=this;var i,s;const d=Be(e),l=Be(t[a.settings.valueField]);if(d===null)return;const c=a.options[d];if(c==null)return;if(typeof l!="string")throw new Error("Value must be set in option data");const f=a.getOption(d),g=a.getItem(d);if(t.$order=t.$order||c.$order,delete a.options[d],a.uncacheValue(l),a.options[l]=t,f){if(a.dropdown_content.contains(f)){const y=a._render("option",t);an(f,y),a.activeOption===f&&a.setActiveOption(y)}f.remove()}g&&(s=a.items.indexOf(d),s!==-1&&a.items.splice(s,1,l),i=a._render("item",t),g.classList.contains("active")&&Me(i,"active"),an(g,i)),a.lastQuery=null}removeOption(e,t){const a=this;e=va(e),a.uncacheValue(e),delete a.userOptions[e],delete a.options[e],a.lastQuery=null,a.trigger("option_remove",e),a.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const a={};ye(this.options,(i,s)=>{t(i,s)&&(a[s]=i)}),this.options=this.sifter.items=a,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const a=Be(e);if(a===null)return null;const i=this.options[a];if(i!=null){if(i.$div)return i.$div;if(t)return this._render("option",i)}return null}getAdjacent(e,t,a="option"){var i=this,s;if(!e)return null;a=="item"?s=i.controlChildren():s=i.dropdown_content.querySelectorAll("[data-selectable]");for(let d=0;d<s.length;d++)if(s[d]==e)return t>0?s[d+1]:s[d-1];return null}getItem(e){if(typeof e=="object")return e;var t=Be(e);return t!==null?this.control.querySelector(`[data-value="${Hn(t)}"]`):null}addItems(e,t){var a=this,i=Array.isArray(e)?e:[e];i=i.filter(d=>a.items.indexOf(d)===-1);const s=i[i.length-1];i.forEach(d=>{a.isPending=d!==s,a.addItem(d,t)})}addItem(e,t){var a=t?[]:["change","dropdown_close"];Vn(this,a,()=>{var i,s;const d=this,l=d.settings.mode,c=Be(e);if(!(c&&d.items.indexOf(c)!==-1&&(l==="single"&&d.close(),l==="single"||!d.settings.duplicates))&&!(c===null||!d.options.hasOwnProperty(c))&&(l==="single"&&d.clear(t),!(l==="multi"&&d.isFull()))){if(i=d._render("item",d.options[c]),d.control.contains(i)&&(i=i.cloneNode(!0)),s=d.isFull(),d.items.splice(d.caretPos,0,c),d.insertAtCaret(i),d.isSetup){if(!d.isPending&&d.settings.hideSelected){let f=d.getOption(c),g=d.getAdjacent(f,1);g&&d.setActiveOption(g)}!d.isPending&&!d.settings.closeAfterSelect&&d.refreshOptions(d.isFocused&&l!=="single"),d.settings.closeAfterSelect!=!1&&d.isFull()?d.close():d.isPending||d.positionDropdown(),d.trigger("item_add",c,i),d.isPending||d.updateOriginalInput({silent:t})}(!d.isPending||!s&&d.isFull())&&(d.inputState(),d.refreshState())}})}removeItem(e=null,t){const a=this;if(e=a.getItem(e),!e)return;var i,s;const d=e.dataset.value;i=Bn(e),e.remove(),e.classList.contains("active")&&(s=a.activeItems.indexOf(e),a.activeItems.splice(s,1),ut(e,"active")),a.items.splice(i,1),a.lastQuery=null,!a.settings.persist&&a.userOptions.hasOwnProperty(d)&&a.removeOption(d,t),i<a.caretPos&&a.setCaret(a.caretPos-1),a.updateOriginalInput({silent:t}),a.refreshState(),a.positionDropdown(),a.trigger("item_remove",d,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var a=this,i=a.caretPos,s;if(e=e||a.inputValue(),!a.canCreate(e))return t(),!1;a.lock();var d=!1,l=c=>{if(a.unlock(),!c||typeof c!="object")return t();var f=Be(c[a.settings.valueField]);if(typeof f!="string")return t();a.setTextboxValue(),a.addOption(c,!0),a.setCaret(i),a.addItem(f),t(c),d=!0};return typeof a.settings.create=="function"?s=a.settings.create.call(this,e,l):s={[a.settings.labelField]:e,[a.settings.valueField]:e},d||l(s),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),a=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const i=e.wrapper.classList;i.toggle("focus",e.isFocused),i.toggle("disabled",e.isDisabled),i.toggle("readonly",e.isReadOnly),i.toggle("required",e.isRequired),i.toggle("invalid",!e.isValid),i.toggle("locked",a),i.toggle("full",t),i.toggle("input-active",e.isFocused&&!e.isInputHidden),i.toggle("dropdown-active",e.isOpen),i.toggle("has-options",Wr(e.options)),i.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var a,i;const s=t.input.querySelector('option[value=""]');if(t.is_select_tag){let c=function(f,g,y){return f||(f=qe('<option value="'+Ua(g)+'">'+Ua(y)+"</option>")),f!=s&&t.input.append(f),d.push(f),(f!=s||l>0)&&(f.selected=!0),f};const d=[],l=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(f=>{f.selected=!1}),t.items.length==0&&t.settings.mode=="single"?c(s,"",""):t.items.forEach(f=>{if(a=t.options[f],i=a[t.settings.labelField]||"",d.includes(a.$option)){const g=t.input.querySelector(`option[value="${Hn(f)}"]:not(:checked)`);c(g,f,i)}else a.$option=c(a.$option,f,i)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,fe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),la(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),la(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,a=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,fe(t.focus_node,{"aria-expanded":"false"}),la(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),a&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),a=e.offsetHeight+t.top+window.scrollY,i=t.left+window.scrollX;la(this.dropdown,{width:t.width+"px",top:a+"px",left:i+"px"})}}clear(e){var t=this;if(t.items.length){var a=t.controlChildren();ye(a,i=>{t.removeItem(i,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,a=t.caretPos,i=t.control;i.insertBefore(e,i.children[a]||null),t.setCaret(a+1)}deleteSelection(e){var t,a,i,s,d=this;t=e&&e.keyCode===Un?-1:1,a=Gr(d.control_input);const l=[];if(d.activeItems.length)s=Fn(d.activeItems,t),i=Bn(s),t>0&&i++,ye(d.activeItems,c=>l.push(c));else if((d.isFocused||d.settings.mode==="single")&&d.items.length){const c=d.controlChildren();let f;t<0&&a.start===0&&a.length===0?f=c[d.caretPos-1]:t>0&&a.start===d.inputValue().length&&(f=c[d.caretPos]),f!==void 0&&l.push(f)}if(!d.shouldDelete(l,e))return!1;for(he(e,!0),typeof i<"u"&&d.setCaret(i);l.length;)d.removeItem(l.pop());return d.inputState(),d.positionDropdown(),d.refreshOptions(!1),!0}shouldDelete(e,t){const a=e.map(i=>i.dataset.value);return!(!a.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(a,t)===!1)}advanceSelection(e,t){var a,i,s=this;s.rtl&&(e*=-1),!s.inputValue().length&&(Et(ca,t)||Et("shiftKey",t)?(a=s.getLastActive(e),a?a.classList.contains("active")?i=s.getAdjacent(a,e,"item"):i=a:e>0?i=s.control_input.nextElementSibling:i=s.control_input.previousElementSibling,i&&(i.classList.contains("active")&&s.removeActiveItem(a),s.setActiveItemClass(i))):s.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var a=this.control.querySelectorAll(".active");if(a)return Fn(a,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,ut(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var a,i;const s=this;if(typeof this.settings.render[e]!="function"||(i=s.settings.render[e].call(this,t,Ua),!i))return null;if(i=qe(i),e==="option"||e==="option_create"?t[s.settings.disabledField]?fe(i,{"aria-disabled":"true"}):fe(i,{"data-selectable":""}):e==="optgroup"&&(a=t.group[s.settings.optgroupValueField],fe(i,{"data-group":a}),t.group[s.settings.disabledField]&&fe(i,{"data-disabled":""})),e==="option"||e==="item"){const d=va(t[s.settings.valueField]);fe(i,{"data-value":d}),e==="item"?(Me(i,s.settings.itemClass),fe(i,{"data-ts-item":""})):(Me(i,s.settings.optionClass),fe(i,{role:"option",id:t.$id}),t.$div=i,s.options[d]=t)}return i}_render(e,t){const a=this.render(e,t);if(a==null)throw"HTMLElement expected";return a}clearCache(){ye(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,a){var i=this,s=i[t];i[t]=function(){var d,l;return e==="after"&&(d=s.apply(i,arguments)),l=a.apply(i,arguments),e==="instead"?l:(e==="before"&&(d=s.apply(i,arguments)),d)}}}const so=(n,e,t,a)=>{n.addEventListener(e,t,a)};function ro(){so(this.input,"change",()=>{this.sync()})}const oo=n=>typeof n>"u"||n===null?null:lo(n),lo=n=>typeof n=="boolean"?n?"1":"0":n+"",Yn=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},co=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(uo(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},uo=n=>typeof n=="string"&&n.indexOf("<")>-1;function fo(n){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const a=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},n);var i=function(l,c){c?(l.checked=!0,a.uncheckedClassNames&&l.classList.remove(...a.uncheckedClassNames),a.checkedClassNames&&l.classList.add(...a.checkedClassNames)):(l.checked=!1,a.checkedClassNames&&l.classList.remove(...a.checkedClassNames),a.uncheckedClassNames&&l.classList.add(...a.uncheckedClassNames))},s=function(l){setTimeout(()=>{var c=l.querySelector("input."+a.className);c instanceof HTMLInputElement&&i(c,l.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var d=e.settings.render.option;e.settings.render.option=(l,c)=>{var f=co(d.call(e,l,c)),g=document.createElement("input");a.className&&g.classList.add(a.className),g.addEventListener("click",function(N){Yn(N)}),g.type="checkbox";const y=oo(l[e.settings.valueField]);return i(g,!!(y&&e.items.indexOf(y)>-1)),f.prepend(g),f}}),e.on("item_remove",d=>{var l=e.getOption(d);l&&(l.classList.remove("selected"),s(l))}),e.on("item_add",d=>{var l=e.getOption(d);l&&s(l)}),e.hook("instead","onOptionSelect",(d,l)=>{if(l.classList.contains("selected")){l.classList.remove("selected"),e.removeItem(l.dataset.value),e.refreshOptions(),Yn(d,!0);return}t.call(e,d,l),s(l)})}const po=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(ho(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},ho=n=>typeof n=="string"&&n.indexOf("<")>-1;function go(n){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:a=>`<div class="${a.className}" title="${a.title}">&#10799;</div>`},n);e.on("initialize",()=>{var a=po(t.html(t));a.addEventListener("click",i=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),i.preventDefault(),i.stopPropagation())}),e.control.appendChild(a)})}const mo=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Ct=(n,e,t,a)=>{n.addEventListener(e,t,a)},vo=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},yo=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Eo(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Eo=n=>typeof n=="string"&&n.indexOf("<")>-1,Io=(n,e)=>{vo(e,(t,a)=>{t==null?n.removeAttribute(a):n.setAttribute(a,""+t)})},wo=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n.nextSibling)},bo=(n,e)=>{var t;(t=n.parentNode)==null||t.insertBefore(e,n)},To=(n,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,n==e)return!0}while(e&&e.previousElementSibling);return!1};function So(){var n=this;if(n.settings.mode!=="multi")return;var e=n.lock,t=n.unlock;let a=!0,i;n.hook("after","setupTemplates",()=>{var s=n.settings.render.item;n.settings.render.item=(d,l)=>{const c=yo(s.call(n,d,l));Io(c,{draggable:"true"});const f=M=>{a||mo(M),M.stopPropagation()},g=M=>{i=c,setTimeout(()=>{c.classList.add("ts-dragging")},0)},y=M=>{M.preventDefault(),c.classList.add("ts-drag-over"),D(c,i)},N=()=>{c.classList.remove("ts-drag-over")},D=(M,P)=>{P!==void 0&&(To(P,c)?wo(M,P):bo(M,P))},k=()=>{var M;document.querySelectorAll(".ts-drag-over").forEach(F=>F.classList.remove("ts-drag-over")),(M=i)==null||M.classList.remove("ts-dragging"),i=void 0;var P=[];n.control.querySelectorAll("[data-value]").forEach(F=>{if(F.dataset.value){let $=F.dataset.value;$&&P.push($)}}),n.setValue(P)};return Ct(c,"mousedown",f),Ct(c,"dragstart",g),Ct(c,"dragenter",y),Ct(c,"dragover",y),Ct(c,"dragleave",N),Ct(c,"dragend",k),c}}),n.hook("instead","lock",()=>(a=!1,e.call(n))),n.hook("instead","unlock",()=>(a=!0,t.call(n)))}const No=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Oo=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Do(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Do=n=>typeof n=="string"&&n.indexOf("<")>-1;function ko(n){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:a=>'<div class="'+a.headerClass+'"><div class="'+a.titleRowClass+'"><span class="'+a.labelClass+'">'+a.title+'</span><a class="'+a.closeClass+'">&times;</a></div></div>'},n);e.on("initialize",()=>{var a=Oo(t.html(t)),i=a.querySelector("."+t.closeClass);i&&i.addEventListener("click",s=>{No(s,!0),e.close()}),e.dropdown.insertBefore(a,e.dropdown.firstChild)})}const _o=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},Co=(n,...e)=>{var t=Lo(e);n=Ao(n),n.map(a=>{t.map(i=>{a.classList.remove(i)})})},Lo=n=>{var e=[];return _o(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Ao=n=>(Array.isArray(n)||(n=[n]),n),Mo=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function $o(){var n=this;n.hook("instead","setCaret",e=>{n.settings.mode==="single"||!n.control.contains(n.control_input)?e=n.items.length:(e=Math.max(0,Math.min(n.items.length,e)),e!=n.caretPos&&!n.isPending&&n.controlChildren().forEach((t,a)=>{a<e?n.control_input.insertAdjacentElement("beforebegin",t):n.control.appendChild(t)})),n.caretPos=e}),n.hook("instead","moveCaret",e=>{if(!n.isFocused)return;const t=n.getLastActive(e);if(t){const a=Mo(t);n.setCaret(e>0?a+1:a),n.setActiveItem(),Co(t,"last-active")}else n.setCaret(n.caretPos+e)})}const xo=27,Ro=9,Po=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Xo=(n,e,t,a)=>{n.addEventListener(e,t,a)},Vo=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},qn=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Ho(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Ho=n=>typeof n=="string"&&n.indexOf("<")>-1,Fo=(n,...e)=>{var t=Bo(e);n=Uo(n),n.map(a=>{t.map(i=>{a.classList.add(i)})})},Bo=n=>{var e=[];return Vo(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},Uo=n=>(Array.isArray(n)||(n=[n]),n);function zo(){const n=this;n.settings.shouldOpen=!0,n.hook("before","setup",()=>{n.focus_node=n.control,Fo(n.control_input,"dropdown-input");const e=qn('<div class="dropdown-input-wrap">');e.append(n.control_input),n.dropdown.insertBefore(e,n.dropdown.firstChild);const t=qn('<input class="items-placeholder" tabindex="-1" />');t.placeholder=n.settings.placeholder||"",n.control.append(t)}),n.on("initialize",()=>{n.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case xo:n.isOpen&&(Po(t,!0),n.close()),n.clearActiveItems();return;case Ro:n.focus_node.tabIndex=-1;break}return n.onKeyDown.call(n,t)}),n.on("blur",()=>{n.focus_node.tabIndex=n.isDisabled?-1:n.tabIndex}),n.on("dropdown_open",()=>{n.control_input.focus()});const e=n.onBlur;n.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==n.control_input))return e.call(n)}),Xo(n.control_input,"blur",()=>n.onBlur()),n.hook("before","close",()=>{n.isOpen&&n.focus_node.focus({preventScroll:!0})})})}const ua=(n,e,t,a)=>{n.addEventListener(e,t,a)};function Go(){var n=this;n.on("initialize",()=>{var e=document.createElement("span"),t=n.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",n.wrapper.appendChild(e);var a=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const s of a)e.style[s]=t.style[s];var i=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};i(),n.on("update item_add item_remove",i),ua(t,"input",i),ua(t,"keyup",i),ua(t,"blur",i),ua(t,"update",i)})}function jo(){var n=this,e=n.deleteSelection;this.hook("instead","deleteSelection",t=>n.activeItems.length?e.call(n,t):!1)}function Wo(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}const Kn=37,Yo=39,qo=(n,e,t)=>{for(;n&&n.matches;){if(n.matches(e))return n;n=n.parentNode}},Ko=(n,e)=>{if(!n)return-1;e=e||n.nodeName;for(var t=0;n=n.previousElementSibling;)n.matches(e)&&t++;return t};function Qo(){var n=this,e=n.onKeyDown;n.hook("instead","onKeyDown",t=>{var a,i,s,d;if(!n.isOpen||!(t.keyCode===Kn||t.keyCode===Yo))return e.call(n,t);n.ignoreHover=!0,d=qo(n.activeOption,"[data-group]"),a=Ko(n.activeOption,"[data-selectable]"),d&&(t.keyCode===Kn?d=d.previousSibling:d=d.nextSibling,d&&(s=d.querySelectorAll("[data-selectable]"),i=s[Math.min(s.length-1,a)],i&&n.setActiveOption(i)))})}const Zo=n=>(n+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),Qn=(n,e=!1)=>{n&&(n.preventDefault(),e&&n.stopPropagation())},Zn=(n,e,t,a)=>{n.addEventListener(e,t,a)},Jn=n=>{if(n.jquery)return n[0];if(n instanceof HTMLElement)return n;if(Jo(n)){var e=document.createElement("template");return e.innerHTML=n.trim(),e.content.firstChild}return document.querySelector(n)},Jo=n=>typeof n=="string"&&n.indexOf("<")>-1;function ed(n){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},n);var t=this;if(e.append){var a='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Zo(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var i=t.settings.render.item;t.settings.render.item=(s,d)=>{var l=Jn(i.call(t,s,d)),c=Jn(a);return l.appendChild(c),Zn(c,"mousedown",f=>{Qn(f,!0)}),Zn(c,"click",f=>{t.isLocked||(Qn(f,!0),!t.isLocked&&t.shouldDelete([l],f)&&(t.removeItem(l),t.refreshOptions(!1),t.inputState()))}),l}})}}function td(n){const e=this,t=Object.assign({text:a=>a[e.settings.labelField]},n);e.on("item_remove",function(a){if(e.isFocused&&e.control_input.value.trim()===""){var i=e.options[a];i&&e.setTextboxValue(t.text.call(e,i))}})}const ad=(n,e)=>{if(Array.isArray(n))n.forEach(e);else for(var t in n)n.hasOwnProperty(t)&&e(n[t],t)},nd=(n,...e)=>{var t=id(e);n=sd(n),n.map(a=>{t.map(i=>{a.classList.add(i)})})},id=n=>{var e=[];return ad(n,t=>{typeof t=="string"&&(t=t.trim().split(/[\t\n\f\r\s]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},sd=n=>(Array.isArray(n)||(n=[n]),n);function rd(){const n=this,e=n.canLoad,t=n.clearActiveOption,a=n.loadCallback;var i={},s,d=!1,l,c=[];if(n.settings.shouldLoadMore||(n.settings.shouldLoadMore=()=>{if(s.clientHeight/(s.scrollHeight-s.scrollTop)>.9)return!0;if(n.activeOption){var N=n.selectable(),D=Array.from(N).indexOf(n.activeOption);if(D>=N.length-2)return!0}return!1}),!n.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";n.settings.sortField=[{field:"$order"},{field:"$score"}];const f=y=>typeof n.settings.maxOptions=="number"&&s.children.length>=n.settings.maxOptions?!1:!!(y in i&&i[y]),g=(y,N)=>n.items.indexOf(N)>=0||c.indexOf(N)>=0;n.setNextUrl=(y,N)=>{i[y]=N},n.getUrl=y=>{if(y in i){const N=i[y];return i[y]=!1,N}return n.clearPagination(),n.settings.firstUrl.call(n,y)},n.clearPagination=()=>{i={}},n.hook("instead","clearActiveOption",()=>{if(!d)return t.call(n)}),n.hook("instead","canLoad",y=>y in i?f(y):e.call(n,y)),n.hook("instead","loadCallback",(y,N)=>{if(!d)n.clearOptions(g);else if(l){const D=y[0];D!==void 0&&(l.dataset.value=D[n.settings.valueField])}a.call(n,y,N),d=!1}),n.hook("after","refreshOptions",()=>{const y=n.lastValue;var N;f(y)?(N=n.render("loading_more",{query:y}),N&&(N.setAttribute("data-selectable",""),l=N)):y in i&&!s.querySelector(".no-results")&&(N=n.render("no_more_results",{query:y})),N&&(nd(N,n.settings.optionClass),s.append(N))}),n.on("initialize",()=>{c=Object.keys(n.options),s=n.dropdown_content,n.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},n.settings.render),s.addEventListener("scroll",()=>{n.settings.shouldLoadMore.call(n)&&f(n.lastValue)&&(d||(d=!0,n.load.call(n,n.lastValue)))})})}Te.define("change_listener",ro);Te.define("checkbox_options",fo);Te.define("clear_button",go);Te.define("drag_drop",So);Te.define("dropdown_header",ko);Te.define("caret_position",$o);Te.define("dropdown_input",zo);Te.define("input_autogrow",Go);Te.define("no_backspace_delete",jo);Te.define("no_active_items",Wo);Te.define("optgroup_columns",Qo);Te.define("remove_button",ed);Te.define("restore_on_backspace",td);Te.define("virtual_scroll",rd);class od{spectresToCreate=[];spectresToDelete=[];spectresToUpdate=[];constructor(){}async Initialize(){const e=v.sceneItems.filter(t=>t.metadata[`${o.SPECTREID}/isSpectre`]===!0);for(const t of e)await this.SetupGhostSelect(t)}async Run(){const t=v.sceneItems.filter(a=>a.metadata[`${o.SPECTREID}/isSpectre`]===!0).filter(a=>a.metadata[`${o.SPECTREID}/spectreViewers`].includes(v.playerId));if(t.length>0){for(const i of t){const s=v.sceneLocal.find(d=>d.metadata[`${o.SPECTREID}/isLocalSpectre`]===i.id);if(!s)this.CreateSpectreToQueue(i);else{const d=i.position.x===s.position.x&&i.position.y===s.position.y,l=i.scale.x===s.scale.x&&i.scale.y===s.scale.y,c=i.rotation===s.rotation,f=i.layer===s.layer;(!c||!l||!f||!d)&&this.UpdateSpectreToQueue(i,s)}}const a=v.sceneLocal.filter(i=>ir(i));for(const i of a)t.find(d=>d.id===i.metadata[`${o.SPECTREID}/isLocalSpectre`])||this.spectresToDelete.push(i.id);this.spectresToCreate.length>0&&await m.scene.local.addItems(this.spectresToCreate),this.spectresToDelete.length>0&&await m.scene.local.deleteItems(this.spectresToDelete),this.spectresToUpdate.length>0&&await m.scene.items.updateItems(a.filter(i=>!this.spectresToDelete.includes(i.id)),i=>{for(let s of i){const d=this.spectresToUpdate.find(l=>l.id===s.id);d&&(s.layer=d.layer,s.scale=d.scale,s.rotation=d.rotation,s.position=d.position)}}),this.spectresToCreate=[],this.spectresToUpdate=[],this.spectresToDelete=[]}else{const a=v.sceneLocal.filter(i=>i.metadata[`${o.SPECTREID}/isLocalSpectre`]!==void 0);a.length>0&&await m.scene.local.deleteItems(a.map(i=>i.id))}}CreateSpectreToQueue(e){const t=Ea({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).position(e.position).scale(e.scale).text(e.text).rotation(e.rotation).layer(e.layer).metadata({[`${o.SPECTREID}/isLocalSpectre`]:e.id,[`${o.SPECTREID}/isSpectre`]:!0}).disableHit(!1).build();v.playerRole,this.spectresToCreate.push(t)}UpdateSpectreToQueue(e,t){const a={id:t.id,position:e.position,rotation:e.rotation,scale:e.scale,layer:e.layer};this.spectresToUpdate.push(a)}async HandleLocalMovement(e){const t=e.filter(a=>a.metadata[`${o.SPECTREID}/isLocalSpectre`]!==void 0);if(t.length>0){const a=[];for(const i of t){const s=v.sceneLocal.find(f=>f.id===i.id);if(!s)continue;const d=i.position.x===s.position.x&&i.position.y===s.position.y,l=i.scale.x===s.scale.x&&i.scale.y===s.scale.y,c=i.rotation===s.rotation;if(!d||!l||!c){const f=v.sceneItems.find(g=>g.id===s.metadata[`${o.SPECTREID}/isLocalSpectre`]);if(f){const g={id:f.id,position:s.position,scale:s.scale,rotation:s.rotation};a.push(g)}}}a.length>0&&await m.scene.items.updateItems(a.map(i=>i.id),i=>{for(let s of i){const d=a.find(l=>l.id===s.id);d&&(s.position=d.position,s.scale=d.scale,s.rotation=d.rotation)}})}}async SetupGhostSelect(e){const t=e.text?.plainText||e.name,a=document.getElementById("ghostList"),i=document.createElement("tr");i.id=`tr-${e.id}`,i.className="ghost-table-entry",i.innerHTML=`<td class="token-name">${t}</td>
            <td><select id="select-${e.id}" class="tSelects" multiple autocomplete="off" /></td>
            <td><input type="button" class="mysteryButton" id="deleteGhost-${e.id}" value="Delete"/></td>`,a.appendChild(i);const s=document.getElementById(`select-${e.id}`),d=Object.keys(v.sceneMetadata).filter(N=>N.startsWith(`${o.EXTENSIONID}/USER-`));if(d&&d.length>0){const N=d.map(D=>{const k=v.sceneMetadata[D];return k.id=D.replace(`${o.EXTENSIONID}/USER-`,""),k});for(const D of N){if(D.id===v.playerId)continue;const k=document.createElement("option");k.value=D.id,k.text=D.name,s.appendChild(k)}}let l=e.metadata[`${o.SPECTREID}/spectreViewers`];l||(l=[v.playerId]);let c=l.filter(N=>N!==v.playerId);const f={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:"Choose..",maxItems:null,items:c,create:!1,onDelete:async function(N,D){const k=D.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await m.scene.items.updateItems([k],M=>{const P=M[0].metadata[`${o.SPECTREID}/spectreViewers`],F=P.findIndex($=>$===N);P.splice(F,1),M[0].metadata[`${o.SPECTREID}/spectreViewers`]=P})},onItemAdd:async function(N,D){const k=D.parentElement.parentElement.parentElement.parentElement.id.slice(3);await m.scene.items.updateItems([k],M=>{const P=M[0].metadata[`${o.SPECTREID}/spectreViewers`];P.push(N),M[0].metadata[`${o.SPECTREID}/spectreViewers`]=P})}};new Te(`#select-${e.id}`,f);const g=document.getElementById(`deleteGhost-${e.id}`);g.onclick=async()=>{const N=v.sceneLocal.findIndex(D=>D.id===e.id);v.sceneLocal.splice(N,1),i.remove(),await m.scene.items.deleteItems([e.id])};const y=document.getElementsByClassName("ts-control");for(let N of y){const D=N;D.style.backgroundColor=v.theme.mode==="DARK"?"rgb(49, 49, 65)":"rgb(210, 210, 223)",D.style.borderRadius="6px"}}UpdateSpectreTargets(){const e=document.querySelectorAll(".tSelects");for(const t of e)if(t&&t.tomselect){const a=t.tomselect,i=[];for(const s of v.party)i.push({value:s.id,text:s.name});a.addOption(i),a.settings.placeholder="Choose..",a.inputState()}}RemoveGhostSelect(e){document.getElementById(`tr-${e}`)?.remove()}CheckForRemovedTokens(){const e=document.getElementsByClassName("ghost-table-entry"),t=Array.from(e).map(a=>a.id.slice(3));for(const a of t)v.sceneItems.find(s=>s.id===a)||this.RemoveGhostSelect(a)}}const pt=new od;class ei{static CreateSkPath(e,t=0,a=!0){if(e.length===0)return[[0]];const i=[];if(i.push([ve.MOVE,e[0].x,e[0].y]),t!==0&&e.length>2){const s=this.getTensionPoints(e,t,a),d=s.length;!a&&d>1&&i.push([ve.QUAD,s[0].x,s[0].y,s[1].x,s[1].y]);for(let l=a?0:2;l<d-1;l+=3){const c=s[l],f=s[l+1],g=s[l+2];this.bezierCurveTo(i,c.x,c.y,f.x,f.y,g.x,g.y)}!a&&d>0&&i.push([ve.QUAD,s[d-1].x,s[d-1].y,e[e.length-1].x,e[e.length-1].y])}else for(let s=1;s<e.length;s++)i.push([ve.LINE,e[s].x,e[s].y]);return a&&i.push([ve.CLOSE]),i}static allAreFinite(e){for(var t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}static bezierCurveTo(e,t,a,i,s,d,l){this.allAreFinite([t,a,i,s,d,l])&&(e.length===0&&e.push([ve.MOVE,t,a]),e.push([ve.CUBIC,t,a,i,s,d,l]))}static getTensionPoints(e,t,a){return a?this.getTensionPointsClosed(e,t):this.expandPoints(e,t)}static getTensionPointsClosed(e,t){const a=e.length,i=this.getControlPoints(e[a-1],e[0],e[1],t),s=this.getControlPoints(e[a-2],e[a-1],e[0],t),d=this.expandPoints(e,t);return[i[1]].concat(d).concat([s[0],e[a-1],s[1],i[0],e[0]])}static expandPoints(e,t){const a=[];for(let i=1;i<e.length-1;i++){const[s,d]=this.getControlPoints(e[i-1],e[i],e[i+1],t);isNaN(s.x)||a.push(s,e[i],d)}return a}static getControlPoints(e,t,a,i){const s=Ke.distance(e,t),d=Ke.distance(t,a),l=s+d;if(l<=0)return[{...e},{...e}];const c=i*s/l,f=i*d/l,g=Ke.subtract(a,e),y=Ke.subtract(t,Ke.multiply(g,c)),N=Ke.add(t,Ke.multiply(g,f));return[y,N]}}async function dd(){await m.contextMenu.create({id:`${o.EXTENSIONID}/convert-curve`,icons:[{icon:"/opendoor.svg",label:"Convert to Obstruction",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/elevation`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/isFogEffect`],value:void 0}],some:[{key:"layer",value:"DRAWING",coordinator:"||"},{key:"layer",value:"FOG"}],roles:["GM"]}}],async onClick(n){const e=[],t=[];for(const a of n.items)if(a.type==="CURVE"){const i=a;if(i.points.length>2){const s=i.style.tension??0,d=i.style.closed===!0||i.style.fillOpacity!==0;d&&i.points.push(i.points[0]);const l=ei.CreateSkPath(i.points,s,d),c=Pa(l,{x:0,y:0},{curveSegments:20}),f=Oe().tension(0).points(c).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).tension(s).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(d).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).build();e.push(f),t.push(i.id)}}else if(a.type==="PATH"){const i=a;if(i.commands.length>2){const s=Oe().tension(0).points(Pa(i.commands,i.position)).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).build();e.push(s),t.push(i.id)}}else if(a.type==="LINE"){const i=a,s=Oe().tension(0).points(ld([i.startPosition,i.endPosition],i.position)).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).build();e.push(s),t.push(i.id)}else if(a.type==="SHAPE"){const i=a,s=[];if(i.shapeType==="CIRCLE"){const d=Math.min(i.width,i.height)/2,l=2*Math.PI/20;for(let c=0;c<20;c++){const f=c*l,g=d*Math.cos(f),y=d*Math.sin(f);s.push({x:g,y})}}else if(i.shapeType==="RECTANGLE"){const c=0+i.width,f=0+i.height;s.push({x:0,y:0}),s.push({x:c,y:0}),s.push({x:c,y:f}),s.push({x:0,y:f})}else if(i.shapeType==="HEXAGON"){const d=i.width/2,l=[Math.PI/2,Math.PI/6,11*Math.PI/6,3*Math.PI/2,7*Math.PI/6,5*Math.PI/6];for(let c=0;c<6;c++){const f=l[c],g=d*Math.cos(f),y=d*Math.sin(f);s.push({x:g,y})}}else i.shapeType==="TRIANGLE"&&(s.push({x:0,y:0}),s.push({x:0-i.width/2,y:0+i.height}),s.push({x:0+i.width/2,y:0+i.height}));if(s.length>0){s.push(s[0]);let d=s;if(i.shapeType==="CIRCLE"){const c=ei.CreateSkPath(s,.25,!0);d=Pa(c,{x:0,y:0},{curveSegments:20})}const l=Oe().tension(0).points(d).position(i.position).rotation(i.rotation).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).build();e.push(l),t.push(i.id)}}if(e.length>0){for(let i=0;i<e.length;i+=5){const s=e.slice(i,i+5);await m.scene.items.addItems(s)}await m.scene.items.deleteItems(t)}}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/hasVision`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/hasVision`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)if(!e)delete a.metadata[`${o.EXTENSIONID}/hasVision`];else{a.metadata[`${o.EXTENSIONID}/hasVision`]=!0;const i=[{key:"visionRange",defaultFn:Ne},{key:"visionSourceRange",defaultFn:Ge},{key:"visionFallOff",defaultFn:rt},{key:"visionInAngle",defaultFn:ft},{key:"visionOutAngle",defaultFn:et},{key:"visionDark",defaultFn:wa}];for(const{key:s,defaultFn:d}of i){const l=`${o.EXTENSIONID}/${s}`;Ls(a.metadata,l)||(a.metadata[l]=d())}}})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(n){await m.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&t.metadata[`${o.EXTENSIONID}/disabled`]?delete t.metadata[`${o.EXTENSIONID}/disabled`]:t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${o.EXTENSIONID}/disabled`]=!0)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Swap to Double-sided",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/doubleSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"Swap to One-sided",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/doubleSided`],value:!0}]}}],async onClick(n){await m.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&t.metadata[`${o.EXTENSIONID}/doubleSided`]?delete t.metadata[`${o.EXTENSIONID}/doubleSided`]:t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${o.EXTENSIONID}/doubleSided`]=!0)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/switch-obstructing-side`,icons:[{icon:"/flip.svg",label:"Swap Obstructing Side",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:"type",value:"CURVE",coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/doubleSided`],value:void 0}]}}],async onClick(n){await m.scene.items.updateItems(n.items,e=>{for(const t of e){const a=t.points.reverse();t.points=a}})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/switch-blockage`,icons:[{icon:"/blocked.svg",label:"Swap to Unpassable",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/blocking`],value:void 0}]}},{icon:"/unblock.svg",label:"Swap to Passable",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/blocking`],value:!0}]}}],async onClick(n){await m.scene.items.updateItems(n.items,e=>{for(const t of e)t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&t.metadata[`${o.EXTENSIONID}/blocking`]?delete t.metadata[`${o.EXTENSIONID}/blocking`]:t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${o.EXTENSIONID}/blocking`]=!0)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/auto-fog-background`,icons:[{icon:"/fog-background.svg",label:"Auto Fog Map",filter:{every:[{key:"layer",value:"MAP"},{key:"type",value:"IMAGE"}],max:1}}],async onClick(n,e){await m.popover.open({id:o.CONTEXTID,url:"/pages/mapcontextembed.html",height:80,width:200,anchorElementId:e})},embed:{url:"/pages/mapcontextembed.html?contextmenu=true",height:80}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/toggle-fog-map`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Map",filter:{every:[{key:"layer",value:"MAP"},{key:["metadata",`${o.EXTENSIONID}/isFogMap`],value:void 0}]}},{icon:"/fog-background.svg",label:"Convert To Normal Map",filter:{every:[{key:"layer",value:"FOG"},{key:["metadata",`${o.EXTENSIONID}/isFogMap`],value:!0}]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/isFogMap`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)e?(a.layer="FOG",a.zIndex=-1.00000001,a.disableAutoZIndex=!0,a.metadata[`${o.EXTENSIONID}/isFogMap`]=!0):(a.layer="MAP",a.zIndex=-1.00000001,a.disableAutoZIndex=!1,delete a.metadata[`${o.EXTENSIONID}/isFogMap`])})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/create-window`,icons:[{icon:"/window.svg",label:"Enable Window",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/window.svg",label:"Disable Window",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isWindow`],value:!0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/isWindow`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)e?(a.metadata[`${o.EXTENSIONID}/isWindow`]=!0,a.style.strokeDash=[20,20]):(delete a.metadata[`${o.EXTENSIONID}/isWindow`],a.style.strokeDash=o.DEFAULTLINESTROKE)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/create-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:!0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/isDoor`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)e?(a.metadata[`${o.EXTENSIONID}/isDoor`]=!0,a.style.strokeColor=o.DOORCOLOR):(delete a.metadata[`${o.EXTENSIONID}/isDoorLocked`],delete a.metadata[`${o.EXTENSIONID}/doorOpen`],delete a.metadata[`${o.EXTENSIONID}/disabled`],delete a.metadata[`${o.EXTENSIONID}/isDoor`],a.style.strokeColor=v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/open-door`,icons:[{icon:"/opendoor.svg",label:"Open Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${o.EXTENSIONID}/doorOpen`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}},{icon:"/closedoor.svg",label:"Close Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${o.EXTENSIONID}/doorOpen`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}}],async onClick(n){await m.scene.items.updateItems(n.items,e=>{for(let t of e)t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&t.metadata[`${o.EXTENSIONID}/disabled`]?(delete t.metadata[`${o.EXTENSIONID}/disabled`],delete t.metadata[`${o.EXTENSIONID}/doorOpen`]):t.metadata[`${o.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${o.EXTENSIONID}/disabled`]=!0,t.metadata[`${o.EXTENSIONID}/doorOpen`]=!0)})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/toggle-door-lock`,icons:[{icon:"/locked-door.svg",label:"Lock Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isDoorLocked`],value:void 0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${o.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/unlocked-door.svg",label:"Unlock Door",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${o.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${o.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:o.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/isDoorLocked`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)e?a.metadata[`${o.EXTENSIONID}/isDoorLocked`]=!0:delete a.metadata[`${o.EXTENSIONID}/isDoorLocked`]})}}),await m.contextMenu.create({id:`${o.EXTENSIONID}/toggle-torch`,icons:[{icon:"/light.svg",label:"Enable Torchlight",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isTorch`],operator:"==",value:void 0},{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/no-light.svg",label:"Disable Torchlight",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isTorch`],operator:"==",value:!0},{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(n){const e=n.items.every(t=>t.metadata[`${o.EXTENSIONID}/isTorch`]===void 0);await m.scene.items.updateItems(n.items,t=>{for(const a of t)e?(a.metadata[`${o.EXTENSIONID}/isTorch`]=!0,a.metadata[`${o.EXTENSIONID}/hasVision`]=!0):(delete a.metadata[`${o.EXTENSIONID}/isTorch`],delete a.metadata[`${o.EXTENSIONID}/hasVision`])})}}),await m.contextMenu.create({id:`${o.SPECTREID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${o.SPECTREID}/isSpectre`],value:void 0,operator:"==",coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${o.SPECTREID}/isSpectre`],value:void 0,operator:"!=",coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}}],async onClick(n){if(n.items.every(t=>t.metadata[`${o.SPECTREID}/isSpectre`]===!0)){const t=n.items.map(a=>a.metadata[`${o.SPECTREID}/isLocalSpectre`]);await m.scene.items.updateItems(t,a=>{for(const i of a)delete i.metadata[`${o.SPECTREID}/isSpectre`],delete i.metadata[`${o.SPECTREID}/spectreViewers`],i.visible=!0});for(const a of t)pt.RemoveGhostSelect(a);await m.scene.local.deleteItems(n.items.map(a=>a.id))}else{await m.scene.items.updateItems(n.items.map(t=>t.id),t=>{for(const a of t)a.metadata[`${o.SPECTREID}/isSpectre`]=!0,a.metadata[`${o.SPECTREID}/spectreViewers`]=[v.playerId],a.visible=!1});for(const t of n.items)await pt.SetupGhostSelect(t)}}}),v.sceneMetadata[`${o.EXTENSIONID}/unitContextMenu`]===!0&&await rn(!0),v.sceneMetadata[`${o.EXTENSIONID}/wallContextMenu`]===!0&&await sn(!0),v.sceneMetadata[`${o.EXTENSIONID}/autoHide`]===!0&&await nn(!0)}async function nn(n){n?await m.contextMenu.create({id:`${o.EXTENSIONID}/autohide-toggle`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/hasVision`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${o.EXTENSIONID}/isAutoHidden`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isAutoHidden`],operator:"==",value:!0,coordinator:"&&"}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(e){const t=e.items.every(a=>a.metadata[`${o.EXTENSIONID}/isAutoHidden`]===void 0);await m.scene.items.updateItems(e.items,a=>{for(const i of a)t?i.metadata[`${o.EXTENSIONID}/isAutoHidden`]=!0:delete i.metadata[`${o.EXTENSIONID}/isAutoHidden`]})}}):await m.contextMenu.remove(`${o.EXTENSIONID}/autohide-toggle`)}async function sn(n){n?await m.contextMenu.create({id:`${o.EXTENSIONID}/switch-advanced-wall`,icons:[{icon:"/advancedwall.svg",label:"Advanced Settings",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(e,t){await m.popover.open({id:o.CONTEXTID,url:"/pages/wallcontextembed.html",height:80,width:200,anchorElementId:t})},embed:{url:"/pages/wallcontextembed.html?contextmenu=true",height:80}}):await m.contextMenu.remove(`${o.EXTENSIONID}/switch-advanced-wall`)}async function rn(n){n?await m.contextMenu.create({id:`${o.EXTENSIONID}/context-menu-embed`,icons:[{icon:"/icon.svg",label:"Vision Settings",filter:{every:[{key:["metadata",`${o.EXTENSIONID}/hasVision`],operator:"==",value:!0,coordinator:"&&"},{key:["metadata",`${o.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(e,t){await m.popover.open({id:o.CONTEXTID,url:"/pages/unitcontextembed.html",height:200,width:200,anchorElementId:t})},embed:{url:"/pages/unitcontextembed.html?contextmenu=true",height:200}}):await m.contextMenu.remove(`${o.EXTENSIONID}/context-menu-embed`)}function ld(n,e){return n.map(t=>({x:t.x+e.x,y:t.y+e.y}))}class ae{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENELOCAL="SCENELOCAL";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static SCENEFOG="SCENEFOG";static ROOMMETA="ROOMMETADATA";playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;fogFilled;fogColor;fogStroke;gridDpi;gridScale;gridSnap;gridUnit;gridType;storedMetaItems;sceneId;sceneItems;sceneLocal;sceneSelected;sceneMetadata;sceneReady;disableWindows;enableWindows;roomMetadata;theme;caches;snap;torchActive;USER_REGISTERED;toolStarted;expectedFogMapId;expectedFogStyle;expectedFogEffect;sceneMetadataHandler;sceneItemsHandler;sceneLocalHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;fogHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.fogFilled=!1,this.fogColor="#000",this.fogStroke=5,this.storedMetaItems=[],this.sceneId="",this.sceneItems=[],this.sceneLocal=[],this.sceneSelected=[],this.sceneMetadata={},this.disableWindows=[],this.enableWindows=[],this.gridDpi=0,this.gridScale=5,this.gridSnap=10,this.gridUnit="ft",this.gridType="SQUARE",this.sceneReady=!1,this.theme={},this.roomMetadata={},this.snap=!1,this.torchActive=!1,this.toolStarted=!1,this.expectedFogMapId="",this.expectedFogStyle="",this.expectedFogEffect="",this.USER_REGISTERED=!1,this.caches=e}async RefreshCache(){if(this.caches.includes(ae.PLAYER)&&(this.playerId=await m.player.getId(),this.playerName=await m.player.getName(),this.playerColor=await m.player.getColor(),this.playerMetadata=await m.player.getMetadata(),this.playerRole=await m.player.getRole()),this.caches.includes(ae.PARTY)&&(this.party=await m.party.getPlayers()),this.caches.includes(ae.SCENEFOG)&&this.sceneReady&&(this.fogColor=await m.scene.fog.getColor(),this.fogFilled=await m.scene.fog.getFilled()),this.caches.includes(ae.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await m.scene.items.getItems(),this.sceneLocal=await m.scene.local.getItems()),this.caches.includes(ae.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await m.scene.getMetadata();const e=this.sceneMetadata[`${o.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e),this.sceneId=this.sceneMetadata[`${o.EXTENSIONID}/sceneId`],(this.sceneId===""||this.sceneId===void 0)&&(await m.scene.setMetadata({[`${o.EXTENSIONID}/sceneId`]:crypto.randomUUID()}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"}))}if(this.caches.includes(ae.SCENEGRID)&&this.sceneReady){this.gridDpi=await m.scene.grid.getDpi(),this.gridType=await m.scene.grid.getType();const e=await m.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridUnit=e.parsed.unit}this.caches.includes(ae.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await m.room.getMetadata())}async InitializeCache(){if(this.sceneReady=await m.scene.isReady(),this.theme=await m.theme.getTheme(),Ln(this.theme,document),await m.broadcast.onMessage(o.PROCESSEDID,async e=>{e.data===!0&&await ne.OnDataChange()}),this.caches.includes(ae.PLAYER)&&(this.playerId=await m.player.getId(),this.playerName=await m.player.getName(),this.playerColor=await m.player.getColor(),this.playerMetadata=await m.player.getMetadata(),this.playerRole=await m.player.getRole()),this.caches.includes(ae.PARTY)&&(this.party=await m.party.getPlayers()),this.caches.includes(ae.SCENEFOG)&&this.sceneReady&&(this.fogColor=await m.scene.fog.getColor(),this.fogFilled=await m.scene.fog.getFilled()),this.caches.includes(ae.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await m.scene.items.getItems(),this.sceneLocal=await m.scene.local.getItems()),this.caches.includes(ae.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await m.scene.getMetadata();const e=this.sceneMetadata[`${o.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e),this.sceneId=this.sceneMetadata[`${o.EXTENSIONID}/sceneId`],(this.sceneId===""||this.sceneId===void 0)&&await m.scene.setMetadata({[`${o.EXTENSIONID}/sceneId`]:crypto.randomUUID()})}if(this.caches.includes(ae.SCENEGRID)&&this.sceneReady){this.gridDpi=await m.scene.grid.getDpi(),this.gridType=await m.scene.grid.getType();const e=await m.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridUnit=e.parsed.unit}this.caches.includes(ae.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await m.room.getMetadata()),m.broadcast.onMessage(o.WARNINGCASTID,e=>{if(this.playerRole==="GM"){const t=v.party.find(a=>a.id===e.data);t&&ma(!1,[t])}}),m.broadcast.onMessage(`${o.EXTENSIONID}/ELEVATIONEVENT`,e=>{switch(e.data){case"CANCEL":fn();break;case"FINISH":$i();break;case"UNDO":xi();break}}),m.broadcast.onMessage(`${o.EXTENSIONID}/LINEEVENT`,e=>{switch(e.data){case"CANCEL":en();break;case"FINISH":ba();break;case"UNDO":Di();break}}),m.broadcast.onMessage(`${o.EXTENSIONID}/POLYGONEVENT`,e=>{switch(e.data){case"CANCEL":tn();break;case"FINISH":Ta();break;case"UNDO":Ci();break}}),m.broadcast.onMessage(o.RESETPERSISTID,async e=>{await Ie.ClearPersistence()}),m.broadcast.onMessage(`${o.EXTENSIONID}/FOGBACKGROUNDEVENT`,async e=>{const t=e.data;this.expectedFogMapId=t.MapId,this.expectedFogStyle=t.FogStyle,this.expectedFogEffect=t.FogEffect}),await this.CheckRegistration(),await this.SaveUserToScene()}async SaveUserToScene(){await m.scene.setMetadata({[`${o.EXTENSIONID}/USER-${this.playerId}`]:{role:this.playerRole,name:this.playerName,color:this.playerColor}})}KillHandlers(){this.caches.includes(ae.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(ae.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(ae.SCENEITEMS)&&this.sceneLocalHandler!==void 0&&this.sceneLocalHandler(),this.caches.includes(ae.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(ae.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(ae.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(ae.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.caches.includes(ae.SCENEFOG)&&this.fogHandler!==void 0&&this.fogHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(ae.SCENEMETA)&&(this.sceneMetadataHandler=m.scene.onMetadataChange(async e=>{this.sceneMetadata[`${o.EXTENSIONID}/playerDoors`]===!0&&e[`${o.EXTENSIONID}/playerDoors`]!==!0&&Ie.ClearDoors(),v.playerRole==="GM"&&(this.sceneMetadata[`${o.EXTENSIONID}/unitContextMenu`]!==!0&&e[`${o.EXTENSIONID}/unitContextMenu`]===!0?await rn(!0):this.sceneMetadata[`${o.EXTENSIONID}/unitContextMenu`]===!0&&e[`${o.EXTENSIONID}/unitContextMenu`]!==!0&&await rn(!1),this.sceneMetadata[`${o.EXTENSIONID}/wallContextMenu`]!==!0&&e[`${o.EXTENSIONID}/wallContextMenu`]===!0?await sn(!0):this.sceneMetadata[`${o.EXTENSIONID}/wallContextMenu`]===!0&&e[`${o.EXTENSIONID}/wallContextMenu`]!==!0&&await sn(!1),this.sceneMetadata[`${o.EXTENSIONID}/autoHide`]!==!0&&e[`${o.EXTENSIONID}/autoHide`]===!0?await nn(!0):this.sceneMetadata[`${o.EXTENSIONID}/autoHide`]===!0&&e[`${o.EXTENSIONID}/autoHide`]!==!0&&await nn(!1)),this.sceneMetadata[`${o.EXTENSIONID}/persistence`]===!0&&e[`${o.EXTENSIONID}/persistence`]!==!0&&Ie.ClearPersistence(),this.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]!==!0&&e[`${o.EXTENSIONID}/toggleOwnerLines`]===!0?Ie.InitiateOwnerHighlight():this.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]===!0&&e[`${o.EXTENSIONID}/toggleOwnerLines`]!==!0&&Ie.ClearOwnershipHighlights();const t=e[`${o.EXTENSIONID}/disableVision`];t!==void 0&&(this.sceneMetadata[`${o.EXTENSIONID}/disableVision`]===!0&&e[`${o.EXTENSIONID}/disableVision`]!==!0||this.sceneMetadata[`${o.EXTENSIONID}/disableVision`]!==!0&&e[`${o.EXTENSIONID}/disableVision`]===!0)&&Ie.TogglePersistentLightVisibility(t),this.sceneMetadata=e,await this.OnSceneMetadataChanges(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(ae.SCENEITEMS)&&(this.sceneItemsHandler=m.scene.items.onChange(async e=>{this.sceneItems=e,await this.OnSceneItemsChange(e)}),this.sceneLocalHandler=m.scene.local.onChange(async e=>{const t=[...this.sceneLocal];this.sceneLocal=e,await this.OnSceneLocalChange(t)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(ae.SCENEGRID)&&(this.sceneGridHandler=m.scene.grid.onChange(async e=>{await this.OnSceneGridChange(e),this.gridDpi=e.dpi,this.gridType=await m.scene.grid.getType(),this.gridScale=parseInt(e.scale)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(ae.PLAYER)&&(this.playerHandler=m.player.onChange(async e=>{const t=this.playerRole;let a=!1;(this.playerName!==e.name||this.playerColor!==e.color||this.playerRole!==e.role)&&(a=!0),this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e,t),a&&await this.SaveUserToScene()})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(ae.PARTY)&&(this.partyHandler=m.party.onChange(async e=>{this.party=e.filter(t=>t.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(ae.ROOMMETA)&&(this.roomHandler=m.room.onMetadataChange(async e=>{await this.OnRoomMetadataChange(e),this.roomMetadata=e})),(this.fogHandler===void 0||this.fogHandler.length===0)&&this.caches.includes(ae.SCENEFOG)&&(this.fogHandler=m.scene.fog.onChange(async e=>{this.fogColor=e.style.color,this.fogFilled=e.filled,await this.OnFogChange(e)})),this.themeHandler===void 0&&(this.themeHandler=m.theme.onChange(async e=>{this.theme=e,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=m.scene.onReadyChange(async e=>{this.sceneReady=e,await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){this.playerRole}async OnSceneItemsChange(e){if(this.expectedFogMapId!==""){const t=e.filter(a=>a.id===this.expectedFogMapId);if(t.length>0){const a=t[0];await Xi(a,this.expectedFogEffect),this.expectedFogMapId="",this.expectedFogStyle="",this.expectedFogEffect=""}}this.playerRole==="GM"&&pt.CheckForRemovedTokens(),await ne.OnDataChange()}async OnSceneLocalChange(e){await pt.HandleLocalMovement(e)}async OnSceneGridChange(e){await ne.OnDataChange()}async OnSceneReadyChange(e){e?(await this.SaveUserToScene(),await this.RefreshCache(),await Ie.Reset(),await ne.Start(),this.SetupHandlers()):(this.KillHandlers(),await ne.Stop(),this.sceneItems=[],this.sceneMetadata={},this.playerRole==="GM"&&(this.toolStarted=!1),await m.tool.setMetadata(`${o.EXTENSIONID}/vision-tool`,{[`${o.EXTENSIONID}/elevationEditor`]:!1}))}async OnPlayerChange(e,t){if(this.playerRole!==t&&(await ne.Stop(),await Ie.Reset(),await ne.Start()),e.role==="GM"){const a=document.querySelectorAll(".token-table-entry");for(let f of a){let g=f.id.substring(3);e.selection!==void 0&&e.selection.includes(g)?f.classList.add("token-table-selected"):f.classList.remove("token-table-selected")}const i=e.metadata;(i[`${o.EXTENSIONID}/finishLine`]??!1)===!0&&ba(),(i[`${o.EXTENSIONID}/cancelLine`]??!1)===!0&&en(),(i[`${o.EXTENSIONID}/finishPoly`]??!1)===!0&&Ta(),(i[`${o.EXTENSIONID}/cancelPoly`]??!1)===!0&&tn()}e.selection!==void 0&&e.selection.length===1&&Ie.ToggleDoor(e.selection[0])}async OnPartyChange(e){if(this.playerRole!=="PLAYER"){const t=document.getElementById("playerListing");t.innerHTML="",t.appendChild(ne.GetEmptyContextItem("Self"));const a=document.getElementById("preview_select");a.innerHTML="";const i=document.createElement("option");i.value=v.playerId,i.textContent="View As: Self",a.appendChild(i);for(const s of this.party){const d=document.createElement("li");d.id=s.id,d.textContent=s.name,d.style.color=s.color,t.appendChild(d);const l=document.createElement("option");l.value=s.id,l.textContent=`View As: ${s.name}`,l.style.color=s.color,a.appendChild(l)}pt.UpdateSpectreTargets()}}async OnFogChange(e){const t=document.getElementById("toggle_fogfill");t&&(t.checked=e.filled),this.fogColor!==e.style.color&&await Ie.UpdateTrailingFogColor(e.style.color),await Ie.Run()}async OnRoomMetadataChange(e){}async OnThemeChange(e){Ln(e,document)}async ToggleBusy(e){const t=document.getElementById("preview_select");if(t.value!==v.playerId&&!e){const a=v.party.find(i=>i.id===t.value);a&&await m.action.setBadgeText(`Viewing as: ${a.name}`)}else await m.action.setBadgeText(e?"â±ï¸":void 0)}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",t={owlbearid:v.playerId},a={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:o.ANONAUTH,"x-manuel":e}),body:JSON.stringify(t)},i=await fetch(o.CHECKREGISTRATION,a);if(!i.ok){const d=await i.json();console.error("Error:",d);return}(await i.json()).Data==="OK"&&(this.USER_REGISTERED=!0)}catch(e){console.error("Error:",e)}}}const v=new ae([ae.SCENEITEMS,ae.SCENEMETA,ae.SCENEFOG,ae.SCENEGRID,ae.PLAYER,ae.PARTY]);function hn(n,e,t,a){if(n?.length>0){const i=[];for(const s of n){const d=cd(s),l=Ea({height:150,width:150,url:"https://upload.wikimedia.org/wikipedia/commons/5/59/Empty.png",mime:"image/png"},{dpi:300,offset:{x:150,y:150}}).position({x:d.x*e*t+a[0],y:d.y*e*t+a[1]}).layer("PROP").metadata({[`${o.EXTENSIONID}/hasVision`]:!0,[`${o.EXTENSIONID}/isTorch`]:!0,[`${o.EXTENSIONID}/visionFallOff`]:d.intensity,[`${o.EXTENSIONID}/hiddenToken`]:!0,[`${o.EXTENSIONID}/visionRange`]:d.range.toString()}).name("Imported Light Source").build();i.push(l)}return i}}function cd(n){return"position"in n?{x:n.position.x,y:n.position.y,range:n.range,intensity:ti(n.intensity,0,10)}:{x:n.x,y:n.y,range:n.dim,intensity:ti(n.dim/n.bright,0,10)}}function ti(n,e,t){return Math.max(e,Math.min(t,n)).toString()}function ji(n,e,t,a){const i=[];for(let s=0;s<n.length;s++){let d=[];for(let c=0;c<n[s]?.length-1;c++){const f=n[s][c].x*e,g=n[s][c].y*e,y=n[s][c+1].x*e,N=n[s][c+1].y*e;d.push({x:f*t+a[0],y:g*t+a[1]}),d.push({x:y*t+a[0],y:N*t+a[1]})}d.length>128&&(d=Ni(d,8,!1));const l=Oe().tension(0).points(d).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Import)").metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).closed(!1).visible(!1).locked(!0).build();i.push(l)}return i}function gn(n,e,t,a){const i=[];for(const s of n){const d=[];for(const c of s.bounds)d.push({x:c.x*e*t+a[0],y:c.y*e*t+a[1]});const l=Oe().tension(0).points(d).strokeColor(o.DOORCOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Door)").closed(!1).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0,[`${o.EXTENSIONID}/isDoor`]:!0}).build();s.closed||(l.metadata[`${o.EXTENSIONID}/disabled`]=!0,l.metadata[`${o.EXTENSIONID}/doorOpen`]=!0),i.push(l)}return i}const ai=25;function ni(){const n=document.getElementById("map_align");if(!n)return;const e=v.sceneItems.filter(i=>i.layer==="MAP"),t={};for(let i=0;i<e.length;i++){const s=e[i];let d=n.querySelector("#map-"+s.id);d===null?(d=document.createElement("option"),d.id="map-"+s.id,d.value=s.id,d.innerText=s.name,n.appendChild(d)):d.innerText!==s.name&&(d.innerText=s.name),t[s.id]=s.name}let a=n.querySelectorAll("option");for(let i=0;i<a.length;i++)t[a[i].value]===void 0&&n.removeChild(a[i])}async function ud(n,e,t,a){if(Number.isNaN(t)||t<0)return await m.notification.show("Invalid DPI","ERROR");let i=v.gridDpi/t,s,d=[];if(d[0]=0,d[1]=0,a!==""){let l=await m.scene.items.getItems([a]);if(l.length>0)s=l[0],t===0&&(t=s.grid.dpi),i=v.gridDpi/t,d[0]=s.position.x-s.grid.offset.x*i,d[1]=s.position.y-s.grid.offset.y*i;else return await m.notification.show("Unable to find map","ERROR")}else return await m.notification.show("No map selected","ERROR");n==="foundry"?await hd(e,i,d):n==="uvtt"&&await pd(e,i,d)}function ii(n){const e=[];for(const t of n){const a=[];for(const s of t)a.push({x:s.x*v.gridDpi,y:s.y*v.gridDpi});const i=Oe().tension(0).points(a).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${o.EXTENSIONID}/isVisionLine`]:!0,[`${o.EXTENSIONID}/blocking`]:!0,[`${o.EXTENSIONID}/doubleSided`]:!0}).build();e.push(i)}return e}async function fd(n,e){await gd();let t=[];n.objects_line_of_sight?.length>0&&(t=t.concat(ii(n.objects_line_of_sight))),await wt(10),n.line_of_sight?.length>0&&(t=t.concat(ii(n.line_of_sight))),await wt(20),n.portals?.length>0&&(t=t.concat(gn(n.portals,v.gridDpi,1,[0,0]))),await wt(30),n.lights?.length>0&&(t=t.concat(hn(n.lights,v.gridDpi,1,[0,0])));try{await wt(40);const a=atob(n.image),i=new Uint8Array(a.length),s=n.resolution.map_size.x*n.resolution.pixels_per_grid,d=n.resolution.map_size.y*n.resolution.pixels_per_grid;for(let y=0;y<a.length;y++)i[y]=a.charCodeAt(y);const l=new Blob([i],{type:"image/png"}),c=await As(l,.8,s,d);if(!c)throw new Error("Unable to convert to WebP");await wt(60);const f=Es(c).dpi(n.resolution.pixels_per_grid).scale({x:1,y:1}).build(),g=Is().baseMap(f).fogFilled(!0).name("New UVTT Scene").items(t).build();await wt(80),await m.assets.uploadScenes([g],!0),await wt(100,"Scene upload complete!")}catch(a){await m.notification.show("There was an error: "+a.message,"ERROR")}}async function pd(n,e,t){let a=[];const i=n.resolution.pixels_per_grid,s=[];if(n.resolution.map_origin!==void 0&&(t[0]-=n.resolution.map_origin.x*i,t[1]-=n.resolution.map_origin.y*i),n.portals?.length>0)for(let l=0;l<n.portals.length;l++){const c=n.portals[l].bounds;for(let f=0;f<c.length-1;f++)s.push({position:{x:0,y:0},bounds:[{x:c[f].x,y:c[f].y},{x:c[f+1].x,y:c[f+1].y}],closed:!0,freestanding:!1,rotation:0})}const d=n.line_of_sight.concat(n.objects_line_of_sight);d.length>0&&(a=a.concat(ji(d,i,e,t))),s.length>0&&(a=a.concat(gn(s,i,e,t))),n.lights?.length>0&&(a=a.concat(hn(n.lights,i,e,t))),await Wi(a)}async function hd(n,e,t){let a=[];const i=[],s=[];for(var d=0;d<n.walls.length;d++){const l=n.walls[d];l.door===0?i.push([{x:n.walls[d].c[0],y:n.walls[d].c[1]},{x:n.walls[d].c[2],y:n.walls[d].c[3]}]):s.push({position:{x:0,y:0},bounds:[{x:l.c[0],y:l.c[1]},{x:l.c[2],y:l.c[3]}],closed:!0,freestanding:!1,rotation:0})}i.length>0&&(a=a.concat(ji(i,1,e,t))),s.length>0&&(a=a.concat(gn(s,1,e,t))),n.lights?.length>0&&(a=a.concat(hn(n.lights,1,e,t))),await Wi(a)}async function Wi(n){await m.modal.open({id:o.PROGRESSBAR,url:"/pages/progressbar.html",height:400,width:500,disablePointerEvents:!1,hidePaper:!0}),await ze(o.DELAY);for(let t=0;t<n.length;t+=ai){const a=n.slice(t,t+ai);await m.scene.items.addItems(a),await ze(o.DELAY);const s={current:Math.min(t+a.length,n.length),total:n.length,complete:!1};await m.broadcast.sendMessage(o.PROGRESSBAR,s,{destination:"LOCAL"})}const e={current:100,total:100,complete:!0};return await m.broadcast.sendMessage(o.PROGRESSBAR,e,{destination:"LOCAL"}),await m.notification.show(`Finished importing '${n.length}' objects.`,"SUCCESS")}async function gd(){await m.modal.open({id:o.PROGRESSBAR,url:"/pages/progressbar.html",height:400,width:500,disablePointerEvents:!1,hidePaper:!0}),await ze(o.DELAY)}async function wt(n,e="Done!"){const t={current:n,total:100,complete:!1};n===100&&(t.complete=!0,await m.notification.show(`${e}`,"SUCCESS")),await m.broadcast.sendMessage(o.PROGRESSBAR,t,{destination:"LOCAL"})}function md(n=!1){const e=document.getElementById("hideListToggle");ne.hiddenList=document.getElementById("hidden_list"),ne.tokenList=document.getElementById("token_list"),e.onclick=async()=>{ne.hiddenList.style.display==="none"?(ne.hiddenList&&(ne.hiddenList.style.display="table-row-group"),e&&(e.value=n?"Tap to Hide List":"Out-of-Sight List: Click to Hide")):(ne.hiddenList&&(ne.hiddenList.style.display="none"),e&&(e.value=n?"Tap to Show List":"Out-of-Sight List: Click to Show"))};const t=document.getElementById("snap_checkbox");v.snap=!0,t.checked=!0,t.onclick=async A=>{if(!v.sceneReady){A.preventDefault();return}const H=A.target;v.snap=H.checked};const a=document.getElementById("disable_vision");a.checked=v.sceneMetadata[`${o.EXTENSIONID}/disableVision`]===!0,a.onclick=async A=>{{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/disableVision`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})}};const i=document.getElementById("toggle_fogfill");i.checked=v.fogFilled,i.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.fog.setFilled(H.checked)};const s=document.getElementById("toggle_trailingfog");s.checked=v.sceneMetadata[`${o.EXTENSIONID}/trailingFog`]===!0,s.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/trailingFog`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const d=document.getElementById("toggle_autohide");d.checked=v.sceneMetadata[`${o.EXTENSIONID}/autoHide`]===!0,d.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/autoHide`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const l=document.getElementById("toggle_persistence");l.checked=v.sceneMetadata[`${o.EXTENSIONID}/persistence`]===!0,v.sceneMetadata[`${o.EXTENSIONID}/persistence`]!==!0&&(s.disabled=!0,s.checked=!1),l.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/persistence`]:H.checked}),H.checked?s.disabled=!1:(s.disabled=!0,s.checked=!1,await m.scene.setMetadata({[`${o.EXTENSIONID}/trailingFog`]:!1})),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const c=document.getElementById("reset_persistence");c.onclick=async A=>{!A||!A.target||await m.broadcast.sendMessage(o.RESETPERSISTID,!0,{destination:"ALL"})};const f=document.getElementById("toggle_ownerlines");f.checked=v.sceneMetadata[`${o.EXTENSIONID}/toggleOwnerLines`]===!0,f.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/toggleOwnerLines`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const g=document.getElementById("door_checkbox");g.checked=v.sceneMetadata[`${o.EXTENSIONID}/playerDoors`]===!0,g.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/playerDoors`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const y=document.getElementById("warnings_checkbox");y.checked=v.sceneMetadata[`${o.EXTENSIONID}/showWarnings`]===void 0?!0:v.sceneMetadata[`${o.EXTENSIONID}/showWarnings`]===!0,y.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/showWarnings`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const N=document.getElementById("toggle_unitcontextmenu");N.checked=v.sceneMetadata[`${o.EXTENSIONID}/unitContextMenu`]===!0,N.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/unitContextMenu`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const D=document.getElementById("toggle_wallcontextmenu");D.checked=v.sceneMetadata[`${o.EXTENSIONID}/wallContextMenu`]===!0,D.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/wallContextMenu`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const k=document.getElementById("default_elevation_select"),M=v.sceneMetadata[`${o.EXTENSIONID}/defaultElevation`];k.value=typeof M=="string"?M:"-10",k.onchange=async A=>{const H=A.currentTarget;await m.scene.setMetadata({[`${o.EXTENSIONID}/defaultElevation`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const P=document.getElementById("elevation_style_select"),F=v.sceneMetadata[`${o.EXTENSIONID}/elevationComplex`];P.value=F==="true"?"true":"false",P.onchange=async A=>{const H=A.currentTarget;await m.scene.setMetadata({[`${o.EXTENSIONID}/elevationComplex`]:H.value==="true"}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const $=document.getElementById("toggle_gmwalls");$.checked=v.sceneMetadata[`${o.EXTENSIONID}/passWallsGM`]===!0,$.onclick=async A=>{if(!A||!A.target)return;const H=A.target;await m.scene.setMetadata({[`${o.EXTENSIONID}/passWallsGM`]:H.checked}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const G=document.getElementById("lock_button"),r=document.getElementById("unlock_button");r.onclick=async A=>{if(!A||!A.target)return;const H=v.sceneItems.filter(z=>zt(z));await v.ToggleBusy(!0);for(let z=0;z<H.length;z+=64){const ue=H.slice(z,z+64);await m.scene.items.updateItems(ue.map(se=>se.id),se=>{for(let ce of se)ce.locked=!1}),await ze(o.SHORTDELAY)}v.ToggleBusy(!1)},G.onclick=async A=>{if(!A||!A.target)return;const H=v.sceneItems.filter(z=>zt(z));await v.ToggleBusy(!0);for(let z=0;z<H.length;z+=64){const ue=H.slice(z,z+64);await m.scene.items.updateItems(ue.map(se=>se.id),se=>{for(let ce of se)ce.locked=!0}),await ze(o.SHORTDELAY)}await v.ToggleBusy(!1)};const p=document.getElementById("doublewall_button");p.onclick=async A=>{if(!A||!A.target)return;const H=v.sceneItems.filter(z=>zt(z));await v.ToggleBusy(!0);for(let z=0;z<H.length;z+=64){const ue=H.slice(z,z+64);await m.scene.items.updateItems(ue.map(se=>se.id),se=>{for(let ce of se)ce.metadata[`${o.EXTENSIONID}/doubleSided`]=!0}),await ze(o.SHORTDELAY)}v.ToggleBusy(!1)};const u=document.getElementById("block_button"),h=document.getElementById("unblock_button");h.onclick=async A=>{if(!A||!A.target)return;const H=v.sceneItems.filter(z=>zt(z));await v.ToggleBusy(!0);for(let z=0;z<H.length;z+=64){const ue=H.slice(z,z+64);await m.scene.items.updateItems(ue.map(se=>se.id),se=>{for(let ce of se)ce.metadata[`${o.EXTENSIONID}/blocking`]=void 0}),await ze(o.SHORTDELAY)}v.ToggleBusy(!1)},u.onclick=async A=>{if(!A||!A.target)return;const H=v.sceneItems.filter(z=>zt(z));await v.ToggleBusy(!0);for(let z=0;z<H.length;z+=64){const ue=H.slice(z,z+64);await m.scene.items.updateItems(ue.map(se=>se.id),se=>{for(let ce of se)ce.metadata[`${o.EXTENSIONID}/blocking`]=!0}),await ze(o.SHORTDELAY)}await v.ToggleBusy(!1)};const b=document.getElementById("visionDefaultInput");b.value=v.sceneMetadata[`${o.EXTENSIONID}/visionRangeDefault`]??Ne(),b.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseInt(H.value);z<0&&(H.value="0"),z>999&&(H.value="999"),isNaN(z)&&(H.value=Ge()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionRangeDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const E=document.getElementById("collisionDefaultInput");E.value=v.sceneMetadata[`${o.EXTENSIONID}/visionSourceDefault`]??Ge().toString(),E.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseFloat(H.value);z<0&&(H.value="0"),z>999&&(H.value="999"),isNaN(z)&&(H.value=Ge()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionSourceDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const I=document.getElementById("greyscaleDefaultInput");I.value=v.sceneMetadata[`${o.EXTENSIONID}/visionDarkDefault`]??wa().toString(),I.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseInt(H.value);z<0&&(H.value="0"),z>999&&(H.value="999"),isNaN(z)&&(H.value=Ge()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionDarkDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const w=document.getElementById("innerAngleDefaultInput");w.value=v.sceneMetadata[`${o.EXTENSIONID}/visionInAngleDefault`]??ft().toString(),w.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseInt(H.value);z<-360&&(H.value="-360"),z>360&&(H.value="360"),isNaN(z)&&(H.value=et()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionInAngleDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const _=document.getElementById("outerAngleDefaultInput");_.value=v.sceneMetadata[`${o.EXTENSIONID}/visionOutAngleDefault`]??et().toString(),_.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseInt(H.value);z<-360&&(H.value="-360"),z>360&&(H.value="360"),isNaN(z)&&(H.value=et()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionOutAngleDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};const C=document.getElementById("falloffDefaultInput");C.value=v.sceneMetadata[`${o.EXTENSIONID}/visionFallOffDefault`]??rt().toString(),C.onchange=async A=>{if(!A||!A.target)return;const H=A.target,z=parseFloat(H.value);z<0&&(H.value="0"),z>10&&(H.value="10"),isNaN(z)&&(H.value=rt()),await m.scene.setMetadata({[`${o.EXTENSIONID}/visionFallOffDefault`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})};var L;const x=document.getElementById("import_button"),T=document.getElementById("import_file"),R=document.getElementById("import_errors"),U=document.getElementById("import_dpi"),j=document.getElementById("import_format"),Q=document.getElementById("dpi_autodetect"),W=document.getElementById("map_align");T.onchange=A=>{if(x.disabled=!0,!A||!A.target)return;const H=A.target;if(!H.files)return;const z=H.files[0];if(z.type!=="text/javascript"&&z.type,z){const se=document.getElementById("import_file_name");se&&(se.textContent=z.name);var ue=new FileReader;ue.onload=function(ce){if(!ce||!ce.target){R.innerText="Invalid import event";return}const nt=ce.target;if(!nt.result){R.innerText="Unable to read imported file";return}const dt=nt.result;L=JSON.parse(dt),L&&(L.walls&&L.walls.length||L.line_of_sight&&L.line_of_sight.length||L.objects_line_of_sight&&L.objects_line_of_sight.length)?(x.disabled=!1,m.notification.show("Smoke & Spectre: Import file loaded successfully.","SUCCESS")):(x.disabled=!0,m.notification.show("Smoke & Spectre: Import file has no walls to import.","ERROR"))},ue.readAsText(z)}else R.innerText="Failed to load file",m.notification.show("Smoke & Spectre: Failed to load import file.","ERROR")},Q.onclick=async A=>{!A||!A.target||(U.disabled=Q.checked)},x.onclick=async A=>{!A||!A.target||(await v.ToggleBusy(!0),j.value==="scene"?await fd(L):await ud(j.value,L,Q.checked?0:Number.parseInt(U.value),W.value),await v.ToggleBusy(!1))};const J=document.getElementById("tool_width"),te=document.getElementById("tool_color"),de=document.getElementById("tool_style");let ee;const ie=document.getElementById("preview_select");ie.onchange=async()=>{await Ie.Run(),await v.ToggleBusy(!1)},te.onclick=async A=>{We({el:`#${te.id}`,alpha:!1,forceAlpha:!1})},te.oninput=async A=>{if(!A||!A.target)return;const H=A.target;clearTimeout(ee),ee=setTimeout(async()=>{/#[a-f0-9]{6}/.test(H.value)&&(await m.scene.setMetadata({[`${o.EXTENSIONID}/toolColor`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"}))},400)},de.onchange=async A=>{const H=A.currentTarget;await m.scene.setMetadata({[`${o.EXTENSIONID}/toolStyle`]:H.value=="solid"?[]:[25,25]}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})},J.onchange=A=>{const H=A.currentTarget;clearTimeout(ee);try{const z=parseInt(H.value);(z<1||z>100)&&(H.value="8")}catch{H.value="8"}ee=setTimeout(async()=>{await m.scene.setMetadata({[`${o.EXTENSIONID}/toolWidth`]:H.value}),await m.broadcast.sendMessage(o.PROCESSEDID,!0,{destination:"ALL"})},400)};const le=v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??"#000000";te&&(te.value=le),We({themeMode:"dark",alpha:!1,forceAlpha:!1,el:"#tool_color",defaultColor:le})}class Da{static async GetGridSquare(e,t){if(!t.some(i=>i.x===e.x&&i.y===e.y)){const i={x:e.x*v.gridDpi,y:e.y*v.gridDpi},s={x:(e.x+1)*v.gridDpi,y:e.y*v.gridDpi},d={x:e.x*v.gridDpi,y:(e.y+1)*v.gridDpi},l={x:(e.x+1)*v.gridDpi,y:(e.y+1)*v.gridDpi},c=[[Ue.MOVE,i.x,i.y],[Ue.LINE,s.x,s.y],[Ue.LINE,l.x,l.y],[Ue.LINE,d.x,d.y],[Ue.CLOSE]],f=un().commands(c).strokeOpacity(0).fillOpacity(.5).fillColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).build();f.metadata[`${o.EXTENSIONID}/isBrushSquare`]=!0,f.layer="POINTER",t.push(e),await m.scene.local.addItems([f])}}static GetGridCoords(e){return{x:Math.floor(e.x/v.gridDpi),y:Math.floor(e.y/v.gridDpi)}}}class Re{static async GetGridHexagon(e,t){if(!t.some(i=>i.x===e.x&&i.y===e.y)){const i=Re.CreateHexagonPath(e),s=un().commands(i).strokeOpacity(0).fillOpacity(.5).fillColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).build();s.metadata[`${o.EXTENSIONID}/isBrushSquare`]=!0,s.layer="POINTER",t.push(e),await m.scene.local.addItems([s])}}static GetGridCoords(e){if(v.gridType==="HEX_HORIZONTAL"){const t=v.gridDpi*Math.sqrt(3)/2,a=Math.floor(e.x/t);return a%2?{x:a,y:Math.floor((e.y-v.gridDpi/2)/v.gridDpi)}:{x:a,y:Math.floor(e.y/v.gridDpi)}}else{const t=v.gridDpi*Math.sqrt(3)/2,a=Math.floor(e.y/t);return a%2?{x:Math.floor((e.x-v.gridDpi/2)/v.gridDpi),y:a}:{x:Math.floor(e.x/v.gridDpi),y:a}}}static CreateHexagonPath(e){const t=Re.CalculateHexagonVertices(e),a=[[Ue.MOVE,t[0].x,t[0].y]];for(let i=1;i<t.length;i++)a.push([Ue.LINE,t[i].x,t[i].y]);return a.push([Ue.CLOSE]),a}static CalculateHexagonVertices(e){if(v.gridType==="HEX_HORIZONTAL"){let t=e;t.x%2&&(t={x:t.x,y:t.y+.5});const a=[],i=v.gridDpi*Math.sqrt(3)/2,s=v.gridDpi/1.7315,d={x:t.x*i+s,y:t.y*v.gridDpi+v.gridDpi/2},l=Math.PI*2/6;for(let c=0;c<6;c++){const f=l*c,g=d.x+s*Math.cos(f),y=d.y+s*Math.sin(f);a.push({x:g,y})}return a}else{let t=e;t.y%2&&(t={y:t.y,x:t.x+.5});const a=[],i=v.gridDpi*Math.sqrt(3)/2,s=v.gridDpi/1.7315,d={y:t.y*i+s,x:t.x*v.gridDpi+v.gridDpi/2},l=Math.PI*2/6;for(let c=0;c<6;c++){const f=l*c+Math.PI/6,g=d.x+s*Math.cos(f),y=d.y+s*Math.sin(f);a.push({x:g,y})}return a}}}class Pe{static async GetGridIsometric(e,t){if(!t.some(i=>i.x===e.x&&i.y===e.y)){const i=Pe.CreateIsometricPath(e),s=un().commands(i).strokeOpacity(0).fillOpacity(.5).fillColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).build();s.metadata[`${o.EXTENSIONID}/isBrushSquare`]=!0,s.layer="POINTER",t.push(e),await m.scene.local.addItems([s])}}static CreateIsometricPath(e){const t=Pe.CalculateIsometricVertices(e),a=[[Ue.MOVE,t[0].x,t[0].y]];for(let i=1;i<t.length;i++)a.push([Ue.LINE,t[i].x,t[i].y]);return a.push([Ue.CLOSE]),a}static CalculateIsometricVertices(e){const t=v.gridDpi/2,a=v.gridType==="ISOMETRIC"?t/Math.tan(Math.PI/6):v.gridDpi,i=e.x*a,s=e.y*t;return[{x:i,y:s},{x:i-a,y:s+t},{x:i,y:s+t*2},{x:i+a,y:s+t}]}static GetGridCoords(e){const t=v.gridDpi/2,a=v.gridType==="ISOMETRIC"?t/Math.tan(Math.PI/6):v.gridDpi,i=e.x+Math.abs(Math.floor(e.x/a))*a,s=e.y+Math.abs(Math.floor(e.y/t))*t,d=Math.floor((e.x+a)/a),l=Math.floor(e.y/t),c=i%a,f=s%t,g=(d+l)%2,y=g?c*(t/a):-c*(t/a)+t;return f>y?g?{x:d-1,y:l}:{x:d,y:l}:g?{x:d,y:l-1}:{x:d-1,y:l-1}}}class pe{static async GenerateSmallLines(e){switch(v.gridType){case"SQUARE":await pe.GenerateSquareSmallLines(e);break;case"HEX_VERTICAL":await pe.GenerateHexagonSmallLines(e);break;case"HEX_HORIZONTAL":await pe.GenerateHexagonSmallLines(e);break;case"DIMETRIC":await pe.GenerateIsometricSmallLines(e);break;case"ISOMETRIC":await pe.GenerateIsometricSmallLines(e);break}}static async GenerateIsometricSmallLines(e){const t=[];for(const f of e){const g=Pe.CalculateIsometricVertices(f);for(let y=0;y<g.length;y++){const N=g[y],D=y<g.length-1?g[y+1]:g[0];t.push({Start:N,End:D})}}const a=pe.RemoveCloseLines(t,2),i=pe.CombineContiguousDiagonalLines(a),s=pe.RemoveDuplicateLines(i),d=pe.GetLine(s),l=25,c=d.length;for(let f=0;f<c;f+=l){const g=d.slice(f,f+l);await m.scene.items.addItems(g),await ze(o.SHORTDELAY)}}static async GenerateHexagonSmallLines(e){const t=[];for(const l of e){const c=Re.CalculateHexagonVertices(l);for(let f=0;f<c.length;f++){const g=c[f],y=f<c.length-1?c[f+1]:c[0];t.push({Start:g,End:y})}}const a=pe.RemoveCloseLines(t,2),i=pe.GetLine(a),s=25,d=i.length;for(let l=0;l<d;l+=s){const c=i.slice(l,l+s);await m.scene.items.addItems(c),await ze(o.SHORTDELAY)}}static async GenerateSquareSmallLines(e){const t=[];for(const c of e){const{x:f,y:g}=c,y={x:f*v.gridDpi,y:g*v.gridDpi},N={x:(f+1)*v.gridDpi,y:g*v.gridDpi},D={x:f*v.gridDpi,y:(g+1)*v.gridDpi},k={x:(f+1)*v.gridDpi,y:(g+1)*v.gridDpi};if(!e.some(M=>M.x===f&&M.y===g-1)){const M=y,P=N;t.push({Start:M,End:P})}if(!e.some(M=>M.x===f&&M.y===g+1)){const M=D,P=k;t.push({Start:M,End:P})}if(!e.some(M=>M.x===f-1&&M.y===g)){const M=y,P=D;t.push({Start:M,End:P})}if(!e.some(M=>M.x===f+1&&M.y===g)){const M=N,P=k;t.push({Start:M,End:P})}}const a=pe.CombineContiguousLines(t),i=pe.CombineOverlappingLines(a),s=pe.GetLine(i),d=25,l=s.length;for(let c=0;c<l;c+=d){const f=s.slice(c,c+d);await m.scene.items.addItems(f),await ze(o.SHORTDELAY)}}static AreLinesIdentical(e,t,a){return Math.abs(e.Start.x-t.Start.x)<a&&Math.abs(e.Start.y-t.Start.y)<a&&Math.abs(e.End.x-t.End.x)<a&&Math.abs(e.End.y-t.End.y)<a||Math.abs(e.Start.x-t.End.x)<a&&Math.abs(e.Start.y-t.End.y)<a&&Math.abs(e.End.x-t.Start.x)<a&&Math.abs(e.End.y-t.Start.y)<a}static RemoveCloseLines(e,t){const a=new Set;for(let i=0;i<e.length;i++)if(!a.has(i))for(let s=i+1;s<e.length;s++)a.has(s)||pe.AreLinesIdentical(e[i],e[s],t)&&(a.add(i),a.add(s));return e.filter((i,s)=>!a.has(s))}static CombineOverlappingLines(e){let t=[],a=[],i=!1;for(const s of e){const d=s.Start.x===s.End.x?e.filter(f=>f.Start.x===f.End.x):e.filter(f=>f.Start.y===f.End.y),l=s.Start.x===s.End.x?d.filter(f=>f.Start.x===s.Start.x&&f.End.x===s.End.x):d.filter(f=>f.Start.y===s.Start.y&&f.End.y===s.End.y),c=s.Start.x!==s.End.x?l.find(f=>f.Start.x>s.Start.x&&f.Start.x<s.End.x):l.find(f=>f.Start.y>s.Start.y&&f.Start.y<s.End.y);if(c){const f=pe.MergePrecision(s,c);a.push(f),t.push(s),t.push(c),a=a.filter(g=>g!==s&&g!==c),i=!0}else t.includes(s)||a.push(s)}return i?pe.CombineOverlappingLines(a):a}static CombineContiguousDiagonalLines(e){let t=[],a=[],i=!1;for(const s of e){const d=e.find(l=>{if(s.Start.x===l.Start.x&&s.Start.y===l.Start.y&&s.End.x===l.End.x&&s.End.y===l.End.y||!(s.End.x===l.Start.x&&s.End.y===l.Start.y||s.End.x===l.End.x&&s.End.y===l.End.y||s.Start.x===l.Start.x&&s.Start.y===l.Start.y||s.Start.x===l.End.x&&s.Start.y===l.End.y))return!1;const f=(s.End.y-s.Start.y)/(s.End.x-s.Start.x),g=(l.End.y-l.Start.y)/(l.End.x-l.Start.x);return f===g});if(!t.includes(s))if(d&&!t.includes(d)){const l=pe.MergeLines(s,d);a.push(l),t.includes(s)||t.push(s),t.includes(d)||t.push(d),a=a.filter(c=>c!==s&&c!==d),i=!0}else t.includes(s)||a.push(s)}return i?pe.CombineContiguousDiagonalLines(a):a}static CombineContiguousLines(e){let t=[],a=[],i=!1;for(const s of e){const l=(s.Start.x===s.End.x?e.filter(c=>c.Start.x===c.End.x):e.filter(c=>c.Start.y===c.End.y)).find(c=>c.Start.x===s.End.x&&c.Start.y===s.End.y);if(l){const c=pe.MergeLines(s,l);a.push(c),t.includes(s)||t.push(s),t.includes(l)||t.push(l),a=a.filter(f=>f!==s&&f!==l),i=!0}else t.includes(s)||a.push(s)}return i?pe.CombineContiguousLines(a):a}static MergeLines(e,t){return e.End.x===t.End.x&&e.End.y===t.End.y?{Start:e.Start,End:t.Start}:e.Start.x===t.Start.x&&e.Start.y===t.Start.y?{Start:e.End,End:t.End}:e.Start.x===t.End.x&&e.Start.y===t.End.y?{Start:t.Start,End:e.End}:{Start:e.Start,End:t.End}}static RemoveDuplicateLines(e){const t=new Set;return e.filter(a=>{const i=a.Start.x<a.End.x||a.Start.x===a.End.x&&a.Start.y<a.End.y?a.Start:a.End,s=i===a.Start?a.End:a.Start,d=JSON.stringify({Start:i,End:s});return t.has(d)?!1:(t.add(d),!0)})}static MergePrecision(e,t){const a=Math.min(e.Start.x,t.Start.x),i=Math.min(e.Start.y,t.Start.y),s=Math.max(e.End.x,t.End.x),d=Math.max(e.End.y,t.End.y);return{Start:{x:a,y:i},End:{x:s,y:d}}}static GetLine(e){const t=[];for(const a of e){const i=Oe().tension(0).points([a.Start,a.End]).strokeColor(v.sceneMetadata[`${o.EXTENSIONID}/toolColor`]??o.DEFAULTLINECOLOR).strokeDash(v.sceneMetadata[`${o.EXTENSIONID}/toolStyle`]??o.DEFAULTLINESTROKE).strokeWidth(be()).fillOpacity(0).fillColor("#000000").layer(o.LINELAYER).name("Vision Line (Brushed)").closed(!1).locked(!0).build();i.visible=!1,i.metadata[`${o.EXTENSIONID}/isVisionLine`]=!0,i.metadata[`${o.EXTENSIONID}/blocking`]=!0,i.metadata[`${o.EXTENSIONID}/doubleSided`]=!0,t.push(i)}return t}}let xe=[];async function Yi(){xe=[];const n=await m.scene.local.getItems(ur);await m.scene.local.deleteItems(n.map(e=>e.id)),await m.popover.close(o.BRUSHTOOLID)}async function vd(n,e){switch(v.gridType){case"SQUARE":await Da.GetGridSquare(Da.GetGridCoords(e.pointerPosition),xe);break;case"HEX_VERTICAL":await Re.GetGridHexagon(Re.GetGridCoords(e.pointerPosition),xe);break;case"HEX_HORIZONTAL":await Re.GetGridHexagon(Re.GetGridCoords(e.pointerPosition),xe);break;case"DIMETRIC":await Pe.GetGridIsometric(Pe.GetGridCoords(e.pointerPosition),xe);break;case"ISOMETRIC":await Pe.GetGridIsometric(Pe.GetGridCoords(e.pointerPosition),xe);break}}async function yd(){const n=await m.viewport.getWidth();await m.popover.open({id:o.BRUSHTOOLID,url:"/pages/brush.html",height:80,width:350,disableClickAway:!0,anchorPosition:{top:60,left:n/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}async function Ed(){await m.popover.close(o.BRUSHTOOLID)}async function Id(n,e){switch(v.gridType){case"SQUARE":await Da.GetGridSquare(Da.GetGridCoords(e.pointerPosition),xe);break;case"HEX_VERTICAL":await Re.GetGridHexagon(Re.GetGridCoords(e.pointerPosition),xe);break;case"HEX_HORIZONTAL":await Re.GetGridHexagon(Re.GetGridCoords(e.pointerPosition),xe);break;case"DIMETRIC":await Pe.GetGridIsometric(Pe.GetGridCoords(e.pointerPosition),xe);break;case"ISOMETRIC":await Pe.GetGridIsometric(Pe.GetGridCoords(e.pointerPosition),xe);break}}async function wd(n,e){await pe.GenerateSmallLines(xe),await Yi()}async function bd(n,e){await Yi()}const Lt={onActivate:yd,onDeactivate:Ed,onDragStart:vd,onDragMove:Id,onDragEnd:wd,onDragCancel:bd};let xt=[],qi="",Rt="",At=null,fa=!1,Wa=!1;async function Ki(){xt=[],Rt="",await m.scene.local.deleteItems([qi])}async function Td(n){const e=n.position.x!==0&&n.position.y!==0,t=e?si(n.points,n.position,!0):n.points,a=Fs(t,xt[0],xt[1],n.rotation,n.position),i=[],s=Oe().tension(n.style.tension??0).points(a.extracted).strokeColor(Hs(n.style.strokeColor??o.DEFAULTLINECOLOR)).strokeDash(n.style.strokeDash??o.DEFAULTLINESTROKE).strokeWidth(n.style.strokeWidth??be()).fillOpacity(n.style.fillOpacity??0).fillColor(n.style.fillColor??"#000000").layer(n.layer??o.LINELAYER).name(n.name??"Vision Line (Line)").metadata(n.metadata).closed(n.style.closed??!1).visible(n.visible??!1).locked(n.locked??!0).build();i.push(s);for(const d of a.remaining){const l=Oe().tension(0).position(n.position).strokeColor(n.style.strokeColor??o.DEFAULTLINECOLOR).strokeDash(n.style.strokeDash??o.DEFAULTLINESTROKE).strokeWidth(n.style.strokeWidth??be()).fillOpacity(n.style.fillOpacity??0).rotation(n.rotation).fillColor(n.style.fillColor??"#000000").layer(n.layer??o.LINELAYER).name(n.name??"Vision Line (Line)").metadata(n.metadata).closed(n.style.closed??!1).visible(n.visible??!1).locked(n.locked??!0).build();l.points=e?si(d,n.position,!1):d,i.push(l)}await m.scene.items.deleteItems([n.id]),await m.scene.items.addItems(i),Ki()}async function Sd(n,e){if(!e.transformer&&!(!e.target||e.target.type!=="CURVE"||Rt!==""&&Rt!==e.target.id)){if(Rt=e.target.id,xt.push(e.pointerPosition),xt.length===1){const t=Qi();t.position=e.pointerPosition,qi=t.id,await m.scene.local.addItems([t])}xt.length===2&&Td(e.target)}}async function Nd(n,e){if(e.target&&e.target.type==="CURVE"&&(Rt===""||Rt===e.target.id)){if(!fa&&!Wa){At||(Wa=!0,At=await m.interaction.startItemInteraction(Qi()));const[t]=At;t(a=>{a.position=e.pointerPosition}),Wa=!1}}else if(At&&(!e.target||e.target&&e.target.type!=="CURVE")){const[t,a]=At;a(),At=null,fa||(setTimeout(()=>{fa=!1},50),fa=!0)}}function Od(n,e){e.key=="Escape"&&Ki()}function Qi(){const n=be();return ws().color("red").radius(n+4).disableHit(!0).build()}function si(n,e,t){return n.map(a=>({x:t?a.x+e.x:a.x-e.x,y:t?a.y+e.y:a.y-e.y}))}const Ya={onToolClick:Sd,onToolMove:Nd,onKeyDown:Od};async function Dd(){await m.tool.create({id:`${o.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],defaultMetadata:{[`${o.EXTENSIONID}/elevationEditor`]:!1},async onClick(){await m.tool.activateTool(`${o.EXTENSIONID}/vision-tool`),v.toolStarted||(v.toolStarted=!0,await m.tool.setMetadata(`${o.EXTENSIONID}/vision-tool`,{[`${o.EXTENSIONID}/elevationEditor`]:!1}))}}),await m.tool.createMode({id:`${o.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],onToolDown:ra.onToolClick,onToolMove:ra.onToolMove,onToolDoubleClick:ra.onToolDouble,onKeyDown:ra.onKeyDown,preventDrag:{dragging:!1}}),await m.tool.createMode({id:`${o.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],onToolDown:oa.onToolClick,onToolMove:oa.onToolMove,onToolDoubleClick:oa.onToolDouble,onKeyDown:oa.onKeyDown,preventDrag:{dragging:!1}}),await m.tool.createMode({id:`${o.EXTENSIONID}/add-vision-brush-mode`,icons:[{icon:"/brush.svg",label:"Paint Obstructions by Grid",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],onToolDown:Lt.onActivate,onToolUp:Lt.onDeactivate,onToolDragStart:Lt.onDragStart,onToolDragMove:Lt.onDragMove,onToolDragEnd:Lt.onDragEnd,onToolDragCancel:Lt.onDragCancel}),await m.tool.createMode({id:`${o.EXTENSIONID}/add-line-cutter-mode`,icons:[{icon:"/cutter.svg",label:"Trim Line",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],onToolDown:Ya.onToolClick,onToolMove:Ya.onToolMove,onKeyDown:Ya.onKeyDown,preventDrag:{dragging:!1},cursors:[{cursor:"crosshair"}]}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-1`,icons:[{icon:"/mountain1.svg",label:"Create Map Elevation Layer-1",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>{Ee.onToolClick(n,e,1)},onToolMove:Ee.onToolMove,onKeyDown:(n,e)=>{Ee.onKeyDown(n,e,1)},preventDrag:{dragging:!0}}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-2`,icons:[{icon:"/mountain2.svg",label:"Create Map Elevation Layer-2",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>{Ee.onToolClick(n,e,2)},onToolMove:Ee.onToolMove,onKeyDown:(n,e)=>{Ee.onKeyDown(n,e,2)},preventDrag:{dragging:!0}}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-3`,icons:[{icon:"/mountain3.svg",label:"Create Map Elevation Layer-3",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>{Ee.onToolClick(n,e,3)},onToolMove:Ee.onToolMove,onKeyDown:(n,e)=>{Ee.onKeyDown(n,e,3)},preventDrag:{dragging:!0}}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-4`,icons:[{icon:"/mountain4.svg",label:"Create Map Elevation Layer-4",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>{Ee.onToolClick(n,e,4)},onToolMove:Ee.onToolMove,onKeyDown:(n,e)=>{Ee.onKeyDown(n,e,4)},preventDrag:{dragging:!0}}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-5`,icons:[{icon:"/mountain5.svg",label:"Create Map Elevation Layer-5",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>{Ee.onToolClick(n,e,5)},onToolMove:Ee.onToolMove,onKeyDown:(n,e)=>{Ee.onKeyDown(n,e,5)},preventDrag:{dragging:!0}}),await m.tool.createMode({id:`${o.EXTENSIONID}/enter-elevation-mode-select`,icons:[{icon:"/mountain-select.svg",label:"Selector",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(n,e)=>!0,preventDrag:{dragging:!0}}),await m.tool.createAction({id:`${o.EXTENSIONID}/enter-elevation-mode`,icons:[{icon:"/eyeclosed.svg",label:"Activate Elevation Editor",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`],metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!0,operator:"!="}]}},{icon:"/eyeopen.svg",label:"De-Activate Elevation Editor",filter:{activeTools:[`${o.EXTENSIONID}/vision-tool`],metadata:[{key:[`${o.EXTENSIONID}/elevationEditor`],value:!0,operator:"=="}]}}],onClick:Ee.enterEditMode})}var Ce="top",Ve="bottom",He="right",Le="left",mn="auto",ta=[Ce,Ve,He,Le],Pt="start",Jt="end",kd="clippingParents",Zi="viewport",jt="popper",_d="reference",ri=ta.reduce(function(n,e){return n.concat([e+"-"+Pt,e+"-"+Jt])},[]),Ji=[].concat(ta,[mn]).reduce(function(n,e){return n.concat([e,e+"-"+Pt,e+"-"+Jt])},[]),Cd="beforeRead",Ld="read",Ad="afterRead",Md="beforeMain",$d="main",xd="afterMain",Rd="beforeWrite",Pd="write",Xd="afterWrite",Vd=[Cd,Ld,Ad,Md,$d,xd,Rd,Pd,Xd];function at(n){return n?(n.nodeName||"").toLowerCase():null}function $e(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function St(n){var e=$e(n).Element;return n instanceof e||n instanceof Element}function Xe(n){var e=$e(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function vn(n){if(typeof ShadowRoot>"u")return!1;var e=$e(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function Hd(n){var e=n.state;Object.keys(e.elements).forEach(function(t){var a=e.styles[t]||{},i=e.attributes[t]||{},s=e.elements[t];!Xe(s)||!at(s)||(Object.assign(s.style,a),Object.keys(i).forEach(function(d){var l=i[d];l===!1?s.removeAttribute(d):s.setAttribute(d,l===!0?"":l)}))})}function Fd(n){var e=n.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(a){var i=e.elements[a],s=e.attributes[a]||{},d=Object.keys(e.styles.hasOwnProperty(a)?e.styles[a]:t[a]),l=d.reduce(function(c,f){return c[f]="",c},{});!Xe(i)||!at(i)||(Object.assign(i.style,l),Object.keys(s).forEach(function(c){i.removeAttribute(c)}))})}}const es={name:"applyStyles",enabled:!0,phase:"write",fn:Hd,effect:Fd,requires:["computeStyles"]};function tt(n){return n.split("-")[0]}var Tt=Math.max,ka=Math.min,Xt=Math.round;function on(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function ts(){return!/^((?!chrome|android).)*safari/i.test(on())}function Vt(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var a=n.getBoundingClientRect(),i=1,s=1;e&&Xe(n)&&(i=n.offsetWidth>0&&Xt(a.width)/n.offsetWidth||1,s=n.offsetHeight>0&&Xt(a.height)/n.offsetHeight||1);var d=St(n)?$e(n):window,l=d.visualViewport,c=!ts()&&t,f=(a.left+(c&&l?l.offsetLeft:0))/i,g=(a.top+(c&&l?l.offsetTop:0))/s,y=a.width/i,N=a.height/s;return{width:y,height:N,top:g,right:f+y,bottom:g+N,left:f,x:f,y:g}}function yn(n){var e=Vt(n),t=n.offsetWidth,a=n.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-a)<=1&&(a=e.height),{x:n.offsetLeft,y:n.offsetTop,width:t,height:a}}function as(n,e){var t=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(t&&vn(t)){var a=e;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function ot(n){return $e(n).getComputedStyle(n)}function Bd(n){return["table","td","th"].indexOf(at(n))>=0}function ht(n){return((St(n)?n.ownerDocument:n.document)||window.document).documentElement}function La(n){return at(n)==="html"?n:n.assignedSlot||n.parentNode||(vn(n)?n.host:null)||ht(n)}function oi(n){return!Xe(n)||ot(n).position==="fixed"?null:n.offsetParent}function Ud(n){var e=/firefox/i.test(on()),t=/Trident/i.test(on());if(t&&Xe(n)){var a=ot(n);if(a.position==="fixed")return null}var i=La(n);for(vn(i)&&(i=i.host);Xe(i)&&["html","body"].indexOf(at(i))<0;){var s=ot(i);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return i;i=i.parentNode}return null}function aa(n){for(var e=$e(n),t=oi(n);t&&Bd(t)&&ot(t).position==="static";)t=oi(t);return t&&(at(t)==="html"||at(t)==="body"&&ot(t).position==="static")?e:t||Ud(n)||e}function En(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function qt(n,e,t){return Tt(n,ka(e,t))}function zd(n,e,t){var a=qt(n,e,t);return a>t?t:a}function ns(){return{top:0,right:0,bottom:0,left:0}}function is(n){return Object.assign({},ns(),n)}function ss(n,e){return e.reduce(function(t,a){return t[a]=n,t},{})}var Gd=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,is(typeof e!="number"?e:ss(e,ta))};function jd(n){var e,t=n.state,a=n.name,i=n.options,s=t.elements.arrow,d=t.modifiersData.popperOffsets,l=tt(t.placement),c=En(l),f=[Le,He].indexOf(l)>=0,g=f?"height":"width";if(!(!s||!d)){var y=Gd(i.padding,t),N=yn(s),D=c==="y"?Ce:Le,k=c==="y"?Ve:He,M=t.rects.reference[g]+t.rects.reference[c]-d[c]-t.rects.popper[g],P=d[c]-t.rects.reference[c],F=aa(s),$=F?c==="y"?F.clientHeight||0:F.clientWidth||0:0,G=M/2-P/2,r=y[D],p=$-N[g]-y[k],u=$/2-N[g]/2+G,h=qt(r,u,p),b=c;t.modifiersData[a]=(e={},e[b]=h,e.centerOffset=h-u,e)}}function Wd(n){var e=n.state,t=n.options,a=t.element,i=a===void 0?"[data-popper-arrow]":a;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||as(e.elements.popper,i)&&(e.elements.arrow=i))}const Yd={name:"arrow",enabled:!0,phase:"main",fn:jd,effect:Wd,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ht(n){return n.split("-")[1]}var qd={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Kd(n,e){var t=n.x,a=n.y,i=e.devicePixelRatio||1;return{x:Xt(t*i)/i||0,y:Xt(a*i)/i||0}}function di(n){var e,t=n.popper,a=n.popperRect,i=n.placement,s=n.variation,d=n.offsets,l=n.position,c=n.gpuAcceleration,f=n.adaptive,g=n.roundOffsets,y=n.isFixed,N=d.x,D=N===void 0?0:N,k=d.y,M=k===void 0?0:k,P=typeof g=="function"?g({x:D,y:M}):{x:D,y:M};D=P.x,M=P.y;var F=d.hasOwnProperty("x"),$=d.hasOwnProperty("y"),G=Le,r=Ce,p=window;if(f){var u=aa(t),h="clientHeight",b="clientWidth";if(u===$e(t)&&(u=ht(t),ot(u).position!=="static"&&l==="absolute"&&(h="scrollHeight",b="scrollWidth")),u=u,i===Ce||(i===Le||i===He)&&s===Jt){r=Ve;var E=y&&u===p&&p.visualViewport?p.visualViewport.height:u[h];M-=E-a.height,M*=c?1:-1}if(i===Le||(i===Ce||i===Ve)&&s===Jt){G=He;var I=y&&u===p&&p.visualViewport?p.visualViewport.width:u[b];D-=I-a.width,D*=c?1:-1}}var w=Object.assign({position:l},f&&qd),_=g===!0?Kd({x:D,y:M},$e(t)):{x:D,y:M};if(D=_.x,M=_.y,c){var C;return Object.assign({},w,(C={},C[r]=$?"0":"",C[G]=F?"0":"",C.transform=(p.devicePixelRatio||1)<=1?"translate("+D+"px, "+M+"px)":"translate3d("+D+"px, "+M+"px, 0)",C))}return Object.assign({},w,(e={},e[r]=$?M+"px":"",e[G]=F?D+"px":"",e.transform="",e))}function Qd(n){var e=n.state,t=n.options,a=t.gpuAcceleration,i=a===void 0?!0:a,s=t.adaptive,d=s===void 0?!0:s,l=t.roundOffsets,c=l===void 0?!0:l,f={placement:tt(e.placement),variation:Ht(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,di(Object.assign({},f,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:c})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,di(Object.assign({},f,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Zd={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Qd,data:{}};var pa={passive:!0};function Jd(n){var e=n.state,t=n.instance,a=n.options,i=a.scroll,s=i===void 0?!0:i,d=a.resize,l=d===void 0?!0:d,c=$e(e.elements.popper),f=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&f.forEach(function(g){g.addEventListener("scroll",t.update,pa)}),l&&c.addEventListener("resize",t.update,pa),function(){s&&f.forEach(function(g){g.removeEventListener("scroll",t.update,pa)}),l&&c.removeEventListener("resize",t.update,pa)}}const el={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Jd,data:{}};var tl={left:"right",right:"left",bottom:"top",top:"bottom"};function ya(n){return n.replace(/left|right|bottom|top/g,function(e){return tl[e]})}var al={start:"end",end:"start"};function li(n){return n.replace(/start|end/g,function(e){return al[e]})}function In(n){var e=$e(n),t=e.pageXOffset,a=e.pageYOffset;return{scrollLeft:t,scrollTop:a}}function wn(n){return Vt(ht(n)).left+In(n).scrollLeft}function nl(n,e){var t=$e(n),a=ht(n),i=t.visualViewport,s=a.clientWidth,d=a.clientHeight,l=0,c=0;if(i){s=i.width,d=i.height;var f=ts();(f||!f&&e==="fixed")&&(l=i.offsetLeft,c=i.offsetTop)}return{width:s,height:d,x:l+wn(n),y:c}}function il(n){var e,t=ht(n),a=In(n),i=(e=n.ownerDocument)==null?void 0:e.body,s=Tt(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),d=Tt(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),l=-a.scrollLeft+wn(n),c=-a.scrollTop;return ot(i||t).direction==="rtl"&&(l+=Tt(t.clientWidth,i?i.clientWidth:0)-s),{width:s,height:d,x:l,y:c}}function bn(n){var e=ot(n),t=e.overflow,a=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+a)}function rs(n){return["html","body","#document"].indexOf(at(n))>=0?n.ownerDocument.body:Xe(n)&&bn(n)?n:rs(La(n))}function Kt(n,e){var t;e===void 0&&(e=[]);var a=rs(n),i=a===((t=n.ownerDocument)==null?void 0:t.body),s=$e(a),d=i?[s].concat(s.visualViewport||[],bn(a)?a:[]):a,l=e.concat(d);return i?l:l.concat(Kt(La(d)))}function dn(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function sl(n,e){var t=Vt(n,!1,e==="fixed");return t.top=t.top+n.clientTop,t.left=t.left+n.clientLeft,t.bottom=t.top+n.clientHeight,t.right=t.left+n.clientWidth,t.width=n.clientWidth,t.height=n.clientHeight,t.x=t.left,t.y=t.top,t}function ci(n,e,t){return e===Zi?dn(nl(n,t)):St(e)?sl(e,t):dn(il(ht(n)))}function rl(n){var e=Kt(La(n)),t=["absolute","fixed"].indexOf(ot(n).position)>=0,a=t&&Xe(n)?aa(n):n;return St(a)?e.filter(function(i){return St(i)&&as(i,a)&&at(i)!=="body"}):[]}function ol(n,e,t,a){var i=e==="clippingParents"?rl(n):[].concat(e),s=[].concat(i,[t]),d=s[0],l=s.reduce(function(c,f){var g=ci(n,f,a);return c.top=Tt(g.top,c.top),c.right=ka(g.right,c.right),c.bottom=ka(g.bottom,c.bottom),c.left=Tt(g.left,c.left),c},ci(n,d,a));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function os(n){var e=n.reference,t=n.element,a=n.placement,i=a?tt(a):null,s=a?Ht(a):null,d=e.x+e.width/2-t.width/2,l=e.y+e.height/2-t.height/2,c;switch(i){case Ce:c={x:d,y:e.y-t.height};break;case Ve:c={x:d,y:e.y+e.height};break;case He:c={x:e.x+e.width,y:l};break;case Le:c={x:e.x-t.width,y:l};break;default:c={x:e.x,y:e.y}}var f=i?En(i):null;if(f!=null){var g=f==="y"?"height":"width";switch(s){case Pt:c[f]=c[f]-(e[g]/2-t[g]/2);break;case Jt:c[f]=c[f]+(e[g]/2-t[g]/2);break}}return c}function ea(n,e){e===void 0&&(e={});var t=e,a=t.placement,i=a===void 0?n.placement:a,s=t.strategy,d=s===void 0?n.strategy:s,l=t.boundary,c=l===void 0?kd:l,f=t.rootBoundary,g=f===void 0?Zi:f,y=t.elementContext,N=y===void 0?jt:y,D=t.altBoundary,k=D===void 0?!1:D,M=t.padding,P=M===void 0?0:M,F=is(typeof P!="number"?P:ss(P,ta)),$=N===jt?_d:jt,G=n.rects.popper,r=n.elements[k?$:N],p=ol(St(r)?r:r.contextElement||ht(n.elements.popper),c,g,d),u=Vt(n.elements.reference),h=os({reference:u,element:G,placement:i}),b=dn(Object.assign({},G,h)),E=N===jt?b:u,I={top:p.top-E.top+F.top,bottom:E.bottom-p.bottom+F.bottom,left:p.left-E.left+F.left,right:E.right-p.right+F.right},w=n.modifiersData.offset;if(N===jt&&w){var _=w[i];Object.keys(I).forEach(function(C){var L=[He,Ve].indexOf(C)>=0?1:-1,x=[Ce,Ve].indexOf(C)>=0?"y":"x";I[C]+=_[x]*L})}return I}function dl(n,e){e===void 0&&(e={});var t=e,a=t.placement,i=t.boundary,s=t.rootBoundary,d=t.padding,l=t.flipVariations,c=t.allowedAutoPlacements,f=c===void 0?Ji:c,g=Ht(a),y=g?l?ri:ri.filter(function(k){return Ht(k)===g}):ta,N=y.filter(function(k){return f.indexOf(k)>=0});N.length===0&&(N=y);var D=N.reduce(function(k,M){return k[M]=ea(n,{placement:M,boundary:i,rootBoundary:s,padding:d})[tt(M)],k},{});return Object.keys(D).sort(function(k,M){return D[k]-D[M]})}function ll(n){if(tt(n)===mn)return[];var e=ya(n);return[li(n),e,li(e)]}function cl(n){var e=n.state,t=n.options,a=n.name;if(!e.modifiersData[a]._skip){for(var i=t.mainAxis,s=i===void 0?!0:i,d=t.altAxis,l=d===void 0?!0:d,c=t.fallbackPlacements,f=t.padding,g=t.boundary,y=t.rootBoundary,N=t.altBoundary,D=t.flipVariations,k=D===void 0?!0:D,M=t.allowedAutoPlacements,P=e.options.placement,F=tt(P),$=F===P,G=c||($||!k?[ya(P)]:ll(P)),r=[P].concat(G).reduce(function(de,ee){return de.concat(tt(ee)===mn?dl(e,{placement:ee,boundary:g,rootBoundary:y,padding:f,flipVariations:k,allowedAutoPlacements:M}):ee)},[]),p=e.rects.reference,u=e.rects.popper,h=new Map,b=!0,E=r[0],I=0;I<r.length;I++){var w=r[I],_=tt(w),C=Ht(w)===Pt,L=[Ce,Ve].indexOf(_)>=0,x=L?"width":"height",T=ea(e,{placement:w,boundary:g,rootBoundary:y,altBoundary:N,padding:f}),R=L?C?He:Le:C?Ve:Ce;p[x]>u[x]&&(R=ya(R));var U=ya(R),j=[];if(s&&j.push(T[_]<=0),l&&j.push(T[R]<=0,T[U]<=0),j.every(function(de){return de})){E=w,b=!1;break}h.set(w,j)}if(b)for(var Q=k?3:1,W=function(ee){var ie=r.find(function(le){var A=h.get(le);if(A)return A.slice(0,ee).every(function(H){return H})});if(ie)return E=ie,"break"},J=Q;J>0;J--){var te=W(J);if(te==="break")break}e.placement!==E&&(e.modifiersData[a]._skip=!0,e.placement=E,e.reset=!0)}}const ul={name:"flip",enabled:!0,phase:"main",fn:cl,requiresIfExists:["offset"],data:{_skip:!1}};function ui(n,e,t){return t===void 0&&(t={x:0,y:0}),{top:n.top-e.height-t.y,right:n.right-e.width+t.x,bottom:n.bottom-e.height+t.y,left:n.left-e.width-t.x}}function fi(n){return[Ce,He,Ve,Le].some(function(e){return n[e]>=0})}function fl(n){var e=n.state,t=n.name,a=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,d=ea(e,{elementContext:"reference"}),l=ea(e,{altBoundary:!0}),c=ui(d,a),f=ui(l,i,s),g=fi(c),y=fi(f);e.modifiersData[t]={referenceClippingOffsets:c,popperEscapeOffsets:f,isReferenceHidden:g,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":y})}const pl={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:fl};function hl(n,e,t){var a=tt(n),i=[Le,Ce].indexOf(a)>=0?-1:1,s=typeof t=="function"?t(Object.assign({},e,{placement:n})):t,d=s[0],l=s[1];return d=d||0,l=(l||0)*i,[Le,He].indexOf(a)>=0?{x:l,y:d}:{x:d,y:l}}function gl(n){var e=n.state,t=n.options,a=n.name,i=t.offset,s=i===void 0?[0,0]:i,d=Ji.reduce(function(g,y){return g[y]=hl(y,e.rects,s),g},{}),l=d[e.placement],c=l.x,f=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=f),e.modifiersData[a]=d}const ml={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:gl};function vl(n){var e=n.state,t=n.name;e.modifiersData[t]=os({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const yl={name:"popperOffsets",enabled:!0,phase:"read",fn:vl,data:{}};function El(n){return n==="x"?"y":"x"}function Il(n){var e=n.state,t=n.options,a=n.name,i=t.mainAxis,s=i===void 0?!0:i,d=t.altAxis,l=d===void 0?!1:d,c=t.boundary,f=t.rootBoundary,g=t.altBoundary,y=t.padding,N=t.tether,D=N===void 0?!0:N,k=t.tetherOffset,M=k===void 0?0:k,P=ea(e,{boundary:c,rootBoundary:f,padding:y,altBoundary:g}),F=tt(e.placement),$=Ht(e.placement),G=!$,r=En(F),p=El(r),u=e.modifiersData.popperOffsets,h=e.rects.reference,b=e.rects.popper,E=typeof M=="function"?M(Object.assign({},e.rects,{placement:e.placement})):M,I=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),w=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,_={x:0,y:0};if(u){if(s){var C,L=r==="y"?Ce:Le,x=r==="y"?Ve:He,T=r==="y"?"height":"width",R=u[r],U=R+P[L],j=R-P[x],Q=D?-b[T]/2:0,W=$===Pt?h[T]:b[T],J=$===Pt?-b[T]:-h[T],te=e.elements.arrow,de=D&&te?yn(te):{width:0,height:0},ee=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:ns(),ie=ee[L],le=ee[x],A=qt(0,h[T],de[T]),H=G?h[T]/2-Q-A-ie-I.mainAxis:W-A-ie-I.mainAxis,z=G?-h[T]/2+Q+A+le+I.mainAxis:J+A+le+I.mainAxis,ue=e.elements.arrow&&aa(e.elements.arrow),se=ue?r==="y"?ue.clientTop||0:ue.clientLeft||0:0,ce=(C=w?.[r])!=null?C:0,nt=R+H-ce-se,dt=R+z-ce,gt=qt(D?ka(U,nt):U,R,D?Tt(j,dt):j);u[r]=gt,_[r]=gt-R}if(l){var mt,Nt=r==="x"?Ce:Le,Ot=r==="x"?Ve:He,Fe=u[p],Ye=p==="y"?"height":"width",vt=Fe+P[Nt],it=Fe-P[Ot],lt=[Ce,Le].indexOf(F)!==-1,me=(mt=w?.[p])!=null?mt:0,re=lt?vt:Fe-h[Ye]-b[Ye]-me+I.altAxis,st=lt?Fe+h[Ye]+b[Ye]-me-I.altAxis:it,Dt=D&&lt?zd(re,Fe,st):qt(D?re:vt,Fe,D?st:it);u[p]=Dt,_[p]=Dt-Fe}e.modifiersData[a]=_}}const wl={name:"preventOverflow",enabled:!0,phase:"main",fn:Il,requiresIfExists:["offset"]};function bl(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Tl(n){return n===$e(n)||!Xe(n)?In(n):bl(n)}function Sl(n){var e=n.getBoundingClientRect(),t=Xt(e.width)/n.offsetWidth||1,a=Xt(e.height)/n.offsetHeight||1;return t!==1||a!==1}function Nl(n,e,t){t===void 0&&(t=!1);var a=Xe(e),i=Xe(e)&&Sl(e),s=ht(e),d=Vt(n,i,t),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(a||!a&&!t)&&((at(e)!=="body"||bn(s))&&(l=Tl(e)),Xe(e)?(c=Vt(e,!0),c.x+=e.clientLeft,c.y+=e.clientTop):s&&(c.x=wn(s))),{x:d.left+l.scrollLeft-c.x,y:d.top+l.scrollTop-c.y,width:d.width,height:d.height}}function Ol(n){var e=new Map,t=new Set,a=[];n.forEach(function(s){e.set(s.name,s)});function i(s){t.add(s.name);var d=[].concat(s.requires||[],s.requiresIfExists||[]);d.forEach(function(l){if(!t.has(l)){var c=e.get(l);c&&i(c)}}),a.push(s)}return n.forEach(function(s){t.has(s.name)||i(s)}),a}function Dl(n){var e=Ol(n);return Vd.reduce(function(t,a){return t.concat(e.filter(function(i){return i.phase===a}))},[])}function kl(n){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(n())})})),e}}function _l(n){var e=n.reduce(function(t,a){var i=t[a.name];return t[a.name]=i?Object.assign({},i,a,{options:Object.assign({},i.options,a.options),data:Object.assign({},i.data,a.data)}):a,t},{});return Object.keys(e).map(function(t){return e[t]})}var pi={placement:"bottom",modifiers:[],strategy:"absolute"};function hi(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];return!e.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function Cl(n){n===void 0&&(n={});var e=n,t=e.defaultModifiers,a=t===void 0?[]:t,i=e.defaultOptions,s=i===void 0?pi:i;return function(l,c,f){f===void 0&&(f=s);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},pi,s),modifiersData:{},elements:{reference:l,popper:c},attributes:{},styles:{}},y=[],N=!1,D={state:g,setOptions:function(F){var $=typeof F=="function"?F(g.options):F;M(),g.options=Object.assign({},s,g.options,$),g.scrollParents={reference:St(l)?Kt(l):l.contextElement?Kt(l.contextElement):[],popper:Kt(c)};var G=Dl(_l([].concat(a,g.options.modifiers)));return g.orderedModifiers=G.filter(function(r){return r.enabled}),k(),D.update()},forceUpdate:function(){if(!N){var F=g.elements,$=F.reference,G=F.popper;if(hi($,G)){g.rects={reference:Nl($,aa(G),g.options.strategy==="fixed"),popper:yn(G)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(I){return g.modifiersData[I.name]=Object.assign({},I.data)});for(var r=0;r<g.orderedModifiers.length;r++){if(g.reset===!0){g.reset=!1,r=-1;continue}var p=g.orderedModifiers[r],u=p.fn,h=p.options,b=h===void 0?{}:h,E=p.name;typeof u=="function"&&(g=u({state:g,options:b,name:E,instance:D})||g)}}}},update:kl(function(){return new Promise(function(P){D.forceUpdate(),P(g)})}),destroy:function(){M(),N=!0}};if(!hi(l,c))return D;D.setOptions(f).then(function(P){!N&&f.onFirstUpdate&&f.onFirstUpdate(P)});function k(){g.orderedModifiers.forEach(function(P){var F=P.name,$=P.options,G=$===void 0?{}:$,r=P.effect;if(typeof r=="function"){var p=r({state:g,name:F,instance:D,options:G}),u=function(){};y.push(p||u)}})}function M(){y.forEach(function(P){return P()}),y=[]}return D}}var Ll=[el,yl,Zd,es,ml,ul,wl,Yd,pl],Al=Cl({defaultModifiers:Ll}),Ml="tippy-box",ds="tippy-content",$l="tippy-backdrop",ls="tippy-arrow",cs="tippy-svg-arrow",bt={passive:!0,capture:!0},us=function(){return document.body};function qa(n,e,t){if(Array.isArray(n)){var a=n[e];return a??(Array.isArray(t)?t[e]:t)}return n}function Tn(n,e){var t={}.toString.call(n);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function fs(n,e){return typeof n=="function"?n.apply(void 0,e):n}function gi(n,e){if(e===0)return n;var t;return function(a){clearTimeout(t),t=setTimeout(function(){n(a)},e)}}function xl(n){return n.split(/\s+/).filter(Boolean)}function $t(n){return[].concat(n)}function mi(n,e){n.indexOf(e)===-1&&n.push(e)}function Rl(n){return n.filter(function(e,t){return n.indexOf(e)===t})}function Pl(n){return n.split("-")[0]}function _a(n){return[].slice.call(n)}function vi(n){return Object.keys(n).reduce(function(e,t){return n[t]!==void 0&&(e[t]=n[t]),e},{})}function Qt(){return document.createElement("div")}function Aa(n){return["Element","Fragment"].some(function(e){return Tn(n,e)})}function Xl(n){return Tn(n,"NodeList")}function Vl(n){return Tn(n,"MouseEvent")}function Hl(n){return!!(n&&n._tippy&&n._tippy.reference===n)}function Fl(n){return Aa(n)?[n]:Xl(n)?_a(n):Array.isArray(n)?n:_a(document.querySelectorAll(n))}function Ka(n,e){n.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function yi(n,e){n.forEach(function(t){t&&t.setAttribute("data-state",e)})}function Bl(n){var e,t=$t(n),a=t[0];return a!=null&&(e=a.ownerDocument)!=null&&e.body?a.ownerDocument:document}function Ul(n,e){var t=e.clientX,a=e.clientY;return n.every(function(i){var s=i.popperRect,d=i.popperState,l=i.props,c=l.interactiveBorder,f=Pl(d.placement),g=d.modifiersData.offset;if(!g)return!0;var y=f==="bottom"?g.top.y:0,N=f==="top"?g.bottom.y:0,D=f==="right"?g.left.x:0,k=f==="left"?g.right.x:0,M=s.top-a+y>c,P=a-s.bottom-N>c,F=s.left-t+D>c,$=t-s.right-k>c;return M||P||F||$})}function Qa(n,e,t){var a=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){n[a](i,t)})}function Ei(n,e){for(var t=e;t;){var a;if(n.contains(t))return!0;t=t.getRootNode==null||(a=t.getRootNode())==null?void 0:a.host}return!1}var Qe={isTouch:!1},Ii=0;function zl(){Qe.isTouch||(Qe.isTouch=!0,window.performance&&document.addEventListener("mousemove",ps))}function ps(){var n=performance.now();n-Ii<20&&(Qe.isTouch=!1,document.removeEventListener("mousemove",ps)),Ii=n}function Gl(){var n=document.activeElement;if(Hl(n)){var e=n._tippy;n.blur&&!e.state.isVisible&&n.blur()}}function jl(){document.addEventListener("touchstart",zl,bt),window.addEventListener("blur",Gl)}var Wl=typeof window<"u"&&typeof document<"u",Yl=Wl?!!window.msCrypto:!1,ql={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Kl={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},je=Object.assign({appendTo:us,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},ql,Kl),Ql=Object.keys(je),Zl=function(e){var t=Object.keys(e);t.forEach(function(a){je[a]=e[a]})};function hs(n){var e=n.plugins||[],t=e.reduce(function(a,i){var s=i.name,d=i.defaultValue;if(s){var l;a[s]=n[s]!==void 0?n[s]:(l=je[s])!=null?l:d}return a},{});return Object.assign({},n,t)}function Jl(n,e){var t=e?Object.keys(hs(Object.assign({},je,{plugins:e}))):Ql,a=t.reduce(function(i,s){var d=(n.getAttribute("data-tippy-"+s)||"").trim();if(!d)return i;if(s==="content")i[s]=d;else try{i[s]=JSON.parse(d)}catch{i[s]=d}return i},{});return a}function wi(n,e){var t=Object.assign({},e,{content:fs(e.content,[n])},e.ignoreAttributes?{}:Jl(n,e.plugins));return t.aria=Object.assign({},je.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var ec=function(){return"innerHTML"};function ln(n,e){n[ec()]=e}function bi(n){var e=Qt();return n===!0?e.className=ls:(e.className=cs,Aa(n)?e.appendChild(n):ln(e,n)),e}function Ti(n,e){Aa(e.content)?(ln(n,""),n.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ln(n,e.content):n.textContent=e.content)}function cn(n){var e=n.firstElementChild,t=_a(e.children);return{box:e,content:t.find(function(a){return a.classList.contains(ds)}),arrow:t.find(function(a){return a.classList.contains(ls)||a.classList.contains(cs)}),backdrop:t.find(function(a){return a.classList.contains($l)})}}function gs(n){var e=Qt(),t=Qt();t.className=Ml,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var a=Qt();a.className=ds,a.setAttribute("data-state","hidden"),Ti(a,n.props),e.appendChild(t),t.appendChild(a),i(n.props,n.props);function i(s,d){var l=cn(e),c=l.box,f=l.content,g=l.arrow;d.theme?c.setAttribute("data-theme",d.theme):c.removeAttribute("data-theme"),typeof d.animation=="string"?c.setAttribute("data-animation",d.animation):c.removeAttribute("data-animation"),d.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?c.setAttribute("role",d.role):c.removeAttribute("role"),(s.content!==d.content||s.allowHTML!==d.allowHTML)&&Ti(f,n.props),d.arrow?g?s.arrow!==d.arrow&&(c.removeChild(g),c.appendChild(bi(d.arrow))):c.appendChild(bi(d.arrow)):g&&c.removeChild(g)}return{popper:e,onUpdate:i}}gs.$$tippy=!0;var tc=1,ha=[],Za=[];function ac(n,e){var t=wi(n,Object.assign({},je,hs(vi(e)))),a,i,s,d=!1,l=!1,c=!1,f=!1,g,y,N,D=[],k=gi(nt,t.interactiveDebounce),M,P=tc++,F=null,$=Rl(t.plugins),G={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},r={id:P,reference:n,popper:Qt(),popperInstance:F,props:t,state:G,plugins:$,clearDelayTimeouts:re,setProps:st,setContent:Dt,show:Bt,hide:S,hideWithInteractivity:X,enable:lt,disable:me,unmount:V,destroy:q};if(!t.render)return r;var p=t.render(r),u=p.popper,h=p.onUpdate;u.setAttribute("data-tippy-root",""),u.id="tippy-"+r.id,r.popper=u,n._tippy=r,u._tippy=r;var b=$.map(function(O){return O.fn(r)}),E=n.hasAttribute("aria-expanded");return ue(),Q(),R(),U("onCreate",[r]),t.showOnCreate&&vt(),u.addEventListener("mouseenter",function(){r.props.interactive&&r.state.isVisible&&r.clearDelayTimeouts()}),u.addEventListener("mouseleave",function(){r.props.interactive&&r.props.trigger.indexOf("mouseenter")>=0&&L().addEventListener("mousemove",k)}),r;function I(){var O=r.props.touch;return Array.isArray(O)?O:[O,0]}function w(){return I()[0]==="hold"}function _(){var O;return!!((O=r.props.render)!=null&&O.$$tippy)}function C(){return M||n}function L(){var O=C().parentNode;return O?Bl(O):document}function x(){return cn(u)}function T(O){return r.state.isMounted&&!r.state.isVisible||Qe.isTouch||g&&g.type==="focus"?0:qa(r.props.delay,O?0:1,je.delay)}function R(O){O===void 0&&(O=!1),u.style.pointerEvents=r.props.interactive&&!O?"":"none",u.style.zIndex=""+r.props.zIndex}function U(O,B,Y){if(Y===void 0&&(Y=!0),b.forEach(function(K){K[O]&&K[O].apply(K,B)}),Y){var Z;(Z=r.props)[O].apply(Z,B)}}function j(){var O=r.props.aria;if(O.content){var B="aria-"+O.content,Y=u.id,Z=$t(r.props.triggerTarget||n);Z.forEach(function(K){var oe=K.getAttribute(B);if(r.state.isVisible)K.setAttribute(B,oe?oe+" "+Y:Y);else{var ge=oe&&oe.replace(Y,"").trim();ge?K.setAttribute(B,ge):K.removeAttribute(B)}})}}function Q(){if(!(E||!r.props.aria.expanded)){var O=$t(r.props.triggerTarget||n);O.forEach(function(B){r.props.interactive?B.setAttribute("aria-expanded",r.state.isVisible&&B===C()?"true":"false"):B.removeAttribute("aria-expanded")})}}function W(){L().removeEventListener("mousemove",k),ha=ha.filter(function(O){return O!==k})}function J(O){if(!(Qe.isTouch&&(c||O.type==="mousedown"))){var B=O.composedPath&&O.composedPath()[0]||O.target;if(!(r.props.interactive&&Ei(u,B))){if($t(r.props.triggerTarget||n).some(function(Y){return Ei(Y,B)})){if(Qe.isTouch||r.state.isVisible&&r.props.trigger.indexOf("click")>=0)return}else U("onClickOutside",[r,O]);r.props.hideOnClick===!0&&(r.clearDelayTimeouts(),r.hide(),l=!0,setTimeout(function(){l=!1}),r.state.isMounted||ie())}}}function te(){c=!0}function de(){c=!1}function ee(){var O=L();O.addEventListener("mousedown",J,!0),O.addEventListener("touchend",J,bt),O.addEventListener("touchstart",de,bt),O.addEventListener("touchmove",te,bt)}function ie(){var O=L();O.removeEventListener("mousedown",J,!0),O.removeEventListener("touchend",J,bt),O.removeEventListener("touchstart",de,bt),O.removeEventListener("touchmove",te,bt)}function le(O,B){H(O,function(){!r.state.isVisible&&u.parentNode&&u.parentNode.contains(u)&&B()})}function A(O,B){H(O,B)}function H(O,B){var Y=x().box;function Z(K){K.target===Y&&(Qa(Y,"remove",Z),B())}if(O===0)return B();Qa(Y,"remove",y),Qa(Y,"add",Z),y=Z}function z(O,B,Y){Y===void 0&&(Y=!1);var Z=$t(r.props.triggerTarget||n);Z.forEach(function(K){K.addEventListener(O,B,Y),D.push({node:K,eventType:O,handler:B,options:Y})})}function ue(){w()&&(z("touchstart",ce,{passive:!0}),z("touchend",dt,{passive:!0})),xl(r.props.trigger).forEach(function(O){if(O!=="manual")switch(z(O,ce),O){case"mouseenter":z("mouseleave",dt);break;case"focus":z(Yl?"focusout":"blur",gt);break;case"focusin":z("focusout",gt);break}})}function se(){D.forEach(function(O){var B=O.node,Y=O.eventType,Z=O.handler,K=O.options;B.removeEventListener(Y,Z,K)}),D=[]}function ce(O){var B,Y=!1;if(!(!r.state.isEnabled||mt(O)||l)){var Z=((B=g)==null?void 0:B.type)==="focus";g=O,M=O.currentTarget,Q(),!r.state.isVisible&&Vl(O)&&ha.forEach(function(K){return K(O)}),O.type==="click"&&(r.props.trigger.indexOf("mouseenter")<0||d)&&r.props.hideOnClick!==!1&&r.state.isVisible?Y=!0:vt(O),O.type==="click"&&(d=!Y),Y&&!Z&&it(O)}}function nt(O){var B=O.target,Y=C().contains(B)||u.contains(B);if(!(O.type==="mousemove"&&Y)){var Z=Ye().concat(u).map(function(K){var oe,ge=K._tippy,Se=(oe=ge.popperInstance)==null?void 0:oe.state;return Se?{popperRect:K.getBoundingClientRect(),popperState:Se,props:t}:null}).filter(Boolean);Ul(Z,O)&&(W(),it(O))}}function dt(O){var B=mt(O)||r.props.trigger.indexOf("click")>=0&&d;if(!B){if(r.props.interactive){r.hideWithInteractivity(O);return}it(O)}}function gt(O){r.props.trigger.indexOf("focusin")<0&&O.target!==C()||r.props.interactive&&O.relatedTarget&&u.contains(O.relatedTarget)||it(O)}function mt(O){return Qe.isTouch?w()!==O.type.indexOf("touch")>=0:!1}function Nt(){Ot();var O=r.props,B=O.popperOptions,Y=O.placement,Z=O.offset,K=O.getReferenceClientRect,oe=O.moveTransition,ge=_()?cn(u).arrow:null,Se=K?{getBoundingClientRect:K,contextElement:K.contextElement||C()}:n,Sn={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ia){var kt=ia.state;if(_()){var ms=x(),$a=ms.box;["placement","reference-hidden","escaped"].forEach(function(sa){sa==="placement"?$a.setAttribute("data-placement",kt.placement):kt.attributes.popper["data-popper-"+sa]?$a.setAttribute("data-"+sa,""):$a.removeAttribute("data-"+sa)}),kt.attributes.popper={}}}},yt=[{name:"offset",options:{offset:Z}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!oe}},Sn];_()&&ge&&yt.push({name:"arrow",options:{element:ge,padding:3}}),yt.push.apply(yt,B?.modifiers||[]),r.popperInstance=Al(Se,u,Object.assign({},B,{placement:Y,onFirstUpdate:N,modifiers:yt}))}function Ot(){r.popperInstance&&(r.popperInstance.destroy(),r.popperInstance=null)}function Fe(){var O=r.props.appendTo,B,Y=C();r.props.interactive&&O===us||O==="parent"?B=Y.parentNode:B=fs(O,[Y]),B.contains(u)||B.appendChild(u),r.state.isMounted=!0,Nt()}function Ye(){return _a(u.querySelectorAll("[data-tippy-root]"))}function vt(O){r.clearDelayTimeouts(),O&&U("onTrigger",[r,O]),ee();var B=T(!0),Y=I(),Z=Y[0],K=Y[1];Qe.isTouch&&Z==="hold"&&K&&(B=K),B?a=setTimeout(function(){r.show()},B):r.show()}function it(O){if(r.clearDelayTimeouts(),U("onUntrigger",[r,O]),!r.state.isVisible){ie();return}if(!(r.props.trigger.indexOf("mouseenter")>=0&&r.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(O.type)>=0&&d)){var B=T(!1);B?i=setTimeout(function(){r.state.isVisible&&r.hide()},B):s=requestAnimationFrame(function(){r.hide()})}}function lt(){r.state.isEnabled=!0}function me(){r.hide(),r.state.isEnabled=!1}function re(){clearTimeout(a),clearTimeout(i),cancelAnimationFrame(s)}function st(O){if(!r.state.isDestroyed){U("onBeforeUpdate",[r,O]),se();var B=r.props,Y=wi(n,Object.assign({},B,vi(O),{ignoreAttributes:!0}));r.props=Y,ue(),B.interactiveDebounce!==Y.interactiveDebounce&&(W(),k=gi(nt,Y.interactiveDebounce)),B.triggerTarget&&!Y.triggerTarget?$t(B.triggerTarget).forEach(function(Z){Z.removeAttribute("aria-expanded")}):Y.triggerTarget&&n.removeAttribute("aria-expanded"),Q(),R(),h&&h(B,Y),r.popperInstance&&(Nt(),Ye().forEach(function(Z){requestAnimationFrame(Z._tippy.popperInstance.forceUpdate)})),U("onAfterUpdate",[r,O])}}function Dt(O){r.setProps({content:O})}function Bt(){var O=r.state.isVisible,B=r.state.isDestroyed,Y=!r.state.isEnabled,Z=Qe.isTouch&&!r.props.touch,K=qa(r.props.duration,0,je.duration);if(!(O||B||Y||Z)&&!C().hasAttribute("disabled")&&(U("onShow",[r],!1),r.props.onShow(r)!==!1)){if(r.state.isVisible=!0,_()&&(u.style.visibility="visible"),R(),ee(),r.state.isMounted||(u.style.transition="none"),_()){var oe=x(),ge=oe.box,Se=oe.content;Ka([ge,Se],0)}N=function(){var yt;if(!(!r.state.isVisible||f)){if(f=!0,u.offsetHeight,u.style.transition=r.props.moveTransition,_()&&r.props.animation){var Ma=x(),ia=Ma.box,kt=Ma.content;Ka([ia,kt],K),yi([ia,kt],"visible")}j(),Q(),mi(Za,r),(yt=r.popperInstance)==null||yt.forceUpdate(),U("onMount",[r]),r.props.animation&&_()&&A(K,function(){r.state.isShown=!0,U("onShown",[r])})}},Fe()}}function S(){var O=!r.state.isVisible,B=r.state.isDestroyed,Y=!r.state.isEnabled,Z=qa(r.props.duration,1,je.duration);if(!(O||B||Y)&&(U("onHide",[r],!1),r.props.onHide(r)!==!1)){if(r.state.isVisible=!1,r.state.isShown=!1,f=!1,d=!1,_()&&(u.style.visibility="hidden"),W(),ie(),R(!0),_()){var K=x(),oe=K.box,ge=K.content;r.props.animation&&(Ka([oe,ge],Z),yi([oe,ge],"hidden"))}j(),Q(),r.props.animation?_()&&le(Z,r.unmount):r.unmount()}}function X(O){L().addEventListener("mousemove",k),mi(ha,k),k(O)}function V(){r.state.isVisible&&r.hide(),r.state.isMounted&&(Ot(),Ye().forEach(function(O){O._tippy.unmount()}),u.parentNode&&u.parentNode.removeChild(u),Za=Za.filter(function(O){return O!==r}),r.state.isMounted=!1,U("onHidden",[r]))}function q(){r.state.isDestroyed||(r.clearDelayTimeouts(),r.unmount(),se(),delete n._tippy,r.state.isDestroyed=!0,U("onDestroy",[r]))}}function na(n,e){e===void 0&&(e={});var t=je.plugins.concat(e.plugins||[]);jl();var a=Object.assign({},e,{plugins:t}),i=Fl(n),s=i.reduce(function(d,l){var c=l&&ac(l,a);return c&&d.push(c),d},[]);return Aa(n)?s[0]:s}na.defaultProps=je;na.setDefaultProps=Zl;na.currentInput=Qe;Object.assign({},es,{effect:function(e){var t=e.state,a={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,a.popper),t.styles=a,t.elements.arrow&&Object.assign(t.elements.arrow.style,a.arrow)}});na.setDefaultProps({render:gs});function nc(n,e){const t=document.getElementById(`${n}`);t&&na(t,{content:e,theme:"battlesystem"})}function ic(){const n=new Map;n.set("tip_gmtokens","Note: GM-owned tokens give universal vision."),n.set("visionRangeHeader","Range: How far this token can see. Click to Mass Edit"),n.set("visionFalloffHeader","Falloff: The blurred edge of the vision range. Click to Mass Edit"),n.set("visionBlindHeader","Blind: If this token is temporarily without sight."),n.set("visionHideHeader","Move token to the 'Out-of-Sight' list"),n.set("visionBumperHeader","Collision Distance: How close this token can get to an active wall. Click to Mass Edit"),n.set("visionInAngleHeader","Inner Angle: Inner angle of token vision, for hard edge, match with Outer Angle. Click to Mass Edit"),n.set("visionOutAngleHeader","Outer Angle:  Outer angle of token vision, for hard edge, match with Inner Angle. Click to Mass Edit"),n.set("visionDarkHeader","Greyscale: Add an 'outer-ring' of visible greyscale outside of your vision (Darkvision-Esque). Click to Mass Edit"),n.set("tip_spectretokens","Spectre tokens are only visible to specific players. Enable vision here after it has been Spectred."),n.set("tip_fogfill","Toggle to enable/disable fog fill for the scene."),n.set("tip_disablevision","Toggle to enable/disable vision for all tokens in scene."),n.set("tip_persistence","Toggle to enable/disable persistence vision for tokens. This will leave the map revealed as they travel."),n.set("tip_playerdoors","Toggle to enable/disable players being able to see and use doors on their own."),n.set("tip_ownerrings","Toggle to enable/disable the colored rings seen around a player to indicate their vision radius. GM-Only."),n.set("tip_gridsnap","Toggle to enable/disable grid snapping when drawing Obstruction Lines and Objects. This is separate from the default OBR Snap setting."),n.set("tip_unitcontextmenu","Enable to show the Unit Vision Settings on the Context Menu for tokens"),n.set("tip_wallcontextmenu","Enable to show the Advanced Wall Settings on the Context Menu for Obstructions"),n.set("tip_autohide","Enable to show the Autohide Option on tokens as well as enable Autohide functionality"),n.set("tip_trailingfog","Enable to 'fog' areas that have been revealed by Persistence, but a token is not currently in."),n.set("tip_gmwalls","Toggle to enable/disable the blocking of walls for the GM only."),n.set("tip_defaultelevation","Toggle the Default Elevation Layer. This is the layer a token/wall is set at when it's not on a specific mapping."),n.set("tip_elevationstyle","Toggle to change how Elevations treat walls. Mesa will allow tokens to see over walls at elevations above 0. City will have them all behave the same."),n.set("tip_hardwarewarnings","Toggle to display a warning whenever you or someone in your room may have a Hardware Acceleration issue that would cause fog to display incorrectly.."),n.set("doublewall_button","This will change ALL walls within the scene to be double-sided, so they cannot be passed from either side."),n.set("block_button","This will set all walls to be Blocking walls, so that tokens cannot move past them."),n.set("unblock_button","This will set all walls to be Passable walls, so that tokens can move through them."),n.set("lock_button","This will lock all obstruction lines, so they cannot be accidentally (or purposefully) moved."),n.set("unlock_button","This will unlock all obstruction lines so they can be moved and/or editted."),n.set("reset_persistence","This will reset all persistence on a map, for all players in the room."),n.set("preview_select","This will allow you to view fog as the selected Player would see it."),n.set("tip_visionDefault","Set the default vision distance for new tokens."),n.set("tip_collisionDefault","Set the default collision range for new tokens."),n.set("tip_falloffDefault","Set the default falloff range for new tokens (having this on by default will increase GPU usage)."),n.set("tip_greyscaleDefault","Set the default greyscale vision range (should be higher than token Vision to take effect)."),n.set("tip_innerAngleDefault","Set the default inner angle radius."),n.set("tip_outerAngleDefault","Set the default outer angle radius."),n.forEach((e,t)=>{nc(t,e)})}class sc{static async CenterViewportOnImage(e){const t=v.sceneItems.find(N=>N.id===e),a=await m.scene.grid.getDpi(),i=await m.viewport.getScale(),s=await m.viewport.getWidth(),d=await m.viewport.getHeight(),l={x:s/2,y:d/2},c={x:l.x/i,y:l.y/i},f=await this.GetImageCenter(t,a),g={x:f.x-c.x,y:f.y-c.y},y={x:g.x*i*-1,y:g.y*i*-1};await m.viewport.animateTo({position:y,scale:i})}static async GetImageCenter(e,t){if(Ds(e)){const a=t/e.grid.dpi,i=e.image.width*a,s=e.image.height*a,d=e.grid.offset.x/e.image.width*i,l=e.grid.offset.y/e.image.height*s;return{x:e.position.x-d+i/2,y:e.position.y-l+s/2}}else return Os(e)&&e.points.length>0?{x:e.points[0].x,y:e.points[0].y}:{x:e.position.x,y:e.position.y}}}class Mt{headerName;element;popover;input;checkboxButton;okButton;onSubmitCallback;constructor(e,t,a,i="200px"){const s=document.querySelector(e);if(!s||!(s instanceof HTMLElement))throw new Error(`Element with selector "${e}" not found or is not an HTMLElement`);this.element=s,this.headerName=a,this.onSubmitCallback=t,this.createPopover(i),this.addEventListeners()}createPopover(e){this.popover=document.createElement("div"),this.popover.classList.add("mass-editor-popover"),this.popover.style.width=e,this.input=document.createElement("input"),this.input.type="number",this.input.style.cssText=`
        margin-right: 5px;
        `;const t=document.createElement("div");t.innerText=`Set All ${this.headerName} to`;const a=document.createElement("div");a.style.display="flex",a.style.width="100%",a.style.placeContent="center";const i=document.createElement("div");i.style.display="flex",i.style.width="100%",i.style.placeContent="center",this.okButton=document.createElement("button"),this.okButton.classList.add("popover-button"),this.okButton.textContent="OK",this.okButton.style.width="40px";const s=document.createElement("div");s.style.paddingLeft="4px",s.style.paddingRight="4px",s.textContent="Include Torches:",this.checkboxButton=document.createElement("input"),this.checkboxButton.type="checkbox",this.popover.appendChild(t),this.popover.appendChild(i),this.popover.appendChild(a),i.appendChild(this.input),i.appendChild(this.okButton),a.appendChild(s),a.appendChild(this.checkboxButton),document.body.appendChild(this.popover)}addEventListeners(){this.element.addEventListener("click",this.handleClick.bind(this)),this.okButton.addEventListener("click",this.handleSubmit.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this))}handleClick(e){const t=this.element.getBoundingClientRect(),{left:a,top:i}=this.calculatePopoverPosition(t);this.popover.style.display="block",this.popover.style.left="calc(50% - 100px)",this.popover.style.top=`${i}px`,this.input.focus(),e.stopPropagation()}calculatePopoverPosition(e){const t=this.popover.getBoundingClientRect(),a=window.innerWidth;let i=e.left,s=e.top-t.height-5;return i+t.width>a&&(i=a-t.width-50),s<0&&(s=e.bottom+5),{left:i,top:s}}handleSubmit(){const e=Number(this.input.value),t=this.checkboxButton.checked;isNaN(e)||(this.onSubmitCallback(e,t),this.hidePopover())}handleOutsideClick(e){e.target instanceof Node&&!this.popover.contains(e.target)&&e.target!==this.element&&this.hidePopover()}hidePopover(){this.popover.style.display="none",this.input.value=""}}class rc{mainWindow=document.getElementById("app");smokeViewToggle;spectreViewToggle;settingsViewToggle;helpViewToggle;smokeViewPanel;spectreViewPanel;settingsViewPanel;helpViewPanel;patreonContainer;onVisionPanelMain=!0;visionPanelMain;visionPanelSub;smokeUnitTablePrime;smokeUnitTableSub;tokenList;hiddenList;version;draggedRow=null;constructor(e){this.version=`SMOKEANDSPECTRE-${e}`}async Stop(){await m.action.setHeight(100),await m.action.setWidth(300),this.mainWindow.innerHTML=`
        <div id="stopScreen">
            Awaiting Scene...
        </div>
        `}async Start(){const e=Ms().hasHardwareAcceleration;if(await m.player.setMetadata({[`${o.EXTENSIONID}/hardwareAcceleration`]:e}),e||await m.broadcast.sendMessage(o.WARNINGCASTID,m.player.id,{destination:"REMOTE"}),v.playerRole==="GM"){await m.action.setHeight(530),await m.action.setWidth(420);const a=await m.viewport.getWidth()<400;this.mainWindow.innerHTML=a?o.SMOKEMOBILEMAIN:o.SMOKEMAIN,this.smokeViewToggle=document.getElementById("smokeViewToggle"),this.spectreViewToggle=document.getElementById("spectreViewToggle"),this.settingsViewToggle=document.getElementById("settingsViewToggle"),this.helpViewToggle=document.getElementById("helpViewToggle"),this.smokeViewPanel=document.getElementById("smokeViewPanel"),this.spectreViewPanel=document.getElementById("spectreViewPanel"),this.settingsViewPanel=document.getElementById("settingsViewPanel"),this.helpViewPanel=document.getElementById("helpViewPanel"),this.patreonContainer=document.getElementById("patreonContainer"),this.smokeViewPanel.innerHTML=a?o.SMOKEMOBILEHTML:o.SMOKEHTML,this.spectreViewPanel.innerHTML=o.SPECTREHTML,this.settingsViewPanel.innerHTML=a?o.SETTINGSMOBILEHTML:o.SETTINGSHTML;const i=document.getElementById("playerListing");i.appendChild(this.GetEmptyContextItem("Self"));const s=document.getElementById("preview_select");s.innerHTML="";const d=document.createElement("option");d.value=v.playerId,d.textContent="View As: Self",s.appendChild(d);for(const l of v.party){const c=document.createElement("li");c.id=l.id,c.textContent=l.name,c.style.color=l.color,i.appendChild(c);const f=document.createElement("option");f.value=l.id,f.textContent=`View As: ${l.name}`,f.style.color=l.color,s.appendChild(f)}We.init(),await dd(),this.SetupHelpDocuments(),this.SetupGMPanelHandlers(),await this.UpdateVisionList(),md(a),ni(),Dd(),ic(),await pt.Initialize(),e||await ma(!0),await ma(!1,v.party)}else await m.action.setHeight(300),await m.action.setWidth(300),this.mainWindow.innerHTML=`
                <div id="titleHolder" style="display: flex; width: 100%;">
                    <div style="width:60%;">Tokens You Own</div>
                    <div style="width:30%;">Vision</div>
                    <div style="width:10%;" id="patreonContainer"></div>
                </div>
                <div id="playerView" class="scrollable-table">
                    <table id="playerViewTable">
                    <thead>
                        <tr id="playerViewTableHeader">
                            <th style="width: 70%;"></th>
                            <th style="width: 20%;"></th>
                            <th style="width: 10%;"></th>
                        </tr>
                    </thead>
                        <tbody id="playerViewTableBody">
                        </tbody>
                    </table>
                </div>
            `,this.UpdatePlayerView(),this.patreonContainer=document.getElementById("patreonContainer"),e||await ma(!0);await this.InitializeScene(),this.patreonContainer?.appendChild($s())}UpdatePlayerView(){const e=v.sceneItems.filter(i=>cr(i)),t=document.getElementsByClassName("token-table-entry");this.CleanVisionList(e,t);const a=document.getElementById("playerViewTable");for(const i of e){const s=document.getElementById(`pl-${i.id}`);if(s){const d=s.getElementsByClassName("token-name")[0],l=s.getElementsByClassName("token-aradius")[0],c=s.getElementsByClassName("token-distancetype")[0];d&&(d.textContent=i.text?.plainText||i.name),l&&(l.textContent=i.metadata[`${o.EXTENSIONID}/visionRange`]!==void 0?i.metadata[`${o.EXTENSIONID}/visionRange`]:Ne()),c&&(c.textContent=v.gridUnit)}else{const d=document.createElement("tr");d.id=`pl-${i.id}`,d.classList.add("token-table-entry");const l=document.createElement("td");l.textContent=i.text?.plainText||i.name,l.classList.add("player-token-name"),d.appendChild(l);const c=document.createElement("td");c.textContent=i.metadata[`${o.EXTENSIONID}/visionRange`]!==void 0?i.metadata[`${o.EXTENSIONID}/visionRange`]:Ne(),d.appendChild(c);const f=document.createElement("td");f.textContent=v.gridUnit,d.appendChild(f),a.appendChild(d)}}}GetEmptyContextItem(e){const t=document.createElement("li");return t.id=v.playerId,t.textContent=e,t}SetupGMPanelHandlers(){this.SetupViewPanel(),this.smokeViewToggle.onclick=t=>{t.preventDefault(),e(ne.smokeViewToggle,ne.smokeViewPanel)},this.spectreViewToggle.onclick=t=>{t.preventDefault(),e(ne.spectreViewToggle,ne.spectreViewPanel)},this.settingsViewToggle.onclick=t=>{t.preventDefault(),e(ne.settingsViewToggle,ne.settingsViewPanel)},this.helpViewToggle.onclick=t=>{t.preventDefault(),e(ne.helpViewToggle,ne.helpViewPanel)};function e(t,a){ne.smokeViewToggle?.classList.remove("selected"),ne.spectreViewToggle?.classList.remove("selected"),ne.settingsViewToggle?.classList.remove("selected"),ne.helpViewToggle?.classList.remove("selected"),ne.smokeViewPanel.style.display="none",ne.spectreViewPanel.style.display="none",ne.settingsViewPanel.style.display="none",ne.helpViewPanel.style.display="none",t.classList.add("selected"),a.style.display="block"}}async OnDataChange(){await Ie.Run(),await pt.Run(),v.playerRole==="GM"?(await this.UpdateVisionList(),ni()):this.UpdatePlayerView()}async InitializeScene(){await Ie.Initialize(),await Ie.Run(),await pt.Run(),await Ie.Run()}async UpdateVisionList(){if(!document.getElementById("token_list"))return;const t=v.sceneItems.filter(l=>Ae(l)),a=document.getElementsByClassName("token-table-entry");this.CleanVisionList(t,a);const[i,s]=t.reduce(([l,c],f)=>(f.metadata[`${o.EXTENSIONID}/linkedTo`]!==void 0?l.push(f):c.push(f),[l,c]),[[],[]]);for(const l of s){const c=document.getElementById(`tr-${l.id}`);c?this.UpdateTokenOnVisionList(l,c):this.AddTokenToVisionList(l)}const d=[];for(const l of i){const c=document.getElementById(`tr-${l.id}`);c?this.UpdateTokenOnVisionList(l,c,!0):this.AddTokenToVisionList(l,!0),v.sceneItems.find(g=>g.id===l.metadata[`${o.EXTENSIONID}/linkedTo`])||d.push(l.id)}d.length>0&&await m.scene.items.updateItems(d,l=>{for(let c of l)delete c.metadata[`${o.EXTENSIONID}/linkedTo`]})}SetupDragAndDrop(e){e&&(e.ondragstart=t=>{const a=t.target;if(a.closest("td")?.classList.contains("token-name")){const s=a.closest("tr");if(s&&s.tagName==="TR"){this.draggedRow=s;const d=s.nextElementSibling;if(d&&d.dataset.linkedto&&!this.draggedRow.dataset.linkedto){t.preventDefault();return}s.classList.add("dragging"),t.dataTransfer?.setData("text/plain",s.outerHTML)}}else t.preventDefault()},e.ondragend=()=>{this.draggedRow&&(this.draggedRow.classList.remove("dragging"),this.draggedRow=null)},e.ondragover=t=>{t.preventDefault();const a=t.target;if(a.tagName==="TD"||a.tagName==="TR"){const i=a.closest("tr");i&&this.draggedRow!==i&&i.classList.add("drop-target")}},e.ondragleave=t=>{const i=t.target.closest("tr");i&&i.classList.remove("drop-target")},e.ondrop=async t=>{if(t.preventDefault(),!e)return;const i=t.target.closest("tr");if(i&&this.draggedRow!==i){const s=i.id.slice(3);let d=v.sceneItems.find(l=>l.id===s);if(d&&d.metadata[`${o.EXTENSIONID}/linkedTo`]){const l=d.metadata[`${o.EXTENSIONID}/linkedTo`];d=v.sceneItems.find(c=>c.id===l)}if(this.draggedRow&&d&&i&&this.draggedRow!==i){i.classList.remove("drop-target");const l=e.querySelector("tbody"),c=this.draggedRow.id.slice(3);l.insertBefore(this.draggedRow,i.nextSibling),this.toggleRowVisibility(this.draggedRow,!0),this.draggedRow.dataset.linkedto=d.id,await m.scene.items.updateItems([c],f=>{for(let g of f)g.metadata[`${o.EXTENSIONID}/linkedTo`]=d.id,g.metadata[`${o.EXTENSIONID}/hiddenToken`]=d.metadata[`${o.EXTENSIONID}/hiddenToken`]})}}else if(this.draggedRow){const s=this.draggedRow.id.slice(3);this.toggleRowVisibility(this.draggedRow,!1),delete this.draggedRow.dataset.linkedto,await m.scene.items.updateItems([s],d=>{for(let l of d)delete l.metadata[`${o.EXTENSIONID}/linkedTo`]})}})}SetupMassEditors(){const e=async(l,c)=>{let f=l;l<0&&(f=0),l>999&&(f=999);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionRange`]=f.toString()})},t=async(l,c)=>{let f=l;l<0&&(f=0),l>10&&(f=10);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionFallOff`]=f.toString()})},a=async(l,c)=>{let f=l;l<0&&(f=0),l>999&&(f=999);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionSourceRange`]=f.toString()})},i=async(l,c)=>{let f=l;l<0&&(f=0),l>360&&(f=360);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionInAngle`]=f.toString()})},s=async(l,c)=>{let f=l;l<0&&(f=0),l>360&&(f=360);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionOutAngle`]=f.toString()})},d=async(l,c)=>{let f=l;l<0&&(f=0),l>999&&(f=999);const g=c?v.sceneItems.filter(y=>Ae(y)):v.sceneItems.filter(y=>!_t(y)&&Ae(y));await m.scene.items.updateItems(g.map(y=>y.id),y=>{for(let N of y)N.metadata[`${o.EXTENSIONID}/visionDark`]=f.toString()})};new Mt("#visionRangeSvg",e,"Vision Range"),new Mt("#visionFalloffSvg",t,"Falloff Range"),new Mt("#visionBumperSvg",a,"Collision Range"),new Mt("#visionInnerSvg",i,"Inner Angle"),new Mt("#visionOuterSvg",s,"Outer Angle"),new Mt("#visionDarkSvg",d,"Greyscale")}SetupViewPanel(){const e=document.getElementById("visionPanelToggleContainer");this.visionPanelMain=document.getElementById("visionPanelMain"),this.visionPanelSub=document.getElementById("visionPanelSub"),this.smokeUnitTablePrime=document.getElementById("smokeUnitTablePrime"),this.smokeUnitTableSub=document.getElementById("smokeUnitTableSub"),this.SetupMassEditors(),this.SetupDragAndDrop(this.smokeUnitTablePrime),this.SetupDragAndDrop(this.smokeUnitTableSub);const t=document.createElement("input");t.type="button",t.value="Show Advanced",t.classList.add("view-panel-toggle"),t.onclick=()=>{this.visionPanelMain.style.display=this.onVisionPanelMain?"none":"table-row",this.visionPanelSub.style.display=this.onVisionPanelMain?"table-row":"none";const a=document.getElementsByClassName("vision-panel-main-input"),i=document.getElementsByClassName("vision-panel-sub-input");for(let s=0;s<a.length;s++)this.onVisionPanelMain?this.fadeOut(a[s],()=>this.fadeIn(i[s],"inline-block")):this.fadeOut(i[s],()=>this.fadeIn(a[s],"inline-block"));t.value=this.onVisionPanelMain?"Show Basic":"Show Advanced",this.onVisionPanelMain=!this.onVisionPanelMain},e.appendChild(t)}AddTokenToVisionList(e,t=!1){let a=v.sceneMetadata[`${o.EXTENSIONID}/USER-${e.createdUserId}`],i=a?.color,s=a?.name?`This token is owned by ${a.name}.`:"This token is owned by you.";!i&&e.createdUserId!==v.playerId&&(i="#aeb0af",s="This tokens owner is not in the room currently.");const d=document.getElementById("token_list"),l=document.getElementById("hidden_list"),c=e.metadata[`${o.EXTENSIONID}/isTorch`]===!0,f=document.createElement("tr");f.id=`tr-${e.id}`,f.className="token-table-entry",f.classList.add("slide-row"),f.draggable=!0;const g=document.createElement("td");g.id=`name-${e.id}`,c?(g.innerText=`ğŸ”¦${e.name} `,g.title="This is a torch, which can be seen by other tokens with vision when in range."):(g.innerText=e.name,g.title=s,g.setAttribute("data-color",i),g.style.textShadow=`
                -2px -2px 2px ${i},
                2px -2px 2px ${i},
                -2px 2px 2px ${i},
                2px 2px 2px ${i}`),g.classList.add("token-name"),i==="#aeb0af"&&(g.style.color="black !important",g.style.fontStyle="italic"),g.draggable=!0,g.onclick=async()=>{sc.CenterViewportOnImage(e.id),await m.player.select([e.id])};const y=document.createElement("td"),N=document.createElement("input");N.type="number",N.value=e.metadata[`${o.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionRange`]:Ne(),N.classList.add("token-aradius"),N.classList.add("vision-panel-main-input"),N.style.display=this.onVisionPanelMain?"inline-block":"none",N.draggable=!1,N.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseInt(w.value);_<0&&(w.value="0"),_>999&&(w.value="999"),isNaN(_)&&(w.value=Ne()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionRange`]=w.value})};const D=document.createElement("input");D.type="number",D.style.display="none",D.value=e.metadata[`${o.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionSourceRange`]:Ge(),D.classList.add("token-sradius"),D.classList.add("vision-panel-sub-input"),D.style.display=this.onVisionPanelMain?"none":"inline-block",D.draggable=!1,D.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseFloat(w.value);_<0&&(w.value="0"),_>999&&(w.value="999"),isNaN(_)&&(w.value=Ge()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionSourceRange`]=w.value})},y.appendChild(N),y.appendChild(D);const k=document.createElement("td"),M=document.createElement("input");M.type="number",M.value=e.metadata[`${o.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionFallOff`]:rt(),M.classList.add("token-falloff"),M.classList.add("vision-panel-main-input"),M.style.display=this.onVisionPanelMain?"inline-block":"none",M.draggable=!1,M.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseFloat(w.value);_<0&&(w.value="0"),_>10&&(w.value="10"),isNaN(_)&&(w.value=rt()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionFallOff`]=w.value})};const P=document.createElement("input");P.type="number",P.style.display="none",P.value=e.metadata[`${o.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionInAngle`]:ft(),P.classList.add("token-innerang"),P.classList.add("vision-panel-sub-input"),P.style.display=this.onVisionPanelMain?"none":"inline-block",P.draggable=!1,P.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseInt(w.value);_<0&&(w.value="0"),_>360&&(w.value="360"),isNaN(_)&&(w.value=ft()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionInAngle`]=w.value})},k.appendChild(M),k.appendChild(P);const F=document.createElement("td"),$=document.createElement("input");$.type="checkbox",$.checked=e.metadata[`${o.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionBlind`]:!1,$.classList.add("token-blind"),$.classList.add("vision-panel-main-input"),$.style.display=this.onVisionPanelMain?"inline-block":"none",$.draggable=!1,$.onchange=async E=>{if(!E||!E.target)return;const I=E.target,w=v.sceneItems.find(_=>_.id===e.id);await m.scene.items.updateItems([w.id],_=>{_[0].metadata[`${o.EXTENSIONID}/visionBlind`]=I.checked})};const G=document.createElement("input");G.type="number",G.style.display="none",G.value=e.metadata[`${o.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionOutAngle`]:et(),G.classList.add("token-outerang"),G.classList.add("vision-panel-sub-input"),G.style.display=this.onVisionPanelMain?"none":"inline-block",G.draggable=!1,G.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseInt(w.value);_<0&&(w.value="0"),_>360&&(w.value="360"),isNaN(_)&&(w.value=et()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionOutAngle`]=w.value})},F.appendChild($),F.appendChild(G);const r=document.createElement("td"),p=document.createElement("input");p.type="image",p.src="/swap.svg",p.checked=e.metadata[`${o.EXTENSIONID}/hiddenToken`]!==void 0?e.metadata[`${o.EXTENSIONID}/hiddenToken`]:!1,p.classList.add("token-hide"),p.classList.add("vision-panel-main-input"),p.style.display=this.onVisionPanelMain?"inline-block":"none",p.draggable=!1,p.onclick=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target;w.checked=!w.checked;const _=document.getElementById(`tr-${e.id}`);w.checked?(_.classList.add("slide-out"),setTimeout(()=>{if(_.dataset.linkedto){const L=ne.hiddenList.querySelector(`#tr-${_.dataset.linkedto}`);L&&L.parentNode.insertBefore(_,L.nextSibling)}else ne.hiddenList.prepend(_);_.classList.remove("slide-out"),_.classList.add("slide-in");const C=ne.tokenList.querySelectorAll("tr");if(C.length>0&&!_.dataset.linkedto){const L=Array.from(C).filter(x=>x.dataset.linkedto===e.id);for(const x of L){const T=x.querySelector(".token-hide");T&&T.click()}}setTimeout(async()=>{_.classList.remove("slide-in"),await m.scene.items.updateItems([I.id],L=>{L[0].metadata[`${o.EXTENSIONID}/hiddenToken`]=w.checked})},10)},250)):(_.classList.add("slide-out"),setTimeout(()=>{ne.tokenList.appendChild(_),_.classList.remove("slide-out"),_.classList.add("slide-in");const C=ne.hiddenList.querySelectorAll("tr");if(C.length>0&&!_.dataset.linkedto){const L=Array.from(C).filter(x=>x.dataset.linkedto===e.id);for(const x of L){const T=x.querySelector(".token-hide");T&&T.click()}}setTimeout(async()=>{_.classList.remove("slide-in"),await m.scene.items.updateItems([I.id],L=>{L[0].metadata[`${o.EXTENSIONID}/hiddenToken`]=w.checked})},10)},250))};const u=document.createElement("input");if(u.type="number",u.value=e.metadata[`${o.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionDark`]:wa(),u.classList.add("token-darkvision"),u.classList.add("vision-panel-sub-input"),u.style.display=this.onVisionPanelMain?"none":"inline-block",u.draggable=!1,u.onchange=async E=>{if(!E||!E.target)return;const I=v.sceneItems.find(C=>C.id===e.id),w=E.target,_=parseInt(w.value);_<0&&(w.value="0"),_>999&&(w.value="999"),isNaN(_)&&(w.value=Ne()),await m.scene.items.updateItems([I.id],C=>{C[0].metadata[`${o.EXTENSIONID}/visionDark`]=w.value})},r.appendChild(p),r.appendChild(u),f.appendChild(g),f.appendChild(y),f.appendChild(k),f.appendChild(F),f.appendChild(r),t){const E=e.metadata[`${o.EXTENSIONID}/linkedTo`],I=d.querySelector(`#tr-${E}`)?d:l,w=I.querySelector(`#tr-${E}`);f.dataset.linkedto=E,f.classList.add("linked-row"),w&&(I.insertBefore(f,w.nextSibling),this.toggleRowVisibility(f,!0))}else e.metadata[`${o.EXTENSIONID}/hiddenToken`]===!0?l.prepend(f):d.appendChild(f);f.querySelectorAll("input").forEach(E=>{E.addEventListener("dragstart",I=>{I.stopPropagation()})});function b(){document.getElementById("contextMenu").style.display="none"}f.oncontextmenu=async function(E){E.preventDefault();const I=E.currentTarget,w=document.getElementById("contextMenu"),_=x=>{x.preventDefault()},C=async x=>{const T=[...v.party,{id:v.playerId,color:v.playerColor,name:v.playerName}],R=x.target,U=w.getAttribute("currentUnit"),Q=document.getElementById(`tr-${U}`).getElementsByClassName("token-name")[0],W=T.find(J=>R.id===J.id);if(W){const J=W.name!==v.playerName?`This token is owned by ${W.name}.`:"This token is owned by you.";Q.title=J,Q.setAttribute("data-color",i),Q.style.textShadow=`
                    -2px -2px 2px ${W.color},
                    2px -2px 2px ${W.color},
                    -2px 2px 2px ${W.color},
                    2px 2px 2px ${W.color}`}else Q.title="Unable to update owner name",Q.style.textShadow="";await m.scene.items.updateItems([U],J=>{for(const te of J)te.createdUserId=R.id}),w.style.display="none",x.stopPropagation(),window.removeEventListener("click",L),w.removeEventListener("click",C),w.removeEventListener("contextmenu",_)};w.setAttribute("currentUnit",I.id.substring(3));const L=()=>{w.style.display="none",window.removeEventListener("click",L),w.removeEventListener("click",C),w.removeEventListener("contextmenu",_)};if(w.addEventListener("click",C),w.addEventListener("contextmenu",_),window.addEventListener("click",L),w.style.display=="block")b();else{const T=(document.getElementById("playerListing").children.length+1)*34,R=Math.min(E.pageX,window.innerWidth-150);let U=Math.min(E.pageY,(window.innerHeight>300?window.innerHeight-50:window.innerHeight)-120);window.innerHeight<T+U&&(U=window.innerHeight-T),w.style.display="block",w.style.left=R+"px",w.style.top=U+"px"}}}UpdateTokenOnVisionList(e,t,a=!1){this.toggleRowVisibility(t,a),a?(t.dataset.linkedto||(t.dataset.linkedto=e.metadata[`${o.EXTENSIONID}/linkedTo`]),t.classList.contains("linked-row")||t.classList.add("linked-row")):(t.dataset.linkedto&&delete t.dataset.linkedto,t.classList.contains("linked-row")&&t.classList.remove("linked-row"));const i=v.sceneMetadata[`${o.EXTENSIONID}/USER-${e.createdUserId}`];let s=i?.color,d=i?.name?`This token is owned by ${i.name}.`:"This token is owned by you.";const l=e.metadata[`${o.EXTENSIONID}/isTorch`]===!0;!s&&e.createdUserId!==v.playerId&&(s="#aeb0af",d="This tokens owner is not in the room currently.");const c=t.getElementsByClassName("token-name")[0],f=t.getElementsByClassName("token-aradius")[0],g=t.getElementsByClassName("token-sradius")[0],y=t.getElementsByClassName("token-falloff")[0],N=t.getElementsByClassName("token-innerang")[0],D=t.getElementsByClassName("token-outerang")[0],k=t.getElementsByClassName("token-blind")[0],M=t.getElementsByClassName("token-darkvision")[0];c&&(l?(c.innerText=`ğŸ”¦${e.name} `,c.title="This is a torch, which can be seen by other tokens with vision when in range."):(c.innerText=e.name,c.title=d,c.setAttribute("data-color",s),c.style.textShadow=`
                    -2px -2px 2px ${s},
                    2px -2px 2px ${s},
                    -2px 2px 2px ${s},
                    2px 2px 2px ${s}`)),f&&(f.value=e.metadata[`${o.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionRange`]:Ne()),g&&(g.value=e.metadata[`${o.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionSourceRange`]:Ge()),y&&(y.value=e.metadata[`${o.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionFallOff`]:rt()),N&&(N.value=e.metadata[`${o.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionInAngle`]:ft()),D&&(D.value=e.metadata[`${o.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionOutAngle`]:et()),k&&(k.checked=e.metadata[`${o.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionBlind`]:!1),M&&(M.value=e.metadata[`${o.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${o.EXTENSIONID}/visionDark`]:wa())}CleanVisionList(e,t){for(const a of t){const i=a.id.slice(3);e.some(s=>s.id===i)||a.remove()}}SetupHelpDocuments(){const t=new Ns.Converter().makeHtml(o.MARKDOWNHELP),a=document.getElementById("markdownHelpContainer");a.innerHTML=t}fadeOut=(e,t)=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none",t()},300)};fadeIn=(e,t)=>{e.style.opacity="0",e.style.display=t,setTimeout(()=>{e.style.opacity="1"},10)};toggleRowVisibility=(e,t)=>{t?e.classList.add("linked-row"):e.classList.remove("linked-row"),e.querySelectorAll("td").forEach(i=>{i.classList.contains("token-name")?i.style.textIndent=t?"20px":"0px":i.style.visibility=t?"hidden":"visible"})}}const ne=new rc("3.60");m.onReady(async()=>{const n=await m.scene.isReady(),e=document.getElementById("papp"),t=document.getElementById("contextmenu");if(!(e||t))if(n===!1){const a=m.scene.onReadyChange(async i=>{i&&(a(),await Si())})}else await Si()});async function Si(){await v.InitializeCache(),v.SetupHandlers(),await ne.Start()}export{v as B};
