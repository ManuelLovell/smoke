import{C as d,b as be,O as T,a as bn,c as sn,d as Gi,e as Wi,f as oa,g as qi,h as Ki,i as Mt,j as Yi,k as Qi}from"./bsConstants-CMRxC4u1.js";/* empty css              */const Be=(()=>{/*!
* Copyright (c) 2021-2024 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.24.0
* NPM: https://github.com/melloware/coloris-npm
*/return((a,e,t,n)=>{const r=e.createElement("canvas").getContext("2d"),o={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let s,l,c,h,v,E,N,D,S,V,z,H,L,W,i,f,u={};const p={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>n,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},y={};let m="",g={},b=!1;function $(_){if(typeof _=="object")for(const x in _)switch(x){case"el":A(_.el),_.wrap!==!1&&Y(_.el);break;case"parent":s=_.parent instanceof HTMLElement?_.parent:e.querySelector(_.parent),s&&(s.appendChild(l),p.parent=_.parent,s===e.body&&(s=n));break;case"themeMode":p.themeMode=_.themeMode,_.themeMode==="auto"&&a.matchMedia&&a.matchMedia("(prefers-color-scheme: dark)").matches&&(p.themeMode="dark");case"theme":_.theme&&(p.theme=_.theme),l.className="clr-picker clr-"+p.theme+" clr-"+p.themeMode,p.inline&&U();break;case"rtl":p.rtl=!!_.rtl,Array.from(e.getElementsByClassName("clr-field")).forEach(O=>O.classList.toggle("clr-rtl",p.rtl));break;case"margin":_.margin*=1,p.margin=isNaN(_.margin)?p.margin:_.margin;break;case"wrap":_.el&&_.wrap&&Y(_.el);break;case"formatToggle":p.formatToggle=!!_.formatToggle,fe("clr-format").style.display=p.formatToggle?"block":"none",p.formatToggle&&(p.format="auto");break;case"swatches":if(Array.isArray(_.swatches)){const O=fe("clr-swatches"),B=e.createElement("div");O.textContent="",_.swatches.forEach((G,Z)=>{const K=e.createElement("button");K.setAttribute("type","button"),K.setAttribute("id","clr-swatch-"+Z),K.setAttribute("aria-labelledby","clr-swatch-label clr-swatch-"+Z),K.style.color=G,K.textContent=G,B.appendChild(K)}),_.swatches.length&&O.appendChild(B),p.swatches=_.swatches.slice()}break;case"swatchesOnly":p.swatchesOnly=!!_.swatchesOnly,l.setAttribute("data-minimal",p.swatchesOnly);break;case"alpha":p.alpha=!!_.alpha,l.setAttribute("data-alpha",p.alpha);break;case"inline":if(p.inline=!!_.inline,l.setAttribute("data-inline",p.inline),p.inline){const O=_.defaultColor||p.defaultColor;W=Q(O),U(),ee(O)}break;case"clearButton":typeof _.clearButton=="object"&&(_.clearButton.label&&(p.clearLabel=_.clearButton.label,N.innerHTML=p.clearLabel),_.clearButton=_.clearButton.show),p.clearButton=!!_.clearButton,N.style.display=p.clearButton?"block":"none";break;case"clearLabel":p.clearLabel=_.clearLabel,N.innerHTML=p.clearLabel;break;case"closeButton":p.closeButton=!!_.closeButton,p.closeButton?l.insertBefore(D,v):v.appendChild(D);break;case"closeLabel":p.closeLabel=_.closeLabel,D.innerHTML=p.closeLabel;break;case"a11y":const X=_.a11y;let q=!1;if(typeof X=="object")for(const O in X)X[O]&&p.a11y[O]&&(p.a11y[O]=X[O],q=!0);if(q){const O=fe("clr-open-label"),B=fe("clr-swatch-label");O.innerHTML=p.a11y.open,B.innerHTML=p.a11y.swatch,D.setAttribute("aria-label",p.a11y.close),N.setAttribute("aria-label",p.a11y.clear),S.setAttribute("aria-label",p.a11y.hueSlider),z.setAttribute("aria-label",p.a11y.alphaSlider),E.setAttribute("aria-label",p.a11y.input),c.setAttribute("aria-label",p.a11y.instruction)}break;default:p[x]=_[x]}}function C(_,x){typeof _=="string"&&typeof x=="object"&&(y[_]=x,b=!0)}function M(_){delete y[_],Object.keys(y).length===0&&(b=!1,_===m&&I())}function P(_){if(b){const x=["el","wrap","rtl","inline","defaultColor","a11y"];for(let X in y){const q=y[X];if(_.matches(X)){m=X,g={},x.forEach(O=>delete q[O]);for(let O in q)g[O]=Array.isArray(p[O])?p[O].slice():p[O];$(q);break}}}}function I(){Object.keys(g).length>0&&($(g),m="",g={})}function A(_){_ instanceof HTMLElement&&(_=[_]),Array.isArray(_)?_.forEach(x=>{ae(x,"click",j),ae(x,"input",R)}):(ae(e,"click",_,j),ae(e,"input",_,R))}function j(_){p.inline||(P(_.target),L=_.target,i=L.value,W=Q(i),l.classList.add("clr-open"),U(),ee(i),(p.focusInput||p.selectInput)&&(E.focus({preventScroll:!0}),E.setSelectionRange(L.selectionStart,L.selectionEnd)),p.selectInput&&E.select(),(f||p.swatchesOnly)&&Ze().shift().focus(),L.dispatchEvent(new Event("open",{bubbles:!0})))}function U(){if(!l||!L&&!p.inline)return;const _=s,x=a.scrollY,X=l.offsetWidth,q=l.offsetHeight,O={left:!1,top:!1};let B,G,Z,K={x:0,y:0};if(_&&(B=a.getComputedStyle(_),G=parseFloat(B.marginTop),Z=parseFloat(B.borderTopWidth),K=_.getBoundingClientRect(),K.y+=Z+x),!p.inline){const ie=L.getBoundingClientRect();let ue=ie.x,Ee=x+ie.y+ie.height+p.margin;_?(ue-=K.x,Ee-=K.y,ue+X>_.clientWidth&&(ue+=ie.width-X,O.left=!0),Ee+q>_.clientHeight-G&&q+p.margin<=ie.top-(K.y-x)&&(Ee-=ie.height+q+p.margin*2,O.top=!0),Ee+=_.scrollTop):(ue+X>e.documentElement.clientWidth&&(ue+=ie.width-X,O.left=!0),Ee+q-x>e.documentElement.clientHeight&&q+p.margin<=ie.top&&(Ee=x+ie.y-q-p.margin,O.top=!0)),l.classList.toggle("clr-left",O.left),l.classList.toggle("clr-top",O.top),l.style.left=ue+"px",l.style.top=Ee+"px",K.x+=l.offsetLeft,K.y+=l.offsetTop}u={width:c.offsetWidth,height:c.offsetHeight,x:c.offsetLeft+K.x,y:c.offsetTop+K.y}}function Y(_){_ instanceof HTMLElement?k(_):Array.isArray(_)?_.forEach(k):e.querySelectorAll(_).forEach(k)}function k(_){const x=_.parentNode;if(!x.classList.contains("clr-field")){const X=e.createElement("div");let q="clr-field";(p.rtl||_.classList.contains("clr-rtl"))&&(q+=" clr-rtl"),X.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',x.insertBefore(X,_),X.className=q,X.style.color=_.value,X.appendChild(_)}}function R(_){const x=_.target.parentNode;x.classList.contains("clr-field")&&(x.style.color=_.target.value)}function F(_){if(L&&!p.inline){const x=L;_&&(L=n,i!==x.value&&(x.value=i,x.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(()=>{i!==x.value&&x.dispatchEvent(new Event("change",{bubbles:!0}))}),l.classList.remove("clr-open"),b&&I(),x.dispatchEvent(new Event("close",{bubbles:!0})),p.focusInput&&x.focus({preventScroll:!0}),L=n}}function ee(_){const x=gt(_),X=ht(x);oe(X.s,X.v),ke(x,X),S.value=X.h,l.style.color="hsl("+X.h+", 100%, 50%)",V.style.left=X.h/360*100+"%",h.style.left=u.width*X.s/100+"px",h.style.top=u.height-u.height*X.v/100+"px",z.value=X.a*100,H.style.left=X.a*100+"%"}function Q(_){const x=_.substring(0,3).toLowerCase();return x==="rgb"||x==="hsl"?x:"hex"}function J(_){_=_!==n?_:E.value,L&&(L.value=_,L.dispatchEvent(new Event("input",{bubbles:!0}))),p.onChange&&p.onChange.call(a,_,L),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:_,currentEl:L}}))}function de(_,x){const X={h:S.value*1,s:_/u.width*100,v:100-x/u.height*100,a:z.value/100},q=at(X);oe(X.s,X.v),ke(q,X),J()}function oe(_,x){let X=p.a11y.marker;_=_.toFixed(1)*1,x=x.toFixed(1)*1,X=X.replace("{s}",_),X=X.replace("{v}",x),h.setAttribute("aria-label",X)}function Le(_){return{pageX:_.changedTouches?_.changedTouches[0].pageX:_.pageX,pageY:_.changedTouches?_.changedTouches[0].pageY:_.pageY}}function ce(_){const x=Le(_);let X=x.pageX-u.x,q=x.pageY-u.y;s&&(q+=s.scrollTop),xe(X,q),_.preventDefault(),_.stopPropagation()}function Re(_,x){let X=h.style.left.replace("px","")*1+_,q=h.style.top.replace("px","")*1+x;xe(X,q)}function xe(_,x){_=_<0?0:_>u.width?u.width:_,x=x<0?0:x>u.height?u.height:x,h.style.left=_+"px",h.style.top=x+"px",de(_,x),h.focus()}function ke(_,x){_===void 0&&(_={}),x===void 0&&(x={});let X=p.format;for(const B in _)o[B]=_[B];for(const B in x)o[B]=x[B];const q=Xe(o),O=q.substring(0,7);switch(h.style.color=O,H.parentNode.style.color=O,H.style.color=q,v.style.color=q,c.style.display="none",c.offsetHeight,c.style.display="",H.nextElementSibling.style.display="none",H.nextElementSibling.offsetHeight,H.nextElementSibling.style.display="",X==="mixed"?X=o.a===1?"hex":"rgb":X==="auto"&&(X=W),X){case"hex":E.value=q;break;case"rgb":E.value=Fe(o);break;case"hsl":E.value=rt(it(o));break}e.querySelector('.clr-format [value="'+X+'"]').checked=!0}function ft(){const _=S.value*1,x=h.style.left.replace("px","")*1,X=h.style.top.replace("px","")*1;l.style.color="hsl("+_+", 100%, 50%)",V.style.left=_/360*100+"%",de(x,X)}function pt(){const _=z.value/100;H.style.left=_*100+"%",ke({a:_}),J()}function at(_){const x=_.s/100,X=_.v/100;let q=x*X,O=_.h/60,B=q*(1-t.abs(O%2-1)),G=X-q;q=q+G,B=B+G;const Z=t.floor(O)%6,K=[q,B,G,G,B,q][Z],ie=[B,q,q,B,G,G][Z],ue=[G,G,B,q,q,B][Z];return{r:t.round(K*255),g:t.round(ie*255),b:t.round(ue*255),a:_.a}}function it(_){const x=_.v/100,X=x*(1-_.s/100/2);let q;return X>0&&X<1&&(q=t.round((x-X)/t.min(X,1-X)*100)),{h:_.h,s:q||0,l:t.round(X*100),a:_.a}}function ht(_){const x=_.r/255,X=_.g/255,q=_.b/255,O=t.max(x,X,q),B=t.min(x,X,q),G=O-B,Z=O;let K=0,ie=0;return G&&(O===x&&(K=(X-q)/G),O===X&&(K=2+(q-x)/G),O===q&&(K=4+(x-X)/G),O&&(ie=G/O)),K=t.floor(K*60),{h:K<0?K+360:K,s:t.round(ie*100),v:t.round(Z*100),a:_.a}}function gt(_){const x=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let X,q;return r.fillStyle="#000",r.fillStyle=_,X=x.exec(r.fillStyle),X?q={r:X[3]*1,g:X[4]*1,b:X[5]*1,a:X[6]*1}:(X=r.fillStyle.replace("#","").match(/.{2}/g).map(O=>parseInt(O,16)),q={r:X[0],g:X[1],b:X[2],a:1}),q}function Xe(_){let x=_.r.toString(16),X=_.g.toString(16),q=_.b.toString(16),O="";if(_.r<16&&(x="0"+x),_.g<16&&(X="0"+X),_.b<16&&(q="0"+q),p.alpha&&(_.a<1||p.forceAlpha)){const B=_.a*255|0;O=B.toString(16),B<16&&(O="0"+O)}return"#"+x+X+q+O}function Fe(_){return!p.alpha||_.a===1&&!p.forceAlpha?"rgb("+_.r+", "+_.g+", "+_.b+")":"rgba("+_.r+", "+_.g+", "+_.b+", "+_.a+")"}function rt(_){return!p.alpha||_.a===1&&!p.forceAlpha?"hsl("+_.h+", "+_.s+"%, "+_.l+"%)":"hsla("+_.h+", "+_.s+"%, "+_.l+"%, "+_.a+")"}function qe(){e.getElementById("clr-picker")||(s=n,l=e.createElement("div"),l.setAttribute("id","clr-picker"),l.className="clr-picker",l.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+p.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+p.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+p.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+p.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+p.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+p.a11y.clear+'">'+p.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+p.a11y.close+'">'+p.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+p.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+p.a11y.swatch+"</span>"),e.body.appendChild(l),c=fe("clr-color-area"),h=fe("clr-color-marker"),N=fe("clr-clear"),D=fe("clr-close"),v=fe("clr-color-preview"),E=fe("clr-color-value"),S=fe("clr-hue-slider"),V=fe("clr-hue-marker"),z=fe("clr-alpha-slider"),H=fe("clr-alpha-marker"),A(p.el),Y(p.el),ae(l,"mousedown",_=>{l.classList.remove("clr-keyboard-nav"),_.stopPropagation()}),ae(c,"mousedown",_=>{ae(e,"mousemove",ce)}),ae(c,"contextmenu",_=>{_.preventDefault()}),ae(c,"touchstart",_=>{e.addEventListener("touchmove",ce,{passive:!1})}),ae(h,"mousedown",_=>{ae(e,"mousemove",ce)}),ae(h,"touchstart",_=>{e.addEventListener("touchmove",ce,{passive:!1})}),ae(E,"change",_=>{const x=E.value;if(L||p.inline){const X=x===""?x:ee(x);J(X)}}),ae(N,"click",_=>{J(""),F()}),ae(D,"click",_=>{J(),F()}),ae(fe("clr-format"),"click",".clr-format input",_=>{W=_.target.value,ke(),J()}),ae(l,"click",".clr-swatches button",_=>{ee(_.target.textContent),J(),p.swatchesOnly&&F()}),ae(e,"mouseup",_=>{e.removeEventListener("mousemove",ce)}),ae(e,"touchend",_=>{e.removeEventListener("touchmove",ce)}),ae(e,"mousedown",_=>{f=!1,l.classList.remove("clr-keyboard-nav"),F()}),ae(e,"keydown",_=>{const x=_.key,X=_.target,q=_.shiftKey;if(x==="Escape"?F(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(x)&&(f=!0,l.classList.add("clr-keyboard-nav")),x==="Tab"&&X.matches(".clr-picker *")){const B=Ze(),G=B.shift(),Z=B.pop();q&&X===G?(Z.focus(),_.preventDefault()):!q&&X===Z&&(G.focus(),_.preventDefault())}}),ae(e,"click",".clr-field button",_=>{b&&I(),_.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),ae(h,"keydown",_=>{const x={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(x).includes(_.key)&&(Re(...x[_.key]),_.preventDefault())}),ae(c,"click",ce),ae(S,"input",ft),ae(z,"input",pt))}function Ze(){return Array.from(l.querySelectorAll("input, button")).filter(X=>!!X.offsetWidth)}function fe(_){return e.getElementById(_)}function ae(_,x,X,q){const O=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof X=="string"?_.addEventListener(x,B=>{O.call(B.target,X)&&q.call(B.target,B)}):(q=X,_.addEventListener(x,q))}function Ke(_,x){x=x!==n?x:[],e.readyState!=="loading"?_(...x):e.addEventListener("DOMContentLoaded",()=>{_(...x)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function mt(_,x){L=x,i=L.value,P(x),W=Q(_),U(),ee(_),J(),i!==_&&L.dispatchEvent(new Event("change",{bubbles:!0}))}const At=(()=>{const _={init:qe,set:$,wrap:Y,close:F,setInstance:C,setColor:mt,removeInstance:M,updatePosition:U,ready:Ke};function x(X){Ke(()=>{X&&(typeof X=="string"?A(X):$(X))})}for(const X in _)x[X]=function(){for(var q=arguments.length,O=new Array(q),B=0;B<q;B++)O[B]=arguments[B];Ke(_[X],O)};return Ke(()=>{a.addEventListener("resize",X=>{x.updatePosition()}),a.addEventListener("scroll",X=>{x.updatePosition()})}),x})();return At.coloris=At,At})(window,document,Math)})();Be.coloris;Be.init;Be.set;Be.wrap;Be.close;Be.setInstance;Be.removeInstance;Be.updatePosition;var Ji=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zi(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Ka={exports:{}};(function(a){(function(){function e(i){var f={omitExtraWLInCodeBlocks:{defaultValue:!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{defaultValue:!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{defaultValue:!1,describe:"Add a prefix to the generated header ids. Passing a string will prefix that string to the header id. Setting to true will add a generic 'section-' prefix",type:"string"},rawPrefixHeaderId:{defaultValue:!1,describe:'Setting this option to true will prevent showdown from modifying the prefix. This might result in malformed IDs (if, for instance, the " char is used in the prefix)',type:"boolean"},ghCompatibleHeaderId:{defaultValue:!1,describe:"Generate header ids compatible with github style (spaces are replaced with dashes, a bunch of non alphanumeric chars are removed)",type:"boolean"},rawHeaderId:{defaultValue:!1,describe:`Remove only spaces, ' and " from generated header ids (including prefixes), replacing them with dashes (-). WARNING: This might result in malformed ids`,type:"boolean"},headerLevelStart:{defaultValue:!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{defaultValue:!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{defaultValue:!1,describe:"Turn on/off GFM autolink style",type:"boolean"},excludeTrailingPunctuationFromURLs:{defaultValue:!1,describe:"Excludes trailing punctuation from links generated with autoLinking",type:"boolean"},literalMidWordUnderscores:{defaultValue:!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},literalMidWordAsterisks:{defaultValue:!1,describe:"Parse midword asterisks as literal asterisks",type:"boolean"},strikethrough:{defaultValue:!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{defaultValue:!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{defaultValue:!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{defaultValue:!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{defaultValue:!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{defaultValue:!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"},smartIndentationFix:{defaultValue:!1,describe:"Tries to smartly fix indentation in es6 strings",type:"boolean"},disableForced4SpacesIndentedSublists:{defaultValue:!1,describe:"Disables the requirement of indenting nested sublists by 4 spaces",type:"boolean"},simpleLineBreaks:{defaultValue:!1,describe:"Parses simple line breaks as <br> (GFM Style)",type:"boolean"},requireSpaceBeforeHeadingText:{defaultValue:!1,describe:"Makes adding a space between `#` and the header text mandatory (GFM Style)",type:"boolean"},ghMentions:{defaultValue:!1,describe:"Enables github @mentions",type:"boolean"},ghMentionsLink:{defaultValue:"https://github.com/{u}",describe:"Changes the link generated by @mentions. Only applies if ghMentions option is enabled.",type:"string"},encodeEmails:{defaultValue:!0,describe:"Encode e-mail addresses through the use of Character Entities, transforming ASCII e-mail addresses into its equivalent decimal entities",type:"boolean"},openLinksInNewWindow:{defaultValue:!1,describe:"Open all links in new windows",type:"boolean"},backslashEscapesHTMLTags:{defaultValue:!1,describe:"Support for HTML Tag escaping. ex: <div>foo</div>",type:"boolean"},emoji:{defaultValue:!1,describe:"Enable emoji support. Ex: `this is a :smile: emoji`",type:"boolean"},underline:{defaultValue:!1,describe:"Enable support for underline. Syntax is double or triple underscores: `__underline word__`. With this option enabled, underscores no longer parses into `<em>` and `<strong>`",type:"boolean"},ellipsis:{defaultValue:!0,describe:"Replaces three dots with the ellipsis unicode character",type:"boolean"},completeHTMLDocument:{defaultValue:!1,describe:"Outputs a complete html document, including `<html>`, `<head>` and `<body>` tags",type:"boolean"},metadata:{defaultValue:!1,describe:"Enable support for document metadata (defined at the top of the document between `Â«Â«Â«` and `Â»Â»Â»` or between `---` and `---`).",type:"boolean"},splitAdjacentBlockquotes:{defaultValue:!1,describe:"Split adjacent blockquote blocks",type:"boolean"}};if(i===!1)return JSON.parse(JSON.stringify(f));var u={};for(var p in f)f.hasOwnProperty(p)&&(u[p]=f[p].defaultValue);return u}function t(){var i=e(!0),f={};for(var u in i)i.hasOwnProperty(u)&&(f[u]=!0);return f}var n={},r={},o={},s=e(!0),l="vanilla",c={github:{omitExtraWLInCodeBlocks:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,disableForced4SpacesIndentedSublists:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghCompatibleHeaderId:!0,ghMentions:!0,backslashEscapesHTMLTags:!0,emoji:!0,splitAdjacentBlockquotes:!0},original:{noHeaderId:!0,ghCodeBlocks:!1},ghost:{omitExtraWLInCodeBlocks:!0,parseImgDimensions:!0,simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0,smoothLivePreview:!0,simpleLineBreaks:!0,requireSpaceBeforeHeadingText:!0,ghMentions:!1,encodeEmails:!0},vanilla:e(!0),allOn:t()};n.helper={},n.extensions={},n.setOption=function(i,f){return s[i]=f,this},n.getOption=function(i){return s[i]},n.getOptions=function(){return s},n.resetOptions=function(){s=e(!0)},n.setFlavor=function(i){if(!c.hasOwnProperty(i))throw Error(i+" flavor was not found");n.resetOptions();var f=c[i];l=i;for(var u in f)f.hasOwnProperty(u)&&(s[u]=f[u])},n.getFlavor=function(){return l},n.getFlavorOptions=function(i){if(c.hasOwnProperty(i))return c[i]},n.getDefaultOptions=function(i){return e(i)},n.subParser=function(i,f){if(n.helper.isString(i))if(typeof f<"u")r[i]=f;else{if(r.hasOwnProperty(i))return r[i];throw Error("SubParser named "+i+" not registered!")}},n.extension=function(i,f){if(!n.helper.isString(i))throw Error("Extension 'name' must be a string");if(i=n.helper.stdExtName(i),n.helper.isUndefined(f)){if(!o.hasOwnProperty(i))throw Error("Extension named "+i+" is not registered!");return o[i]}else{typeof f=="function"&&(f=f()),n.helper.isArray(f)||(f=[f]);var u=h(f,i);if(u.valid)o[i]=f;else throw Error(u.error)}},n.getAllExtensions=function(){return o},n.removeExtension=function(i){delete o[i]},n.resetExtensions=function(){o={}};function h(i,f){var u=f?"Error in "+f+" extension->":"Error in unnamed extension",p={valid:!0,error:""};n.helper.isArray(i)||(i=[i]);for(var y=0;y<i.length;++y){var m=u+" sub-extension "+y+": ",g=i[y];if(typeof g!="object")return p.valid=!1,p.error=m+"must be an object, but "+typeof g+" given",p;if(!n.helper.isString(g.type))return p.valid=!1,p.error=m+'property "type" must be a string, but '+typeof g.type+" given",p;var b=g.type=g.type.toLowerCase();if(b==="language"&&(b=g.type="lang"),b==="html"&&(b=g.type="output"),b!=="lang"&&b!=="output"&&b!=="listener")return p.valid=!1,p.error=m+"type "+b+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',p;if(b==="listener"){if(n.helper.isUndefined(g.listeners))return p.valid=!1,p.error=m+'. Extensions of type "listener" must have a property called "listeners"',p}else if(n.helper.isUndefined(g.filter)&&n.helper.isUndefined(g.regex))return p.valid=!1,p.error=m+b+' extensions must define either a "regex" property or a "filter" method',p;if(g.listeners){if(typeof g.listeners!="object")return p.valid=!1,p.error=m+'"listeners" property must be an object but '+typeof g.listeners+" given",p;for(var $ in g.listeners)if(g.listeners.hasOwnProperty($)&&typeof g.listeners[$]!="function")return p.valid=!1,p.error=m+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+$+" must be a function but "+typeof g.listeners[$]+" given",p}if(g.filter){if(typeof g.filter!="function")return p.valid=!1,p.error=m+'"filter" must be a function, but '+typeof g.filter+" given",p}else if(g.regex){if(n.helper.isString(g.regex)&&(g.regex=new RegExp(g.regex,"g")),!(g.regex instanceof RegExp))return p.valid=!1,p.error=m+'"regex" property must either be a string or a RegExp object, but '+typeof g.regex+" given",p;if(n.helper.isUndefined(g.replace))return p.valid=!1,p.error=m+'"regex" extensions must implement a replace string or function',p}}return p}n.validateExtension=function(i){var f=h(i,null);return f.valid?!0:(console.warn(f.error),!1)},n.hasOwnProperty("helper")||(n.helper={}),n.helper.isString=function(i){return typeof i=="string"||i instanceof String},n.helper.isFunction=function(i){var f={};return i&&f.toString.call(i)==="[object Function]"},n.helper.isArray=function(i){return Array.isArray(i)},n.helper.isUndefined=function(i){return typeof i>"u"},n.helper.forEach=function(i,f){if(n.helper.isUndefined(i))throw new Error("obj param is required");if(n.helper.isUndefined(f))throw new Error("callback param is required");if(!n.helper.isFunction(f))throw new Error("callback param must be a function/closure");if(typeof i.forEach=="function")i.forEach(f);else if(n.helper.isArray(i))for(var u=0;u<i.length;u++)f(i[u],u,i);else if(typeof i=="object")for(var p in i)i.hasOwnProperty(p)&&f(i[p],p,i);else throw new Error("obj does not seem to be an array or an iterable object")},n.helper.stdExtName=function(i){return i.replace(/[_?*+\/\\.^-]/g,"").replace(/\s/g,"").toLowerCase()};function v(i,f){var u=f.charCodeAt(0);return"Â¨E"+u+"E"}n.helper.escapeCharactersCallback=v,n.helper.escapeCharacters=function(i,f,u){var p="(["+f.replace(/([\[\]\\])/g,"\\$1")+"])";u&&(p="\\\\"+p);var y=new RegExp(p,"g");return i=i.replace(y,v),i},n.helper.unescapeHTMLEntities=function(i){return i.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")};var E=function(i,f,u,p){var y=p||"",m=y.indexOf("g")>-1,g=new RegExp(f+"|"+u,"g"+y.replace(/g/g,"")),b=new RegExp(f,y.replace(/g/g,"")),$=[],C,M,P,I,A;do for(C=0;P=g.exec(i);)if(b.test(P[0]))C++||(M=g.lastIndex,I=M-P[0].length);else if(C&&!--C){A=P.index+P[0].length;var j={left:{start:I,end:M},match:{start:M,end:P.index},right:{start:P.index,end:A},wholeMatch:{start:I,end:A}};if($.push(j),!m)return $}while(C&&(g.lastIndex=M));return $};n.helper.matchRecursiveRegExp=function(i,f,u,p){for(var y=E(i,f,u,p),m=[],g=0;g<y.length;++g)m.push([i.slice(y[g].wholeMatch.start,y[g].wholeMatch.end),i.slice(y[g].match.start,y[g].match.end),i.slice(y[g].left.start,y[g].left.end),i.slice(y[g].right.start,y[g].right.end)]);return m},n.helper.replaceRecursiveRegExp=function(i,f,u,p,y){if(!n.helper.isFunction(f)){var m=f;f=function(){return m}}var g=E(i,u,p,y),b=i,$=g.length;if($>0){var C=[];g[0].wholeMatch.start!==0&&C.push(i.slice(0,g[0].wholeMatch.start));for(var M=0;M<$;++M)C.push(f(i.slice(g[M].wholeMatch.start,g[M].wholeMatch.end),i.slice(g[M].match.start,g[M].match.end),i.slice(g[M].left.start,g[M].left.end),i.slice(g[M].right.start,g[M].right.end))),M<$-1&&C.push(i.slice(g[M].wholeMatch.end,g[M+1].wholeMatch.start));g[$-1].wholeMatch.end<i.length&&C.push(i.slice(g[$-1].wholeMatch.end)),b=C.join("")}return b},n.helper.regexIndexOf=function(i,f,u){if(!n.helper.isString(i))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";if(!(f instanceof RegExp))throw"InvalidArgumentError: second parameter of showdown.helper.regexIndexOf function must be an instance of RegExp";var p=i.substring(u||0).search(f);return p>=0?p+(u||0):p},n.helper.splitAtIndex=function(i,f){if(!n.helper.isString(i))throw"InvalidArgumentError: first parameter of showdown.helper.regexIndexOf function must be a string";return[i.substring(0,f),i.substring(f)]},n.helper.encodeEmailAddress=function(i){var f=[function(u){return"&#"+u.charCodeAt(0)+";"},function(u){return"&#x"+u.charCodeAt(0).toString(16)+";"},function(u){return u}];return i=i.replace(/./g,function(u){if(u==="@")u=f[Math.floor(Math.random()*2)](u);else{var p=Math.random();u=p>.9?f[2](u):p>.45?f[1](u):f[0](u)}return u}),i},n.helper.padEnd=function(f,u,p){return u=u>>0,p=String(p||" "),f.length>u?String(f):(u=u-f.length,u>p.length&&(p+=p.repeat(u/p.length)),String(f)+p.slice(0,u))},typeof console>"u"&&(console={warn:function(i){alert(i)},log:function(i){alert(i)},error:function(i){throw i}}),n.helper.regexes={asteriskDashAndColon:/([*_:~])/g},n.helper.emojis={"+1":"ğŸ‘","-1":"ğŸ‘",100:"ğŸ’¯",1234:"ğŸ”¢","1st_place_medal":"ğŸ¥‡","2nd_place_medal":"ğŸ¥ˆ","3rd_place_medal":"ğŸ¥‰","8ball":"ğŸ±",a:"ğŸ…°ï¸",ab:"ğŸ†",abc:"ğŸ”¤",abcd:"ğŸ”¡",accept:"ğŸ‰‘",aerial_tramway:"ğŸš¡",airplane:"âœˆï¸",alarm_clock:"â°",alembic:"âš—ï¸",alien:"ğŸ‘½",ambulance:"ğŸš‘",amphora:"ğŸº",anchor:"âš“ï¸",angel:"ğŸ‘¼",anger:"ğŸ’¢",angry:"ğŸ˜ ",anguished:"ğŸ˜§",ant:"ğŸœ",apple:"ğŸ",aquarius:"â™’ï¸",aries:"â™ˆï¸",arrow_backward:"â—€ï¸",arrow_double_down:"â¬",arrow_double_up:"â«",arrow_down:"â¬‡ï¸",arrow_down_small:"ğŸ”½",arrow_forward:"â–¶ï¸",arrow_heading_down:"â¤µï¸",arrow_heading_up:"â¤´ï¸",arrow_left:"â¬…ï¸",arrow_lower_left:"â†™ï¸",arrow_lower_right:"â†˜ï¸",arrow_right:"â¡ï¸",arrow_right_hook:"â†ªï¸",arrow_up:"â¬†ï¸",arrow_up_down:"â†•ï¸",arrow_up_small:"ğŸ”¼",arrow_upper_left:"â†–ï¸",arrow_upper_right:"â†—ï¸",arrows_clockwise:"ğŸ”ƒ",arrows_counterclockwise:"ğŸ”„",art:"ğŸ¨",articulated_lorry:"ğŸš›",artificial_satellite:"ğŸ›°",astonished:"ğŸ˜²",athletic_shoe:"ğŸ‘Ÿ",atm:"ğŸ§",atom_symbol:"âš›ï¸",avocado:"ğŸ¥‘",b:"ğŸ…±ï¸",baby:"ğŸ‘¶",baby_bottle:"ğŸ¼",baby_chick:"ğŸ¤",baby_symbol:"ğŸš¼",back:"ğŸ”™",bacon:"ğŸ¥“",badminton:"ğŸ¸",baggage_claim:"ğŸ›„",baguette_bread:"ğŸ¥–",balance_scale:"âš–ï¸",balloon:"ğŸˆ",ballot_box:"ğŸ—³",ballot_box_with_check:"â˜‘ï¸",bamboo:"ğŸ",banana:"ğŸŒ",bangbang:"â€¼ï¸",bank:"ğŸ¦",bar_chart:"ğŸ“Š",barber:"ğŸ’ˆ",baseball:"âš¾ï¸",basketball:"ğŸ€",basketball_man:"â›¹ï¸",basketball_woman:"â›¹ï¸&zwj;â™€ï¸",bat:"ğŸ¦‡",bath:"ğŸ›€",bathtub:"ğŸ›",battery:"ğŸ”‹",beach_umbrella:"ğŸ–",bear:"ğŸ»",bed:"ğŸ›",bee:"ğŸ",beer:"ğŸº",beers:"ğŸ»",beetle:"ğŸ",beginner:"ğŸ”°",bell:"ğŸ””",bellhop_bell:"ğŸ›",bento:"ğŸ±",biking_man:"ğŸš´",bike:"ğŸš²",biking_woman:"ğŸš´&zwj;â™€ï¸",bikini:"ğŸ‘™",biohazard:"â˜£ï¸",bird:"ğŸ¦",birthday:"ğŸ‚",black_circle:"âš«ï¸",black_flag:"ğŸ´",black_heart:"ğŸ–¤",black_joker:"ğŸƒ",black_large_square:"â¬›ï¸",black_medium_small_square:"â—¾ï¸",black_medium_square:"â—¼ï¸",black_nib:"âœ’ï¸",black_small_square:"â–ªï¸",black_square_button:"ğŸ”²",blonde_man:"ğŸ‘±",blonde_woman:"ğŸ‘±&zwj;â™€ï¸",blossom:"ğŸŒ¼",blowfish:"ğŸ¡",blue_book:"ğŸ“˜",blue_car:"ğŸš™",blue_heart:"ğŸ’™",blush:"ğŸ˜Š",boar:"ğŸ—",boat:"â›µï¸",bomb:"ğŸ’£",book:"ğŸ“–",bookmark:"ğŸ”–",bookmark_tabs:"ğŸ“‘",books:"ğŸ“š",boom:"ğŸ’¥",boot:"ğŸ‘¢",bouquet:"ğŸ’",bowing_man:"ğŸ™‡",bow_and_arrow:"ğŸ¹",bowing_woman:"ğŸ™‡&zwj;â™€ï¸",bowling:"ğŸ³",boxing_glove:"ğŸ¥Š",boy:"ğŸ‘¦",bread:"ğŸ",bride_with_veil:"ğŸ‘°",bridge_at_night:"ğŸŒ‰",briefcase:"ğŸ’¼",broken_heart:"ğŸ’”",bug:"ğŸ›",building_construction:"ğŸ—",bulb:"ğŸ’¡",bullettrain_front:"ğŸš…",bullettrain_side:"ğŸš„",burrito:"ğŸŒ¯",bus:"ğŸšŒ",business_suit_levitating:"ğŸ•´",busstop:"ğŸš",bust_in_silhouette:"ğŸ‘¤",busts_in_silhouette:"ğŸ‘¥",butterfly:"ğŸ¦‹",cactus:"ğŸŒµ",cake:"ğŸ°",calendar:"ğŸ“†",call_me_hand:"ğŸ¤™",calling:"ğŸ“²",camel:"ğŸ«",camera:"ğŸ“·",camera_flash:"ğŸ“¸",camping:"ğŸ•",cancer:"â™‹ï¸",candle:"ğŸ•¯",candy:"ğŸ¬",canoe:"ğŸ›¶",capital_abcd:"ğŸ” ",capricorn:"â™‘ï¸",car:"ğŸš—",card_file_box:"ğŸ—ƒ",card_index:"ğŸ“‡",card_index_dividers:"ğŸ—‚",carousel_horse:"ğŸ ",carrot:"ğŸ¥•",cat:"ğŸ±",cat2:"ğŸˆ",cd:"ğŸ’¿",chains:"â›“",champagne:"ğŸ¾",chart:"ğŸ’¹",chart_with_downwards_trend:"ğŸ“‰",chart_with_upwards_trend:"ğŸ“ˆ",checkered_flag:"ğŸ",cheese:"ğŸ§€",cherries:"ğŸ’",cherry_blossom:"ğŸŒ¸",chestnut:"ğŸŒ°",chicken:"ğŸ”",children_crossing:"ğŸš¸",chipmunk:"ğŸ¿",chocolate_bar:"ğŸ«",christmas_tree:"ğŸ„",church:"â›ªï¸",cinema:"ğŸ¦",circus_tent:"ğŸª",city_sunrise:"ğŸŒ‡",city_sunset:"ğŸŒ†",cityscape:"ğŸ™",cl:"ğŸ†‘",clamp:"ğŸ—œ",clap:"ğŸ‘",clapper:"ğŸ¬",classical_building:"ğŸ›",clinking_glasses:"ğŸ¥‚",clipboard:"ğŸ“‹",clock1:"ğŸ•",clock10:"ğŸ•™",clock1030:"ğŸ•¥",clock11:"ğŸ•š",clock1130:"ğŸ•¦",clock12:"ğŸ•›",clock1230:"ğŸ•§",clock130:"ğŸ•œ",clock2:"ğŸ•‘",clock230:"ğŸ•",clock3:"ğŸ•’",clock330:"ğŸ•",clock4:"ğŸ•“",clock430:"ğŸ•Ÿ",clock5:"ğŸ•”",clock530:"ğŸ• ",clock6:"ğŸ••",clock630:"ğŸ•¡",clock7:"ğŸ•–",clock730:"ğŸ•¢",clock8:"ğŸ•—",clock830:"ğŸ•£",clock9:"ğŸ•˜",clock930:"ğŸ•¤",closed_book:"ğŸ“•",closed_lock_with_key:"ğŸ”",closed_umbrella:"ğŸŒ‚",cloud:"â˜ï¸",cloud_with_lightning:"ğŸŒ©",cloud_with_lightning_and_rain:"â›ˆ",cloud_with_rain:"ğŸŒ§",cloud_with_snow:"ğŸŒ¨",clown_face:"ğŸ¤¡",clubs:"â™£ï¸",cocktail:"ğŸ¸",coffee:"â˜•ï¸",coffin:"âš°ï¸",cold_sweat:"ğŸ˜°",comet:"â˜„ï¸",computer:"ğŸ’»",computer_mouse:"ğŸ–±",confetti_ball:"ğŸŠ",confounded:"ğŸ˜–",confused:"ğŸ˜•",congratulations:"ãŠ—ï¸",construction:"ğŸš§",construction_worker_man:"ğŸ‘·",construction_worker_woman:"ğŸ‘·&zwj;â™€ï¸",control_knobs:"ğŸ›",convenience_store:"ğŸª",cookie:"ğŸª",cool:"ğŸ†’",policeman:"ğŸ‘®",copyright:"Â©ï¸",corn:"ğŸŒ½",couch_and_lamp:"ğŸ›‹",couple:"ğŸ‘«",couple_with_heart_woman_man:"ğŸ’‘",couple_with_heart_man_man:"ğŸ‘¨&zwj;â¤ï¸&zwj;ğŸ‘¨",couple_with_heart_woman_woman:"ğŸ‘©&zwj;â¤ï¸&zwj;ğŸ‘©",couplekiss_man_man:"ğŸ‘¨&zwj;â¤ï¸&zwj;ğŸ’‹&zwj;ğŸ‘¨",couplekiss_man_woman:"ğŸ’",couplekiss_woman_woman:"ğŸ‘©&zwj;â¤ï¸&zwj;ğŸ’‹&zwj;ğŸ‘©",cow:"ğŸ®",cow2:"ğŸ„",cowboy_hat_face:"ğŸ¤ ",crab:"ğŸ¦€",crayon:"ğŸ–",credit_card:"ğŸ’³",crescent_moon:"ğŸŒ™",cricket:"ğŸ",crocodile:"ğŸŠ",croissant:"ğŸ¥",crossed_fingers:"ğŸ¤",crossed_flags:"ğŸŒ",crossed_swords:"âš”ï¸",crown:"ğŸ‘‘",cry:"ğŸ˜¢",crying_cat_face:"ğŸ˜¿",crystal_ball:"ğŸ”®",cucumber:"ğŸ¥’",cupid:"ğŸ’˜",curly_loop:"â°",currency_exchange:"ğŸ’±",curry:"ğŸ›",custard:"ğŸ®",customs:"ğŸ›ƒ",cyclone:"ğŸŒ€",dagger:"ğŸ—¡",dancer:"ğŸ’ƒ",dancing_women:"ğŸ‘¯",dancing_men:"ğŸ‘¯&zwj;â™‚ï¸",dango:"ğŸ¡",dark_sunglasses:"ğŸ•¶",dart:"ğŸ¯",dash:"ğŸ’¨",date:"ğŸ“…",deciduous_tree:"ğŸŒ³",deer:"ğŸ¦Œ",department_store:"ğŸ¬",derelict_house:"ğŸš",desert:"ğŸœ",desert_island:"ğŸ",desktop_computer:"ğŸ–¥",male_detective:"ğŸ•µï¸",diamond_shape_with_a_dot_inside:"ğŸ’ ",diamonds:"â™¦ï¸",disappointed:"ğŸ˜",disappointed_relieved:"ğŸ˜¥",dizzy:"ğŸ’«",dizzy_face:"ğŸ˜µ",do_not_litter:"ğŸš¯",dog:"ğŸ¶",dog2:"ğŸ•",dollar:"ğŸ’µ",dolls:"ğŸ",dolphin:"ğŸ¬",door:"ğŸšª",doughnut:"ğŸ©",dove:"ğŸ•Š",dragon:"ğŸ‰",dragon_face:"ğŸ²",dress:"ğŸ‘—",dromedary_camel:"ğŸª",drooling_face:"ğŸ¤¤",droplet:"ğŸ’§",drum:"ğŸ¥",duck:"ğŸ¦†",dvd:"ğŸ“€","e-mail":"ğŸ“§",eagle:"ğŸ¦…",ear:"ğŸ‘‚",ear_of_rice:"ğŸŒ¾",earth_africa:"ğŸŒ",earth_americas:"ğŸŒ",earth_asia:"ğŸŒ",egg:"ğŸ¥š",eggplant:"ğŸ†",eight_pointed_black_star:"âœ´ï¸",eight_spoked_asterisk:"âœ³ï¸",electric_plug:"ğŸ”Œ",elephant:"ğŸ˜",email:"âœ‰ï¸",end:"ğŸ”š",envelope_with_arrow:"ğŸ“©",euro:"ğŸ’¶",european_castle:"ğŸ°",european_post_office:"ğŸ¤",evergreen_tree:"ğŸŒ²",exclamation:"â—ï¸",expressionless:"ğŸ˜‘",eye:"ğŸ‘",eye_speech_bubble:"ğŸ‘&zwj;ğŸ—¨",eyeglasses:"ğŸ‘“",eyes:"ğŸ‘€",face_with_head_bandage:"ğŸ¤•",face_with_thermometer:"ğŸ¤’",fist_oncoming:"ğŸ‘Š",factory:"ğŸ­",fallen_leaf:"ğŸ‚",family_man_woman_boy:"ğŸ‘ª",family_man_boy:"ğŸ‘¨&zwj;ğŸ‘¦",family_man_boy_boy:"ğŸ‘¨&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_girl:"ğŸ‘¨&zwj;ğŸ‘§",family_man_girl_boy:"ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_girl_girl:"ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘§",family_man_man_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘¦",family_man_man_boy_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_man_girl:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§",family_man_man_girl_boy:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_man_girl_girl:"ğŸ‘¨&zwj;ğŸ‘¨&zwj;ğŸ‘§&zwj;ğŸ‘§",family_man_woman_boy_boy:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_man_woman_girl:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§",family_man_woman_girl_boy:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_man_woman_girl_girl:"ğŸ‘¨&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",family_woman_boy:"ğŸ‘©&zwj;ğŸ‘¦",family_woman_boy_boy:"ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_woman_girl:"ğŸ‘©&zwj;ğŸ‘§",family_woman_girl_boy:"ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_woman_girl_girl:"ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",family_woman_woman_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘¦",family_woman_woman_boy_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘¦&zwj;ğŸ‘¦",family_woman_woman_girl:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§",family_woman_woman_girl_boy:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘¦",family_woman_woman_girl_girl:"ğŸ‘©&zwj;ğŸ‘©&zwj;ğŸ‘§&zwj;ğŸ‘§",fast_forward:"â©",fax:"ğŸ“ ",fearful:"ğŸ˜¨",feet:"ğŸ¾",female_detective:"ğŸ•µï¸&zwj;â™€ï¸",ferris_wheel:"ğŸ¡",ferry:"â›´",field_hockey:"ğŸ‘",file_cabinet:"ğŸ—„",file_folder:"ğŸ“",film_projector:"ğŸ“½",film_strip:"ğŸ",fire:"ğŸ”¥",fire_engine:"ğŸš’",fireworks:"ğŸ†",first_quarter_moon:"ğŸŒ“",first_quarter_moon_with_face:"ğŸŒ›",fish:"ğŸŸ",fish_cake:"ğŸ¥",fishing_pole_and_fish:"ğŸ£",fist_raised:"âœŠ",fist_left:"ğŸ¤›",fist_right:"ğŸ¤œ",flags:"ğŸ",flashlight:"ğŸ”¦",fleur_de_lis:"âšœï¸",flight_arrival:"ğŸ›¬",flight_departure:"ğŸ›«",floppy_disk:"ğŸ’¾",flower_playing_cards:"ğŸ´",flushed:"ğŸ˜³",fog:"ğŸŒ«",foggy:"ğŸŒ",football:"ğŸˆ",footprints:"ğŸ‘£",fork_and_knife:"ğŸ´",fountain:"â›²ï¸",fountain_pen:"ğŸ–‹",four_leaf_clover:"ğŸ€",fox_face:"ğŸ¦Š",framed_picture:"ğŸ–¼",free:"ğŸ†“",fried_egg:"ğŸ³",fried_shrimp:"ğŸ¤",fries:"ğŸŸ",frog:"ğŸ¸",frowning:"ğŸ˜¦",frowning_face:"â˜¹ï¸",frowning_man:"ğŸ™&zwj;â™‚ï¸",frowning_woman:"ğŸ™",middle_finger:"ğŸ–•",fuelpump:"â›½ï¸",full_moon:"ğŸŒ•",full_moon_with_face:"ğŸŒ",funeral_urn:"âš±ï¸",game_die:"ğŸ²",gear:"âš™ï¸",gem:"ğŸ’",gemini:"â™Šï¸",ghost:"ğŸ‘»",gift:"ğŸ",gift_heart:"ğŸ’",girl:"ğŸ‘§",globe_with_meridians:"ğŸŒ",goal_net:"ğŸ¥…",goat:"ğŸ",golf:"â›³ï¸",golfing_man:"ğŸŒï¸",golfing_woman:"ğŸŒï¸&zwj;â™€ï¸",gorilla:"ğŸ¦",grapes:"ğŸ‡",green_apple:"ğŸ",green_book:"ğŸ“—",green_heart:"ğŸ’š",green_salad:"ğŸ¥—",grey_exclamation:"â•",grey_question:"â”",grimacing:"ğŸ˜¬",grin:"ğŸ˜",grinning:"ğŸ˜€",guardsman:"ğŸ’‚",guardswoman:"ğŸ’‚&zwj;â™€ï¸",guitar:"ğŸ¸",gun:"ğŸ”«",haircut_woman:"ğŸ’‡",haircut_man:"ğŸ’‡&zwj;â™‚ï¸",hamburger:"ğŸ”",hammer:"ğŸ”¨",hammer_and_pick:"âš’",hammer_and_wrench:"ğŸ› ",hamster:"ğŸ¹",hand:"âœ‹",handbag:"ğŸ‘œ",handshake:"ğŸ¤",hankey:"ğŸ’©",hatched_chick:"ğŸ¥",hatching_chick:"ğŸ£",headphones:"ğŸ§",hear_no_evil:"ğŸ™‰",heart:"â¤ï¸",heart_decoration:"ğŸ’Ÿ",heart_eyes:"ğŸ˜",heart_eyes_cat:"ğŸ˜»",heartbeat:"ğŸ’“",heartpulse:"ğŸ’—",hearts:"â™¥ï¸",heavy_check_mark:"âœ”ï¸",heavy_division_sign:"â—",heavy_dollar_sign:"ğŸ’²",heavy_heart_exclamation:"â£ï¸",heavy_minus_sign:"â–",heavy_multiplication_x:"âœ–ï¸",heavy_plus_sign:"â•",helicopter:"ğŸš",herb:"ğŸŒ¿",hibiscus:"ğŸŒº",high_brightness:"ğŸ”†",high_heel:"ğŸ‘ ",hocho:"ğŸ”ª",hole:"ğŸ•³",honey_pot:"ğŸ¯",horse:"ğŸ´",horse_racing:"ğŸ‡",hospital:"ğŸ¥",hot_pepper:"ğŸŒ¶",hotdog:"ğŸŒ­",hotel:"ğŸ¨",hotsprings:"â™¨ï¸",hourglass:"âŒ›ï¸",hourglass_flowing_sand:"â³",house:"ğŸ ",house_with_garden:"ğŸ¡",houses:"ğŸ˜",hugs:"ğŸ¤—",hushed:"ğŸ˜¯",ice_cream:"ğŸ¨",ice_hockey:"ğŸ’",ice_skate:"â›¸",icecream:"ğŸ¦",id:"ğŸ†”",ideograph_advantage:"ğŸ‰",imp:"ğŸ‘¿",inbox_tray:"ğŸ“¥",incoming_envelope:"ğŸ“¨",tipping_hand_woman:"ğŸ’",information_source:"â„¹ï¸",innocent:"ğŸ˜‡",interrobang:"â‰ï¸",iphone:"ğŸ“±",izakaya_lantern:"ğŸ®",jack_o_lantern:"ğŸƒ",japan:"ğŸ—¾",japanese_castle:"ğŸ¯",japanese_goblin:"ğŸ‘º",japanese_ogre:"ğŸ‘¹",jeans:"ğŸ‘–",joy:"ğŸ˜‚",joy_cat:"ğŸ˜¹",joystick:"ğŸ•¹",kaaba:"ğŸ•‹",key:"ğŸ”‘",keyboard:"âŒ¨ï¸",keycap_ten:"ğŸ”Ÿ",kick_scooter:"ğŸ›´",kimono:"ğŸ‘˜",kiss:"ğŸ’‹",kissing:"ğŸ˜—",kissing_cat:"ğŸ˜½",kissing_closed_eyes:"ğŸ˜š",kissing_heart:"ğŸ˜˜",kissing_smiling_eyes:"ğŸ˜™",kiwi_fruit:"ğŸ¥",koala:"ğŸ¨",koko:"ğŸˆ",label:"ğŸ·",large_blue_circle:"ğŸ”µ",large_blue_diamond:"ğŸ”·",large_orange_diamond:"ğŸ”¶",last_quarter_moon:"ğŸŒ—",last_quarter_moon_with_face:"ğŸŒœ",latin_cross:"âœï¸",laughing:"ğŸ˜†",leaves:"ğŸƒ",ledger:"ğŸ“’",left_luggage:"ğŸ›…",left_right_arrow:"â†”ï¸",leftwards_arrow_with_hook:"â†©ï¸",lemon:"ğŸ‹",leo:"â™Œï¸",leopard:"ğŸ†",level_slider:"ğŸš",libra:"â™ï¸",light_rail:"ğŸšˆ",link:"ğŸ”—",lion:"ğŸ¦",lips:"ğŸ‘„",lipstick:"ğŸ’„",lizard:"ğŸ¦",lock:"ğŸ”’",lock_with_ink_pen:"ğŸ”",lollipop:"ğŸ­",loop:"â¿",loud_sound:"ğŸ”Š",loudspeaker:"ğŸ“¢",love_hotel:"ğŸ©",love_letter:"ğŸ’Œ",low_brightness:"ğŸ”…",lying_face:"ğŸ¤¥",m:"â“‚ï¸",mag:"ğŸ”",mag_right:"ğŸ”",mahjong:"ğŸ€„ï¸",mailbox:"ğŸ“«",mailbox_closed:"ğŸ“ª",mailbox_with_mail:"ğŸ“¬",mailbox_with_no_mail:"ğŸ“­",man:"ğŸ‘¨",man_artist:"ğŸ‘¨&zwj;ğŸ¨",man_astronaut:"ğŸ‘¨&zwj;ğŸš€",man_cartwheeling:"ğŸ¤¸&zwj;â™‚ï¸",man_cook:"ğŸ‘¨&zwj;ğŸ³",man_dancing:"ğŸ•º",man_facepalming:"ğŸ¤¦&zwj;â™‚ï¸",man_factory_worker:"ğŸ‘¨&zwj;ğŸ­",man_farmer:"ğŸ‘¨&zwj;ğŸŒ¾",man_firefighter:"ğŸ‘¨&zwj;ğŸš’",man_health_worker:"ğŸ‘¨&zwj;âš•ï¸",man_in_tuxedo:"ğŸ¤µ",man_judge:"ğŸ‘¨&zwj;âš–ï¸",man_juggling:"ğŸ¤¹&zwj;â™‚ï¸",man_mechanic:"ğŸ‘¨&zwj;ğŸ”§",man_office_worker:"ğŸ‘¨&zwj;ğŸ’¼",man_pilot:"ğŸ‘¨&zwj;âœˆï¸",man_playing_handball:"ğŸ¤¾&zwj;â™‚ï¸",man_playing_water_polo:"ğŸ¤½&zwj;â™‚ï¸",man_scientist:"ğŸ‘¨&zwj;ğŸ”¬",man_shrugging:"ğŸ¤·&zwj;â™‚ï¸",man_singer:"ğŸ‘¨&zwj;ğŸ¤",man_student:"ğŸ‘¨&zwj;ğŸ“",man_teacher:"ğŸ‘¨&zwj;ğŸ«",man_technologist:"ğŸ‘¨&zwj;ğŸ’»",man_with_gua_pi_mao:"ğŸ‘²",man_with_turban:"ğŸ‘³",tangerine:"ğŸŠ",mans_shoe:"ğŸ‘",mantelpiece_clock:"ğŸ•°",maple_leaf:"ğŸ",martial_arts_uniform:"ğŸ¥‹",mask:"ğŸ˜·",massage_woman:"ğŸ’†",massage_man:"ğŸ’†&zwj;â™‚ï¸",meat_on_bone:"ğŸ–",medal_military:"ğŸ–",medal_sports:"ğŸ…",mega:"ğŸ“£",melon:"ğŸˆ",memo:"ğŸ“",men_wrestling:"ğŸ¤¼&zwj;â™‚ï¸",menorah:"ğŸ•",mens:"ğŸš¹",metal:"ğŸ¤˜",metro:"ğŸš‡",microphone:"ğŸ¤",microscope:"ğŸ”¬",milk_glass:"ğŸ¥›",milky_way:"ğŸŒŒ",minibus:"ğŸš",minidisc:"ğŸ’½",mobile_phone_off:"ğŸ“´",money_mouth_face:"ğŸ¤‘",money_with_wings:"ğŸ’¸",moneybag:"ğŸ’°",monkey:"ğŸ’",monkey_face:"ğŸµ",monorail:"ğŸš",moon:"ğŸŒ”",mortar_board:"ğŸ“",mosque:"ğŸ•Œ",motor_boat:"ğŸ›¥",motor_scooter:"ğŸ›µ",motorcycle:"ğŸ",motorway:"ğŸ›£",mount_fuji:"ğŸ—»",mountain:"â›°",mountain_biking_man:"ğŸšµ",mountain_biking_woman:"ğŸšµ&zwj;â™€ï¸",mountain_cableway:"ğŸš ",mountain_railway:"ğŸš",mountain_snow:"ğŸ”",mouse:"ğŸ­",mouse2:"ğŸ",movie_camera:"ğŸ¥",moyai:"ğŸ—¿",mrs_claus:"ğŸ¤¶",muscle:"ğŸ’ª",mushroom:"ğŸ„",musical_keyboard:"ğŸ¹",musical_note:"ğŸµ",musical_score:"ğŸ¼",mute:"ğŸ”‡",nail_care:"ğŸ’…",name_badge:"ğŸ“›",national_park:"ğŸ",nauseated_face:"ğŸ¤¢",necktie:"ğŸ‘”",negative_squared_cross_mark:"â",nerd_face:"ğŸ¤“",neutral_face:"ğŸ˜",new:"ğŸ†•",new_moon:"ğŸŒ‘",new_moon_with_face:"ğŸŒš",newspaper:"ğŸ“°",newspaper_roll:"ğŸ—",next_track_button:"â­",ng:"ğŸ†–",no_good_man:"ğŸ™…&zwj;â™‚ï¸",no_good_woman:"ğŸ™…",night_with_stars:"ğŸŒƒ",no_bell:"ğŸ”•",no_bicycles:"ğŸš³",no_entry:"â›”ï¸",no_entry_sign:"ğŸš«",no_mobile_phones:"ğŸ“µ",no_mouth:"ğŸ˜¶",no_pedestrians:"ğŸš·",no_smoking:"ğŸš­","non-potable_water":"ğŸš±",nose:"ğŸ‘ƒ",notebook:"ğŸ““",notebook_with_decorative_cover:"ğŸ“”",notes:"ğŸ¶",nut_and_bolt:"ğŸ”©",o:"â­•ï¸",o2:"ğŸ…¾ï¸",ocean:"ğŸŒŠ",octopus:"ğŸ™",oden:"ğŸ¢",office:"ğŸ¢",oil_drum:"ğŸ›¢",ok:"ğŸ†—",ok_hand:"ğŸ‘Œ",ok_man:"ğŸ™†&zwj;â™‚ï¸",ok_woman:"ğŸ™†",old_key:"ğŸ—",older_man:"ğŸ‘´",older_woman:"ğŸ‘µ",om:"ğŸ•‰",on:"ğŸ”›",oncoming_automobile:"ğŸš˜",oncoming_bus:"ğŸš",oncoming_police_car:"ğŸš”",oncoming_taxi:"ğŸš–",open_file_folder:"ğŸ“‚",open_hands:"ğŸ‘",open_mouth:"ğŸ˜®",open_umbrella:"â˜‚ï¸",ophiuchus:"â›",orange_book:"ğŸ“™",orthodox_cross:"â˜¦ï¸",outbox_tray:"ğŸ“¤",owl:"ğŸ¦‰",ox:"ğŸ‚",package:"ğŸ“¦",page_facing_up:"ğŸ“„",page_with_curl:"ğŸ“ƒ",pager:"ğŸ“Ÿ",paintbrush:"ğŸ–Œ",palm_tree:"ğŸŒ´",pancakes:"ğŸ¥",panda_face:"ğŸ¼",paperclip:"ğŸ“",paperclips:"ğŸ–‡",parasol_on_ground:"â›±",parking:"ğŸ…¿ï¸",part_alternation_mark:"ã€½ï¸",partly_sunny:"â›…ï¸",passenger_ship:"ğŸ›³",passport_control:"ğŸ›‚",pause_button:"â¸",peace_symbol:"â˜®ï¸",peach:"ğŸ‘",peanuts:"ğŸ¥œ",pear:"ğŸ",pen:"ğŸ–Š",pencil2:"âœï¸",penguin:"ğŸ§",pensive:"ğŸ˜”",performing_arts:"ğŸ­",persevere:"ğŸ˜£",person_fencing:"ğŸ¤º",pouting_woman:"ğŸ™",phone:"â˜ï¸",pick:"â›",pig:"ğŸ·",pig2:"ğŸ–",pig_nose:"ğŸ½",pill:"ğŸ’Š",pineapple:"ğŸ",ping_pong:"ğŸ“",pisces:"â™“ï¸",pizza:"ğŸ•",place_of_worship:"ğŸ›",plate_with_cutlery:"ğŸ½",play_or_pause_button:"â¯",point_down:"ğŸ‘‡",point_left:"ğŸ‘ˆ",point_right:"ğŸ‘‰",point_up:"â˜ï¸",point_up_2:"ğŸ‘†",police_car:"ğŸš“",policewoman:"ğŸ‘®&zwj;â™€ï¸",poodle:"ğŸ©",popcorn:"ğŸ¿",post_office:"ğŸ£",postal_horn:"ğŸ“¯",postbox:"ğŸ“®",potable_water:"ğŸš°",potato:"ğŸ¥”",pouch:"ğŸ‘",poultry_leg:"ğŸ—",pound:"ğŸ’·",rage:"ğŸ˜¡",pouting_cat:"ğŸ˜¾",pouting_man:"ğŸ™&zwj;â™‚ï¸",pray:"ğŸ™",prayer_beads:"ğŸ“¿",pregnant_woman:"ğŸ¤°",previous_track_button:"â®",prince:"ğŸ¤´",princess:"ğŸ‘¸",printer:"ğŸ–¨",purple_heart:"ğŸ’œ",purse:"ğŸ‘›",pushpin:"ğŸ“Œ",put_litter_in_its_place:"ğŸš®",question:"â“",rabbit:"ğŸ°",rabbit2:"ğŸ‡",racehorse:"ğŸ",racing_car:"ğŸ",radio:"ğŸ“»",radio_button:"ğŸ”˜",radioactive:"â˜¢ï¸",railway_car:"ğŸšƒ",railway_track:"ğŸ›¤",rainbow:"ğŸŒˆ",rainbow_flag:"ğŸ³ï¸&zwj;ğŸŒˆ",raised_back_of_hand:"ğŸ¤š",raised_hand_with_fingers_splayed:"ğŸ–",raised_hands:"ğŸ™Œ",raising_hand_woman:"ğŸ™‹",raising_hand_man:"ğŸ™‹&zwj;â™‚ï¸",ram:"ğŸ",ramen:"ğŸœ",rat:"ğŸ€",record_button:"âº",recycle:"â™»ï¸",red_circle:"ğŸ”´",registered:"Â®ï¸",relaxed:"â˜ºï¸",relieved:"ğŸ˜Œ",reminder_ribbon:"ğŸ—",repeat:"ğŸ”",repeat_one:"ğŸ”‚",rescue_worker_helmet:"â›‘",restroom:"ğŸš»",revolving_hearts:"ğŸ’",rewind:"âª",rhinoceros:"ğŸ¦",ribbon:"ğŸ€",rice:"ğŸš",rice_ball:"ğŸ™",rice_cracker:"ğŸ˜",rice_scene:"ğŸ‘",right_anger_bubble:"ğŸ—¯",ring:"ğŸ’",robot:"ğŸ¤–",rocket:"ğŸš€",rofl:"ğŸ¤£",roll_eyes:"ğŸ™„",roller_coaster:"ğŸ¢",rooster:"ğŸ“",rose:"ğŸŒ¹",rosette:"ğŸµ",rotating_light:"ğŸš¨",round_pushpin:"ğŸ“",rowing_man:"ğŸš£",rowing_woman:"ğŸš£&zwj;â™€ï¸",rugby_football:"ğŸ‰",running_man:"ğŸƒ",running_shirt_with_sash:"ğŸ½",running_woman:"ğŸƒ&zwj;â™€ï¸",sa:"ğŸˆ‚ï¸",sagittarius:"â™ï¸",sake:"ğŸ¶",sandal:"ğŸ‘¡",santa:"ğŸ…",satellite:"ğŸ“¡",saxophone:"ğŸ·",school:"ğŸ«",school_satchel:"ğŸ’",scissors:"âœ‚ï¸",scorpion:"ğŸ¦‚",scorpius:"â™ï¸",scream:"ğŸ˜±",scream_cat:"ğŸ™€",scroll:"ğŸ“œ",seat:"ğŸ’º",secret:"ãŠ™ï¸",see_no_evil:"ğŸ™ˆ",seedling:"ğŸŒ±",selfie:"ğŸ¤³",shallow_pan_of_food:"ğŸ¥˜",shamrock:"â˜˜ï¸",shark:"ğŸ¦ˆ",shaved_ice:"ğŸ§",sheep:"ğŸ‘",shell:"ğŸš",shield:"ğŸ›¡",shinto_shrine:"â›©",ship:"ğŸš¢",shirt:"ğŸ‘•",shopping:"ğŸ›",shopping_cart:"ğŸ›’",shower:"ğŸš¿",shrimp:"ğŸ¦",signal_strength:"ğŸ“¶",six_pointed_star:"ğŸ”¯",ski:"ğŸ¿",skier:"â›·",skull:"ğŸ’€",skull_and_crossbones:"â˜ ï¸",sleeping:"ğŸ˜´",sleeping_bed:"ğŸ›Œ",sleepy:"ğŸ˜ª",slightly_frowning_face:"ğŸ™",slightly_smiling_face:"ğŸ™‚",slot_machine:"ğŸ°",small_airplane:"ğŸ›©",small_blue_diamond:"ğŸ”¹",small_orange_diamond:"ğŸ”¸",small_red_triangle:"ğŸ”º",small_red_triangle_down:"ğŸ”»",smile:"ğŸ˜„",smile_cat:"ğŸ˜¸",smiley:"ğŸ˜ƒ",smiley_cat:"ğŸ˜º",smiling_imp:"ğŸ˜ˆ",smirk:"ğŸ˜",smirk_cat:"ğŸ˜¼",smoking:"ğŸš¬",snail:"ğŸŒ",snake:"ğŸ",sneezing_face:"ğŸ¤§",snowboarder:"ğŸ‚",snowflake:"â„ï¸",snowman:"â›„ï¸",snowman_with_snow:"â˜ƒï¸",sob:"ğŸ˜­",soccer:"âš½ï¸",soon:"ğŸ”œ",sos:"ğŸ†˜",sound:"ğŸ”‰",space_invader:"ğŸ‘¾",spades:"â™ ï¸",spaghetti:"ğŸ",sparkle:"â‡ï¸",sparkler:"ğŸ‡",sparkles:"âœ¨",sparkling_heart:"ğŸ’–",speak_no_evil:"ğŸ™Š",speaker:"ğŸ”ˆ",speaking_head:"ğŸ—£",speech_balloon:"ğŸ’¬",speedboat:"ğŸš¤",spider:"ğŸ•·",spider_web:"ğŸ•¸",spiral_calendar:"ğŸ—“",spiral_notepad:"ğŸ—’",spoon:"ğŸ¥„",squid:"ğŸ¦‘",stadium:"ğŸŸ",star:"â­ï¸",star2:"ğŸŒŸ",star_and_crescent:"â˜ªï¸",star_of_david:"âœ¡ï¸",stars:"ğŸŒ ",station:"ğŸš‰",statue_of_liberty:"ğŸ—½",steam_locomotive:"ğŸš‚",stew:"ğŸ²",stop_button:"â¹",stop_sign:"ğŸ›‘",stopwatch:"â±",straight_ruler:"ğŸ“",strawberry:"ğŸ“",stuck_out_tongue:"ğŸ˜›",stuck_out_tongue_closed_eyes:"ğŸ˜",stuck_out_tongue_winking_eye:"ğŸ˜œ",studio_microphone:"ğŸ™",stuffed_flatbread:"ğŸ¥™",sun_behind_large_cloud:"ğŸŒ¥",sun_behind_rain_cloud:"ğŸŒ¦",sun_behind_small_cloud:"ğŸŒ¤",sun_with_face:"ğŸŒ",sunflower:"ğŸŒ»",sunglasses:"ğŸ˜",sunny:"â˜€ï¸",sunrise:"ğŸŒ…",sunrise_over_mountains:"ğŸŒ„",surfing_man:"ğŸ„",surfing_woman:"ğŸ„&zwj;â™€ï¸",sushi:"ğŸ£",suspension_railway:"ğŸšŸ",sweat:"ğŸ˜“",sweat_drops:"ğŸ’¦",sweat_smile:"ğŸ˜…",sweet_potato:"ğŸ ",swimming_man:"ğŸŠ",swimming_woman:"ğŸŠ&zwj;â™€ï¸",symbols:"ğŸ”£",synagogue:"ğŸ•",syringe:"ğŸ’‰",taco:"ğŸŒ®",tada:"ğŸ‰",tanabata_tree:"ğŸ‹",taurus:"â™‰ï¸",taxi:"ğŸš•",tea:"ğŸµ",telephone_receiver:"ğŸ“",telescope:"ğŸ”­",tennis:"ğŸ¾",tent:"â›ºï¸",thermometer:"ğŸŒ¡",thinking:"ğŸ¤”",thought_balloon:"ğŸ’­",ticket:"ğŸ«",tickets:"ğŸŸ",tiger:"ğŸ¯",tiger2:"ğŸ…",timer_clock:"â²",tipping_hand_man:"ğŸ’&zwj;â™‚ï¸",tired_face:"ğŸ˜«",tm:"â„¢ï¸",toilet:"ğŸš½",tokyo_tower:"ğŸ—¼",tomato:"ğŸ…",tongue:"ğŸ‘…",top:"ğŸ”",tophat:"ğŸ©",tornado:"ğŸŒª",trackball:"ğŸ–²",tractor:"ğŸšœ",traffic_light:"ğŸš¥",train:"ğŸš‹",train2:"ğŸš†",tram:"ğŸšŠ",triangular_flag_on_post:"ğŸš©",triangular_ruler:"ğŸ“",trident:"ğŸ”±",triumph:"ğŸ˜¤",trolleybus:"ğŸš",trophy:"ğŸ†",tropical_drink:"ğŸ¹",tropical_fish:"ğŸ ",truck:"ğŸšš",trumpet:"ğŸº",tulip:"ğŸŒ·",tumbler_glass:"ğŸ¥ƒ",turkey:"ğŸ¦ƒ",turtle:"ğŸ¢",tv:"ğŸ“º",twisted_rightwards_arrows:"ğŸ”€",two_hearts:"ğŸ’•",two_men_holding_hands:"ğŸ‘¬",two_women_holding_hands:"ğŸ‘­",u5272:"ğŸˆ¹",u5408:"ğŸˆ´",u55b6:"ğŸˆº",u6307:"ğŸˆ¯ï¸",u6708:"ğŸˆ·ï¸",u6709:"ğŸˆ¶",u6e80:"ğŸˆµ",u7121:"ğŸˆšï¸",u7533:"ğŸˆ¸",u7981:"ğŸˆ²",u7a7a:"ğŸˆ³",umbrella:"â˜”ï¸",unamused:"ğŸ˜’",underage:"ğŸ”",unicorn:"ğŸ¦„",unlock:"ğŸ”“",up:"ğŸ†™",upside_down_face:"ğŸ™ƒ",v:"âœŒï¸",vertical_traffic_light:"ğŸš¦",vhs:"ğŸ“¼",vibration_mode:"ğŸ“³",video_camera:"ğŸ“¹",video_game:"ğŸ®",violin:"ğŸ»",virgo:"â™ï¸",volcano:"ğŸŒ‹",volleyball:"ğŸ",vs:"ğŸ†š",vulcan_salute:"ğŸ––",walking_man:"ğŸš¶",walking_woman:"ğŸš¶&zwj;â™€ï¸",waning_crescent_moon:"ğŸŒ˜",waning_gibbous_moon:"ğŸŒ–",warning:"âš ï¸",wastebasket:"ğŸ—‘",watch:"âŒšï¸",water_buffalo:"ğŸƒ",watermelon:"ğŸ‰",wave:"ğŸ‘‹",wavy_dash:"ã€°ï¸",waxing_crescent_moon:"ğŸŒ’",wc:"ğŸš¾",weary:"ğŸ˜©",wedding:"ğŸ’’",weight_lifting_man:"ğŸ‹ï¸",weight_lifting_woman:"ğŸ‹ï¸&zwj;â™€ï¸",whale:"ğŸ³",whale2:"ğŸ‹",wheel_of_dharma:"â˜¸ï¸",wheelchair:"â™¿ï¸",white_check_mark:"âœ…",white_circle:"âšªï¸",white_flag:"ğŸ³ï¸",white_flower:"ğŸ’®",white_large_square:"â¬œï¸",white_medium_small_square:"â—½ï¸",white_medium_square:"â—»ï¸",white_small_square:"â–«ï¸",white_square_button:"ğŸ”³",wilted_flower:"ğŸ¥€",wind_chime:"ğŸ",wind_face:"ğŸŒ¬",wine_glass:"ğŸ·",wink:"ğŸ˜‰",wolf:"ğŸº",woman:"ğŸ‘©",woman_artist:"ğŸ‘©&zwj;ğŸ¨",woman_astronaut:"ğŸ‘©&zwj;ğŸš€",woman_cartwheeling:"ğŸ¤¸&zwj;â™€ï¸",woman_cook:"ğŸ‘©&zwj;ğŸ³",woman_facepalming:"ğŸ¤¦&zwj;â™€ï¸",woman_factory_worker:"ğŸ‘©&zwj;ğŸ­",woman_farmer:"ğŸ‘©&zwj;ğŸŒ¾",woman_firefighter:"ğŸ‘©&zwj;ğŸš’",woman_health_worker:"ğŸ‘©&zwj;âš•ï¸",woman_judge:"ğŸ‘©&zwj;âš–ï¸",woman_juggling:"ğŸ¤¹&zwj;â™€ï¸",woman_mechanic:"ğŸ‘©&zwj;ğŸ”§",woman_office_worker:"ğŸ‘©&zwj;ğŸ’¼",woman_pilot:"ğŸ‘©&zwj;âœˆï¸",woman_playing_handball:"ğŸ¤¾&zwj;â™€ï¸",woman_playing_water_polo:"ğŸ¤½&zwj;â™€ï¸",woman_scientist:"ğŸ‘©&zwj;ğŸ”¬",woman_shrugging:"ğŸ¤·&zwj;â™€ï¸",woman_singer:"ğŸ‘©&zwj;ğŸ¤",woman_student:"ğŸ‘©&zwj;ğŸ“",woman_teacher:"ğŸ‘©&zwj;ğŸ«",woman_technologist:"ğŸ‘©&zwj;ğŸ’»",woman_with_turban:"ğŸ‘³&zwj;â™€ï¸",womans_clothes:"ğŸ‘š",womans_hat:"ğŸ‘’",women_wrestling:"ğŸ¤¼&zwj;â™€ï¸",womens:"ğŸšº",world_map:"ğŸ—º",worried:"ğŸ˜Ÿ",wrench:"ğŸ”§",writing_hand:"âœï¸",x:"âŒ",yellow_heart:"ğŸ’›",yen:"ğŸ’´",yin_yang:"â˜¯ï¸",yum:"ğŸ˜‹",zap:"âš¡ï¸",zipper_mouth_face:"ğŸ¤",zzz:"ğŸ’¤",octocat:'<img alt=":octocat:" height="20" width="20" align="absmiddle" src="https://assets-cdn.github.com/images/icons/emoji/octocat.png">',showdown:`<span style="font-family: 'Anonymous Pro', monospace; text-decoration: underline; text-decoration-style: dashed; text-decoration-color: #3e8b8a;text-underline-position: under;">S</span>`},n.Converter=function(i){var f={},u=[],p=[],y={},m=l,g={parsed:{},raw:"",format:""};b();function b(){i=i||{};for(var I in s)s.hasOwnProperty(I)&&(f[I]=s[I]);if(typeof i=="object")for(var A in i)i.hasOwnProperty(A)&&(f[A]=i[A]);else throw Error("Converter expects the passed parameter to be an object, but "+typeof i+" was passed instead.");f.extensions&&n.helper.forEach(f.extensions,$)}function $(I,A){if(A=A||null,n.helper.isString(I))if(I=n.helper.stdExtName(I),A=I,n.extensions[I]){console.warn("DEPRECATION WARNING: "+I+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),C(n.extensions[I],I);return}else if(!n.helper.isUndefined(o[I]))I=o[I];else throw Error('Extension "'+I+'" could not be loaded. It was either not found or is not a valid extension.');typeof I=="function"&&(I=I()),n.helper.isArray(I)||(I=[I]);var j=h(I,A);if(!j.valid)throw Error(j.error);for(var U=0;U<I.length;++U){switch(I[U].type){case"lang":u.push(I[U]);break;case"output":p.push(I[U]);break}if(I[U].hasOwnProperty("listeners"))for(var Y in I[U].listeners)I[U].listeners.hasOwnProperty(Y)&&M(Y,I[U].listeners[Y])}}function C(I,A){typeof I=="function"&&(I=I(new n.Converter)),n.helper.isArray(I)||(I=[I]);var j=h(I,A);if(!j.valid)throw Error(j.error);for(var U=0;U<I.length;++U)switch(I[U].type){case"lang":u.push(I[U]);break;case"output":p.push(I[U]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function M(I,A){if(!n.helper.isString(I))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof I+" given");if(typeof A!="function")throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof A+" given");y.hasOwnProperty(I)||(y[I]=[]),y[I].push(A)}function P(I){var A=I.match(/^\s*/)[0].length,j=new RegExp("^\\s{0,"+A+"}","gm");return I.replace(j,"")}this._dispatch=function(A,j,U,Y){if(y.hasOwnProperty(A))for(var k=0;k<y[A].length;++k){var R=y[A][k](A,j,this,U,Y);R&&typeof R<"u"&&(j=R)}return j},this.listen=function(I,A){return M(I,A),this},this.makeHtml=function(I){if(!I)return I;var A={gHtmlBlocks:[],gHtmlMdBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:u,outputModifiers:p,converter:this,ghCodeBlocks:[],metadata:{parsed:{},raw:"",format:""}};return I=I.replace(/Â¨/g,"Â¨T"),I=I.replace(/\$/g,"Â¨D"),I=I.replace(/\r\n/g,`
`),I=I.replace(/\r/g,`
`),I=I.replace(/\u00A0/g,"&nbsp;"),f.smartIndentationFix&&(I=P(I)),I=`

`+I+`

`,I=n.subParser("detab")(I,f,A),I=I.replace(/^[ \t]+$/mg,""),n.helper.forEach(u,function(j){I=n.subParser("runExtension")(j,I,f,A)}),I=n.subParser("metadata")(I,f,A),I=n.subParser("hashPreCodeTags")(I,f,A),I=n.subParser("githubCodeBlocks")(I,f,A),I=n.subParser("hashHTMLBlocks")(I,f,A),I=n.subParser("hashCodeTags")(I,f,A),I=n.subParser("stripLinkDefinitions")(I,f,A),I=n.subParser("blockGamut")(I,f,A),I=n.subParser("unhashHTMLSpans")(I,f,A),I=n.subParser("unescapeSpecialChars")(I,f,A),I=I.replace(/Â¨D/g,"$$"),I=I.replace(/Â¨T/g,"Â¨"),I=n.subParser("completeHTMLDocument")(I,f,A),n.helper.forEach(p,function(j){I=n.subParser("runExtension")(j,I,f,A)}),g=A.metadata,I},this.makeMarkdown=this.makeMd=function(I,A){if(I=I.replace(/\r\n/g,`
`),I=I.replace(/\r/g,`
`),I=I.replace(/>[ \t]+</,">Â¨NBSP;<"),!A)if(window&&window.document)A=window.document;else throw new Error("HTMLParser is undefined. If in a webworker or nodejs environment, you need to provide a WHATWG DOM and HTML such as JSDOM");var j=A.createElement("div");j.innerHTML=I;var U={preList:ee(j)};F(j);for(var Y=j.childNodes,k="",R=0;R<Y.length;R++)k+=n.subParser("makeMarkdown.node")(Y[R],U);function F(Q){for(var J=0;J<Q.childNodes.length;++J){var de=Q.childNodes[J];de.nodeType===3?!/\S/.test(de.nodeValue)&&!/^[ ]+$/.test(de.nodeValue)?(Q.removeChild(de),--J):(de.nodeValue=de.nodeValue.split(`
`).join(" "),de.nodeValue=de.nodeValue.replace(/(\s)+/g,"$1")):de.nodeType===1&&F(de)}}function ee(Q){for(var J=Q.querySelectorAll("pre"),de=[],oe=0;oe<J.length;++oe)if(J[oe].childElementCount===1&&J[oe].firstChild.tagName.toLowerCase()==="code"){var Le=J[oe].firstChild.innerHTML.trim(),ce=J[oe].firstChild.getAttribute("data-language")||"";if(ce==="")for(var Re=J[oe].firstChild.className.split(" "),xe=0;xe<Re.length;++xe){var ke=Re[xe].match(/^language-(.+)$/);if(ke!==null){ce=ke[1];break}}Le=n.helper.unescapeHTMLEntities(Le),de.push(Le),J[oe].outerHTML='<precode language="'+ce+'" precodenum="'+oe.toString()+'"></precode>'}else de.push(J[oe].innerHTML),J[oe].innerHTML="",J[oe].setAttribute("prenum",oe.toString());return de}return k},this.setOption=function(I,A){f[I]=A},this.getOption=function(I){return f[I]},this.getOptions=function(){return f},this.addExtension=function(I,A){A=A||null,$(I,A)},this.useExtension=function(I){$(I)},this.setFlavor=function(I){if(!c.hasOwnProperty(I))throw Error(I+" flavor was not found");var A=c[I];m=I;for(var j in A)A.hasOwnProperty(j)&&(f[j]=A[j])},this.getFlavor=function(){return m},this.removeExtension=function(I){n.helper.isArray(I)||(I=[I]);for(var A=0;A<I.length;++A){for(var j=I[A],U=0;U<u.length;++U)u[U]===j&&u.splice(U,1);for(var Y=0;Y<p.length;++Y)p[Y]===j&&p.splice(Y,1)}},this.getAllExtensions=function(){return{language:u,output:p}},this.getMetadata=function(I){return I?g.raw:g.parsed},this.getMetadataFormat=function(){return g.format},this._setMetadataPair=function(I,A){g.parsed[I]=A},this._setMetadataFormat=function(I){g.format=I},this._setMetadataRaw=function(I){g.raw=I}},n.subParser("anchors",function(i,f,u){i=u.converter._dispatch("anchors.before",i,f,u);var p=function(y,m,g,b,$,C,M){if(n.helper.isUndefined(M)&&(M=""),g=g.toLowerCase(),y.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)b="";else if(!b)if(g||(g=m.toLowerCase().replace(/ ?\n/g," ")),b="#"+g,!n.helper.isUndefined(u.gUrls[g]))b=u.gUrls[g],n.helper.isUndefined(u.gTitles[g])||(M=u.gTitles[g]);else return y;b=b.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var P='<a href="'+b+'"';return M!==""&&M!==null&&(M=M.replace(/"/g,"&quot;"),M=M.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),P+=' title="'+M+'"'),f.openLinksInNewWindow&&!/^#/.test(b)&&(P+=' rel="noopener noreferrer" target="Â¨E95Eblank"'),P+=">"+m+"</a>",P};return i=i.replace(/\[((?:\[[^\]]*]|[^\[\]])*)] ?(?:\n *)?\[(.*?)]()()()()/g,p),i=i.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<([^>]*)>(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,p),i=i.replace(/\[((?:\[[^\]]*]|[^\[\]])*)]()[ \t]*\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?:[ \t]*((["'])([^"]*?)\5))?[ \t]?\)/g,p),i=i.replace(/\[([^\[\]]+)]()()()()()/g,p),f.ghMentions&&(i=i.replace(/(^|\s)(\\)?(@([a-z\d]+(?:[a-z\d.-]+?[a-z\d]+)*))/gmi,function(y,m,g,b,$){if(g==="\\")return m+b;if(!n.helper.isString(f.ghMentionsLink))throw new Error("ghMentionsLink option must be a string");var C=f.ghMentionsLink.replace(/\{u}/g,$),M="";return f.openLinksInNewWindow&&(M=' rel="noopener noreferrer" target="Â¨E95Eblank"'),m+'<a href="'+C+'"'+M+">"+b+"</a>"})),i=u.converter._dispatch("anchors.after",i,f,u),i});var N=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+?\.[^'">\s]+?)()(\1)?(?=\s|$)(?!["<>])/gi,D=/([*~_]+|\b)(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+?)([.!?,()\[\]])?(\1)?(?=\s|$)(?!["<>])/gi,S=/()<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)()>()/gi,V=/(^|\s)(?:mailto:)?([A-Za-z0-9!#$%&'*+-/=?^_`{|}~.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?=$|\s)/gmi,z=/<()(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,H=function(i){return function(f,u,p,y,m,g,b){p=p.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var $=p,C="",M="",P=u||"",I=b||"";return/^www\./i.test(p)&&(p=p.replace(/^www\./i,"http://www.")),i.excludeTrailingPunctuationFromURLs&&g&&(C=g),i.openLinksInNewWindow&&(M=' rel="noopener noreferrer" target="Â¨E95Eblank"'),P+'<a href="'+p+'"'+M+">"+$+"</a>"+C+I}},L=function(i,f){return function(u,p,y){var m="mailto:";return p=p||"",y=n.subParser("unescapeSpecialChars")(y,i,f),i.encodeEmails?(m=n.helper.encodeEmailAddress(m+y),y=n.helper.encodeEmailAddress(y)):m=m+y,p+'<a href="'+m+'">'+y+"</a>"}};n.subParser("autoLinks",function(i,f,u){return i=u.converter._dispatch("autoLinks.before",i,f,u),i=i.replace(S,H(f)),i=i.replace(z,L(f,u)),i=u.converter._dispatch("autoLinks.after",i,f,u),i}),n.subParser("simplifiedAutoLinks",function(i,f,u){return f.simplifiedAutoLink&&(i=u.converter._dispatch("simplifiedAutoLinks.before",i,f,u),f.excludeTrailingPunctuationFromURLs?i=i.replace(D,H(f)):i=i.replace(N,H(f)),i=i.replace(V,L(f,u)),i=u.converter._dispatch("simplifiedAutoLinks.after",i,f,u)),i}),n.subParser("blockGamut",function(i,f,u){return i=u.converter._dispatch("blockGamut.before",i,f,u),i=n.subParser("blockQuotes")(i,f,u),i=n.subParser("headers")(i,f,u),i=n.subParser("horizontalRule")(i,f,u),i=n.subParser("lists")(i,f,u),i=n.subParser("codeBlocks")(i,f,u),i=n.subParser("tables")(i,f,u),i=n.subParser("hashHTMLBlocks")(i,f,u),i=n.subParser("paragraphs")(i,f,u),i=u.converter._dispatch("blockGamut.after",i,f,u),i}),n.subParser("blockQuotes",function(i,f,u){i=u.converter._dispatch("blockQuotes.before",i,f,u),i=i+`

`;var p=/(^ {0,3}>[ \t]?.+\n(.+\n)*\n*)+/gm;return f.splitAdjacentBlockquotes&&(p=/^ {0,3}>[\s\S]*?(?:\n\n)/gm),i=i.replace(p,function(y){return y=y.replace(/^[ \t]*>[ \t]?/gm,""),y=y.replace(/Â¨0/g,""),y=y.replace(/^[ \t]+$/gm,""),y=n.subParser("githubCodeBlocks")(y,f,u),y=n.subParser("blockGamut")(y,f,u),y=y.replace(/(^|\n)/g,"$1  "),y=y.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(m,g){var b=g;return b=b.replace(/^  /mg,"Â¨0"),b=b.replace(/Â¨0/g,""),b}),n.subParser("hashBlock")(`<blockquote>
`+y+`
</blockquote>`,f,u)}),i=u.converter._dispatch("blockQuotes.after",i,f,u),i}),n.subParser("codeBlocks",function(i,f,u){i=u.converter._dispatch("codeBlocks.before",i,f,u),i+="Â¨0";var p=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=Â¨0))/g;return i=i.replace(p,function(y,m,g){var b=m,$=g,C=`
`;return b=n.subParser("outdent")(b,f,u),b=n.subParser("encodeCode")(b,f,u),b=n.subParser("detab")(b,f,u),b=b.replace(/^\n+/g,""),b=b.replace(/\n+$/g,""),f.omitExtraWLInCodeBlocks&&(C=""),b="<pre><code>"+b+C+"</code></pre>",n.subParser("hashBlock")(b,f,u)+$}),i=i.replace(/Â¨0/,""),i=u.converter._dispatch("codeBlocks.after",i,f,u),i}),n.subParser("codeSpans",function(i,f,u){return i=u.converter._dispatch("codeSpans.before",i,f,u),typeof i>"u"&&(i=""),i=i.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(p,y,m,g){var b=g;return b=b.replace(/^([ \t]*)/g,""),b=b.replace(/[ \t]*$/g,""),b=n.subParser("encodeCode")(b,f,u),b=y+"<code>"+b+"</code>",b=n.subParser("hashHTMLSpans")(b,f,u),b}),i=u.converter._dispatch("codeSpans.after",i,f,u),i}),n.subParser("completeHTMLDocument",function(i,f,u){if(!f.completeHTMLDocument)return i;i=u.converter._dispatch("completeHTMLDocument.before",i,f,u);var p="html",y=`<!DOCTYPE HTML>
`,m="",g=`<meta charset="utf-8">
`,b="",$="";typeof u.metadata.parsed.doctype<"u"&&(y="<!DOCTYPE "+u.metadata.parsed.doctype+`>
`,p=u.metadata.parsed.doctype.toString().toLowerCase(),(p==="html"||p==="html5")&&(g='<meta charset="utf-8">'));for(var C in u.metadata.parsed)if(u.metadata.parsed.hasOwnProperty(C))switch(C.toLowerCase()){case"doctype":break;case"title":m="<title>"+u.metadata.parsed.title+`</title>
`;break;case"charset":p==="html"||p==="html5"?g='<meta charset="'+u.metadata.parsed.charset+`">
`:g='<meta name="charset" content="'+u.metadata.parsed.charset+`">
`;break;case"language":case"lang":b=' lang="'+u.metadata.parsed[C]+'"',$+='<meta name="'+C+'" content="'+u.metadata.parsed[C]+`">
`;break;default:$+='<meta name="'+C+'" content="'+u.metadata.parsed[C]+`">
`}return i=y+"<html"+b+`>
<head>
`+m+g+$+`</head>
<body>
`+i.trim()+`
</body>
</html>`,i=u.converter._dispatch("completeHTMLDocument.after",i,f,u),i}),n.subParser("detab",function(i,f,u){return i=u.converter._dispatch("detab.before",i,f,u),i=i.replace(/\t(?=\t)/g,"    "),i=i.replace(/\t/g,"Â¨AÂ¨B"),i=i.replace(/Â¨B(.+?)Â¨A/g,function(p,y){for(var m=y,g=4-m.length%4,b=0;b<g;b++)m+=" ";return m}),i=i.replace(/Â¨A/g,"    "),i=i.replace(/Â¨B/g,""),i=u.converter._dispatch("detab.after",i,f,u),i}),n.subParser("ellipsis",function(i,f,u){return f.ellipsis&&(i=u.converter._dispatch("ellipsis.before",i,f,u),i=i.replace(/\.\.\./g,"â€¦"),i=u.converter._dispatch("ellipsis.after",i,f,u)),i}),n.subParser("emoji",function(i,f,u){if(!f.emoji)return i;i=u.converter._dispatch("emoji.before",i,f,u);var p=/:([\S]+?):/g;return i=i.replace(p,function(y,m){return n.helper.emojis.hasOwnProperty(m)?n.helper.emojis[m]:y}),i=u.converter._dispatch("emoji.after",i,f,u),i}),n.subParser("encodeAmpsAndAngles",function(i,f,u){return i=u.converter._dispatch("encodeAmpsAndAngles.before",i,f,u),i=i.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),i=i.replace(/<(?![a-z\/?$!])/gi,"&lt;"),i=i.replace(/</g,"&lt;"),i=i.replace(/>/g,"&gt;"),i=u.converter._dispatch("encodeAmpsAndAngles.after",i,f,u),i}),n.subParser("encodeBackslashEscapes",function(i,f,u){return i=u.converter._dispatch("encodeBackslashEscapes.before",i,f,u),i=i.replace(/\\(\\)/g,n.helper.escapeCharactersCallback),i=i.replace(/\\([`*_{}\[\]()>#+.!~=|:-])/g,n.helper.escapeCharactersCallback),i=u.converter._dispatch("encodeBackslashEscapes.after",i,f,u),i}),n.subParser("encodeCode",function(i,f,u){return i=u.converter._dispatch("encodeCode.before",i,f,u),i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/([*_{}\[\]\\=~-])/g,n.helper.escapeCharactersCallback),i=u.converter._dispatch("encodeCode.after",i,f,u),i}),n.subParser("escapeSpecialCharsWithinTagAttributes",function(i,f,u){i=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.before",i,f,u);var p=/<\/?[a-z\d_:-]+(?:[\s]+[\s\S]+?)?>/gi,y=/<!(--(?:(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>/gi;return i=i.replace(p,function(m){return m.replace(/(.)<\/?code>(?=.)/g,"$1`").replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),i=i.replace(y,function(m){return m.replace(/([\\`*_~=|])/g,n.helper.escapeCharactersCallback)}),i=u.converter._dispatch("escapeSpecialCharsWithinTagAttributes.after",i,f,u),i}),n.subParser("githubCodeBlocks",function(i,f,u){return f.ghCodeBlocks?(i=u.converter._dispatch("githubCodeBlocks.before",i,f,u),i+="Â¨0",i=i.replace(/(?:^|\n)(?: {0,3})(```+|~~~+)(?: *)([^\s`~]*)\n([\s\S]*?)\n(?: {0,3})\1/g,function(p,y,m,g){var b=f.omitExtraWLInCodeBlocks?"":`
`;return g=n.subParser("encodeCode")(g,f,u),g=n.subParser("detab")(g,f,u),g=g.replace(/^\n+/g,""),g=g.replace(/\n+$/g,""),g="<pre><code"+(m?' class="'+m+" language-"+m+'"':"")+">"+g+b+"</code></pre>",g=n.subParser("hashBlock")(g,f,u),`

Â¨G`+(u.ghCodeBlocks.push({text:p,codeblock:g})-1)+`G

`}),i=i.replace(/Â¨0/,""),u.converter._dispatch("githubCodeBlocks.after",i,f,u)):i}),n.subParser("hashBlock",function(i,f,u){return i=u.converter._dispatch("hashBlock.before",i,f,u),i=i.replace(/(^\n+|\n+$)/g,""),i=`

Â¨K`+(u.gHtmlBlocks.push(i)-1)+`K

`,i=u.converter._dispatch("hashBlock.after",i,f,u),i}),n.subParser("hashCodeTags",function(i,f,u){i=u.converter._dispatch("hashCodeTags.before",i,f,u);var p=function(y,m,g,b){var $=g+n.subParser("encodeCode")(m,f,u)+b;return"Â¨C"+(u.gHtmlSpans.push($)-1)+"C"};return i=n.helper.replaceRecursiveRegExp(i,p,"<code\\b[^>]*>","</code>","gim"),i=u.converter._dispatch("hashCodeTags.after",i,f,u),i}),n.subParser("hashElement",function(i,f,u){return function(p,y){var m=y;return m=m.replace(/\n\n/g,`
`),m=m.replace(/^\n/,""),m=m.replace(/\n+$/g,""),m=`

Â¨K`+(u.gHtmlBlocks.push(m)-1)+`K

`,m}}),n.subParser("hashHTMLBlocks",function(i,f,u){i=u.converter._dispatch("hashHTMLBlocks.before",i,f,u);var p=["pre","div","h1","h2","h3","h4","h5","h6","blockquote","table","dl","ol","ul","script","noscript","form","fieldset","iframe","math","style","section","header","footer","nav","article","aside","address","audio","canvas","figure","hgroup","output","video","p"],y=function(I,A,j,U){var Y=I;return j.search(/\bmarkdown\b/)!==-1&&(Y=j+u.converter.makeHtml(A)+U),`

Â¨K`+(u.gHtmlBlocks.push(Y)-1)+`K

`};f.backslashEscapesHTMLTags&&(i=i.replace(/\\<(\/?[^>]+?)>/g,function(I,A){return"&lt;"+A+"&gt;"}));for(var m=0;m<p.length;++m)for(var g,b=new RegExp("^ {0,3}(<"+p[m]+"\\b[^>]*>)","im"),$="<"+p[m]+"\\b[^>]*>",C="</"+p[m]+">";(g=n.helper.regexIndexOf(i,b))!==-1;){var M=n.helper.splitAtIndex(i,g),P=n.helper.replaceRecursiveRegExp(M[1],y,$,C,"im");if(P===M[1])break;i=M[0].concat(P)}return i=i.replace(/(\n {0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(i,f,u)),i=n.helper.replaceRecursiveRegExp(i,function(I){return`

Â¨K`+(u.gHtmlBlocks.push(I)-1)+`K

`},"^ {0,3}<!--","-->","gm"),i=i.replace(/(?:\n\n)( {0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,n.subParser("hashElement")(i,f,u)),i=u.converter._dispatch("hashHTMLBlocks.after",i,f,u),i}),n.subParser("hashHTMLSpans",function(i,f,u){i=u.converter._dispatch("hashHTMLSpans.before",i,f,u);function p(y){return"Â¨C"+(u.gHtmlSpans.push(y)-1)+"C"}return i=i.replace(/<[^>]+?\/>/gi,function(y){return p(y)}),i=i.replace(/<([^>]+?)>[\s\S]*?<\/\1>/g,function(y){return p(y)}),i=i.replace(/<([^>]+?)\s[^>]+?>[\s\S]*?<\/\1>/g,function(y){return p(y)}),i=i.replace(/<[^>]+?>/gi,function(y){return p(y)}),i=u.converter._dispatch("hashHTMLSpans.after",i,f,u),i}),n.subParser("unhashHTMLSpans",function(i,f,u){i=u.converter._dispatch("unhashHTMLSpans.before",i,f,u);for(var p=0;p<u.gHtmlSpans.length;++p){for(var y=u.gHtmlSpans[p],m=0;/Â¨C(\d+)C/.test(y);){var g=RegExp.$1;if(y=y.replace("Â¨C"+g+"C",u.gHtmlSpans[g]),m===10){console.error("maximum nesting of 10 spans reached!!!");break}++m}i=i.replace("Â¨C"+p+"C",y)}return i=u.converter._dispatch("unhashHTMLSpans.after",i,f,u),i}),n.subParser("hashPreCodeTags",function(i,f,u){i=u.converter._dispatch("hashPreCodeTags.before",i,f,u);var p=function(y,m,g,b){var $=g+n.subParser("encodeCode")(m,f,u)+b;return`

Â¨G`+(u.ghCodeBlocks.push({text:y,codeblock:$})-1)+`G

`};return i=n.helper.replaceRecursiveRegExp(i,p,"^ {0,3}<pre\\b[^>]*>\\s*<code\\b[^>]*>","^ {0,3}</code>\\s*</pre>","gim"),i=u.converter._dispatch("hashPreCodeTags.after",i,f,u),i}),n.subParser("headers",function(i,f,u){i=u.converter._dispatch("headers.before",i,f,u);var p=isNaN(parseInt(f.headerLevelStart))?1:parseInt(f.headerLevelStart),y=f.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,m=f.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;i=i.replace(y,function($,C){var M=n.subParser("spanGamut")(C,f,u),P=f.noHeaderId?"":' id="'+b(C)+'"',I=p,A="<h"+I+P+">"+M+"</h"+I+">";return n.subParser("hashBlock")(A,f,u)}),i=i.replace(m,function($,C){var M=n.subParser("spanGamut")(C,f,u),P=f.noHeaderId?"":' id="'+b(C)+'"',I=p+1,A="<h"+I+P+">"+M+"</h"+I+">";return n.subParser("hashBlock")(A,f,u)});var g=f.requireSpaceBeforeHeadingText?/^(#{1,6})[ \t]+(.+?)[ \t]*#*\n+/gm:/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm;i=i.replace(g,function($,C,M){var P=M;f.customizedHeaderId&&(P=M.replace(/\s?\{([^{]+?)}\s*$/,""));var I=n.subParser("spanGamut")(P,f,u),A=f.noHeaderId?"":' id="'+b(M)+'"',j=p-1+C.length,U="<h"+j+A+">"+I+"</h"+j+">";return n.subParser("hashBlock")(U,f,u)});function b($){var C,M;if(f.customizedHeaderId){var P=$.match(/\{([^{]+?)}\s*$/);P&&P[1]&&($=P[1])}return C=$,n.helper.isString(f.prefixHeaderId)?M=f.prefixHeaderId:f.prefixHeaderId===!0?M="section-":M="",f.rawPrefixHeaderId||(C=M+C),f.ghCompatibleHeaderId?C=C.replace(/ /g,"-").replace(/&amp;/g,"").replace(/Â¨T/g,"").replace(/Â¨D/g,"").replace(/[&+$,\/:;=?@"#{}|^Â¨~\[\]`\\*)(%.!'<>]/g,"").toLowerCase():f.rawHeaderId?C=C.replace(/ /g,"-").replace(/&amp;/g,"&").replace(/Â¨T/g,"Â¨").replace(/Â¨D/g,"$").replace(/["']/g,"-").toLowerCase():C=C.replace(/[^\w]/g,"").toLowerCase(),f.rawPrefixHeaderId&&(C=M+C),u.hashLinkCounts[C]?C=C+"-"+u.hashLinkCounts[C]++:u.hashLinkCounts[C]=1,C}return i=u.converter._dispatch("headers.after",i,f,u),i}),n.subParser("horizontalRule",function(i,f,u){i=u.converter._dispatch("horizontalRule.before",i,f,u);var p=n.subParser("hashBlock")("<hr />",f,u);return i=i.replace(/^ {0,2}( ?-){3,}[ \t]*$/gm,p),i=i.replace(/^ {0,2}( ?\*){3,}[ \t]*$/gm,p),i=i.replace(/^ {0,2}( ?_){3,}[ \t]*$/gm,p),i=u.converter._dispatch("horizontalRule.after",i,f,u),i}),n.subParser("images",function(i,f,u){i=u.converter._dispatch("images.before",i,f,u);var p=/!\[([^\]]*?)][ \t]*()\([ \t]?<?([\S]+?(?:\([\S]*?\)[\S]*?)?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,y=/!\[([^\]]*?)][ \t]*()\([ \t]?<([^>]*)>(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(?:(["'])([^"]*?)\6))?[ \t]?\)/g,m=/!\[([^\]]*?)][ \t]*()\([ \t]?<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(["'])([^"]*?)\6)?[ \t]?\)/g,g=/!\[([^\]]*?)] ?(?:\n *)?\[([\s\S]*?)]()()()()()/g,b=/!\[([^\[\]]+)]()()()()()/g;function $(M,P,I,A,j,U,Y,k){return A=A.replace(/\s/g,""),C(M,P,I,A,j,U,Y,k)}function C(M,P,I,A,j,U,Y,k){var R=u.gUrls,F=u.gTitles,ee=u.gDimensions;if(I=I.toLowerCase(),k||(k=""),M.search(/\(<?\s*>? ?(['"].*['"])?\)$/m)>-1)A="";else if(A===""||A===null)if((I===""||I===null)&&(I=P.toLowerCase().replace(/ ?\n/g," ")),A="#"+I,!n.helper.isUndefined(R[I]))A=R[I],n.helper.isUndefined(F[I])||(k=F[I]),n.helper.isUndefined(ee[I])||(j=ee[I].width,U=ee[I].height);else return M;P=P.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),A=A.replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback);var Q='<img src="'+A+'" alt="'+P+'"';return k&&n.helper.isString(k)&&(k=k.replace(/"/g,"&quot;").replace(n.helper.regexes.asteriskDashAndColon,n.helper.escapeCharactersCallback),Q+=' title="'+k+'"'),j&&U&&(j=j==="*"?"auto":j,U=U==="*"?"auto":U,Q+=' width="'+j+'"',Q+=' height="'+U+'"'),Q+=" />",Q}return i=i.replace(g,C),i=i.replace(m,$),i=i.replace(y,C),i=i.replace(p,C),i=i.replace(b,C),i=u.converter._dispatch("images.after",i,f,u),i}),n.subParser("italicsAndBold",function(i,f,u){i=u.converter._dispatch("italicsAndBold.before",i,f,u);function p(y,m,g){return m+y+g}return f.literalMidWordUnderscores?(i=i.replace(/\b___(\S[\s\S]*?)___\b/g,function(y,m){return p(m,"<strong><em>","</em></strong>")}),i=i.replace(/\b__(\S[\s\S]*?)__\b/g,function(y,m){return p(m,"<strong>","</strong>")}),i=i.replace(/\b_(\S[\s\S]*?)_\b/g,function(y,m){return p(m,"<em>","</em>")})):(i=i.replace(/___(\S[\s\S]*?)___/g,function(y,m){return/\S$/.test(m)?p(m,"<strong><em>","</em></strong>"):y}),i=i.replace(/__(\S[\s\S]*?)__/g,function(y,m){return/\S$/.test(m)?p(m,"<strong>","</strong>"):y}),i=i.replace(/_([^\s_][\s\S]*?)_/g,function(y,m){return/\S$/.test(m)?p(m,"<em>","</em>"):y})),f.literalMidWordAsterisks?(i=i.replace(/([^*]|^)\B\*\*\*(\S[\s\S]*?)\*\*\*\B(?!\*)/g,function(y,m,g){return p(g,m+"<strong><em>","</em></strong>")}),i=i.replace(/([^*]|^)\B\*\*(\S[\s\S]*?)\*\*\B(?!\*)/g,function(y,m,g){return p(g,m+"<strong>","</strong>")}),i=i.replace(/([^*]|^)\B\*(\S[\s\S]*?)\*\B(?!\*)/g,function(y,m,g){return p(g,m+"<em>","</em>")})):(i=i.replace(/\*\*\*(\S[\s\S]*?)\*\*\*/g,function(y,m){return/\S$/.test(m)?p(m,"<strong><em>","</em></strong>"):y}),i=i.replace(/\*\*(\S[\s\S]*?)\*\*/g,function(y,m){return/\S$/.test(m)?p(m,"<strong>","</strong>"):y}),i=i.replace(/\*([^\s*][\s\S]*?)\*/g,function(y,m){return/\S$/.test(m)?p(m,"<em>","</em>"):y})),i=u.converter._dispatch("italicsAndBold.after",i,f,u),i}),n.subParser("lists",function(i,f,u){function p(g,b){u.gListLevel++,g=g.replace(/\n{2,}$/,`
`),g+="Â¨0";var $=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(Â¨0| {0,3}([*+-]|\d+[.])[ \t]+))/gm,C=/\n[ \t]*\n(?!Â¨0)/.test(g);return f.disableForced4SpacesIndentedSublists&&($=/(\n)?(^ {0,3})([*+-]|\d+[.])[ \t]+((\[(x|X| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(Â¨0|\2([*+-]|\d+[.])[ \t]+))/gm),g=g.replace($,function(M,P,I,A,j,U,Y){Y=Y&&Y.trim()!=="";var k=n.subParser("outdent")(j,f,u),R="";return U&&f.tasklists&&(R=' class="task-list-item" style="list-style-type: none;"',k=k.replace(/^[ \t]*\[(x|X| )?]/m,function(){var F='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return Y&&(F+=" checked"),F+=">",F})),k=k.replace(/^([-*+]|\d\.)[ \t]+[\S\n ]*/g,function(F){return"Â¨A"+F}),P||k.search(/\n{2,}/)>-1?(k=n.subParser("githubCodeBlocks")(k,f,u),k=n.subParser("blockGamut")(k,f,u)):(k=n.subParser("lists")(k,f,u),k=k.replace(/\n$/,""),k=n.subParser("hashHTMLBlocks")(k,f,u),k=k.replace(/\n\n+/g,`

`),C?k=n.subParser("paragraphs")(k,f,u):k=n.subParser("spanGamut")(k,f,u)),k=k.replace("Â¨A",""),k="<li"+R+">"+k+`</li>
`,k}),g=g.replace(/Â¨0/g,""),u.gListLevel--,b&&(g=g.replace(/\s+$/,"")),g}function y(g,b){if(b==="ol"){var $=g.match(/^ *(\d+)\./);if($&&$[1]!=="1")return' start="'+$[1]+'"'}return""}function m(g,b,$){var C=f.disableForced4SpacesIndentedSublists?/^ ?\d+\.[ \t]/gm:/^ {0,3}\d+\.[ \t]/gm,M=f.disableForced4SpacesIndentedSublists?/^ ?[*+-][ \t]/gm:/^ {0,3}[*+-][ \t]/gm,P=b==="ul"?C:M,I="";if(g.search(P)!==-1)(function j(U){var Y=U.search(P),k=y(g,b);Y!==-1?(I+=`

<`+b+k+`>
`+p(U.slice(0,Y),!!$)+"</"+b+`>
`,b=b==="ul"?"ol":"ul",P=b==="ul"?C:M,j(U.slice(Y))):I+=`

<`+b+k+`>
`+p(U,!!$)+"</"+b+`>
`})(g);else{var A=y(g,b);I=`

<`+b+A+`>
`+p(g,!!$)+"</"+b+`>
`}return I}return i=u.converter._dispatch("lists.before",i,f,u),i+="Â¨0",u.gListLevel?i=i.replace(/^(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(Â¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(g,b,$){var C=$.search(/[*+-]/g)>-1?"ul":"ol";return m(b,C,!0)}):i=i.replace(/(\n\n|^\n?)(( {0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(Â¨0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,function(g,b,$,C){var M=C.search(/[*+-]/g)>-1?"ul":"ol";return m($,M,!1)}),i=i.replace(/Â¨0/,""),i=u.converter._dispatch("lists.after",i,f,u),i}),n.subParser("metadata",function(i,f,u){if(!f.metadata)return i;i=u.converter._dispatch("metadata.before",i,f,u);function p(y){u.metadata.raw=y,y=y.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),y=y.replace(/\n {4}/g," "),y.replace(/^([\S ]+): +([\s\S]+?)$/gm,function(m,g,b){return u.metadata.parsed[g]=b,""})}return i=i.replace(/^\s*Â«Â«Â«+(\S*?)\n([\s\S]+?)\nÂ»Â»Â»+\n/,function(y,m,g){return p(g),"Â¨M"}),i=i.replace(/^\s*---+(\S*?)\n([\s\S]+?)\n---+\n/,function(y,m,g){return m&&(u.metadata.format=m),p(g),"Â¨M"}),i=i.replace(/Â¨M/g,""),i=u.converter._dispatch("metadata.after",i,f,u),i}),n.subParser("outdent",function(i,f,u){return i=u.converter._dispatch("outdent.before",i,f,u),i=i.replace(/^(\t|[ ]{1,4})/gm,"Â¨0"),i=i.replace(/Â¨0/g,""),i=u.converter._dispatch("outdent.after",i,f,u),i}),n.subParser("paragraphs",function(i,f,u){i=u.converter._dispatch("paragraphs.before",i,f,u),i=i.replace(/^\n+/g,""),i=i.replace(/\n+$/g,"");for(var p=i.split(/\n{2,}/g),y=[],m=p.length,g=0;g<m;g++){var b=p[g];b.search(/Â¨(K|G)(\d+)\1/g)>=0?y.push(b):b.search(/\S/)>=0&&(b=n.subParser("spanGamut")(b,f,u),b=b.replace(/^([ \t]*)/g,"<p>"),b+="</p>",y.push(b))}for(m=y.length,g=0;g<m;g++){for(var $="",C=y[g],M=!1;/Â¨(K|G)(\d+)\1/.test(C);){var P=RegExp.$1,I=RegExp.$2;P==="K"?$=u.gHtmlBlocks[I]:M?$=n.subParser("encodeCode")(u.ghCodeBlocks[I].text,f,u):$=u.ghCodeBlocks[I].codeblock,$=$.replace(/\$/g,"$$$$"),C=C.replace(/(\n\n)?Â¨(K|G)\d+\2(\n\n)?/,$),/^<pre\b[^>]*>\s*<code\b[^>]*>/.test(C)&&(M=!0)}y[g]=C}return i=y.join(`
`),i=i.replace(/^\n+/g,""),i=i.replace(/\n+$/g,""),u.converter._dispatch("paragraphs.after",i,f,u)}),n.subParser("runExtension",function(i,f,u,p){if(i.filter)f=i.filter(f,p.converter,u);else if(i.regex){var y=i.regex;y instanceof RegExp||(y=new RegExp(y,"g")),f=f.replace(y,i.replace)}return f}),n.subParser("spanGamut",function(i,f,u){return i=u.converter._dispatch("spanGamut.before",i,f,u),i=n.subParser("codeSpans")(i,f,u),i=n.subParser("escapeSpecialCharsWithinTagAttributes")(i,f,u),i=n.subParser("encodeBackslashEscapes")(i,f,u),i=n.subParser("images")(i,f,u),i=n.subParser("anchors")(i,f,u),i=n.subParser("autoLinks")(i,f,u),i=n.subParser("simplifiedAutoLinks")(i,f,u),i=n.subParser("emoji")(i,f,u),i=n.subParser("underline")(i,f,u),i=n.subParser("italicsAndBold")(i,f,u),i=n.subParser("strikethrough")(i,f,u),i=n.subParser("ellipsis")(i,f,u),i=n.subParser("hashHTMLSpans")(i,f,u),i=n.subParser("encodeAmpsAndAngles")(i,f,u),f.simpleLineBreaks?/\n\nÂ¨K/.test(i)||(i=i.replace(/\n+/g,`<br />
`)):i=i.replace(/  +\n/g,`<br />
`),i=u.converter._dispatch("spanGamut.after",i,f,u),i}),n.subParser("strikethrough",function(i,f,u){function p(y){return f.simplifiedAutoLink&&(y=n.subParser("simplifiedAutoLinks")(y,f,u)),"<del>"+y+"</del>"}return f.strikethrough&&(i=u.converter._dispatch("strikethrough.before",i,f,u),i=i.replace(/(?:~){2}([\s\S]+?)(?:~){2}/g,function(y,m){return p(m)}),i=u.converter._dispatch("strikethrough.after",i,f,u)),i}),n.subParser("stripLinkDefinitions",function(i,f,u){var p=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?([^>\s]+)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=Â¨0))/gm,y=/^ {0,3}\[([^\]]+)]:[ \t]*\n?[ \t]*<?(data:.+?\/.+?;base64,[A-Za-z0-9+/=\n]+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n\n|(?=Â¨0)|(?=\n\[))/gm;i+="Â¨0";var m=function(g,b,$,C,M,P,I){return b=b.toLowerCase(),i.toLowerCase().split(b).length-1<2?g:($.match(/^data:.+?\/.+?;base64,/)?u.gUrls[b]=$.replace(/\s/g,""):u.gUrls[b]=n.subParser("encodeAmpsAndAngles")($,f,u),P?P+I:(I&&(u.gTitles[b]=I.replace(/"|'/g,"&quot;")),f.parseImgDimensions&&C&&M&&(u.gDimensions[b]={width:C,height:M}),""))};return i=i.replace(y,m),i=i.replace(p,m),i=i.replace(/Â¨0/,""),i}),n.subParser("tables",function(i,f,u){if(!f.tables)return i;var p=/^ {0,3}\|?.+\|.+\n {0,3}\|?[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*:?[ \t]*(?:[-=]){2,}[\s\S]+?(?:\n\n|Â¨0)/gm,y=/^ {0,3}\|.+\|[ \t]*\n {0,3}\|[ \t]*:?[ \t]*(?:[-=]){2,}[ \t]*:?[ \t]*\|[ \t]*\n( {0,3}\|.+\|[ \t]*\n)*(?:\n|Â¨0)/gm;function m(M){return/^:[ \t]*--*$/.test(M)?' style="text-align:left;"':/^--*[ \t]*:[ \t]*$/.test(M)?' style="text-align:right;"':/^:[ \t]*--*[ \t]*:$/.test(M)?' style="text-align:center;"':""}function g(M,P){var I="";return M=M.trim(),(f.tablesHeaderId||f.tableHeaderId)&&(I=' id="'+M.replace(/ /g,"_").toLowerCase()+'"'),M=n.subParser("spanGamut")(M,f,u),"<th"+I+P+">"+M+`</th>
`}function b(M,P){var I=n.subParser("spanGamut")(M,f,u);return"<td"+P+">"+I+`</td>
`}function $(M,P){for(var I=`<table>
<thead>
<tr>
`,A=M.length,j=0;j<A;++j)I+=M[j];for(I+=`</tr>
</thead>
<tbody>
`,j=0;j<P.length;++j){I+=`<tr>
`;for(var U=0;U<A;++U)I+=P[j][U];I+=`</tr>
`}return I+=`</tbody>
</table>
`,I}function C(M){var P,I=M.split(`
`);for(P=0;P<I.length;++P)/^ {0,3}\|/.test(I[P])&&(I[P]=I[P].replace(/^ {0,3}\|/,"")),/\|[ \t]*$/.test(I[P])&&(I[P]=I[P].replace(/\|[ \t]*$/,"")),I[P]=n.subParser("codeSpans")(I[P],f,u);var A=I[0].split("|").map(function(Q){return Q.trim()}),j=I[1].split("|").map(function(Q){return Q.trim()}),U=[],Y=[],k=[],R=[];for(I.shift(),I.shift(),P=0;P<I.length;++P)I[P].trim()!==""&&U.push(I[P].split("|").map(function(Q){return Q.trim()}));if(A.length<j.length)return M;for(P=0;P<j.length;++P)k.push(m(j[P]));for(P=0;P<A.length;++P)n.helper.isUndefined(k[P])&&(k[P]=""),Y.push(g(A[P],k[P]));for(P=0;P<U.length;++P){for(var F=[],ee=0;ee<Y.length;++ee)n.helper.isUndefined(U[P][ee]),F.push(b(U[P][ee],k[ee]));R.push(F)}return $(Y,R)}return i=u.converter._dispatch("tables.before",i,f,u),i=i.replace(/\\(\|)/g,n.helper.escapeCharactersCallback),i=i.replace(p,C),i=i.replace(y,C),i=u.converter._dispatch("tables.after",i,f,u),i}),n.subParser("underline",function(i,f,u){return f.underline&&(i=u.converter._dispatch("underline.before",i,f,u),f.literalMidWordUnderscores?(i=i.replace(/\b___(\S[\s\S]*?)___\b/g,function(p,y){return"<u>"+y+"</u>"}),i=i.replace(/\b__(\S[\s\S]*?)__\b/g,function(p,y){return"<u>"+y+"</u>"})):(i=i.replace(/___(\S[\s\S]*?)___/g,function(p,y){return/\S$/.test(y)?"<u>"+y+"</u>":p}),i=i.replace(/__(\S[\s\S]*?)__/g,function(p,y){return/\S$/.test(y)?"<u>"+y+"</u>":p})),i=i.replace(/(_)/g,n.helper.escapeCharactersCallback),i=u.converter._dispatch("underline.after",i,f,u)),i}),n.subParser("unescapeSpecialChars",function(i,f,u){return i=u.converter._dispatch("unescapeSpecialChars.before",i,f,u),i=i.replace(/Â¨E(\d+)E/g,function(p,y){var m=parseInt(y);return String.fromCharCode(m)}),i=u.converter._dispatch("unescapeSpecialChars.after",i,f,u),i}),n.subParser("makeMarkdown.blockquote",function(i,f){var u="";if(i.hasChildNodes())for(var p=i.childNodes,y=p.length,m=0;m<y;++m){var g=n.subParser("makeMarkdown.node")(p[m],f);g!==""&&(u+=g)}return u=u.trim(),u="> "+u.split(`
`).join(`
> `),u}),n.subParser("makeMarkdown.codeBlock",function(i,f){var u=i.getAttribute("language"),p=i.getAttribute("precodenum");return"```"+u+`
`+f.preList[p]+"\n```"}),n.subParser("makeMarkdown.codeSpan",function(i){return"`"+i.innerHTML+"`"}),n.subParser("makeMarkdown.emphasis",function(i,f){var u="";if(i.hasChildNodes()){u+="*";for(var p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);u+="*"}return u}),n.subParser("makeMarkdown.header",function(i,f,u){var p=new Array(u+1).join("#"),y="";if(i.hasChildNodes()){y=p+" ";for(var m=i.childNodes,g=m.length,b=0;b<g;++b)y+=n.subParser("makeMarkdown.node")(m[b],f)}return y}),n.subParser("makeMarkdown.hr",function(){return"---"}),n.subParser("makeMarkdown.image",function(i){var f="";return i.hasAttribute("src")&&(f+="!["+i.getAttribute("alt")+"](",f+="<"+i.getAttribute("src")+">",i.hasAttribute("width")&&i.hasAttribute("height")&&(f+=" ="+i.getAttribute("width")+"x"+i.getAttribute("height")),i.hasAttribute("title")&&(f+=' "'+i.getAttribute("title")+'"'),f+=")"),f}),n.subParser("makeMarkdown.links",function(i,f){var u="";if(i.hasChildNodes()&&i.hasAttribute("href")){var p=i.childNodes,y=p.length;u="[";for(var m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);u+="](",u+="<"+i.getAttribute("href")+">",i.hasAttribute("title")&&(u+=' "'+i.getAttribute("title")+'"'),u+=")"}return u}),n.subParser("makeMarkdown.list",function(i,f,u){var p="";if(!i.hasChildNodes())return"";for(var y=i.childNodes,m=y.length,g=i.getAttribute("start")||1,b=0;b<m;++b)if(!(typeof y[b].tagName>"u"||y[b].tagName.toLowerCase()!=="li")){var $="";u==="ol"?$=g.toString()+". ":$="- ",p+=$+n.subParser("makeMarkdown.listItem")(y[b],f),++g}return p+=`
<!-- -->
`,p.trim()}),n.subParser("makeMarkdown.listItem",function(i,f){for(var u="",p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);return/\n$/.test(u)?u=u.split(`
`).join(`
    `).replace(/^ {4}$/gm,"").replace(/\n\n+/g,`

`):u+=`
`,u}),n.subParser("makeMarkdown.node",function(i,f,u){u=u||!1;var p="";if(i.nodeType===3)return n.subParser("makeMarkdown.txt")(i,f);if(i.nodeType===8)return"<!--"+i.data+`-->

`;if(i.nodeType!==1)return"";var y=i.tagName.toLowerCase();switch(y){case"h1":u||(p=n.subParser("makeMarkdown.header")(i,f,1)+`

`);break;case"h2":u||(p=n.subParser("makeMarkdown.header")(i,f,2)+`

`);break;case"h3":u||(p=n.subParser("makeMarkdown.header")(i,f,3)+`

`);break;case"h4":u||(p=n.subParser("makeMarkdown.header")(i,f,4)+`

`);break;case"h5":u||(p=n.subParser("makeMarkdown.header")(i,f,5)+`

`);break;case"h6":u||(p=n.subParser("makeMarkdown.header")(i,f,6)+`

`);break;case"p":u||(p=n.subParser("makeMarkdown.paragraph")(i,f)+`

`);break;case"blockquote":u||(p=n.subParser("makeMarkdown.blockquote")(i,f)+`

`);break;case"hr":u||(p=n.subParser("makeMarkdown.hr")(i,f)+`

`);break;case"ol":u||(p=n.subParser("makeMarkdown.list")(i,f,"ol")+`

`);break;case"ul":u||(p=n.subParser("makeMarkdown.list")(i,f,"ul")+`

`);break;case"precode":u||(p=n.subParser("makeMarkdown.codeBlock")(i,f)+`

`);break;case"pre":u||(p=n.subParser("makeMarkdown.pre")(i,f)+`

`);break;case"table":u||(p=n.subParser("makeMarkdown.table")(i,f)+`

`);break;case"code":p=n.subParser("makeMarkdown.codeSpan")(i,f);break;case"em":case"i":p=n.subParser("makeMarkdown.emphasis")(i,f);break;case"strong":case"b":p=n.subParser("makeMarkdown.strong")(i,f);break;case"del":p=n.subParser("makeMarkdown.strikethrough")(i,f);break;case"a":p=n.subParser("makeMarkdown.links")(i,f);break;case"img":p=n.subParser("makeMarkdown.image")(i,f);break;default:p=i.outerHTML+`

`}return p}),n.subParser("makeMarkdown.paragraph",function(i,f){var u="";if(i.hasChildNodes())for(var p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);return u=u.trim(),u}),n.subParser("makeMarkdown.pre",function(i,f){var u=i.getAttribute("prenum");return"<pre>"+f.preList[u]+"</pre>"}),n.subParser("makeMarkdown.strikethrough",function(i,f){var u="";if(i.hasChildNodes()){u+="~~";for(var p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);u+="~~"}return u}),n.subParser("makeMarkdown.strong",function(i,f){var u="";if(i.hasChildNodes()){u+="**";for(var p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f);u+="**"}return u}),n.subParser("makeMarkdown.table",function(i,f){var u="",p=[[],[]],y=i.querySelectorAll("thead>tr>th"),m=i.querySelectorAll("tbody>tr"),g,b;for(g=0;g<y.length;++g){var $=n.subParser("makeMarkdown.tableCell")(y[g],f),C="---";if(y[g].hasAttribute("style")){var M=y[g].getAttribute("style").toLowerCase().replace(/\s/g,"");switch(M){case"text-align:left;":C=":---";break;case"text-align:right;":C="---:";break;case"text-align:center;":C=":---:";break}}p[0][g]=$.trim(),p[1][g]=C}for(g=0;g<m.length;++g){var P=p.push([])-1,I=m[g].getElementsByTagName("td");for(b=0;b<y.length;++b){var A=" ";typeof I[b]<"u"&&(A=n.subParser("makeMarkdown.tableCell")(I[b],f)),p[P].push(A)}}var j=3;for(g=0;g<p.length;++g)for(b=0;b<p[g].length;++b){var U=p[g][b].length;U>j&&(j=U)}for(g=0;g<p.length;++g){for(b=0;b<p[g].length;++b)g===1?p[g][b].slice(-1)===":"?p[g][b]=n.helper.padEnd(p[g][b].slice(-1),j-1,"-")+":":p[g][b]=n.helper.padEnd(p[g][b],j,"-"):p[g][b]=n.helper.padEnd(p[g][b],j);u+="| "+p[g].join(" | ")+` |
`}return u.trim()}),n.subParser("makeMarkdown.tableCell",function(i,f){var u="";if(!i.hasChildNodes())return"";for(var p=i.childNodes,y=p.length,m=0;m<y;++m)u+=n.subParser("makeMarkdown.node")(p[m],f,!0);return u.trim()}),n.subParser("makeMarkdown.txt",function(i){var f=i.nodeValue;return f=f.replace(/ +/g," "),f=f.replace(/Â¨NBSP;/g," "),f=n.helper.unescapeHTMLEntities(f),f=f.replace(/([*_~|`])/g,"\\$1"),f=f.replace(/^(\s*)>/g,"\\$1>"),f=f.replace(/^#/gm,"\\#"),f=f.replace(/^(\s*)([-=]{3,})(\s*)$/,"$1\\$2$3"),f=f.replace(/^( {0,3}\d+)\./gm,"$1\\."),f=f.replace(/^( {0,3})([+-])/gm,"$1\\$2"),f=f.replace(/]([\s]*)\(/g,"\\]$1\\("),f=f.replace(/^ {0,3}\[([\S \t]*?)]:/gm,"\\[$1]:"),f});var W=this;a.exports?a.exports=n:W.showdown=n}).call(Ji)})(Ka);var er=Ka.exports;function tr(a){return a.type==="CURVE"}function nr(a){return a.type==="IMAGE"}function da(a,e){return Math.round(a/e)*e}function la(a,e){return Math.floor(a/e)*e}function Xn(a){return a*(Math.PI/180)}function ar(a){return a*(180/Math.PI)}function ua(a,e,t){return a*(1-t)+e*t}class ir{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const r=Math.cos(Xn(n)),o=Math.sin(Xn(n)),s=this.subtract(e,t);return{x:t.x+r*s.x-o*s.y,y:t.y+o*s.x+r*s.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:da(e.x,t.x),y:da(e.y,t.y)}}static floorTo(e,t){return{x:la(e.x,t.x),y:la(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(let h of e)t=h.x<t?h.x:t,n=h.x>n?h.x:n,r=h.y<r?h.y:r,o=h.y>o?h.y:o;let s=n-t,l=o-r,c={x:(t+n)/2,y:(r+o)/2};return{min:{x:t,y:r},max:{x:n,y:o},width:s,height:l,center:c}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let r=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){const l=t[o].y>e.y,c=t[s].y>e.y;l!==c&&e.x<(t[s].x-t[o].x)*(e.y-t[o].y)/(t[s].y-t[o].y)+t[o].x&&(r=!r)}return r}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:ua(e.x,t.x,n),y:ua(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class ze{static inverse(e){const[t,n,r,o,s,l,c,h,v]=e,E=t*(s*v-h*l)-n*(o*v-l*c)+r*(o*h-s*c);if(Math.abs(E)<1e-14)return e;const N=1/E,D=(s*v-h*l)*N,S=(r*h-n*v)*N,V=(n*l-r*s)*N,z=(l*c-o*v)*N,H=(t*v-r*c)*N,L=(o*r-t*l)*N,W=(o*h-c*s)*N,i=(c*n-t*h)*N,f=(t*s-o*n)*N;return[D,S,V,z,H,L,W,i,f]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Xn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=ze.fromPosition(e.position),n=ze.fromScale(e.scale),r=ze.fromRotation(e.rotation);return ze.multiply(ze.multiply(t,r),n)}static decompose(e){const[t,n,r,o,s,l]=e,c=t*s-o*n,h={position:{x:r,y:l},rotation:0,scale:{x:1,y:1}};if(t!=0||o!=0){var v=Math.sqrt(t*t+o*o);h.rotation=o>0?Math.acos(t/v):-Math.acos(t/v),h.scale={x:v,y:c/v}}else if(n!=0||s!=0){var E=Math.sqrt(n*n+s*s);h.rotation=Math.PI/2-(s>0?Math.acos(-n/E):-Math.acos(n/E)),h.scale={x:c/E,y:E}}return h.rotation=ar(h.rotation),h}}function Tn(){return`${d.EXTENSIONID}/Persistence/${w.playerId}/${w.sceneId}`}function rr(){const a=document.createElement("img");return a.id="PatreonButton",a.setAttribute("class","icon"),a.classList.add("patreon-clickable"),a.setAttribute("title",w.USER_REGISTERED?"Thanks for subscribing!":"Get the news on updates on the Battle-System Patreon"),a.setAttribute("src",w.USER_REGISTERED?"/w-thankyou.svg":"/w-patreon-2.png"),a.onclick=async function(e){e.preventDefault(),window.open("https://www.patreon.com/battlesystem","_blank")},a}function sr(a){const e=[];for(const n of a){const r=n[0];if(r===0){const[o,s,l]=n;e.push({x:s,y:l})}else if(r===2){const[o,s,l,c,h]=n;e.push({x:s,y:l}),e.push({x:c,y:h})}else if(r===4){const[o,s,l,c,h,v,E]=n,D=e[e.length-1],S={x:s,y:l},V={x:c,y:h},z={x:v,y:E},H=10;for(let L=1;L<=H;L++){const W=L/H,i=t(W,D,S,V,z);e.push(i)}}}return e;function t(n,r,o,s,l){const c=1-n,h=n*n,v=c*c,E=v*c,N=h*n,D=E*r.x+3*v*n*o.x+3*c*h*s.x+N*l.x,S=E*r.y+3*v*n*o.y+3*c*h*s.y+N*l.y;return{x:D,y:S}}}function on(a,e){const t=a.x-e.x,n=a.y-e.y;return Math.sqrt(t*t+n*n)}function ca(a,e){let t=!1;const n=e.length;let r=e[0];for(let o=1;o<=n;o++){const s=e[o%n];if(a.y>Math.min(r.y,s.y)&&a.y<=Math.max(r.y,s.y)&&a.x<=Math.max(r.x,s.x)&&r.y!=s.y){const l=(a.y-r.y)*(s.x-r.x)/(s.y-r.y)+r.x;(r.x==s.x||a.x<=l)&&(t=!t)}r=s}return t}function or(a,e){const t=a.points,n=e.points;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].x!==n[r].x||t[r].y!==n[r].y)return!1;return!0}function _n(a){a=a.replace(/^#/,"");let e=parseInt(a,16),t=e>>16&255,n=e>>8&255,r=e&255;return{x:t/255,y:n/255,z:r/255}}function fa(a,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",r=t.matches?"light":"dark";for(var o=0;o<e.styleSheets.length;o++)for(var s=0;s<e.styleSheets[o].cssRules.length;s++){let l=e.styleSheets[o].cssRules[s];l&&l.media&&l.media.mediaText.includes("prefers-color-scheme")&&(a.mode=="LIGHT"?(l.media.appendMedium(`(prefers-color-scheme: ${n})`),l.media.mediaText.includes(r)&&l.media.deleteMedium(`(prefers-color-scheme: ${r})`)):a.mode=="DARK"&&(l.media.appendMedium(`(prefers-color-scheme: ${r})`),l.media.mediaText.includes(n)&&l.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}function ve(){const a=w.sceneMetadata[`${d.EXTENSIONID}/toolWidth`],e=a!==void 0?parseInt(a):NaN;return Number.isNaN(e)?d.DEFAULTLINEWIDTH:e}function we(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionRangeDefault`];return a||d.ATTENUATIONDEFAULT}function Ve(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionSourceDefault`];return a||d.SOURCEDEFAULT}function Qe(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionFallOffDefault`];return a||d.FALLOFFDEFAULT}function dn(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionDarkDefault`];return a||d.DARKVISIONDEFAULT}function tt(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionInAngleDefault`];return a||d.INANGLEDEFAULT}function Ue(){const a=w.sceneMetadata[`${d.EXTENSIONID}/visionOutAngleDefault`];return a||d.OUTANGLEDEFAULT}function dr(a,e,t,n,r){const o=[[],[]];let s={x:0,y:0},l={x:0,y:0},c=-1,h=-1,v=1/0,E=1/0;const N=ga(a,n,r);for(let H=0;H<N.length-1;H++){const L=N[H],W=N[H+1],i=pa(L,W,e),f=pa(L,W,t),u=on(e,i),p=on(t,f);u<v&&(c=H,s=i,v=u),p<E&&(h=H,l=f,E=p)}(c>h||c===h&&ha(s,N[c],N[c+1])>ha(l,N[h],N[h+1]))&&([c,h]=[h,c],[s,l]=[l,s]);let S=[...N];c<=h?(S.splice(c+1,0,s),S.splice(h+2,0,l),o[0]=$t(S,0,c+1),o[1]=$t(S,h+2,S.length)):(S.splice(h+1,0,l),S.splice(c+2,0,s),o[0]=$t(S,0,h+1),o[1]=$t(S,c+2,S.length));const V=$t(S,c+1,h+2),z=o.map(H=>ga(H,-n,r));return{extracted:V,remaining:z}}function $t(a,e,t){return a.slice(e,t+1)}function pa(a,e,t){const n={x:e.x-a.x,y:e.y-a.y},r={x:t.x-a.x,y:t.y-a.y},o=r.x*n.x+r.y*n.y,s=n.x*n.x+n.y*n.y,l=o/s,c=Math.max(0,Math.min(1,l));return{x:a.x+c*n.x,y:a.y+c*n.y}}function ha(a,e,t){const n={x:a.x-e.x,y:a.y-e.y},r={x:t.x-e.x,y:t.y-e.y};return(n.x*r.x+n.y*r.y)/(r.x*r.x+r.y*r.y)}function lr(a,e,t){const n=e*(Math.PI/180),r=Math.cos(n),o=Math.sin(n),s=a.x-t.x,l=a.y-t.y;return{x:r*s-o*l+t.x,y:o*s+r*l+t.y}}function ga(a,e,t){return a.map(n=>lr(n,e,t))}function Lt(a){if(a.ctrlKey)return a.pointerPosition;const e=Math.round(w.gridDpi/w.gridSnap),t=Math.round(a.pointerPosition.x/w.gridDpi)*w.gridDpi,n=Math.round(a.pointerPosition.y/w.gridDpi)*w.gridDpi,r=Math.abs(t-a.pointerPosition.x),o=Math.abs(n-a.pointerPosition.y);let s,l;return r<=e?s=t:s=a.pointerPosition.x,o<=e?l=n:l=a.pointerPosition.y,{x:s,y:l}}let Te=null;async function Ya(){await T.popover.close(d.LINETOOLID)}async function Vn(){if(!Te)return;const[a,e]=Te;e(),Te=null,await Ya()}async function ln(){if(!Te)return;const[a,e]=Te,t=a(n=>{n.visible=!1,n.layer=d.LINELAYER,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,n.points.pop()});t.points.length>=2&&await T.scene.items.addItems([t]),e(),Te=null,await Ya()}async function Qa(){if(!Te)return;const[a]=Te;a(e=>{e.points.length>2&&e.points.pop()})}async function Ja(a,e){if(!e.transformer)if(Te){const[t]=Te;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Lt(e),n=w.snap?t:e.pointerPosition,r=be().tension(0).points([n,n]).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).build();Te=await T.interaction.startItemInteraction(r);const o=await T.viewport.getWidth();await T.popover.open({id:d.LINETOOLID,url:"/pages/line.html",height:75,width:350,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function ur(a,e){if(!Te||e.transformer)return;const[t]=Te,n=Lt(e);t(r=>{r.points[r.points.length-1]=w.snap?n:e.pointerPosition})}async function cr(a,e){await Ja(a,e),await ln()}function fr(a,e){Te&&(e.key=="Escape"?Vn():e.key=="Enter"?ln():e.key==="z"&&Qa())}const qt={onToolClick:Ja,onToolDouble:cr,onToolMove:ur,onKeyDown:fr};let _e=null;async function Za(){await T.popover.close(d.POLYTOOLID)}async function Hn(){if(!_e)return;const[a,e]=_e;e(),_e=null,Za(),await T.player.setMetadata({[`${d.EXTENSIONID}/cancelPoly`]:!1})}async function un(){if(!_e)return;const[a,e]=_e,t=a(n=>{n.visible=!1,n.layer=d.LINELAYER,n.style.fillOpacity=0,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&await T.scene.items.addItems([t]),e(),_e=null,Za(),await T.player.setMetadata({[`${d.EXTENSIONID}/finishPoly`]:!1})}async function ei(){if(!_e)return;const[a]=_e;a(e=>{e.points.length>2&&e.points.pop()})}async function ti(a,e){if(!e.transformer)if(_e){const[t]=_e;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Lt(e),n=w.snap?t:e.pointerPosition,r=be().tension(0).points([n,n]).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(.5).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Polygon)").locked(!0).build();_e=await T.interaction.startItemInteraction(r);const o=await T.viewport.getWidth();await T.popover.open({id:d.POLYTOOLID,url:"/pages/polygon.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:50,left:o/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function pr(a,e){if(!_e||e.transformer)return;const[t]=_e,n=Lt(e);t(r=>{r.points[r.points.length-1]=w.snap?n:e.pointerPosition})}async function hr(a,e){await ti(a,e),await un()}function gr(a,e){_e&&(e.key=="Escape"?Hn():e.key=="Enter"?un():e.key==="z"&&ei())}const Kt={onToolClick:ti,onToolDouble:hr,onToolMove:pr,onKeyDown:gr};let Ne=null;const ni=[];async function ai(){await T.popover.close(d.ELEVATIONTOOLID)}async function Kn(){if(!Ne)return;const[a,e]=Ne;e(),Ne=null,ai()}async function ii(){if(!Ne)return;const[a,e]=Ne,t=a(n=>{n.visible=!1,n.points.pop(),n.points.push(n.points[0])});if(t.points.length>=4){await T.scene.local.addItems([t]);let n=w.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`];n||(n=[]);const r=t.metadata[`${d.EXTENSIONID}/elevation`]??0,o={Points:t.points,Depth:r};n.push(o),await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:n})}e(),Ne=null,ai()}async function ri(){if(!Ne)return;const[a]=Ne;a(e=>{e.points.length>2&&e.points.pop()})}async function mr(a,e,t){if(!e.transformer)if(Ne){const[n]=Ne;n(r=>{r.points.push(e.pointerPosition)})}else{const n=Lt(e),r=w.snap?n:e.pointerPosition,o=be().tension(0).points([r,r]).strokeColor(si(t)).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??ni).strokeWidth(ve()).fillOpacity(.5).fillColor(oi(t)).layer(d.LINELAYER).metadata({[`${d.EXTENSIONID}/elevation`]:t}).name(`Elevation-${t} Area`).zIndex(t).locked(!0).build();Ne=await T.interaction.startItemInteraction(o);const s=await T.viewport.getWidth();await T.popover.open({id:d.ELEVATIONTOOLID,url:"/pages/elevation.html",height:75,width:400,disableClickAway:!0,hidePaper:!0,anchorPosition:{top:60,left:s/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}}function vr(a,e){if(!Ne||e.transformer)return;const[t]=Ne,n=Lt(e);t(r=>{r.points[r.points.length-1]=w.snap?n:e.pointerPosition})}function yr(a,e,t){Ne&&(e.key=="Escape"?Kn():e.key=="Enter"?ii():e.key==="z"&&ri())}async function Er(a){const e=a.metadata[`${d.EXTENSIONID}/elevationEditor`]??!1;if(await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!e}),e)await T.popover.close(d.ELEVATIONWARNID),await wr();else{const t=await T.viewport.getWidth();await T.popover.open({id:d.ELEVATIONWARNID,url:"/pages/ewarning.html",height:45,width:400,disableClickAway:!0,anchorPosition:{top:120,left:t/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}}),await Ir()}}async function Ir(a){const t=(await T.scene.getMetadata())[`${d.EXTENSIONID}/elevationMapping`]??[];if(t&&t.length>0){const n=[];for(const r of t){const o=be().tension(0).points(r.Points).strokeColor(si(r.Depth)).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??ni).strokeWidth(ve()).fillOpacity(.5).fillColor(oi(r.Depth)).layer(d.LINELAYER).name("Elevation-1 Area").locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/elevation`]:r.Depth}).zIndex(r.Depth).build();n.push(o)}await T.scene.local.addItems(n)}}async function wr(a){const e=w.sceneLocal.filter(t=>t.metadata[`${d.EXTENSIONID}/elevation`]!==void 0);if(e.length>0){const t=[];for(const n of e){let r=n.points;(n.position.x!==0||n.position.y!==0)&&(r=n.points.map(s=>{const l=s.x+n.position.x,c=s.y+n.position.y;return{x:l,y:c}}));const o={Points:r,Depth:n.metadata[`${d.EXTENSIONID}/elevation`]??0};t.push(o)}await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:t}),await T.scene.local.deleteItems(e.map(n=>n.id))}else await T.scene.setMetadata({[`${d.EXTENSIONID}/elevationMapping`]:[]})}function si(a){switch(a){case 1:return"#6454ac";case 2:return"#029658";case 3:return"#fcd444";case 4:return"#fc6404";case 5:return"#ff0000";default:return"#000000"}}function oi(a){switch(a){case 1:return"#6454ac4F";case 2:return"#0296584F";case 3:return"#fcd4444F";case 4:return"#fc64044F";case 5:return"#ff00004F";default:return"#0000004F"}}const he={onToolClick:mr,onToolMove:vr,onKeyDown:yr,enterEditMode:Er,cancelDrawing:Kn};function ma(a){return a.metadata[`${d.EXTENSIONID}/isIndicatorRing`]}function br(a){return a.type==="CURVE"&&a.metadata[`${d.EXTENSIONID}/isDoor`]}function Pt(a){return a.metadata[`${d.EXTENSIONID}/isVisionLine`]}function Tr(a){return a.metadata[`${d.EXTENSIONID}/isVisionLine`]&&!a.metadata[`${d.EXTENSIONID}/disabled`]}function _r(a){return a.metadata[`${d.SPECTREID}/isLocalSpectre`]}function Nr(a){return a.metadata[`${d.EXTENSIONID}/isVisionWall`]}function Sr(a){return a.metadata[`${d.EXTENSIONID}/isVisionLight`]}function Or(a){return a.metadata[`${d.EXTENSIONID}/isPersistentLight`]}function kr(a){return a.metadata[`${d.EXTENSIONID}/isLocalDecal`]}function Dr(a){return a.metadata[`${d.EXTENSIONID}/isDarkVision`]}function yt(a){return a.metadata[`${d.EXTENSIONID}/isTorch`]}function Nn(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&a.metadata[`${d.EXTENSIONID}/hasVision`]}function De(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&a.metadata[`${d.EXTENSIONID}/hasVision`]}function di(a){return(a.layer==="CHARACTER"||a.layer==="MOUNT"||a.layer==="ATTACHMENT"||a.layer==="PROP")&&a.createdUserId==w.playerId&&a.metadata[`${d.EXTENSIONID}/hasVision`]}function Cr(a){return a.metadata[`${d.EXTENSIONID}/isBrushSquare`]}class Lr{wallsToCreate=[];wallsToUpdate=[];wallsToDelete=[];wallsToError=[];lightsToCreate=[];lightsToUpdate=[];lightsToDelete=[];ringsToCreate=[];ringsToUpdate=[];ringsToDelete=[];decalsToCreate=[];decalsToUpdate=[];decalsToDelete=[];darkVisionToCreate=[];darkVisionToUpdate=[];darkVisionToDelete=[];revealersToCreate=[];revealersToUpdate=[];revealersToDelete=[];persistentLights=[];persistenceCullingDistance=1;persistenceLimit=50;trailingFoggedMaps=[];trailingFogTokens=[];constructor(){}async Initialize(){if(w.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0){const e=localStorage.getItem(Tn());if(e){const t=JSON.parse(e);if(t.length>0)for(let n of t)n.id=n.metadata[`${d.EXTENSIONID}/isPersistentLight`],this.AddPersistentLightToQueue(n,n.zIndex)}}}async Reset(){this.persistentLights=[],this.trailingFogTokens=[],this.trailingFoggedMaps=[]}async Run(){await this.UpdateTrailingFogMaps(),await this.UpdateWalls(),await this.UpdateDoors(),await this.UpdateLights(),await this.UpdateOwnershipHighlights(),await this.UpdateTrailingFogTokens(),w.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&localStorage.setItem(Tn(),JSON.stringify(this.persistentLights))}async UpdateTrailingFogMaps(){w.sceneMetadata[`${d.EXTENSIONID}/trailingFog`]===!0&&await this.CreateTrailingFogOverlay()}async UpdateTrailingFogTokens(){if(w.sceneMetadata[`${d.EXTENSIONID}/trailingFog`]===!0)this.revealersToCreate.length>0&&(await T.scene.local.addItems(this.revealersToCreate),this.revealersToCreate=[]);else if(this.trailingFogTokens.length>0||this.trailingFoggedMaps.length>0){const e=w.sceneLocal.filter(n=>n.metadata[`${d.EXTENSIONID}/isTrailingFogLight`]!==void 0),t=w.sceneLocal.filter(n=>n.metadata[`${d.EXTENSIONID}/isTrailingFogger`]!==void 0);t.length>0&&await T.scene.local.deleteItems(t.map(n=>n.id)),e.length>0&&await T.scene.local.deleteItems(e.map(n=>n.id)),this.trailingFogTokens=[],this.trailingFoggedMaps=[]}}async UpdateTrailingFogColor(e){const t=w.sceneLocal.filter(r=>r.metadata[`${d.EXTENSIONID}/isTrailingFogLight`]!==void 0);await T.scene.local.updateItems(t.map(r=>r.id),r=>{for(let o of r)o.uniforms=[{name:"darknessLevel",value:.65},{name:"darknessColor",value:_n(e)},{name:"radiusRatio",value:1}]});const n=w.sceneLocal.filter(r=>r.metadata[`${d.EXTENSIONID}/isTrailingFogger`]!==void 0);await T.scene.local.updateItems(n.map(r=>r.id),r=>{for(let o of r)o.uniforms=[{name:"darknessLevel",value:.65},{name:"darknessColor",value:_n(e)}]})}CreateTrailingFogRevealer(e){if(w.sceneMetadata[`${d.EXTENSIONID}/trailingFog`]===!0&&!this.trailingFogTokens.includes(e.id)){const t=bn().position(e.position).attachedTo(e.id).scale(e.scale).width(200).height(200).effectType("ATTACHMENT").layer("POST_PROCESS").sksl(d.TRAILINGFOGREVEALSHADER).uniforms([{name:"radiusRatio",value:1}]).metadata({[`${d.EXTENSIONID}/isTrailingFogLight`]:e.id}).disableHit(!0).build();this.revealersToCreate.push(t),this.trailingFogTokens.push(e.id)}}async CreateTrailingFogOverlay(){const e=[],t=w.sceneItems.filter(n=>n.layer==="MAP"&&n.type==="IMAGE");for(const n of t)if(!this.trailingFoggedMaps.includes(n.id)){const r=bn().position(n.position).attachedTo(n.id).scale(n.scale).width(n.image.width).height(n.image.height).effectType("ATTACHMENT").layer("POST_PROCESS").sksl(d.TRAILINGFOGSHADER).uniforms([{name:"darknessLevel",value:.65},{name:"darknessColor",value:_n(w.fogColor)}]).metadata({[`${d.EXTENSIONID}/isTrailingFogger`]:n.id}).disableHit(!0).build();e.push(r),this.trailingFoggedMaps.push(n.id)}e.length>0&&await T.scene.local.addItems(e)}async ClearDoors(){if(w.playerRole!=="PLAYER")return;const e=w.sceneLocal.filter(t=>t.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);await T.scene.local.deleteItems(e.map(t=>t.id))}async UpdateDoors(){if(w.playerRole==="PLAYER"&&w.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]!==!0)return;const e=w.sceneItems.filter(n=>br(n)),t=w.sceneLocal.filter(n=>n.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);if(e.length>0){const n=[];for(const r of e)if(!t.some(o=>o.metadata[`${d.EXTENSIONID}/doorId`]===r.id)){const o=r.metadata[`${d.EXTENSIONID}/doorOpen`]===!0,s=r.metadata[`${d.EXTENSIONID}/isDoorLocked`]===!0,l=ze.fromItem(r),c=[];for(let N=0;N<r.points.length;N++){const D=ze.fromPosition(r.points[N]);c.push(ze.decompose(ze.multiply(l,D)).position)}let h=d.DOOROPEN,v="Opened Door";w.playerRole==="GM"&&s?(h=d.DOORLOCKED,v="Locked Door"):o||(h=d.DOORCLOSED,v="Closed Door");const E=ir.centroid(c);n.push(sn({height:100,width:100,url:h,mime:"image/svg+xml"},{dpi:150,offset:{x:50,y:50}}).scale({x:.5,y:.5}).layer("DRAWING").locked(!0).name(v).position({x:E.x,y:E.y}).metadata({[`${d.EXTENSIONID}/doorId`]:r.id}).build())}n.length>0&&await T.scene.local.addItems(n)}else t.length>0&&await T.scene.local.deleteItems(t.map(n=>n.id));if(t.length>0){const n=[],r=[],o=[],s=[];for(const l of t){const c=w.sceneItems.find(h=>h.id===l.metadata[`${d.EXTENSIONID}/doorId`]);c?c.metadata[`${d.EXTENSIONID}/isDoor`]===void 0?s.push(l.id):w.playerRole==="GM"&&l.image.url!==d.DOORLOCKED&&c.metadata[`${d.EXTENSIONID}/isDoorLocked`]===!0?o.push(l.id):l.image.url!==d.DOOROPEN&&c.metadata[`${d.EXTENSIONID}/doorOpen`]===!0?n.push(l.id):l.image.url!==d.DOORCLOSED&&c.metadata[`${d.EXTENSIONID}/doorOpen`]!==!0&&(w.playerRole==="GM"&&c.metadata[`${d.EXTENSIONID}/isDoorLocked`]!==!0||w.playerRole==="PLAYER")&&r.push(l.id):s.push(l.id)}o.length>0&&await T.scene.local.updateItems(l=>o.includes(l.id),l=>{for(let c of l)c.image.url=d.DOORLOCKED,c.name="Locked Door"}),n.length>0&&await T.scene.local.updateItems(l=>n.includes(l.id),l=>{for(let c of l)c.image.url=d.DOOROPEN,c.name="Opened Door"}),r.length>0&&await T.scene.local.updateItems(l=>r.includes(l.id),l=>{for(let c of l)c.image.url=d.DOORCLOSED,c.name="Closed Door"}),s.length>0&&await T.scene.local.deleteItems(s)}}async ClearPersistence(){await T.scene.local.deleteItems(this.persistentLights.map(e=>e.id)),this.persistentLights=[],localStorage.setItem(Tn(),JSON.stringify(this.persistentLights))}async TogglePersistentLightVisibility(e){await T.scene.local.updateItems(t=>Or(t)!==void 0,t=>{for(let n of t)n.visible=!e})}async ClearOwnershipHighlights(){const e=w.sceneLocal.filter(t=>ma(t));await T.scene.local.deleteItems(e.map(t=>t.id))}async InitiateOwnerHighlight(){if(w.playerRole!=="GM"||w.fogFilled===!1)return;const e=w.sceneItems.filter(t=>Nn(t));for(const t of e)this.CreateOwnerHighlight(t,!0)}CreateOwnerHighlight(e,t=!1){if((w.playerRole!=="GM"||w.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0)&&!t)return;const n=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),r=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]);if(w.sceneLocal.find(s=>s.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0&&s.attachedTo===e.id))this.UpdateOwnerHightlight(e);else{const s=w.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`],l=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we()),c=Gi().strokeColor(s.color).fillOpacity(0).position({x:e.position.x,y:e.position.y}).width(n?r*2:l*2).height(n?r*2:l*2).shapeType("CIRCLE").metadata({[`${d.EXTENSIONID}/isIndicatorRing`]:!0}).attachedTo(e.id).locked(!0).layer(d.LINELAYER).disableAttachmentBehavior(["SCALE"]).zIndex(1).build();this.ringsToCreate.push(c)}}UpdateDarkVision(e){const t=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we()),n=w.sceneLocal.find(r=>r.attachedTo===e.id&&r.metadata[`${d.EXTENSIONID}/isDarkVision`]===!0);if(n){const r={id:n.id,size:t};this.darkVisionToUpdate.push(r)}}UpdateOwnerHightlight(e){if(w.playerRole!=="GM"||w.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0)return;const t=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),n=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]),r=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we()),o=w.sceneLocal.find(s=>s.attachedTo===e.id&&s.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0);if(o){const s={id:o.id,height:t?n*2:r*2,width:t?n*2:r*2};this.ringsToUpdate.push(s)}}async UpdateOwnershipHighlights(){if(w.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0){if(this.ringsToCreate.length>0&&await T.scene.local.addItems(this.ringsToCreate),this.ringsToDelete.length>0&&await T.scene.local.deleteItems(this.ringsToDelete),this.ringsToUpdate.length>0){const e=w.sceneLocal.filter(t=>ma(t));await T.scene.local.updateItems(e.filter(t=>!this.ringsToDelete.includes(t.id)),t=>{for(let n of t){const r=this.ringsToUpdate.find(o=>o.id===n.id);r&&(n.height=r.height,n.width=r.width)}})}this.ringsToCreate=[],this.ringsToUpdate=[],this.ringsToDelete=[]}}async UpdateLights(){let e=[];if(w.playerRole==="GM"){const s=document.getElementById("preview_select");s&&s?.value!==w.playerId?e=w.sceneItems.filter(l=>(l.layer==="CHARACTER"||l.layer==="MOUNT"||l.layer==="ATTACHMENT"||l.layer==="PROP")&&l.createdUserId===s.value&&l.metadata[`${d.EXTENSIONID}/hasVision`]):e=w.sceneItems.filter(l=>Nn(l))}else{const s=w.party.filter(h=>h.role==="GM").map(h=>h.id),l=w.sceneItems.filter(h=>Nn(h)&&s.includes(h.createdUserId));e=[...w.sceneItems.filter(h=>di(h)),...l]}w.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0&&(e=[]);const t=w.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`]??[];for(const s of e){let l=-10;for(const h of t)ca(s.position,h.Points)&&h.Depth>l&&(l=h.Depth);const c=w.sceneLocal.find(h=>h.metadata[`${d.EXTENSIONID}/isVisionLight`]===s.id);if(!c)this.CreateLightToQueue(s,l);else{let h=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionRange`])===c.attenuationRadius;parseInt(s.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(s.metadata[`${d.EXTENSIONID}/visionRange`])&&(h=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionDark`])===c.attenuationRadius);const v=this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionSourceRange`])===c.sourceRadius,E=s.metadata[`${d.EXTENSIONID}/visionFallOff`]===c.falloff.toString(),N=s.metadata[`${d.EXTENSIONID}/visionInAngle`]===c.innerAngle.toString(),D=s.metadata[`${d.EXTENSIONID}/visionOutAngle`]===c.outerAngle.toString(),S=s.metadata[`${d.EXTENSIONID}/visionBlind`]===c.metadata[`${d.EXTENSIONID}/visionBlind`],V=this.GetDepth(l,!1)===c.zIndex;(!h||!v||!E||!N||!D||!S||!V)&&this.UpdateLightToQueue(s,c,l);const z=w.sceneLocal.find(H=>H.metadata[`${d.EXTENSIONID}/isDarkVision`]===s.id&&H.attachedTo===s.id);z?this.GetLightRange(s.metadata[`${d.EXTENSIONID}/visionRange`])===z.width||this.UpdateDarkVision(s):this.CreateDarkVisionToQueue(s),c.lightType==="PRIMARY"&&this.CreateTrailingFogRevealer(c)}s.layer==="CHARACTER"&&(s.metadata[`${d.EXTENSIONID}/visionInAngle`]!=="360"||s.metadata[`${d.EXTENSIONID}/visionOutAngle`]!=="360")&&(w.sceneLocal.find(v=>v.metadata[`${d.EXTENSIONID}/isLocalDecal`]===s.id)||this.CreateDecalToQueue(s)),w.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&s.metadata[`${d.EXTENSIONID}/visionBlind`]!==!0&&(this.persistentLights.find(v=>v.position.x===s.position.x&&v.position.y===s.position.y)?(s.metadata[`${d.EXTENSIONID}/visionInAngle`]!==360||s.metadata[`${d.EXTENSIONID}/visionInAngle`]!==360)&&this.IsPositionAndRotationClear(s.rotation,s.position)&&this.AddPersistentLightToQueue(s,l):this.IsPositionClear(s.position)&&this.AddPersistentLightToQueue(s,l))}const n=w.sceneLocal.filter(s=>Sr(s));for(const s of n)if(!e.find(c=>c.id===s.metadata[`${d.EXTENSIONID}/isVisionLight`])){this.lightsToDelete.push(s.id);const c=w.sceneLocal.find(h=>h.metadata[`${d.EXTENSIONID}/isIndicatorRing`]===!0&&h.attachedTo===s.metadata[`${d.EXTENSIONID}/isVisionLight`]);c&&this.ringsToDelete.push(c.id)}const r=w.sceneLocal.filter(s=>kr(s));for(const s of r){const l=e.find(c=>c.id===s.metadata[`${d.EXTENSIONID}/isLocalDecal`]);l?l.metadata[`${d.EXTENSIONID}/visionInAngle`]==="360"||l.metadata[`${d.EXTENSIONID}/visionOutAngle`]==="360"?this.decalsToDelete.push(s.id):l.image.url!==s.image.url&&this.decalsToUpdate.push({id:s.id,imageUrl:l.image.url}):this.decalsToDelete.push(s.id)}const o=w.sceneLocal.filter(s=>Dr(s));for(const s of o){const l=e.find(c=>c.id===s.metadata[`${d.EXTENSIONID}/isDarkVision`]);l?parseInt(l.metadata[`${d.EXTENSIONID}/visionDark`])<parseInt(l.metadata[`${d.EXTENSIONID}/visionRange`])&&this.decalsToDelete.push(s.id):this.decalsToDelete.push(s.id)}this.lightsToCreate.length>0&&await T.scene.local.addItems(this.lightsToCreate),this.lightsToDelete.length>0&&await T.scene.local.deleteItems(this.lightsToDelete),this.lightsToUpdate.length>0&&await T.scene.local.updateItems(n.filter(s=>!this.lightsToDelete.includes(s.id)),s=>{for(let l of s){const c=this.lightsToUpdate.find(h=>h.id===l.id);c&&(l.attenuationRadius=c.attenuationRadius,l.sourceRadius=c.sourceRadius,l.falloff=c.falloff,l.innerAngle=c.innerAngle,l.outerAngle=c.outerAngle,l.metadata[`${d.EXTENSIONID}/visionBlind`]=c.blind,l.zIndex=c.zIndex)}}),this.decalsToCreate.length>0&&await T.scene.local.addItems(this.decalsToCreate),this.decalsToDelete.length>0&&await T.scene.local.deleteItems(this.decalsToDelete),this.decalsToUpdate.length>0&&await T.scene.local.updateItems(r.filter(s=>!this.decalsToDelete.includes(s.id)),s=>{for(let l of s){const c=this.decalsToUpdate.find(h=>h.id===l.id);c&&(l.image.url=c.imageUrl)}}),this.darkVisionToCreate.length>0&&await T.scene.local.addItems(this.darkVisionToCreate),this.darkVisionToDelete.length>0&&await T.scene.local.deleteItems(this.darkVisionToDelete),this.darkVisionToUpdate.length>0&&await T.scene.local.updateItems(o.filter(s=>!this.darkVisionToDelete.includes(s.id)),s=>{for(let l of s){const c=this.darkVisionToUpdate.find(h=>h.id===l.id);c&&(l.width=c.size,l.height=c.size)}}),this.lightsToCreate=[],this.lightsToUpdate=[],this.lightsToDelete=[],this.decalsToCreate=[],this.decalsToDelete=[],this.decalsToUpdate=[],this.darkVisionToCreate=[],this.darkVisionToUpdate=[],this.darkVisionToDelete=[]}async UpdateWalls(){const e=w.sceneMetadata[`${d.EXTENSIONID}/elevationMapping`]??[],t=w.sceneMetadata[`${d.EXTENSIONID}/passWallsGM`]===!0&&w.playerRole==="GM",n=w.sceneItems.filter(o=>Tr(o));for(const o of n){if(o.type!=="CURVE"||o.points===void 0){this.wallsToError.push(o.id);continue}let s=-10;for(const c of e)ca(o.points[0],c.Points)&&c.Depth>s&&(s=c.Depth);const l=w.sceneLocal.find(c=>c.metadata[`${d.EXTENSIONID}/isVisionWall`]===o.id);if(!l)this.CreateWallToQueue(o,s);else{const c=or(o,l),h=o.rotation===l.rotation,v=o.scale.x===l.scale.x&&o.scale.y===l.scale.y,E=o.position.x===l.position.x&&o.position.y===l.position.y,N=o.metadata[`${d.EXTENSIONID}/doubleSided`]===l.doubleSided,D=this.GetDepth(s,!0)===l.zIndex;let S=(t?!1:o.metadata[`${d.EXTENSIONID}/blocking`])===l.blocking;(!c||!E||!h||!v||!S||!N||!D)&&this.UpdateWallToQueue(o,l,s)}}const r=w.sceneLocal.filter(o=>Nr(o));for(const o of r)n.find(l=>l.id===o.metadata[`${d.EXTENSIONID}/isVisionWall`])||this.wallsToDelete.push(o.id);this.wallsToCreate.length>0&&await T.scene.local.addItems(this.wallsToCreate),this.wallsToDelete.length>0&&await T.scene.local.deleteItems(this.wallsToDelete),this.wallsToUpdate.length>0&&await T.scene.local.updateItems(r.filter(o=>!this.wallsToDelete.includes(o.id)),o=>{for(let s of o){const l=this.wallsToUpdate.find(c=>c.id===s.id);l&&(s.points=l.points,s.position=l.position,s.rotation=l.rotation,s.scale=l.scale,s.blocking=l.blocking,s.doubleSided=l.doubleSided,s.zIndex=l.zIndex)}}),this.wallsToError.length>0&&await T.scene.items.updateItems(this.wallsToError,o=>{for(let s of o)s.style.strokeDash=[10,30],s.style.strokeColor="red",delete s.metadata[`${d.EXTENSIONID}/isDoorLocked`],delete s.metadata[`${d.EXTENSIONID}/doorOpen`],delete s.metadata[`${d.EXTENSIONID}/disabled`],delete s.metadata[`${d.EXTENSIONID}/isDoor`],delete s.metadata[`${d.EXTENSIONID}/doubleSided`],delete s.metadata[`${d.EXTENSIONID}/disabled`],delete s.metadata[`${d.EXTENSIONID}/isVisionLine`],delete s.metadata[`${d.EXTENSIONID}/blocking`]}),this.wallsToCreate=[],this.wallsToUpdate=[],this.wallsToDelete=[],this.wallsToError=[]}CreateWallToQueue(e,t){if(!e.points)return;let n=e.metadata[`${d.EXTENSIONID}/blocking`]??!1;w.playerRole==="GM"&&w.sceneMetadata[`${d.EXTENSIONID}/passWallsGM`]===!0&&(n=!1);const r=Wi().points(e.points).rotation(e.rotation).position(e.position).locked(!0).scale(e.scale).blocking(n).doubleSided(e.metadata[`${d.EXTENSIONID}/doubleSided`]??!1).zIndex(this.GetDepth(t,!0)).metadata({[`${d.EXTENSIONID}/isVisionWall`]:e.id}).build();this.wallsToCreate.push(r)}AddPersistentLightToQueue(e,t){if((e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY")==="SECONDARY")return;const r=oa().position(e.position).lightType("AUXILIARY").rotation(e.rotation).attenuationRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we())).sourceRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??Ve(),!0)).falloff(parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??Qe())).innerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??tt())).outerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??Ue())).zIndex(this.GetDepth(t,!1)).metadata({[`${d.EXTENSIONID}/isPersistentLight`]:e.id}).build();if(this.lightsToCreate.push(r),this.persistentLights.push({id:r.id,position:r.position,rotation:r.rotation,zIndex:t,metadata:e.metadata}),this.persistenceLimit===this.persistentLights.length){const o=this.persistentLights.shift();this.lightsToDelete.push(o.id)}}CreateLightToQueue(e,t){const n=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",r=e.metadata[`${d.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we()),o=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),s=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]),l=oa().position(e.position).rotation(e.rotation).lightType(n).attenuationRadius(o?s:r).sourceRadius(this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??Ve(),!0)).falloff(parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??Qe())).innerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??tt())).outerAngle(parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??Ue())).zIndex(this.GetDepth(t,!1)).metadata({[`${d.EXTENSIONID}/isVisionLight`]:e.id,[`${d.EXTENSIONID}/visionBlind`]:e.metadata[`${d.EXTENSIONID}/visionBlind`]??!1}).attachedTo(e.id).disableAttachmentBehavior(["SCALE"]).build();this.lightsToCreate.push(l),n==="PRIMARY"&&(this.CreateDarkVisionToQueue(e),this.CreateOwnerHighlight(e))}CreateDarkVisionToQueue(e){const t=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`]),n=parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]);if(!t||!n||t<n)return;const r=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`])*2,o=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`])*2,s=r*.9/o/2,l=bn().position({x:e.position.x-o/2,y:e.position.y-o/2}).attachedTo(e.id).width(o).height(o).blendMode("SATURATION").effectType("STANDALONE").attachedTo(e.id).sksl(d.DARKVISIONSHADER).metadata({[`${d.EXTENSIONID}/isDarkVision`]:!0}).disableHit(!0).disableAttachmentBehavior(["SCALE"]).uniforms([{name:"center",value:{x:.5,y:.5}},{name:"radius",value:.5},{name:"clear",value:s},{name:"smoothwidth",value:.075}]).build();this.darkVisionToCreate.push(l)}CreateDecalToQueue(e){const t=sn({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).rotation(e.rotation).position(e.position).attachedTo(e.id).layer("FOG").visible(!1).metadata({[`${d.EXTENSIONID}/isLocalDecal`]:e.id}).disableHit(!0).build();this.decalsToCreate.push(t)}UpdateWallToQueue(e,t,n){if(!e.points)return;let r=e.metadata[`${d.EXTENSIONID}/blocking`]??!1;w.playerRole==="GM"&&w.sceneMetadata[`${d.EXTENSIONID}/passWallsGM`]===!0&&(r=!1);const o={id:t.id,points:e.points,rotation:e.rotation,position:e.position,scale:e.scale,blocking:r,doubleSided:e.metadata[`${d.EXTENSIONID}/doubleSided`]??!1,zIndex:this.GetDepth(n,!0)};this.wallsToUpdate.push(o)}UpdateLightToQueue(e,t,n){const r=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0?"SECONDARY":"PRIMARY",o=e.metadata[`${d.EXTENSIONID}/visionBlind`]===!0?0:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionRange`]??we()),s=parseInt(e.metadata[`${d.EXTENSIONID}/visionDark`])>parseInt(e.metadata[`${d.EXTENSIONID}/visionRange`]),l=this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionDark`]),c={id:t.id,attenuationRadius:s?l:o,sourceRadius:this.GetLightRange(e.metadata[`${d.EXTENSIONID}/visionSourceRange`]??Ve(),!0),falloff:parseFloat(e.metadata[`${d.EXTENSIONID}/visionFallOff`]??Qe()),innerAngle:parseInt(e.metadata[`${d.EXTENSIONID}/visionInAngle`]??tt()),outerAngle:parseInt(e.metadata[`${d.EXTENSIONID}/visionOutAngle`]??Ue()),blind:e.metadata[`${d.EXTENSIONID}/visionBlind`]??!1,zIndex:this.GetDepth(n,!1)};this.lightsToUpdate.push(c),r==="PRIMARY"&&this.UpdateOwnerHightlight(e)}GetLightRange(e,t=!1){return(t?parseFloat(e):parseInt(e))/w.gridScale*w.gridDpi}GetDepth(e,t){switch(e){case 1:return t?-4:-5;case 2:return t?-5:-6;case 3:return t?-6:-7;case 4:return t?-7:-8;case 5:return t?-8:-9;default:return-1}}IsPositionClear(e){const t=(w.gridDpi-10)*this.persistenceCullingDistance;for(const n of this.persistentLights)if(on(e,n.position)<=t)return!1;return!0}IsPositionAndRotationClear(e,t){const n=(w.gridDpi-10)*this.persistenceCullingDistance;for(const r of this.persistentLights)if(on(t,r.position)<=n&&e===r.rotation)return!1;return!0}async ToggleDoor(e){const t=w.sceneLocal.filter(n=>n.id===e&&n.metadata[`${d.EXTENSIONID}/doorId`]!==void 0);if(t.length===1){const n=w.sceneItems.filter(r=>r.id===t[0].metadata[`${d.EXTENSIONID}/doorId`]);if(n.length===1){const r=n[0];if(w.playerRole!=="GM"&&r.metadata[`${d.EXTENSIONID}/isDoorLocked`])return;await T.scene.items.updateItems(n,o=>{for(let s of o)s.metadata[`${d.EXTENSIONID}/isVisionLine`]&&s.metadata[`${d.EXTENSIONID}/disabled`]?(delete s.metadata[`${d.EXTENSIONID}/disabled`],delete s.metadata[`${d.EXTENSIONID}/doorOpen`]):s.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(s.metadata[`${d.EXTENSIONID}/disabled`]=!0,s.metadata[`${d.EXTENSIONID}/doorOpen`]=!0,delete s.metadata[`${d.EXTENSIONID}/isDoorLocked`])}),await T.player.deselect([e])}}}}const Ie=new Lr;function Sn(a,e){a.split(/\s+/).forEach(t=>{e(t)})}class Ar{constructor(){this._events=void 0,this._events={}}on(e,t){Sn(e,n=>{const r=this._events[n]||[];r.push(t),this._events[n]=r})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}Sn(e,r=>{if(n===1){delete this._events[r];return}const o=this._events[r];o!==void 0&&(o.splice(o.indexOf(t),1),this._events[r]=o)})}trigger(e,...t){var n=this;Sn(e,r=>{const o=n._events[r];o!==void 0&&o.forEach(s=>{s.apply(n,t)})})}}function Mr(a){return a.plugins={},class extends a{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){a.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const r=this,o=[];if(Array.isArray(e))e.forEach(s=>{typeof s=="string"?o.push(s):(r.plugins.settings[s.name]=s.options,o.push(s.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(r.plugins.settings[t]=e[t],o.push(t));for(;n=o.shift();)r.require(n)}loadPlugin(e){var t=this,n=t.plugins,r=a.plugins[e];if(!a.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=r.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const vn=a=>(a=a.filter(Boolean),a.length<2?a[0]||"":Pr(a)==1?"["+a.join("")+"]":"(?:"+a.join("|")+")"),li=a=>{if(!$r(a))return a.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return a.forEach((r,o)=>{if(r===a[o-1]){t++;return}n(),e+=r,t=1}),n(),e},ui=a=>{let e=Yn(a);return vn(e)},$r=a=>new Set(a).size!==a.length,Ht=a=>(a+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Pr=a=>a.reduce((e,t)=>Math.max(e,Rr(t)),0),Rr=a=>Yn(a).length,Yn=a=>Array.from(a);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const ci=a=>{if(a.length===1)return[[a]];let e=[];const t=a.substring(1);return ci(t).forEach(function(r){let o=r.slice(0);o[0]=a.charAt(0)+o[0],e.push(o),o=r.slice(0),o.unshift(a.charAt(0)),e.push(o)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const xr=[[0,65535]],Xr="[Ì€-Í¯Â·Ê¾Ê¼]";let cn,fi;const Vr=3,Qn={},va={"/":"â„âˆ•",0:"ß€",a:"â±¥ÉÉ‘",aa:"êœ³",ae:"Ã¦Ç½Ç£",ao:"êœµ",au:"êœ·",av:"êœ¹êœ»",ay:"êœ½",b:"Æ€É“Æƒ",c:"êœ¿ÆˆÈ¼â†„",d:"Ä‘É—É–á´…ÆŒê®·ÔÉ¦",e:"É›Çá´‡É‡",f:"ê¼Æ’",g:"Ç¥É ê¡áµ¹ê¿É¢",h:"Ä§â±¨â±¶É¥",i:"É¨Ä±",j:"É‰È·",k:"Æ™â±ªêêƒê…ê£",l:"Å‚ÆšÉ«â±¡ê‰ê‡êÉ­",m:"É±É¯Ï»",n:"ê¥ÆÉ²ê‘á´Ğ»Ô‰",o:"Ã¸Ç¿É”Éµê‹êá´‘",oe:"Å“",oi:"Æ£",oo:"ê",ou:"È£",p:"Æ¥áµ½ê‘ê“ê•Ï",q:"ê—ê™É‹",r:"ÉÉ½ê›ê§êƒ",s:"ÃŸÈ¿ê©ê…Ê‚",t:"Å§Æ­Êˆâ±¦ê‡",th:"Ã¾",tz:"êœ©",u:"Ê‰",v:"Ê‹êŸÊŒ",vy:"ê¡",w:"â±³",y:"Æ´Éá»¿",z:"Æ¶È¥É€â±¬ê£",hv:"Æ•"};for(let a in va){let e=va[a]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Qn[n]=a}}const Hr=new RegExp(Object.keys(Qn).join("|")+"|"+Xr,"gu"),Br=a=>{cn===void 0&&(cn=Ur(xr))},ya=(a,e="NFKD")=>a.normalize(e),fn=a=>Yn(a).reduce((e,t)=>e+Fr(t),""),Fr=a=>(a=ya(a).toLowerCase().replace(Hr,e=>Qn[e]||""),ya(a,"NFC"));function*jr(a){for(const[e,t]of a)for(let n=e;n<=t;n++){let r=String.fromCharCode(n),o=fn(r);o!=r.toLowerCase()&&(o.length>Vr||o.length!=0&&(yield{folded:o,composed:r,code_point:n}))}}const zr=a=>{const e={},t=(n,r)=>{const o=e[n]||new Set,s=new RegExp("^"+ui(o)+"$","iu");r.match(s)||(o.add(Ht(r)),e[n]=o)};for(let n of jr(a))t(n.folded,n.folded),t(n.folded,n.composed);return e},Ur=a=>{const e=zr(a),t={};let n=[];for(let o in e){let s=e[o];s&&(t[o]=ui(s)),o.length>1&&n.push(Ht(o))}n.sort((o,s)=>s.length-o.length);const r=vn(n);return fi=new RegExp("^"+r,"u"),t},Gr=(a,e=1)=>{let t=0;return a=a.map(n=>(cn[n]&&(t+=n.length),cn[n]||n)),t>=e?li(a):""},Wr=(a,e=1)=>(e=Math.max(e,a.length-1),vn(ci(a).map(t=>Gr(t,e)))),Ea=(a,e=!0)=>{let t=a.length>1?1:0;return vn(a.map(n=>{let r=[];const o=e?n.length():n.length()-1;for(let s=0;s<o;s++)r.push(Wr(n.substrs[s]||"",t));return li(r)}))},qr=(a,e)=>{for(const t of e){if(t.start!=a.start||t.end!=a.end||t.substrs.join("")!==a.substrs.join(""))continue;let n=a.parts;const r=s=>{for(const l of n){if(l.start===s.start&&l.substr===s.substr)return!1;if(!(s.length==1||l.length==1)&&(s.start<l.start&&s.end>l.start||l.start<s.start&&l.end>s.start))return!0}return!1};if(!(t.parts.filter(r).length>0))return!0}return!1};class pn{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new pn,r=JSON.parse(JSON.stringify(this.parts)),o=r.pop();for(const c of r)n.add(c);let s=t.substr.substring(0,e-o.start),l=s.length;return n.add({start:o.start,end:o.start+l,length:l,substr:s}),n}}const Kr=a=>{Br(),a=fn(a);let e="",t=[new pn];for(let n=0;n<a.length;n++){let o=a.substring(n).match(fi);const s=a.substring(n,n+1),l=o?o[0]:null;let c=[],h=new Set;for(const v of t){const E=v.last();if(!E||E.length==1||E.end<=n)if(l){const N=l.length;v.add({start:n,end:n+N,length:N,substr:l}),h.add("1")}else v.add({start:n,end:n+1,length:1,substr:s}),h.add("2");else if(l){let N=v.clone(n,E);const D=l.length;N.add({start:n,end:n+D,length:D,substr:l}),c.push(N)}else h.add("3")}if(c.length>0){c=c.sort((v,E)=>v.length()-E.length());for(let v of c)qr(v,t)||t.push(v);continue}if(n>0&&h.size==1&&!h.has("3")){e+=Ea(t,!1);let v=new pn;const E=t[0];E&&v.add(E.last()),t=[v]}}return e+=Ea(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Yr=(a,e)=>{if(a)return a[e]},Qr=(a,e)=>{if(a){for(var t,n=e.split(".");(t=n.shift())&&(a=a[t]););return a}},On=(a,e,t)=>{var n,r;return!a||(a=a+"",e.regex==null)||(r=a.search(e.regex),r===-1)?0:(n=e.string.length/a.length,r===0&&(n+=.5),n*t)},kn=(a,e)=>{var t=a[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(a[e]=[t])},me=(a,e)=>{if(Array.isArray(a))a.forEach(e);else for(var t in a)a.hasOwnProperty(t)&&e(a[t],t)},Jr=(a,e)=>typeof a=="number"&&typeof e=="number"?a>e?1:a<e?-1:0:(a=fn(a+"").toLowerCase(),e=fn(e+"").toLowerCase(),a>e?1:e>a?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Zr{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const r=[],o=e.split(/\s+/);var s;return n&&(s=new RegExp("^("+Object.keys(n).map(Ht).join("|")+"):(.*)$")),o.forEach(l=>{let c,h=null,v=null;s&&(c=l.match(s))&&(h=c[1],l=c[2]),l.length>0&&(this.settings.diacritics?v=Kr(l)||null:v=Ht(l),v&&t&&(v="\\b"+v)),r.push({string:l,regex:v?new RegExp(v,"iu"):null,field:h})}),r}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const r=e.options.fields,o=e.weights,s=r.length,l=e.getAttrFn;if(!s)return function(){return 1};const c=function(){return s===1?function(h,v){const E=r[0].field;return On(l(v,E),h,o[E]||1)}:function(h,v){var E=0;if(h.field){const N=l(v,h.field);!h.regex&&N?E+=1/s:E+=On(N,h,1)}else me(o,(N,D)=>{E+=On(l(v,D),h,N)});return E/s}}();return n===1?function(h){return c(t[0],h)}:e.options.conjunction==="and"?function(h){var v,E=0;for(let N of t){if(v=c(N,h),v<=0)return 0;E+=v}return E/n}:function(h){var v=0;return me(t,E=>{v+=c(E,h)}),v/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const r=this,o=e.options,s=!e.query&&o.sort_empty?o.sort_empty:o.sort;if(typeof s=="function")return s.bind(this);const l=function(v,E){return v==="$score"?E.score:e.getAttrFn(r.items[E.id],v)};if(s)for(let h of s)(e.query||h.field!=="$score")&&n.push(h);if(e.query){t=!0;for(let h of n)if(h.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(h=>h.field!=="$score");return n.length?function(h,v){var E,N;for(let D of n)if(N=D.field,E=(D.direction==="desc"?-1:1)*Jr(l(N,h),l(N,v)),E)return E;return 0}:null}prepareSearch(e,t){const n={};var r=Object.assign({},t);if(kn(r,"sort"),kn(r,"sort_empty"),r.fields){kn(r,"fields");const o=[];r.fields.forEach(s=>{typeof s=="string"&&(s={field:s,weight:1}),o.push(s),n[s.field]="weight"in s?s.weight:1}),r.fields=o}return{options:r,query:e.toLowerCase().trim(),tokens:this.tokenize(e,r.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:r.nesting?Qr:Yr}}search(e,t){var n=this,r,o;o=this.prepareSearch(e,t),t=o.options,e=o.query;const s=t.score||n._getScoreFunction(o);e.length?me(n.items,(c,h)=>{r=s(c),(t.filter===!1||r>0)&&o.items.push({score:r,id:h})}):me(n.items,(c,h)=>{o.items.push({score:1,id:h})});const l=n._getSortFunction(o);return l&&o.items.sort(l),o.total=o.items.length,typeof t.limit=="number"&&(o.items=o.items.slice(0,t.limit)),o}}const Tt=(a,e)=>{if(Array.isArray(a))a.forEach(e);else for(var t in a)a.hasOwnProperty(t)&&e(a[t],t)},pe=a=>{if(a.jquery)return a[0];if(a instanceof HTMLElement)return a;if(pi(a)){var e=document.createElement("template");return e.innerHTML=a.trim(),e.content.firstChild}return document.querySelector(a)},pi=a=>typeof a=="string"&&a.indexOf("<")>-1,es=a=>a.replace(/['"\\]/g,"\\$&"),Dn=(a,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),a.dispatchEvent(t)},Yt=(a,e)=>{Object.assign(a.style,e)},ge=(a,...e)=>{var t=hi(e);a=gi(a),a.map(n=>{t.map(r=>{n.classList.add(r)})})},Ye=(a,...e)=>{var t=hi(e);a=gi(a),a.map(n=>{t.map(r=>{n.classList.remove(r)})})},hi=a=>{var e=[];return Tt(a,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},gi=a=>(Array.isArray(a)||(a=[a]),a),tn=(a,e,t)=>{if(!(t&&!t.contains(a)))for(;a&&a.matches;){if(a.matches(e))return a;a=a.parentNode}},Ia=(a,e=0)=>e>0?a[a.length-1]:a[0],ts=a=>Object.keys(a).length===0,hn=(a,e)=>{if(!a)return-1;e=e||a.nodeName;for(var t=0;a=a.previousElementSibling;)a.matches(e)&&t++;return t},le=(a,e)=>{Tt(e,(t,n)=>{t==null?a.removeAttribute(n):a.setAttribute(n,""+t)})},Bn=(a,e)=>{a.parentNode&&a.parentNode.replaceChild(e,a)},ns=(a,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=o=>{var s=o.data.match(e);if(s&&o.data.length>0){var l=document.createElement("span");l.className="highlight";var c=o.splitText(s.index);c.splitText(s[0].length);var h=c.cloneNode(!0);return l.appendChild(h),Bn(c,l),1}return 0},n=o=>{o.nodeType===1&&o.childNodes&&!/(script|style)/i.test(o.tagName)&&(o.className!=="highlight"||o.tagName!=="SPAN")&&Array.from(o.childNodes).forEach(s=>{r(s)})},r=o=>o.nodeType===3?t(o):(n(o),0);r(a)},as=a=>{var e=a.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},is=65,rs=13,mi=27,Fn=37,ss=38,vi=39,os=40,wa=8,ds=46,jn=9,ls=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Qt=ls?"metaKey":"ctrlKey";var ba={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(a){return a.length>0},render:{}};const Ae=a=>typeof a>"u"||a===null?null:nn(a),nn=a=>typeof a=="boolean"?a?"1":"0":a+"",an=a=>(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),us=(a,e)=>e>0?setTimeout(a,e):(a.call(null),null),cs=(a,e)=>{var t;return function(n,r){var o=this;t&&(o.loading=Math.max(o.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,o.loadedSearches[n]=!0,a.call(o,n,r)},e)}},Ta=(a,e,t)=>{var n,r=a.trigger,o={};a.trigger=function(){var s=arguments[0];if(e.indexOf(s)!==-1)o[s]=arguments;else return r.apply(a,arguments)},t.apply(a,[]),a.trigger=r;for(n of e)n in o&&r.apply(a,o[n])},fs=a=>({start:a.selectionStart||0,length:(a.selectionEnd||0)-(a.selectionStart||0)}),re=(a,e=!1)=>{a&&(a.preventDefault(),e&&a.stopPropagation())},se=(a,e,t,n)=>{a.addEventListener(e,t,n)},ot=(a,e)=>{if(!e||!e[a])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Cn=(a,e)=>{const t=a.getAttribute("id");return t||(a.setAttribute("id",e),e)},_a=a=>a.replace(/[\\"']/g,"\\$&"),dt=(a,e)=>{e&&a.append(e)};function Na(a,e){var t=Object.assign({},ba,e),n=t.dataAttr,r=t.labelField,o=t.valueField,s=t.disabledField,l=t.optgroupField,c=t.optgroupLabelField,h=t.optgroupValueField,v=a.tagName.toLowerCase(),E=a.getAttribute("placeholder")||a.getAttribute("data-placeholder");if(!E&&!t.allowEmptyOption){let V=a.querySelector('option[value=""]');V&&(E=V.textContent)}var N={placeholder:E,options:[],optgroups:[],items:[],maxItems:null},D=()=>{var V,z=N.options,H={},L=1;let W=0;var i=p=>{var y=Object.assign({},p.dataset),m=n&&y[n];return typeof m=="string"&&m.length&&(y=Object.assign(y,JSON.parse(m))),y},f=(p,y)=>{var m=Ae(p.value);if(m!=null&&!(!m&&!t.allowEmptyOption)){if(H.hasOwnProperty(m)){if(y){var g=H[m][l];g?Array.isArray(g)?g.push(y):H[m][l]=[g,y]:H[m][l]=y}}else{var b=i(p);b[r]=b[r]||p.textContent,b[o]=b[o]||m,b[s]=b[s]||p.disabled,b[l]=b[l]||y,b.$option=p,b.$order=b.$order||++W,H[m]=b,z.push(b)}p.selected&&N.items.push(m)}},u=p=>{var y,m;m=i(p),m[c]=m[c]||p.getAttribute("label")||"",m[h]=m[h]||L++,m[s]=m[s]||p.disabled,m.$order=m.$order||++W,N.optgroups.push(m),y=m[h],Tt(p.children,g=>{f(g,y)})};N.maxItems=a.hasAttribute("multiple")?null:1,Tt(a.children,p=>{V=p.tagName.toLowerCase(),V==="optgroup"?u(p):V==="option"&&f(p)})},S=()=>{const V=a.getAttribute(n);if(V)N.options=JSON.parse(V),Tt(N.options,H=>{N.items.push(H[o])});else{var z=a.value.trim()||"";if(!t.allowEmptyOption&&!z.length)return;const H=z.split(t.delimiter);Tt(H,L=>{const W={};W[r]=L,W[o]=L,N.options.push(W)}),N.items=H}};return v==="select"?D():S(),Object.assign({},ba,N,e)}var Sa=0;class ye extends Mr(Ar){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Sa++;var n,r=pe(e);if(r.tomselect)throw new Error("Tom Select already initialized on this element");r.tomselect=this;var o=window.getComputedStyle&&window.getComputedStyle(r,null);n=o.getPropertyValue("direction");const s=Na(r,t);this.settings=s,this.input=r,this.tabIndex=r.tabIndex||0,this.is_select_tag=r.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=Cn(r,"tomselect-"+Sa),this.isRequired=r.required,this.sifter=new Zr(this.options,{diacritics:s.diacritics}),s.mode=s.mode||(s.maxItems===1?"single":"multi"),typeof s.hideSelected!="boolean"&&(s.hideSelected=s.mode==="multi"),typeof s.hidePlaceholder!="boolean"&&(s.hidePlaceholder=s.mode!=="multi");var l=s.createFilter;typeof l!="function"&&(typeof l=="string"&&(l=new RegExp(l)),l instanceof RegExp?s.createFilter=z=>l.test(z):s.createFilter=z=>this.settings.duplicates||!this.options[z]),this.initializePlugins(s.plugins),this.setupCallbacks(),this.setupTemplates();const c=pe("<div>"),h=pe("<div>"),v=this._render("dropdown"),E=pe('<div role="listbox" tabindex="-1">'),N=this.input.getAttribute("class")||"",D=s.mode;var S;if(ge(c,s.wrapperClass,N,D),ge(h,s.controlClass),dt(c,h),ge(v,s.dropdownClass,D),s.copyClassesToDropdown&&ge(v,N),ge(E,s.dropdownContentClass),dt(v,E),pe(s.dropdownParent||c).appendChild(v),pi(s.controlInput)){S=pe(s.controlInput);var V=["autocorrect","autocapitalize","autocomplete","spellcheck"];me(V,z=>{r.getAttribute(z)&&le(S,{[z]:r.getAttribute(z)})}),S.tabIndex=-1,h.appendChild(S),this.focus_node=S}else s.controlInput?(S=pe(s.controlInput),this.focus_node=S):(S=pe("<input/>"),this.focus_node=h);this.wrapper=c,this.dropdown=v,this.dropdown_content=E,this.control=h,this.control_input=S,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,r=e.dropdown,o=e.dropdown_content,s=e.wrapper,l=e.control,c=e.input,h=e.focus_node,v={passive:!0},E=e.inputId+"-ts-dropdown";le(o,{id:E}),le(h,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":E});const N=Cn(h,e.inputId+"-ts-control"),D="label[for='"+es(e.inputId)+"']",S=document.querySelector(D),V=e.focus.bind(e);if(S){se(S,"click",V),le(S,{for:N});const L=Cn(S,e.inputId+"-ts-label");le(h,{"aria-labelledby":L}),le(o,{"aria-labelledby":L})}if(s.style.width=c.style.width,e.plugins.names.length){const L="plugin-"+e.plugins.names.join(" plugin-");ge([s,r],L)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&le(c,{multiple:"multiple"}),t.placeholder&&le(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Ht(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=cs(t.load,t.loadThrottle)),se(r,"mousemove",()=>{e.ignoreHover=!1}),se(r,"mouseenter",L=>{var W=tn(L.target,"[data-selectable]",r);W&&e.onOptionHover(L,W)},{capture:!0}),se(r,"click",L=>{const W=tn(L.target,"[data-selectable]");W&&(e.onOptionSelect(L,W),re(L,!0))}),se(l,"click",L=>{var W=tn(L.target,"[data-ts-item]",l);if(W&&e.onItemSelect(L,W)){re(L,!0);return}n.value==""&&(e.onClick(),re(L,!0))}),se(h,"keydown",L=>e.onKeyDown(L)),se(n,"keypress",L=>e.onKeyPress(L)),se(n,"input",L=>e.onInput(L)),se(h,"blur",L=>e.onBlur(L)),se(h,"focus",L=>e.onFocus(L)),se(n,"paste",L=>e.onPaste(L));const z=L=>{const W=L.composedPath()[0];if(!s.contains(W)&&!r.contains(W)){e.isFocused&&e.blur(),e.inputState();return}W==n&&e.isOpen?L.stopPropagation():re(L,!0)},H=()=>{e.isOpen&&e.positionDropdown()};se(document,"mousedown",z),se(window,"scroll",H,v),se(window,"resize",H,v),this._destroy=()=>{document.removeEventListener("mousedown",z),window.removeEventListener("scroll",H),window.removeEventListener("resize",H),S&&S.removeEventListener("click",V)},this.revertSettings={innerHTML:c.innerHTML,tabIndex:c.tabIndex},c.tabIndex=-1,c.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,se(c,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,c.disabled?e.disable():c.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),ge(c,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),me(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,r={optgroup:o=>{let s=document.createElement("div");return s.className="optgroup",s.appendChild(o.options),s},optgroup_header:(o,s)=>'<div class="optgroup-header">'+s(o[n])+"</div>",option:(o,s)=>"<div>"+s(o[t])+"</div>",item:(o,s)=>"<div>"+s(o[t])+"</div>",option_create:(o,s)=>'<div class="create">Add <strong>'+s(o.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},r,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Na(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Dn(this.input,"input"),Dn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){re(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var r=n.trim().split(t.settings.splitOn);me(r,o=>{Ae(o)&&(this.options[o]?t.addItem(o):t.createItem(o))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){re(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),re(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==jn&&re(e);return}switch(e.keyCode){case is:if(ot(Qt,e)&&t.control_input.value==""){re(e),t.selectAll();return}break;case mi:t.isOpen&&(re(e,!0),t.close()),t.clearActiveItems();return;case os:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}re(e);return;case ss:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}re(e);return;case rs:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),re(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&re(e);return;case Fn:t.advanceSelection(-1,e);return;case vi:t.advanceSelection(1,e);return;case jn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),re(e)),t.settings.create&&t.createItem()&&re(e));return;case wa:case ds:t.deleteSelection(e);return}t.isInputHidden&&!ot(Qt,e)&&re(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=us(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),re(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,r=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?r.createItem(null,()=>{r.settings.closeAfterSelect&&r.close()}):(n=t.dataset.value,typeof n<"u"&&(r.lastQuery=null,r.addItem(n),r.settings.closeAfterSelect&&r.close(),!r.settings.hideSelected&&e.type&&/click/.test(e.type)&&r.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(re(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;ge(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||Ye(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Dn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];Ta(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,r,o,s,l,c,h;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(r=t&&t.type.toLowerCase(),r==="click"&&ot("shiftKey",t)&&n.activeItems.length){for(h=n.getLastActive(),s=Array.prototype.indexOf.call(n.control.children,h),l=Array.prototype.indexOf.call(n.control.children,e),s>l&&(c=s,s=l,l=c),o=s;o<=l;o++)e=n.control.children[o],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);re(t)}else r==="click"&&ot(Qt,t)||r==="keydown"&&ot("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&Ye(n,"last-active"),ge(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),Ye(e,"active")}clearActiveItems(){Ye(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,le(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),le(e,{"aria-selected":"true"}),ge(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,r=n.clientHeight,o=n.scrollTop||0,s=e.offsetHeight,l=e.getBoundingClientRect().top-n.getBoundingClientRect().top+o;l+s>r+o?this.scroll(l-r+s,t):l<o&&this.scroll(l,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(Ye(this.activeOption,"active"),le(this.activeOption,{"aria-selected":null})),this.activeOption=null,le(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,me(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(le(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&le(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,r=this,o=this.getSearchOptions();if(r.settings.score&&(n=r.settings.score.call(r,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==r.lastQuery?(r.lastQuery=e,t=r.sifter.search(e,Object.assign(o,{score:n})),r.currentResults=t):t=Object.assign({},r.currentResults),r.settings.hideSelected&&(t.items=t.items.filter(s=>{let l=Ae(s.id);return!(l&&r.items.indexOf(l)!==-1)})),t}refreshOptions(e=!0){var t,n,r,o,s,l,c,h,v,E;const N={},D=[];var S=this,V=S.inputValue();const z=V===S.lastQuery||V==""&&S.lastQuery==null;var H=S.search(V),L=null,W=S.settings.shouldOpen||!1,i=S.dropdown_content;z&&(L=S.activeOption,L&&(v=L.closest("[data-group]"))),o=H.items.length,typeof S.settings.maxOptions=="number"&&(o=Math.min(o,S.settings.maxOptions)),o>0&&(W=!0);const f=(p,y)=>{let m=N[p];if(m!==void 0){let b=D[m];if(b!==void 0)return[m,b.fragment]}let g=document.createDocumentFragment();return m=D.length,D.push({fragment:g,order:y,optgroup:p}),[m,g]};for(t=0;t<o;t++){let p=H.items[t];if(!p)continue;let y=p.id,m=S.options[y];if(m===void 0)continue;let g=nn(y),b=S.getOption(g,!0);for(S.settings.hideSelected||b.classList.toggle("selected",S.items.includes(g)),s=m[S.settings.optgroupField]||"",l=Array.isArray(s)?s:[s],n=0,r=l&&l.length;n<r;n++){s=l[n];let $=m.$order,C=S.optgroups[s];C===void 0?s="":$=C.$order;const[M,P]=f(s,$);n>0&&(b=b.cloneNode(!0),le(b,{id:m.$id+"-clone-"+n,"aria-selected":null}),b.classList.add("ts-cloned"),Ye(b,"active"),S.activeOption&&S.activeOption.dataset.value==y&&v&&v.dataset.group===s.toString()&&(L=b)),P.appendChild(b),s!=""&&(N[s]=M)}}S.settings.lockOptgroupOrder&&D.sort((p,y)=>p.order-y.order),c=document.createDocumentFragment(),me(D,p=>{let y=p.fragment,m=p.optgroup;if(!y||!y.children.length)return;let g=S.optgroups[m];if(g!==void 0){let b=document.createDocumentFragment(),$=S.render("optgroup_header",g);dt(b,$),dt(b,y);let C=S.render("optgroup",{group:g,options:b});dt(c,C)}else dt(c,y)}),i.innerHTML="",dt(i,c),S.settings.highlight&&(as(i),H.query.length&&H.tokens.length&&me(H.tokens,p=>{ns(i,p.regex)}));var u=p=>{let y=S.render(p,{input:V});return y&&(W=!0,i.insertBefore(y,i.firstChild)),y};if(S.loading?u("loading"):S.settings.shouldLoad.call(S,V)?H.items.length===0&&u("no_results"):u("not_loading"),h=S.canCreate(V),h&&(E=u("option_create")),S.hasOptions=H.items.length>0||h,W){if(H.items.length>0){if(!L&&S.settings.mode==="single"&&S.items[0]!=null&&(L=S.getOption(S.items[0])),!i.contains(L)){let p=0;E&&!S.settings.addPrecedence&&(p=1),L=S.selectable()[p]}}else E&&(L=E);e&&!S.isOpen&&(S.open(),S.scrollToOption(L,"auto")),S.setActiveOption(L)}else S.clearActiveOption(),e&&S.isOpen&&S.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const r=Ae(e[n.settings.valueField]);return r===null||n.options.hasOwnProperty(r)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[r]=e,n.lastQuery=null,t&&(n.userOptions[r]=t,n.trigger("option_add",r,e)),r)}addOptions(e,t=!1){me(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ae(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var r,o;const s=Ae(e),l=Ae(t[n.settings.valueField]);if(s===null)return;const c=n.options[s];if(c==null)return;if(typeof l!="string")throw new Error("Value must be set in option data");const h=n.getOption(s),v=n.getItem(s);if(t.$order=t.$order||c.$order,delete n.options[s],n.uncacheValue(l),n.options[l]=t,h){if(n.dropdown_content.contains(h)){const E=n._render("option",t);Bn(h,E),n.activeOption===h&&n.setActiveOption(E)}h.remove()}v&&(o=n.items.indexOf(s),o!==-1&&n.items.splice(o,1,l),r=n._render("item",t),v.classList.contains("active")&&ge(r,"active"),Bn(v,r)),n.lastQuery=null}removeOption(e,t){const n=this;e=nn(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};me(this.options,(r,o)=>{t(r,o)&&(n[o]=r)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Ae(e);if(n===null)return null;const r=this.options[n];if(r!=null){if(r.$div)return r.$div;if(t)return this._render("option",r)}return null}getAdjacent(e,t,n="option"){var r=this,o;if(!e)return null;n=="item"?o=r.controlChildren():o=r.dropdown_content.querySelectorAll("[data-selectable]");for(let s=0;s<o.length;s++)if(o[s]==e)return t>0?o[s+1]:o[s-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ae(e);return t!==null?this.control.querySelector(`[data-value="${_a(t)}"]`):null}addItems(e,t){var n=this,r=Array.isArray(e)?e:[e];r=r.filter(s=>n.items.indexOf(s)===-1);const o=r[r.length-1];r.forEach(s=>{n.isPending=s!==o,n.addItem(s,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];Ta(this,n,()=>{var r,o;const s=this,l=s.settings.mode,c=Ae(e);if(!(c&&s.items.indexOf(c)!==-1&&(l==="single"&&s.close(),l==="single"||!s.settings.duplicates))&&!(c===null||!s.options.hasOwnProperty(c))&&(l==="single"&&s.clear(t),!(l==="multi"&&s.isFull()))){if(r=s._render("item",s.options[c]),s.control.contains(r)&&(r=r.cloneNode(!0)),o=s.isFull(),s.items.splice(s.caretPos,0,c),s.insertAtCaret(r),s.isSetup){if(!s.isPending&&s.settings.hideSelected){let h=s.getOption(c),v=s.getAdjacent(h,1);v&&s.setActiveOption(v)}!s.isPending&&!s.settings.closeAfterSelect&&s.refreshOptions(s.isFocused&&l!=="single"),s.settings.closeAfterSelect!=!1&&s.isFull()?s.close():s.isPending||s.positionDropdown(),s.trigger("item_add",c,r),s.isPending||s.updateOriginalInput({silent:t})}(!s.isPending||!o&&s.isFull())&&(s.inputState(),s.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var r,o;const s=e.dataset.value;r=hn(e),e.remove(),e.classList.contains("active")&&(o=n.activeItems.indexOf(e),n.activeItems.splice(o,1),Ye(e,"active")),n.items.splice(r,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(s)&&n.removeOption(s,t),r<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",s,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,r=n.caretPos,o;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var s=!1,l=c=>{if(n.unlock(),!c||typeof c!="object")return t();var h=Ae(c[n.settings.valueField]);if(typeof h!="string")return t();n.setTextboxValue(),n.addOption(c,!0),n.setCaret(r),n.addItem(h),t(c),s=!0};return typeof n.settings.create=="function"?o=n.settings.create.call(this,e,l):o={[n.settings.labelField]:e,[n.settings.valueField]:e},s||l(o),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const r=e.wrapper.classList;r.toggle("focus",e.isFocused),r.toggle("disabled",e.isDisabled),r.toggle("readonly",e.isReadOnly),r.toggle("required",e.isRequired),r.toggle("invalid",!e.isValid),r.toggle("locked",n),r.toggle("full",t),r.toggle("input-active",e.isFocused&&!e.isInputHidden),r.toggle("dropdown-active",e.isOpen),r.toggle("has-options",ts(e.options)),r.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,r;const o=t.input.querySelector('option[value=""]');if(t.is_select_tag){let c=function(h,v,E){return h||(h=pe('<option value="'+an(v)+'">'+an(E)+"</option>")),h!=o&&t.input.append(h),s.push(h),(h!=o||l>0)&&(h.selected=!0),h};const s=[],l=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(h=>{h.selected=!1}),t.items.length==0&&t.settings.mode=="single"?c(o,"",""):t.items.forEach(h=>{if(n=t.options[h],r=n[t.settings.labelField]||"",s.includes(n.$option)){const v=t.input.querySelector(`option[value="${_a(h)}"]:not(:checked)`);c(v,h,r)}else n.$option=c(n.$option,h,r)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,le(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Yt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Yt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,le(t.focus_node,{"aria-expanded":"false"}),Yt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,r=t.left+window.scrollX;Yt(this.dropdown,{width:t.width+"px",top:n+"px",left:r+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();me(n,r=>{t.removeItem(r,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,r=t.control;r.insertBefore(e,r.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,r,o,s=this;t=e&&e.keyCode===wa?-1:1,n=fs(s.control_input);const l=[];if(s.activeItems.length)o=Ia(s.activeItems,t),r=hn(o),t>0&&r++,me(s.activeItems,c=>l.push(c));else if((s.isFocused||s.settings.mode==="single")&&s.items.length){const c=s.controlChildren();let h;t<0&&n.start===0&&n.length===0?h=c[s.caretPos-1]:t>0&&n.start===s.inputValue().length&&(h=c[s.caretPos]),h!==void 0&&l.push(h)}if(!s.shouldDelete(l,e))return!1;for(re(e,!0),typeof r<"u"&&s.setCaret(r);l.length;)s.removeItem(l.pop());return s.inputState(),s.positionDropdown(),s.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(r=>r.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,r,o=this;o.rtl&&(e*=-1),!o.inputValue().length&&(ot(Qt,t)||ot("shiftKey",t)?(n=o.getLastActive(e),n?n.classList.contains("active")?r=o.getAdjacent(n,e,"item"):r=n:e>0?r=o.control_input.nextElementSibling:r=o.control_input.previousElementSibling,r&&(r.classList.contains("active")&&o.removeActiveItem(n),o.setActiveItemClass(r))):o.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Ia(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,Ye(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,r;const o=this;if(typeof this.settings.render[e]!="function"||(r=o.settings.render[e].call(this,t,an),!r))return null;if(r=pe(r),e==="option"||e==="option_create"?t[o.settings.disabledField]?le(r,{"aria-disabled":"true"}):le(r,{"data-selectable":""}):e==="optgroup"&&(n=t.group[o.settings.optgroupValueField],le(r,{"data-group":n}),t.group[o.settings.disabledField]&&le(r,{"data-disabled":""})),e==="option"||e==="item"){const s=nn(t[o.settings.valueField]);le(r,{"data-value":s}),e==="item"?(ge(r,o.settings.itemClass),le(r,{"data-ts-item":""})):(ge(r,o.settings.optionClass),le(r,{role:"option",id:t.$id}),t.$div=r,o.options[s]=t)}return r}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){me(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var r=this,o=r[t];r[t]=function(){var s,l;return e==="after"&&(s=o.apply(r,arguments)),l=n.apply(r,arguments),e==="instead"?l:(e==="before"&&(s=o.apply(r,arguments)),s)}}}function ps(){se(this.input,"change",()=>{this.sync()})}function hs(a){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},a);var r=function(l,c){c?(l.checked=!0,n.uncheckedClassNames&&l.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&l.classList.add(...n.checkedClassNames)):(l.checked=!1,n.checkedClassNames&&l.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&l.classList.add(...n.uncheckedClassNames))},o=function(l){setTimeout(()=>{var c=l.querySelector("input."+n.className);c instanceof HTMLInputElement&&r(c,l.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var s=e.settings.render.option;e.settings.render.option=(l,c)=>{var h=pe(s.call(e,l,c)),v=document.createElement("input");n.className&&v.classList.add(n.className),v.addEventListener("click",function(N){re(N)}),v.type="checkbox";const E=Ae(l[e.settings.valueField]);return r(v,!!(E&&e.items.indexOf(E)>-1)),h.prepend(v),h}}),e.on("item_remove",s=>{var l=e.getOption(s);l&&(l.classList.remove("selected"),o(l))}),e.on("item_add",s=>{var l=e.getOption(s);l&&o(l)}),e.hook("instead","onOptionSelect",(s,l)=>{if(l.classList.contains("selected")){l.classList.remove("selected"),e.removeItem(l.dataset.value),e.refreshOptions(),re(s,!0);return}t.call(e,s,l),o(l)})}function gs(a){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},a);e.on("initialize",()=>{var n=pe(t.html(t));n.addEventListener("click",r=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),r.preventDefault(),r.stopPropagation())}),e.control.appendChild(n)})}const ms=(a,e)=>{var t;(t=a.parentNode)==null||t.insertBefore(e,a.nextSibling)},vs=(a,e)=>{var t;(t=a.parentNode)==null||t.insertBefore(e,a)},ys=(a,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,a==e)return!0}while(e&&e.previousElementSibling);return!1};function Es(){var a=this;if(a.settings.mode!=="multi")return;var e=a.lock,t=a.unlock;let n=!0,r;a.hook("after","setupTemplates",()=>{var o=a.settings.render.item;a.settings.render.item=(s,l)=>{const c=pe(o.call(a,s,l));le(c,{draggable:"true"});const h=V=>{n||re(V),V.stopPropagation()},v=V=>{r=c,setTimeout(()=>{c.classList.add("ts-dragging")},0)},E=V=>{V.preventDefault(),c.classList.add("ts-drag-over"),D(c,r)},N=()=>{c.classList.remove("ts-drag-over")},D=(V,z)=>{z!==void 0&&(ys(z,c)?ms(V,z):vs(V,z))},S=()=>{var V;document.querySelectorAll(".ts-drag-over").forEach(H=>H.classList.remove("ts-drag-over")),(V=r)==null||V.classList.remove("ts-dragging"),r=void 0;var z=[];a.control.querySelectorAll("[data-value]").forEach(H=>{if(H.dataset.value){let L=H.dataset.value;L&&z.push(L)}}),a.setValue(z)};return se(c,"mousedown",h),se(c,"dragstart",v),se(c,"dragenter",E),se(c,"dragover",E),se(c,"dragleave",N),se(c,"dragend",S),c}}),a.hook("instead","lock",()=>(n=!1,e.call(a))),a.hook("instead","unlock",()=>(n=!0,t.call(a)))}function Is(a){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},a);e.on("initialize",()=>{var n=pe(t.html(t)),r=n.querySelector("."+t.closeClass);r&&r.addEventListener("click",o=>{re(o,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function ws(){var a=this;a.hook("instead","setCaret",e=>{a.settings.mode==="single"||!a.control.contains(a.control_input)?e=a.items.length:(e=Math.max(0,Math.min(a.items.length,e)),e!=a.caretPos&&!a.isPending&&a.controlChildren().forEach((t,n)=>{n<e?a.control_input.insertAdjacentElement("beforebegin",t):a.control.appendChild(t)})),a.caretPos=e}),a.hook("instead","moveCaret",e=>{if(!a.isFocused)return;const t=a.getLastActive(e);if(t){const n=hn(t);a.setCaret(e>0?n+1:n),a.setActiveItem(),Ye(t,"last-active")}else a.setCaret(a.caretPos+e)})}function bs(){const a=this;a.settings.shouldOpen=!0,a.hook("before","setup",()=>{a.focus_node=a.control,ge(a.control_input,"dropdown-input");const e=pe('<div class="dropdown-input-wrap">');e.append(a.control_input),a.dropdown.insertBefore(e,a.dropdown.firstChild);const t=pe('<input class="items-placeholder" tabindex="-1" />');t.placeholder=a.settings.placeholder||"",a.control.append(t)}),a.on("initialize",()=>{a.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case mi:a.isOpen&&(re(t,!0),a.close()),a.clearActiveItems();return;case jn:a.focus_node.tabIndex=-1;break}return a.onKeyDown.call(a,t)}),a.on("blur",()=>{a.focus_node.tabIndex=a.isDisabled?-1:a.tabIndex}),a.on("dropdown_open",()=>{a.control_input.focus()});const e=a.onBlur;a.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==a.control_input))return e.call(a)}),se(a.control_input,"blur",()=>a.onBlur()),a.hook("before","close",()=>{a.isOpen&&a.focus_node.focus({preventScroll:!0})})})}function Ts(){var a=this;a.on("initialize",()=>{var e=document.createElement("span"),t=a.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",a.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const o of n)e.style[o]=t.style[o];var r=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};r(),a.on("update item_add item_remove",r),se(t,"input",r),se(t,"keyup",r),se(t,"blur",r),se(t,"update",r)})}function _s(){var a=this,e=a.deleteSelection;this.hook("instead","deleteSelection",t=>a.activeItems.length?e.call(a,t):!1)}function Ns(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function Ss(){var a=this,e=a.onKeyDown;a.hook("instead","onKeyDown",t=>{var n,r,o,s;if(!a.isOpen||!(t.keyCode===Fn||t.keyCode===vi))return e.call(a,t);a.ignoreHover=!0,s=tn(a.activeOption,"[data-group]"),n=hn(a.activeOption,"[data-selectable]"),s&&(t.keyCode===Fn?s=s.previousSibling:s=s.nextSibling,s&&(o=s.querySelectorAll("[data-selectable]"),r=o[Math.min(o.length-1,n)],r&&a.setActiveOption(r)))})}function Os(a){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},a);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+an(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var r=t.settings.render.item;t.settings.render.item=(o,s)=>{var l=pe(r.call(t,o,s)),c=pe(n);return l.appendChild(c),se(c,"mousedown",h=>{re(h,!0)}),se(c,"click",h=>{t.isLocked||(re(h,!0),!t.isLocked&&t.shouldDelete([l],h)&&(t.removeItem(l),t.refreshOptions(!1),t.inputState()))}),l}})}}function ks(a){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},a);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var r=e.options[n];r&&e.setTextboxValue(t.text.call(e,r))}})}function Ds(){const a=this,e=a.canLoad,t=a.clearActiveOption,n=a.loadCallback;var r={},o,s=!1,l,c=[];if(a.settings.shouldLoadMore||(a.settings.shouldLoadMore=()=>{if(o.clientHeight/(o.scrollHeight-o.scrollTop)>.9)return!0;if(a.activeOption){var N=a.selectable(),D=Array.from(N).indexOf(a.activeOption);if(D>=N.length-2)return!0}return!1}),!a.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";a.settings.sortField=[{field:"$order"},{field:"$score"}];const h=E=>typeof a.settings.maxOptions=="number"&&o.children.length>=a.settings.maxOptions?!1:!!(E in r&&r[E]),v=(E,N)=>a.items.indexOf(N)>=0||c.indexOf(N)>=0;a.setNextUrl=(E,N)=>{r[E]=N},a.getUrl=E=>{if(E in r){const N=r[E];return r[E]=!1,N}return a.clearPagination(),a.settings.firstUrl.call(a,E)},a.clearPagination=()=>{r={}},a.hook("instead","clearActiveOption",()=>{if(!s)return t.call(a)}),a.hook("instead","canLoad",E=>E in r?h(E):e.call(a,E)),a.hook("instead","loadCallback",(E,N)=>{if(!s)a.clearOptions(v);else if(l){const D=E[0];D!==void 0&&(l.dataset.value=D[a.settings.valueField])}n.call(a,E,N),s=!1}),a.hook("after","refreshOptions",()=>{const E=a.lastValue;var N;h(E)?(N=a.render("loading_more",{query:E}),N&&(N.setAttribute("data-selectable",""),l=N)):E in r&&!o.querySelector(".no-results")&&(N=a.render("no_more_results",{query:E})),N&&(ge(N,a.settings.optionClass),o.append(N))}),a.on("initialize",()=>{c=Object.keys(a.options),o=a.dropdown_content,a.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},a.settings.render),o.addEventListener("scroll",()=>{a.settings.shouldLoadMore.call(a)&&h(a.lastValue)&&(s||(s=!0,a.load.call(a,a.lastValue)))})})}ye.define("change_listener",ps);ye.define("checkbox_options",hs);ye.define("clear_button",gs);ye.define("drag_drop",Es);ye.define("dropdown_header",Is);ye.define("caret_position",ws);ye.define("dropdown_input",bs);ye.define("input_autogrow",Ts);ye.define("no_backspace_delete",_s);ye.define("no_active_items",Ns);ye.define("optgroup_columns",Ss);ye.define("remove_button",Os);ye.define("restore_on_backspace",ks);ye.define("virtual_scroll",Ds);class Cs{spectresToCreate=[];spectresToDelete=[];spectresToUpdate=[];constructor(){}async Initialize(){const e=w.sceneItems.filter(t=>t.metadata[`${d.SPECTREID}/isSpectre`]===!0);for(const t of e)await this.SetupGhostSelect(t)}async Run(){const t=w.sceneItems.filter(n=>n.metadata[`${d.SPECTREID}/isSpectre`]===!0).filter(n=>n.metadata[`${d.SPECTREID}/spectreViewers`].includes(w.playerId));if(t.length>0){for(const r of t){const o=w.sceneLocal.find(s=>s.metadata[`${d.SPECTREID}/isLocalSpectre`]===r.id);if(!o)this.CreateSpectreToQueue(r);else{const s=r.position.x===o.position.x&&r.position.y===o.position.y,l=r.scale.x===o.scale.x&&r.scale.y===o.scale.y,c=r.rotation===o.rotation,h=r.layer===o.layer;(!c||!l||!h||!s)&&this.UpdateSpectreToQueue(r,o)}}const n=w.sceneLocal.filter(r=>_r(r));for(const r of n)t.find(s=>s.id===r.metadata[`${d.SPECTREID}/isLocalSpectre`])||this.spectresToDelete.push(r.id);this.spectresToCreate.length>0&&await T.scene.local.addItems(this.spectresToCreate),this.spectresToDelete.length>0&&await T.scene.local.deleteItems(this.spectresToDelete),this.spectresToUpdate.length>0&&await T.scene.local.updateItems(n.filter(r=>!this.spectresToDelete.includes(r.id)),r=>{for(let o of r){const s=this.spectresToUpdate.find(l=>l.id===o.id);s&&(o.layer=s.layer,o.scale=s.scale,o.rotation=s.rotation,o.position=s.position)}}),this.spectresToCreate=[],this.spectresToUpdate=[],this.spectresToDelete=[]}else{const n=w.sceneLocal.filter(r=>r.metadata[`${d.SPECTREID}/isLocalSpectre`]!==void 0);n.length>0&&await T.scene.local.deleteItems(n.map(r=>r.id))}}CreateSpectreToQueue(e){const t=sn({height:e.image.height,width:e.image.width,url:e.image.url,mime:e.image.mime},{dpi:e.grid.dpi,offset:e.grid.offset}).position(e.position).scale(e.scale).rotation(e.rotation).attachedTo(e.id).layer(e.layer).metadata({[`${d.SPECTREID}/isLocalSpectre`]:e.id}).disableHit(!1).build();w.playerRole==="GM"&&(t.attachedTo=e.id,t.disableHit=!0),this.spectresToCreate.push(t)}UpdateSpectreToQueue(e,t){const n={id:t.id,position:e.position,rotation:e.rotation,scale:e.scale,layer:e.layer};this.spectresToUpdate.push(n)}async HandleLocalMovement(e){const t=e.filter(n=>n.metadata[`${d.SPECTREID}/isLocalSpectre`]!==void 0);if(t.length>0){const n=[];for(const r of t){const o=w.sceneLocal.find(h=>h.id===r.id);if(!o)continue;const s=r.position.x===o.position.x&&r.position.y===o.position.y,l=r.scale.x===o.scale.x&&r.scale.y===o.scale.y,c=r.rotation===o.rotation;if(!s||!l||!c){const h=w.sceneItems.find(v=>v.id===o.metadata[`${d.SPECTREID}/isLocalSpectre`]);if(h){const v={id:h.id,position:o.position,scale:o.scale,rotation:o.rotation};n.push(v)}}}n.length>0&&await T.scene.items.updateItems(n.map(r=>r.id),r=>{for(let o of r){const s=n.find(l=>l.id===o.id);s&&(o.position=s.position,o.scale=s.scale,o.rotation=s.rotation)}})}}async SetupGhostSelect(e){const t=e.text?.plainText||e.name,n=document.getElementById("ghostList"),r=document.createElement("tr");r.id=`tr-${e.id}`,r.className="ghost-table-entry",r.innerHTML=`<td class="token-name">${t}</td>
            <td><select id="select-${e.id}" class="tSelects" multiple autocomplete="off" /></td>
            <td><input type="button" class="mysteryButton" id="deleteGhost-${e.id}" value="Delete"/></td>`,n.appendChild(r);const o=document.getElementById(`select-${e.id}`);for(const E of w.party){const N=document.createElement("option");N.value=E.id,N.text=E.name,o.appendChild(N)}const s={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:w.party.length==0?"No Players Present":"Choose..",maxItems:null,create:!1,onDelete:async function(E,N){const D=N.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await T.scene.items.updateItems([D],S=>{const V=S[0].metadata[`${d.SPECTREID}/spectreViewers`],z=V.findIndex(H=>H==E);V.splice(z,1),S[0].metadata[`${d.SPECTREID}/spectreViewers`]=V})},onItemAdd:async function(E,N){const D=N.parentElement.parentElement.parentElement.parentElement.id.slice(3);await T.scene.items.updateItems([D],S=>{const V=S[0].metadata[`${d.SPECTREID}/spectreViewers`];V.push(E),S[0].metadata[`${d.SPECTREID}/spectreViewers`]=V})}};let l=e.metadata[`${d.SPECTREID}/spectreViewers`];l||(l=[]);const c=new ye(`#select-${e.id}`,s);if(l.length>1)for(const E of l){if(!w.party.find(D=>D.id===E)){const D=w.sceneMetadata[`${d.EXTENSIONID}/USER-${E}`],S=[];S.push({value:E,text:D.name}),c.addOption(S)}c.addItem(E,!0)}const h=document.getElementById(`deleteGhost-${e.id}`);h.onclick=async()=>{const E=w.sceneLocal.findIndex(N=>N.id===e.id);w.sceneLocal.splice(E,1),r.remove(),await T.scene.items.deleteItems([e.id])};const v=document.getElementsByClassName("ts-control");for(let E of v){const N=E;N.style.backgroundColor=w.theme.mode==="DARK"?"rgb(49, 49, 65)":"rgb(210, 210, 223)",N.style.borderRadius="6px"}}UpdateSpectreTargets(){const e=document.querySelectorAll(".tSelects");for(const t of e)if(t&&t.tomselect){const n=t.tomselect,r=[];for(const o of w.party)r.push({value:o.id,text:o.name});n.clearOptions(),n.addOption(r),r.length===0?(n.settings.placeholder="No Players Present",n.inputState()):(n.settings.placeholder="Choose..",n.inputState())}}}const _t=new Cs;async function Ls(){await T.contextMenu.create({id:`${d.EXTENSIONID}/convert-curve`,icons:[{icon:"/opendoor.svg",label:"Convert to Obstruction",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${d.EXTENSIONID}/elevation`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:void 0}],roles:["GM"]}}],async onClick(a){const e="#000000",t=[],n=[],r=[];for(const o of a.items){if(o.type==="CURVE"){const s=o;if(s.points.length>2){const l=be().tension(0).points(Ln(s.points,s.position)).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??t).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();s.style.closed&&l.points.push(s.points[0]),n.push(l),r.push(s.id)}}else if(o.type==="PATH"){const s=o;if(s.commands.length>2){const l=be().tension(0).points(sr(s.commands)).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??t).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();n.push(l),r.push(s.id)}}else if(o.type==="LINE"){const s=o,l=be().tension(0).points(Ln([s.startPosition,s.endPosition],s.position)).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??t).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();n.push(l),r.push(s.id)}else if(o.type==="SHAPE"){const s=o,l=[];if(s.shapeType==="CIRCLE"){const c=Math.min(s.width,s.height)/2,h=2*Math.PI/20;for(let v=0;v<20;v++){const E=v*h,N=c*Math.cos(E),D=c*Math.sin(E);l.push({x:N,y:D})}}else if(s.shapeType==="RECTANGLE"){const v=0+s.width,E=0+s.height;l.push({x:0,y:0}),l.push({x:v,y:0}),l.push({x:v,y:E}),l.push({x:0,y:E})}else if(s.shapeType==="HEXAGON"){const c=s.width/2,h=[Math.PI/2,Math.PI/6,11*Math.PI/6,3*Math.PI/2,7*Math.PI/6,5*Math.PI/6];for(let v=0;v<6;v++){const E=h[v],N=c*Math.cos(E),D=c*Math.sin(E);l.push({x:N,y:D})}}else s.shapeType==="TRIANGLE"&&(l.push({x:0,y:0}),l.push({x:0-s.width/2,y:0+s.height}),l.push({x:0+s.width/2,y:0+s.height}));if(l.length>0){const c=be().tension(0).points(Ln(l,{x:1,y:1})).position(s.position).rotation(s.rotation).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??e).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??t).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/blocking`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0}).build();c.points.push(l[0]),n.push(c),r.push(s.id)}}n.length>0&&(await T.scene.items.addItems(n),await T.scene.items.deleteItems(r))}}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0,coordinator:"&&"},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.EXTENSIONID}/hasVision`]===void 0);await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/hasVision`]=!0,n.metadata[`${d.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${d.EXTENSIONID}/visionRange`]=we(),n.metadata[`${d.EXTENSIONID}/visionSourceRange`]=Ve(),n.metadata[`${d.EXTENSIONID}/visionFallOff`]=Qe(),n.metadata[`${d.EXTENSIONID}/visionInAngle`]=tt(),n.metadata[`${d.EXTENSIONID}/visionOutAngle`]=Ue(),n.metadata[`${d.EXTENSIONID}/visionDark`]=dn())):delete n.metadata[`${d.EXTENSIONID}/hasVision`]})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0}]}}],async onClick(a){await T.scene.items.updateItems(a.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/disabled`]?delete t.metadata[`${d.EXTENSIONID}/disabled`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/disabled`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Swap to Double-sided",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"Swap to One-sided",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:!0}]}}],async onClick(a){await T.scene.items.updateItems(a.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/doubleSided`]?delete t.metadata[`${d.EXTENSIONID}/doubleSided`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/doubleSided`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-obstructing-side`,icons:[{icon:"/flip.svg",label:"Swap Obstructing Side",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:"type",value:"CURVE",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/doubleSided`],value:void 0}]}}],async onClick(a){await T.scene.items.updateItems(a.items,e=>{for(const t of e){const n=t.points.reverse();t.points=n}})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/switch-blockage`,icons:[{icon:"/blocked.svg",label:"Swap to Unpassable",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/blocking`],value:void 0}]}},{icon:"/unblock.svg",label:"Swap to Passable",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/blocking`],value:!0}]}}],async onClick(a){await T.scene.items.updateItems(a.items,e=>{for(const t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/blocking`]?delete t.metadata[`${d.EXTENSIONID}/blocking`]:t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/blocking`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"},{key:["metadata",`${d.EXTENSIONID}/isFogMap`],value:void 0}]}},{icon:"/fog-background.svg",label:"Convert To Normal Background",filter:{every:[{key:"layer",value:"FOG"},{key:["metadata",`${d.EXTENSIONID}/isFogMap`],value:!0}]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.EXTENSIONID}/isFogMap`]===void 0);await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?(n.layer="FOG",n.zIndex=-1,n.disableAutoZIndex=!0,n.metadata[`${d.EXTENSIONID}/isFogMap`]=!0):(n.layer="MAP",n.zIndex=-1,n.disableAutoZIndex=!1,delete n.metadata[`${d.EXTENSIONID}/isFogMap`])})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/create-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/grid`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorId`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/grid`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.EXTENSIONID}/isDoor`]===void 0);await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/isDoor`]=!0,n.style.strokeColor=d.DOORCOLOR):(delete n.metadata[`${d.EXTENSIONID}/isDoorLocked`],delete n.metadata[`${d.EXTENSIONID}/doorOpen`],delete n.metadata[`${d.EXTENSIONID}/disabled`],delete n.metadata[`${d.EXTENSIONID}/isDoor`],n.style.strokeColor=w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/open-door`,icons:[{icon:"/opendoor.svg",label:"Open Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}},{icon:"/closedoor.svg",label:"Close Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}]}}],async onClick(a){await T.scene.items.updateItems(a.items,e=>{for(let t of e)t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&t.metadata[`${d.EXTENSIONID}/disabled`]?(delete t.metadata[`${d.EXTENSIONID}/disabled`],delete t.metadata[`${d.EXTENSIONID}/doorOpen`]):t.metadata[`${d.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${d.EXTENSIONID}/disabled`]=!0,t.metadata[`${d.EXTENSIONID}/doorOpen`]=!0)})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-door-lock`,icons:[{icon:"/locked-door.svg",label:"Lock Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isDoorLocked`],value:void 0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}},{icon:"/unlocked-door.svg",label:"Unlock Door",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isVisionLine`],value:!0},{key:["metadata",`${d.EXTENSIONID}/isDoor`],value:!0},{key:["metadata",`${d.EXTENSIONID}/doorOpen`],value:void 0}],some:[{key:"layer",value:d.LINELAYER,coordinator:"||"},{key:"layer",value:"DRAWING"}],roles:["GM"]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.EXTENSIONID}/isDoorLocked`]===void 0);await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?n.metadata[`${d.EXTENSIONID}/isDoorLocked`]=!0:delete n.metadata[`${d.EXTENSIONID}/isDoorLocked`]})}}),await T.contextMenu.create({id:`${d.EXTENSIONID}/toggle-torch`,icons:[{icon:"/light.svg",label:"Enable Torchlight",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isTorch`],operator:"==",value:void 0},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0},{key:"layer",value:"PROP"}]}},{icon:"/no-light.svg",label:"Disable Torchlight",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/isTorch`],operator:"==",value:!0},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0},{key:"layer",value:"PROP"}]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.EXTENSIONID}/isTorch`]===void 0);await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?(n.metadata[`${d.EXTENSIONID}/isTorch`]=!0,n.metadata[`${d.EXTENSIONID}/hasVision`]=!0):(delete n.metadata[`${d.EXTENSIONID}/isTorch`],delete n.metadata[`${d.EXTENSIONID}/hasVision`])})}}),await T.contextMenu.create({id:`${d.SPECTREID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${d.SPECTREID}/isSpectre`],value:void 0,operator:"==",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"type",value:"IMAGE"},{key:["metadata",`${d.SPECTREID}/isSpectre`],value:void 0,operator:"!=",coordinator:"&&"},{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:void 0}]}}],async onClick(a){const e=a.items.every(t=>t.metadata[`${d.SPECTREID}/isSpectre`]===!0);if(await T.scene.items.updateItems(a.items,t=>{for(const n of t)e?(delete n.metadata[`${d.SPECTREID}/isSpectre`],delete n.metadata[`${d.SPECTREID}/spectreViewers`],n.visible=!0):(n.metadata[`${d.SPECTREID}/isSpectre`]=!0,n.metadata[`${d.SPECTREID}/spectreViewers`]=[w.playerId],n.visible=!1)}),!e)for(const t of a.items)await _t.SetupGhostSelect(t)}}),w.sceneMetadata[`${d.EXTENSIONID}/unitContextMenu`]===!0&&await zn(!0)}async function zn(a){a?await T.contextMenu.create({id:`${d.EXTENSIONID}/context-menu-embed`,icons:[{icon:"/icon.svg",label:"Vision Settings",filter:{every:[{key:["metadata",`${d.EXTENSIONID}/hasVision`],operator:"==",value:!0,coordinator:"&&"},{key:["metadata",`${d.SPECTREID}/isSpectre`],operator:"==",value:void 0}],some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"PROP",coordinator:"||"},{key:"layer",value:"ATTACHMENT"}]}}],async onClick(e,t){await T.popover.open({id:d.CONTEXTID,url:"/pages/contextembed.html",height:140,width:200,anchorElementId:t})},embed:{url:"/pages/contextembed.html?contextmenu=true",height:140}}):await T.contextMenu.remove(`${d.EXTENSIONID}/context-menu-embed`)}function Ln(a,e){return a.map(t=>({x:t.x+e.x,y:t.y+e.y}))}class te{static PLAYER="PLAYER";static PARTY="PARTY";static SCENEITEMS="SCENEITEMS";static SCENELOCAL="SCENELOCAL";static SCENEMETA="SCENEMETADATA";static SCENEGRID="SCENEGRID";static SCENEFOG="SCENEFOG";static ROOMMETA="ROOMMETADATA";playerId;playerColor;playerName;playerMetadata;playerRole;party;lastParty;fogFilled;fogColor;fogStroke;gridDpi;gridScale;gridSnap;gridType;storedMetaItems;sceneId;sceneItems;sceneLocal;sceneSelected;sceneMetadata;sceneReady;roomMetadata;theme;caches;snap;torchActive;busy;USER_REGISTERED;toolStarted;sceneMetadataHandler;sceneItemsHandler;sceneLocalHandler;sceneGridHandler;sceneReadyHandler;playerHandler;partyHandler;themeHandler;roomHandler;fogHandler;constructor(e){this.playerId="",this.playerName="",this.playerColor="",this.playerMetadata={},this.playerRole="PLAYER",this.party=[],this.lastParty=[],this.fogFilled=!1,this.fogColor="#000",this.fogStroke=5,this.storedMetaItems=[],this.sceneId="",this.sceneItems=[],this.sceneLocal=[],this.sceneSelected=[],this.sceneMetadata={},this.gridDpi=0,this.gridScale=5,this.gridSnap=10,this.gridType="ft",this.sceneReady=!1,this.theme={},this.roomMetadata={},this.snap=!1,this.busy=!1,this.torchActive=!1,this.toolStarted=!1,this.USER_REGISTERED=!1,this.caches=e}async RefreshCache(){if(this.caches.includes(te.PLAYER)&&(this.playerId=await T.player.getId(),this.playerName=await T.player.getName(),this.playerColor=await T.player.getColor(),this.playerMetadata=await T.player.getMetadata(),this.playerRole=await T.player.getRole()),this.caches.includes(te.PARTY)&&(this.party=await T.party.getPlayers()),this.caches.includes(te.SCENEFOG)&&this.sceneReady&&(this.fogColor=await T.scene.fog.getColor(),this.fogFilled=await T.scene.fog.getFilled()),this.caches.includes(te.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await T.scene.items.getItems(),this.sceneLocal=await T.scene.local.getItems()),this.caches.includes(te.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await T.scene.getMetadata();const e=this.sceneMetadata[`${d.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e),this.sceneId=this.sceneMetadata[`${d.EXTENSIONID}/sceneId`],(this.sceneId===""||this.sceneId===void 0)&&await T.scene.setMetadata({[`${d.EXTENSIONID}/sceneId`]:crypto.randomUUID()})}if(this.caches.includes(te.SCENEGRID)&&this.sceneReady){this.gridDpi=await T.scene.grid.getDpi();const e=await T.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(te.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await T.room.getMetadata())}async InitializeCache(){if(this.sceneReady=await T.scene.isReady(),this.theme=await T.theme.getTheme(),fa(this.theme,document),this.caches.includes(te.PLAYER)&&(this.playerId=await T.player.getId(),this.playerName=await T.player.getName(),this.playerColor=await T.player.getColor(),this.playerMetadata=await T.player.getMetadata(),this.playerRole=await T.player.getRole()),this.caches.includes(te.PARTY)&&(this.party=await T.party.getPlayers()),this.caches.includes(te.SCENEFOG)&&this.sceneReady&&(this.fogColor=await T.scene.fog.getColor(),this.fogFilled=await T.scene.fog.getFilled()),this.caches.includes(te.SCENEITEMS)&&this.sceneReady&&(this.sceneItems=await T.scene.items.getItems(),this.sceneLocal=await T.scene.local.getItems()),this.caches.includes(te.SCENEMETA)&&this.sceneReady){this.sceneMetadata=await T.scene.getMetadata();const e=this.sceneMetadata[`${d.EXTENSIONID}/stored`];e&&(this.storedMetaItems=e)}if(this.caches.includes(te.SCENEGRID)&&this.sceneReady){this.gridDpi=await T.scene.grid.getDpi();const e=await T.scene.grid.getScale();this.gridScale=e.parsed?.multiplier??5,this.gridType=e.parsed.unit}this.caches.includes(te.ROOMMETA)&&this.sceneReady&&(this.roomMetadata=await T.room.getMetadata()),T.broadcast.onMessage(`${d.EXTENSIONID}/ELEVATIONEVENT`,e=>{switch(e.data){case"CANCEL":Kn();break;case"FINISH":ii();break;case"UNDO":ri();break}}),T.broadcast.onMessage(`${d.EXTENSIONID}/LINEEVENT`,e=>{switch(e.data){case"CANCEL":Vn();break;case"FINISH":ln();break;case"UNDO":Qa();break}}),T.broadcast.onMessage(`${d.EXTENSIONID}/POLYGONEVENT`,e=>{switch(e.data){case"CANCEL":Hn();break;case"FINISH":un();break;case"UNDO":ei();break}}),T.broadcast.onMessage(d.RESETPERSISTID,async e=>{await Ie.ClearPersistence()}),await this.CheckRegistration(),await this.SaveUserToScene()}async SaveUserToScene(){await T.scene.setMetadata({[`${d.EXTENSIONID}/USER-${this.playerId}`]:{role:this.playerRole,name:this.playerName,color:this.playerColor}})}KillHandlers(){this.caches.includes(te.SCENEMETA)&&this.sceneMetadataHandler!==void 0&&this.sceneMetadataHandler(),this.caches.includes(te.SCENEITEMS)&&this.sceneItemsHandler!==void 0&&this.sceneItemsHandler(),this.caches.includes(te.SCENEITEMS)&&this.sceneLocalHandler!==void 0&&this.sceneLocalHandler(),this.caches.includes(te.SCENEGRID)&&this.sceneGridHandler!==void 0&&this.sceneGridHandler(),this.caches.includes(te.PLAYER)&&this.playerHandler!==void 0&&this.playerHandler(),this.caches.includes(te.PARTY)&&this.partyHandler!==void 0&&this.partyHandler(),this.caches.includes(te.ROOMMETA)&&this.roomHandler!==void 0&&this.roomHandler(),this.caches.includes(te.SCENEFOG)&&this.fogHandler!==void 0&&this.fogHandler(),this.themeHandler!==void 0&&this.themeHandler()}SetupHandlers(){(this.sceneMetadataHandler===void 0||this.sceneMetadataHandler.length===0)&&this.caches.includes(te.SCENEMETA)&&(this.sceneMetadataHandler=T.scene.onMetadataChange(async e=>{this.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]===!0&&e[`${d.EXTENSIONID}/playerDoors`]!==!0&&Ie.ClearDoors(),w.playerRole==="GM"&&(this.sceneMetadata[`${d.EXTENSIONID}/unitContextMenu`]!==!0&&e[`${d.EXTENSIONID}/unitContextMenu`]===!0?await zn(!0):this.sceneMetadata[`${d.EXTENSIONID}/unitContextMenu`]===!0&&e[`${d.EXTENSIONID}/unitContextMenu`]!==!0&&await zn(!1)),this.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0&&e[`${d.EXTENSIONID}/persistence`]!==!0&&Ie.ClearPersistence(),this.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0&&e[`${d.EXTENSIONID}/toggleOwnerLines`]===!0?Ie.InitiateOwnerHighlight():this.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0&&e[`${d.EXTENSIONID}/toggleOwnerLines`]!==!0&&Ie.ClearOwnershipHighlights();const t=e[`${d.EXTENSIONID}/disableVision`];t!==void 0&&(this.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0&&e[`${d.EXTENSIONID}/disableVision`]!==!0||this.sceneMetadata[`${d.EXTENSIONID}/disableVision`]!==!0&&e[`${d.EXTENSIONID}/disableVision`]===!0)&&Ie.TogglePersistentLightVisibility(t),this.sceneMetadata=e,await this.OnSceneMetadataChanges(e)})),(this.sceneItemsHandler===void 0||this.sceneItemsHandler.length===0)&&this.caches.includes(te.SCENEITEMS)&&(this.sceneItemsHandler=T.scene.items.onChange(async e=>{this.sceneItems=e,await this.OnSceneItemsChange(e)}),this.sceneLocalHandler=T.scene.local.onChange(async e=>{const t=[...this.sceneLocal];this.sceneLocal=e,await this.OnSceneLocalChange(t)})),(this.sceneGridHandler===void 0||this.sceneGridHandler.length===0)&&this.caches.includes(te.SCENEGRID)&&(this.sceneGridHandler=T.scene.grid.onChange(async e=>{await this.OnSceneGridChange(e),this.gridDpi=e.dpi,this.gridScale=parseInt(e.scale)})),(this.playerHandler===void 0||this.playerHandler.length===0)&&this.caches.includes(te.PLAYER)&&(this.playerHandler=T.player.onChange(async e=>{const t=this.playerRole;let n=!1;(this.playerName!==e.name||this.playerColor!==e.color||this.playerRole!==e.role)&&(n=!0),this.playerName=e.name,this.playerColor=e.color,this.playerId=e.id,this.playerRole=e.role,this.playerMetadata=e.metadata,await this.OnPlayerChange(e,t),n&&await this.SaveUserToScene()})),(this.partyHandler===void 0||this.partyHandler.length===0)&&this.caches.includes(te.PARTY)&&(this.partyHandler=T.party.onChange(async e=>{this.party=e.filter(t=>t.id!==""),await this.OnPartyChange(e)})),(this.roomHandler===void 0||this.roomHandler.length===0)&&this.caches.includes(te.ROOMMETA)&&(this.roomHandler=T.room.onMetadataChange(async e=>{await this.OnRoomMetadataChange(e),this.roomMetadata=e})),(this.fogHandler===void 0||this.fogHandler.length===0)&&this.caches.includes(te.SCENEFOG)&&(this.fogHandler=T.scene.fog.onChange(async e=>{await this.OnFogChange(e),this.fogColor=e.style.color,this.fogFilled=e.filled})),this.themeHandler===void 0&&(this.themeHandler=T.theme.onChange(async e=>{this.theme=e,await this.OnThemeChange(e)})),this.sceneReadyHandler===void 0&&(this.sceneReadyHandler=T.scene.onReadyChange(async e=>{this.sceneReady=e,await this.OnSceneReadyChange(e)}))}async OnSceneMetadataChanges(e){this.playerRole,await ne.OnDataChange()}async OnSceneItemsChange(e){await ne.OnDataChange()}async OnSceneLocalChange(e){await _t.HandleLocalMovement(e)}async OnSceneGridChange(e){await ne.OnDataChange()}async OnSceneReadyChange(e){e?(await this.SaveUserToScene(),await this.RefreshCache(),await Ie.Reset(),await ne.Start(),this.SetupHandlers()):(this.KillHandlers(),await ne.Stop(),this.sceneItems=[],this.sceneMetadata={},this.playerRole==="GM"&&(this.toolStarted=!1),await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!1}))}async OnPlayerChange(e,t){if(this.playerRole!==t&&(await ne.Stop(),await Ie.Reset(),await ne.Start()),e.role==="GM"){const n=document.querySelectorAll(".token-table-entry");for(let h of n){let v=h.id.substring(3);e.selection!==void 0&&e.selection.includes(v)?h.classList.add("token-table-selected"):h.classList.remove("token-table-selected")}const r=e.metadata;(r[`${d.EXTENSIONID}/finishLine`]??!1)===!0&&ln(),(r[`${d.EXTENSIONID}/cancelLine`]??!1)===!0&&Vn(),(r[`${d.EXTENSIONID}/finishPoly`]??!1)===!0&&un(),(r[`${d.EXTENSIONID}/cancelPoly`]??!1)===!0&&Hn()}e.selection!==void 0&&e.selection.length===1&&Ie.ToggleDoor(e.selection[0])}async OnPartyChange(e){if(this.playerRole!=="PLAYER"){const t=document.getElementById("playerListing");t.innerHTML="",t.appendChild(ne.GetEmptyContextItem("Self"));const n=document.getElementById("preview_select");n.innerHTML="";const r=document.createElement("option");r.value=w.playerId,r.textContent="View As: Self",n.appendChild(r);for(const o of this.party){const s=document.createElement("li");s.id=o.id,s.textContent=o.name,s.style.color=o.color,t.appendChild(s);const l=document.createElement("option");l.value=o.id,l.textContent=`View As: ${o.name}`,l.style.color=o.color,n.appendChild(l)}_t.UpdateSpectreTargets()}}async OnFogChange(e){const t=document.getElementById("toggle_fogfill");t&&(t.checked=e.filled),this.fogColor!==e.style.color&&await Ie.UpdateTrailingFogColor(e.style.color)}async OnRoomMetadataChange(e){}async OnThemeChange(e){fa(e,document)}async ToggleBusy(e){const t=document.getElementById("preview_select");if(t.value!==w.playerId&&!e){const n=w.party.find(r=>r.id===t.value);n&&await T.action.setBadgeText(`Viewing as: ${n.name}`)}else await T.action.setBadgeText(e?"â±ï¸":void 0),w.busy=e}async CheckRegistration(){try{const e=window.location.origin.includes("localhost")?"eternaldream":"",t={owlbearid:w.playerId},n={method:"POST",headers:new Headers({"Content-Type":"application/json",Authorization:d.ANONAUTH,"x-manuel":e}),body:JSON.stringify(t)},r=await fetch(d.CHECKREGISTRATION,n);if(!r.ok){const s=await r.json();console.error("Error:",s);return}(await r.json()).Data==="OK"?(this.USER_REGISTERED=!0,console.log("Connected")):console.log("Not Registered")}catch(e){console.error("Error:",e)}}}const w=new te([te.SCENEITEMS,te.SCENEMETA,te.SCENEFOG,te.SCENEGRID,te.PLAYER,te.PARTY]);var yi={exports:{}};(function(a){(function(){function e(l,c){var h=l.x-c.x,v=l.y-c.y;return h*h+v*v}function t(l,c,h){var v=c.x,E=c.y,N=h.x-v,D=h.y-E;if(N!==0||D!==0){var S=((l.x-v)*N+(l.y-E)*D)/(N*N+D*D);S>1?(v=h.x,E=h.y):S>0&&(v+=N*S,E+=D*S)}return N=l.x-v,D=l.y-E,N*N+D*D}function n(l,c){for(var h=l[0],v=[h],E,N=1,D=l.length;N<D;N++)E=l[N],e(E,h)>c&&(v.push(E),h=E);return h!==E&&v.push(E),v}function r(l,c,h,v,E){for(var N=v,D,S=c+1;S<h;S++){var V=t(l[S],l[c],l[h]);V>N&&(D=S,N=V)}N>v&&(D-c>1&&r(l,c,D,v,E),E.push(l[D]),h-D>1&&r(l,D,h,v,E))}function o(l,c){var h=l.length-1,v=[l[0]];return r(l,0,h,c,v),v.push(l[h]),v}function s(l,c,h){if(l.length<=2)return l;var v=c!==void 0?c*c:1;return l=h?l:n(l,v),l=o(l,v),l}a.exports=s,a.exports.default=s})()})(yi);var As=yi.exports;const Ms=Zi(As);function Oa(){const a=document.getElementById("map_align");if(!a)return;const e=w.sceneItems.filter(r=>r.layer==="MAP"),t={};for(let r=0;r<e.length;r++){let o=a.querySelector("#map-"+e[r].id);o===null&&(o=document.createElement("option"),o.id="map-"+e[r].id,o.value=e[r].id,o.innerText=e[r].name,a.appendChild(o)),t[e[r].id]=e[r].name}let n=a.querySelectorAll("option");for(let r=0;r<n.length;r++)t[n[r].value]===void 0&&a.removeChild(n[r])}async function $s(a,e,t,n,r){if(r.innerText="",Number.isNaN(t)||t<0){r.innerText="Invalid DPI";return}let o=w.gridDpi/t,s,l=[];if(l[0]=0,l[1]=0,n!==""){let c=await T.scene.items.getItems([n]);if(c.length>0)s=c[0],t===0&&(t=s.grid.dpi),o=w.gridDpi/t,l[0]=s.position.x-s.grid.offset.x*o,l[1]=s.position.y-s.grid.offset.y*o;else{r.innerText="Unable to find map";return}}else{r.innerText="No map selected";return}a==="foundry"?Xs(e,o,l,r):a==="uvtt"&&xs(e,o,l,r)}function ka(a){const e=[];for(const t of a){const n=[];for(const o of t)n.push({x:o.x*w.gridDpi,y:o.y*w.gridDpi});const r=be().tension(0).points(n).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0}).build();e.push(r)}return e}function Ps(a){const e=[];for(const t of a){const n=[];for(const o of t.bounds)n.push({x:o.x*w.gridDpi,y:o.y*w.gridDpi});const r=be().tension(0).points(n).strokeColor(d.DOORCOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Door)").closed(!1).locked(!0).visible(!1).metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/isDoor`]:!0}).build();e.push(r)}return e}async function Rs(a,e){let t=[];a.objects_line_of_sight?.length>0&&(t=t.concat(ka(a.objects_line_of_sight))),a.line_of_sight?.length>0&&(t=t.concat(ka(a.line_of_sight))),a.portals?.length>0&&(t=t.concat(Ps(a.portals)));try{if(a.lights?.length>0){const c=[];for(const h of a.lights){const v=sn({height:150,width:150,url:"https://upload.wikimedia.org/wikipedia/commons/5/59/Empty.png",mime:"image/png"},{dpi:300,offset:{x:150,y:150}}).position({x:h.position.x*w.gridDpi,y:h.position.y*w.gridDpi}).layer("PROP").metadata({[`${d.EXTENSIONID}/hasVision`]:!0,[`${d.EXTENSIONID}/isTorch`]:!0,[`${d.EXTENSIONID}/hiddenToken`]:!0,[`${d.EXTENSIONID}/visionRange`]:h.range.toString()}).name("Imported Light Source").build();c.push(v)}t=t.concat(c)}const n=atob(a.image),r=new Uint8Array(n.length);for(let c=0;c<n.length;c++)r[c]=n.charCodeAt(c);const o=new Blob([r],{type:"image/png"}),s=qi(o).grid({dpi:a.resolution.pixels_per_grid,offset:{x:0,y:0}}).build(),l=Ki().baseMap(s).name("New UVTT Scene").items(t).build();await T.assets.uploadScenes([l],!0)}catch(n){await T.notification.show("There was an error: "+n,"ERROR")}}async function Ei(a,e,t,n,r){let o=0,s=0,l=0;const c=[];for(let h=0;h<a.length;h++){let v=[],E=!1;for(let N=0;N<a[h].length-1;N++){let D=a[h][N].x*e,S=a[h][N].y*e,V=a[h][N+1].x*e,z=a[h][N+1].y*e;v.push({x:D*t+n[0],y:S*t+n[1]}),v.push({x:V*t+n[0],y:z*t+n[1]}),s++,!E&&a[h][N].door&&(E=!0)}v.length>128&&(v.length,v=Ms(v,8,!1));for(let N=0;N<v.length;N+=256){const D=v.slice(N>0?N-1:0,N+256),S=be().tension(0).points(D).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Import)").closed(!1).locked(!0).build();S.visible=!1,S.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,E&&(S.metadata[`${d.EXTENSIONID}/isDoor`]=!0),c.push(S),l+=D.length,(l>512||c.length>64)&&(o+=c.length,await T.scene.items.addItems(c),c.length=0,l=0)}}c.length>0&&(o+=c.length,await T.scene.items.addItems(c)),r.innerText="Finished importing "+o+" walls, "+s+" points."}function xs(a,e,t,n){if(a.resolution.map_origin!==void 0&&(t[0]-=a.resolution.map_origin.x*a.resolution.pixels_per_grid,t[1]-=a.resolution.map_origin.y*a.resolution.pixels_per_grid),a.portals&&a.portals.length)for(let o=0;o<a.portals.length;o++){let s=a.portals[o].bounds;s[0].door=!0,s[1].door=!0,a.line_of_sight.push(s)}const r=a.line_of_sight.concat(a.objects_line_of_sight);Ei(r,a.resolution.pixels_per_grid,e,t,n)}function Xs(a,e,t,n){if(!a.walls||a.walls.length===0){n.innerText="No walls found";return}const r=[];for(var o=0;o<a.walls.length;o++)r.push([{x:a.walls[o].c[0],y:a.walls[o].c[1],door:!!a.walls[o].door},{x:a.walls[o].c[2],y:a.walls[o].c[3],door:!!a.walls[o].door}]);Ei(r,1,e,t,n)}function Vs(a=!1){const e=document.getElementById("hideListToggle");ne.hiddenList=document.getElementById("hidden_list"),ne.tokenList=document.getElementById("token_list"),e.onclick=async()=>{ne.hiddenList.style.display==="none"?(ne.hiddenList&&(ne.hiddenList.style.display="table-row-group"),e&&(e.value=a?"Tap to Hide List":"Out-of-Sight List: Click to Hide")):(ne.hiddenList&&(ne.hiddenList.style.display="none"),e&&(e.value=a?"Tap to Show List":"Out-of-Sight List: Click to Show"))};const t=document.getElementById("snap_checkbox");w.snap=!0,t.checked=!0,t.onclick=async k=>{if(!w.sceneReady){k.preventDefault();return}const R=k.target;w.snap=R.checked};const n=document.getElementById("disable_vision");n.checked=w.sceneMetadata[`${d.EXTENSIONID}/disableVision`]===!0,n.onclick=async k=>{{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/disableVision`]:R.checked})}};const r=document.getElementById("toggle_fogfill");r.checked=w.fogFilled,r.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.fog.setFilled(R.checked)};const o=document.getElementById("toggle_trailingfog");o.checked=w.sceneMetadata[`${d.EXTENSIONID}/trailingFog`]===!0,o.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/trailingFog`]:R.checked})};const s=document.getElementById("toggle_persistence");s.checked=w.sceneMetadata[`${d.EXTENSIONID}/persistence`]===!0,w.sceneMetadata[`${d.EXTENSIONID}/persistence`]!==!0&&(o.disabled=!0,o.checked=!1),s.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/persistence`]:R.checked}),R.checked?o.disabled=!1:(o.disabled=!0,o.checked=!1,await T.scene.setMetadata({[`${d.EXTENSIONID}/trailingFog`]:!1}))};const l=document.getElementById("reset_persistence");l.onclick=async k=>{!k||!k.target||await T.broadcast.sendMessage(d.RESETPERSISTID,!0,{destination:"ALL"})};const c=document.getElementById("toggle_ownerlines");c.checked=w.sceneMetadata[`${d.EXTENSIONID}/toggleOwnerLines`]===!0,c.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/toggleOwnerLines`]:R.checked})};const h=document.getElementById("door_checkbox");h.checked=w.sceneMetadata[`${d.EXTENSIONID}/playerDoors`]===!0,h.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/playerDoors`]:R.checked})};const v=document.getElementById("toggle_contextmenu");v.checked=w.sceneMetadata[`${d.EXTENSIONID}/unitContextMenu`]===!0,v.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/unitContextMenu`]:R.checked})};const E=document.getElementById("toggle_gmwalls");E.checked=w.sceneMetadata[`${d.EXTENSIONID}/passWallsGM`]===!0,E.onclick=async k=>{if(!k||!k.target)return;const R=k.target;await T.scene.setMetadata({[`${d.EXTENSIONID}/passWallsGM`]:R.checked})};const N=document.getElementById("lock_button"),D=document.getElementById("unlock_button");D.onclick=async k=>{if(!k||!k.target)return;const R=w.sceneItems.filter(F=>Pt(F));await w.ToggleBusy(!0);for(let F=0;F<R.length;F+=64){const ee=R.slice(F,F+64);await T.scene.items.updateItems(ee.map(Q=>Q.id),Q=>{for(let J of Q)J.locked=!1})}w.ToggleBusy(!1)},N.onclick=async k=>{if(!k||!k.target)return;const R=w.sceneItems.filter(F=>Pt(F));await w.ToggleBusy(!0);for(let F=0;F<R.length;F+=64){const ee=R.slice(F,F+64);await T.scene.items.updateItems(ee.map(Q=>Q.id),Q=>{for(let J of Q)J.locked=!0})}await w.ToggleBusy(!1)};const S=document.getElementById("doublewall_button");S.onclick=async k=>{if(!k||!k.target)return;const R=w.sceneItems.filter(F=>Pt(F));await w.ToggleBusy(!0);for(let F=0;F<R.length;F+=64){const ee=R.slice(F,F+64);await T.scene.items.updateItems(ee.map(Q=>Q.id),Q=>{for(let J of Q)J.metadata[`${d.EXTENSIONID}/doubleSided`]=!0})}w.ToggleBusy(!1)};const V=document.getElementById("block_button"),z=document.getElementById("unblock_button");z.onclick=async k=>{if(!k||!k.target)return;const R=w.sceneItems.filter(F=>Pt(F));await w.ToggleBusy(!0);for(let F=0;F<R.length;F+=64){const ee=R.slice(F,F+64);await T.scene.items.updateItems(ee.map(Q=>Q.id),Q=>{for(let J of Q)J.metadata[`${d.EXTENSIONID}/blocking`]=void 0})}w.ToggleBusy(!1)},V.onclick=async k=>{if(!k||!k.target)return;const R=w.sceneItems.filter(F=>Pt(F));await w.ToggleBusy(!0);for(let F=0;F<R.length;F+=64){const ee=R.slice(F,F+64);await T.scene.items.updateItems(ee.map(Q=>Q.id),Q=>{for(let J of Q)J.metadata[`${d.EXTENSIONID}/blocking`]=!0})}await w.ToggleBusy(!1)};const H=document.getElementById("visionDefaultInput");H.value=w.sceneMetadata[`${d.EXTENSIONID}/visionRangeDefault`]??we(),H.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseInt(R.value);F<0&&(R.value="0"),F>999&&(R.value="999"),isNaN(F)&&(R.value=Ve()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionRangeDefault`]:R.value})};const L=document.getElementById("collisionDefaultInput");L.value=w.sceneMetadata[`${d.EXTENSIONID}/visionSourceDefault`]??Ve().toString(),L.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseFloat(R.value);F<0&&(R.value="0"),F>999&&(R.value="999"),isNaN(F)&&(R.value=Ve()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionSourceDefault`]:R.value})};const W=document.getElementById("greyscaleDefaultInput");W.value=w.sceneMetadata[`${d.EXTENSIONID}/visionDarkDefault`]??dn().toString(),W.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseInt(R.value);F<0&&(R.value="0"),F>999&&(R.value="999"),isNaN(F)&&(R.value=Ve()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionDarkDefault`]:R.value})};const i=document.getElementById("innerAngleDefaultInput");i.value=w.sceneMetadata[`${d.EXTENSIONID}/visionInAngleDefault`]??tt().toString(),i.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseInt(R.value);F<0&&(R.value="0"),F>360&&(R.value="360"),isNaN(F)&&(R.value=Ue()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionInAngleDefault`]:R.value})};const f=document.getElementById("outerAngleDefaultInput");f.value=w.sceneMetadata[`${d.EXTENSIONID}/visionOutAngleDefault`]??Ue().toString(),f.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseInt(R.value);F<0&&(R.value="0"),F>360&&(R.value="360"),isNaN(F)&&(R.value=Ue()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionOutAngleDefault`]:R.value})};const u=document.getElementById("falloffDefaultInput");u.value=w.sceneMetadata[`${d.EXTENSIONID}/visionFallOffDefault`]??Qe().toString(),u.onchange=async k=>{if(!k||!k.target)return;const R=k.target,F=parseFloat(R.value);F<0&&(R.value="0"),F>10&&(R.value="10"),isNaN(F)&&(R.value=Qe()),await T.scene.setMetadata({[`${d.EXTENSIONID}/visionFallOffDefault`]:R.value})};var p;const y=document.getElementById("import_button"),m=document.getElementById("import_file"),g=document.getElementById("import_errors"),b=document.getElementById("import_dpi"),$=document.getElementById("import_format"),C=document.getElementById("dpi_autodetect"),M=document.getElementById("map_align");m.onchange=k=>{if(y.disabled=!0,!k||!k.target)return;const R=k.target;if(!R.files)return;const F=R.files[0];if(F.type!=="text/javascript"&&F.type,F){const Q=document.getElementById("import_file_name");Q&&(Q.textContent=F.name);var ee=new FileReader;ee.onload=function(J){if(!J||!J.target){g.innerText="Invalid import event";return}const de=J.target;if(!de.result){g.innerText="Unable to read imported file";return}const oe=de.result;p=JSON.parse(oe),p&&(p.walls&&p.walls.length||p.line_of_sight&&p.line_of_sight.length||p.objects_line_of_sight&&p.objects_line_of_sight.length)?y.disabled=!1:g.innerText="Imported file has no walls"},ee.readAsText(F)}else g.innerText="Failed to load file"},C.onclick=async k=>{!k||!k.target||(b.disabled=C.checked)},y.onclick=async k=>{!k||!k.target||(await w.ToggleBusy(!0),$.value==="scene"?await Rs(p):await $s($.value,p,C.checked?0:Number.parseInt(b.value),M.value,g),await w.ToggleBusy(!1))};const P=document.getElementById("tool_width"),I=document.getElementById("tool_color"),A=document.getElementById("tool_style");let j;const U=document.getElementById("preview_select");U.onchange=async k=>{k.currentTarget,await w.ToggleBusy(!1),await Ie.Run()},I.onclick=async k=>{Be({el:`#${I.id}`,alpha:!1,forceAlpha:!1})},I.oninput=async k=>{if(!k||!k.target)return;const R=k.target;clearTimeout(j),j=setTimeout(async()=>{/#[a-f0-9]{6}/.test(R.value)&&await T.scene.setMetadata({[`${d.EXTENSIONID}/toolColor`]:R.value})},400)},A.onchange=async k=>{const R=k.currentTarget;await T.scene.setMetadata({[`${d.EXTENSIONID}/toolStyle`]:R.value=="solid"?[]:[25,25]})},P.onchange=k=>{const R=k.currentTarget;clearTimeout(j);try{const F=parseInt(R.value);(F<1||F>100)&&(R.value="8")}catch{console.log("Tool Width value set out of range, swapping to default"),R.value="8"}j=setTimeout(async()=>{await T.scene.setMetadata({[`${d.EXTENSIONID}/toolWidth`]:R.value})},400)};const Y=w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??"#000000";I&&(I.value=Y),Be({themeMode:"dark",alpha:!1,forceAlpha:!1,el:"#tool_color",defaultColor:Y})}let et=[];async function Ii(){et=[];const a=await T.scene.local.getItems(Cr);await T.scene.local.deleteItems(a.map(e=>e.id)),await T.popover.close(d.BRUSHTOOLID)}async function Hs(a,e){await wi(e.pointerPosition)}async function Bs(){const a=await T.viewport.getWidth();await T.popover.open({id:d.BRUSHTOOLID,url:"/pages/brush.html",height:80,width:350,disableClickAway:!0,anchorPosition:{top:60,left:a/2},anchorReference:"POSITION",anchorOrigin:{vertical:"CENTER",horizontal:"CENTER"},transformOrigin:{vertical:"TOP",horizontal:"CENTER"}})}async function Fs(){await T.popover.close(d.BRUSHTOOLID)}async function js(a,e){await wi(e.pointerPosition)}async function zs(a,e){await Gs(),await Ii()}async function Us(a,e){await Ii()}async function wi(a){const e={x:Math.floor(a.x/w.gridDpi),y:Math.floor(a.y/w.gridDpi)};if(!et.some(n=>n.x===e.x&&n.y===e.y)){const n={x:e.x*w.gridDpi,y:e.y*w.gridDpi},r={x:(e.x+1)*w.gridDpi,y:e.y*w.gridDpi},o={x:e.x*w.gridDpi,y:(e.y+1)*w.gridDpi},s={x:(e.x+1)*w.gridDpi,y:(e.y+1)*w.gridDpi},l=[[Mt.MOVE,n.x,n.y],[Mt.LINE,r.x,r.y],[Mt.LINE,s.x,s.y],[Mt.LINE,o.x,o.y],[Mt.CLOSE]],c=Yi().commands(l).strokeOpacity(0).fillOpacity(.5).fillColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).build();c.metadata[`${d.EXTENSIONID}/isBrushSquare`]=!0,c.layer="POINTER",et.push(e),await T.scene.local.addItems([c])}}async function Gs(){const a=[];for(const s of et){const{x:l,y:c}=s,h={x:l*w.gridDpi,y:c*w.gridDpi},v={x:(l+1)*w.gridDpi,y:c*w.gridDpi},E={x:l*w.gridDpi,y:(c+1)*w.gridDpi},N={x:(l+1)*w.gridDpi,y:(c+1)*w.gridDpi};if(!et.some(D=>D.x===l&&D.y===c-1)){const D=h,S=v;a.push({Start:D,End:S})}if(!et.some(D=>D.x===l&&D.y===c+1)){const D=E,S=N;a.push({Start:D,End:S})}if(!et.some(D=>D.x===l-1&&D.y===c)){const D=h,S=E;a.push({Start:D,End:S})}if(!et.some(D=>D.x===l+1&&D.y===c)){const D=v,S=N;a.push({Start:D,End:S})}}const e=Ti(a),t=bi(e),n=Ks(t),r=25,o=n.length;for(let s=0;s<o;s+=r){const l=n.slice(s,s+r);await T.scene.items.addItems(l)}}function bi(a){let e=[],t=[],n=!1;for(const r of a){const o=r.Start.x===r.End.x?a.filter(c=>c.Start.x===c.End.x):a.filter(c=>c.Start.y===c.End.y),s=r.Start.x===r.End.x?o.filter(c=>c.Start.x===r.Start.x&&c.End.x===r.End.x):o.filter(c=>c.Start.y===r.Start.y&&c.End.y===r.End.y),l=r.Start.x!==r.End.x?s.find(c=>c.Start.x>r.Start.x&&c.Start.x<r.End.x):s.find(c=>c.Start.y>r.Start.y&&c.Start.y<r.End.y);if(l){const c=qs(r,l);t.push(c),e.push(r),e.push(l),t=t.filter(h=>h!==r&&h!==l),n=!0}else e.includes(r)||t.push(r)}return n?bi(t):t}function Ti(a){let e=[],t=[],n=!1;for(const r of a){const s=(r.Start.x===r.End.x?a.filter(l=>l.Start.x===l.End.x):a.filter(l=>l.Start.y===l.End.y)).find(l=>l.Start.x===r.End.x&&l.Start.y===r.End.y);if(s){const l=Ws(r,s);t.push(l),e.push(r),e.push(s),t=t.filter(c=>c!==r&&c!==s),n=!0}else e.includes(r)||t.push(r)}return n?Ti(t):t}function Ws(a,e){return{Start:a.Start,End:e.End}}function qs(a,e){const t=Math.min(a.Start.x,e.Start.x),n=Math.min(a.Start.y,e.Start.y),r=Math.max(a.End.x,e.End.x),o=Math.max(a.End.y,e.End.y);return{Start:{x:t,y:n},End:{x:r,y:o}}}function Ks(a){const e=[];for(const t of a){const n=be().tension(0).points([t.Start,t.End]).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Brushed)").closed(!1).locked(!0).build();n.visible=!1,n.metadata[`${d.EXTENSIONID}/isVisionLine`]=!0,n.metadata[`${d.EXTENSIONID}/blocking`]=!0,n.metadata[`${d.EXTENSIONID}/doubleSided`]=!0,e.push(n)}return e}const Et={onActivate:Bs,onDeactivate:Fs,onDragStart:Hs,onDragMove:js,onDragEnd:zs,onDragCancel:Us};let Nt=[],_i="",St="",It=null,Jt=!1,An=!1;async function Ni(){Nt=[],St="",await T.scene.local.deleteItems([_i])}async function Ys(a){const e=a.position.x!==0&&a.position.y!==0,t=e?Da(a.points,a.position,!0):a.points,n=dr(t,Nt[0],Nt[1],a.rotation,a.position),r=[],o=be().tension(0).points(n.extracted).strokeColor("red").strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0,[`${d.EXTENSIONID}/blocking`]:!0}).closed(!1).visible(!1).locked(!0).build();r.push(o);for(const s of n.remaining){const l=be().tension(0).position(a.position).strokeColor(w.sceneMetadata[`${d.EXTENSIONID}/toolColor`]??d.DEFAULTLINECOLOR).strokeDash(w.sceneMetadata[`${d.EXTENSIONID}/toolStyle`]??d.DEFAULTLINESTROKE).strokeWidth(ve()).fillOpacity(0).rotation(a.rotation).fillColor("#000000").layer(d.LINELAYER).name("Vision Line (Line)").metadata({[`${d.EXTENSIONID}/isVisionLine`]:!0,[`${d.EXTENSIONID}/doubleSided`]:!0,[`${d.EXTENSIONID}/blocking`]:!0}).closed(!1).visible(!1).locked(!0).build();l.points=e?Da(s,a.position,!1):s,r.push(l)}await T.scene.items.deleteItems([a.id]),await T.scene.items.addItems(r),Ni()}async function Qs(a,e){if(!e.transformer&&!(!e.target||e.target.type!=="CURVE"||St!==""&&St!==e.target.id)){if(St=e.target.id,Nt.push(e.pointerPosition),Nt.length===1){const t=Si();t.position=e.pointerPosition,_i=t.id,await T.scene.local.addItems([t])}Nt.length===2&&Ys(e.target)}}async function Js(a,e){if(e.target&&e.target.type==="CURVE"&&(St===""||St===e.target.id)){if(!Jt&&!An){It||(An=!0,It=await T.interaction.startItemInteraction(Si()));const[t]=It;t(n=>{n.position=e.pointerPosition}),An=!1}}else if(It&&(!e.target||e.target&&e.target.type!=="CURVE")){const[t,n]=It;n(),It=null,Jt||(setTimeout(()=>{Jt=!1},50),Jt=!0)}}function Zs(a,e){e.key=="Escape"&&Ni()}function Si(){const a=ve();return Qi().color("red").radius(a+4).disableHit(!0).build()}function Da(a,e,t){return a.map(n=>({x:t?n.x+e.x:n.x-e.x,y:t?n.y+e.y:n.y-e.y}))}const Mn={onToolClick:Qs,onToolMove:Js,onKeyDown:Zs};async function eo(){await T.tool.create({id:`${d.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],defaultMetadata:{[`${d.EXTENSIONID}/elevationEditor`]:!1},async onClick(){await T.tool.activateTool(`${d.EXTENSIONID}/vision-tool`),w.toolStarted||(w.toolStarted=!0,await T.tool.setMetadata(`${d.EXTENSIONID}/vision-tool`,{[`${d.EXTENSIONID}/elevationEditor`]:!1}))}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:qt.onToolClick,onToolMove:qt.onToolMove,onToolDoubleClick:qt.onToolDouble,onKeyDown:qt.onKeyDown,preventDrag:{dragging:!1}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:Kt.onToolClick,onToolMove:Kt.onToolMove,onToolDoubleClick:Kt.onToolDouble,onKeyDown:Kt.onKeyDown,preventDrag:{dragging:!1}}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-vision-brush-mode`,icons:[{icon:"/brush.svg",label:"Paint Obstructions by Grid",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:Et.onActivate,onToolUp:Et.onDeactivate,onToolDragStart:Et.onDragStart,onToolDragMove:Et.onDragMove,onToolDragEnd:Et.onDragEnd,onToolDragCancel:Et.onDragCancel}),await T.tool.createMode({id:`${d.EXTENSIONID}/add-line-cutter-mode`,icons:[{icon:"/cutter.svg",label:"Trim Line",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],onToolDown:Mn.onToolClick,onToolMove:Mn.onToolMove,onKeyDown:Mn.onKeyDown,preventDrag:{dragging:!1},cursors:[{cursor:"crosshair"}]}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-1`,icons:[{icon:"/mountain1.svg",label:"Create Map Elevation Layer-1",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{he.onToolClick(a,e,1)},onToolMove:he.onToolMove,onKeyDown:(a,e)=>{he.onKeyDown(a,e,1)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-2`,icons:[{icon:"/mountain2.svg",label:"Create Map Elevation Layer-2",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{he.onToolClick(a,e,2)},onToolMove:he.onToolMove,onKeyDown:(a,e)=>{he.onKeyDown(a,e,2)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-3`,icons:[{icon:"/mountain3.svg",label:"Create Map Elevation Layer-3",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{he.onToolClick(a,e,3)},onToolMove:he.onToolMove,onKeyDown:(a,e)=>{he.onKeyDown(a,e,3)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-4`,icons:[{icon:"/mountain4.svg",label:"Create Map Elevation Layer-4",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{he.onToolClick(a,e,4)},onToolMove:he.onToolMove,onKeyDown:(a,e)=>{he.onKeyDown(a,e,4)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-5`,icons:[{icon:"/mountain5.svg",label:"Create Map Elevation Layer-5",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>{he.onToolClick(a,e,5)},onToolMove:he.onToolMove,onKeyDown:(a,e)=>{he.onKeyDown(a,e,5)},preventDrag:{dragging:!0}}),await T.tool.createMode({id:`${d.EXTENSIONID}/enter-elevation-mode-select`,icons:[{icon:"/mountain-select.svg",label:"Selector",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`]}}],disabled:{metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!1}]},onToolDown:(a,e)=>!0,preventDrag:{dragging:!0}}),await T.tool.createAction({id:`${d.EXTENSIONID}/enter-elevation-mode`,icons:[{icon:"/eyeclosed.svg",label:"Activate Elevation Editor",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`],metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!0,operator:"!="}]}},{icon:"/eyeopen.svg",label:"De-Activate Elevation Editor",filter:{activeTools:[`${d.EXTENSIONID}/vision-tool`],metadata:[{key:[`${d.EXTENSIONID}/elevationEditor`],value:!0,operator:"=="}]}}],onClick:he.enterEditMode})}var Se="top",$e="bottom",Pe="right",Oe="left",Jn="auto",jt=[Se,$e,Pe,Oe],Ot="start",Bt="end",to="clippingParents",Oi="viewport",Rt="popper",no="reference",Ca=jt.reduce(function(a,e){return a.concat([e+"-"+Ot,e+"-"+Bt])},[]),ki=[].concat(jt,[Jn]).reduce(function(a,e){return a.concat([e,e+"-"+Ot,e+"-"+Bt])},[]),ao="beforeRead",io="read",ro="afterRead",so="beforeMain",oo="main",lo="afterMain",uo="beforeWrite",co="write",fo="afterWrite",po=[ao,io,ro,so,oo,lo,uo,co,fo];function We(a){return a?(a.nodeName||"").toLowerCase():null}function Ce(a){if(a==null)return window;if(a.toString()!=="[object Window]"){var e=a.ownerDocument;return e&&e.defaultView||window}return a}function ct(a){var e=Ce(a).Element;return a instanceof e||a instanceof Element}function Me(a){var e=Ce(a).HTMLElement;return a instanceof e||a instanceof HTMLElement}function Zn(a){if(typeof ShadowRoot>"u")return!1;var e=Ce(a).ShadowRoot;return a instanceof e||a instanceof ShadowRoot}function ho(a){var e=a.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];!Me(o)||!We(o)||(Object.assign(o.style,n),Object.keys(r).forEach(function(s){var l=r[s];l===!1?o.removeAttribute(s):o.setAttribute(s,l===!0?"":l)}))})}function go(a){var e=a.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],o=e.attributes[n]||{},s=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),l=s.reduce(function(c,h){return c[h]="",c},{});!Me(r)||!We(r)||(Object.assign(r.style,l),Object.keys(o).forEach(function(c){r.removeAttribute(c)}))})}}const Di={name:"applyStyles",enabled:!0,phase:"write",fn:ho,effect:go,requires:["computeStyles"]};function Ge(a){return a.split("-")[0]}var ut=Math.max,gn=Math.min,kt=Math.round;function Un(){var a=navigator.userAgentData;return a!=null&&a.brands&&Array.isArray(a.brands)?a.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ci(){return!/^((?!chrome|android).)*safari/i.test(Un())}function Dt(a,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=a.getBoundingClientRect(),r=1,o=1;e&&Me(a)&&(r=a.offsetWidth>0&&kt(n.width)/a.offsetWidth||1,o=a.offsetHeight>0&&kt(n.height)/a.offsetHeight||1);var s=ct(a)?Ce(a):window,l=s.visualViewport,c=!Ci()&&t,h=(n.left+(c&&l?l.offsetLeft:0))/r,v=(n.top+(c&&l?l.offsetTop:0))/o,E=n.width/r,N=n.height/o;return{width:E,height:N,top:v,right:h+E,bottom:v+N,left:h,x:h,y:v}}function ea(a){var e=Dt(a),t=a.offsetWidth,n=a.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:a.offsetLeft,y:a.offsetTop,width:t,height:n}}function Li(a,e){var t=e.getRootNode&&e.getRootNode();if(a.contains(e))return!0;if(t&&Zn(t)){var n=e;do{if(n&&a.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Je(a){return Ce(a).getComputedStyle(a)}function mo(a){return["table","td","th"].indexOf(We(a))>=0}function nt(a){return((ct(a)?a.ownerDocument:a.document)||window.document).documentElement}function yn(a){return We(a)==="html"?a:a.assignedSlot||a.parentNode||(Zn(a)?a.host:null)||nt(a)}function La(a){return!Me(a)||Je(a).position==="fixed"?null:a.offsetParent}function vo(a){var e=/firefox/i.test(Un()),t=/Trident/i.test(Un());if(t&&Me(a)){var n=Je(a);if(n.position==="fixed")return null}var r=yn(a);for(Zn(r)&&(r=r.host);Me(r)&&["html","body"].indexOf(We(r))<0;){var o=Je(r);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return r;r=r.parentNode}return null}function zt(a){for(var e=Ce(a),t=La(a);t&&mo(t)&&Je(t).position==="static";)t=La(t);return t&&(We(t)==="html"||We(t)==="body"&&Je(t).position==="static")?e:t||vo(a)||e}function ta(a){return["top","bottom"].indexOf(a)>=0?"x":"y"}function xt(a,e,t){return ut(a,gn(e,t))}function yo(a,e,t){var n=xt(a,e,t);return n>t?t:n}function Ai(){return{top:0,right:0,bottom:0,left:0}}function Mi(a){return Object.assign({},Ai(),a)}function $i(a,e){return e.reduce(function(t,n){return t[n]=a,t},{})}var Eo=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Mi(typeof e!="number"?e:$i(e,jt))};function Io(a){var e,t=a.state,n=a.name,r=a.options,o=t.elements.arrow,s=t.modifiersData.popperOffsets,l=Ge(t.placement),c=ta(l),h=[Oe,Pe].indexOf(l)>=0,v=h?"height":"width";if(!(!o||!s)){var E=Eo(r.padding,t),N=ea(o),D=c==="y"?Se:Oe,S=c==="y"?$e:Pe,V=t.rects.reference[v]+t.rects.reference[c]-s[c]-t.rects.popper[v],z=s[c]-t.rects.reference[c],H=zt(o),L=H?c==="y"?H.clientHeight||0:H.clientWidth||0:0,W=V/2-z/2,i=E[D],f=L-N[v]-E[S],u=L/2-N[v]/2+W,p=xt(i,u,f),y=c;t.modifiersData[n]=(e={},e[y]=p,e.centerOffset=p-u,e)}}function wo(a){var e=a.state,t=a.options,n=t.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||Li(e.elements.popper,r)&&(e.elements.arrow=r))}const bo={name:"arrow",enabled:!0,phase:"main",fn:Io,effect:wo,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ct(a){return a.split("-")[1]}var To={top:"auto",right:"auto",bottom:"auto",left:"auto"};function _o(a,e){var t=a.x,n=a.y,r=e.devicePixelRatio||1;return{x:kt(t*r)/r||0,y:kt(n*r)/r||0}}function Aa(a){var e,t=a.popper,n=a.popperRect,r=a.placement,o=a.variation,s=a.offsets,l=a.position,c=a.gpuAcceleration,h=a.adaptive,v=a.roundOffsets,E=a.isFixed,N=s.x,D=N===void 0?0:N,S=s.y,V=S===void 0?0:S,z=typeof v=="function"?v({x:D,y:V}):{x:D,y:V};D=z.x,V=z.y;var H=s.hasOwnProperty("x"),L=s.hasOwnProperty("y"),W=Oe,i=Se,f=window;if(h){var u=zt(t),p="clientHeight",y="clientWidth";if(u===Ce(t)&&(u=nt(t),Je(u).position!=="static"&&l==="absolute"&&(p="scrollHeight",y="scrollWidth")),u=u,r===Se||(r===Oe||r===Pe)&&o===Bt){i=$e;var m=E&&u===f&&f.visualViewport?f.visualViewport.height:u[p];V-=m-n.height,V*=c?1:-1}if(r===Oe||(r===Se||r===$e)&&o===Bt){W=Pe;var g=E&&u===f&&f.visualViewport?f.visualViewport.width:u[y];D-=g-n.width,D*=c?1:-1}}var b=Object.assign({position:l},h&&To),$=v===!0?_o({x:D,y:V},Ce(t)):{x:D,y:V};if(D=$.x,V=$.y,c){var C;return Object.assign({},b,(C={},C[i]=L?"0":"",C[W]=H?"0":"",C.transform=(f.devicePixelRatio||1)<=1?"translate("+D+"px, "+V+"px)":"translate3d("+D+"px, "+V+"px, 0)",C))}return Object.assign({},b,(e={},e[i]=L?V+"px":"",e[W]=H?D+"px":"",e.transform="",e))}function No(a){var e=a.state,t=a.options,n=t.gpuAcceleration,r=n===void 0?!0:n,o=t.adaptive,s=o===void 0?!0:o,l=t.roundOffsets,c=l===void 0?!0:l,h={placement:Ge(e.placement),variation:Ct(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Aa(Object.assign({},h,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:s,roundOffsets:c})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Aa(Object.assign({},h,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const So={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:No,data:{}};var Zt={passive:!0};function Oo(a){var e=a.state,t=a.instance,n=a.options,r=n.scroll,o=r===void 0?!0:r,s=n.resize,l=s===void 0?!0:s,c=Ce(e.elements.popper),h=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&h.forEach(function(v){v.addEventListener("scroll",t.update,Zt)}),l&&c.addEventListener("resize",t.update,Zt),function(){o&&h.forEach(function(v){v.removeEventListener("scroll",t.update,Zt)}),l&&c.removeEventListener("resize",t.update,Zt)}}const ko={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Oo,data:{}};var Do={left:"right",right:"left",bottom:"top",top:"bottom"};function rn(a){return a.replace(/left|right|bottom|top/g,function(e){return Do[e]})}var Co={start:"end",end:"start"};function Ma(a){return a.replace(/start|end/g,function(e){return Co[e]})}function na(a){var e=Ce(a),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function aa(a){return Dt(nt(a)).left+na(a).scrollLeft}function Lo(a,e){var t=Ce(a),n=nt(a),r=t.visualViewport,o=n.clientWidth,s=n.clientHeight,l=0,c=0;if(r){o=r.width,s=r.height;var h=Ci();(h||!h&&e==="fixed")&&(l=r.offsetLeft,c=r.offsetTop)}return{width:o,height:s,x:l+aa(a),y:c}}function Ao(a){var e,t=nt(a),n=na(a),r=(e=a.ownerDocument)==null?void 0:e.body,o=ut(t.scrollWidth,t.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),s=ut(t.scrollHeight,t.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),l=-n.scrollLeft+aa(a),c=-n.scrollTop;return Je(r||t).direction==="rtl"&&(l+=ut(t.clientWidth,r?r.clientWidth:0)-o),{width:o,height:s,x:l,y:c}}function ia(a){var e=Je(a),t=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+n)}function Pi(a){return["html","body","#document"].indexOf(We(a))>=0?a.ownerDocument.body:Me(a)&&ia(a)?a:Pi(yn(a))}function Xt(a,e){var t;e===void 0&&(e=[]);var n=Pi(a),r=n===((t=a.ownerDocument)==null?void 0:t.body),o=Ce(n),s=r?[o].concat(o.visualViewport||[],ia(n)?n:[]):n,l=e.concat(s);return r?l:l.concat(Xt(yn(s)))}function Gn(a){return Object.assign({},a,{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height})}function Mo(a,e){var t=Dt(a,!1,e==="fixed");return t.top=t.top+a.clientTop,t.left=t.left+a.clientLeft,t.bottom=t.top+a.clientHeight,t.right=t.left+a.clientWidth,t.width=a.clientWidth,t.height=a.clientHeight,t.x=t.left,t.y=t.top,t}function $a(a,e,t){return e===Oi?Gn(Lo(a,t)):ct(e)?Mo(e,t):Gn(Ao(nt(a)))}function $o(a){var e=Xt(yn(a)),t=["absolute","fixed"].indexOf(Je(a).position)>=0,n=t&&Me(a)?zt(a):a;return ct(n)?e.filter(function(r){return ct(r)&&Li(r,n)&&We(r)!=="body"}):[]}function Po(a,e,t,n){var r=e==="clippingParents"?$o(a):[].concat(e),o=[].concat(r,[t]),s=o[0],l=o.reduce(function(c,h){var v=$a(a,h,n);return c.top=ut(v.top,c.top),c.right=gn(v.right,c.right),c.bottom=gn(v.bottom,c.bottom),c.left=ut(v.left,c.left),c},$a(a,s,n));return l.width=l.right-l.left,l.height=l.bottom-l.top,l.x=l.left,l.y=l.top,l}function Ri(a){var e=a.reference,t=a.element,n=a.placement,r=n?Ge(n):null,o=n?Ct(n):null,s=e.x+e.width/2-t.width/2,l=e.y+e.height/2-t.height/2,c;switch(r){case Se:c={x:s,y:e.y-t.height};break;case $e:c={x:s,y:e.y+e.height};break;case Pe:c={x:e.x+e.width,y:l};break;case Oe:c={x:e.x-t.width,y:l};break;default:c={x:e.x,y:e.y}}var h=r?ta(r):null;if(h!=null){var v=h==="y"?"height":"width";switch(o){case Ot:c[h]=c[h]-(e[v]/2-t[v]/2);break;case Bt:c[h]=c[h]+(e[v]/2-t[v]/2);break}}return c}function Ft(a,e){e===void 0&&(e={});var t=e,n=t.placement,r=n===void 0?a.placement:n,o=t.strategy,s=o===void 0?a.strategy:o,l=t.boundary,c=l===void 0?to:l,h=t.rootBoundary,v=h===void 0?Oi:h,E=t.elementContext,N=E===void 0?Rt:E,D=t.altBoundary,S=D===void 0?!1:D,V=t.padding,z=V===void 0?0:V,H=Mi(typeof z!="number"?z:$i(z,jt)),L=N===Rt?no:Rt,W=a.rects.popper,i=a.elements[S?L:N],f=Po(ct(i)?i:i.contextElement||nt(a.elements.popper),c,v,s),u=Dt(a.elements.reference),p=Ri({reference:u,element:W,strategy:"absolute",placement:r}),y=Gn(Object.assign({},W,p)),m=N===Rt?y:u,g={top:f.top-m.top+H.top,bottom:m.bottom-f.bottom+H.bottom,left:f.left-m.left+H.left,right:m.right-f.right+H.right},b=a.modifiersData.offset;if(N===Rt&&b){var $=b[r];Object.keys(g).forEach(function(C){var M=[Pe,$e].indexOf(C)>=0?1:-1,P=[Se,$e].indexOf(C)>=0?"y":"x";g[C]+=$[P]*M})}return g}function Ro(a,e){e===void 0&&(e={});var t=e,n=t.placement,r=t.boundary,o=t.rootBoundary,s=t.padding,l=t.flipVariations,c=t.allowedAutoPlacements,h=c===void 0?ki:c,v=Ct(n),E=v?l?Ca:Ca.filter(function(S){return Ct(S)===v}):jt,N=E.filter(function(S){return h.indexOf(S)>=0});N.length===0&&(N=E);var D=N.reduce(function(S,V){return S[V]=Ft(a,{placement:V,boundary:r,rootBoundary:o,padding:s})[Ge(V)],S},{});return Object.keys(D).sort(function(S,V){return D[S]-D[V]})}function xo(a){if(Ge(a)===Jn)return[];var e=rn(a);return[Ma(a),e,Ma(e)]}function Xo(a){var e=a.state,t=a.options,n=a.name;if(!e.modifiersData[n]._skip){for(var r=t.mainAxis,o=r===void 0?!0:r,s=t.altAxis,l=s===void 0?!0:s,c=t.fallbackPlacements,h=t.padding,v=t.boundary,E=t.rootBoundary,N=t.altBoundary,D=t.flipVariations,S=D===void 0?!0:D,V=t.allowedAutoPlacements,z=e.options.placement,H=Ge(z),L=H===z,W=c||(L||!S?[rn(z)]:xo(z)),i=[z].concat(W).reduce(function(ee,Q){return ee.concat(Ge(Q)===Jn?Ro(e,{placement:Q,boundary:v,rootBoundary:E,padding:h,flipVariations:S,allowedAutoPlacements:V}):Q)},[]),f=e.rects.reference,u=e.rects.popper,p=new Map,y=!0,m=i[0],g=0;g<i.length;g++){var b=i[g],$=Ge(b),C=Ct(b)===Ot,M=[Se,$e].indexOf($)>=0,P=M?"width":"height",I=Ft(e,{placement:b,boundary:v,rootBoundary:E,altBoundary:N,padding:h}),A=M?C?Pe:Oe:C?$e:Se;f[P]>u[P]&&(A=rn(A));var j=rn(A),U=[];if(o&&U.push(I[$]<=0),l&&U.push(I[A]<=0,I[j]<=0),U.every(function(ee){return ee})){m=b,y=!1;break}p.set(b,U)}if(y)for(var Y=S?3:1,k=function(Q){var J=i.find(function(de){var oe=p.get(de);if(oe)return oe.slice(0,Q).every(function(Le){return Le})});if(J)return m=J,"break"},R=Y;R>0;R--){var F=k(R);if(F==="break")break}e.placement!==m&&(e.modifiersData[n]._skip=!0,e.placement=m,e.reset=!0)}}const Vo={name:"flip",enabled:!0,phase:"main",fn:Xo,requiresIfExists:["offset"],data:{_skip:!1}};function Pa(a,e,t){return t===void 0&&(t={x:0,y:0}),{top:a.top-e.height-t.y,right:a.right-e.width+t.x,bottom:a.bottom-e.height+t.y,left:a.left-e.width-t.x}}function Ra(a){return[Se,Pe,$e,Oe].some(function(e){return a[e]>=0})}function Ho(a){var e=a.state,t=a.name,n=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,s=Ft(e,{elementContext:"reference"}),l=Ft(e,{altBoundary:!0}),c=Pa(s,n),h=Pa(l,r,o),v=Ra(c),E=Ra(h);e.modifiersData[t]={referenceClippingOffsets:c,popperEscapeOffsets:h,isReferenceHidden:v,hasPopperEscaped:E},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":v,"data-popper-escaped":E})}const Bo={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Ho};function Fo(a,e,t){var n=Ge(a),r=[Oe,Se].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:a})):t,s=o[0],l=o[1];return s=s||0,l=(l||0)*r,[Oe,Pe].indexOf(n)>=0?{x:l,y:s}:{x:s,y:l}}function jo(a){var e=a.state,t=a.options,n=a.name,r=t.offset,o=r===void 0?[0,0]:r,s=ki.reduce(function(v,E){return v[E]=Fo(E,e.rects,o),v},{}),l=s[e.placement],c=l.x,h=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=h),e.modifiersData[n]=s}const zo={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:jo};function Uo(a){var e=a.state,t=a.name;e.modifiersData[t]=Ri({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const Go={name:"popperOffsets",enabled:!0,phase:"read",fn:Uo,data:{}};function Wo(a){return a==="x"?"y":"x"}function qo(a){var e=a.state,t=a.options,n=a.name,r=t.mainAxis,o=r===void 0?!0:r,s=t.altAxis,l=s===void 0?!1:s,c=t.boundary,h=t.rootBoundary,v=t.altBoundary,E=t.padding,N=t.tether,D=N===void 0?!0:N,S=t.tetherOffset,V=S===void 0?0:S,z=Ft(e,{boundary:c,rootBoundary:h,padding:E,altBoundary:v}),H=Ge(e.placement),L=Ct(e.placement),W=!L,i=ta(H),f=Wo(i),u=e.modifiersData.popperOffsets,p=e.rects.reference,y=e.rects.popper,m=typeof V=="function"?V(Object.assign({},e.rects,{placement:e.placement})):V,g=typeof m=="number"?{mainAxis:m,altAxis:m}:Object.assign({mainAxis:0,altAxis:0},m),b=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,$={x:0,y:0};if(u){if(o){var C,M=i==="y"?Se:Oe,P=i==="y"?$e:Pe,I=i==="y"?"height":"width",A=u[i],j=A+z[M],U=A-z[P],Y=D?-y[I]/2:0,k=L===Ot?p[I]:y[I],R=L===Ot?-y[I]:-p[I],F=e.elements.arrow,ee=D&&F?ea(F):{width:0,height:0},Q=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ai(),J=Q[M],de=Q[P],oe=xt(0,p[I],ee[I]),Le=W?p[I]/2-Y-oe-J-g.mainAxis:k-oe-J-g.mainAxis,ce=W?-p[I]/2+Y+oe+de+g.mainAxis:R+oe+de+g.mainAxis,Re=e.elements.arrow&&zt(e.elements.arrow),xe=Re?i==="y"?Re.clientTop||0:Re.clientLeft||0:0,ke=(C=b?.[i])!=null?C:0,ft=A+Le-ke-xe,pt=A+ce-ke,at=xt(D?gn(j,ft):j,A,D?ut(U,pt):U);u[i]=at,$[i]=at-A}if(l){var it,ht=i==="x"?Se:Oe,gt=i==="x"?$e:Pe,Xe=u[f],Fe=f==="y"?"height":"width",rt=Xe+z[ht],qe=Xe-z[gt],Ze=[Se,Oe].indexOf(H)!==-1,fe=(it=b?.[f])!=null?it:0,ae=Ze?rt:Xe-p[Fe]-y[Fe]-fe+g.altAxis,Ke=Ze?Xe+p[Fe]+y[Fe]-fe-g.altAxis:qe,mt=D&&Ze?yo(ae,Xe,Ke):xt(D?ae:rt,Xe,D?Ke:qe);u[f]=mt,$[f]=mt-Xe}e.modifiersData[n]=$}}const Ko={name:"preventOverflow",enabled:!0,phase:"main",fn:qo,requiresIfExists:["offset"]};function Yo(a){return{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}}function Qo(a){return a===Ce(a)||!Me(a)?na(a):Yo(a)}function Jo(a){var e=a.getBoundingClientRect(),t=kt(e.width)/a.offsetWidth||1,n=kt(e.height)/a.offsetHeight||1;return t!==1||n!==1}function Zo(a,e,t){t===void 0&&(t=!1);var n=Me(e),r=Me(e)&&Jo(e),o=nt(e),s=Dt(a,r,t),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(n||!n&&!t)&&((We(e)!=="body"||ia(o))&&(l=Qo(e)),Me(e)?(c=Dt(e,!0),c.x+=e.clientLeft,c.y+=e.clientTop):o&&(c.x=aa(o))),{x:s.left+l.scrollLeft-c.x,y:s.top+l.scrollTop-c.y,width:s.width,height:s.height}}function ed(a){var e=new Map,t=new Set,n=[];a.forEach(function(o){e.set(o.name,o)});function r(o){t.add(o.name);var s=[].concat(o.requires||[],o.requiresIfExists||[]);s.forEach(function(l){if(!t.has(l)){var c=e.get(l);c&&r(c)}}),n.push(o)}return a.forEach(function(o){t.has(o.name)||r(o)}),n}function td(a){var e=ed(a);return po.reduce(function(t,n){return t.concat(e.filter(function(r){return r.phase===n}))},[])}function nd(a){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(a())})})),e}}function ad(a){var e=a.reduce(function(t,n){var r=t[n.name];return t[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var xa={placement:"bottom",modifiers:[],strategy:"absolute"};function Xa(){for(var a=arguments.length,e=new Array(a),t=0;t<a;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function id(a){a===void 0&&(a={});var e=a,t=e.defaultModifiers,n=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?xa:r;return function(l,c,h){h===void 0&&(h=o);var v={placement:"bottom",orderedModifiers:[],options:Object.assign({},xa,o),modifiersData:{},elements:{reference:l,popper:c},attributes:{},styles:{}},E=[],N=!1,D={state:v,setOptions:function(H){var L=typeof H=="function"?H(v.options):H;V(),v.options=Object.assign({},o,v.options,L),v.scrollParents={reference:ct(l)?Xt(l):l.contextElement?Xt(l.contextElement):[],popper:Xt(c)};var W=td(ad([].concat(n,v.options.modifiers)));return v.orderedModifiers=W.filter(function(i){return i.enabled}),S(),D.update()},forceUpdate:function(){if(!N){var H=v.elements,L=H.reference,W=H.popper;if(Xa(L,W)){v.rects={reference:Zo(L,zt(W),v.options.strategy==="fixed"),popper:ea(W)},v.reset=!1,v.placement=v.options.placement,v.orderedModifiers.forEach(function(g){return v.modifiersData[g.name]=Object.assign({},g.data)});for(var i=0;i<v.orderedModifiers.length;i++){if(v.reset===!0){v.reset=!1,i=-1;continue}var f=v.orderedModifiers[i],u=f.fn,p=f.options,y=p===void 0?{}:p,m=f.name;typeof u=="function"&&(v=u({state:v,options:y,name:m,instance:D})||v)}}}},update:nd(function(){return new Promise(function(z){D.forceUpdate(),z(v)})}),destroy:function(){V(),N=!0}};if(!Xa(l,c))return D;D.setOptions(h).then(function(z){!N&&h.onFirstUpdate&&h.onFirstUpdate(z)});function S(){v.orderedModifiers.forEach(function(z){var H=z.name,L=z.options,W=L===void 0?{}:L,i=z.effect;if(typeof i=="function"){var f=i({state:v,name:H,instance:D,options:W}),u=function(){};E.push(f||u)}})}function V(){E.forEach(function(z){return z()}),E=[]}return D}}var rd=[ko,Go,So,Di,zo,Vo,Ko,bo,Bo],sd=id({defaultModifiers:rd}),od="tippy-box",xi="tippy-content",dd="tippy-backdrop",Xi="tippy-arrow",Vi="tippy-svg-arrow",lt={passive:!0,capture:!0},Hi=function(){return document.body};function $n(a,e,t){if(Array.isArray(a)){var n=a[e];return n??(Array.isArray(t)?t[e]:t)}return a}function ra(a,e){var t={}.toString.call(a);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Bi(a,e){return typeof a=="function"?a.apply(void 0,e):a}function Va(a,e){if(e===0)return a;var t;return function(n){clearTimeout(t),t=setTimeout(function(){a(n)},e)}}function ld(a){return a.split(/\s+/).filter(Boolean)}function bt(a){return[].concat(a)}function Ha(a,e){a.indexOf(e)===-1&&a.push(e)}function ud(a){return a.filter(function(e,t){return a.indexOf(e)===t})}function cd(a){return a.split("-")[0]}function mn(a){return[].slice.call(a)}function Ba(a){return Object.keys(a).reduce(function(e,t){return a[t]!==void 0&&(e[t]=a[t]),e},{})}function Vt(){return document.createElement("div")}function En(a){return["Element","Fragment"].some(function(e){return ra(a,e)})}function fd(a){return ra(a,"NodeList")}function pd(a){return ra(a,"MouseEvent")}function hd(a){return!!(a&&a._tippy&&a._tippy.reference===a)}function gd(a){return En(a)?[a]:fd(a)?mn(a):Array.isArray(a)?a:mn(document.querySelectorAll(a))}function Pn(a,e){a.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Fa(a,e){a.forEach(function(t){t&&t.setAttribute("data-state",e)})}function md(a){var e,t=bt(a),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function vd(a,e){var t=e.clientX,n=e.clientY;return a.every(function(r){var o=r.popperRect,s=r.popperState,l=r.props,c=l.interactiveBorder,h=cd(s.placement),v=s.modifiersData.offset;if(!v)return!0;var E=h==="bottom"?v.top.y:0,N=h==="top"?v.bottom.y:0,D=h==="right"?v.left.x:0,S=h==="left"?v.right.x:0,V=o.top-n+E>c,z=n-o.bottom-N>c,H=o.left-t+D>c,L=t-o.right-S>c;return V||z||H||L})}function Rn(a,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){a[n](r,t)})}function ja(a,e){for(var t=e;t;){var n;if(a.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var je={isTouch:!1},za=0;function yd(){je.isTouch||(je.isTouch=!0,window.performance&&document.addEventListener("mousemove",Fi))}function Fi(){var a=performance.now();a-za<20&&(je.isTouch=!1,document.removeEventListener("mousemove",Fi)),za=a}function Ed(){var a=document.activeElement;if(hd(a)){var e=a._tippy;a.blur&&!e.state.isVisible&&a.blur()}}function Id(){document.addEventListener("touchstart",yd,lt),window.addEventListener("blur",Ed)}var wd=typeof window<"u"&&typeof document<"u",bd=wd?!!window.msCrypto:!1,Td={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},_d={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},He=Object.assign({appendTo:Hi,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Td,_d),Nd=Object.keys(He),Sd=function(e){var t=Object.keys(e);t.forEach(function(n){He[n]=e[n]})};function ji(a){var e=a.plugins||[],t=e.reduce(function(n,r){var o=r.name,s=r.defaultValue;if(o){var l;n[o]=a[o]!==void 0?a[o]:(l=He[o])!=null?l:s}return n},{});return Object.assign({},a,t)}function Od(a,e){var t=e?Object.keys(ji(Object.assign({},He,{plugins:e}))):Nd,n=t.reduce(function(r,o){var s=(a.getAttribute("data-tippy-"+o)||"").trim();if(!s)return r;if(o==="content")r[o]=s;else try{r[o]=JSON.parse(s)}catch{r[o]=s}return r},{});return n}function Ua(a,e){var t=Object.assign({},e,{content:Bi(e.content,[a])},e.ignoreAttributes?{}:Od(a,e.plugins));return t.aria=Object.assign({},He.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var kd=function(){return"innerHTML"};function Wn(a,e){a[kd()]=e}function Ga(a){var e=Vt();return a===!0?e.className=Xi:(e.className=Vi,En(a)?e.appendChild(a):Wn(e,a)),e}function Wa(a,e){En(e.content)?(Wn(a,""),a.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Wn(a,e.content):a.textContent=e.content)}function qn(a){var e=a.firstElementChild,t=mn(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(xi)}),arrow:t.find(function(n){return n.classList.contains(Xi)||n.classList.contains(Vi)}),backdrop:t.find(function(n){return n.classList.contains(dd)})}}function zi(a){var e=Vt(),t=Vt();t.className=od,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Vt();n.className=xi,n.setAttribute("data-state","hidden"),Wa(n,a.props),e.appendChild(t),t.appendChild(n),r(a.props,a.props);function r(o,s){var l=qn(e),c=l.box,h=l.content,v=l.arrow;s.theme?c.setAttribute("data-theme",s.theme):c.removeAttribute("data-theme"),typeof s.animation=="string"?c.setAttribute("data-animation",s.animation):c.removeAttribute("data-animation"),s.inertia?c.setAttribute("data-inertia",""):c.removeAttribute("data-inertia"),c.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?c.setAttribute("role",s.role):c.removeAttribute("role"),(o.content!==s.content||o.allowHTML!==s.allowHTML)&&Wa(h,a.props),s.arrow?v?o.arrow!==s.arrow&&(c.removeChild(v),c.appendChild(Ga(s.arrow))):c.appendChild(Ga(s.arrow)):v&&c.removeChild(v)}return{popper:e,onUpdate:r}}zi.$$tippy=!0;var Dd=1,en=[],xn=[];function Cd(a,e){var t=Ua(a,Object.assign({},He,ji(Ba(e)))),n,r,o,s=!1,l=!1,c=!1,h=!1,v,E,N,D=[],S=Va(ft,t.interactiveDebounce),V,z=Dd++,H=null,L=ud(t.plugins),W={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},i={id:z,reference:a,popper:Vt(),popperInstance:H,props:t,state:W,plugins:L,clearDelayTimeouts:ae,setProps:Ke,setContent:mt,show:At,hide:_,hideWithInteractivity:x,enable:Ze,disable:fe,unmount:X,destroy:q};if(!t.render)return i;var f=t.render(i),u=f.popper,p=f.onUpdate;u.setAttribute("data-tippy-root",""),u.id="tippy-"+i.id,i.popper=u,a._tippy=i,u._tippy=i;var y=L.map(function(O){return O.fn(i)}),m=a.hasAttribute("aria-expanded");return Re(),Y(),A(),j("onCreate",[i]),t.showOnCreate&&rt(),u.addEventListener("mouseenter",function(){i.props.interactive&&i.state.isVisible&&i.clearDelayTimeouts()}),u.addEventListener("mouseleave",function(){i.props.interactive&&i.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",S)}),i;function g(){var O=i.props.touch;return Array.isArray(O)?O:[O,0]}function b(){return g()[0]==="hold"}function $(){var O;return!!((O=i.props.render)!=null&&O.$$tippy)}function C(){return V||a}function M(){var O=C().parentNode;return O?md(O):document}function P(){return qn(u)}function I(O){return i.state.isMounted&&!i.state.isVisible||je.isTouch||v&&v.type==="focus"?0:$n(i.props.delay,O?0:1,He.delay)}function A(O){O===void 0&&(O=!1),u.style.pointerEvents=i.props.interactive&&!O?"":"none",u.style.zIndex=""+i.props.zIndex}function j(O,B,G){if(G===void 0&&(G=!0),y.forEach(function(K){K[O]&&K[O].apply(K,B)}),G){var Z;(Z=i.props)[O].apply(Z,B)}}function U(){var O=i.props.aria;if(O.content){var B="aria-"+O.content,G=u.id,Z=bt(i.props.triggerTarget||a);Z.forEach(function(K){var ie=K.getAttribute(B);if(i.state.isVisible)K.setAttribute(B,ie?ie+" "+G:G);else{var ue=ie&&ie.replace(G,"").trim();ue?K.setAttribute(B,ue):K.removeAttribute(B)}})}}function Y(){if(!(m||!i.props.aria.expanded)){var O=bt(i.props.triggerTarget||a);O.forEach(function(B){i.props.interactive?B.setAttribute("aria-expanded",i.state.isVisible&&B===C()?"true":"false"):B.removeAttribute("aria-expanded")})}}function k(){M().removeEventListener("mousemove",S),en=en.filter(function(O){return O!==S})}function R(O){if(!(je.isTouch&&(c||O.type==="mousedown"))){var B=O.composedPath&&O.composedPath()[0]||O.target;if(!(i.props.interactive&&ja(u,B))){if(bt(i.props.triggerTarget||a).some(function(G){return ja(G,B)})){if(je.isTouch||i.state.isVisible&&i.props.trigger.indexOf("click")>=0)return}else j("onClickOutside",[i,O]);i.props.hideOnClick===!0&&(i.clearDelayTimeouts(),i.hide(),l=!0,setTimeout(function(){l=!1}),i.state.isMounted||J())}}}function F(){c=!0}function ee(){c=!1}function Q(){var O=M();O.addEventListener("mousedown",R,!0),O.addEventListener("touchend",R,lt),O.addEventListener("touchstart",ee,lt),O.addEventListener("touchmove",F,lt)}function J(){var O=M();O.removeEventListener("mousedown",R,!0),O.removeEventListener("touchend",R,lt),O.removeEventListener("touchstart",ee,lt),O.removeEventListener("touchmove",F,lt)}function de(O,B){Le(O,function(){!i.state.isVisible&&u.parentNode&&u.parentNode.contains(u)&&B()})}function oe(O,B){Le(O,B)}function Le(O,B){var G=P().box;function Z(K){K.target===G&&(Rn(G,"remove",Z),B())}if(O===0)return B();Rn(G,"remove",E),Rn(G,"add",Z),E=Z}function ce(O,B,G){G===void 0&&(G=!1);var Z=bt(i.props.triggerTarget||a);Z.forEach(function(K){K.addEventListener(O,B,G),D.push({node:K,eventType:O,handler:B,options:G})})}function Re(){b()&&(ce("touchstart",ke,{passive:!0}),ce("touchend",pt,{passive:!0})),ld(i.props.trigger).forEach(function(O){if(O!=="manual")switch(ce(O,ke),O){case"mouseenter":ce("mouseleave",pt);break;case"focus":ce(bd?"focusout":"blur",at);break;case"focusin":ce("focusout",at);break}})}function xe(){D.forEach(function(O){var B=O.node,G=O.eventType,Z=O.handler,K=O.options;B.removeEventListener(G,Z,K)}),D=[]}function ke(O){var B,G=!1;if(!(!i.state.isEnabled||it(O)||l)){var Z=((B=v)==null?void 0:B.type)==="focus";v=O,V=O.currentTarget,Y(),!i.state.isVisible&&pd(O)&&en.forEach(function(K){return K(O)}),O.type==="click"&&(i.props.trigger.indexOf("mouseenter")<0||s)&&i.props.hideOnClick!==!1&&i.state.isVisible?G=!0:rt(O),O.type==="click"&&(s=!G),G&&!Z&&qe(O)}}function ft(O){var B=O.target,G=C().contains(B)||u.contains(B);if(!(O.type==="mousemove"&&G)){var Z=Fe().concat(u).map(function(K){var ie,ue=K._tippy,Ee=(ie=ue.popperInstance)==null?void 0:ie.state;return Ee?{popperRect:K.getBoundingClientRect(),popperState:Ee,props:t}:null}).filter(Boolean);vd(Z,O)&&(k(),qe(O))}}function pt(O){var B=it(O)||i.props.trigger.indexOf("click")>=0&&s;if(!B){if(i.props.interactive){i.hideWithInteractivity(O);return}qe(O)}}function at(O){i.props.trigger.indexOf("focusin")<0&&O.target!==C()||i.props.interactive&&O.relatedTarget&&u.contains(O.relatedTarget)||qe(O)}function it(O){return je.isTouch?b()!==O.type.indexOf("touch")>=0:!1}function ht(){gt();var O=i.props,B=O.popperOptions,G=O.placement,Z=O.offset,K=O.getReferenceClientRect,ie=O.moveTransition,ue=$()?qn(u).arrow:null,Ee=K?{getBoundingClientRect:K,contextElement:K.contextElement||C()}:a,sa={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Gt){var vt=Gt.state;if($()){var Ui=P(),wn=Ui.box;["placement","reference-hidden","escaped"].forEach(function(Wt){Wt==="placement"?wn.setAttribute("data-placement",vt.placement):vt.attributes.popper["data-popper-"+Wt]?wn.setAttribute("data-"+Wt,""):wn.removeAttribute("data-"+Wt)}),vt.attributes.popper={}}}},st=[{name:"offset",options:{offset:Z}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ie}},sa];$()&&ue&&st.push({name:"arrow",options:{element:ue,padding:3}}),st.push.apply(st,B?.modifiers||[]),i.popperInstance=sd(Ee,u,Object.assign({},B,{placement:G,onFirstUpdate:N,modifiers:st}))}function gt(){i.popperInstance&&(i.popperInstance.destroy(),i.popperInstance=null)}function Xe(){var O=i.props.appendTo,B,G=C();i.props.interactive&&O===Hi||O==="parent"?B=G.parentNode:B=Bi(O,[G]),B.contains(u)||B.appendChild(u),i.state.isMounted=!0,ht()}function Fe(){return mn(u.querySelectorAll("[data-tippy-root]"))}function rt(O){i.clearDelayTimeouts(),O&&j("onTrigger",[i,O]),Q();var B=I(!0),G=g(),Z=G[0],K=G[1];je.isTouch&&Z==="hold"&&K&&(B=K),B?n=setTimeout(function(){i.show()},B):i.show()}function qe(O){if(i.clearDelayTimeouts(),j("onUntrigger",[i,O]),!i.state.isVisible){J();return}if(!(i.props.trigger.indexOf("mouseenter")>=0&&i.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(O.type)>=0&&s)){var B=I(!1);B?r=setTimeout(function(){i.state.isVisible&&i.hide()},B):o=requestAnimationFrame(function(){i.hide()})}}function Ze(){i.state.isEnabled=!0}function fe(){i.hide(),i.state.isEnabled=!1}function ae(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(o)}function Ke(O){if(!i.state.isDestroyed){j("onBeforeUpdate",[i,O]),xe();var B=i.props,G=Ua(a,Object.assign({},B,Ba(O),{ignoreAttributes:!0}));i.props=G,Re(),B.interactiveDebounce!==G.interactiveDebounce&&(k(),S=Va(ft,G.interactiveDebounce)),B.triggerTarget&&!G.triggerTarget?bt(B.triggerTarget).forEach(function(Z){Z.removeAttribute("aria-expanded")}):G.triggerTarget&&a.removeAttribute("aria-expanded"),Y(),A(),p&&p(B,G),i.popperInstance&&(ht(),Fe().forEach(function(Z){requestAnimationFrame(Z._tippy.popperInstance.forceUpdate)})),j("onAfterUpdate",[i,O])}}function mt(O){i.setProps({content:O})}function At(){var O=i.state.isVisible,B=i.state.isDestroyed,G=!i.state.isEnabled,Z=je.isTouch&&!i.props.touch,K=$n(i.props.duration,0,He.duration);if(!(O||B||G||Z)&&!C().hasAttribute("disabled")&&(j("onShow",[i],!1),i.props.onShow(i)!==!1)){if(i.state.isVisible=!0,$()&&(u.style.visibility="visible"),A(),Q(),i.state.isMounted||(u.style.transition="none"),$()){var ie=P(),ue=ie.box,Ee=ie.content;Pn([ue,Ee],0)}N=function(){var st;if(!(!i.state.isVisible||h)){if(h=!0,u.offsetHeight,u.style.transition=i.props.moveTransition,$()&&i.props.animation){var In=P(),Gt=In.box,vt=In.content;Pn([Gt,vt],K),Fa([Gt,vt],"visible")}U(),Y(),Ha(xn,i),(st=i.popperInstance)==null||st.forceUpdate(),j("onMount",[i]),i.props.animation&&$()&&oe(K,function(){i.state.isShown=!0,j("onShown",[i])})}},Xe()}}function _(){var O=!i.state.isVisible,B=i.state.isDestroyed,G=!i.state.isEnabled,Z=$n(i.props.duration,1,He.duration);if(!(O||B||G)&&(j("onHide",[i],!1),i.props.onHide(i)!==!1)){if(i.state.isVisible=!1,i.state.isShown=!1,h=!1,s=!1,$()&&(u.style.visibility="hidden"),k(),J(),A(!0),$()){var K=P(),ie=K.box,ue=K.content;i.props.animation&&(Pn([ie,ue],Z),Fa([ie,ue],"hidden"))}U(),Y(),i.props.animation?$()&&de(Z,i.unmount):i.unmount()}}function x(O){M().addEventListener("mousemove",S),Ha(en,S),S(O)}function X(){i.state.isVisible&&i.hide(),i.state.isMounted&&(gt(),Fe().forEach(function(O){O._tippy.unmount()}),u.parentNode&&u.parentNode.removeChild(u),xn=xn.filter(function(O){return O!==i}),i.state.isMounted=!1,j("onHidden",[i]))}function q(){i.state.isDestroyed||(i.clearDelayTimeouts(),i.unmount(),xe(),delete a._tippy,i.state.isDestroyed=!0,j("onDestroy",[i]))}}function Ut(a,e){e===void 0&&(e={});var t=He.plugins.concat(e.plugins||[]);Id();var n=Object.assign({},e,{plugins:t}),r=gd(a),o=r.reduce(function(s,l){var c=l&&Cd(l,n);return c&&s.push(c),s},[]);return En(a)?o[0]:o}Ut.defaultProps=He;Ut.setDefaultProps=Sd;Ut.currentInput=je;Object.assign({},Di,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});Ut.setDefaultProps({render:zi});function Ld(a,e){const t=document.getElementById(`${a}`);t&&Ut(t,{content:e,theme:"battlesystem"})}function Ad(){const a=new Map;a.set("tip_gmtokens","Note: GM-owned tokens give universal vision."),a.set("visionRangeHeader","Range: How far this token can see. Click to Mass Edit"),a.set("visionFalloffHeader","Falloff: The blurred edge of the vision range. Click to Mass Edit"),a.set("visionBlindHeader","Blind: If this token is temporarily without sight."),a.set("visionHideHeader","Move token to the 'Out-of-Sight' list"),a.set("visionBumperHeader","Collision Distance: How close this token can get to an active wall. Click to Mass Edit"),a.set("visionInAngleHeader","Inner Angle: Inner angle of token vision, for hard edge, match with Outer Angle. Click to Mass Edit"),a.set("visionOutAngleHeader","Outer Angle:  Outer angle of token vision, for hard edge, match with Inner Angle. Click to Mass Edit"),a.set("visionDarkHeader","Greyscale: Add an 'outer-ring' of visible greyscale outside of your vision (Darkvision-Esque). Click to Mass Edit"),a.set("tip_spectretokens","Spectre tokens are only visible to specific players. Enable vision here after it has been Spectred."),a.set("tip_fogfill","Toggle to enable/disable fog fill for the scene."),a.set("tip_disablevision","Toggle to enable/disable vision for all tokens in scene."),a.set("tip_persistence","Toggle to enable/disable persistence vision for tokens. This will leave the map revealed as they travel."),a.set("tip_playerdoors","Toggle to enable/disable players being able to see and use doors on their own."),a.set("tip_ownerrings","Toggle to enable/disable the colored rings seen around a player to indicate their vision radius. GM-Only."),a.set("tip_gridsnap","Toggle to enable/disable grid snapping when drawing Obstruction Lines and Objects. This is separate from the default OBR Snap setting."),a.set("toggle_contextmenu","Enable to show the Unit Vision Settings on the Context Menu for tokens"),a.set("toggle_trailingfog","Enable to 'fog' areas that have been revealed by Persistence, but a token is not currently in."),a.set("tip_gmwalls","Toggle to enable/disable the blocking of walls for the GM only."),a.set("doublewall_button","This will change ALL walls within the scene to be double-sided, so they cannot be passed from either side."),a.set("block_button","This will set all walls to be Blocking walls, so that tokens cannot move past them."),a.set("unblock_button","This will set all walls to be Passable walls, so that tokens can move through them."),a.set("lock_button","This will lock all obstruction lines, so they cannot be accidentally (or purposefully) moved."),a.set("unlock_button","This will unlock all obstruction lines so they can be moved and/or editted."),a.set("reset_persistence","This will reset all persistence on a map, for all players in the room."),a.set("preview_select","This will allow you to view fog as the selected Player would see it."),a.set("tip_visionDefault","Set the default vision distance for new tokens."),a.set("tip_collisionDefault","Set the default collision range for new tokens."),a.set("tip_falloffDefault","Set the default falloff range for new tokens (having this on by default will increase GPU usage)."),a.set("tip_greyscaleDefault","Set the default greyscale vision range (should be higher than token Vision to take effect)."),a.set("tip_innerAngleDefault","Set the default inner angle radius."),a.set("tip_outerAngleDefault","Set the default outer angle radius."),a.forEach((e,t)=>{Ld(t,e)})}class Md{static async CenterViewportOnImage(e){const t=await T.scene.grid.getDpi(),n=await T.viewport.getScale(),r=await T.viewport.getWidth(),o=await T.viewport.getHeight(),s={x:r/2,y:o/2},l={x:s.x/n,y:s.y/n},c=await this.GetImageCenter(e,t),h={x:c.x-l.x,y:c.y-l.y},v={x:h.x*n*-1,y:h.y*n*-1};await T.viewport.animateTo({position:v,scale:n})}static async GetImageCenter(e,t){if(nr(e)){const n=t/e.grid.dpi,r=e.image.width*n,o=e.image.height*n,s=e.grid.offset.x/e.image.width*r,l=e.grid.offset.y/e.image.height*o;return{x:e.position.x-s+r/2,y:e.position.y-l+o/2}}else return tr(e)&&e.points.length>0?{x:e.points[0].x,y:e.points[0].y}:{x:e.position.x,y:e.position.y}}}class wt{headerName;element;popover;input;checkboxButton;okButton;onSubmitCallback;constructor(e,t,n,r="200px"){const o=document.querySelector(e);if(!o||!(o instanceof HTMLElement))throw new Error(`Element with selector "${e}" not found or is not an HTMLElement`);this.element=o,this.headerName=n,this.onSubmitCallback=t,this.createPopover(r),this.addEventListeners()}createPopover(e){this.popover=document.createElement("div"),this.popover.classList.add("mass-editor-popover"),this.popover.style.width=e,this.input=document.createElement("input"),this.input.type="number",this.input.style.cssText=`
        margin-right: 5px;
        `;const t=document.createElement("div");t.innerText=`Set All ${this.headerName} to`;const n=document.createElement("div");n.style.display="flex",n.style.width="100%",n.style.placeContent="center";const r=document.createElement("div");r.style.display="flex",r.style.width="100%",r.style.placeContent="center",this.okButton=document.createElement("button"),this.okButton.classList.add("popover-button"),this.okButton.textContent="OK",this.okButton.style.width="40px";const o=document.createElement("div");o.style.paddingLeft="4px",o.style.paddingRight="4px",o.textContent="Include Torches:",this.checkboxButton=document.createElement("input"),this.checkboxButton.type="checkbox",this.popover.appendChild(t),this.popover.appendChild(r),this.popover.appendChild(n),r.appendChild(this.input),r.appendChild(this.okButton),n.appendChild(o),n.appendChild(this.checkboxButton),document.body.appendChild(this.popover)}addEventListeners(){this.element.addEventListener("click",this.handleClick.bind(this)),this.okButton.addEventListener("click",this.handleSubmit.bind(this)),document.addEventListener("click",this.handleOutsideClick.bind(this))}handleClick(e){const t=this.element.getBoundingClientRect(),{left:n,top:r}=this.calculatePopoverPosition(t);this.popover.style.display="block",this.popover.style.left="calc(50% - 100px)",this.popover.style.top=`${r}px`,this.input.focus(),e.stopPropagation()}calculatePopoverPosition(e){const t=this.popover.getBoundingClientRect(),n=window.innerWidth;let r=e.left,o=e.top-t.height-5;return r+t.width>n&&(r=n-t.width-50),o<0&&(o=e.bottom+5),{left:r,top:o}}handleSubmit(){const e=Number(this.input.value),t=this.checkboxButton.checked;isNaN(e)||(this.onSubmitCallback(e,t),this.hidePopover())}handleOutsideClick(e){e.target instanceof Node&&!this.popover.contains(e.target)&&e.target!==this.element&&this.hidePopover()}hidePopover(){this.popover.style.display="none",this.input.value=""}}class $d{mainWindow=document.getElementById("app");smokeViewToggle;spectreViewToggle;settingsViewToggle;helpViewToggle;smokeViewPanel;spectreViewPanel;settingsViewPanel;helpViewPanel;patreonContainer;onVisionPanelMain=!0;visionPanelMain;visionPanelSub;smokeUnitTablePrime;smokeUnitTableSub;tokenList;hiddenList;version;constructor(e){this.version=`SMOKEANDSPECTRE-${e}`}async Stop(){await T.action.setHeight(100),await T.action.setWidth(300),this.mainWindow.innerHTML=`
        <div id="stopScreen">
            Awaiting Scene...
        </div>
        `}async Start(){if(localStorage.getItem("NOTICED")!=="true"&&(await T.modal.open({id:d.EXTENSIONNOTICE,url:`/src/notice/notice.html?subscriber=${w.USER_REGISTERED}`,height:400,width:500}),localStorage.setItem("NOTICED","true")),w.playerRole==="GM"){await T.action.setHeight(530),await T.action.setWidth(420);const n=await T.viewport.getWidth()<400;this.mainWindow.innerHTML=n?d.SMOKEMOBILEMAIN:d.SMOKEMAIN,this.smokeViewToggle=document.getElementById("smokeViewToggle"),this.spectreViewToggle=document.getElementById("spectreViewToggle"),this.settingsViewToggle=document.getElementById("settingsViewToggle"),this.helpViewToggle=document.getElementById("helpViewToggle"),this.smokeViewPanel=document.getElementById("smokeViewPanel"),this.spectreViewPanel=document.getElementById("spectreViewPanel"),this.settingsViewPanel=document.getElementById("settingsViewPanel"),this.helpViewPanel=document.getElementById("helpViewPanel"),this.patreonContainer=document.getElementById("patreonContainer"),this.smokeViewPanel.innerHTML=n?d.SMOKEMOBILEHTML:d.SMOKEHTML,this.spectreViewPanel.innerHTML=d.SPECTREHTML,this.settingsViewPanel.innerHTML=n?d.SETTINGSMOBILEHTML:d.SETTINGSHTML;const r=document.getElementById("playerListing");r.appendChild(this.GetEmptyContextItem("Self"));const o=document.getElementById("preview_select");o.innerHTML="";const s=document.createElement("option");s.value=w.playerId,s.textContent="View As: Self",o.appendChild(s);for(const l of w.party){const c=document.createElement("li");c.id=l.id,c.textContent=l.name,c.style.color=l.color,r.appendChild(c);const h=document.createElement("option");h.value=l.id,h.textContent=`View As: ${l.name}`,h.style.color=l.color,o.appendChild(h)}Be.init(),await Ls(),this.SetupHelpDocuments(),this.SetupGMPanelHandlers(),this.UpdateVisionList(),Vs(n),Oa(),eo(),Ad(),await _t.Initialize()}else await T.action.setHeight(300),await T.action.setWidth(300),this.mainWindow.innerHTML=`
                <div id="titleHolder" style="display: flex; width: 100%;">
                    <div style="width:60%;">Tokens You Own</div>
                    <div style="width:30%;">Vision</div>
                    <div style="width:10%;" id="patreonContainer"></div>
                </div>
                <div id="playerView" class="scrollable-table">
                    <table id="playerViewTable">
                    <thead>
                        <tr id="playerViewTableHeader">
                            <th style="width: 70%;"></th>
                            <th style="width: 20%;"></th>
                            <th style="width: 10%;"></th>
                        </tr>
                    </thead>
                        <tbody id="playerViewTableBody">
                        </tbody>
                    </table>
                </div>
            `,this.UpdatePlayerView(),this.patreonContainer=document.getElementById("patreonContainer");await this.InitializeScene(),this.patreonContainer?.appendChild(rr())}UpdatePlayerView(){const e=w.sceneItems.filter(r=>di(r)),t=document.getElementsByClassName("token-table-entry");this.CleanVisionList(e,t);const n=document.getElementById("playerViewTable");for(const r of e){const o=document.getElementById(`pl-${r.id}`);if(o){const s=o.getElementsByClassName("token-name")[0],l=o.getElementsByClassName("token-aradius")[0],c=o.getElementsByClassName("token-distancetype")[0];s&&(s.textContent=r.text?.plainText||r.name),l&&(l.textContent=r.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?r.metadata[`${d.EXTENSIONID}/visionRange`]:we()),c&&(c.textContent=w.gridType)}else{const s=document.createElement("tr");s.id=`pl-${r.id}`,s.classList.add("token-table-entry");const l=document.createElement("td");l.textContent=r.text?.plainText||r.name,l.classList.add("player-token-name"),s.appendChild(l);const c=document.createElement("td");c.textContent=r.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?r.metadata[`${d.EXTENSIONID}/visionRange`]:we(),s.appendChild(c);const h=document.createElement("td");h.textContent=w.gridType,s.appendChild(h),n.appendChild(s)}}}GetEmptyContextItem(e){const t=document.createElement("li");return t.id=w.playerId,t.textContent=e,t}SetupGMPanelHandlers(){this.SetupViewPanel(),this.smokeViewToggle.onclick=t=>{t.preventDefault(),e(ne.smokeViewToggle,ne.smokeViewPanel)},this.spectreViewToggle.onclick=t=>{t.preventDefault(),e(ne.spectreViewToggle,ne.spectreViewPanel)},this.settingsViewToggle.onclick=t=>{t.preventDefault(),e(ne.settingsViewToggle,ne.settingsViewPanel)},this.helpViewToggle.onclick=t=>{t.preventDefault(),e(ne.helpViewToggle,ne.helpViewPanel)};function e(t,n){ne.smokeViewToggle?.classList.remove("selected"),ne.spectreViewToggle?.classList.remove("selected"),ne.settingsViewToggle?.classList.remove("selected"),ne.helpViewToggle?.classList.remove("selected"),ne.smokeViewPanel.style.display="none",ne.spectreViewPanel.style.display="none",ne.settingsViewPanel.style.display="none",ne.helpViewPanel.style.display="none",t.classList.add("selected"),n.style.display="block"}}async OnDataChange(){await Ie.Run(),await _t.Run(),w.playerRole==="GM"?(this.UpdateVisionList(),Oa()):this.UpdatePlayerView()}async InitializeScene(){await Ie.Initialize(),await Ie.Run(),await _t.Run()}UpdateVisionList(){if(!document.getElementById("token_list"))return;const t=w.sceneItems.filter(r=>De(r)),n=document.getElementsByClassName("token-table-entry");this.CleanVisionList(t,n);for(const r of t){const o=document.getElementById(`tr-${r.id}`);o?this.UpdateTokenOnVisionList(r,o):this.AddTokenToVisionList(r)}}SetupMassEditors(){const e=async(l,c)=>{let h=l;l<0&&(h=0),l>999&&(h=999);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionRange`]=h.toString()})},t=async(l,c)=>{let h=l;l<0&&(h=0),l>10&&(h=10);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionFallOff`]=h.toString()})},n=async(l,c)=>{let h=l;l<0&&(h=0),l>999&&(h=999);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionSourceRange`]=h.toString()})},r=async(l,c)=>{let h=l;l<0&&(h=0),l>360&&(h=360);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionInAngle`]=h.toString()})},o=async(l,c)=>{let h=l;l<0&&(h=0),l>360&&(h=360);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionOutAngle`]=h.toString()})},s=async(l,c)=>{let h=l;l<0&&(h=0),l>999&&(h=999);const v=c?w.sceneItems.filter(E=>De(E)):w.sceneItems.filter(E=>!yt(E)&&De(E));await T.scene.items.updateItems(v.map(E=>E.id),E=>{for(let N of E)N.metadata[`${d.EXTENSIONID}/visionDark`]=h.toString()})};new wt("#visionRangeSvg",e,"Vision Range"),new wt("#visionFalloffSvg",t,"Falloff Range"),new wt("#visionBumperSvg",n,"Collision Range"),new wt("#visionInnerSvg",r,"Inner Angle"),new wt("#visionOuterSvg",o,"Outer Angle"),new wt("#visionDarkSvg",s,"Greyscale")}SetupViewPanel(){const e=document.getElementById("visionPanelToggleContainer");this.visionPanelMain=document.getElementById("visionPanelMain"),this.visionPanelSub=document.getElementById("visionPanelSub"),this.smokeUnitTablePrime=document.getElementById("smokeUnitTablePrime"),this.smokeUnitTableSub=document.getElementById("smokeUnitTableSub"),this.SetupMassEditors();const t=document.createElement("input");t.type="button",t.value="Show Advanced",t.classList.add("view-panel-toggle"),t.onclick=()=>{this.visionPanelMain.style.display=this.onVisionPanelMain?"none":"table-row",this.visionPanelSub.style.display=this.onVisionPanelMain?"table-row":"none";const n=document.getElementsByClassName("vision-panel-main-input"),r=document.getElementsByClassName("vision-panel-sub-input");for(let o=0;o<n.length;o++)this.onVisionPanelMain?this.fadeOut(n[o],()=>this.fadeIn(r[o],"inline-block")):this.fadeOut(r[o],()=>this.fadeIn(n[o],"inline-block"));t.value=this.onVisionPanelMain?"Show Basic":"Show Advanced",this.onVisionPanelMain=!this.onVisionPanelMain},e.appendChild(t)}AddTokenToVisionList(e){let t=w.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`],n=t?.color,r=t?.name?`This token is owned by ${t.name}.`:"This token is owned by you.";!n&&e.createdUserId!==w.playerId&&(n="#aeb0af",r="This tokens owner is not in the room currently.");const o=document.getElementById("token_list"),s=document.getElementById("hidden_list"),l=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0,c=document.createElement("tr");c.id=`tr-${e.id}`,c.className="token-table-entry",c.classList.add("slide-row");const h=document.createElement("td");h.id=`name-${e.id}`,l?(h.innerText=`ğŸ”¦${e.name} `,h.title="This is a torch, which can be seen by other tokens with vision when in range."):(h.innerText=e.name,h.title=r,h.setAttribute("data-color",n),h.style.textShadow=`
                -2px -2px 2px ${n},
                2px -2px 2px ${n},
                -2px 2px 2px ${n},
                2px 2px 2px ${n}`),h.classList.add("token-name"),n==="#aeb0af"&&(h.style.color="black !important",h.style.fontStyle="italic"),h.onclick=async()=>{Md.CenterViewportOnImage(e),await T.player.select([e.id])};const v=document.createElement("td"),E=document.createElement("input");E.type="number",E.value=e.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionRange`]:we(),E.classList.add("token-aradius"),E.classList.add("vision-panel-main-input"),E.style.display=this.onVisionPanelMain?"inline-block":"none",E.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseInt(m.value);g<0&&(m.value="0"),g>999&&(m.value="999"),isNaN(g)&&(m.value=we()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionRange`]=m.value})};const N=document.createElement("input");N.type="number",N.style.display="none",N.value=e.metadata[`${d.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionSourceRange`]:Ve(),N.classList.add("token-sradius"),N.classList.add("vision-panel-sub-input"),N.style.display=this.onVisionPanelMain?"none":"inline-block",N.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseFloat(m.value);g<0&&(m.value="0"),g>999&&(m.value="999"),isNaN(g)&&(m.value=Ve()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionSourceRange`]=m.value})},v.appendChild(E),v.appendChild(N);const D=document.createElement("td"),S=document.createElement("input");S.type="number",S.value=e.metadata[`${d.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionFallOff`]:Qe(),S.classList.add("token-falloff"),S.classList.add("vision-panel-main-input"),S.style.display=this.onVisionPanelMain?"inline-block":"none",S.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseFloat(m.value);g<0&&(m.value="0"),g>10&&(m.value="10"),isNaN(g)&&(m.value=Qe()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionFallOff`]=m.value})};const V=document.createElement("input");V.type="number",V.style.display="none",V.value=e.metadata[`${d.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionInAngle`]:tt(),V.classList.add("token-innerang"),V.classList.add("vision-panel-sub-input"),V.style.display=this.onVisionPanelMain?"none":"inline-block",V.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseInt(m.value);g<0&&(m.value="0"),g>360&&(m.value="360"),isNaN(g)&&(m.value=tt()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionInAngle`]=m.value})},D.appendChild(S),D.appendChild(V);const z=document.createElement("td"),H=document.createElement("input");H.type="checkbox",H.checked=e.metadata[`${d.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionBlind`]:!1,H.classList.add("token-blind"),H.classList.add("vision-panel-main-input"),H.style.display=this.onVisionPanelMain?"inline-block":"none",H.onchange=async p=>{if(!p||!p.target)return;const y=p.target,m=w.sceneItems.find(g=>g.id===e.id);await T.scene.items.updateItems([m.id],g=>{g[0].metadata[`${d.EXTENSIONID}/visionBlind`]=y.checked})};const L=document.createElement("input");L.type="number",L.style.display="none",L.value=e.metadata[`${d.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionOutAngle`]:Ue(),L.classList.add("token-outerang"),L.classList.add("vision-panel-sub-input"),L.style.display=this.onVisionPanelMain?"none":"inline-block",L.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseInt(m.value);g<0&&(m.value="0"),g>360&&(m.value="360"),isNaN(g)&&(m.value=Ue()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionOutAngle`]=m.value})},z.appendChild(H),z.appendChild(L);const W=document.createElement("td"),i=document.createElement("input");i.type="image",i.src="/swap.svg",i.checked=e.metadata[`${d.EXTENSIONID}/hiddenToken`]!==void 0?e.metadata[`${d.EXTENSIONID}/hiddenToken`]:!1,i.classList.add("token-hide"),i.classList.add("vision-panel-main-input"),i.style.display=this.onVisionPanelMain?"inline-block":"none",i.onclick=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target;m.checked=!m.checked;const g=document.getElementById(`tr-${e.id}`);m.checked?(g.classList.add("slide-out"),setTimeout(()=>{ne.hiddenList.prepend(g),g.classList.remove("slide-out"),g.classList.add("slide-in"),setTimeout(async()=>{g.classList.remove("slide-in"),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/hiddenToken`]=m.checked})},10)},250)):(g.classList.add("slide-out"),setTimeout(()=>{ne.tokenList.appendChild(g),g.classList.remove("slide-out"),g.classList.add("slide-in"),setTimeout(async()=>{g.classList.remove("slide-in"),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/hiddenToken`]=m.checked})},10)},250))};const f=document.createElement("input");f.type="number",f.value=e.metadata[`${d.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionDark`]:dn(),f.classList.add("token-darkvision"),f.classList.add("vision-panel-sub-input"),f.style.display=this.onVisionPanelMain?"none":"inline-block",f.onchange=async p=>{if(!p||!p.target)return;const y=w.sceneItems.find(b=>b.id===e.id),m=p.target,g=parseInt(m.value);g<0&&(m.value="0"),g>999&&(m.value="999"),isNaN(g)&&(m.value=we()),await T.scene.items.updateItems([y.id],b=>{b[0].metadata[`${d.EXTENSIONID}/visionDark`]=m.value})},W.appendChild(i),W.appendChild(f),c.appendChild(h),c.appendChild(v),c.appendChild(D),c.appendChild(z),c.appendChild(W),e.metadata[`${d.EXTENSIONID}/hiddenToken`]===!0?s.prepend(c):o.appendChild(c);function u(){document.getElementById("contextMenu").style.display="none"}c.oncontextmenu=async function(p){p.preventDefault();const y=p.currentTarget,m=document.getElementById("contextMenu"),g=C=>{C.preventDefault()},b=async C=>{const M=[...w.party,{id:w.playerId,color:w.playerColor,name:w.playerName}],P=C.target,I=m.getAttribute("currentUnit"),j=document.getElementById(`tr-${I}`).getElementsByClassName("token-name")[0],U=M.find(Y=>P.id===Y.id);if(U){const Y=U.name!==w.playerName?`This token is owned by ${U.name}.`:"This token is owned by you.";j.title=Y,j.setAttribute("data-color",n),j.style.textShadow=`
                    -2px -2px 2px ${U.color},
                    2px -2px 2px ${U.color},
                    -2px 2px 2px ${U.color},
                    2px 2px 2px ${U.color}`}else j.title="Unable to update owner name",j.style.textShadow="";await T.scene.items.updateItems([I],Y=>{for(const k of Y)k.createdUserId=P.id}),m.style.display="none",C.stopPropagation(),window.removeEventListener("click",$),m.removeEventListener("click",b),m.removeEventListener("contextmenu",g)};m.setAttribute("currentUnit",y.id.substring(3));const $=()=>{m.style.display="none",window.removeEventListener("click",$),m.removeEventListener("click",b),m.removeEventListener("contextmenu",g)};if(m.addEventListener("click",b),m.addEventListener("contextmenu",g),window.addEventListener("click",$),m.style.display=="block")u();else{const M=(document.getElementById("playerListing").children.length+1)*34,P=Math.min(p.pageX,window.innerWidth-150);let I=Math.min(p.pageY,(window.innerHeight>300?window.innerHeight-50:window.innerHeight)-120);window.innerHeight<M+I&&(I=window.innerHeight-M),m.style.display="block",m.style.left=P+"px",m.style.top=I+"px"}}}UpdateTokenOnVisionList(e,t){const n=w.sceneMetadata[`${d.EXTENSIONID}/USER-${e.createdUserId}`];let r=n?.color,o=n?.name?`This token is owned by ${n.name}.`:"This token is owned by you.";const s=e.metadata[`${d.EXTENSIONID}/isTorch`]===!0;!r&&e.createdUserId!==w.playerId&&(r="#aeb0af",o="This tokens owner is not in the room currently.");const l=t.getElementsByClassName("token-name")[0],c=t.getElementsByClassName("token-aradius")[0],h=t.getElementsByClassName("token-sradius")[0],v=t.getElementsByClassName("token-falloff")[0],E=t.getElementsByClassName("token-innerang")[0],N=t.getElementsByClassName("token-outerang")[0],D=t.getElementsByClassName("token-blind")[0],S=t.getElementsByClassName("token-darkvision")[0];l&&(s?(l.innerText=`ğŸ”¦${e.name} `,l.title="This is a torch, which can be seen by other tokens with vision when in range."):(l.innerText=e.name,l.title=o,l.setAttribute("data-color",r),l.style.textShadow=`
                    -2px -2px 2px ${r},
                    2px -2px 2px ${r},
                    -2px 2px 2px ${r},
                    2px 2px 2px ${r}`)),c&&(c.value=e.metadata[`${d.EXTENSIONID}/visionRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionRange`]:we()),h&&(h.value=e.metadata[`${d.EXTENSIONID}/visionSourceRange`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionSourceRange`]:Ve()),v&&(v.value=e.metadata[`${d.EXTENSIONID}/visionFallOff`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionFallOff`]:Qe()),E&&(E.value=e.metadata[`${d.EXTENSIONID}/visionInAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionInAngle`]:tt()),N&&(N.value=e.metadata[`${d.EXTENSIONID}/visionOutAngle`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionOutAngle`]:Ue()),D&&(D.checked=e.metadata[`${d.EXTENSIONID}/visionBlind`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionBlind`]:!1),S&&(S.value=e.metadata[`${d.EXTENSIONID}/visionDark`]!==void 0?e.metadata[`${d.EXTENSIONID}/visionDark`]:dn())}CleanVisionList(e,t){for(const n of t){const r=n.id.slice(3);e.some(o=>o.id===r)||n.remove()}}SetupHelpDocuments(){const t=new er.Converter().makeHtml(d.MARKDOWNHELP),n=document.getElementById("markdownHelpContainer");n.innerHTML=t}fadeOut=(e,t)=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none",t()},300)};fadeIn=(e,t)=>{e.style.opacity="0",e.style.display=t,setTimeout(()=>{e.style.opacity="1"},10)}}const ne=new $d("3.1");T.onReady(async()=>{const a=await T.scene.isReady();if(!document.getElementById("papp"))if(a===!1){const t=T.scene.onReadyChange(async n=>{n&&(t(),await qa())})}else await qa()});async function qa(){await w.InitializeCache(),w.SetupHandlers(),await ne.Start()}
