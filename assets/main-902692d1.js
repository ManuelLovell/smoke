import{C as w,b as Kt,a as Wn,O as F,c as yt,d as Tt,i as Cr}from"./constants-68d4f0c0.js";var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Dr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),t}function Pr(i){return i.type==="CURVE"}function Fi(i){return i.type==="IMAGE"}function fi(i,e){return Math.round(i/e)*e}function pi(i,e){return Math.floor(i/e)*e}function Fn(i){return i*(Math.PI/180)}function $r(i){return i*(180/Math.PI)}function hi(i,e,t){return i*(1-t)+e*t}class jt{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const o=Math.cos(Fn(n)),r=Math.sin(Fn(n)),l=this.subtract(e,t);return{x:t.x+o*l.x-r*l.y,y:t.y+r*l.x+o*l.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:fi(e.x,t.x),y:fi(e.y,t.y)}}static floorTo(e,t){return{x:pi(e.x,t.x),y:pi(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let m of e)t=m.x<t?m.x:t,n=m.x>n?m.x:n,o=m.y<o?m.y:o,r=m.y>r?m.y:r;let l=n-t,d=r-o,y={x:(t+n)/2,y:(o+r)/2};return{min:{x:t,y:o},max:{x:n,y:r},width:l,height:d,center:y}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let o=!1;for(let r=0,l=t.length-1;r<t.length;l=r++){const d=t[r].y>e.y,y=t[l].y>e.y;d!==y&&e.x<(t[l].x-t[r].x)*(e.y-t[r].y)/(t[l].y-t[r].y)+t[r].x&&(o=!o)}return o}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:hi(e.x,t.x,n),y:hi(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Be{static inverse(e){const[t,n,o,r,l,d,y,m,_]=e,x=t*(l*_-m*d)-n*(r*_-d*y)+o*(r*m-l*y);if(Math.abs(x)<1e-14)return e;const A=1/x,G=(l*_-m*d)*A,N=(o*m-n*_)*A,M=(n*d-o*l)*A,b=(d*y-r*_)*A,P=(t*_-o*y)*A,C=(r*o-t*d)*A,X=(r*m-y*l)*A,B=(y*n-t*m)*A,Q=(t*l-r*n)*A;return[G,N,M,b,P,C,X,B,Q]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Fn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Be.fromPosition(e.position),n=Be.fromScale(e.scale),o=Be.fromRotation(e.rotation);return Be.multiply(Be.multiply(t,o),n)}static decompose(e){const[t,n,o,r,l,d]=e,y=t*l-r*n,m={position:{x:o,y:d},rotation:0,scale:{x:1,y:1}};if(t!=0||r!=0){var _=Math.sqrt(t*t+r*r);m.rotation=r>0?Math.acos(t/_):-Math.acos(t/_),m.scale={x:_,y:y/_}}else if(n!=0||l!=0){var x=Math.sqrt(n*n+l*l);m.rotation=Math.PI/2-(l>0?Math.acos(-n/x):-Math.acos(n/x)),m.scale={x:y/x,y:x}}return m.rotation=$r(m.rotation),m}}class Lr{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const R=new Lr;function Mr(i){return i.layer=="MAP"&&(i.metadata[`${w.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${w.ARMINDOID}/isBackgroundImage`])}function gt(i){return i.metadata[`${w.EXTENSIONID}/isVisionFog`]||i.metadata[`${w.ARMINDOID}/isVisionFog`]}function Fr(i){return i.metadata[`${w.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${w.ARMINDOID}/isIndicatorRing`]}function Rr(i){return i.metadata[`${w.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${w.EXTENSIONID}/disabled`]||i.metadata[`${w.ARMINDOID}/isVisionLine`]&&!i.metadata[`${w.ARMINDOID}/disabled`]}function Ri(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${w.EXTENSIONID}/hasVision`]||i.metadata[`${w.ARMINDOID}/hasVision`])}function Br(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${w.EXTENSIONID}/hasVision`]||i.metadata[`${w.ARMINDOID}/hasVision`])&&!i.metadata[`${w.EXTENSIONID}/visionBlind`]}function Xr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&i.createdUserId==R.userId&&(i.metadata[`${w.EXTENSIONID}/hasVision`]||i.metadata[`${w.ARMINDOID}/hasVision`])&&!i.metadata[`${w.EXTENSIONID}/visionBlind`]}function Bi(i){return i.layer=="DRAWING"&&(i.metadata[`${w.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${w.ARMINDOID}/isBackgroundImage`])}function Ut(i){return i.metadata[`${w.EXTENSIONID}/isTrailingFog`]}function Rn(i){return i.metadata[`${w.EXTENSIONID}/isTrailingFog`]||i.metadata[`${w.EXTENSIONID}/isVisionFog`]||i.metadata[`${w.ARMINDOID}/isVisionFog`]||i.metadata[`${w.EXTENSIONID}/isIndicatorRing`]}function xt(i){return i.metadata[`${w.EXTENSIONID}/visionTorch`]}function Xi(i){return i.layer=="CHARACTER"&&!Ri(i)&&i.metadata[`${w.EXTENSIONID}/hasAutohide`]===!0}var Vi={exports:{}};const Vr={},jr=Object.freeze(Object.defineProperty({__proto__:null,default:Vr},Symbol.toStringTag,{value:"Module"})),Sn=Dr(jr);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var l=Object.assign,d,y;r.ready=new Promise(function(s,a){d=s,y=a}),function(s){var a={};s.loadCmdsTypedArray=function(V){for(var K=0,Z=0;Z<V.length;Z++)K+=V[Z].length;if(a[K])var J=a[K];else J=new Float32Array(K),a[K]=J;var re=0;for(Z=0;Z<V.length;Z++)for(var be=0;be<V[Z].length;be++){var ke=V[Z][be];typeof ke=="string"&&(ke=s.SkBits2FloatUnsigned(parseInt(ke))),J[re]=ke,re++}return V=s._malloc(J.length*J.BYTES_PER_ELEMENT),s.HEAPF32.set(J,V/J.BYTES_PER_ELEMENT),[V,K]},s.FromCmds=function(V){V=s.loadCmdsTypedArray(V);var K=s._FromCmds(V[0],V[1]);return s._free(V[0]),K};var u,v,k,L,z;s.cubicYFromX=function(V,K,Z,J,re){return u&&v===V&&k===K&&L===Z&&z===J||(u&&u.delete(),u=new s._SkCubicMap([V,K],[Z,J]),v=V,k=K,L=Z,z=J),u.computeYFromX(re)},s.cubicPtFromT=function(V,K,Z,J,re){return u&&v===V&&k===K&&L===Z&&z===J||(u&&u.delete(),u=new s._SkCubicMap([V,K],[Z,J]),v=V,k=K,L=Z,z=J),u.computePtFromT(re)}}(r),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var a=arguments[0];if(arguments.length===1)this._addPath(a,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var u=arguments[1];this._addPath(a,u.a,u.c,u.e,u.b,u.d,u.f,0,0,1)}else if(arguments.length===7)u=arguments,this._addPath(a,u[1],u[3],u[5],u[2],u[4],u[6],0,0,1);else if(arguments.length===10)u=arguments,this._addPath(a,u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],u[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(a,u,v,k,L,z){return this._arc(a,u,v,k,L,!!z),this},s.SkPath.prototype.arcTo=function(a,u,v,k,L){return this._arcTo(a,u,v,k,L),this},s.SkPath.prototype.bezierCurveTo=function(a,u,v,k,L,z){return this._cubicTo(a,u,v,k,L,z),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(a,u,v,k,L){return this._conicTo(a,u,v,k,L),this},s.SkPath.prototype.cubicTo=function(a,u,v,k,L,z){return this._cubicTo(a,u,v,k,L,z),this},s.SkPath.prototype.dash=function(a,u,v){return this._dash(a,u,v)?this:null},s.SkPath.prototype.ellipse=function(a,u,v,k,L,z,V,K){return this._ellipse(a,u,v,k,L,z,V,!!K),this},s.SkPath.prototype.lineTo=function(a,u){return this._lineTo(a,u),this},s.SkPath.prototype.moveTo=function(a,u){return this._moveTo(a,u),this},s.SkPath.prototype.op=function(a,u){return this._op(a,u)?this:null},s.SkPath.prototype.quadraticCurveTo=function(a,u,v,k){return this._quadTo(a,u,v,k),this},s.SkPath.prototype.quadTo=function(a,u,v,k){return this._quadTo(a,u,v,k),this},s.SkPath.prototype.rect=function(a,u,v,k){return this._rect(a,u,v,k),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(a){return a=a||{},a.width=a.width||1,a.miter_limit=a.miter_limit||4,a.cap=a.cap||s.StrokeCap.BUTT,a.join=a.join||s.StrokeJoin.MITER,this._stroke(a)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var a=arguments;this._transform(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(a,u,v){return this._trim(a,u,!!v)?this:null}}}(r);var m=l({},r),_=typeof window=="object",x=typeof importScripts=="function",A="",G,N,M,b,P,C;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(A=x?Sn.dirname(A)+"/":__dirname+"/",C=()=>{P||(b=Sn,P=Sn)},G=function(s,a){return C(),s=P.normalize(s),b.readFileSync(s,a?null:"utf8")},M=s=>(s=G(s,!0),s.buffer||(s=new Uint8Array(s)),s),N=(s,a,u)=>{C(),s=P.normalize(s),b.readFile(s,function(v,k){v?u(v):a(k.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),r.inspect=function(){return"[Emscripten Module object]"}):(_||x)&&(x?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),n&&(A=n),A.indexOf("blob:")!==0?A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):A="",G=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},x&&(M=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),N=(s,a,u)=>{var v=new XMLHttpRequest;v.open("GET",s,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):u()},v.onerror=u,v.send(null)});var X=r.print||console.log.bind(console),B=r.printErr||console.warn.bind(console);l(r,m),m=null;var Q;r.wasmBinary&&(Q=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ie("no native wasm support detected");var O,p=!1,f=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function I(s,a,u){var v=a+u;for(u=a;s[u]&&!(u>=v);)++u;if(16<u-a&&s.subarray&&f)return f.decode(s.subarray(a,u));for(v="";a<u;){var k=s[a++];if(k&128){var L=s[a++]&63;if((k&224)==192)v+=String.fromCharCode((k&31)<<6|L);else{var z=s[a++]&63;k=(k&240)==224?(k&15)<<12|L<<6|z:(k&7)<<18|L<<12|z<<6|s[a++]&63,65536>k?v+=String.fromCharCode(k):(k-=65536,v+=String.fromCharCode(55296|k>>10,56320|k&1023))}}else v+=String.fromCharCode(k)}return v}function h(s,a,u){var v=ae;if(0<u){u=a+u-1;for(var k=0;k<s.length;++k){var L=s.charCodeAt(k);if(55296<=L&&57343>=L){var z=s.charCodeAt(++k);L=65536+((L&1023)<<10)|z&1023}if(127>=L){if(a>=u)break;v[a++]=L}else{if(2047>=L){if(a+1>=u)break;v[a++]=192|L>>6}else{if(65535>=L){if(a+2>=u)break;v[a++]=224|L>>12}else{if(a+3>=u)break;v[a++]=240|L>>18,v[a++]=128|L>>12&63}v[a++]=128|L>>6&63}v[a++]=128|L&63}}v[a]=0}}var S=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function $(s,a){for(var u=s>>1,v=u+a/2;!(u>=v)&&Xe[u];)++u;if(u<<=1,32<u-s&&S)return S.decode(ae.subarray(s,u));for(u="",v=0;!(v>=a/2);++v){var k=ye[s+2*v>>1];if(k==0)break;u+=String.fromCharCode(k)}return u}function te(s,a,u){if(u===void 0&&(u=2147483647),2>u)return 0;u-=2;var v=a;u=u<2*s.length?u/2:s.length;for(var k=0;k<u;++k)ye[a>>1]=s.charCodeAt(k),a+=2;return ye[a>>1]=0,a-v}function ne(s){return 2*s.length}function oe(s,a){for(var u=0,v="";!(u>=a/4);){var k=se[s+4*u>>2];if(k==0)break;++u,65536<=k?(k-=65536,v+=String.fromCharCode(55296|k>>10,56320|k&1023)):v+=String.fromCharCode(k)}return v}function Y(s,a,u){if(u===void 0&&(u=2147483647),4>u)return 0;var v=a;u=v+u-4;for(var k=0;k<s.length;++k){var L=s.charCodeAt(k);if(55296<=L&&57343>=L){var z=s.charCodeAt(++k);L=65536+((L&1023)<<10)|z&1023}if(se[a>>2]=L,a+=4,a+4>u)break}return se[a>>2]=0,a-v}function ge(s){for(var a=0,u=0;u<s.length;++u){var v=s.charCodeAt(u);55296<=v&&57343>=v&&++u,a+=4}return a}var we,de,ae,ye,Xe,se,Oe,Ke,qe;function $e(){var s=O.buffer;we=s,r.HEAP8=de=new Int8Array(s),r.HEAP16=ye=new Int16Array(s),r.HEAP32=se=new Int32Array(s),r.HEAPU8=ae=new Uint8Array(s),r.HEAPU16=Xe=new Uint16Array(s),r.HEAPU32=Oe=new Uint32Array(s),r.HEAPF32=Ke=new Float32Array(s),r.HEAPF64=qe=new Float64Array(s)}var D,c=[],g=[],T=[];function U(){var s=r.preRun.shift();c.unshift(s)}var H=0,W=null;r.preloadedImages={},r.preloadedAudios={};function ie(s){throw r.onAbort&&r.onAbort(s),s="Aborted("+s+")",B(s),p=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),y(s),s}function ce(){return fe.startsWith("data:application/octet-stream;base64,")}var fe;if(fe="pathkit.wasm",!ce()){var Ae=fe;fe=r.locateFile?r.locateFile(Ae,A):A+Ae}function Pe(){var s=fe;try{if(s==fe&&Q)return new Uint8Array(Q);if(M)return M(s);throw"both async and sync fetching of the wasm failed"}catch(a){ie(a)}}function Fe(){if(!Q&&(_||x)){if(typeof fetch=="function"&&!fe.startsWith("file://"))return fetch(fe,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+fe+"'";return s.arrayBuffer()}).catch(function(){return Pe()});if(N)return new Promise(function(s,a){N(fe,function(u){s(new Uint8Array(u))},a)})}return Promise.resolve().then(function(){return Pe()})}function Ce(s){for(;0<s.length;){var a=s.shift();if(typeof a=="function")a(r);else{var u=a.Wa;typeof u=="number"?a.xa===void 0?D.get(u)():D.get(u)(a.xa):u(a.xa===void 0?null:a.xa)}}}var pe={};function Ie(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function ze(s){return this.fromWireType(Oe[s>>2])}var st={},et={},E={};function j(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?"_"+s:s}function q(s,a){return s=j(s),function(){return a.apply(this,arguments)}}function ee(s){var a=Error,u=q(s,function(v){this.name=s,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return u.prototype=Object.create(a.prototype),u.prototype.constructor=u,u.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},u}var le=void 0;function he(s){throw new le(s)}function ue(s,a,u){function v(V){V=u(V),V.length!==s.length&&he("Mismatched type converter count");for(var K=0;K<s.length;++K)nt(s[K],V[K])}s.forEach(function(V){E[V]=a});var k=Array(a.length),L=[],z=0;a.forEach(function(V,K){et.hasOwnProperty(V)?k[K]=et[V]:(L.push(V),st.hasOwnProperty(V)||(st[V]=[]),st[V].push(function(){k[K]=et[V],++z,z===L.length&&v(k)}))}),L.length===0&&v(k)}var Ne={};function me(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Le=void 0;function Ee(s){for(var a="";ae[s];)a+=Le[ae[s++]];return a}var Me=void 0;function ve(s){throw new Me(s)}function nt(s,a,u={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var v=a.name;if(s||ve('type "'+v+'" must have a positive integer typeid pointer'),et.hasOwnProperty(s)){if(u.Qa)return;ve("Cannot register type '"+v+"' twice")}et[s]=a,delete E[s],st.hasOwnProperty(s)&&(a=st[s],delete st[s],a.forEach(function(k){k()}))}function cn(s){ve(s.ea.ha.fa.name+" instance already deleted")}var un=!1;function Yn(){}function Zn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function It(s){return typeof FinalizationGroup>"u"?(It=a=>a,s):(un=new FinalizationGroup(function(a){for(var u=a.next();!u.done;u=a.next())u=u.value,u.ga?Zn(u):console.warn("object already deleted: "+u.ga)}),It=a=>(un.register(a,a.ea,a.ea),a),Yn=a=>{un.unregister(a.ea)},It(s))}var wt=void 0,Et=[];function dn(){for(;Et.length;){var s=Et.pop();s.ea.pa=!1,s.delete()}}function lt(){}var Jn={};function Qn(s,a,u){if(s[a].ia===void 0){var v=s[a];s[a]=function(){return s[a].ia.hasOwnProperty(arguments.length)||ve("Function '"+u+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].ia+")!"),s[a].ia[arguments.length].apply(this,arguments)},s[a].ia=[],s[a].ia[v.ua]=v}}function fn(s,a,u){r.hasOwnProperty(s)?((u===void 0||r[s].ia!==void 0&&r[s].ia[u]!==void 0)&&ve("Cannot register public name '"+s+"' twice"),Qn(r,s,s),r.hasOwnProperty(u)&&ve("Cannot register multiple overloads of a function with the same number of arguments ("+u+")!"),r[s].ia[u]=a):(r[s]=a,u!==void 0&&(r[s].Xa=u))}function mr(s,a,u,v,k,L,z,V){this.name=s,this.constructor=a,this.qa=u,this.la=v,this.na=k,this.Oa=L,this.ta=z,this.La=V,this.Ta=[]}function pn(s,a,u){for(;a!==u;)a.ta||ve("Expected null or instance of "+u.name+", got an instance of "+a.name),s=a.ta(s),a=a.na;return s}function vr(s,a){return a===null?(this.Ba&&ve("null is not a valid "+this.name),0):(a.ea||ve('Cannot pass "'+yn(a)+'" as a '+this.name),a.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),pn(a.ea.ga,a.ea.ha.fa,this.fa))}function yr(s,a){if(a===null){if(this.Ba&&ve("null is not a valid "+this.name),this.wa){var u=this.sa();return s!==null&&s.push(this.la,u),u}return 0}if(a.ea||ve('Cannot pass "'+yn(a)+'" as a '+this.name),a.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&a.ea.ha.va&&ve("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name),u=pn(a.ea.ga,a.ea.ha.fa,this.fa),this.wa)switch(a.ea.ka===void 0&&ve("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:a.ea.ma===this?u=a.ea.ka:ve("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name);break;case 1:u=a.ea.ka;break;case 2:if(a.ea.ma===this)u=a.ea.ka;else{var v=a.clone();u=this.Ua(u,ct(function(){v.delete()})),s!==null&&s.push(this.la,u)}break;default:ve("Unsupporting sharing policy")}return u}function Ir(s,a){return a===null?(this.Ba&&ve("null is not a valid "+this.name),0):(a.ea||ve('Cannot pass "'+yn(a)+'" as a '+this.name),a.ea.ga||ve("Cannot pass deleted object as a pointer of type "+this.name),a.ea.ha.va&&ve("Cannot convert argument of type "+a.ea.ha.name+" to parameter type "+this.name),pn(a.ea.ga,a.ea.ha.fa,this.fa))}function ei(s,a,u){return a===u?s:u.na===void 0?null:(s=ei(s,a,u.na),s===null?null:u.La(s))}var bt={};function wr(s,a){for(a===void 0&&ve("ptr should not be undefined");s.na;)a=s.ta(a),s=s.na;return bt[a]}function Ct(s,a){return a.ha&&a.ga||he("makeClassHandle requires ptr and ptrType"),!!a.ma!=!!a.ka&&he("Both smartPtrType and smartPtr must be specified"),a.count={value:1},It(Object.create(s,{ea:{value:a}}))}function rt(s,a,u,v){this.name=s,this.fa=a,this.Ba=u,this.va=v,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,a.na!==void 0?this.toWireType=yr:(this.toWireType=v?vr:Ir,this.ja=null)}function ti(s,a,u){r.hasOwnProperty(s)||he("Replacing nonexistant public symbol"),r[s].ia!==void 0&&u!==void 0?r[s].ia[u]=a:(r[s]=a,r[s].ua=u)}function Er(s,a){var u=[];return function(){u.length=arguments.length;for(var v=0;v<arguments.length;v++)u[v]=arguments[v];return s.includes("j")?(v=r["dynCall_"+s],v=u&&u.length?v.apply(null,[a].concat(u)):v.call(null,a)):v=D.get(a).apply(null,u),v}}function Ve(s,a){s=Ee(s);var u=s.includes("j")?Er(s,a):D.get(a);return typeof u!="function"&&ve("unknown function pointer with signature "+s+": "+a),u}var ni=void 0;function ii(s){s=ci(s);var a=Ee(s);return ot(s),a}function Dt(s,a){function u(L){k[L]||et[L]||(E[L]?E[L].forEach(u):(v.push(L),k[L]=!0))}var v=[],k={};throw a.forEach(u),new ni(s+": "+v.map(ii).join([", "]))}function hn(s,a){for(var u=[],v=0;v<s;v++)u.push(se[(a>>2)+v]);return u}function gn(s,a,u,v,k){var L=a.length;2>L&&ve("argTypes array size mismatch! Must at least get return value and 'this' types!");var z=a[1]!==null&&u!==null,V=!1;for(u=1;u<a.length;++u)if(a[u]!==null&&a[u].ja===void 0){V=!0;break}var K=a[0].name!=="void",Z=L-2,J=Array(Z),re=[],be=[];return function(){if(arguments.length!==Z&&ve("function "+s+" called with "+arguments.length+" arguments, expected "+Z+" args!"),be.length=0,re.length=z?2:1,re[0]=k,z){var ke=a[1].toWireType(be,this);re[1]=ke}for(var _e=0;_e<Z;++_e)J[_e]=a[_e+2].toWireType(be,arguments[_e]),re.push(J[_e]);if(_e=v.apply(null,re),V)Ie(be);else for(var je=z?1:2;je<a.length;je++){var Ue=je===1?ke:J[je-2];a[je].ja!==null&&a[je].ja(Ue)}return ke=K?a[0].fromWireType(_e):void 0,ke}}var mn=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ri(s){4<s&&--tt[s].Ca===0&&(tt[s]=void 0,mn.push(s))}function vn(s){return s||ve("Cannot use deleted val. handle = "+s),tt[s].value}function ct(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var a=mn.length?mn.pop():tt.length;return tt[a]={Ca:1,value:s},a}}function br(s,a,u){switch(a){case 0:return function(v){return this.fromWireType((u?de:ae)[v])};case 1:return function(v){return this.fromWireType((u?ye:Xe)[v>>1])};case 2:return function(v){return this.fromWireType((u?se:Oe)[v>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Pt(s,a){var u=et[s];return u===void 0&&ve(a+" has unknown type "+ii(s)),u}function yn(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function _r(s,a){switch(a){case 2:return function(u){return this.fromWireType(Ke[u>>2])};case 3:return function(u){return this.fromWireType(qe[u>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Sr(s,a,u){switch(a){case 0:return u?function(v){return de[v]}:function(v){return ae[v]};case 1:return u?function(v){return ye[v>>1]}:function(v){return Xe[v>>1]};case 2:return u?function(v){return se[v>>2]}:function(v){return Oe[v>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Tr={};function In(s){var a=Tr[s];return a===void 0?Ee(s):a}var wn=[];function oi(){function s(a){a.$$$embind_global$$$=a;var u=typeof $$$embind_global$$$=="object"&&a.$$$embind_global$$$===a;return u||delete a.$$$embind_global$$$,u}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof _n=="object"&&s(_n)?$$$embind_global$$$=_n:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Or(s){var a=wn.length;return wn.push(s),a}function Nr(s,a){for(var u=Array(s),v=0;v<s;++v)u[v]=Pt(se[(a>>2)+v],"parameter "+v);return u}var ai=[];function kr(s){var a=Array(s+1);return function(u,v,k){a[0]=u;for(var L=0;L<s;++L){var z=Pt(se[(v>>2)+L],"parameter "+L);a[L+1]=z.readValueFromPointer(k),k+=z.argPackAdvance}return u=new(u.bind.apply(u,a)),ct(u)}}var si={},xr=[null,[],[]];le=r.InternalError=ee("InternalError");for(var li=Array(256),$t=0;256>$t;++$t)li[$t]=String.fromCharCode($t);Le=li,Me=r.BindingError=ee("BindingError"),lt.prototype.isAliasOf=function(s){if(!(this instanceof lt&&s instanceof lt))return!1;var a=this.ea.ha.fa,u=this.ea.ga,v=s.ea.ha.fa;for(s=s.ea.ga;a.na;)u=a.ta(u),a=a.na;for(;v.na;)s=v.ta(s),v=v.na;return a===v&&u===s},lt.prototype.clone=function(){if(this.ea.ga||cn(this),this.ea.ra)return this.ea.count.value+=1,this;var s=It,a=Object,u=a.create,v=Object.getPrototypeOf(this),k=this.ea;return s=s(u.call(a,v,{ea:{value:{count:k.count,pa:k.pa,ra:k.ra,ga:k.ga,ha:k.ha,ka:k.ka,ma:k.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},lt.prototype.delete=function(){this.ea.ga||cn(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),Yn(this),Zn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},lt.prototype.isDeleted=function(){return!this.ea.ga},lt.prototype.deleteLater=function(){return this.ea.ga||cn(this),this.ea.pa&&!this.ea.ra&&ve("Object already scheduled for deletion"),Et.push(this),Et.length===1&&wt&&wt(dn),this.ea.pa=!0,this},rt.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},rt.prototype.Ga=function(s){this.la&&this.la(s)},rt.prototype.argPackAdvance=8,rt.prototype.readValueFromPointer=ze,rt.prototype.deleteObject=function(s){s!==null&&s.delete()},rt.prototype.fromWireType=function(s){function a(){return this.wa?Ct(this.fa.qa,{ha:this.Sa,ga:u,ma:this,ka:s}):Ct(this.fa.qa,{ha:this,ga:s})}var u=this.Pa(s);if(!u)return this.Ga(s),null;var v=wr(this.fa,u);if(v!==void 0)return v.ea.count.value===0?(v.ea.ga=u,v.ea.ka=s,v.clone()):(v=v.clone(),this.Ga(s),v);if(v=this.fa.Oa(u),v=Jn[v],!v)return a.call(this);v=this.va?v.Ja:v.pointerType;var k=ei(u,this.fa,v.fa);return k===null?a.call(this):this.wa?Ct(v.fa.qa,{ha:v,ga:k,ma:this,ka:s}):Ct(v.fa.qa,{ha:v,ga:k})},r.getInheritedInstanceCount=function(){return Object.keys(bt).length},r.getLiveInheritedInstances=function(){var s=[],a;for(a in bt)bt.hasOwnProperty(a)&&s.push(bt[a]);return s},r.flushPendingDeletes=dn,r.setDelayFunction=function(s){wt=s,Et.length&&wt&&wt(dn)},ni=r.UnboundTypeError=ee("UnboundTypeError"),r.count_emval_handles=function(){for(var s=0,a=5;a<tt.length;++a)tt[a]!==void 0&&++s;return s},r.get_first_emval=function(){for(var s=5;s<tt.length;++s)if(tt[s]!==void 0)return tt[s];return null};var Ar={r:function(s){var a=pe[s];delete pe[s];var u=a.elements,v=u.length,k=u.map(function(V){return V.Aa}).concat(u.map(function(V){return V.Ea})),L=a.sa,z=a.la;ue([s],k,function(V){return u.forEach(function(K,Z){var J=V[Z],re=K.ya,be=K.za,ke=V[Z+v],_e=K.Da,je=K.Fa;K.read=Ue=>J.fromWireType(re(be,Ue)),K.write=(Ue,dt)=>{var Ye=[];_e(je,Ue,ke.toWireType(Ye,dt)),Ie(Ye)}}),[{name:a.name,fromWireType:function(K){for(var Z=Array(v),J=0;J<v;++J)Z[J]=u[J].read(K);return z(K),Z},toWireType:function(K,Z){if(v!==Z.length)throw new TypeError("Incorrect number of tuple elements for "+a.name+": expected="+v+", actual="+Z.length);for(var J=L(),re=0;re<v;++re)u[re].write(J,Z[re]);return K!==null&&K.push(z,J),J},argPackAdvance:8,readValueFromPointer:ze,ja:z}]})},u:function(s){var a=Ne[s];delete Ne[s];var u=a.sa,v=a.la,k=a.Ha,L=k.map(function(z){return z.Aa}).concat(k.map(function(z){return z.Ea}));ue([s],L,function(z){var V={};return k.forEach(function(K,Z){var J=z[Z],re=K.ya,be=K.za,ke=z[Z+k.length],_e=K.Da,je=K.Fa;V[K.Na]={read:function(Ue){return J.fromWireType(re(be,Ue))},write:function(Ue,dt){var Ye=[];_e(je,Ue,ke.toWireType(Ye,dt)),Ie(Ye)}}}),[{name:a.name,fromWireType:function(K){var Z={},J;for(J in V)Z[J]=V[J].read(K);return v(K),Z},toWireType:function(K,Z){for(var J in V)if(!(J in Z))throw new TypeError('Missing field:  "'+J+'"');var re=u();for(J in V)V[J].write(re,Z[J]);return K!==null&&K.push(v,re),re},argPackAdvance:8,readValueFromPointer:ze,ja:v}]})},z:function(){},F:function(s,a,u,v,k){var L=me(u);a=Ee(a),nt(s,{name:a,fromWireType:function(z){return!!z},toWireType:function(z,V){return V?v:k},argPackAdvance:8,readValueFromPointer:function(z){if(u===1)var V=de;else if(u===2)V=ye;else if(u===4)V=se;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(V[z>>L])},ja:null})},l:function(s,a,u,v,k,L,z,V,K,Z,J,re,be){J=Ee(J),L=Ve(k,L),V&&(V=Ve(z,V)),Z&&(Z=Ve(K,Z)),be=Ve(re,be);var ke=j(J);fn(ke,function(){Dt("Cannot construct "+J+" due to unbound types",[v])}),ue([s,a,u],v?[v]:[],function(_e){if(_e=_e[0],v)var je=_e.fa,Ue=je.qa;else Ue=lt.prototype;_e=q(ke,function(){if(Object.getPrototypeOf(this)!==dt)throw new Me("Use 'new' to construct "+J);if(Ye.oa===void 0)throw new Me(J+" has no accessible constructor");var di=Ye.oa[arguments.length];if(di===void 0)throw new Me("Tried to invoke ctor of "+J+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ye.oa).toString()+") parameters instead!");return di.apply(this,arguments)});var dt=Object.create(Ue,{constructor:{value:_e}});_e.prototype=dt;var Ye=new mr(J,_e,dt,be,je,L,V,Z);je=new rt(J,Ye,!0,!1),Ue=new rt(J+"*",Ye,!1,!1);var ui=new rt(J+" const*",Ye,!1,!0);return Jn[s]={pointerType:Ue,Ja:ui},ti(ke,_e),[je,Ue,ui]})},i:function(s,a,u,v,k,L){0<a||ie(void 0);var z=hn(a,u);k=Ve(v,k),ue([],[s],function(V){V=V[0];var K="constructor "+V.name;if(V.fa.oa===void 0&&(V.fa.oa=[]),V.fa.oa[a-1]!==void 0)throw new Me("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+V.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return V.fa.oa[a-1]=()=>{Dt("Cannot construct "+V.name+" due to unbound types",z)},ue([],z,function(Z){return Z.splice(1,0,null),V.fa.oa[a-1]=gn(K,Z,null,k,L),[]}),[]})},a:function(s,a,u,v,k,L,z,V){var K=hn(u,v);a=Ee(a),L=Ve(k,L),ue([],[s],function(Z){function J(){Dt("Cannot call "+re+" due to unbound types",K)}Z=Z[0];var re=Z.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),V&&Z.fa.Ta.push(a);var be=Z.fa.qa,ke=be[a];return ke===void 0||ke.ia===void 0&&ke.className!==Z.name&&ke.ua===u-2?(J.ua=u-2,J.className=Z.name,be[a]=J):(Qn(be,a,re),be[a].ia[u-2]=J),ue([],K,function(_e){return _e=gn(re,_e,Z,L,z),be[a].ia===void 0?(_e.ua=u-2,be[a]=_e):be[a].ia[u-2]=_e,[]}),[]})},I:function(s,a,u){s=Ee(s),ue([],[a],function(v){return v=v[0],r[s]=v.fromWireType(u),[]})},E:function(s,a){a=Ee(a),nt(s,{name:a,fromWireType:function(u){var v=vn(u);return ri(u),v},toWireType:function(u,v){return ct(v)},argPackAdvance:8,readValueFromPointer:ze,ja:null})},h:function(s,a,u,v){function k(){}u=me(u),a=Ee(a),k.values={},nt(s,{name:a,constructor:k,fromWireType:function(L){return this.constructor.values[L]},toWireType:function(L,z){return z.value},argPackAdvance:8,readValueFromPointer:br(a,u,v),ja:null}),fn(a,k)},k:function(s,a,u){var v=Pt(s,"enum");a=Ee(a),s=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:u},constructor:{value:q(v.name+"_"+a,function(){})}}),s.values[u]=v,s[a]=v},q:function(s,a,u){u=me(u),a=Ee(a),nt(s,{name:a,fromWireType:function(v){return v},toWireType:function(v,k){return k},argPackAdvance:8,readValueFromPointer:_r(a,u),ja:null})},f:function(s,a,u,v,k,L){var z=hn(a,u);s=Ee(s),k=Ve(v,k),fn(s,function(){Dt("Cannot call "+s+" due to unbound types",z)},a-1),ue([],z,function(V){return V=[V[0],null].concat(V.slice(1)),ti(s,gn(s,V,null,k,L),a-1),[]})},e:function(s,a,u,v,k){a=Ee(a),k===-1&&(k=4294967295),k=me(u);var L=V=>V;if(v===0){var z=32-8*u;L=V=>V<<z>>>z}u=a.includes("unsigned")?function(V,K){return K>>>0}:function(V,K){return K},nt(s,{name:a,fromWireType:L,toWireType:u,argPackAdvance:8,readValueFromPointer:Sr(a,k,v!==0),ja:null})},b:function(s,a,u){function v(L){L>>=2;var z=Oe;return new k(we,z[L+1],z[L])}var k=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];u=Ee(u),nt(s,{name:u,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{Qa:!0})},p:function(s,a){a=Ee(a);var u=a==="std::string";nt(s,{name:a,fromWireType:function(v){var k=Oe[v>>2];if(u)for(var L=v+4,z=0;z<=k;++z){var V=v+4+z;if(z==k||ae[V]==0){if(L=L?I(ae,L,V-L):"",K===void 0)var K=L;else K+=String.fromCharCode(0),K+=L;L=V+1}}else{for(K=Array(k),z=0;z<k;++z)K[z]=String.fromCharCode(ae[v+4+z]);K=K.join("")}return ot(v),K},toWireType:function(v,k){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var L=typeof k=="string";L||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int8Array||ve("Cannot pass non-string to std::string");var z=(u&&L?()=>{for(var Z=0,J=0;J<k.length;++J){var re=k.charCodeAt(J);55296<=re&&57343>=re&&(re=65536+((re&1023)<<10)|k.charCodeAt(++J)&1023),127>=re?++Z:Z=2047>=re?Z+2:65535>=re?Z+3:Z+4}return Z}:()=>k.length)(),V=En(4+z+1);if(Oe[V>>2]=z,u&&L)h(k,V+4,z+1);else if(L)for(L=0;L<z;++L){var K=k.charCodeAt(L);255<K&&(ot(V),ve("String has UTF-16 code units that do not fit in 8 bits")),ae[V+4+L]=K}else for(L=0;L<z;++L)ae[V+4+L]=k[L];return v!==null&&v.push(ot,V),V},argPackAdvance:8,readValueFromPointer:ze,ja:function(v){ot(v)}})},m:function(s,a,u){if(u=Ee(u),a===2)var v=$,k=te,L=ne,z=()=>Xe,V=1;else a===4&&(v=oe,k=Y,L=ge,z=()=>Oe,V=2);nt(s,{name:u,fromWireType:function(K){for(var Z=Oe[K>>2],J=z(),re,be=K+4,ke=0;ke<=Z;++ke){var _e=K+4+ke*a;(ke==Z||J[_e>>V]==0)&&(be=v(be,_e-be),re===void 0?re=be:(re+=String.fromCharCode(0),re+=be),be=_e+a)}return ot(K),re},toWireType:function(K,Z){typeof Z!="string"&&ve("Cannot pass non-string to C++ string type "+u);var J=L(Z),re=En(4+J+a);return Oe[re>>2]=J>>V,k(Z,re+4,J+a),K!==null&&K.push(ot,re),re},argPackAdvance:8,readValueFromPointer:ze,ja:function(K){ot(K)}})},t:function(s,a,u,v,k,L){pe[s]={name:Ee(a),sa:Ve(u,v),la:Ve(k,L),elements:[]}},s:function(s,a,u,v,k,L,z,V,K){pe[s].elements.push({Aa:a,ya:Ve(u,v),za:k,Ea:L,Da:Ve(z,V),Fa:K})},v:function(s,a,u,v,k,L){Ne[s]={name:Ee(a),sa:Ve(u,v),la:Ve(k,L),Ha:[]}},j:function(s,a,u,v,k,L,z,V,K,Z){Ne[s].Ha.push({Na:Ee(a),Aa:u,ya:Ve(v,k),za:L,Ea:z,Da:Ve(V,K),Fa:Z})},G:function(s,a){a=Ee(a),nt(s,{Ra:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,a,u,v){s=wn[s],a=vn(a),u=In(u),s(a,u,null,v)},J:ri,x:function(s){return s===0?ct(oi()):(s=In(s),ct(oi()[s]))},c:function(s,a){var u=Nr(s,a),v=u[0];a=v.name+"_$"+u.slice(1).map(function(z){return z.name}).join("_")+"$";var k=ai[a];if(k!==void 0)return k;var L=Array(s-1);return k=Or((z,V,K,Z)=>{for(var J=0,re=0;re<s-1;++re)L[re]=u[re+1].readValueFromPointer(Z+J),J+=u[re+1].argPackAdvance;for(z=z[V].apply(z,L),re=0;re<s-1;++re)u[re+1].Ka&&u[re+1].Ka(L[re]);if(!v.Ra)return v.toWireType(K,z)}),ai[a]=k},n:function(s){4<s&&(tt[s].Ca+=1)},w:function(s,a,u,v){s=vn(s);var k=si[a];return k||(k=kr(a),si[a]=k),k(s,u,v)},K:function(){return ct([])},D:function(s){return ct(In(s))},H:function(s,a){return s=Pt(s,"_emval_take_value"),s=s.readValueFromPointer(a),ct(s)},g:function(){ie("")},B:function(s){var a=ae.length;if(s>>>=0,2147483648<s)return!1;for(var u=1;4>=u;u*=2){var v=a*(1+.2/u);v=Math.min(v,s+100663296),v=Math.max(s,v),0<v%65536&&(v+=65536-v%65536);e:{try{O.grow(Math.min(2147483648,v)-we.byteLength+65535>>>16),$e();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,a,u,v){for(var k=0,L=0;L<u;L++){var z=se[a>>2],V=se[a+4>>2];a+=8;for(var K=0;K<V;K++){var Z=ae[z+K],J=xr[s];Z===0||Z===10?((s===1?X:B)(I(J,0)),J.length=0):J.push(Z)}k+=V}return se[v>>2]=k,0},A:function(){}};(function(){function s(k){r.asm=k.exports,O=r.asm.L,$e(),D=r.asm._,g.unshift(r.asm.M),H--,r.monitorRunDependencies&&r.monitorRunDependencies(H),H==0&&W&&(k=W,W=null,k())}function a(k){s(k.instance)}function u(k){return Fe().then(function(L){return WebAssembly.instantiate(L,v)}).then(function(L){return L}).then(k,function(L){B("failed to asynchronously prepare wasm: "+L),ie(L)})}var v={a:Ar};if(H++,r.monitorRunDependencies&&r.monitorRunDependencies(H),r.instantiateWasm)try{return r.instantiateWasm(v,s)}catch(k){return B("Module.instantiateWasm callback failed with error: "+k),!1}return function(){return Q||typeof WebAssembly.instantiateStreaming!="function"||ce()||fe.startsWith("file://")||typeof fetch!="function"?u(a):fetch(fe,{credentials:"same-origin"}).then(function(k){return WebAssembly.instantiateStreaming(k,v).then(a,function(L){return B("wasm streaming compile failed: "+L),B("falling back to ArrayBuffer instantiation"),u(a)})})}().catch(y),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var ot=r._free=function(){return(ot=r._free=r.asm.$).apply(null,arguments)},En=r._malloc=function(){return(En=r._malloc=r.asm.aa).apply(null,arguments)},ci=r.___getTypeName=function(){return(ci=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Lt;W=function s(){Lt||bn(),Lt||(W=s)};function bn(){function s(){if(!Lt&&(Lt=!0,r.calledRun=!0,!p)){if(Ce(g),d(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var a=r.postRun.shift();T.unshift(a)}Ce(T)}}if(!(0<H)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)U();Ce(c),0<H||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),s()},1)):s())}}if(r.run=bn,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return bn(),o.ready}})();i.exports=t})(Vi);var Ur=Vi.exports;const Hr=Gn(Ur),Wr="/assets/pathkit-1356ccfa.wasm";let Je=null,Yt="",Zt="",Jt="",Qt="";async function ji(){await F.scene.local.deleteItems([Qt,Yt,Zt,Jt]),Yt="",Zt="",Qt="",Jt="",await F.popover.close(w.POLYTOOLID)}async function Ui(){if(!Je)return;const[i,e]=Je;e(),Je=null,ji()}async function Hi(){if(!Je)return;const[i,e]=Je,t=i(n=>{n.visible=!1,n.metadata[`${w.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&F.scene.items.addItems([t]),e(),Je=null,ji()}async function Gr(i,e){if(!e.transformer)if(Je)if(e.target&&(e.target.id===Yt||e.target.id===Zt))Hi();else if(e.target&&(e.target.id===Qt||e.target.id===Jt))Ui();else{const[t]=Je;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Kt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Wn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(.5).strokeColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Je=await F.interaction.startItemInteraction(n);const o=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Kt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await F.scene.local.addItems([t,o,r,l]),Yt=t.id,Zt=o.id,Qt=l.id,Jt=r.id,await F.popover.open({id:w.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function qr(i,e){if(!Je||e.transformer)return;const[t]=Je,n=Math.round(R.gridDpi/R.gridSnap),o=Math.round(e.pointerPosition.x/R.gridDpi)*R.gridDpi,r=Math.round(e.pointerPosition.y/R.gridDpi)*R.gridDpi,l=Math.abs(o-e.pointerPosition.x),d=Math.abs(r-e.pointerPosition.y);let y,m;l<=n?y=o:y=e.pointerPosition.x,d<=n?m=r:m=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=R.snap?{x:y,y:m}:e.pointerPosition})}function zr(i,e){Je&&(e.key=="Escape"?Ui():e.key=="Enter"&&Hi())}const Tn={onToolClick:Gr,onToolMove:qr,onKeyDown:zr};let Qe=null,Ot="",Nt="",en="",tn="";async function Wi(){await F.scene.local.deleteItems([tn,Ot,Nt,en]),Ot="",Nt="",tn="",en="",await F.popover.close(w.LINETOOLID)}async function Gi(){if(!Qe)return;const[i,e]=Qe;e(),Qe=null,await Wi()}async function qi(){if(!Qe)return;const[i,e]=Qe,t=i(n=>{n.visible=!1,n.metadata[`${w.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await F.scene.items.addItems([t]),e(),Qe=null,await Wi()}async function Kr(i,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===Ot||e.target.id===Nt))await qi();else if(e.target&&(e.target.id===tn||e.target.id===en))await Gi();else{const[t]=Qe;t(n=>{n.points.push(e.pointerPosition)}),await F.scene.local.updateItems(n=>n.id==Nt||n.id==Ot,n=>{for(const o of n)o.position=e.pointerPosition})}else{const t=Kt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Wn().tension(0).points([e.pointerPosition,e.pointerPosition]).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Qe=await F.interaction.startItemInteraction(n);const o=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=yt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Kt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await F.scene.local.addItems([t,o,r,l]),Ot=t.id,Nt=o.id,tn=l.id,en=r.id,await F.popover.open({id:w.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function Yr(i,e){if(!Qe||e.transformer)return;const[t]=Qe,n=Math.round(R.gridDpi/R.gridSnap),o=Math.round(e.pointerPosition.x/R.gridDpi)*R.gridDpi,r=Math.round(e.pointerPosition.y/R.gridDpi)*R.gridDpi,l=Math.abs(o-e.pointerPosition.x),d=Math.abs(r-e.pointerPosition.y);let y,m;l<=n?y=o:y=e.pointerPosition.x,d<=n?m=r:m=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=R.snap?{x:y,y:m}:e.pointerPosition})}function Zr(i,e){Qe&&(e.key=="Escape"?Gi():e.key=="Enter"&&qi())}const On={onToolClick:Kr,onToolMove:Yr,onKeyDown:Zr};class Bn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Mt(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zi={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,o,r){function l(m,_){if(!o[m]){if(!n[m]){var x=typeof Mt=="function"&&Mt;if(!_&&x)return x(m,!0);if(d)return d(m,!0);throw new Error("Cannot find module '"+m+"'")}_=o[m]={exports:{}},n[m][0].call(_.exports,function(A){var G=n[m][1][A];return l(G||A)},_,_.exports,t,n,o,r)}return o[m].exports}for(var d=typeof Mt=="function"&&Mt,y=0;y<r.length;y++)l(r[y]);return l}({1:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){var N=t("crypto");function M(O,p){p=C(O,p);var f;return(f=p.algorithm!=="passthrough"?N.createHash(p.algorithm):new Q).write===void 0&&(f.write=f.update,f.end=f.update),B(p,f).dispatch(O),f.update||f.end(""),f.digest?f.digest(p.encoding==="buffer"?void 0:p.encoding):(O=f.read(),p.encoding!=="buffer"?O.toString(p.encoding):O)}(o=n.exports=M).sha1=function(O){return M(O)},o.keys=function(O){return M(O,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(O){return M(O,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(O){return M(O,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var b=N.getHashes?N.getHashes().slice():["sha1","md5"],P=(b.push("passthrough"),["buffer","hex","binary","base64"]);function C(O,p){var f={};if(f.algorithm=(p=p||{}).algorithm||"sha1",f.encoding=p.encoding||"hex",f.excludeValues=!!p.excludeValues,f.algorithm=f.algorithm.toLowerCase(),f.encoding=f.encoding.toLowerCase(),f.ignoreUnknown=p.ignoreUnknown===!0,f.respectType=p.respectType!==!1,f.respectFunctionNames=p.respectFunctionNames!==!1,f.respectFunctionProperties=p.respectFunctionProperties!==!1,f.unorderedArrays=p.unorderedArrays===!0,f.unorderedSets=p.unorderedSets!==!1,f.unorderedObjects=p.unorderedObjects!==!1,f.replacer=p.replacer||void 0,f.excludeKeys=p.excludeKeys||void 0,O===void 0)throw new Error("Object argument required.");for(var I=0;I<b.length;++I)b[I].toLowerCase()===f.algorithm.toLowerCase()&&(f.algorithm=b[I]);if(b.indexOf(f.algorithm)===-1)throw new Error('Algorithm "'+f.algorithm+'"  not supported. supported values: '+b.join(", "));if(P.indexOf(f.encoding)===-1&&f.algorithm!=="passthrough")throw new Error('Encoding "'+f.encoding+'"  not supported. supported values: '+P.join(", "));return f}function X(O){if(typeof O=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(O))!=null}function B(O,p,f){f=f||[];function I(h){return p.update?p.update(h,"utf8"):p.write(h,"utf8")}return{dispatch:function(h){return this["_"+((h=O.replacer?O.replacer(h):h)===null?"null":typeof h)](h)},_object:function(h){var S,$=Object.prototype.toString.call(h),te=/\[object (.*)\]/i.exec($);if(te=(te=te?te[1]:"unknown:["+$+"]").toLowerCase(),0<=($=f.indexOf(h)))return this.dispatch("[CIRCULAR:"+$+"]");if(f.push(h),d!==void 0&&d.isBuffer&&d.isBuffer(h))return I("buffer:"),I(h);if(te==="object"||te==="function"||te==="asyncfunction")return $=Object.keys(h),O.unorderedObjects&&($=$.sort()),O.respectType===!1||X(h)||$.splice(0,0,"prototype","__proto__","constructor"),O.excludeKeys&&($=$.filter(function(ne){return!O.excludeKeys(ne)})),I("object:"+$.length+":"),S=this,$.forEach(function(ne){S.dispatch(ne),I(":"),O.excludeValues||S.dispatch(h[ne]),I(",")});if(!this["_"+te]){if(O.ignoreUnknown)return I("["+te+"]");throw new Error('Unknown object type "'+te+'"')}this["_"+te](h)},_array:function(h,ne){ne=ne!==void 0?ne:O.unorderedArrays!==!1;var $=this;if(I("array:"+h.length+":"),!ne||h.length<=1)return h.forEach(function(oe){return $.dispatch(oe)});var te=[],ne=h.map(function(oe){var Y=new Q,ge=f.slice();return B(O,Y,ge).dispatch(oe),te=te.concat(ge.slice(f.length)),Y.read().toString()});return f=f.concat(te),ne.sort(),this._array(ne,!1)},_date:function(h){return I("date:"+h.toJSON())},_symbol:function(h){return I("symbol:"+h.toString())},_error:function(h){return I("error:"+h.toString())},_boolean:function(h){return I("bool:"+h.toString())},_string:function(h){I("string:"+h.length+":"),I(h.toString())},_function:function(h){I("fn:"),X(h)?this.dispatch("[native]"):this.dispatch(h.toString()),O.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(h.name)),O.respectFunctionProperties&&this._object(h)},_number:function(h){return I("number:"+h.toString())},_xml:function(h){return I("xml:"+h.toString())},_null:function(){return I("Null")},_undefined:function(){return I("Undefined")},_regexp:function(h){return I("regex:"+h.toString())},_uint8array:function(h){return I("uint8array:"),this.dispatch(Array.prototype.slice.call(h))},_uint8clampedarray:function(h){return I("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(h))},_int8array:function(h){return I("int8array:"),this.dispatch(Array.prototype.slice.call(h))},_uint16array:function(h){return I("uint16array:"),this.dispatch(Array.prototype.slice.call(h))},_int16array:function(h){return I("int16array:"),this.dispatch(Array.prototype.slice.call(h))},_uint32array:function(h){return I("uint32array:"),this.dispatch(Array.prototype.slice.call(h))},_int32array:function(h){return I("int32array:"),this.dispatch(Array.prototype.slice.call(h))},_float32array:function(h){return I("float32array:"),this.dispatch(Array.prototype.slice.call(h))},_float64array:function(h){return I("float64array:"),this.dispatch(Array.prototype.slice.call(h))},_arraybuffer:function(h){return I("arraybuffer:"),this.dispatch(new Uint8Array(h))},_url:function(h){return I("url:"+h.toString())},_map:function(h){return I("map:"),h=Array.from(h),this._array(h,O.unorderedSets!==!1)},_set:function(h){return I("set:"),h=Array.from(h),this._array(h,O.unorderedSets!==!1)},_file:function(h){return I("file:"),this.dispatch([h.name,h.size,h.type,h.lastModfied])},_blob:function(){if(O.ignoreUnknown)return I("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return I("domwindow")},_bigint:function(h){return I("bigint:"+h.toString())},_process:function(){return I("process")},_timer:function(){return I("timer")},_pipe:function(){return I("pipe")},_tcp:function(){return I("tcp")},_udp:function(){return I("udp")},_tty:function(){return I("tty")},_statwatcher:function(){return I("statwatcher")},_securecontext:function(){return I("securecontext")},_connection:function(){return I("connection")},_zlib:function(){return I("zlib")},_context:function(){return I("context")},_nodescript:function(){return I("nodescript")},_httpparser:function(){return I("httpparser")},_dataview:function(){return I("dataview")},_signal:function(){return I("signal")},_fsevent:function(){return I("fsevent")},_tlswrap:function(){return I("tlswrap")}}}function Q(){return{buf:"",write:function(O){this.buf+=O},end:function(O){this.buf+=O},read:function(){return this.buf}}}o.writeToStream=function(O,p,f){return f===void 0&&(f=p,p={}),B(p=C(O,p),f).dispatch(O)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){(function(N){var M=typeof Uint8Array<"u"?Uint8Array:Array,b="+".charCodeAt(0),P="/".charCodeAt(0),C="0".charCodeAt(0),X="a".charCodeAt(0),B="A".charCodeAt(0),Q="-".charCodeAt(0),O="_".charCodeAt(0);function p(f){return f=f.charCodeAt(0),f===b||f===Q?62:f===P||f===O?63:f<C?-1:f<C+10?f-C+26+26:f<B+26?f-B:f<X+26?f-X+26:void 0}N.toByteArray=function(f){var I,h;if(0<f.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var S=f.length,S=f.charAt(S-2)==="="?2:f.charAt(S-1)==="="?1:0,$=new M(3*f.length/4-S),te=0<S?f.length-4:f.length,ne=0;function oe(Y){$[ne++]=Y}for(I=0;I<te;I+=4,0)oe((16711680&(h=p(f.charAt(I))<<18|p(f.charAt(I+1))<<12|p(f.charAt(I+2))<<6|p(f.charAt(I+3))))>>16),oe((65280&h)>>8),oe(255&h);return S==2?oe(255&(h=p(f.charAt(I))<<2|p(f.charAt(I+1))>>4)):S==1&&(oe((h=p(f.charAt(I))<<10|p(f.charAt(I+1))<<4|p(f.charAt(I+2))>>2)>>8&255),oe(255&h)),$},N.fromByteArray=function(f){var I,h,S,$,te=f.length%3,ne="";function oe(Y){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Y)}for(I=0,S=f.length-te;I<S;I+=3)h=(f[I]<<16)+(f[I+1]<<8)+f[I+2],ne+=oe(($=h)>>18&63)+oe($>>12&63)+oe($>>6&63)+oe(63&$);switch(te){case 1:ne=(ne+=oe((h=f[f.length-1])>>2))+oe(h<<4&63)+"==";break;case 2:ne=(ne=(ne+=oe((h=(f[f.length-2]<<8)+f[f.length-1])>>10))+oe(h>>4&63))+oe(h<<2&63)+"="}return ne}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,o){(function(r,l,b,y,m,_,x,A,G){var N=t("base64-js"),M=t("ieee754");function b(c,g,T){if(!(this instanceof b))return new b(c,g,T);var U,H,W,ie,ce=typeof c;if(g==="base64"&&ce=="string")for(c=(ie=c).trim?ie.trim():ie.replace(/^\s+|\s+$/g,"");c.length%4!=0;)c+="=";if(ce=="number")U=we(c);else if(ce=="string")U=b.byteLength(c,g);else{if(ce!="object")throw new Error("First argument needs to be a number, array or string.");U=we(c.length)}if(b._useTypedArrays?H=b._augment(new Uint8Array(U)):((H=this).length=U,H._isBuffer=!0),b._useTypedArrays&&typeof c.byteLength=="number")H._set(c);else if(de(ie=c)||b.isBuffer(ie)||ie&&typeof ie=="object"&&typeof ie.length=="number")for(W=0;W<U;W++)b.isBuffer(c)?H[W]=c.readUInt8(W):H[W]=c[W];else if(ce=="string")H.write(c,0,g);else if(ce=="number"&&!b._useTypedArrays&&!T)for(W=0;W<U;W++)H[W]=0;return H}function P(c,g,T,U){return b._charsWritten=se(function(H){for(var W=[],ie=0;ie<H.length;ie++)W.push(255&H.charCodeAt(ie));return W}(g),c,T,U)}function C(c,g,T,U){return b._charsWritten=se(function(H){for(var W,ie,ce=[],fe=0;fe<H.length;fe++)ie=H.charCodeAt(fe),W=ie>>8,ie=ie%256,ce.push(ie),ce.push(W);return ce}(g),c,T,U)}function X(c,g,T){var U="";T=Math.min(c.length,T);for(var H=g;H<T;H++)U+=String.fromCharCode(c[H]);return U}function B(c,g,T,W){W||(D(typeof T=="boolean","missing or invalid endian"),D(g!=null,"missing offset"),D(g+1<c.length,"Trying to read beyond buffer length"));var H,W=c.length;if(!(W<=g))return T?(H=c[g],g+1<W&&(H|=c[g+1]<<8)):(H=c[g]<<8,g+1<W&&(H|=c[g+1])),H}function Q(c,g,T,W){W||(D(typeof T=="boolean","missing or invalid endian"),D(g!=null,"missing offset"),D(g+3<c.length,"Trying to read beyond buffer length"));var H,W=c.length;if(!(W<=g))return T?(g+2<W&&(H=c[g+2]<<16),g+1<W&&(H|=c[g+1]<<8),H|=c[g],g+3<W&&(H+=c[g+3]<<24>>>0)):(g+1<W&&(H=c[g+1]<<16),g+2<W&&(H|=c[g+2]<<8),g+3<W&&(H|=c[g+3]),H+=c[g]<<24>>>0),H}function O(c,g,T,U){if(U||(D(typeof T=="boolean","missing or invalid endian"),D(g!=null,"missing offset"),D(g+1<c.length,"Trying to read beyond buffer length")),!(c.length<=g))return U=B(c,g,T,!0),32768&U?-1*(65535-U+1):U}function p(c,g,T,U){if(U||(D(typeof T=="boolean","missing or invalid endian"),D(g!=null,"missing offset"),D(g+3<c.length,"Trying to read beyond buffer length")),!(c.length<=g))return U=Q(c,g,T,!0),2147483648&U?-1*(4294967295-U+1):U}function f(c,g,T,U){return U||(D(typeof T=="boolean","missing or invalid endian"),D(g+3<c.length,"Trying to read beyond buffer length")),M.read(c,g,T,23,4)}function I(c,g,T,U){return U||(D(typeof T=="boolean","missing or invalid endian"),D(g+7<c.length,"Trying to read beyond buffer length")),M.read(c,g,T,52,8)}function h(c,g,T,U,H){if(H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+1<c.length,"trying to write beyond buffer length"),Ke(g,65535)),H=c.length,!(H<=T))for(var W=0,ie=Math.min(H-T,2);W<ie;W++)c[T+W]=(g&255<<8*(U?W:1-W))>>>8*(U?W:1-W)}function S(c,g,T,U,H){if(H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+3<c.length,"trying to write beyond buffer length"),Ke(g,4294967295)),H=c.length,!(H<=T))for(var W=0,ie=Math.min(H-T,4);W<ie;W++)c[T+W]=g>>>8*(U?W:3-W)&255}function $(c,g,T,U,H){H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+1<c.length,"Trying to write beyond buffer length"),qe(g,32767,-32768)),c.length<=T||h(c,0<=g?g:65535+g+1,T,U,H)}function te(c,g,T,U,H){H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+3<c.length,"Trying to write beyond buffer length"),qe(g,2147483647,-2147483648)),c.length<=T||S(c,0<=g?g:4294967295+g+1,T,U,H)}function ne(c,g,T,U,H){H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+3<c.length,"Trying to write beyond buffer length"),$e(g,34028234663852886e22,-34028234663852886e22)),c.length<=T||M.write(c,g,T,U,23,4)}function oe(c,g,T,U,H){H||(D(g!=null,"missing value"),D(typeof U=="boolean","missing or invalid endian"),D(T!=null,"missing offset"),D(T+7<c.length,"Trying to write beyond buffer length"),$e(g,17976931348623157e292,-17976931348623157e292)),c.length<=T||M.write(c,g,T,U,52,8)}o.Buffer=b,o.SlowBuffer=b,o.INSPECT_MAX_BYTES=50,b.poolSize=8192,b._useTypedArrays=function(){try{var c=new ArrayBuffer(0),g=new Uint8Array(c);return g.foo=function(){return 42},g.foo()===42&&typeof g.subarray=="function"}catch{return!1}}(),b.isEncoding=function(c){switch(String(c).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.isBuffer=function(c){return!(c==null||!c._isBuffer)},b.byteLength=function(c,g){var T;switch(c+="",g||"utf8"){case"hex":T=c.length/2;break;case"utf8":case"utf-8":T=ye(c).length;break;case"ascii":case"binary":case"raw":T=c.length;break;case"base64":T=Xe(c).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":T=2*c.length;break;default:throw new Error("Unknown encoding")}return T},b.concat=function(c,g){if(D(de(c),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),c.length===0)return new b(0);if(c.length===1)return c[0];if(typeof g!="number")for(H=g=0;H<c.length;H++)g+=c[H].length;for(var T=new b(g),U=0,H=0;H<c.length;H++){var W=c[H];W.copy(T,U),U+=W.length}return T},b.prototype.write=function(c,g,T,U){isFinite(g)?isFinite(T)||(U=T,T=void 0):(fe=U,U=g,g=T,T=fe),g=Number(g)||0;var H,W,ie,ce,fe=this.length-g;switch((!T||fe<(T=Number(T)))&&(T=fe),U=String(U||"utf8").toLowerCase()){case"hex":H=function(Ae,Pe,Fe,Ce){Fe=Number(Fe)||0;var pe=Ae.length-Fe;(!Ce||pe<(Ce=Number(Ce)))&&(Ce=pe),D((pe=Pe.length)%2==0,"Invalid hex string"),pe/2<Ce&&(Ce=pe/2);for(var Ie=0;Ie<Ce;Ie++){var ze=parseInt(Pe.substr(2*Ie,2),16);D(!isNaN(ze),"Invalid hex string"),Ae[Fe+Ie]=ze}return b._charsWritten=2*Ie,Ie}(this,c,g,T);break;case"utf8":case"utf-8":W=this,ie=g,ce=T,H=b._charsWritten=se(ye(c),W,ie,ce);break;case"ascii":case"binary":H=P(this,c,g,T);break;case"base64":W=this,ie=g,ce=T,H=b._charsWritten=se(Xe(c),W,ie,ce);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":H=C(this,c,g,T);break;default:throw new Error("Unknown encoding")}return H},b.prototype.toString=function(c,g,T){var U,H,W,ie,ce=this;if(c=String(c||"utf8").toLowerCase(),g=Number(g)||0,(T=T!==void 0?Number(T):ce.length)===g)return"";switch(c){case"hex":U=function(fe,Ae,Pe){var Fe=fe.length;(!Ae||Ae<0)&&(Ae=0),(!Pe||Pe<0||Fe<Pe)&&(Pe=Fe);for(var Ce="",pe=Ae;pe<Pe;pe++)Ce+=ae(fe[pe]);return Ce}(ce,g,T);break;case"utf8":case"utf-8":U=function(fe,Ae,Pe){var Fe="",Ce="";Pe=Math.min(fe.length,Pe);for(var pe=Ae;pe<Pe;pe++)fe[pe]<=127?(Fe+=Oe(Ce)+String.fromCharCode(fe[pe]),Ce=""):Ce+="%"+fe[pe].toString(16);return Fe+Oe(Ce)}(ce,g,T);break;case"ascii":case"binary":U=X(ce,g,T);break;case"base64":H=ce,ie=T,U=(W=g)===0&&ie===H.length?N.fromByteArray(H):N.fromByteArray(H.slice(W,ie));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":U=function(fe,Ae,Pe){for(var Fe=fe.slice(Ae,Pe),Ce="",pe=0;pe<Fe.length;pe+=2)Ce+=String.fromCharCode(Fe[pe]+256*Fe[pe+1]);return Ce}(ce,g,T);break;default:throw new Error("Unknown encoding")}return U},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},b.prototype.copy=function(c,g,T,U){if(g=g||0,(U=U||U===0?U:this.length)!==(T=T||0)&&c.length!==0&&this.length!==0){D(T<=U,"sourceEnd < sourceStart"),D(0<=g&&g<c.length,"targetStart out of bounds"),D(0<=T&&T<this.length,"sourceStart out of bounds"),D(0<=U&&U<=this.length,"sourceEnd out of bounds"),U>this.length&&(U=this.length);var H=(U=c.length-g<U-T?c.length-g+T:U)-T;if(H<100||!b._useTypedArrays)for(var W=0;W<H;W++)c[W+g]=this[W+T];else c._set(this.subarray(T,T+H),g)}},b.prototype.slice=function(c,g){var T=this.length;if(c=ge(c,T,0),g=ge(g,T,T),b._useTypedArrays)return b._augment(this.subarray(c,g));for(var U=g-c,H=new b(U,void 0,!0),W=0;W<U;W++)H[W]=this[W+c];return H},b.prototype.get=function(c){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(c)},b.prototype.set=function(c,g){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(c,g)},b.prototype.readUInt8=function(c,g){if(g||(D(c!=null,"missing offset"),D(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return this[c]},b.prototype.readUInt16LE=function(c,g){return B(this,c,!0,g)},b.prototype.readUInt16BE=function(c,g){return B(this,c,!1,g)},b.prototype.readUInt32LE=function(c,g){return Q(this,c,!0,g)},b.prototype.readUInt32BE=function(c,g){return Q(this,c,!1,g)},b.prototype.readInt8=function(c,g){if(g||(D(c!=null,"missing offset"),D(c<this.length,"Trying to read beyond buffer length")),!(c>=this.length))return 128&this[c]?-1*(255-this[c]+1):this[c]},b.prototype.readInt16LE=function(c,g){return O(this,c,!0,g)},b.prototype.readInt16BE=function(c,g){return O(this,c,!1,g)},b.prototype.readInt32LE=function(c,g){return p(this,c,!0,g)},b.prototype.readInt32BE=function(c,g){return p(this,c,!1,g)},b.prototype.readFloatLE=function(c,g){return f(this,c,!0,g)},b.prototype.readFloatBE=function(c,g){return f(this,c,!1,g)},b.prototype.readDoubleLE=function(c,g){return I(this,c,!0,g)},b.prototype.readDoubleBE=function(c,g){return I(this,c,!1,g)},b.prototype.writeUInt8=function(c,g,T){T||(D(c!=null,"missing value"),D(g!=null,"missing offset"),D(g<this.length,"trying to write beyond buffer length"),Ke(c,255)),g>=this.length||(this[g]=c)},b.prototype.writeUInt16LE=function(c,g,T){h(this,c,g,!0,T)},b.prototype.writeUInt16BE=function(c,g,T){h(this,c,g,!1,T)},b.prototype.writeUInt32LE=function(c,g,T){S(this,c,g,!0,T)},b.prototype.writeUInt32BE=function(c,g,T){S(this,c,g,!1,T)},b.prototype.writeInt8=function(c,g,T){T||(D(c!=null,"missing value"),D(g!=null,"missing offset"),D(g<this.length,"Trying to write beyond buffer length"),qe(c,127,-128)),g>=this.length||(0<=c?this.writeUInt8(c,g,T):this.writeUInt8(255+c+1,g,T))},b.prototype.writeInt16LE=function(c,g,T){$(this,c,g,!0,T)},b.prototype.writeInt16BE=function(c,g,T){$(this,c,g,!1,T)},b.prototype.writeInt32LE=function(c,g,T){te(this,c,g,!0,T)},b.prototype.writeInt32BE=function(c,g,T){te(this,c,g,!1,T)},b.prototype.writeFloatLE=function(c,g,T){ne(this,c,g,!0,T)},b.prototype.writeFloatBE=function(c,g,T){ne(this,c,g,!1,T)},b.prototype.writeDoubleLE=function(c,g,T){oe(this,c,g,!0,T)},b.prototype.writeDoubleBE=function(c,g,T){oe(this,c,g,!1,T)},b.prototype.fill=function(c,g,T){if(g=g||0,T=T||this.length,D(typeof(c=typeof(c=c||0)=="string"?c.charCodeAt(0):c)=="number"&&!isNaN(c),"value is not a number"),D(g<=T,"end < start"),T!==g&&this.length!==0){D(0<=g&&g<this.length,"start out of bounds"),D(0<=T&&T<=this.length,"end out of bounds");for(var U=g;U<T;U++)this[U]=c}},b.prototype.inspect=function(){for(var c=[],g=this.length,T=0;T<g;T++)if(c[T]=ae(this[T]),T===o.INSPECT_MAX_BYTES){c[T+1]="...";break}return"<Buffer "+c.join(" ")+">"},b.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(b._useTypedArrays)return new b(this).buffer;for(var c=new Uint8Array(this.length),g=0,T=c.length;g<T;g+=1)c[g]=this[g];return c.buffer};var Y=b.prototype;function ge(c,g,T){return typeof c!="number"?T:g<=(c=~~c)?g:0<=c||0<=(c+=g)?c:0}function we(c){return(c=~~Math.ceil(+c))<0?0:c}function de(c){return(Array.isArray||function(g){return Object.prototype.toString.call(g)==="[object Array]"})(c)}function ae(c){return c<16?"0"+c.toString(16):c.toString(16)}function ye(c){for(var g=[],T=0;T<c.length;T++){var U=c.charCodeAt(T);if(U<=127)g.push(c.charCodeAt(T));else for(var H=T,W=(55296<=U&&U<=57343&&T++,encodeURIComponent(c.slice(H,T+1)).substr(1).split("%")),ie=0;ie<W.length;ie++)g.push(parseInt(W[ie],16))}return g}function Xe(c){return N.toByteArray(c)}function se(c,g,T,U){for(var H=0;H<U&&!(H+T>=g.length||H>=c.length);H++)g[H+T]=c[H];return H}function Oe(c){try{return decodeURIComponent(c)}catch{return String.fromCharCode(65533)}}function Ke(c,g){D(typeof c=="number","cannot write a non-number as a number"),D(0<=c,"specified a negative value for writing an unsigned value"),D(c<=g,"value is larger than maximum value for type"),D(Math.floor(c)===c,"value has a fractional component")}function qe(c,g,T){D(typeof c=="number","cannot write a non-number as a number"),D(c<=g,"value larger than maximum allowed value"),D(T<=c,"value smaller than minimum allowed value"),D(Math.floor(c)===c,"value has a fractional component")}function $e(c,g,T){D(typeof c=="number","cannot write a non-number as a number"),D(c<=g,"value larger than maximum allowed value"),D(T<=c,"value smaller than minimum allowed value")}function D(c,g){if(!c)throw new Error(g||"Failed assertion")}b._augment=function(c){return c._isBuffer=!0,c._get=c.get,c._set=c.set,c.get=Y.get,c.set=Y.set,c.write=Y.write,c.toString=Y.toString,c.toLocaleString=Y.toString,c.toJSON=Y.toJSON,c.copy=Y.copy,c.slice=Y.slice,c.readUInt8=Y.readUInt8,c.readUInt16LE=Y.readUInt16LE,c.readUInt16BE=Y.readUInt16BE,c.readUInt32LE=Y.readUInt32LE,c.readUInt32BE=Y.readUInt32BE,c.readInt8=Y.readInt8,c.readInt16LE=Y.readInt16LE,c.readInt16BE=Y.readInt16BE,c.readInt32LE=Y.readInt32LE,c.readInt32BE=Y.readInt32BE,c.readFloatLE=Y.readFloatLE,c.readFloatBE=Y.readFloatBE,c.readDoubleLE=Y.readDoubleLE,c.readDoubleBE=Y.readDoubleBE,c.writeUInt8=Y.writeUInt8,c.writeUInt16LE=Y.writeUInt16LE,c.writeUInt16BE=Y.writeUInt16BE,c.writeUInt32LE=Y.writeUInt32LE,c.writeUInt32BE=Y.writeUInt32BE,c.writeInt8=Y.writeInt8,c.writeInt16LE=Y.writeInt16LE,c.writeInt16BE=Y.writeInt16BE,c.writeInt32LE=Y.writeInt32LE,c.writeInt32BE=Y.writeInt32BE,c.writeFloatLE=Y.writeFloatLE,c.writeFloatBE=Y.writeFloatBE,c.writeDoubleLE=Y.writeDoubleLE,c.writeDoubleBE=Y.writeDoubleBE,c.fill=Y.fill,c.inspect=Y.inspect,c.toArrayBuffer=Y.toArrayBuffer,c}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,o){(function(r,l,N,y,m,_,x,A,G){var N=t("buffer").Buffer,M=4,b=new N(M);b.fill(0),n.exports={hash:function(P,C,X,B){for(var Q=C(function(h,S){h.length%M!=0&&($=h.length+(M-h.length%M),h=N.concat([h,b],$));for(var $,te=[],ne=S?h.readInt32BE:h.readInt32LE,oe=0;oe<h.length;oe+=M)te.push(ne.call(h,oe));return te}(P=N.isBuffer(P)?P:new N(P),B),8*P.length),C=B,O=new N(X),p=C?O.writeInt32BE:O.writeInt32LE,f=0;f<Q.length;f++)p.call(O,Q[f],4*f,!0);return O}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,o){(function(r,l,N,y,m,_,x,A,G){var N=t("buffer").Buffer,M=t("./sha"),b=t("./sha256"),P=t("./rng"),C={sha1:M,sha256:b,md5:t("./md5")},X=64,B=new N(X);function Q(h,S){var $=C[h=h||"sha1"],te=[];return $||O("algorithm:",h,"is not yet supported"),{update:function(ne){return N.isBuffer(ne)||(ne=new N(ne)),te.push(ne),ne.length,this},digest:function(ne){var oe=N.concat(te),oe=S?function(Y,ge,we){N.isBuffer(ge)||(ge=new N(ge)),N.isBuffer(we)||(we=new N(we)),ge.length>X?ge=Y(ge):ge.length<X&&(ge=N.concat([ge,B],X));for(var de=new N(X),ae=new N(X),ye=0;ye<X;ye++)de[ye]=54^ge[ye],ae[ye]=92^ge[ye];return we=Y(N.concat([de,we])),Y(N.concat([ae,we]))}($,S,oe):$(oe);return te=null,ne?oe.toString(ne):oe}}}function O(){var h=[].slice.call(arguments).join(" ");throw new Error([h,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}B.fill(0),o.createHash=function(h){return Q(h)},o.createHmac=Q,o.randomBytes=function(h,S){if(!S||!S.call)return new N(P(h));try{S.call(this,void 0,new N(P(h)))}catch($){S($)}};var p,f=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],I=function(h){o[h]=function(){O("sorry,",h,"is not implemented yet")}};for(p in f)I(f[p])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){var N=t("./helpers");function M(O,p){O[p>>5]|=128<<p%32,O[14+(p+64>>>9<<4)]=p;for(var f=1732584193,I=-271733879,h=-1732584194,S=271733878,$=0;$<O.length;$+=16){var te=f,ne=I,oe=h,Y=S,f=P(f,I,h,S,O[$+0],7,-680876936),S=P(S,f,I,h,O[$+1],12,-389564586),h=P(h,S,f,I,O[$+2],17,606105819),I=P(I,h,S,f,O[$+3],22,-1044525330);f=P(f,I,h,S,O[$+4],7,-176418897),S=P(S,f,I,h,O[$+5],12,1200080426),h=P(h,S,f,I,O[$+6],17,-1473231341),I=P(I,h,S,f,O[$+7],22,-45705983),f=P(f,I,h,S,O[$+8],7,1770035416),S=P(S,f,I,h,O[$+9],12,-1958414417),h=P(h,S,f,I,O[$+10],17,-42063),I=P(I,h,S,f,O[$+11],22,-1990404162),f=P(f,I,h,S,O[$+12],7,1804603682),S=P(S,f,I,h,O[$+13],12,-40341101),h=P(h,S,f,I,O[$+14],17,-1502002290),f=C(f,I=P(I,h,S,f,O[$+15],22,1236535329),h,S,O[$+1],5,-165796510),S=C(S,f,I,h,O[$+6],9,-1069501632),h=C(h,S,f,I,O[$+11],14,643717713),I=C(I,h,S,f,O[$+0],20,-373897302),f=C(f,I,h,S,O[$+5],5,-701558691),S=C(S,f,I,h,O[$+10],9,38016083),h=C(h,S,f,I,O[$+15],14,-660478335),I=C(I,h,S,f,O[$+4],20,-405537848),f=C(f,I,h,S,O[$+9],5,568446438),S=C(S,f,I,h,O[$+14],9,-1019803690),h=C(h,S,f,I,O[$+3],14,-187363961),I=C(I,h,S,f,O[$+8],20,1163531501),f=C(f,I,h,S,O[$+13],5,-1444681467),S=C(S,f,I,h,O[$+2],9,-51403784),h=C(h,S,f,I,O[$+7],14,1735328473),f=X(f,I=C(I,h,S,f,O[$+12],20,-1926607734),h,S,O[$+5],4,-378558),S=X(S,f,I,h,O[$+8],11,-2022574463),h=X(h,S,f,I,O[$+11],16,1839030562),I=X(I,h,S,f,O[$+14],23,-35309556),f=X(f,I,h,S,O[$+1],4,-1530992060),S=X(S,f,I,h,O[$+4],11,1272893353),h=X(h,S,f,I,O[$+7],16,-155497632),I=X(I,h,S,f,O[$+10],23,-1094730640),f=X(f,I,h,S,O[$+13],4,681279174),S=X(S,f,I,h,O[$+0],11,-358537222),h=X(h,S,f,I,O[$+3],16,-722521979),I=X(I,h,S,f,O[$+6],23,76029189),f=X(f,I,h,S,O[$+9],4,-640364487),S=X(S,f,I,h,O[$+12],11,-421815835),h=X(h,S,f,I,O[$+15],16,530742520),f=B(f,I=X(I,h,S,f,O[$+2],23,-995338651),h,S,O[$+0],6,-198630844),S=B(S,f,I,h,O[$+7],10,1126891415),h=B(h,S,f,I,O[$+14],15,-1416354905),I=B(I,h,S,f,O[$+5],21,-57434055),f=B(f,I,h,S,O[$+12],6,1700485571),S=B(S,f,I,h,O[$+3],10,-1894986606),h=B(h,S,f,I,O[$+10],15,-1051523),I=B(I,h,S,f,O[$+1],21,-2054922799),f=B(f,I,h,S,O[$+8],6,1873313359),S=B(S,f,I,h,O[$+15],10,-30611744),h=B(h,S,f,I,O[$+6],15,-1560198380),I=B(I,h,S,f,O[$+13],21,1309151649),f=B(f,I,h,S,O[$+4],6,-145523070),S=B(S,f,I,h,O[$+11],10,-1120210379),h=B(h,S,f,I,O[$+2],15,718787259),I=B(I,h,S,f,O[$+9],21,-343485551),f=Q(f,te),I=Q(I,ne),h=Q(h,oe),S=Q(S,Y)}return Array(f,I,h,S)}function b(O,p,f,I,h,S){return Q((p=Q(Q(p,O),Q(I,S)))<<h|p>>>32-h,f)}function P(O,p,f,I,h,S,$){return b(p&f|~p&I,O,p,h,S,$)}function C(O,p,f,I,h,S,$){return b(p&I|f&~I,O,p,h,S,$)}function X(O,p,f,I,h,S,$){return b(p^f^I,O,p,h,S,$)}function B(O,p,f,I,h,S,$){return b(f^(p|~I),O,p,h,S,$)}function Q(O,p){var f=(65535&O)+(65535&p);return(O>>16)+(p>>16)+(f>>16)<<16|65535&f}n.exports=function(O){return N.hash(O,M,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){n.exports=function(N){for(var M,b=new Array(N),P=0;P<N;P++)!(3&P)&&(M=4294967296*Math.random()),b[P]=M>>>((3&P)<<3)&255;return b}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){var N=t("./helpers");function M(C,X){C[X>>5]|=128<<24-X%32,C[15+(X+64>>9<<4)]=X;for(var B,Q,O,p=Array(80),f=1732584193,I=-271733879,h=-1732584194,S=271733878,$=-1009589776,te=0;te<C.length;te+=16){for(var ne=f,oe=I,Y=h,ge=S,we=$,de=0;de<80;de++){p[de]=de<16?C[te+de]:P(p[de-3]^p[de-8]^p[de-14]^p[de-16],1);var ae=b(b(P(f,5),(ae=I,Q=h,O=S,(B=de)<20?ae&Q|~ae&O:!(B<40)&&B<60?ae&Q|ae&O|Q&O:ae^Q^O)),b(b($,p[de]),(B=de)<20?1518500249:B<40?1859775393:B<60?-1894007588:-899497514)),$=S,S=h,h=P(I,30),I=f,f=ae}f=b(f,ne),I=b(I,oe),h=b(h,Y),S=b(S,ge),$=b($,we)}return Array(f,I,h,S,$)}function b(C,X){var B=(65535&C)+(65535&X);return(C>>16)+(X>>16)+(B>>16)<<16|65535&B}function P(C,X){return C<<X|C>>>32-X}n.exports=function(C){return N.hash(C,M,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){function N(X,B){var Q=(65535&X)+(65535&B);return(X>>16)+(B>>16)+(Q>>16)<<16|65535&Q}function M(X,B){var Q,O=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),p=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),f=new Array(64);X[B>>5]|=128<<24-B%32,X[15+(B+64>>9<<4)]=B;for(var I,h,S=0;S<X.length;S+=16){for(var $=p[0],te=p[1],ne=p[2],oe=p[3],Y=p[4],ge=p[5],we=p[6],de=p[7],ae=0;ae<64;ae++)f[ae]=ae<16?X[ae+S]:N(N(N((h=f[ae-2],P(h,17)^P(h,19)^C(h,10)),f[ae-7]),(h=f[ae-15],P(h,7)^P(h,18)^C(h,3))),f[ae-16]),Q=N(N(N(N(de,P(h=Y,6)^P(h,11)^P(h,25)),Y&ge^~Y&we),O[ae]),f[ae]),I=N(P(I=$,2)^P(I,13)^P(I,22),$&te^$&ne^te&ne),de=we,we=ge,ge=Y,Y=N(oe,Q),oe=ne,ne=te,te=$,$=N(Q,I);p[0]=N($,p[0]),p[1]=N(te,p[1]),p[2]=N(ne,p[2]),p[3]=N(oe,p[3]),p[4]=N(Y,p[4]),p[5]=N(ge,p[5]),p[6]=N(we,p[6]),p[7]=N(de,p[7])}return p}var b=t("./helpers"),P=function(X,B){return X>>>B|X<<32-B},C=function(X,B){return X>>>B};n.exports=function(X){return b.hash(X,M,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){o.read=function(N,M,b,P,S){var X,B,Q=8*S-P-1,O=(1<<Q)-1,p=O>>1,f=-7,I=b?S-1:0,h=b?-1:1,S=N[M+I];for(I+=h,X=S&(1<<-f)-1,S>>=-f,f+=Q;0<f;X=256*X+N[M+I],I+=h,f-=8);for(B=X&(1<<-f)-1,X>>=-f,f+=P;0<f;B=256*B+N[M+I],I+=h,f-=8);if(X===0)X=1-p;else{if(X===O)return B?NaN:1/0*(S?-1:1);B+=Math.pow(2,P),X-=p}return(S?-1:1)*B*Math.pow(2,X-P)},o.write=function(N,M,b,P,C,$){var B,Q,O=8*$-C-1,p=(1<<O)-1,f=p>>1,I=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,h=P?0:$-1,S=P?1:-1,$=M<0||M===0&&1/M<0?1:0;for(M=Math.abs(M),isNaN(M)||M===1/0?(Q=isNaN(M)?1:0,B=p):(B=Math.floor(Math.log(M)/Math.LN2),M*(P=Math.pow(2,-B))<1&&(B--,P*=2),2<=(M+=1<=B+f?I/P:I*Math.pow(2,1-f))*P&&(B++,P/=2),p<=B+f?(Q=0,B=p):1<=B+f?(Q=(M*P-1)*Math.pow(2,C),B+=f):(Q=M*Math.pow(2,f-1)*Math.pow(2,C),B=0));8<=C;N[b+h]=255&Q,h+=S,Q/=256,C-=8);for(B=B<<C|Q,O+=C;0<O;N[b+h]=255&B,h+=S,B/=256,O-=8);N[b+h-S]|=128*$}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,o){(function(r,l,d,y,m,_,x,A,G){var N,M,b;function P(){}(r=n.exports={}).nextTick=(M=typeof window<"u"&&window.setImmediate,b=typeof window<"u"&&window.postMessage&&window.addEventListener,M?function(C){return window.setImmediate(C)}:b?(N=[],window.addEventListener("message",function(C){var X=C.source;X!==window&&X!==null||C.data!=="process-tick"||(C.stopPropagation(),0<N.length&&N.shift()())},!0),function(C){N.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=P,r.addListener=P,r.once=P,r.off=P,r.removeListener=P,r.removeAllListeners=P,r.emit=P,r.binding=function(C){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(zi);var Jr=zi.exports;const Ft=Gn(Jr);class Qr{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Ft(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Ft(e):String(e)]}getValue(e){return this.cache[this.useHash?Ft(e):String(e)]}isCached(e){return(this.useHash?Ft(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Rt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Ki(i,e){return i.x==e.x&&i.y==e.y}function Bt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function Nn(i,e){return(i%e+e)%e}async function eo(i){i?await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${w.EXTENSIONID}/hasAutohide`],value:void 0}],roles:["GM"]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"}],roles:["GM"]}}],async onClick(e){const t=e.items.every(n=>n.metadata[`${w.EXTENSIONID}/hasAutohide`]===void 0);await F.scene.items.updateItems(e.items,n=>{for(const o of n)t?o.metadata[`${w.EXTENSIONID}/hasAutohide`]=!0:delete o.metadata[`${w.EXTENSIONID}/hasAutohide`]})}}):await F.contextMenu.remove(`${w.EXTENSIONID}/toggle-autohide-menu`)}async function to(){await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"&&"},{key:["metadata",`${w.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"||"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${w.EXTENSIONID}/hasVision`]===void 0);await F.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${w.EXTENSIONID}/hasVision`]=!0,n.metadata[`${w.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${w.EXTENSIONID}/visionRange`]=w.VISIONDEFAULT)):delete n.metadata[`${w.EXTENSIONID}/hasVision`]})}}),await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${w.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await F.scene.items.getItemAttachments(e);await F.scene.items.updateItems(t,n=>{for(const o of n)e.includes(o.attachedTo)&&(o.metadata[`${w.EXTENSIONID}/hasVision`]&&(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")?delete o.metadata[`${w.EXTENSIONID}/hasVision`]:(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")&&(o.metadata[`${w.EXTENSIONID}/hasVision`]=!0,o.metadata[`${w.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${w.EXTENSIONID}/visionRange`]=w.VISIONDEFAULT)))})}}}),await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${w.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${w.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${w.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${w.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await F.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${w.EXTENSIONID}/isVisionLine`]&&t.metadata[`${w.EXTENSIONID}/disabled`]?delete t.metadata[`${w.EXTENSIONID}/disabled`]:t.metadata[`${w.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${w.EXTENSIONID}/disabled`]=!0)})}}),await F.contextMenu.create({id:`${w.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${w.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${w.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${w.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${w.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${w.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${w.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${w.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await F.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${w.EXTENSIONID}/isVisionLine`]||t.metadata[`${w.ARMINDOID}/isVisionLine`])&&(t.metadata[`${w.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${w.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${w.EXTENSIONID}/oneSided`],delete t.metadata[`${w.ARMINDOID}/oneSided`]):(t.metadata[`${w.EXTENSIONID}/isVisionLine`]||t.metadata[`${w.ARMINDOID}/isVisionLine`])&&(t.metadata[`${w.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${w.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${w.EXTENSIONID}/oneSided`]="right",t.metadata[`${w.ARMINDOID}/oneSided`]="right"):(t.metadata[`${w.EXTENSIONID}/isVisionLine`]||t.metadata[`${w.ARMINDOID}/isVisionLine`])&&(t.metadata[`${w.EXTENSIONID}/oneSided`]="left",t.metadata[`${w.ARMINDOID}/oneSided`]="left")})}}),await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"}]}}],async onClick(i){i.items.length>0&&await F.scene.items.updateItems(i.items,e=>{for(let t=0;t<e.length;t++)e[t].zIndex=1,e[t].layer="FOG",e[t].disableHit=!0,e[t].locked=!1,e[t].visible=!1,e[t].metadata[`${w.EXTENSIONID}/isBackgroundMap`]=!0})}})}async function no(){await F.tool.create({id:`${w.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await F.tool.activateTool(`${w.EXTENSIONID}/vision-tool`)}})}async function io(){await F.tool.createMode({id:`${w.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${w.EXTENSIONID}/vision-tool`]}}],onToolClick:Tn.onToolClick,onToolMove:Tn.onToolMove,onKeyDown:Tn.onKeyDown}),await F.tool.createMode({id:`${w.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${w.EXTENSIONID}/vision-tool`]}}],onToolClick:On.onToolClick,onToolMove:On.onToolMove,onKeyDown:On.onKeyDown})}function ro(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function oo(i){let e=[];for(const t of i)for(let n=0;n<t.points.length-1;n++){let o,r;const l=Be.fromItem(t),d=Be.fromPosition(t.points[n]),y=Be.fromPosition(t.points[n+1]);o=Be.decompose(Be.multiply(l,d)).position,r=Be.decompose(Be.multiply(l,y)).position,e.push({startPosition:o,endPosition:r,originalShape:t,oneSided:t.metadata[`${w.EXTENSIONID}/oneSided`]})}return e}function ao(i,e,t,n,o,r){let l=[],d=[t,n];const y=R.players.filter(P=>P.role=="GM"),m=R.metadata[`${w.EXTENSIONID}/quality`]!="accurate",_=e.some(xt);for(const P of e){const C=R.userId===P.createdUserId,X=y.some(p=>p.id==P.createdUserId);if(!C&&R.role!=="GM"&&!X)continue;const B=P.metadata[`${w.EXTENSIONID}/visionRange`],Q=mt.getValue(P.id);if(l.push([]),Q!==void 0&&Ki(Q.player.position,P.position)&&Q.player.metadata[`${w.EXTENSIONID}/visionRange`]===B)continue;let O=1e3*R.gridDpi;B&&(O=R.gridDpi*(B/R.gridScale+.5));for(const p of i){const f=(P.position.x-p.startPosition.x)*(p.endPosition.y-p.startPosition.y)-(P.position.y-p.startPosition.y)*(p.endPosition.x-p.startPosition.x);if(p.oneSided!==void 0&&(p.oneSided=="right"&&f>0||p.oneSided=="left"&&f<0))continue;let I=p.startPosition.x,h=p.startPosition.y,S=p.endPosition.x,$=p.endPosition.y;if(I<o[0]||h<o[1]||I>o[0]+d[0]||h>o[1]+d[1]||S<o[0]||$<o[1]||S>o[0]+d[0]||$>o[1]+d[1])continue;if(m&&(!_||xt(P))){const se=[p.startPosition,p.endPosition],Oe=jt.distance(p.startPosition,p.endPosition),qe=Math.floor(Oe/(O/3));for(let D=1;D<qe;D++)se.push(jt.lerp(p.startPosition,p.endPosition,D/qe));let $e=!0;for(const D of se)jt.compare(P.position,D,O)&&($e=!1);if($e)continue}const te={x:p.startPosition.x-P.position.x,y:p.startPosition.y-P.position.y},ne={x:p.endPosition.x-P.position.x,y:p.endPosition.y-P.position.y};var x={x:0,y:0},A={x:0,y:0},G=0,N=0,M=0,b=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
te.x<0?G=o[0]*r[0]:G=(t+o[0])*r[0],te.y<0?N=o[1]*r[1]:N=(n+o[1])*r[1],ne.x<0?M=o[0]*r[0]:M=(t+o[0])*r[0],ne.y<0?b=o[1]*r[1]:b=(n+o[1])*r[1];const oe=[],Y=[];if(te.x!=0){const se=te.y/te.x,Oe=p.startPosition.y-se*p.startPosition.x;oe.push({x:G,y:se*G+Oe})}if(te.y!=0){const se=te.x/te.y,Oe=se*p.startPosition.y-p.startPosition.x;oe.push({x:se*N-Oe,y:N})}if(ne.x!=0){const se=ne.y/ne.x,Oe=p.endPosition.y-se*p.endPosition.x;Y.push({x:M,y:se*M+Oe})}if(ne.y!=0){const se=ne.x/ne.y,Oe=se*p.endPosition.y-p.endPosition.x;Y.push({x:se*b-Oe,y:b})}oe.length==1||Rt(oe[0],p.startPosition)<Rt(oe[1],p.startPosition)?x=oe[0]:x=oe[1],Y.length==1||Rt(Y[0],p.endPosition)<Rt(Y[1],p.endPosition)?A=Y[0]:A=Y[1];const ge=[{x:p.startPosition.x,y:p.startPosition.y},x,A,{x:p.endPosition.x,y:p.endPosition.y}],we=[{x:(t+o[0])*r[0],y:o[1]*r[1]},{x:(t+o[0])*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:o[1]*r[1]}],de=[0,0];let ae=0;for(const se of[x,A])Bt(se.y,o[1]*r[1])?de[ae]=0:Bt(se.y,(n+o[1])*r[1])?de[ae]=2:Bt(se.x,o[0]*r[0])?de[ae]=3:Bt(se.x,(t+o[0])*r[0])&&(de[ae]=1),ae++;let ye=Math.sign(f);ye=ye==0?1:-ye;const Xe=ye==1?de[1]:Nn(de[1]-1,4);for(let se=de[0]+(ye==1?0:-1);Nn(se,4)!=Xe;se+=ye)ge.splice(ge.length-2,0,we[Nn(se,4)]);l[l.length-1].push({pointset:ge,fromShape:p.originalShape})}}return l}var xe,ut=!1;const mt=new Qr(!1);async function so(i){if(ut=!0,xe||(xe=await Hr({locateFile:()=>Wr})),!await F.scene.isReady()){mt.invalidate((D,c)=>c.shadowPath.delete()),ut=!1;return}const e=[];for(let D=0;D<=6;D++)e.push(new Bn);e[1].start();const{awaitTimer:t,computeTimer:n,metadata:o,visionShapes:r,tokensWithVision:l,invalidateCache:d}=i.detail;let y=i.detail.size,m=i.detail.offset,_=i.detail.scale,[x,A]=y;if(R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]===!0){const D=await F.scene.items.getItems(g=>g.layer==="MAP"&&Fi(g));let c=[];for(let g of D){let T=R.gridDpi/g.grid.dpi,U=g.position.x-T*g.grid.offset.x*g.scale.x,H=g.position.y-T*g.grid.offset.y*g.scale.y,W=U+T*g.image.width*g.scale.x,ie=H+T*g.image.height*g.scale.y;c.length?(U<c[0]&&(c[0]=U),H<c[1]&&(c[1]=H),W>c[2]&&(c[2]=W),ie>c[3]&&(c[3]=ie)):(c[0]=U,c[1]=H,c[2]=W,c[3]=ie)}m=[c[0],c[1]],y=[c[2]-c[0],c[3]-c[1]],_=[1,1],[x,A]=y}let N=0,M=0;if(d&&mt.invalidate((D,c)=>c.shadowPath.delete()),n.resume(),!(o[`${w.EXTENSIONID}/visionEnabled`]===!0)||l.length==0){const D=await F.scene.local.getItems(Rn);await F.scene.local.deleteItems(D.map(c=>c.id)),ut=!1;return}const P=oo(r),C=ao(P,l,x,A,m,_);if(C.length==0){ut=!1;return}const X=[];e[1].pause(),e[2].start();const B={};for(let D=0;D<C.length;D++){const c=l[D];let g=mt.getValue(c.id);if(g!==void 0&&Ki(g.player.position,c.position)&&g.player.metadata[`${w.EXTENSIONID}/visionRange`]===c.metadata[`${w.EXTENSIONID}/visionRange`]){B[D]=g.shadowPath.copy(),N++;continue}M++;const T=C[D],U=new xe.SkOpBuilder,H=xe.NewPath().rect(m[0],m[1],y[0],y[1]);U.add(H,xe.PathOp.UNION),H.delete();for(const ie of T){const ce=ie.fromShape,fe=xe.NewPath();fe.moveTo(ie.pointset[0].x,ie.pointset[0].y);for(let Ae=1;Ae<ie.pointset.length;Ae++)fe.lineTo(ie.pointset[Ae].x,ie.pointset[Ae].y);if(ce.style.closed!=!1){const Ae=xe.NewPath();Ae.moveTo(ce.points[0].x*ce.scale.x+ce.position.x,ce.points[0].y*ce.scale.y+ce.position.y);for(let Pe=1;Pe<ce.points.length-1;Pe++)Ae.lineTo(ce.points[Pe].x*ce.scale.x+ce.position.x,ce.points[Pe].y*ce.scale.y+ce.position.y);fe.op(Ae,xe.PathOp.DIFFERENCE),Ae.delete()}U.add(fe,xe.PathOp.DIFFERENCE),fe.delete()}const W=U.resolve();if(!W){console.error("Couldn't compute fog"),ut=!1;return}if(U.delete(),W!==void 0){W.simplify(),B[D]=W;let ie=mt.getValue(c.id);ie!==void 0&&ie.shadowPath.delete(),mt.cacheValue(c.id,{shadowPath:W.copy(),player:c})}}e[2].pause(),e[3].start();const Q=[],O=xe.NewPath();for(let D=0;D<l.length;D++){const c=l[D],g=c.metadata[`${w.EXTENSIONID}/visionRange`],T=R.players.filter(W=>W.role=="GM"),U=R.userId===l[D].createdUserId,H=T.some(W=>W.id==l[D].createdUserId);if(xt(c)?Q[D]=!0:O.op(B[D],xe.PathOp.UNION),g){if(!U&&R.role!=="GM"&&!H)continue;const W=R.gridDpi*(g/R.gridScale+.5),ie=xe.NewPath().ellipse(c.position.x,c.position.y,W,W,0,0,2*Math.PI);B[D]?.op(ie,xe.PathOp.INTERSECT),ie.delete();const ce=R.players.find(fe=>fe.id===c.createdUserId);if(ce&&R.role==="GM"&&!xt(c)){const fe=yt().strokeColor(ce.color).fillOpacity(0).position({x:c.position.x,y:c.position.y}).width(W*2).height(W*2).shapeType("CIRCLE").metadata({[`${w.EXTENSIONID}/isIndicatorRing`]:!0}).build();X.push(fe)}}}O.simplify();for(let D=0;D<Q.length;D++)Q[D]===!0&&(B[D].op(O,xe.PathOp.INTERSECT),B[D].simplify());O.delete(),e[3].pause(),e[4].start();const p=[],f=[],I=R.metadata[`${w.EXTENSIONID}/persistenceEnabled`]===!0,h=R.metadata[`${w.EXTENSIONID}/fowEnabled`]===!0,S=xe.NewPath(),$={},te=await F.scene.local.getItems(Rn),ne=await F.scene.local.getItems(Fr);h&&S.rect(m[0],m[1],y[0],y[1]);let oe=I&&R.metadata[`${w.EXTENSIONID}/quality`]!="accurate",Y=[],ge;if(oe)if(Y=await F.scene.local.getItems(gt),ge=new xe.SkOpBuilder,$.reuse=!0,Y.length===0){const D=Tt().commands([]).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${w.EXTENSIONID}/isVisionFog`]:!0,[`${w.EXTENSIONID}/digest`]:"reuse"}).build();D.zIndex=3,await F.scene.local.addItems([D]),Y=await F.scene.local.getItems(gt)}else{let D=xe.FromCmds(Y[0].commands);ge.add(D,xe.PathOp.UNION),D.delete()}const we=new xe.SkOpBuilder;let de=!1;for(const D of Object.keys(B)){const c=B[D],T=new TextEncoder().encode(c.toCmds().toString()),U=await crypto.subtle.digest("SHA-1",T).then(W=>[...new Uint8Array(W)].map(ie=>ie.toString(16).padStart(2,"0")).join(""));te.filter(W=>gt(W)&&W.metadata[`${w.EXTENSIONID}/digest`]===U).length===0?oe?ge.add(c,xe.PathOp.UNION):p.push({cmds:c.toCmds(),visible:!1,zIndex:3,playerId:l[D].id,digest:U}):$[U]=!0,h&&(S.op(c,xe.PathOp.DIFFERENCE),R.role==="GM"&&(de=!0,we.add(c,xe.PathOp.UNION))),c.delete()}const ae=R.metadata[`${w.EXTENSIONID}/sceneId`];if(oe){const D=ge.resolve();D.setFillType(xe.FillType.EVENODD);const c=D.toCmds();await F.scene.local.updateItems([Y[0].id],g=>{g[0].commands=c});try{localStorage.setItem(`${w.EXTENSIONID}/fogCache/${R.userId}/${ae}`,JSON.stringify([{digest:"reuse",commands:c}]))}catch{}D.delete(),ge.delete()}else if(I){const D=te.filter(gt);try{localStorage.setItem(`${w.EXTENSIONID}/fogCache/${R.userId}/${ae}`,JSON.stringify(D.map(c=>({digest:c.metadata[`${w.EXTENSIONID}/digest`],commands:c.commands}))))}catch{}}let ye;de&&(ye=we.resolve()),we.delete();const Xe=te.filter(Ut),se=te.filter(D=>{const c=D.metadata[`${w.EXTENSIONID}/digest`];return gt(D)&&$[c]===void 0});if(h){let D=R.metadata[`${w.EXTENSIONID}/fowColor`]?R.metadata[`${w.EXTENSIONID}/fowColor`]:"#00000088",c=.5;D.length==9&&(c=Number.parseInt(D.substring(7),16)/255,D=D.substring(0,7));const g=Tt().commands(S.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(D).fillOpacity(c).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${w.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();g.disableHit=!0,Xe.length>0?F.scene.local.updateItems(Ut,T=>{for(const U of T)U.commands=g.commands},!1):f.push(F.scene.local.addItems([g]))}else f.push(F.scene.local.deleteItems(te.filter(Ut).map(D=>D.id)));S.delete(),e[4].pause(),e[5].start(),n.pause(),t.resume(),f.push(F.scene.local.deleteItems(ne.map(D=>D.id))),f.push(F.scene.local.addItems(p.map(D=>{const c=Tt().commands(D.cmds).locked(!0).visible(D.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${w.EXTENSIONID}/isVisionFog`]:!0,[`${w.EXTENSIONID}/digest`]:D.digest}).build();return c.zIndex=D.zIndex,c}))),I||f.push(F.scene.local.deleteItems(se.map(D=>D.id))),X.length>0&&f.push(F.scene.local.addItems(X)),R.fog.filled||f.push(F.scene.fog.setFilled(!0)),await Promise.all(f);let Oe=0;e[5].pause(),e[6].start(),de&&(lo(ye),ye.delete()),e[6].pause();const[Ke,qe]=[t.stop(),n.stop()],$e={compute_time:`${qe} ms`,communication_time:`${Ke} ms`,cache_hits:N.toString(),cache_misses:M.toString(),item_counter:Oe.toString()};for(let D=1;D<=6;D++){const c=e[D].stop();$e["stage"+D]=`${c} ms`}ro($e),ut=!1}document.addEventListener("updateVision",so);async function lo(i){const e=[],t=R.items.filter(n=>Xi(n)&&Fi(n));i.simplify();for(const n of t){const o=new xe.SkOpBuilder,r=xe.NewPath(),l=R.gridDpi/n.grid.dpi*(n.image.width/2)*n.scale.x;for(let m=0;m<6;m++){const _=m*60*Math.PI/180,x=n.position.x+l*Math.cos(_),A=n.position.y+l*Math.sin(_);m==0?r.moveTo(x,A):r.lineTo(x,A)}r.closePath(),o.add(r,xe.PathOp.UNION),o.add(i,xe.PathOp.INTERSECT);const d=o.resolve(),y=!d.toCmds().length;n.visible==y&&e.push(n),r.delete(),o.delete(),d.delete()}await F.scene.items.updateItems(e.map(n=>n.id),n=>{for(let o=0;o<n.length;o++)n[o].visible=!n[o].visible})}let kn,co,gi,_t=[],mi,xn,vi,yi,Ii,wi;async function ht(i){if(ut||!await F.scene.isReady())return;document.querySelector("#debug_div");const[e,t]=[new Bn,new Bn];e.start(),e.pause(),t.start();const n=R.players.filter(f=>f.role=="GM"),o=R.items.filter(f=>(f.layer=="CHARACTER"||f.layer=="ATTACHMENT")&&n.some(I=>f.createdUserId===I.id)&&(f.metadata[`${w.EXTENSIONID}/hasVision`]||f.metadata[`${w.ARMINDOID}/hasVision`])&&!f.metadata[`${w.EXTENSIONID}/visionBlind`]),l=(R.role=="GM"?R.items.filter(Br):R.items.filter(Xr).concat(o)).filter(f=>!xt(f)||f.visible===!0),d=R.items.filter(Rr),y=R.items.filter(Xi),m=R.items.filter(Bi)?.[0],_=R.metadata[`${w.EXTENSIONID}/visionEnabled`]===!0,x=R.metadata[`${w.EXTENSIONID}/persistenceEnabled`]===!0,A=R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]===!0,G=R.metadata[`${w.EXTENSIONID}/fowEnabled`]===!0,N=R.metadata[`${w.EXTENSIONID}/fowColor`],M=[],b=[],P=[];if(m===void 0?(M[0]=0,M[1]=0,b[0]=1,b[1]=1,P[0]=0,P[1]=0):(M[0]=m.width*m.scale.x,M[1]=m.height*m.scale.y,b[0]=m.scale.x,b[1]=m.scale.y,P[0]=m.position.x,P[1]=m.position.y),R.role=="GM"){const f=document.getElementById("mapHeight"),I=document.getElementById("mapWidth");I.value=(Math.round(M[0])/R.gridDpi).toString(),f.value=(Math.round(M[1])/R.gridDpi).toString()}const C=JSON.stringify(d),X=JSON.stringify(y),B=JSON.stringify(l),Q=JSON.stringify(m);if(Q==xn&&_==mi&&wi==N&&vi==A&&yi==G&&Ii==x&&kn==C&&co==X&&gi==B&&M[0]==_t[0]&&M[1]==_t[1]&&i!==!0)return;let O=!1;(Q!=xn||kn!=C||M[0]!=_t[0]||M[1]!=_t[1])&&(O=!0),xn=Q,gi=B,kn=C,_t=M,mi=_,vi=A,yi=G,wi=N,Ii=x,t.pause();const p=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:R.items,metadata:R.metadata,size:M,offset:P,scale:b,tokensWithVision:l,visionShapes:d,invalidateCache:O}});ut||document.dispatchEvent(p)}async function uo(){await F.contextMenu.create({id:`${w.EXTENSIONID}/toggle-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${w.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${w.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${w.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${w.EXTENSIONID}/isDoor`]===void 0);await F.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${w.EXTENSIONID}/isDoor`]=!0:delete n.metadata[`${w.EXTENSIONID}/isDoor`]}),e?await nn(i.items):await fo(i.items)}})}async function fo(i){const e=await F.scene.local.getItems(n=>n.metadata[`${w.EXTENSIONID}/doorId`]!==void 0),t=[];for(let n of e){let o=!1;for(const r of i)n.metadata[`${w.EXTENSIONID}/doorId`]==r.id&&(o=!0);o&&t.push(n.id)}await F.scene.local.deleteItems(t)}async function nn(i){const e=[],t=await F.scene.local.getItems(n=>n.metadata[`${w.EXTENSIONID}/doorId`]!==void 0);for(const n of i){if(!Pr(n)||t.some(l=>l.metadata[`${w.EXTENSIONID}/doorId`]===n.id))continue;const o=Be.fromItem(n),r=[];for(let l=0;l<n.points.length;l++){const d=Be.fromPosition(n.points[l]);r.push(Be.decompose(Be.multiply(o,d)).position)}e.push(Tt().locked(!0).commands(Yi(n.metadata[`${w.EXTENSIONID}/disabled`]===!0)).scale({x:.2,y:.2}).name("Door").position(jt.centroid(r)).metadata({[`${w.EXTENSIONID}/doorId`]:n.id}).build())}F.scene.local.addItems(e)}async function po(i){const e=await F.scene.local.getItems(t=>t.id===i&&t.metadata[`${w.EXTENSIONID}/doorId`]!==void 0);if(e.length===1){const t=e[0].metadata[`${w.EXTENSIONID}/doorId`],n=R.items.filter(r=>r.id===t);let o=!1;await F.scene.items.updateItems(n,r=>{const l=r[0];l.metadata[`${w.EXTENSIONID}/isVisionLine`]&&l.metadata[`${w.EXTENSIONID}/disabled`]?(delete l.metadata[`${w.EXTENSIONID}/disabled`],o=!1):l.metadata[`${w.EXTENSIONID}/isVisionLine`]&&(l.metadata[`${w.EXTENSIONID}/disabled`]=!0,o=!0)}),await F.scene.local.updateItems([e[0].id],r=>{const l=r[0];Cr(l)&&(l.commands=Yi(o))}),await F.player.deselect([i])}}async function ho(){const i=await F.scene.items.getItems(e=>e.metadata[`${w.EXTENSIONID}/isDoor`]===!0);nn(i)}function Yi(i){return i?[[0,-65.35400390625,-250],[1,-65.35400390625,-228.27999877929688],[1,-150.29598999023438,-228.27999877929688],[1,-150.29598999023438,205.0780029296875],[1,-118.89300537109375,205.0780029296875],[1,-118.89300537109375,-196.8769989013672],[1,-65.35400390625,-196.8769989013672],[1,-65.35400390625,242.5],[1,142.79598999023438,205.0780029296875],[1,142.79598999023438,143.84298706054688],[1,142.79598999023438,-212.5],[5],[0,-27.06201171875,13.128997802734375],[4,-34.05900573730469,13.128997802734375,-39.73200988769531,5.7480010986328125,-39.73200988769531,-3.35699462890625],[4,-39.73200988769531,-12.46099853515625,-34.05900573730469,-19.841995239257812,-27.06201171875,-19.841995239257812],[4,-20.065017700195312,-19.841995239257812,-14.392013549804688,-12.46099853515625,-14.392013549804688,-3.35699462890625],[4,-14.392013549804688,5.7480010986328125,-20.065017700195312,13.128997802734375,-27.06201171875,13.128997802734375],[5]]:[[0,-178.44699096679688,-250],[1,-178.44699096679688,228.08499145507812],[1,157.114013671875,228.66598510742188],[1,157.114013671875,-250],[5],[0,-146.8909912109375,196.5830078125],[1,-146.8909912109375,-218.44200134277344],[1,125.55398559570312,-218.44200134277344],[1,125.55398559570312,-161.62899780273438],[1,114.77301025390625,-161.62899780273438],[1,114.77301025390625,-207.91400146484375],[1,-136.10699462890625,-207.91400146484375],[1,-136.10699462890625,186.55398559570312],[1,114.77398681640625,186.55398559570312],[1,114.77398681640625,140.26998901367188],[1,125.55499267578125,140.26998901367188],[1,125.55499267578125,197.05499267578125],[5],[0,114.77301025390625,-112.54100036621094],[1,125.55401611328125,-112.54100036621094],[1,125.55401611328125,91.17999267578125],[1,114.77301025390625,91.17999267578125],[5],[0,-84.21299743652344,-10.67999267578125],[4,-84.21299743652344,-1.5319976806640625,-91.63099670410156,5.8860015869140625,-100.781005859375,5.8860015869140625],[4,-109.93099975585938,5.8860015869140625,-117.3489990234375,-1.5319976806640625,-117.3489990234375,-10.67999267578125],[4,-117.3489990234375,-19.829986572265625,-109.93099975585938,-27.24798583984375,-100.781005859375,-27.24798583984375],[4,-91.63101196289062,-27.24798583984375,-84.2130126953125,-19.829986572265625,-84.2130126953125,-10.67999267578125],[5]]}function An(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class go{constructor(){this._events=void 0,this._events={}}on(e,t){An(e,n=>{const o=this._events[n]||[];o.push(t),this._events[n]=o})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}An(e,o=>{if(n===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var n=this;An(e,o=>{const r=n._events[o];r!==void 0&&r.forEach(l=>{l.apply(n,t)})})}}function mo(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const o=this,r=[];if(Array.isArray(e))e.forEach(l=>{typeof l=="string"?r.push(l):(o.plugins.settings[l.name]=l.options,r.push(l.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;n=r.shift();)o.require(n)}loadPlugin(e){var t=this,n=t.plugins,o=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const ln=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":yo(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Zi=i=>{if(!vo(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((o,r)=>{if(o===i[r-1]){t++;return}n(),e+=o,t=1}),n(),e},Ji=i=>{let e=qn(i);return ln(e)},vo=i=>new Set(i).size!==i.length,At=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),yo=i=>i.reduce((e,t)=>Math.max(e,Io(t)),0),Io=i=>qn(i).length,qn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const Qi=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return Qi(t).forEach(function(o){let r=o.slice(0);r[0]=i.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(i.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const wo=[[0,65535]],Eo="[-]";let rn,er;const bo=3,zn={},Ei={"/":"",0:"",a:"",aa:"",ae:"",ao:"",au:"",av:"",ay:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",oe:"",oi:"",oo:"",ou:"",p:"",q:"",r:"",s:"",t:"",th:"",tz:"",u:"",v:"",vy:"",w:"",y:"",z:"",hv:""};for(let i in Ei){let e=Ei[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);zn[n]=i}}const _o=new RegExp(Object.keys(zn).join("|")+"|"+Eo,"gu"),So=i=>{rn===void 0&&(rn=ko(i||wo))},bi=(i,e="NFKD")=>i.normalize(e),on=i=>qn(i).reduce((e,t)=>e+To(t),""),To=i=>(i=bi(i).toLowerCase().replace(_o,e=>zn[e]||""),bi(i,"NFC"));function*Oo(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let o=String.fromCharCode(n),r=on(o);r!=o.toLowerCase()&&(r.length>bo||r.length!=0&&(yield{folded:r,composed:o,code_point:n}))}}const No=i=>{const e={},t=(n,o)=>{const r=e[n]||new Set,l=new RegExp("^"+Ji(r)+"$","iu");o.match(l)||(r.add(At(o)),e[n]=r)};for(let n of Oo(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},ko=i=>{const e=No(i),t={};let n=[];for(let r in e){let l=e[r];l&&(t[r]=Ji(l)),r.length>1&&n.push(At(r))}n.sort((r,l)=>l.length-r.length);const o=ln(n);return er=new RegExp("^"+o,"u"),t},xo=(i,e=1)=>{let t=0;return i=i.map(n=>(rn[n]&&(t+=n.length),rn[n]||n)),t>=e?Zi(i):""},Ao=(i,e=1)=>(e=Math.max(e,i.length-1),ln(Qi(i).map(t=>xo(t,e)))),_i=(i,e=!0)=>{let t=i.length>1?1:0;return ln(i.map(n=>{let o=[];const r=e?n.length():n.length()-1;for(let l=0;l<r;l++)o.push(Ao(n.substrs[l]||"",t));return Zi(o)}))},Co=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const o=l=>{for(const d of n){if(d.start===l.start&&d.substr===l.substr)return!1;if(!(l.length==1||d.length==1)&&(l.start<d.start&&l.end>d.start||d.start<l.start&&d.end>l.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class an{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new an,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const y of o)n.add(y);let l=t.substr.substring(0,e-r.start),d=l.length;return n.add({start:r.start,end:r.start+d,length:d,substr:l}),n}}const Do=i=>{So(),i=on(i);let e="",t=[new an];for(let n=0;n<i.length;n++){let r=i.substring(n).match(er);const l=i.substring(n,n+1),d=r?r[0]:null;let y=[],m=new Set;for(const _ of t){const x=_.last();if(!x||x.length==1||x.end<=n)if(d){const A=d.length;_.add({start:n,end:n+A,length:A,substr:d}),m.add("1")}else _.add({start:n,end:n+1,length:1,substr:l}),m.add("2");else if(d){let A=_.clone(n,x);const G=d.length;A.add({start:n,end:n+G,length:G,substr:d}),y.push(A)}else m.add("3")}if(y.length>0){y=y.sort((_,x)=>_.length()-x.length());for(let _ of y)Co(_,t)||t.push(_);continue}if(n>0&&m.size==1&&!m.has("3")){e+=_i(t,!1);let _=new an;const x=t[0];x&&_.add(x.last()),t=[_]}}return e+=_i(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Po=(i,e)=>{if(i)return i[e]},$o=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},Cn=(i,e,t)=>{var n,o;return!i||(i=i+"",e.regex==null)||(o=i.search(e.regex),o===-1)?0:(n=e.string.length/i.length,o===0&&(n+=.5),n*t)},Dn=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},We=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Lo=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=on(i+"").toLowerCase(),e=on(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Mo{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var l;return n&&(l=new RegExp("^("+Object.keys(n).map(At).join("|")+"):(.*)$")),r.forEach(d=>{let y,m=null,_=null;l&&(y=d.match(l))&&(m=y[1],d=y[2]),d.length>0&&(this.settings.diacritics?_=Do(d)||null:_=At(d),_&&t&&(_="\\b"+_)),o.push({string:d,regex:_?new RegExp(_,"iu"):null,field:m})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const o=e.options.fields,r=e.weights,l=o.length,d=e.getAttrFn;if(!l)return function(){return 1};const y=function(){return l===1?function(m,_){const x=o[0].field;return Cn(d(_,x),m,r[x]||1)}:function(m,_){var x=0;if(m.field){const A=d(_,m.field);!m.regex&&A?x+=1/l:x+=Cn(A,m,1)}else We(r,(A,G)=>{x+=Cn(d(_,G),m,A)});return x/l}}();return n===1?function(m){return y(t[0],m)}:e.options.conjunction==="and"?function(m){var _,x=0;for(let A of t){if(_=y(A,m),_<=0)return 0;x+=_}return x/n}:function(m){var _=0;return We(t,x=>{_+=y(x,m)}),_/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const o=this,r=e.options,l=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof l=="function")return l.bind(this);const d=function(_,x){return _==="$score"?x.score:e.getAttrFn(o.items[x.id],_)};if(l)for(let m of l)(e.query||m.field!=="$score")&&n.push(m);if(e.query){t=!0;for(let m of n)if(m.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(m=>m.field!=="$score");return n.length?function(m,_){var x,A;for(let G of n)if(A=G.field,x=(G.direction==="desc"?-1:1)*Lo(d(A,m),d(A,_)),x)return x;return 0}:null}prepareSearch(e,t){const n={};var o=Object.assign({},t);if(Dn(o,"sort"),Dn(o,"sort_empty"),o.fields){Dn(o,"fields");const r=[];o.fields.forEach(l=>{typeof l=="string"&&(l={field:l,weight:1}),r.push(l),n[l.field]="weight"in l?l.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:o.nesting?$o:Po}}search(e,t){var n=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const l=t.score||n._getScoreFunction(r);e.length?We(n.items,(y,m)=>{o=l(y),(t.filter===!1||o>0)&&r.items.push({score:o,id:m})}):We(n.items,(y,m)=>{r.items.push({score:1,id:m})});const d=n._getSortFunction(r);return d&&r.items.sort(d),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const vt=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Re=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(tr(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},tr=i=>typeof i=="string"&&i.indexOf("<")>-1,Fo=i=>i.replace(/['"\\]/g,"\\$&"),Pn=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Xt=(i,e)=>{Object.assign(i.style,e)},He=(i,...e)=>{var t=nr(e);i=ir(i),i.map(n=>{t.map(o=>{n.classList.add(o)})})},at=(i,...e)=>{var t=nr(e);i=ir(i),i.map(n=>{t.map(o=>{n.classList.remove(o)})})},nr=i=>{var e=[];return vt(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},ir=i=>(Array.isArray(i)||(i=[i]),i),Ht=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},Si=(i,e=0)=>e>0?i[i.length-1]:i[0],Ro=i=>Object.keys(i).length===0,sn=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},De=(i,e)=>{vt(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},Xn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},Bo=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var l=r.data.match(e);if(l&&r.data.length>0){var d=document.createElement("span");d.className="highlight";var y=r.splitText(l.index);y.splitText(l[0].length);var m=y.cloneNode(!0);return d.appendChild(m),Xn(y,d),1}return 0},n=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(l=>{o(l)})},o=r=>r.nodeType===3?t(r):(n(r),0);o(i)},Xo=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Vo=65,jo=13,rr=27,Vn=37,Uo=38,or=39,Ho=40,Ti=8,Wo=46,jn=9,Go=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),Vt=Go?"metaKey":"ctrlKey";var Oi={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Ze=i=>typeof i>"u"||i===null?null:Wt(i),Wt=i=>typeof i=="boolean"?i?"1":"0":i+"",Gt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),qo=(i,e)=>e>0?setTimeout(i,e):(i.call(null),null),zo=(i,e)=>{var t;return function(n,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[n]=!0,i.call(r,n,o)},e)}},Ni=(i,e,t)=>{var n,o=i.trigger,r={};i.trigger=function(){var l=arguments[0];if(e.indexOf(l)!==-1)r[l]=arguments;else return o.apply(i,arguments)},t.apply(i,[]),i.trigger=o;for(n of e)n in r&&o.apply(i,r[n])},Ko=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),Se=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},Te=(i,e,t,n)=>{i.addEventListener(e,t,n)},ft=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},$n=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},ki=i=>i.replace(/[\\"']/g,"\\$&"),pt=(i,e)=>{e&&i.append(e)};function xi(i,e){var t=Object.assign({},Oi,e),n=t.dataAttr,o=t.labelField,r=t.valueField,l=t.disabledField,d=t.optgroupField,y=t.optgroupLabelField,m=t.optgroupValueField,_=i.tagName.toLowerCase(),x=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!x&&!t.allowEmptyOption){let M=i.querySelector('option[value=""]');M&&(x=M.textContent)}var A={placeholder:x,options:[],optgroups:[],items:[],maxItems:null},G=()=>{var M,b=A.options,P={},C=1;let X=0;var B=p=>{var f=Object.assign({},p.dataset),I=n&&f[n];return typeof I=="string"&&I.length&&(f=Object.assign(f,JSON.parse(I))),f},Q=(p,f)=>{var I=Ze(p.value);if(I!=null&&!(!I&&!t.allowEmptyOption)){if(P.hasOwnProperty(I)){if(f){var h=P[I][d];h?Array.isArray(h)?h.push(f):P[I][d]=[h,f]:P[I][d]=f}}else{var S=B(p);S[o]=S[o]||p.textContent,S[r]=S[r]||I,S[l]=S[l]||p.disabled,S[d]=S[d]||f,S.$option=p,S.$order=S.$order||++X,P[I]=S,b.push(S)}p.selected&&A.items.push(I)}},O=p=>{var f,I;I=B(p),I[y]=I[y]||p.getAttribute("label")||"",I[m]=I[m]||C++,I[l]=I[l]||p.disabled,I.$order=I.$order||++X,A.optgroups.push(I),f=I[m],vt(p.children,h=>{Q(h,f)})};A.maxItems=i.hasAttribute("multiple")?null:1,vt(i.children,p=>{M=p.tagName.toLowerCase(),M==="optgroup"?O(p):M==="option"&&Q(p)})},N=()=>{const M=i.getAttribute(n);if(M)A.options=JSON.parse(M),vt(A.options,P=>{A.items.push(P[r])});else{var b=i.value.trim()||"";if(!t.allowEmptyOption&&!b.length)return;const P=b.split(t.delimiter);vt(P,C=>{const X={};X[o]=C,X[r]=C,A.options.push(X)}),A.items=P}};return _==="select"?G():N(),Object.assign({},Oi,A,e)}var Ai=0;class Ge extends mo(go){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Ai++;var n,o=Re(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);n=r.getPropertyValue("direction");const l=xi(o,t);this.settings=l,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=$n(o,"tomselect-"+Ai),this.isRequired=o.required,this.sifter=new Mo(this.options,{diacritics:l.diacritics}),l.mode=l.mode||(l.maxItems===1?"single":"multi"),typeof l.hideSelected!="boolean"&&(l.hideSelected=l.mode==="multi"),typeof l.hidePlaceholder!="boolean"&&(l.hidePlaceholder=l.mode!=="multi");var d=l.createFilter;typeof d!="function"&&(typeof d=="string"&&(d=new RegExp(d)),d instanceof RegExp?l.createFilter=b=>d.test(b):l.createFilter=b=>this.settings.duplicates||!this.options[b]),this.initializePlugins(l.plugins),this.setupCallbacks(),this.setupTemplates();const y=Re("<div>"),m=Re("<div>"),_=this._render("dropdown"),x=Re('<div role="listbox" tabindex="-1">'),A=this.input.getAttribute("class")||"",G=l.mode;var N;if(He(y,l.wrapperClass,A,G),He(m,l.controlClass),pt(y,m),He(_,l.dropdownClass,G),l.copyClassesToDropdown&&He(_,A),He(x,l.dropdownContentClass),pt(_,x),Re(l.dropdownParent||y).appendChild(_),tr(l.controlInput)){N=Re(l.controlInput);var M=["autocorrect","autocapitalize","autocomplete","spellcheck"];We(M,b=>{o.getAttribute(b)&&De(N,{[b]:o.getAttribute(b)})}),N.tabIndex=-1,m.appendChild(N),this.focus_node=N}else l.controlInput?(N=Re(l.controlInput),this.focus_node=N):(N=Re("<input/>"),this.focus_node=m);this.wrapper=y,this.dropdown=_,this.dropdown_content=x,this.control=m,this.control_input=N,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,o=e.dropdown,r=e.dropdown_content,l=e.wrapper,d=e.control,y=e.input,m=e.focus_node,_={passive:!0},x=e.inputId+"-ts-dropdown";De(r,{id:x}),De(m,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":x});const A=$n(m,e.inputId+"-ts-control"),G="label[for='"+Fo(e.inputId)+"']",N=document.querySelector(G),M=e.focus.bind(e);if(N){Te(N,"click",M),De(N,{for:A});const C=$n(N,e.inputId+"-ts-label");De(m,{"aria-labelledby":C}),De(r,{"aria-labelledby":C})}if(l.style.width=y.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");He([l,o],C)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&De(y,{multiple:"multiple"}),t.placeholder&&De(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+At(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=zo(t.load,t.loadThrottle)),Te(o,"mousemove",()=>{e.ignoreHover=!1}),Te(o,"mouseenter",C=>{var X=Ht(C.target,"[data-selectable]",o);X&&e.onOptionHover(C,X)},{capture:!0}),Te(o,"click",C=>{const X=Ht(C.target,"[data-selectable]");X&&(e.onOptionSelect(C,X),Se(C,!0))}),Te(d,"click",C=>{var X=Ht(C.target,"[data-ts-item]",d);if(X&&e.onItemSelect(C,X)){Se(C,!0);return}n.value==""&&(e.onClick(),Se(C,!0))}),Te(m,"keydown",C=>e.onKeyDown(C)),Te(n,"keypress",C=>e.onKeyPress(C)),Te(n,"input",C=>e.onInput(C)),Te(m,"blur",C=>e.onBlur(C)),Te(m,"focus",C=>e.onFocus(C)),Te(n,"paste",C=>e.onPaste(C));const b=C=>{const X=C.composedPath()[0];if(!l.contains(X)&&!o.contains(X)){e.isFocused&&e.blur(),e.inputState();return}X==n&&e.isOpen?C.stopPropagation():Se(C,!0)},P=()=>{e.isOpen&&e.positionDropdown()};Te(document,"mousedown",b),Te(window,"scroll",P,_),Te(window,"resize",P,_),this._destroy=()=>{document.removeEventListener("mousedown",b),window.removeEventListener("scroll",P),window.removeEventListener("resize",P),N&&N.removeEventListener("click",M)},this.revertSettings={innerHTML:y.innerHTML,tabIndex:y.tabIndex},y.tabIndex=-1,y.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,Te(y,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,y.disabled?e.disable():y.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),He(y,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),We(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,o={optgroup:r=>{let l=document.createElement("div");return l.className="optgroup",l.appendChild(r.options),l},optgroup_header:(r,l)=>'<div class="optgroup-header">'+l(r[n])+"</div>",option:(r,l)=>"<div>"+l(r[t])+"</div>",item:(r,l)=>"<div>"+l(r[t])+"</div>",option_create:(r,l)=>'<div class="create">Add <strong>'+l(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?xi(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Pn(this.input,"input"),Pn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Se(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var o=n.trim().split(t.settings.splitOn);We(o,r=>{Ze(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Se(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),Se(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==jn&&Se(e);return}switch(e.keyCode){case Vo:if(ft(Vt,e)&&t.control_input.value==""){Se(e),t.selectAll();return}break;case rr:t.isOpen&&(Se(e,!0),t.close()),t.clearActiveItems();return;case Ho:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}Se(e);return;case Uo:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}Se(e);return;case jo:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Se(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Se(e);return;case Vn:t.advanceSelection(-1,e);return;case or:t.advanceSelection(1,e);return;case jn:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Se(e)),t.settings.create&&t.createItem()&&Se(e));return;case Ti:case Wo:t.deleteSelection(e);return}t.isInputHidden&&!ft(Vt,e)&&Se(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=qo(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),Se(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(n=t.dataset.value,typeof n<"u"&&(o.lastQuery=null,o.addItem(n),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(Se(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;He(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||at(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Pn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];Ni(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,o,r,l,d,y,m;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(o=t&&t.type.toLowerCase(),o==="click"&&ft("shiftKey",t)&&n.activeItems.length){for(m=n.getLastActive(),l=Array.prototype.indexOf.call(n.control.children,m),d=Array.prototype.indexOf.call(n.control.children,e),l>d&&(y=l,l=d,d=y),r=l;r<=d;r++)e=n.control.children[r],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);Se(t)}else o==="click"&&ft(Vt,t)||o==="keydown"&&ft("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&at(n,"last-active"),He(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),at(e,"active")}clearActiveItems(){at(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,De(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),De(e,{"aria-selected":"true"}),He(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,o=n.clientHeight,r=n.scrollTop||0,l=e.offsetHeight,d=e.getBoundingClientRect().top-n.getBoundingClientRect().top+r;d+l>o+r?this.scroll(d-o+l,t):d<r&&this.scroll(d,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(at(this.activeOption,"active"),De(this.activeOption,{"aria-selected":null})),this.activeOption=null,De(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,We(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(De(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&De(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,o=this,r=this.getSearchOptions();if(o.settings.score&&(n=o.settings.score.call(o,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:n})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(l=>{let d=Ze(l.id);return!(d&&o.items.indexOf(d)!==-1)})),t}refreshOptions(e=!0){var t,n,o,r,l,d,y,m,_,x;const A={},G=[];var N=this,M=N.inputValue();const b=M===N.lastQuery||M==""&&N.lastQuery==null;var P=N.search(M),C=null,X=N.settings.shouldOpen||!1,B=N.dropdown_content;b&&(C=N.activeOption,C&&(_=C.closest("[data-group]"))),r=P.items.length,typeof N.settings.maxOptions=="number"&&(r=Math.min(r,N.settings.maxOptions)),r>0&&(X=!0);const Q=(p,f)=>{let I=A[p];if(I!==void 0){let S=G[I];if(S!==void 0)return[I,S.fragment]}let h=document.createDocumentFragment();return I=G.length,G.push({fragment:h,order:f,optgroup:p}),[I,h]};for(t=0;t<r;t++){let p=P.items[t];if(!p)continue;let f=p.id,I=N.options[f];if(I===void 0)continue;let h=Wt(f),S=N.getOption(h,!0);for(N.settings.hideSelected||S.classList.toggle("selected",N.items.includes(h)),l=I[N.settings.optgroupField]||"",d=Array.isArray(l)?l:[l],n=0,o=d&&d.length;n<o;n++){l=d[n];let $=I.$order,te=N.optgroups[l];te===void 0?l="":$=te.$order;const[ne,oe]=Q(l,$);n>0&&(S=S.cloneNode(!0),De(S,{id:I.$id+"-clone-"+n,"aria-selected":null}),S.classList.add("ts-cloned"),at(S,"active"),N.activeOption&&N.activeOption.dataset.value==f&&_&&_.dataset.group===l.toString()&&(C=S)),oe.appendChild(S),l!=""&&(A[l]=ne)}}N.settings.lockOptgroupOrder&&G.sort((p,f)=>p.order-f.order),y=document.createDocumentFragment(),We(G,p=>{let f=p.fragment,I=p.optgroup;if(!f||!f.children.length)return;let h=N.optgroups[I];if(h!==void 0){let S=document.createDocumentFragment(),$=N.render("optgroup_header",h);pt(S,$),pt(S,f);let te=N.render("optgroup",{group:h,options:S});pt(y,te)}else pt(y,f)}),B.innerHTML="",pt(B,y),N.settings.highlight&&(Xo(B),P.query.length&&P.tokens.length&&We(P.tokens,p=>{Bo(B,p.regex)}));var O=p=>{let f=N.render(p,{input:M});return f&&(X=!0,B.insertBefore(f,B.firstChild)),f};if(N.loading?O("loading"):N.settings.shouldLoad.call(N,M)?P.items.length===0&&O("no_results"):O("not_loading"),m=N.canCreate(M),m&&(x=O("option_create")),N.hasOptions=P.items.length>0||m,X){if(P.items.length>0){if(!C&&N.settings.mode==="single"&&N.items[0]!=null&&(C=N.getOption(N.items[0])),!B.contains(C)){let p=0;x&&!N.settings.addPrecedence&&(p=1),C=N.selectable()[p]}}else x&&(C=x);e&&!N.isOpen&&(N.open(),N.scrollToOption(C,"auto")),N.setActiveOption(C)}else N.clearActiveOption(),e&&N.isOpen&&N.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const o=Ze(e[n.settings.valueField]);return o===null||n.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[o]=e,n.lastQuery=null,t&&(n.userOptions[o]=t,n.trigger("option_add",o,e)),o)}addOptions(e,t=!1){We(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ze(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var o,r;const l=Ze(e),d=Ze(t[n.settings.valueField]);if(l===null)return;const y=n.options[l];if(y==null)return;if(typeof d!="string")throw new Error("Value must be set in option data");const m=n.getOption(l),_=n.getItem(l);if(t.$order=t.$order||y.$order,delete n.options[l],n.uncacheValue(d),n.options[d]=t,m){if(n.dropdown_content.contains(m)){const x=n._render("option",t);Xn(m,x),n.activeOption===m&&n.setActiveOption(x)}m.remove()}_&&(r=n.items.indexOf(l),r!==-1&&n.items.splice(r,1,d),o=n._render("item",t),_.classList.contains("active")&&He(o,"active"),Xn(_,o)),n.lastQuery=null}removeOption(e,t){const n=this;e=Wt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};We(this.options,(o,r)=>{t(o,r)&&(n[r]=o)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Ze(e);if(n===null)return null;const o=this.options[n];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,n="option"){var o=this,r;if(!e)return null;n=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let l=0;l<r.length;l++)if(r[l]==e)return t>0?r[l+1]:r[l-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ze(e);return t!==null?this.control.querySelector(`[data-value="${ki(t)}"]`):null}addItems(e,t){var n=this,o=Array.isArray(e)?e:[e];o=o.filter(l=>n.items.indexOf(l)===-1);const r=o[o.length-1];o.forEach(l=>{n.isPending=l!==r,n.addItem(l,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];Ni(this,n,()=>{var o,r;const l=this,d=l.settings.mode,y=Ze(e);if(!(y&&l.items.indexOf(y)!==-1&&(d==="single"&&l.close(),d==="single"||!l.settings.duplicates))&&!(y===null||!l.options.hasOwnProperty(y))&&(d==="single"&&l.clear(t),!(d==="multi"&&l.isFull()))){if(o=l._render("item",l.options[y]),l.control.contains(o)&&(o=o.cloneNode(!0)),r=l.isFull(),l.items.splice(l.caretPos,0,y),l.insertAtCaret(o),l.isSetup){if(!l.isPending&&l.settings.hideSelected){let m=l.getOption(y),_=l.getAdjacent(m,1);_&&l.setActiveOption(_)}!l.isPending&&!l.settings.closeAfterSelect&&l.refreshOptions(l.isFocused&&d!=="single"),l.settings.closeAfterSelect!=!1&&l.isFull()?l.close():l.isPending||l.positionDropdown(),l.trigger("item_add",y,o),l.isPending||l.updateOriginalInput({silent:t})}(!l.isPending||!r&&l.isFull())&&(l.inputState(),l.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var o,r;const l=e.dataset.value;o=sn(e),e.remove(),e.classList.contains("active")&&(r=n.activeItems.indexOf(e),n.activeItems.splice(r,1),at(e,"active")),n.items.splice(o,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(l)&&n.removeOption(l,t),o<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",l,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,o=n.caretPos,r;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var l=!1,d=y=>{if(n.unlock(),!y||typeof y!="object")return t();var m=Ze(y[n.settings.valueField]);if(typeof m!="string")return t();n.setTextboxValue(),n.addOption(y,!0),n.setCaret(o),n.addItem(m),t(y),l=!0};return typeof n.settings.create=="function"?r=n.settings.create.call(this,e,d):r={[n.settings.labelField]:e,[n.settings.valueField]:e},l||d(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("readonly",e.isReadOnly),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",n),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",Ro(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let y=function(m,_,x){return m||(m=Re('<option value="'+Gt(_)+'">'+Gt(x)+"</option>")),m!=r&&t.input.append(m),l.push(m),(m!=r||d>0)&&(m.selected=!0),m};const l=[],d=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(m=>{m.selected=!1}),t.items.length==0&&t.settings.mode=="single"?y(r,"",""):t.items.forEach(m=>{if(n=t.options[m],o=n[t.settings.labelField]||"",l.includes(n.$option)){const _=t.input.querySelector(`option[value="${ki(m)}"]:not(:checked)`);y(_,m,o)}else n.$option=y(n.$option,m,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,De(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Xt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Xt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,De(t.focus_node,{"aria-expanded":"false"}),Xt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Xt(this.dropdown,{width:t.width+"px",top:n+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();We(n,o=>{t.removeItem(o,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,o=t.control;o.insertBefore(e,o.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,o,r,l=this;t=e&&e.keyCode===Ti?-1:1,n=Ko(l.control_input);const d=[];if(l.activeItems.length)r=Si(l.activeItems,t),o=sn(r),t>0&&o++,We(l.activeItems,y=>d.push(y));else if((l.isFocused||l.settings.mode==="single")&&l.items.length){const y=l.controlChildren();let m;t<0&&n.start===0&&n.length===0?m=y[l.caretPos-1]:t>0&&n.start===l.inputValue().length&&(m=y[l.caretPos]),m!==void 0&&d.push(m)}if(!l.shouldDelete(d,e))return!1;for(Se(e,!0),typeof o<"u"&&l.setCaret(o);d.length;)l.removeItem(d.pop());return l.inputState(),l.positionDropdown(),l.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(o=>o.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(ft(Vt,t)||ft("shiftKey",t)?(n=r.getLastActive(e),n?n.classList.contains("active")?o=r.getAdjacent(n,e,"item"):o=n:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(n),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Si(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,at(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,Gt),!o))return null;if(o=Re(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?De(o,{"aria-disabled":"true"}):De(o,{"data-selectable":""}):e==="optgroup"&&(n=t.group[r.settings.optgroupValueField],De(o,{"data-group":n}),t.group[r.settings.disabledField]&&De(o,{"data-disabled":""})),e==="option"||e==="item"){const l=Wt(t[r.settings.valueField]);De(o,{"data-value":l}),e==="item"?(He(o,r.settings.itemClass),De(o,{"data-ts-item":""})):(He(o,r.settings.optionClass),De(o,{role:"option",id:t.$id}),t.$div=o,r.options[l]=t)}return o}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){We(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var o=this,r=o[t];o[t]=function(){var l,d;return e==="after"&&(l=r.apply(o,arguments)),d=n.apply(o,arguments),e==="instead"?d:(e==="before"&&(l=r.apply(o,arguments)),l)}}}function Yo(){Te(this.input,"change",()=>{this.sync()})}function Zo(i){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},i);var o=function(d,y){y?(d.checked=!0,n.uncheckedClassNames&&d.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&d.classList.add(...n.checkedClassNames)):(d.checked=!1,n.checkedClassNames&&d.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&d.classList.add(...n.uncheckedClassNames))},r=function(d){setTimeout(()=>{var y=d.querySelector("input."+n.className);y instanceof HTMLInputElement&&o(y,d.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var l=e.settings.render.option;e.settings.render.option=(d,y)=>{var m=Re(l.call(e,d,y)),_=document.createElement("input");n.className&&_.classList.add(n.className),_.addEventListener("click",function(A){Se(A)}),_.type="checkbox";const x=Ze(d[e.settings.valueField]);return o(_,!!(x&&e.items.indexOf(x)>-1)),m.prepend(_),m}}),e.on("item_remove",l=>{var d=e.getOption(l);d&&(d.classList.remove("selected"),r(d))}),e.on("item_add",l=>{var d=e.getOption(l);d&&r(d)}),e.hook("instead","onOptionSelect",(l,d)=>{if(d.classList.contains("selected")){d.classList.remove("selected"),e.removeItem(d.dataset.value),e.refreshOptions(),Se(l,!0);return}t.call(e,l,d),r(d)})}function Jo(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Re(t.html(t));n.addEventListener("click",o=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(n)})}const Qo=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i.nextSibling)},ea=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i)},ta=(i,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,i==e)return!0}while(e&&e.previousElementSibling);return!1};function na(){var i=this;if(i.settings.mode!=="multi")return;var e=i.lock,t=i.unlock;let n=!0,o;i.hook("after","setupTemplates",()=>{var r=i.settings.render.item;i.settings.render.item=(l,d)=>{const y=Re(r.call(i,l,d));De(y,{draggable:"true"});const m=M=>{n||Se(M),M.stopPropagation()},_=M=>{o=y,setTimeout(()=>{y.classList.add("ts-dragging")},0)},x=M=>{M.preventDefault(),y.classList.add("ts-drag-over"),G(y,o)},A=()=>{y.classList.remove("ts-drag-over")},G=(M,b)=>{b!==void 0&&(ta(b,y)?Qo(M,b):ea(M,b))},N=()=>{var M;document.querySelectorAll(".ts-drag-over").forEach(P=>P.classList.remove("ts-drag-over")),(M=o)==null||M.classList.remove("ts-dragging"),o=void 0;var b=[];i.control.querySelectorAll("[data-value]").forEach(P=>{if(P.dataset.value){let C=P.dataset.value;C&&b.push(C)}}),i.setValue(b)};return Te(y,"mousedown",m),Te(y,"dragstart",_),Te(y,"dragenter",x),Te(y,"dragover",x),Te(y,"dragleave",A),Te(y,"dragend",N),y}}),i.hook("instead","lock",()=>(n=!1,e.call(i))),i.hook("instead","unlock",()=>(n=!0,t.call(i)))}function ia(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Re(t.html(t)),o=n.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Se(r,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function ra(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=sn(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),at(t,"last-active")}else i.setCaret(i.caretPos+e)})}function oa(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,He(i.control_input,"dropdown-input");const e=Re('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Re('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case rr:i.isOpen&&(Se(t,!0),i.close()),i.clearActiveItems();return;case jn:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),Te(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function aa(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of n)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),i.on("update item_add item_remove",o),Te(t,"input",o),Te(t,"keyup",o),Te(t,"blur",o),Te(t,"update",o)})}function sa(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function la(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function ca(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,o,r,l;if(!i.isOpen||!(t.keyCode===Vn||t.keyCode===or))return e.call(i,t);i.ignoreHover=!0,l=Ht(i.activeOption,"[data-group]"),n=sn(i.activeOption,"[data-selectable]"),l&&(t.keyCode===Vn?l=l.previousSibling:l=l.nextSibling,l&&(r=l.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,n)],o&&i.setActiveOption(o)))})}function ua(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+Gt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,l)=>{var d=Re(o.call(t,r,l)),y=Re(n);return d.appendChild(y),Te(y,"mousedown",m=>{Se(m,!0)}),Te(y,"click",m=>{t.isLocked||(Se(m,!0),!t.isLocked&&t.shouldDelete([d],m)&&(t.removeItem(d),t.refreshOptions(!1),t.inputState()))}),d}})}}function da(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[n];o&&e.setTextboxValue(t.text.call(e,o))}})}function fa(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var o={},r,l=!1,d,y=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(i.activeOption){var A=i.selectable(),G=Array.from(A).indexOf(i.activeOption);if(G>=A.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const m=x=>typeof i.settings.maxOptions=="number"&&r.children.length>=i.settings.maxOptions?!1:!!(x in o&&o[x]),_=(x,A)=>i.items.indexOf(A)>=0||y.indexOf(A)>=0;i.setNextUrl=(x,A)=>{o[x]=A},i.getUrl=x=>{if(x in o){const A=o[x];return o[x]=!1,A}return i.clearPagination(),i.settings.firstUrl.call(i,x)},i.clearPagination=()=>{o={}},i.hook("instead","clearActiveOption",()=>{if(!l)return t.call(i)}),i.hook("instead","canLoad",x=>x in o?m(x):e.call(i,x)),i.hook("instead","loadCallback",(x,A)=>{if(!l)i.clearOptions(_);else if(d){const G=x[0];G!==void 0&&(d.dataset.value=G[i.settings.valueField])}n.call(i,x,A),l=!1}),i.hook("after","refreshOptions",()=>{const x=i.lastValue;var A;m(x)?(A=i.render("loading_more",{query:x}),A&&(A.setAttribute("data-selectable",""),d=A)):x in o&&!r.querySelector(".no-results")&&(A=i.render("no_more_results",{query:x})),A&&(He(A,i.settings.optionClass),r.append(A))}),i.on("initialize",()=>{y=Object.keys(i.options),r=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),r.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&m(i.lastValue)&&(l||(l=!0,i.load.call(i,i.lastValue)))})})}Ge.define("change_listener",Yo);Ge.define("checkbox_options",Zo);Ge.define("clear_button",Jo);Ge.define("drag_drop",na);Ge.define("dropdown_header",ia);Ge.define("caret_position",ra);Ge.define("dropdown_input",oa);Ge.define("input_autogrow",aa);Ge.define("no_backspace_delete",sa);Ge.define("no_active_items",la);Ge.define("optgroup_columns",ca);Ge.define("remove_button",ua);Ge.define("restore_on_backspace",da);Ge.define("virtual_scroll",fa);async function pa(i){if(!await F.scene.isReady())return;const n=(await F.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of i){const l=r.metadata[`${w.EXTENSIONID}/metadata_ghosts`];if(l?.length>0){o=!0;const d=l.map(m=>m.id);for(const m of l){const _=m.metadata[`${w.EXTENSIONID}/viewers`];_&&(_.includes(R.userId)?await F.scene.local.addItems([m]):n.includes(m.id)&&await F.scene.local.deleteItems([m.id]))}const y=n.filter(m=>!d.includes(m));y?.length>0&&await F.scene.local.deleteItems(y)}}o||await F.scene.local.deleteItems(n)}function ha(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const o of R.players)n.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function ga(){let i=R.metadata[`${w.SPECTREID}/stored`];i&&(await F.scene.local.addItems(i),i.forEach(e=>{sr(e)}))}async function ma(){F.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${w.EXTENSIONID}/metadata_ghosts`]=e,await F.player.setMetadata(t)}),await F.contextMenu.create({id:`${w.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${w.SPECTREID}/spectred`],value:void 0,operator:"==",coordinator:"&&"}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${w.SPECTREID}/spectred`],value:void 0,operator:"!=",coordinator:"&&"}]}}],async onClick(i){if(i.items.every(t=>t.metadata[`${w.SPECTREID}/spectred`]===void 0)){document.getElementById("spectreWarning").style.display="none";for(const t of i.items)sr(t)}else for(const t of i.items){const n=t;n.metadata[`${w.SPECTREID}/spectred`]=void 0,document.getElementById(`deleteGhost-${n.id}`);const o=R.ghosts.findIndex(l=>l.id===n.id);R.ghosts.splice(o,1),document.getElementById(`tr-${n.id}`)?.remove(),await F.scene.local.updateItems([n.id],l=>{l[0].metadata[`${w.EXTENSIONID}/viewers`]=[]}),await ar(n),await F.scene.items.addItems([n])}}})}async function ar(i){const t=R.metadata[`${w.SPECTREID}/stored`].filter(n=>n.id!==i.id);await F.scene.setMetadata({[`${w.SPECTREID}/stored`]:t}),await F.scene.local.deleteItems([i.id])}async function va(i){let e=R.metadata[`${w.SPECTREID}/stored`];if(!e)e=[i];else{if(e.find(n=>n.id===i.id))return;e.push(i)}await F.scene.setMetadata({[`${w.SPECTREID}/stored`]:e})}async function sr(i){const e=i.text?.plainText||i.name;i.metadata[`${w.SPECTREID}/spectred`]=!0,await F.scene.items.deleteItems([i.id]),await F.scene.local.addItems([i]),await va(i),R.ghosts.push(i);const t=document.getElementById("ghostList"),n=document.createElement("tr");n.id=`tr-${i.id}`,n.className="ghost-table-entry",n.innerHTML=`<td class="token-name">${e}</td>
<td><select id="select-${i.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${i.id}" value="Delete"/></td>`,t.appendChild(n);const o=document.getElementById(`select-${i.id}`);for(const d of R.players){const y=document.createElement("option");y.value=d.id,y.text=d.name,o.appendChild(y)}const r={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:R.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(d,y){const m=y.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await F.scene.local.updateItems([m],_=>{const x=_[0].metadata[`${w.EXTENSIONID}/viewers`],A=x.findIndex(G=>G==d);x.splice(A,1),_[0].metadata[`${w.EXTENSIONID}/viewers`]=x})},onItemAdd:async function(d,y){const m=y.parentElement.parentElement.parentElement.parentElement.id.slice(3);await F.scene.local.updateItems([m],_=>{const x=_[0].metadata[`${w.EXTENSIONID}/viewers`];x?(x.push(d),_[0].metadata[`${w.EXTENSIONID}/viewers`]=x):_[0].metadata[`${w.EXTENSIONID}/viewers`]=[d]})}};new Ge(`#select-${i.id}`,r);const l=document.getElementById(`deleteGhost-${i.id}`);l.onclick=async()=>{const d=R.ghosts.findIndex(y=>y.id===i.id);R.ghosts.splice(d,1),n.remove(),await F.scene.local.updateItems([i.id],y=>{y[0].metadata[`${w.EXTENSIONID}/viewers`]=[]}),await ar(i)}}var lr={exports:{}};(function(i){(function(){function e(d,y){var m=d.x-y.x,_=d.y-y.y;return m*m+_*_}function t(d,y,m){var _=y.x,x=y.y,A=m.x-_,G=m.y-x;if(A!==0||G!==0){var N=((d.x-_)*A+(d.y-x)*G)/(A*A+G*G);N>1?(_=m.x,x=m.y):N>0&&(_+=A*N,x+=G*N)}return A=d.x-_,G=d.y-x,A*A+G*G}function n(d,y){for(var m=d[0],_=[m],x,A=1,G=d.length;A<G;A++)x=d[A],e(x,m)>y&&(_.push(x),m=x);return m!==x&&_.push(x),_}function o(d,y,m,_,x){for(var A=_,G,N=y+1;N<m;N++){var M=t(d[N],d[y],d[m]);M>A&&(G=N,A=M)}A>_&&(G-y>1&&o(d,y,G,_,x),x.push(d[G]),m-G>1&&o(d,G,m,_,x))}function r(d,y){var m=d.length-1,_=[d[0]];return o(d,0,m,y,_),_.push(d[m]),_}function l(d,y,m){if(d.length<=2)return d;var _=y!==void 0?y*y:1;return d=m?d:n(d,_),d=r(d,_),d}i.exports=l,i.exports.default=l})()})(lr);var ya=lr.exports;const Ia=Gn(ya);async function Ci(i){const e=await F.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=i.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,i.appendChild(r)),t[e[o].id]=e[o].name}let n=i.querySelectorAll("option");for(let o=0;o<n.length;o++)t[n[o].value]===void 0&&i.removeChild(n[o])}async function wa(i,e,t,n,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=R.gridDpi/t,l,d=[];if(d[0]=0,d[1]=0,n!==""){let y=await F.scene.items.getItems([n]);if(y.length>0)l=y[0],t===0&&(t=l.grid.dpi),r=R.gridDpi/t,d[0]=l.position.x-l.grid.offset.x*r,d[1]=l.position.y-l.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}i==="foundry"?ba(e,r,d,o):i==="uvtt"&&Ea(e,r,d,o)}function cr(i,e,t,n,o){let r=0,l=0,d=0;const y=[];for(let m=0;m<i.length;m++){let _=[],x=!1;for(let A=0;A<i[m].length-1;A++){let G=i[m][A].x*e,N=i[m][A].y*e,M=i[m][A+1].x*e,b=i[m][A+1].y*e;_.push({x:G*t+n[0],y:N*t+n[1]}),_.push({x:M*t+n[0],y:b*t+n[1]}),l++,!x&&i[m][A].door&&(x=!0)}if(_.length>128){let A=_.length;_=Ia(_,8,!1),console.log("simplified points from "+A+" to "+_.length)}for(let A=0;A<_.length;A+=256){const G=_.slice(A>0?A-1:0,A+256),N=Wn().tension(0).points(G).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();if(N.visible=!1,N.metadata[`${w.EXTENSIONID}/isVisionLine`]=!0,x&&(N.metadata[`${w.EXTENSIONID}/isDoor`]=!0),y.push(N),d+=G.length,d>512||y.length>64){r+=y.length,F.scene.items.addItems(y);const M=y.filter(b=>b.metadata[`${w.EXTENSIONID}/isDoor`]===!0);nn(M),y.length=0,d=0}}}if(y.length>0){r+=y.length,F.scene.items.addItems(y);const m=y.filter(_=>_.metadata[`${w.EXTENSIONID}/isDoor`]===!0);nn(m)}o.innerText="Finished importing "+r+" walls, "+l+" points."}function Ea(i,e,t,n){if(!i.line_of_sight||i.line_of_sight.length===0){n.innerText="No walls / los found";return}if(i.resolution.map_origin!==void 0&&(t[0]-=i.resolution.map_origin.x*i.resolution.pixels_per_grid,t[1]-=i.resolution.map_origin.y*i.resolution.pixels_per_grid),i.portals&&i.portals.length)for(let o=0;o<i.portals.length;o++){let r=i.portals[o].bounds;r[0].door=!0,r[1].door=!0,i.line_of_sight.push(r)}cr(i.line_of_sight,i.resolution.pixels_per_grid,e,t,n)}function ba(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const o=[];for(var r=0;r<i.walls.length;r++)o.push([{x:i.walls[r].c[0],y:i.walls[r].c[1],door:!!i.walls[r].door},{x:i.walls[r].c[2],y:i.walls[r].c[3],door:!!i.walls[r].door}]);cr(o,1,e,t,n)}function Di(i,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",o=t.matches?"light":"dark";for(var r=0;r<e.styleSheets.length;r++)for(var l=0;l<e.styleSheets[r].cssRules.length;l++){let d=e.styleSheets[r].cssRules[l];d&&d.media&&d.media.mediaText.includes("prefers-color-scheme")&&(i.mode=="LIGHT"?(d.media.appendMedium(`(prefers-color-scheme: ${n})`),d.media.mediaText.includes(o)&&d.media.deleteMedium(`(prefers-color-scheme: ${o})`)):i.mode=="DARK"&&(d.media.appendMedium(`(prefers-color-scheme: ${o})`),d.media.mediaText.includes(n)&&d.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}var it=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(i,e,t,n){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},l,d,y,m,_,x,A,G,N,M,b,P,C,X,B,Q,O={},p={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},f={},I="",h={},S=!1;function $(E){if(typeof E=="object"){var j=function(){switch(q){case"el":ge(E.el),E.wrap!==!1&&de(E.el);break;case"parent":l=e.querySelector(E.parent),l&&(l.appendChild(d),p.parent=E.parent,l===e.body&&(l=n));break;case"themeMode":p.themeMode=E.themeMode,E.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(p.themeMode="dark");case"theme":E.theme&&(p.theme=E.theme),d.className="clr-picker clr-"+p.theme+" clr-"+p.themeMode,p.inline&&we();break;case"rtl":p.rtl=!!E.rtl,e.querySelectorAll(".clr-field").forEach(function(Me){return Me.classList.toggle("clr-rtl",p.rtl)});break;case"margin":E.margin*=1,p.margin=isNaN(E.margin)?p.margin:E.margin;break;case"wrap":E.el&&E.wrap&&de(E.el);break;case"formatToggle":p.formatToggle=!!E.formatToggle,pe("clr-format").style.display=p.formatToggle?"block":"none",p.formatToggle&&(p.format="auto");break;case"swatches":if(Array.isArray(E.swatches)){var le=[];E.swatches.forEach(function(Me,ve){le.push('<button type="button" id="clr-swatch-'+ve+'" aria-labelledby="clr-swatch-label clr-swatch-'+ve+'" style="color: '+Me+';">'+Me+"</button>")}),pe("clr-swatches").innerHTML=le.length?"<div>"+le.join("")+"</div>":"",p.swatches=E.swatches.slice()}break;case"swatchesOnly":p.swatchesOnly=!!E.swatchesOnly,d.setAttribute("data-minimal",p.swatchesOnly);break;case"alpha":p.alpha=!!E.alpha,d.setAttribute("data-alpha",p.alpha);break;case"inline":if(p.inline=!!E.inline,d.setAttribute("data-inline",p.inline),p.inline){var he=E.defaultColor||p.defaultColor;X=Xe(he),we(),ye(he)}break;case"clearButton":typeof E.clearButton=="object"&&(E.clearButton.label&&(p.clearLabel=E.clearButton.label,A.innerHTML=p.clearLabel),E.clearButton=E.clearButton.show),p.clearButton=!!E.clearButton,A.style.display=p.clearButton?"block":"none";break;case"clearLabel":p.clearLabel=E.clearLabel,A.innerHTML=p.clearLabel;break;case"closeButton":p.closeButton=!!E.closeButton,p.closeButton?d.insertBefore(G,_):_.appendChild(G);break;case"closeLabel":p.closeLabel=E.closeLabel,G.innerHTML=p.closeLabel;break;case"a11y":var ue=E.a11y,Ne=!1;if(typeof ue=="object")for(var me in ue)ue[me]&&p.a11y[me]&&(p.a11y[me]=ue[me],Ne=!0);if(Ne){var Le=pe("clr-open-label"),Ee=pe("clr-swatch-label");Le.innerHTML=p.a11y.open,Ee.innerHTML=p.a11y.swatch,G.setAttribute("aria-label",p.a11y.close),A.setAttribute("aria-label",p.a11y.clear),N.setAttribute("aria-label",p.a11y.hueSlider),b.setAttribute("aria-label",p.a11y.alphaSlider),x.setAttribute("aria-label",p.a11y.input),y.setAttribute("aria-label",p.a11y.instruction)}break;default:p[q]=E[q]}};for(var q in E)j()}}function te(E,j){typeof E=="string"&&typeof j=="object"&&(f[E]=j,S=!0)}function ne(E){delete f[E],Object.keys(f).length===0&&(S=!1,E===I&&Y())}function oe(E){if(S){var j=["el","wrap","rtl","inline","defaultColor","a11y"],q=function(){var ue=f[ee];if(E.matches(ee)){I=ee,h={},j.forEach(function(me){return delete ue[me]});for(var Ne in ue)h[Ne]=Array.isArray(p[Ne])?p[Ne].slice():p[Ne];return $(ue),"break"}};for(var ee in f){var le=q();if(le==="break")break}}}function Y(){Object.keys(h).length>0&&($(h),I="",h={})}function ge(E){Ie(e,"click",E,function(j){p.inline||(oe(j.target),C=j.target,B=C.value,X=Xe(B),d.classList.add("clr-open"),we(),ye(B),(p.focusInput||p.selectInput)&&(x.focus({preventScroll:!0}),x.setSelectionRange(C.selectionStart,C.selectionEnd)),p.selectInput&&x.select(),(Q||p.swatchesOnly)&&Ce().shift().focus(),C.dispatchEvent(new Event("open",{bubbles:!0})))}),Ie(e,"input",E,function(j){var q=j.target.parentNode;q.classList.contains("clr-field")&&(q.style.color=j.target.value)})}function we(){if(!(!d||!C&&!p.inline)){var E=l,j=i.scrollY,q=d.offsetWidth,ee=d.offsetHeight,le={left:!1,top:!1},he,ue,Ne,me={x:0,y:0};if(E&&(he=i.getComputedStyle(E),ue=parseFloat(he.marginTop),Ne=parseFloat(he.borderTopWidth),me=E.getBoundingClientRect(),me.y+=Ne+j),!p.inline){var Le=C.getBoundingClientRect(),Ee=Le.x,Me=j+Le.y+Le.height+p.margin;E?(Ee-=me.x,Me-=me.y,Ee+q>E.clientWidth&&(Ee+=Le.width-q,le.left=!0),Me+ee>E.clientHeight-ue&&ee+p.margin<=Le.top-(me.y-j)&&(Me-=Le.height+ee+p.margin*2,le.top=!0),Me+=E.scrollTop):(Ee+q>e.documentElement.clientWidth&&(Ee+=Le.width-q,le.left=!0),Me+ee-j>e.documentElement.clientHeight&&ee+p.margin<=Le.top&&(Me=j+Le.y-ee-p.margin,le.top=!0)),d.classList.toggle("clr-left",le.left),d.classList.toggle("clr-top",le.top),d.style.left=Ee+"px",d.style.top=Me+"px",me.x+=d.offsetLeft,me.y+=d.offsetTop}O={width:y.offsetWidth,height:y.offsetHeight,x:y.offsetLeft+me.x,y:y.offsetTop+me.y}}}function de(E){e.querySelectorAll(E).forEach(function(j){var q=j.parentNode;if(!q.classList.contains("clr-field")){var ee=e.createElement("div"),le="clr-field";(p.rtl||j.classList.contains("clr-rtl"))&&(le+=" clr-rtl"),ee.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',q.insertBefore(ee,j),ee.setAttribute("class",le),ee.style.color=j.value,ee.appendChild(j)}})}function ae(E){if(C&&!p.inline){var j=C;E&&(C=n,B!==j.value&&(j.value=B,j.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){B!==j.value&&j.dispatchEvent(new Event("change",{bubbles:!0}))}),d.classList.remove("clr-open"),S&&Y(),j.dispatchEvent(new Event("close",{bubbles:!0})),p.focusInput&&j.focus({preventScroll:!0}),C=n}}function ye(E){var j=ce(E),q=ie(j);Ke(q.s,q.v),g(j,q),N.value=q.h,d.style.color="hsl("+q.h+", 100%, 50%)",M.style.left=q.h/360*100+"%",m.style.left=O.width*q.s/100+"px",m.style.top=O.height-O.height*q.v/100+"px",b.value=q.a*100,P.style.left=q.a*100+"%"}function Xe(E){var j=E.substring(0,3).toLowerCase();return j==="rgb"||j==="hsl"?j:"hex"}function se(E){E=E!==n?E:x.value,C&&(C.value=E,C.dispatchEvent(new Event("input",{bubbles:!0}))),p.onChange&&p.onChange.call(i,E,C),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:E,currentEl:C}}))}function Oe(E,j){var q={h:N.value*1,s:E/O.width*100,v:100-j/O.height*100,a:b.value/100},ee=H(q);Ke(q.s,q.v),g(ee,q),se()}function Ke(E,j){var q=p.a11y.marker;E=E.toFixed(1)*1,j=j.toFixed(1)*1,q=q.replace("{s}",E),q=q.replace("{v}",j),m.setAttribute("aria-label",q)}function qe(E){return{pageX:E.changedTouches?E.changedTouches[0].pageX:E.pageX,pageY:E.changedTouches?E.changedTouches[0].pageY:E.pageY}}function $e(E){var j=qe(E),q=j.pageX-O.x,ee=j.pageY-O.y;l&&(ee+=l.scrollTop),c(q,ee),E.preventDefault(),E.stopPropagation()}function D(E,j){var q=m.style.left.replace("px","")*1+E,ee=m.style.top.replace("px","")*1+j;c(q,ee)}function c(E,j){E=E<0?0:E>O.width?O.width:E,j=j<0?0:j>O.height?O.height:j,m.style.left=E+"px",m.style.top=j+"px",Oe(E,j),m.focus()}function g(E,j){E===void 0&&(E={}),j===void 0&&(j={});var q=p.format;for(var ee in E)r[ee]=E[ee];for(var le in j)r[le]=j[le];var he=fe(r),ue=he.substring(0,7);switch(m.style.color=ue,P.parentNode.style.color=ue,P.style.color=he,_.style.color=he,y.style.display="none",y.offsetHeight,y.style.display="",P.nextElementSibling.style.display="none",P.nextElementSibling.offsetHeight,P.nextElementSibling.style.display="",q==="mixed"?q=r.a===1?"hex":"rgb":q==="auto"&&(q=X),q){case"hex":x.value=he;break;case"rgb":x.value=Ae(r);break;case"hsl":x.value=Pe(W(r));break}e.querySelector('.clr-format [value="'+q+'"]').checked=!0}function T(){var E=N.value*1,j=m.style.left.replace("px","")*1,q=m.style.top.replace("px","")*1;d.style.color="hsl("+E+", 100%, 50%)",M.style.left=E/360*100+"%",Oe(j,q)}function U(){var E=b.value/100;P.style.left=E*100+"%",g({a:E}),se()}function H(E){var j=E.s/100,q=E.v/100,ee=j*q,le=E.h/60,he=ee*(1-t.abs(le%2-1)),ue=q-ee;ee=ee+ue,he=he+ue;var Ne=t.floor(le)%6,me=[ee,he,ue,ue,he,ee][Ne],Le=[he,ee,ee,he,ue,ue][Ne],Ee=[ue,ue,he,ee,ee,he][Ne];return{r:t.round(me*255),g:t.round(Le*255),b:t.round(Ee*255),a:E.a}}function W(E){var j=E.v/100,q=j*(1-E.s/100/2),ee;return q>0&&q<1&&(ee=t.round((j-q)/t.min(q,1-q)*100)),{h:E.h,s:ee||0,l:t.round(q*100),a:E.a}}function ie(E){var j=E.r/255,q=E.g/255,ee=E.b/255,le=t.max(j,q,ee),he=t.min(j,q,ee),ue=le-he,Ne=le,me=0,Le=0;return ue&&(le===j&&(me=(q-ee)/ue),le===q&&(me=2+(ee-j)/ue),le===ee&&(me=4+(j-q)/ue),le&&(Le=ue/le)),me=t.floor(me*60),{h:me<0?me+360:me,s:t.round(Le*100),v:t.round(Ne*100),a:E.a}}function ce(E){var j=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,q,ee;return o.fillStyle="#000",o.fillStyle=E,q=j.exec(o.fillStyle),q?(ee={r:q[3]*1,g:q[4]*1,b:q[5]*1,a:q[6]*1},ee.a=+ee.a.toFixed(2)):(q=o.fillStyle.replace("#","").match(/.{2}/g).map(function(le){return parseInt(le,16)}),ee={r:q[0],g:q[1],b:q[2],a:1}),ee}function fe(E){var j=E.r.toString(16),q=E.g.toString(16),ee=E.b.toString(16),le="";if(E.r<16&&(j="0"+j),E.g<16&&(q="0"+q),E.b<16&&(ee="0"+ee),p.alpha&&(E.a<1||p.forceAlpha)){var he=E.a*255|0;le=he.toString(16),he<16&&(le="0"+le)}return"#"+j+q+ee+le}function Ae(E){return!p.alpha||E.a===1&&!p.forceAlpha?"rgb("+E.r+", "+E.g+", "+E.b+")":"rgba("+E.r+", "+E.g+", "+E.b+", "+E.a+")"}function Pe(E){return!p.alpha||E.a===1&&!p.forceAlpha?"hsl("+E.h+", "+E.s+"%, "+E.l+"%)":"hsla("+E.h+", "+E.s+"%, "+E.l+"%, "+E.a+")"}function Fe(){e.getElementById("clr-picker")||(l=n,d=e.createElement("div"),d.setAttribute("id","clr-picker"),d.className="clr-picker",d.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+p.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+p.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+p.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+p.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+p.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+p.a11y.clear+'">'+p.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+p.a11y.close+'">'+p.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+p.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+p.a11y.swatch+"</span>"),e.body.appendChild(d),y=pe("clr-color-area"),m=pe("clr-color-marker"),A=pe("clr-clear"),G=pe("clr-close"),_=pe("clr-color-preview"),x=pe("clr-color-value"),N=pe("clr-hue-slider"),M=pe("clr-hue-marker"),b=pe("clr-alpha-slider"),P=pe("clr-alpha-marker"),ge(p.el),de(p.el),Ie(d,"mousedown",function(E){d.classList.remove("clr-keyboard-nav"),E.stopPropagation()}),Ie(y,"mousedown",function(E){Ie(e,"mousemove",$e)}),Ie(y,"touchstart",function(E){e.addEventListener("touchmove",$e,{passive:!1})}),Ie(m,"mousedown",function(E){Ie(e,"mousemove",$e)}),Ie(m,"touchstart",function(E){e.addEventListener("touchmove",$e,{passive:!1})}),Ie(x,"change",function(E){var j=x.value;if(C||p.inline){var q=j===""?j:ye(j);se(q)}}),Ie(A,"click",function(E){se(""),ae()}),Ie(G,"click",function(E){se(),ae()}),Ie(pe("clr-format"),"click",".clr-format input",function(E){X=E.target.value,g(),se()}),Ie(d,"click",".clr-swatches button",function(E){ye(E.target.textContent),se(),p.swatchesOnly&&ae()}),Ie(e,"mouseup",function(E){e.removeEventListener("mousemove",$e)}),Ie(e,"touchend",function(E){e.removeEventListener("touchmove",$e)}),Ie(e,"mousedown",function(E){Q=!1,d.classList.remove("clr-keyboard-nav"),ae()}),Ie(e,"keydown",function(E){var j=E.key,q=E.target,ee=E.shiftKey,le=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(j==="Escape"?ae(!0):le.includes(j)&&(Q=!0,d.classList.add("clr-keyboard-nav")),j==="Tab"&&q.matches(".clr-picker *")){var he=Ce(),ue=he.shift(),Ne=he.pop();ee&&q===ue?(Ne.focus(),E.preventDefault()):!ee&&q===Ne&&(ue.focus(),E.preventDefault())}}),Ie(e,"click",".clr-field button",function(E){S&&Y(),E.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),Ie(m,"keydown",function(E){var j={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(j).includes(E.key)&&(D.apply(void 0,j[E.key]),E.preventDefault())}),Ie(y,"click",$e),Ie(N,"input",T),Ie(b,"input",U))}function Ce(){var E=Array.from(d.querySelectorAll("input, button")),j=E.filter(function(q){return!!q.offsetWidth});return j}function pe(E){return e.getElementById(E)}function Ie(E,j,q,ee){var le=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof q=="string"?E.addEventListener(j,function(he){le.call(he.target,q)&&ee.call(he.target,he)}):(ee=q,E.addEventListener(j,ee))}function ze(E,j){j=j!==n?j:[],e.readyState!=="loading"?E.apply(void 0,j):e.addEventListener("DOMContentLoaded",function(){E.apply(void 0,j)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function st(E,j){C=j,B=C.value,oe(j),X=Xe(E),we(),ye(E),se(),B!==E&&C.dispatchEvent(new Event("change",{bubbles:!0}))}var et=function(){var E={init:Fe,set:$,wrap:de,close:ae,setInstance:te,setColor:st,removeInstance:ne,updatePosition:we};function j(le){ze(function(){le&&(typeof le=="string"?ge(le):$(le))})}var q=function(he){j[he]=function(){for(var ue=arguments.length,Ne=new Array(ue),me=0;me<ue;me++)Ne[me]=arguments[me];ze(E[he],Ne)}};for(var ee in E)q(ee);return ze(function(){i.addEventListener("resize",function(le){j.updatePosition()}),i.addEventListener("scroll",function(le){j.updatePosition()})}),j}();return et.coloris=et,et}(window,document,Math)}();it.coloris;it.init;it.set;it.wrap;it.close;it.setInstance;it.removeInstance;it.updatePosition;const Kn=document.getElementById("app");Kn.innerHTML=`
<div>
    <div>
        <div id="localStorageWarning"></div>
        <div class="title">
            Smoke!  Dynamic Fog
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings"><svg fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.63 11.08zm.21.41v-.1zm.23.38L1 11.68zM1 11.68l-.11-.19zm-.21-.29c-.06-.1-.11-.21-.16-.31.05.1.1.21.16.31zm.32.54v-.06z"/><path d="m11.26 12.63 1.83 1.09a7.34 7.34 0 0 0 1-.94 7.48 7.48 0 0 0 1.56-2.86l-1.74-1A5.29 5.29 0 0 0 14 8a5.29 5.29 0 0 0-.08-.9l1.74-1a7.45 7.45 0 0 0-1.33-2.58 7.54 7.54 0 0 0-1.24-1.22l-1.83 1.04a6 6 0 0 0-1.11-.53v-2A8.55 8.55 0 0 0 7.94.53a8.39 8.39 0 0 0-2.26.3v2a7.23 7.23 0 0 0-1.12.54L2.78 2.28A7.46 7.46 0 0 0 .2 6.06l1.72 1a5.29 5.29 0 0 0-.08.9 5.29 5.29 0 0 0 .08.9l-1.73 1a8 8 0 0 0 .43 1.15c.05.1.1.21.16.31v.1l.11.19.12.19v.06a7.69 7.69 0 0 0 1.64 1.78l1.81-1.08a7.23 7.23 0 0 0 1.12.54v2a8.39 8.39 0 0 0 2.26.31 8.56 8.56 0 0 0 2.22-.3v-2a6 6 0 0 0 1.2-.48zm-2.39 1.52a7.57 7.57 0 0 1-.95.06 7.73 7.73 0 0 1-1-.06v-1.69a4.92 4.92 0 0 1-2.53-1.27l-1.54.92a6.22 6.22 0 0 1-1.08-1.61l1.56-.93a4.27 4.27 0 0 1 0-3.17l-1.56-.92a6.11 6.11 0 0 1 1.12-1.62l1.56.93A5 5 0 0 1 7 3.53V1.82a7.73 7.73 0 0 1 1-.06 7.57 7.57 0 0 1 .95.06v1.72a4.9 4.9 0 0 1 2.4 1.26l1.59-.94a6.31 6.31 0 0 1 1.11 1.62l-1.6.94a4.35 4.35 0 0 1 .3 1.58 4.44 4.44 0 0 1-.29 1.55l1.56.93a6.43 6.43 0 0 1-1.11 1.61l-1.58-.93a5 5 0 0 1-2.49 1.28z"/><path d="M7.92 5.49A2.59 2.59 0 0 0 5.25 8a2.59 2.59 0 0 0 2.67 2.51A2.6 2.6 0 0 0 10.6 8a2.6 2.6 0 0 0-2.68-2.51zM8 9.2A1.35 1.35 0 0 1 6.55 8 1.35 1.35 0 0 1 8 6.7 1.35 1.35 0 0 1 9.39 8 1.35 1.35 0 0 1 8 9.2z"/></svg></div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
        </div>
        <hr>
        <div id="settings-ui" class="grid-settings" style="display:none;">
            <div class="visionTitle grid-3">Settings</div>

            <div><label for="autodetect_checkbox" title="Automatically detect fog areas based on the current scene's maps">Autodetect Maps</label></div>
            <div style="grid-column: span 2;"><input type="checkbox" id="autodetect_checkbox" checked></div>

            <div id="boundry_options" class="grid-3" style="display:none;">
                <span id="map_size">Boundary Size: 
                    <input type="number" id="mapWidth" name="Width" min="10" max="500"/> x 
                    <input type="number" id="mapHeight" name="Height" min="10" max="500"/>
                    <input type="button" id="mapSubmit" value="Update"/>
                    &nbsp;&nbsp;&nbsp;
                </span>
            </div>

            <div><label for="snap_checkbox">Grid Snap</label></div>
            <div class="grid-2"><input type="checkbox" id="snap_checkbox"></div>

            <div><label for="persistence_checkbox" title="Enabling fog persistence will retain the previously viewed areas of the map">Persistence</label></div>
            <div><input type="checkbox" id="persistence_checkbox"></div>
            <div><input type="button" id="persistence_reset" value="Reset"></div>

            <div><label for="fow_checkbox" title="Trailing fog shows an opaque layer for previously viewed areas that players cannot currently view">Trailing Fog + Autohide</label></div>
            <div><input type="checkbox" id="fow_checkbox"></div>
            <div><input type="text" style="width: 90px;" maxlength="9" id="fow_color" value="#00000088"></div>

            <div>Render Quality</div>
            <div></div>
            <div><select id="quality"><option value="fast">Fast</option><option value="accurate">Accurate</option></select></div>

            <div>Convert from <i>Dynamic Fog</i></div>
            <div></div>
            <div><input type="button" id="convert_button" value="Convert"></div>

            <div>Unlock Fog Backgrounds</div>
            <div></div>
            <div><input type="button" id="background_button" value="Unlock"></div>

            <div></div>
            <div></div>
            <div><input type="button" id="debug_button" value="Enable Debugging" title="Show debugging and performance data"></div>

            <div class="visionTitle grid-3" style="margin-top: 16px;">Import</div>

            <div class="grid-3" style="margin-bottom: 16px;">Import JSON files with fog data from<br><a href="https://www.dungeonalchemist.com/" target="_blank">Dungeon Alchemist</a> and other tools.</div>

            <div>File Format</div>
            <div></div>
            <div><select id="import_format"><option value="foundry">Foundry</option><option value="uvtt">Universal VTT</option></select></div>

            <div><label for="dpi_autodetect" title="Whether or not to automatically detect the DPI of imported data based">DPI Autodetect</label></div>
            <div><input type="checkbox" id="dpi_autodetect" checked></div>
            <div><input id="import_dpi" disabled type="text" value="150" style="width: 32px;" maxlength="4"></div>

            <div style="margin-bottom: 8px;" title="Which map to align imported lines to">Map Alignment</div>
            <div></div>
            <div><select id="map_align" style="width: 120px;"><option selected>Loading..</option></select></div>

            <div><input id="import_file" style="width: 190px;" type="file"></div>
            <div></div>
            <div><input style="padding: 6px" type="button" id="import_button" value="Import" disabled></div>

            <div id="import_errors" class="grid-3"></div>
        </div>

        <div id="main-ui" class="grid-main">
            <div class="visionTitle grid-3">Vision Radius</div>
            <div class="grid-3"><i>GM-owned tokens give universal vision.</i></div>
            <p class="grid-3" id="no_tokens_message">Enable vision on your character tokens.</p>
            <div id="token_list_div" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <table style="margin: auto; padding: 0;">
                <tbody id="token_list"></tbody>
                </table>
            </div>
            <div class="visionTitle grid-3">Spectres!</div>
            <div id="ghostContainer" class="grid-3" style="border-bottom: 1px solid white; padding-bottom: 8px;">
                <div id="spectreWarning">
                    Spectre tokens are only visible to specific players.
                    <br>
                    Enable vision here after it's been Spectred.
                    <br>
                    <br>
                    <i>Turning a token into a Spectre is one-way. You'll need to drag a new token in if you want it normal.</i>
                </div>
                <table style="margin: auto; padding: 0; width: 100%">
                <colgroup>
                    <col style="width: 50%;">
                    <col style="width: 25%;">
                    <col style="width: 25%;">
                </colgroup>
                <tbody id="ghostList">
                </tbody></table>
            </div> 
            <div id="fog_backgrounds" class="grid-3">
                <div class="visionTitle" style="display: block; padding-top:8px;">Fog Backgrounds</div>
                <div id="fog_background_list" class="grid-main" style="border-bottom: 1px solid white; padding-bottom: 8px;">
            </div>
        </div>

        <div id="debug_div" style="display: none;" class="grid-debug">
            <div class="visionTitle grid-2" style="text-align: center; margin-top: 16px">Performance Info</div>
            <div>Stage 1: Fog Shapes</div><div id="stage1">N/A</div>
            <div>Stage 2: Player Vision</div><div id="stage2">N/A</div>
            <div>Stage 3: Vision Ranges</div><div id="stage3">N/A</div>
            <div>Stage 4: Persistence+Trailing</div><div id="stage4">N/A</div>
            <div>Stage 5: OBR Scene</div><div id="stage5">N/A</div>
            <div>Stage 6: Autohide</div><div id="stage6">N/A</div>
            <div>Cache hits/misses</div><div><span id="cache_hits">?</span>/<span id=cache_misses>?</span></div>
        </div>
    </div>
</div>
`;Kn.parentElement.style.placeItems="start";const Pi=document.getElementById("main-ui"),Ln=document.getElementById("settings-ui"),ur=document.getElementById("vision_checkbox"),$i=document.getElementById("snap_checkbox"),_a=document.getElementById("token_list"),Sa=document.getElementById("no_tokens_message"),Ta=document.getElementById("mapHeight"),Oa=document.getElementById("mapWidth"),Na=document.getElementById("mapSubmit"),dr=document.getElementById("persistence_checkbox"),kt=document.getElementById("autodetect_checkbox"),Un=document.getElementById("fow_checkbox"),fr=document.getElementById("fow_color"),pr=document.getElementById("quality"),ka=document.getElementById("persistence_reset"),xa=document.getElementById("convert_button"),Aa=document.getElementById("settings_button"),hr=document.getElementById("boundry_options"),qt=document.getElementById("debug_div"),Ca=document.getElementById("debug_button"),Da=document.getElementById("background_button"),Mn=document.getElementById("import_button"),Pa=document.getElementById("import_file"),Hn=document.getElementById("map_align"),St=document.getElementById("import_errors"),$a=document.getElementById("dpi_autodetect"),La=document.getElementById("import_dpi"),Ma=document.getElementById("import_format");it.init();async function Fa(){ur.addEventListener("click",async t=>{if(!R.ready||!t.target){t.preventDefault();return}const n=t.target;await F.scene.setMetadata({[`${w.EXTENSIONID}/visionEnabled`]:n.checked})},!1),$i.checked=!0,$i.addEventListener("click",async t=>{if(!R.ready||!t.target){t.preventDefault();return}const n=t.target;R.snap=n.checked},!1),Aa.addEventListener("click",async t=>{!t||!t.target||(Ln.style.display==="grid"?(Ln.style.display="none",Pi.style.display="grid"):(Ln.style.display="grid",Pi.style.display="none"))},!1),dr.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await F.scene.setMetadata({[`${w.EXTENSIONID}/persistenceEnabled`]:n.checked})},!1),kt.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;if(await F.scene.setMetadata({[`${w.EXTENSIONID}/autodetectEnabled`]:n.checked}),hr.style.display=n.checked?"none":"",!n.checked){let o=gr();o&&await F.scene.items.addItems([o])}},!1),Un.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await F.scene.setMetadata({[`${w.EXTENSIONID}/fowEnabled`]:n.checked})},!1),pr.addEventListener("change",async t=>{if(!t||!t.target)return;const n=t.target;await F.scene.setMetadata({[`${w.EXTENSIONID}/quality`]:n.value})},!1),ka.addEventListener("click",async t=>{!t||!t.target||(F.scene.setMetadata({[`${w.EXTENSIONID}/forceReset`]:!0}),F.scene.setMetadata({[`${w.EXTENSIONID}/forceReset`]:void 0}))},!1),Ca.addEventListener("click",async t=>{!t||!t.target||(t.target,qt.style.display=qt.style.display=="none"?"grid":"none",await F.scene.setMetadata({[`${w.EXTENSIONID}/debug`]:qt.style.display==="grid"}))},!1),Da.addEventListener("click",async t=>{!t||!t.target||(t.target,await F.scene.items.updateItems(n=>n.layer=="FOG"&&n.metadata[`${w.EXTENSIONID}/isBackgroundMap`]===!0,n=>{for(let o=0;o<n.length;o++)n[o].layer="MAP",n[o].disableHit=!1,n[o].locked=!1,n[o].visible=!0,delete n[o].metadata[`${w.EXTENSIONID}/isBackgroundMap`]}))},!1);let i;fr.addEventListener("input",async t=>{if(!t||!t.target)return;const n=t.target;clearTimeout(i),i=setTimeout(async()=>{if(/#[a-f0-9]{8}/.test(n.value)){await F.scene.setMetadata({[`${w.EXTENSIONID}/fowColor`]:n.value});const r=await F.scene.local.getItems(Ut);await F.scene.local.deleteItems(r.map(l=>l.id))}},500)},!1),xa.addEventListener("click",async t=>{if(!(!t||!t.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const n=await F.scene.getMetadata();for(const r in n)r.substring(0,r.indexOf("/"))==w.ARMINDOID&&F.scene.setMetadata({[`${r}`]:void 0});const o=await F.scene.items.getItems();await F.scene.items.updateItems(o,r=>{for(const l of r)l.metadata[`${w.ARMINDOID}/isVisionLine`]!==void 0&&(l.metadata[`${w.EXTENSIONID}/isVisionLine`]=l.metadata[`${w.ARMINDOID}/isVisionLine`],delete l.metadata[`${w.ARMINDOID}/isVisionLine`]),l.metadata[`${w.ARMINDOID}/disabled`]!==void 0&&(l.metadata[`${w.EXTENSIONID}/disabled`]=l.metadata[`${w.ARMINDOID}/disabled`],delete l.metadata[`${w.ARMINDOID}/disabled`])})}},!1);var e;Pa.addEventListener("change",async t=>{if(Mn.disabled=!0,!t||!t.target)return;const n=t.target;if(!n.files)return;const o=n.files[0];if(o.type!=="text/javascript"&&o.type,o){var r=new FileReader;r.onload=function(l){if(!l||!l.target){St.innerText="Invalid import event";return}const d=l.target;if(!d.result){St.innerText="Unable to read imported file";return}const y=d.result;e=JSON.parse(y),e&&(e.walls&&e.walls.length||e.line_of_sight&&e.line_of_sight.length)?Mn.disabled=!1:St.innerText="Imported file has no walls"},r.readAsText(o)}else St.innerText="Failed to load file"}),Mn.addEventListener("click",async t=>{!t||!t.target||(t.target,wa(Ma.value,e,$a.checked?0:Number.parseInt(La.value),Hn.value,St))},!1)}function zt(i){const e=i.filter(Ri);let t=!1;R.metadata&&(ur.checked=R.metadata[`${w.EXTENSIONID}/visionEnabled`]==!0,kt.checked=R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]==!0,dr.checked=R.metadata[`${w.EXTENSIONID}/persistenceEnabled`]==!0,kt.checked=R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]==!0,Un.checked=R.metadata[`${w.EXTENSIONID}/fowEnabled`]==!0,fr.value=R.metadata[`${w.EXTENSIONID}/fowColor`]?R.metadata[`${w.EXTENSIONID}/fowColor`]:"#00000088",t=R.metadata[`${w.EXTENSIONID}/debug`]==!0,pr.value=R.metadata[`${w.EXTENSIONID}/quality`]),qt.style.display=t?"grid":"none",hr.style.display=kt.checked?"none":"",Sa.style.display=e.length>0?"none":"block",eo(Un.checked),uo();const n=R.items.filter(y=>y.layer==="FOG"&&y.metadata[`${w.EXTENSIONID}/isBackgroundMap`]===!0),o=document.querySelectorAll(".fog-background-entry");for(const y of o){const m=y.id.slice(3);n.find(_=>_.id===m)===void 0&&y.remove()}for(const y of n)if(!document.querySelector(`#bg-${y.id}`)){const _=document.createElement("div");_.id=`bg-${y.id}`,_.className="fog-background-entry grid-3 grid-main",_.style.width="300",_.innerHTML=`<div class="token-name grid-2">${y.name}</div>
                <div><label title="Unlock this fog background and turn it back into a map"><input type="button" value="Unlock"></label></div>`,document.querySelector("#fog_background_list").appendChild(_),_.querySelector("input").addEventListener("click",async A=>{if(!A||!A.target)return;const N=A.target.parentElement.parentElement.parentElement.id.slice(3);await F.scene.items.updateItems(M=>M.id===N&&M.layer=="FOG"&&M.metadata[`${w.EXTENSIONID}/isBackgroundMap`]===!0,M=>{for(let b=0;b<M.length;b++)M[b].layer="MAP",M[b].disableHit=!1,M[b].locked=!1,M[b].visible=!0,delete M[b].metadata[`${w.EXTENSIONID}/isBackgroundMap`]})})}const r=document.querySelector("#fog_backgrounds");n.length==0?r.style.display="none":r.style.display="block";const l=document.getElementsByClassName("token-table-entry"),d=[];for(const y of l){const m=y.id.slice(3);e.find(_=>_.id===m)===void 0&&d.push(y)}for(const y of d)y.remove();for(const y of e){const m=document.getElementById(`tr-${y.id}`);if(m){const _=m.getElementsByClassName("token-name")[0],x=m.getElementsByClassName("token-vision-range")[0],A=m.getElementsByClassName("unlimited-vision")[0],G=m.getElementsByClassName("no-vision")[0];_&&(_.innerText=y.name),x&&!A.checked&&!G.checked&&(x.value=y.metadata[`${w.EXTENSIONID}/visionRange`]?y.metadata[`${w.EXTENSIONID}/visionRange`]:w.VISIONDEFAULT),A&&(A.checked=y.metadata[`${w.EXTENSIONID}/visionRange`]===0),G&&(G.checked=y.metadata[`${w.EXTENSIONID}/visionBlind`]),A.checked||G.checked?x.setAttribute("disabled","disabled"):x.removeAttribute("disabled")}else{const _=R.items.find(b=>b.id===y.id),x=document.createElement("tr");x.id=`tr-${_.id}`,x.className="token-table-entry",x.innerHTML=`<td class="token-name">${_.name}</td>
                               <td><input class="token-vision-range" type="number" value=${w.VISIONDEFAULT}><span class="unit">ft</span></td>
                               <td>
                                <div class="cbutton"><label title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span>&infin;</span></label></div>
                                <div class="cbutton"><label title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span>&#128294;</span></label></div>
                                <div class="cbutton"><label title="Disable vision on this token"><input type="checkbox" class="no-vision"><span>None</span></label></div>
                               </td>`,_a.appendChild(x);const A=x.getElementsByClassName("token-vision-range")[0],G=x.getElementsByClassName("unlimited-vision")[0],N=x.getElementsByClassName("torch-vision")[0],M=x.getElementsByClassName("no-vision")[0];A&&!G.checked&&!M.checked&&(A.value=y.metadata[`${w.EXTENSIONID}/visionRange`]?y.metadata[`${w.EXTENSIONID}/visionRange`]:w.VISIONDEFAULT),G&&(G.checked=y.metadata[`${w.EXTENSIONID}/visionRange`]===0),N&&(N.checked=y.metadata[`${w.EXTENSIONID}/visionTorch`]),M&&(M.checked=y.metadata[`${w.EXTENSIONID}/visionBlind`]),G.checked||M.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),A.addEventListener("change",async b=>{if(!b||!b.target)return;const P=R.items.find(B=>B.id===y.id),C=b.target,X=parseInt(C.value);X<0&&(C.value="0"),X>999&&(C.value="999"),await F.scene.items.updateItems([P],B=>{B[0].metadata[`${w.EXTENSIONID}/visionRange`]=X})},!1),G.addEventListener("click",async b=>{if(!b||!b.target)return;const P=R.items.find(B=>B.id===y.id);let C=0;b.target.checked?(A.setAttribute("disabled","disabled"),M.checked=!1):(C=parseInt(A.value),A.removeAttribute("disabled")),await F.scene.items.updateItems([P],B=>{B[0].metadata[`${w.EXTENSIONID}/visionRange`]=C})},!1),M.addEventListener("click",async b=>{if(!b||!b.target)return;const P=R.items.find(X=>X.id===y.id),C=b.target;C.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),await F.scene.items.updateItems([P],X=>{X[0].metadata[`${w.EXTENSIONID}/visionBlind`]=C.checked})},!1),N.addEventListener("click",async b=>{if(!b||!b.target)return;const P=R.items.find(X=>X.id===y.id),C=b.target;await F.scene.items.updateItems([P],X=>{X[0].metadata[`${w.EXTENSIONID}/visionTorch`]=C.checked})},!1),A.addEventListener("mousewheel",async()=>{})}}}function gr(){let i;return R.items.filter(Bi).length==0&&(i=yt().width(R.gridDpi*30).height(R.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),i.metadata[`${w.EXTENSIONID}/isBackgroundImage`]=!0,i.id=w.GRIDID,R.items.push(i)),i}async function Li(i){let e,t;[R.items,R.metadata,R.gridDpi,R.gridScale,e,t]=await Promise.all([F.scene.items.getItems(),F.scene.getMetadata(),F.scene.grid.getDpi(),F.scene.grid.getScale(),F.scene.fog.getFilled(),F.scene.fog.getColor()]),await F.scene.items.deleteItems(R.items.filter(gt).map(r=>r.id)),R.snap=!0,R.gridScale=R.gridScale.parsed.multiplier,R.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(R.items.filter(Mr).length==0){const r=R.items.filter(d=>d.layer=="MAP"&&d.type=="IMAGE"),l=r.map(d=>d.image.width*d.image.height/Math.pow(d.grid.dpi,2));n=r[l.indexOf(Math.max(...l))]}let o;if(R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]===void 0?(kt.checked=!0,await F.scene.setMetadata({[`${w.EXTENSIONID}/autodetectEnabled`]:!0})):R.metadata[`${w.EXTENSIONID}/autodetectEnabled`]===!1&&(o=gr()),R.metadata[`${w.EXTENSIONID}/sceneId`]===void 0)await F.scene.setMetadata({[`${w.EXTENSIONID}/sceneId`]:crypto.randomUUID()});else try{const r=R.metadata[`${w.EXTENSIONID}/sceneId`],l=localStorage.getItem(`${w.EXTENSIONID}/fogCache/${R.userId}/${r}`);if(l!==null&&R.metadata[`${w.EXTENSIONID}/persistenceEnabled`]===!0){const d=JSON.parse(l);console.log("unfreezing "+d.length+" fog paths from localStorage");const y=[];for(let m=0;m<d.length;m++){const _=Tt().commands(d[m].commands).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${w.EXTENSIONID}/isVisionFog`]:!0,[`${w.EXTENSIONID}/digest`]:d[m].digest}).build();_.zIndex=3,y.push(F.scene.local.addItems([_]))}await Promise.all(y)}}catch{}if(i=="GM"){await ga(),o&&await F.scene.items.addItems([o]),Na.onclick=async()=>{await F.scene.items.updateItems([w.GRIDID],l=>{for(const d of l){const y=d;y.width=R.gridDpi*+Oa.value,y.height=R.gridDpi*+Ta.value,y.scale={x:1,y:1}}})},ho();const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await F.modal.open({id:w.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},zt(R.items),it({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),n!==void 0&&await F.scene.items.updateItems([n],l=>{l[0].metadata[`${w.EXTENSIONID}/isBackgroundImage`]=!0})}}async function Mi(){try{localStorage.setItem("STORAGECHECK","test")}catch{const e=document.getElementById("localStorageWarning");e.innerText="Local Storage disabled. Some features will not function."}}F.onReady(async()=>{const i=await F.theme.getTheme();Di(i,document),await F.player.getRole().then(async e=>{e=="GM"?(R.role="GM",await Mi(),await Fa(),await to(),await no(),await io(),await ma()):(Kn.innerHTML='Configuration is GM-Access only. <div id="localStorageWarning"></div>',await Mi(),await F.action.setHeight(90),await F.action.setWidth(320)),F.scene.fog.onChange(t=>{R.fog=t}),F.player.onChange(async t=>{const n=document.querySelectorAll(".token-table-entry");for(let o of n){let r=o.id.substring(3);t.selection!==void 0&&t.selection.includes(r)?o.classList.add("token-table-selected"):o.classList.remove("token-table-selected")}t.selection!==void 0&&t.selection.length===1&&po(t.selection[0])}),F.scene.items.onChange(async t=>{const n=t;R.items=n,R.ready&&(e=="GM"&&(zt(n),await Ci(Hn)),await ht())}),R.userId=await F.player.getId(),R.players=await F.party.getPlayers(),F.party.onChange(async t=>{R.players=t,e==="PLAYER"?await pa(t):ha()}),F.scene.grid.onChange(async t=>{R.gridDpi=t.dpi,R.gridScale=parseInt(t.scale),R.ready&&await ht()}),F.scene.onMetadataChange(async t=>{if(t[`${w.EXTENSIONID}/forceReset`]===!0){const n=await F.scene.local.getItems(Rn);F.scene.local.deleteItems(n.map(r=>r.id));const o=R.metadata[`${w.EXTENSIONID}/sceneId`];localStorage.removeItem(`${w.EXTENSIONID}/fogCache/${R.userId}/${o}`),ht(!0)}else R.metadata=t,R.ready&&await ht()}),F.scene.onReadyChange(async t=>{R.ready=t,t?(await Li(e),await ht()):e=="GM"&&zt([])}),R.ready=await F.scene.isReady(),R.ready?(await Li(e),await ht(),e=="GM"&&await Ci(Hn)):e=="GM"&&zt([]),F.theme.onChange(t=>{Di(t,document)})})});
