import{C as m,b as Yt,a as Gn,O as $,c as vt,d as Ot,i as $r}from"./constants-8c00d11a.js";var _n=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Pr(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var o=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return i[n]}})}),t}function Lr(i){return i.type==="CURVE"}function zn(i){return i.type==="IMAGE"}function hi(i,e){return Math.round(i/e)*e}function gi(i,e){return Math.floor(i/e)*e}function Fn(i){return i*(Math.PI/180)}function Mr(i){return i*(180/Math.PI)}function mi(i,e,t){return i*(1-t)+e*t}class Ut{static magnitudeSquared(e){return e.x*e.x+e.y*e.y}static magnitude(e){const t=Math.sqrt(this.magnitudeSquared(e));return isNaN(t)?0:t}static normalize(e){const t=this.magnitude(e);return t===0?{x:0,y:0}:this.divide(e,t)}static dot(e,t){return e.x*t.x+e.y*t.y}static subtract(e,t){return typeof t=="number"?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static add(e,t){return typeof t=="number"?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}static multiply(e,t){return typeof t=="number"?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static divide(e,t){return typeof t=="number"?{x:e.x/t,y:e.y/t}:{x:e.x/t.x,y:e.y/t.y}}static rotate(e,t,n){const o=Math.cos(Fn(n)),r=Math.sin(Fn(n)),l=this.subtract(e,t);return{x:t.x+o*l.x-r*l.y,y:t.y+r*l.x+o*l.y}}static min(e,t){return typeof t=="number"?{x:Math.min(e.x,t),y:Math.min(e.y,t)}:{x:Math.min(e.x,t.x),y:Math.min(e.y,t.y)}}static componentMin(e){return e.x<e.y?e.x:e.y}static max(e,t){return typeof t=="number"?{x:Math.max(e.x,t),y:Math.max(e.y,t)}:{x:Math.max(e.x,t.x),y:Math.max(e.y,t.y)}}static componentMax(e){return e.x>e.y?e.x:e.y}static roundTo(e,t){return{x:hi(e.x,t.x),y:hi(e.y,t.y)}}static floorTo(e,t){return{x:gi(e.x,t.x),y:gi(e.y,t.y)}}static sign(e){return{x:Math.sign(e.x),y:Math.sign(e.y)}}static abs(e){return{x:Math.abs(e.x),y:Math.abs(e.y)}}static pow(e,t){return typeof t=="number"?{x:Math.pow(e.x,t),y:Math.pow(e.y,t)}:{x:Math.pow(e.x,t.x),y:Math.pow(e.y,t.y)}}static clamp(e,t,n){return{x:Math.min(Math.max(e.x,t),n),y:Math.min(Math.max(e.y,t),n)}}static boundingBox(e){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let y of e)t=y.x<t?y.x:t,n=y.x>n?y.x:n,o=y.y<o?y.y:o,r=y.y>r?y.y:r;let l=n-t,f=r-o,I={x:(t+n)/2,y:(o+r)/2};return{min:{x:t,y:o},max:{x:n,y:r},width:l,height:f,center:I}}static pointInPolygon(e,t){const n=this.boundingBox(t);if(e.x<n.min.x||e.x>n.max.x||e.y<n.min.y||e.y>n.max.y)return!1;let o=!1;for(let r=0,l=t.length-1;r<t.length;l=r++){const f=t[r].y>e.y,I=t[l].y>e.y;f!==I&&e.x<(t[l].x-t[r].x)*(e.y-t[r].y)/(t[l].y-t[r].y)+t[r].x&&(o=!o)}return o}static compare(e,t,n){return this.magnitudeSquared(this.subtract(e,t))<n*n}static distance(e,t){return this.magnitude(this.subtract(e,t))}static lerp(e,t,n){return{x:mi(e.x,t.x,n),y:mi(e.y,t.y,n)}}static centroid(e){let t={x:0,y:0};for(let n of e)t.x+=n.x,t.y+=n.y;return e.length>0&&(t={x:t.x/e.length,y:t.y/e.length}),t}}class Xe{static inverse(e){const[t,n,o,r,l,f,I,y,_]=e,x=t*(l*_-y*f)-n*(r*_-f*I)+o*(r*y-l*I);if(Math.abs(x)<1e-14)return e;const A=1/x,H=(l*_-y*f)*A,N=(o*y-n*_)*A,R=(n*f-o*l)*A,S=(f*I-r*_)*A,D=(t*_-o*I)*A,C=(r*o-t*f)*A,B=(r*y-I*l)*A,F=(I*n-t*y)*A,Q=(t*l-r*n)*A;return[H,N,R,S,D,C,B,F,Q]}static multiply(e,t){return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]}static fromPosition(e){return[1,0,e.x,0,1,e.y,0,0,1]}static fromRotation(e){const t=Fn(e);return[Math.cos(t),-Math.sin(t),0,Math.sin(t),Math.cos(t),0,0,0,1]}static fromScale(e){return[e.x,0,0,0,e.y,0,0,0,1]}static fromItem(e){const t=Xe.fromPosition(e.position),n=Xe.fromScale(e.scale),o=Xe.fromRotation(e.rotation);return Xe.multiply(Xe.multiply(t,o),n)}static decompose(e){const[t,n,o,r,l,f]=e,I=t*l-r*n,y={position:{x:o,y:f},rotation:0,scale:{x:1,y:1}};if(t!=0||r!=0){var _=Math.sqrt(t*t+r*r);y.rotation=r>0?Math.acos(t/_):-Math.acos(t/_),y.scale={x:_,y:I/_}}else if(n!=0||l!=0){var x=Math.sqrt(n*n+l*l);y.rotation=Math.PI/2-(l>0?Math.acos(-n/x):-Math.acos(n/x)),y.scale={x:I/x,y:x}}return y.rotation=Mr(y.rotation),y}}class Rr{userId;role;items;ghosts;players;metadata;gridDpi;gridScale;gridSnap;fog;ready;snap;constructor(){this.userId="",this.role="PLAYER",this.items=[],this.players=[],this.ghosts=[],this.metadata={},this.gridDpi=0,this.gridScale=0,this.gridSnap=10,this.fog={filled:!1,style:{color:"white",strokeWidth:0}},this.ready=!1,this.snap=!0}}const L=new Rr;function Fr(i){return i.layer=="MAP"&&(i.metadata[`${m.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${m.ARMINDOID}/isBackgroundImage`])}function gt(i){return i.metadata[`${m.EXTENSIONID}/isVisionFog`]||i.metadata[`${m.ARMINDOID}/isVisionFog`]}function Br(i){return i.metadata[`${m.EXTENSIONID}/isIndicatorRing`]||i.metadata[`${m.ARMINDOID}/isIndicatorRing`]}function Xr(i){return i.metadata[`${m.EXTENSIONID}/isVisionLine`]&&!i.metadata[`${m.EXTENSIONID}/disabled`]||i.metadata[`${m.ARMINDOID}/isVisionLine`]&&!i.metadata[`${m.ARMINDOID}/disabled`]}function Bi(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${m.EXTENSIONID}/hasVision`]||i.metadata[`${m.ARMINDOID}/hasVision`])}function Vr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&(i.metadata[`${m.EXTENSIONID}/hasVision`]||i.metadata[`${m.ARMINDOID}/hasVision`])&&!i.metadata[`${m.EXTENSIONID}/visionBlind`]}function jr(i){return(i.layer=="CHARACTER"||i.layer=="ATTACHMENT")&&i.createdUserId==L.userId&&(i.metadata[`${m.EXTENSIONID}/hasVision`]||i.metadata[`${m.ARMINDOID}/hasVision`])&&!i.metadata[`${m.EXTENSIONID}/visionBlind`]}function Xi(i){return i.layer=="DRAWING"&&(i.metadata[`${m.EXTENSIONID}/isBackgroundImage`]||i.metadata[`${m.ARMINDOID}/isBackgroundImage`])}function Ht(i){return i.metadata[`${m.EXTENSIONID}/isTrailingFog`]}function Bn(i){return i.metadata[`${m.EXTENSIONID}/isTrailingFog`]||i.metadata[`${m.EXTENSIONID}/isVisionFog`]||i.metadata[`${m.ARMINDOID}/isVisionFog`]||i.metadata[`${m.EXTENSIONID}/isIndicatorRing`]}function At(i){return i.metadata[`${m.EXTENSIONID}/visionTorch`]}function Vi(i){return i.layer=="CHARACTER"&&!Bi(i)&&i.metadata[`${m.EXTENSIONID}/hasAutohide`]===!0}var ji={exports:{}};const Ur={},Hr=Object.freeze(Object.defineProperty({__proto__:null,default:Ur},Symbol.toStringTag,{value:"Module"})),Tn=Pr(Hr);(function(i,e){var t=(()=>{var n=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(n=n||__filename),function(o){o=o||{};var r;r||(r=typeof o<"u"?o:{});var l=Object.assign,f,I;r.ready=new Promise(function(s,a){f=s,I=a}),function(s){var a={};s.loadCmdsTypedArray=function(j){for(var z=0,Z=0;Z<j.length;Z++)z+=j[Z].length;if(a[z])var J=a[z];else J=new Float32Array(z),a[z]=J;var ie=0;for(Z=0;Z<j.length;Z++)for(var Se=0;Se<j[Z].length;Se++){var De=j[Z][Se];typeof De=="string"&&(De=s.SkBits2FloatUnsigned(parseInt(De))),J[ie]=De,ie++}return j=s._malloc(J.length*J.BYTES_PER_ELEMENT),s.HEAPF32.set(J,j/J.BYTES_PER_ELEMENT),[j,z]},s.FromCmds=function(j){j=s.loadCmdsTypedArray(j);var z=s._FromCmds(j[0],j[1]);return s._free(j[0]),z};var c,v,k,M,q;s.cubicYFromX=function(j,z,Z,J,ie){return c&&v===j&&k===z&&M===Z&&q===J||(c&&c.delete(),c=new s._SkCubicMap([j,z],[Z,J]),v=j,k=z,M=Z,q=J),c.computeYFromX(ie)},s.cubicPtFromT=function(j,z,Z,J,ie){return c&&v===j&&k===z&&M===Z&&q===J||(c&&c.delete(),c=new s._SkCubicMap([j,z],[Z,J]),v=j,k=z,M=Z,q=J),c.computePtFromT(ie)}}(r),function(s){s.onRuntimeInitialized=function(){s.SkPath.prototype.addPath=function(){var a=arguments[0];if(arguments.length===1)this._addPath(a,1,0,0,0,1,0,0,0,1);else if(arguments.length===2){var c=arguments[1];this._addPath(a,c.a,c.c,c.e,c.b,c.d,c.f,0,0,1)}else if(arguments.length===7)c=arguments,this._addPath(a,c[1],c[3],c[5],c[2],c[4],c[6],0,0,1);else if(arguments.length===10)c=arguments,this._addPath(a,c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9]);else return console.Ma("addPath expected to take 1, 2, 7, or 10 args. Got "+arguments.length),null;return this},s.SkPath.prototype.arc=function(a,c,v,k,M,q){return this._arc(a,c,v,k,M,!!q),this},s.SkPath.prototype.arcTo=function(a,c,v,k,M){return this._arcTo(a,c,v,k,M),this},s.SkPath.prototype.bezierCurveTo=function(a,c,v,k,M,q){return this._cubicTo(a,c,v,k,M,q),this},s.SkPath.prototype.close=function(){return this._close(),this},s.SkPath.prototype.closePath=function(){return this._close(),this},s.SkPath.prototype.conicTo=function(a,c,v,k,M){return this._conicTo(a,c,v,k,M),this},s.SkPath.prototype.cubicTo=function(a,c,v,k,M,q){return this._cubicTo(a,c,v,k,M,q),this},s.SkPath.prototype.dash=function(a,c,v){return this._dash(a,c,v)?this:null},s.SkPath.prototype.ellipse=function(a,c,v,k,M,q,j,z){return this._ellipse(a,c,v,k,M,q,j,!!z),this},s.SkPath.prototype.lineTo=function(a,c){return this._lineTo(a,c),this},s.SkPath.prototype.moveTo=function(a,c){return this._moveTo(a,c),this},s.SkPath.prototype.op=function(a,c){return this._op(a,c)?this:null},s.SkPath.prototype.quadraticCurveTo=function(a,c,v,k){return this._quadTo(a,c,v,k),this},s.SkPath.prototype.quadTo=function(a,c,v,k){return this._quadTo(a,c,v,k),this},s.SkPath.prototype.rect=function(a,c,v,k){return this._rect(a,c,v,k),this},s.SkPath.prototype.simplify=function(){return this._simplify()?this:null},s.SkPath.prototype.stroke=function(a){return a=a||{},a.width=a.width||1,a.miter_limit=a.miter_limit||4,a.cap=a.cap||s.StrokeCap.BUTT,a.join=a.join||s.StrokeJoin.MITER,this._stroke(a)?this:null},s.SkPath.prototype.transform=function(){if(arguments.length===1)this._transform(arguments[0]);else if(arguments.length===9){var a=arguments;this._transform(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}else return console.Ma("transform expected to take 1 or 9 arguments. Got "+arguments.length),null;return this},s.SkPath.prototype.trim=function(a,c,v){return this._trim(a,c,!!v)?this:null}}}(r);var y=l({},r),_=typeof window=="object",x=typeof importScripts=="function",A="",H,N,R,S,D,C;typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"?(A=x?Tn.dirname(A)+"/":__dirname+"/",C=()=>{D||(S=Tn,D=Tn)},H=function(s,a){return C(),s=D.normalize(s),S.readFileSync(s,a?null:"utf8")},R=s=>(s=H(s,!0),s.buffer||(s=new Uint8Array(s)),s),N=(s,a,c)=>{C(),s=D.normalize(s),S.readFile(s,function(v,k){v?c(v):a(k.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(s){throw s}),process.on("unhandledRejection",function(s){throw s}),r.inspect=function(){return"[Emscripten Module object]"}):(_||x)&&(x?A=self.location.href:typeof document<"u"&&document.currentScript&&(A=document.currentScript.src),n&&(A=n),A.indexOf("blob:")!==0?A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):A="",H=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.send(null),a.responseText},x&&(R=s=>{var a=new XMLHttpRequest;return a.open("GET",s,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),N=(s,a,c)=>{var v=new XMLHttpRequest;v.open("GET",s,!0),v.responseType="arraybuffer",v.onload=()=>{v.status==200||v.status==0&&v.response?a(v.response):c()},v.onerror=c,v.send(null)});var B=r.print||console.log.bind(console),F=r.printErr||console.warn.bind(console);l(r,y),y=null;var Q;r.wasmBinary&&(Q=r.wasmBinary),r.noExitRuntime,typeof WebAssembly!="object"&&ae("no native wasm support detected");var O,h=!1,p=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(s,a,c){var v=a+c;for(c=a;s[c]&&!(c>=v);)++c;if(16<c-a&&s.subarray&&p)return p.decode(s.subarray(a,c));for(v="";a<c;){var k=s[a++];if(k&128){var M=s[a++]&63;if((k&224)==192)v+=String.fromCharCode((k&31)<<6|M);else{var q=s[a++]&63;k=(k&240)==224?(k&15)<<12|M<<6|q:(k&7)<<18|M<<12|q<<6|s[a++]&63,65536>k?v+=String.fromCharCode(k):(k-=65536,v+=String.fromCharCode(55296|k>>10,56320|k&1023))}}else v+=String.fromCharCode(k)}return v}function g(s,a,c){var v=oe;if(0<c){c=a+c-1;for(var k=0;k<s.length;++k){var M=s.charCodeAt(k);if(55296<=M&&57343>=M){var q=s.charCodeAt(++k);M=65536+((M&1023)<<10)|q&1023}if(127>=M){if(a>=c)break;v[a++]=M}else{if(2047>=M){if(a+1>=c)break;v[a++]=192|M>>6}else{if(65535>=M){if(a+2>=c)break;v[a++]=224|M>>12}else{if(a+3>=c)break;v[a++]=240|M>>18,v[a++]=128|M>>12&63}v[a++]=128|M>>6&63}v[a++]=128|M&63}}v[a]=0}}var T=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function P(s,a){for(var c=s>>1,v=c+a/2;!(c>=v)&&Re[c];)++c;if(c<<=1,32<c-s&&T)return T.decode(oe.subarray(s,c));for(c="",v=0;!(v>=a/2);++v){var k=we[s+2*v>>1];if(k==0)break;c+=String.fromCharCode(k)}return c}function ne(s,a,c){if(c===void 0&&(c=2147483647),2>c)return 0;c-=2;var v=a;c=c<2*s.length?c/2:s.length;for(var k=0;k<c;++k)we[a>>1]=s.charCodeAt(k),a+=2;return we[a>>1]=0,a-v}function te(s){return 2*s.length}function re(s,a){for(var c=0,v="";!(c>=a/4);){var k=le[s+4*c>>2];if(k==0)break;++c,65536<=k?(k-=65536,v+=String.fromCharCode(55296|k>>10,56320|k&1023)):v+=String.fromCharCode(k)}return v}function Y(s,a,c){if(c===void 0&&(c=2147483647),4>c)return 0;var v=a;c=v+c-4;for(var k=0;k<s.length;++k){var M=s.charCodeAt(k);if(55296<=M&&57343>=M){var q=s.charCodeAt(++k);M=65536+((M&1023)<<10)|q&1023}if(le[a>>2]=M,a+=4,a+4>c)break}return le[a>>2]=0,a-v}function ge(s){for(var a=0,c=0;c<s.length;++c){var v=s.charCodeAt(c);55296<=v&&57343>=v&&++c,a+=4}return a}var ve,fe,oe,we,Re,le,xe,Ke,qe;function Fe(){var s=O.buffer;ve=s,r.HEAP8=fe=new Int8Array(s),r.HEAP16=we=new Int16Array(s),r.HEAP32=le=new Int32Array(s),r.HEAPU8=oe=new Uint8Array(s),r.HEAPU16=Re=new Uint16Array(s),r.HEAPU32=xe=new Uint32Array(s),r.HEAPF32=Ke=new Float32Array(s),r.HEAPF64=qe=new Float64Array(s)}var K,d=[],u=[],w=[];function X(){var s=r.preRun.shift();d.unshift(s)}var V=0,G=null;r.preloadedImages={},r.preloadedAudios={};function ae(s){throw r.onAbort&&r.onAbort(s),s="Aborted("+s+")",F(s),h=!0,s=new WebAssembly.RuntimeError(s+". Build with -s ASSERTIONS=1 for more info."),I(s),s}function ce(){return se.startsWith("data:application/octet-stream;base64,")}var se;if(se="pathkit.wasm",!ce()){var Ie=se;se=r.locateFile?r.locateFile(Ie,A):A+Ie}function Oe(){var s=se;try{if(s==se&&Q)return new Uint8Array(Q);if(R)return R(s);throw"both async and sync fetching of the wasm failed"}catch(a){ae(a)}}function Ae(){if(!Q&&(_||x)){if(typeof fetch=="function"&&!se.startsWith("file://"))return fetch(se,{credentials:"same-origin"}).then(function(s){if(!s.ok)throw"failed to load wasm binary file at '"+se+"'";return s.arrayBuffer()}).catch(function(){return Oe()});if(N)return new Promise(function(s,a){N(se,function(c){s(new Uint8Array(c))},a)})}return Promise.resolve().then(function(){return Oe()})}function Te(s){for(;0<s.length;){var a=s.shift();if(typeof a=="function")a(r);else{var c=a.Wa;typeof c=="number"?a.xa===void 0?K.get(c)():K.get(c)(a.xa):c(a.xa===void 0?null:a.xa)}}}var pe={};function Ee(s){for(;s.length;){var a=s.pop();s.pop()(a)}}function ze(s){return this.fromWireType(xe[s>>2])}var st={},et={},b={};function U(s){if(s===void 0)return"_unknown";s=s.replace(/[^a-zA-Z0-9_]/g,"$");var a=s.charCodeAt(0);return 48<=a&&57>=a?"_"+s:s}function W(s,a){return s=U(s),function(){return a.apply(this,arguments)}}function ee(s){var a=Error,c=W(s,function(v){this.name=s,this.message=v,v=Error(v).stack,v!==void 0&&(this.stack=this.toString()+`
`+v.replace(/^Error(:[^\n]*)?\n/,""))});return c.prototype=Object.create(a.prototype),c.prototype.constructor=c,c.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},c}var ue=void 0;function he(s){throw new ue(s)}function de(s,a,c){function v(j){j=c(j),j.length!==s.length&&he("Mismatched type converter count");for(var z=0;z<s.length;++z)it(s[z],j[z])}s.forEach(function(j){b[j]=a});var k=Array(a.length),M=[],q=0;a.forEach(function(j,z){et.hasOwnProperty(j)?k[z]=et[j]:(M.push(j),st.hasOwnProperty(j)||(st[j]=[]),st[j].push(function(){k[z]=et[j],++q,q===M.length&&v(k)}))}),M.length===0&&v(k)}var Ce={};function me(s){switch(s){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+s)}}var Le=void 0;function be(s){for(var a="";oe[s];)a+=Le[oe[s++]];return a}var Me=void 0;function ye(s){throw new Me(s)}function it(s,a,c={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");var v=a.name;if(s||ye('type "'+v+'" must have a positive integer typeid pointer'),et.hasOwnProperty(s)){if(c.Qa)return;ye("Cannot register type '"+v+"' twice")}et[s]=a,delete b[s],st.hasOwnProperty(s)&&(a=st[s],delete st[s],a.forEach(function(k){k()}))}function un(s){ye(s.ea.ha.fa.name+" instance already deleted")}var dn=!1;function Jn(){}function Qn(s){--s.count.value,s.count.value===0&&(s.ka?s.ma.la(s.ka):s.ha.fa.la(s.ga))}function It(s){return typeof FinalizationGroup>"u"?(It=a=>a,s):(dn=new FinalizationGroup(function(a){for(var c=a.next();!c.done;c=a.next())c=c.value,c.ga?Qn(c):console.warn("object already deleted: "+c.ga)}),It=a=>(dn.register(a,a.ea,a.ea),a),Jn=a=>{dn.unregister(a.ea)},It(s))}var Et=void 0,wt=[];function fn(){for(;wt.length;){var s=wt.pop();s.ea.pa=!1,s.delete()}}function lt(){}var ei={};function ti(s,a,c){if(s[a].ia===void 0){var v=s[a];s[a]=function(){return s[a].ia.hasOwnProperty(arguments.length)||ye("Function '"+c+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+s[a].ia+")!"),s[a].ia[arguments.length].apply(this,arguments)},s[a].ia=[],s[a].ia[v.ua]=v}}function pn(s,a,c){r.hasOwnProperty(s)?((c===void 0||r[s].ia!==void 0&&r[s].ia[c]!==void 0)&&ye("Cannot register public name '"+s+"' twice"),ti(r,s,s),r.hasOwnProperty(c)&&ye("Cannot register multiple overloads of a function with the same number of arguments ("+c+")!"),r[s].ia[c]=a):(r[s]=a,c!==void 0&&(r[s].Xa=c))}function vr(s,a,c,v,k,M,q,j){this.name=s,this.constructor=a,this.qa=c,this.la=v,this.na=k,this.Oa=M,this.ta=q,this.La=j,this.Ta=[]}function hn(s,a,c){for(;a!==c;)a.ta||ye("Expected null or instance of "+c.name+", got an instance of "+a.name),s=a.ta(s),a=a.na;return s}function Ir(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),hn(a.ea.ga,a.ea.ha.fa,this.fa))}function Er(s,a){if(a===null){if(this.Ba&&ye("null is not a valid "+this.name),this.wa){var c=this.sa();return s!==null&&s.push(this.la,c),c}return 0}if(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),!this.va&&a.ea.ha.va&&ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name),c=hn(a.ea.ga,a.ea.ha.fa,this.fa),this.wa)switch(a.ea.ka===void 0&&ye("Passing raw pointer to smart pointer is illegal"),this.Va){case 0:a.ea.ma===this?c=a.ea.ka:ye("Cannot convert argument of type "+(a.ea.ma?a.ea.ma.name:a.ea.ha.name)+" to parameter type "+this.name);break;case 1:c=a.ea.ka;break;case 2:if(a.ea.ma===this)c=a.ea.ka;else{var v=a.clone();c=this.Ua(c,ct(function(){v.delete()})),s!==null&&s.push(this.la,c)}break;default:ye("Unsupporting sharing policy")}return c}function wr(s,a){return a===null?(this.Ba&&ye("null is not a valid "+this.name),0):(a.ea||ye('Cannot pass "'+In(a)+'" as a '+this.name),a.ea.ga||ye("Cannot pass deleted object as a pointer of type "+this.name),a.ea.ha.va&&ye("Cannot convert argument of type "+a.ea.ha.name+" to parameter type "+this.name),hn(a.ea.ga,a.ea.ha.fa,this.fa))}function ni(s,a,c){return a===c?s:c.na===void 0?null:(s=ni(s,a,c.na),s===null?null:c.La(s))}var bt={};function br(s,a){for(a===void 0&&ye("ptr should not be undefined");s.na;)a=s.ta(a),s=s.na;return bt[a]}function Dt(s,a){return a.ha&&a.ga||he("makeClassHandle requires ptr and ptrType"),!!a.ma!=!!a.ka&&he("Both smartPtrType and smartPtr must be specified"),a.count={value:1},It(Object.create(s,{ea:{value:a}}))}function rt(s,a,c,v){this.name=s,this.fa=a,this.Ba=c,this.va=v,this.wa=!1,this.la=this.Ua=this.sa=this.Ia=this.Va=this.Sa=void 0,a.na!==void 0?this.toWireType=Er:(this.toWireType=v?Ir:wr,this.ja=null)}function ii(s,a,c){r.hasOwnProperty(s)||he("Replacing nonexistant public symbol"),r[s].ia!==void 0&&c!==void 0?r[s].ia[c]=a:(r[s]=a,r[s].ua=c)}function Sr(s,a){var c=[];return function(){c.length=arguments.length;for(var v=0;v<arguments.length;v++)c[v]=arguments[v];return s.includes("j")?(v=r["dynCall_"+s],v=c&&c.length?v.apply(null,[a].concat(c)):v.call(null,a)):v=K.get(a).apply(null,c),v}}function Ve(s,a){s=be(s);var c=s.includes("j")?Sr(s,a):K.get(a);return typeof c!="function"&&ye("unknown function pointer with signature "+s+": "+a),c}var ri=void 0;function oi(s){s=di(s);var a=be(s);return ot(s),a}function $t(s,a){function c(M){k[M]||et[M]||(b[M]?b[M].forEach(c):(v.push(M),k[M]=!0))}var v=[],k={};throw a.forEach(c),new ri(s+": "+v.map(oi).join([", "]))}function gn(s,a){for(var c=[],v=0;v<s;v++)c.push(le[(a>>2)+v]);return c}function mn(s,a,c,v,k){var M=a.length;2>M&&ye("argTypes array size mismatch! Must at least get return value and 'this' types!");var q=a[1]!==null&&c!==null,j=!1;for(c=1;c<a.length;++c)if(a[c]!==null&&a[c].ja===void 0){j=!0;break}var z=a[0].name!=="void",Z=M-2,J=Array(Z),ie=[],Se=[];return function(){if(arguments.length!==Z&&ye("function "+s+" called with "+arguments.length+" arguments, expected "+Z+" args!"),Se.length=0,ie.length=q?2:1,ie[0]=k,q){var De=a[1].toWireType(Se,this);ie[1]=De}for(var _e=0;_e<Z;++_e)J[_e]=a[_e+2].toWireType(Se,arguments[_e]),ie.push(J[_e]);if(_e=v.apply(null,ie),j)Ee(Se);else for(var je=q?1:2;je<a.length;je++){var Ue=je===1?De:J[je-2];a[je].ja!==null&&a[je].ja(Ue)}return De=z?a[0].fromWireType(_e):void 0,De}}var yn=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ai(s){4<s&&--tt[s].Ca===0&&(tt[s]=void 0,yn.push(s))}function vn(s){return s||ye("Cannot use deleted val. handle = "+s),tt[s].value}function ct(s){switch(s){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var a=yn.length?yn.pop():tt.length;return tt[a]={Ca:1,value:s},a}}function _r(s,a,c){switch(a){case 0:return function(v){return this.fromWireType((c?fe:oe)[v])};case 1:return function(v){return this.fromWireType((c?we:Re)[v>>1])};case 2:return function(v){return this.fromWireType((c?le:xe)[v>>2])};default:throw new TypeError("Unknown integer type: "+s)}}function Pt(s,a){var c=et[s];return c===void 0&&ye(a+" has unknown type "+oi(s)),c}function In(s){if(s===null)return"null";var a=typeof s;return a==="object"||a==="array"||a==="function"?s.toString():""+s}function Tr(s,a){switch(a){case 2:return function(c){return this.fromWireType(Ke[c>>2])};case 3:return function(c){return this.fromWireType(qe[c>>3])};default:throw new TypeError("Unknown float type: "+s)}}function Or(s,a,c){switch(a){case 0:return c?function(v){return fe[v]}:function(v){return oe[v]};case 1:return c?function(v){return we[v>>1]}:function(v){return Re[v>>1]};case 2:return c?function(v){return le[v>>2]}:function(v){return xe[v>>2]};default:throw new TypeError("Unknown integer type: "+s)}}var Nr={};function En(s){var a=Nr[s];return a===void 0?be(s):a}var wn=[];function si(){function s(a){a.$$$embind_global$$$=a;var c=typeof $$$embind_global$$$=="object"&&a.$$$embind_global$$$===a;return c||delete a.$$$embind_global$$$,c}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof _n=="object"&&s(_n)?$$$embind_global$$$=_n:typeof self=="object"&&s(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function kr(s){var a=wn.length;return wn.push(s),a}function xr(s,a){for(var c=Array(s),v=0;v<s;++v)c[v]=Pt(le[(a>>2)+v],"parameter "+v);return c}var li=[];function Ar(s){var a=Array(s+1);return function(c,v,k){a[0]=c;for(var M=0;M<s;++M){var q=Pt(le[(v>>2)+M],"parameter "+M);a[M+1]=q.readValueFromPointer(k),k+=q.argPackAdvance}return c=new(c.bind.apply(c,a)),ct(c)}}var ci={},Cr=[null,[],[]];ue=r.InternalError=ee("InternalError");for(var ui=Array(256),Lt=0;256>Lt;++Lt)ui[Lt]=String.fromCharCode(Lt);Le=ui,Me=r.BindingError=ee("BindingError"),lt.prototype.isAliasOf=function(s){if(!(this instanceof lt&&s instanceof lt))return!1;var a=this.ea.ha.fa,c=this.ea.ga,v=s.ea.ha.fa;for(s=s.ea.ga;a.na;)c=a.ta(c),a=a.na;for(;v.na;)s=v.ta(s),v=v.na;return a===v&&c===s},lt.prototype.clone=function(){if(this.ea.ga||un(this),this.ea.ra)return this.ea.count.value+=1,this;var s=It,a=Object,c=a.create,v=Object.getPrototypeOf(this),k=this.ea;return s=s(c.call(a,v,{ea:{value:{count:k.count,pa:k.pa,ra:k.ra,ga:k.ga,ha:k.ha,ka:k.ka,ma:k.ma}}})),s.ea.count.value+=1,s.ea.pa=!1,s},lt.prototype.delete=function(){this.ea.ga||un(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),Jn(this),Qn(this.ea),this.ea.ra||(this.ea.ka=void 0,this.ea.ga=void 0)},lt.prototype.isDeleted=function(){return!this.ea.ga},lt.prototype.deleteLater=function(){return this.ea.ga||un(this),this.ea.pa&&!this.ea.ra&&ye("Object already scheduled for deletion"),wt.push(this),wt.length===1&&Et&&Et(fn),this.ea.pa=!0,this},rt.prototype.Pa=function(s){return this.Ia&&(s=this.Ia(s)),s},rt.prototype.Ga=function(s){this.la&&this.la(s)},rt.prototype.argPackAdvance=8,rt.prototype.readValueFromPointer=ze,rt.prototype.deleteObject=function(s){s!==null&&s.delete()},rt.prototype.fromWireType=function(s){function a(){return this.wa?Dt(this.fa.qa,{ha:this.Sa,ga:c,ma:this,ka:s}):Dt(this.fa.qa,{ha:this,ga:s})}var c=this.Pa(s);if(!c)return this.Ga(s),null;var v=br(this.fa,c);if(v!==void 0)return v.ea.count.value===0?(v.ea.ga=c,v.ea.ka=s,v.clone()):(v=v.clone(),this.Ga(s),v);if(v=this.fa.Oa(c),v=ei[v],!v)return a.call(this);v=this.va?v.Ja:v.pointerType;var k=ni(c,this.fa,v.fa);return k===null?a.call(this):this.wa?Dt(v.fa.qa,{ha:v,ga:k,ma:this,ka:s}):Dt(v.fa.qa,{ha:v,ga:k})},r.getInheritedInstanceCount=function(){return Object.keys(bt).length},r.getLiveInheritedInstances=function(){var s=[],a;for(a in bt)bt.hasOwnProperty(a)&&s.push(bt[a]);return s},r.flushPendingDeletes=fn,r.setDelayFunction=function(s){Et=s,wt.length&&Et&&Et(fn)},ri=r.UnboundTypeError=ee("UnboundTypeError"),r.count_emval_handles=function(){for(var s=0,a=5;a<tt.length;++a)tt[a]!==void 0&&++s;return s},r.get_first_emval=function(){for(var s=5;s<tt.length;++s)if(tt[s]!==void 0)return tt[s];return null};var Dr={r:function(s){var a=pe[s];delete pe[s];var c=a.elements,v=c.length,k=c.map(function(j){return j.Aa}).concat(c.map(function(j){return j.Ea})),M=a.sa,q=a.la;de([s],k,function(j){return c.forEach(function(z,Z){var J=j[Z],ie=z.ya,Se=z.za,De=j[Z+v],_e=z.Da,je=z.Fa;z.read=Ue=>J.fromWireType(ie(Se,Ue)),z.write=(Ue,dt)=>{var Ye=[];_e(je,Ue,De.toWireType(Ye,dt)),Ee(Ye)}}),[{name:a.name,fromWireType:function(z){for(var Z=Array(v),J=0;J<v;++J)Z[J]=c[J].read(z);return q(z),Z},toWireType:function(z,Z){if(v!==Z.length)throw new TypeError("Incorrect number of tuple elements for "+a.name+": expected="+v+", actual="+Z.length);for(var J=M(),ie=0;ie<v;++ie)c[ie].write(J,Z[ie]);return z!==null&&z.push(q,J),J},argPackAdvance:8,readValueFromPointer:ze,ja:q}]})},u:function(s){var a=Ce[s];delete Ce[s];var c=a.sa,v=a.la,k=a.Ha,M=k.map(function(q){return q.Aa}).concat(k.map(function(q){return q.Ea}));de([s],M,function(q){var j={};return k.forEach(function(z,Z){var J=q[Z],ie=z.ya,Se=z.za,De=q[Z+k.length],_e=z.Da,je=z.Fa;j[z.Na]={read:function(Ue){return J.fromWireType(ie(Se,Ue))},write:function(Ue,dt){var Ye=[];_e(je,Ue,De.toWireType(Ye,dt)),Ee(Ye)}}}),[{name:a.name,fromWireType:function(z){var Z={},J;for(J in j)Z[J]=j[J].read(z);return v(z),Z},toWireType:function(z,Z){for(var J in j)if(!(J in Z))throw new TypeError('Missing field:  "'+J+'"');var ie=c();for(J in j)j[J].write(ie,Z[J]);return z!==null&&z.push(v,ie),ie},argPackAdvance:8,readValueFromPointer:ze,ja:v}]})},z:function(){},F:function(s,a,c,v,k){var M=me(c);a=be(a),it(s,{name:a,fromWireType:function(q){return!!q},toWireType:function(q,j){return j?v:k},argPackAdvance:8,readValueFromPointer:function(q){if(c===1)var j=fe;else if(c===2)j=we;else if(c===4)j=le;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(j[q>>M])},ja:null})},l:function(s,a,c,v,k,M,q,j,z,Z,J,ie,Se){J=be(J),M=Ve(k,M),j&&(j=Ve(q,j)),Z&&(Z=Ve(z,Z)),Se=Ve(ie,Se);var De=U(J);pn(De,function(){$t("Cannot construct "+J+" due to unbound types",[v])}),de([s,a,c],v?[v]:[],function(_e){if(_e=_e[0],v)var je=_e.fa,Ue=je.qa;else Ue=lt.prototype;_e=W(De,function(){if(Object.getPrototypeOf(this)!==dt)throw new Me("Use 'new' to construct "+J);if(Ye.oa===void 0)throw new Me(J+" has no accessible constructor");var pi=Ye.oa[arguments.length];if(pi===void 0)throw new Me("Tried to invoke ctor of "+J+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(Ye.oa).toString()+") parameters instead!");return pi.apply(this,arguments)});var dt=Object.create(Ue,{constructor:{value:_e}});_e.prototype=dt;var Ye=new vr(J,_e,dt,Se,je,M,j,Z);je=new rt(J,Ye,!0,!1),Ue=new rt(J+"*",Ye,!1,!1);var fi=new rt(J+" const*",Ye,!1,!0);return ei[s]={pointerType:Ue,Ja:fi},ii(De,_e),[je,Ue,fi]})},i:function(s,a,c,v,k,M){0<a||ae(void 0);var q=gn(a,c);k=Ve(v,k),de([],[s],function(j){j=j[0];var z="constructor "+j.name;if(j.fa.oa===void 0&&(j.fa.oa=[]),j.fa.oa[a-1]!==void 0)throw new Me("Cannot register multiple constructors with identical number of parameters ("+(a-1)+") for class '"+j.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return j.fa.oa[a-1]=()=>{$t("Cannot construct "+j.name+" due to unbound types",q)},de([],q,function(Z){return Z.splice(1,0,null),j.fa.oa[a-1]=mn(z,Z,null,k,M),[]}),[]})},a:function(s,a,c,v,k,M,q,j){var z=gn(c,v);a=be(a),M=Ve(k,M),de([],[s],function(Z){function J(){$t("Cannot call "+ie+" due to unbound types",z)}Z=Z[0];var ie=Z.name+"."+a;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),j&&Z.fa.Ta.push(a);var Se=Z.fa.qa,De=Se[a];return De===void 0||De.ia===void 0&&De.className!==Z.name&&De.ua===c-2?(J.ua=c-2,J.className=Z.name,Se[a]=J):(ti(Se,a,ie),Se[a].ia[c-2]=J),de([],z,function(_e){return _e=mn(ie,_e,Z,M,q),Se[a].ia===void 0?(_e.ua=c-2,Se[a]=_e):Se[a].ia[c-2]=_e,[]}),[]})},I:function(s,a,c){s=be(s),de([],[a],function(v){return v=v[0],r[s]=v.fromWireType(c),[]})},E:function(s,a){a=be(a),it(s,{name:a,fromWireType:function(c){var v=vn(c);return ai(c),v},toWireType:function(c,v){return ct(v)},argPackAdvance:8,readValueFromPointer:ze,ja:null})},h:function(s,a,c,v){function k(){}c=me(c),a=be(a),k.values={},it(s,{name:a,constructor:k,fromWireType:function(M){return this.constructor.values[M]},toWireType:function(M,q){return q.value},argPackAdvance:8,readValueFromPointer:_r(a,c,v),ja:null}),pn(a,k)},k:function(s,a,c){var v=Pt(s,"enum");a=be(a),s=v.constructor,v=Object.create(v.constructor.prototype,{value:{value:c},constructor:{value:W(v.name+"_"+a,function(){})}}),s.values[c]=v,s[a]=v},q:function(s,a,c){c=me(c),a=be(a),it(s,{name:a,fromWireType:function(v){return v},toWireType:function(v,k){return k},argPackAdvance:8,readValueFromPointer:Tr(a,c),ja:null})},f:function(s,a,c,v,k,M){var q=gn(a,c);s=be(s),k=Ve(v,k),pn(s,function(){$t("Cannot call "+s+" due to unbound types",q)},a-1),de([],q,function(j){return j=[j[0],null].concat(j.slice(1)),ii(s,mn(s,j,null,k,M),a-1),[]})},e:function(s,a,c,v,k){a=be(a),k===-1&&(k=4294967295),k=me(c);var M=j=>j;if(v===0){var q=32-8*c;M=j=>j<<q>>>q}c=a.includes("unsigned")?function(j,z){return z>>>0}:function(j,z){return z},it(s,{name:a,fromWireType:M,toWireType:c,argPackAdvance:8,readValueFromPointer:Or(a,k,v!==0),ja:null})},b:function(s,a,c){function v(M){M>>=2;var q=xe;return new k(ve,q[M+1],q[M])}var k=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];c=be(c),it(s,{name:c,fromWireType:v,argPackAdvance:8,readValueFromPointer:v},{Qa:!0})},p:function(s,a){a=be(a);var c=a==="std::string";it(s,{name:a,fromWireType:function(v){var k=xe[v>>2];if(c)for(var M=v+4,q=0;q<=k;++q){var j=v+4+q;if(q==k||oe[j]==0){if(M=M?E(oe,M,j-M):"",z===void 0)var z=M;else z+=String.fromCharCode(0),z+=M;M=j+1}}else{for(z=Array(k),q=0;q<k;++q)z[q]=String.fromCharCode(oe[v+4+q]);z=z.join("")}return ot(v),z},toWireType:function(v,k){k instanceof ArrayBuffer&&(k=new Uint8Array(k));var M=typeof k=="string";M||k instanceof Uint8Array||k instanceof Uint8ClampedArray||k instanceof Int8Array||ye("Cannot pass non-string to std::string");var q=(c&&M?()=>{for(var Z=0,J=0;J<k.length;++J){var ie=k.charCodeAt(J);55296<=ie&&57343>=ie&&(ie=65536+((ie&1023)<<10)|k.charCodeAt(++J)&1023),127>=ie?++Z:Z=2047>=ie?Z+2:65535>=ie?Z+3:Z+4}return Z}:()=>k.length)(),j=bn(4+q+1);if(xe[j>>2]=q,c&&M)g(k,j+4,q+1);else if(M)for(M=0;M<q;++M){var z=k.charCodeAt(M);255<z&&(ot(j),ye("String has UTF-16 code units that do not fit in 8 bits")),oe[j+4+M]=z}else for(M=0;M<q;++M)oe[j+4+M]=k[M];return v!==null&&v.push(ot,j),j},argPackAdvance:8,readValueFromPointer:ze,ja:function(v){ot(v)}})},m:function(s,a,c){if(c=be(c),a===2)var v=P,k=ne,M=te,q=()=>Re,j=1;else a===4&&(v=re,k=Y,M=ge,q=()=>xe,j=2);it(s,{name:c,fromWireType:function(z){for(var Z=xe[z>>2],J=q(),ie,Se=z+4,De=0;De<=Z;++De){var _e=z+4+De*a;(De==Z||J[_e>>j]==0)&&(Se=v(Se,_e-Se),ie===void 0?ie=Se:(ie+=String.fromCharCode(0),ie+=Se),Se=_e+a)}return ot(z),ie},toWireType:function(z,Z){typeof Z!="string"&&ye("Cannot pass non-string to C++ string type "+c);var J=M(Z),ie=bn(4+J+a);return xe[ie>>2]=J>>j,k(Z,ie+4,J+a),z!==null&&z.push(ot,ie),ie},argPackAdvance:8,readValueFromPointer:ze,ja:function(z){ot(z)}})},t:function(s,a,c,v,k,M){pe[s]={name:be(a),sa:Ve(c,v),la:Ve(k,M),elements:[]}},s:function(s,a,c,v,k,M,q,j,z){pe[s].elements.push({Aa:a,ya:Ve(c,v),za:k,Ea:M,Da:Ve(q,j),Fa:z})},v:function(s,a,c,v,k,M){Ce[s]={name:be(a),sa:Ve(c,v),la:Ve(k,M),Ha:[]}},j:function(s,a,c,v,k,M,q,j,z,Z){Ce[s].Ha.push({Na:be(a),Aa:c,ya:Ve(v,k),za:M,Ea:q,Da:Ve(j,z),Fa:Z})},G:function(s,a){a=be(a),it(s,{Ra:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},d:function(s,a,c,v){s=wn[s],a=vn(a),c=En(c),s(a,c,null,v)},J:ai,x:function(s){return s===0?ct(si()):(s=En(s),ct(si()[s]))},c:function(s,a){var c=xr(s,a),v=c[0];a=v.name+"_$"+c.slice(1).map(function(q){return q.name}).join("_")+"$";var k=li[a];if(k!==void 0)return k;var M=Array(s-1);return k=kr((q,j,z,Z)=>{for(var J=0,ie=0;ie<s-1;++ie)M[ie]=c[ie+1].readValueFromPointer(Z+J),J+=c[ie+1].argPackAdvance;for(q=q[j].apply(q,M),ie=0;ie<s-1;++ie)c[ie+1].Ka&&c[ie+1].Ka(M[ie]);if(!v.Ra)return v.toWireType(z,q)}),li[a]=k},n:function(s){4<s&&(tt[s].Ca+=1)},w:function(s,a,c,v){s=vn(s);var k=ci[a];return k||(k=Ar(a),ci[a]=k),k(s,c,v)},K:function(){return ct([])},D:function(s){return ct(En(s))},H:function(s,a){return s=Pt(s,"_emval_take_value"),s=s.readValueFromPointer(a),ct(s)},g:function(){ae("")},B:function(s){var a=oe.length;if(s>>>=0,2147483648<s)return!1;for(var c=1;4>=c;c*=2){var v=a*(1+.2/c);v=Math.min(v,s+100663296),v=Math.max(s,v),0<v%65536&&(v+=65536-v%65536);e:{try{O.grow(Math.min(2147483648,v)-ve.byteLength+65535>>>16),Fe();var k=1;break e}catch{}k=void 0}if(k)return!0}return!1},C:function(){return 0},y:function(){},o:function(s,a,c,v){for(var k=0,M=0;M<c;M++){var q=le[a>>2],j=le[a+4>>2];a+=8;for(var z=0;z<j;z++){var Z=oe[q+z],J=Cr[s];Z===0||Z===10?((s===1?B:F)(E(J,0)),J.length=0):J.push(Z)}k+=j}return le[v>>2]=k,0},A:function(){}};(function(){function s(k){r.asm=k.exports,O=r.asm.L,Fe(),K=r.asm._,u.unshift(r.asm.M),V--,r.monitorRunDependencies&&r.monitorRunDependencies(V),V==0&&G&&(k=G,G=null,k())}function a(k){s(k.instance)}function c(k){return Ae().then(function(M){return WebAssembly.instantiate(M,v)}).then(function(M){return M}).then(k,function(M){F("failed to asynchronously prepare wasm: "+M),ae(M)})}var v={a:Dr};if(V++,r.monitorRunDependencies&&r.monitorRunDependencies(V),r.instantiateWasm)try{return r.instantiateWasm(v,s)}catch(k){return F("Module.instantiateWasm callback failed with error: "+k),!1}return function(){return Q||typeof WebAssembly.instantiateStreaming!="function"||ce()||se.startsWith("file://")||typeof fetch!="function"?c(a):fetch(se,{credentials:"same-origin"}).then(function(k){return WebAssembly.instantiateStreaming(k,v).then(a,function(M){return F("wasm streaming compile failed: "+M),F("falling back to ArrayBuffer instantiation"),c(a)})})}().catch(I),{}})(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.M).apply(null,arguments)},r.__Z6ToCmdsRK6SkPath=function(){return(r.__Z6ToCmdsRK6SkPath=r.asm.N).apply(null,arguments)},r.__Z8FromCmdsmi=function(){return(r.__Z8FromCmdsmi=r.asm.O).apply(null,arguments)},r.__Z7NewPathv=function(){return(r.__Z7NewPathv=r.asm.P).apply(null,arguments)},r.__Z8CopyPathRK6SkPath=function(){return(r.__Z8CopyPathRK6SkPath=r.asm.Q).apply(null,arguments)},r.__Z6EqualsRK6SkPathS1_=function(){return(r.__Z6EqualsRK6SkPathS1_=r.asm.R).apply(null,arguments)},r.__Z11ToSVGStringRK6SkPath=function(){return(r.__Z11ToSVGStringRK6SkPath=r.asm.S).apply(null,arguments)},r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=function(){return(r.__Z13FromSVGStringNSt3__212basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEE=r.asm.T).apply(null,arguments)},r.__Z13ApplySimplifyR6SkPath=function(){return(r.__Z13ApplySimplifyR6SkPath=r.asm.U).apply(null,arguments)},r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=function(){return(r.__Z11ApplyPathOpR6SkPathRKS_8SkPathOp=r.asm.V).apply(null,arguments)},r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=function(){return(r.__Z10MakeFromOpRK6SkPathS1_8SkPathOp=r.asm.W).apply(null,arguments)},r.__Z14ResolveBuilderR11SkOpBuilder=function(){return(r.__Z14ResolveBuilderR11SkOpBuilder=r.asm.X).apply(null,arguments)},r.__Z8ToCanvasRK6SkPathN10emscripten3valE=function(){return(r.__Z8ToCanvasRK6SkPathN10emscripten3valE=r.asm.Y).apply(null,arguments)},r.__Z8ToPath2DRK6SkPath=function(){return(r.__Z8ToPath2DRK6SkPath=r.asm.Z).apply(null,arguments)};var ot=r._free=function(){return(ot=r._free=r.asm.$).apply(null,arguments)},bn=r._malloc=function(){return(bn=r._malloc=r.asm.aa).apply(null,arguments)},di=r.___getTypeName=function(){return(di=r.___getTypeName=r.asm.ba).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ca).apply(null,arguments)},r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.da).apply(null,arguments)};var Mt;G=function s(){Mt||Sn(),Mt||(G=s)};function Sn(){function s(){if(!Mt&&(Mt=!0,r.calledRun=!0,!h)){if(Te(u),f(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;){var a=r.postRun.shift();w.unshift(a)}Te(w)}}if(!(0<V)){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)X();Te(d),0<V||(r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),s()},1)):s())}}if(r.run=Sn,r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);0<r.preInit.length;)r.preInit.pop()();return Sn(),o.ready}})();i.exports=t})(ji);var Wr=ji.exports;const Gr=qn(Wr),qr="/assets/pathkit-1356ccfa.wasm";let Je=null,Zt="",Jt="",Qt="",en="";const zr="#000000",Kr=8,Yr=[];async function Ui(){await $.scene.local.deleteItems([en,Zt,Jt,Qt]),Zt="",Jt="",en="",Qt="",await $.popover.close(m.POLYTOOLID)}async function Hi(){if(!Je)return;const[i,e]=Je;e(),Je=null,Ui()}async function Wi(){if(!Je)return;const[i,e]=Je,t=i(n=>{n.visible=!1,n.metadata[`${m.EXTENSIONID}/isVisionLine`]=!0,n.points.pop(),n.points.push(n.points[0])});t.points.length>=4&&$.scene.items.addItems([t]),e(),Je=null,Ui()}async function Zr(i,e){if(!e.transformer)if(Je)if(e.target&&(e.target.id===Zt||e.target.id===Jt))Wi();else if(e.target&&(e.target.id===en||e.target.id===Qt))Hi();else{const[t]=Je;t(n=>{n.points.push(e.pointerPosition)})}else{const t=Yt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Gn().tension(0).points([e.pointerPosition,e.pointerPosition]).strokeColor(L.metadata[`${m.EXTENSIONID}/toolColor`]??zr).strokeDash(L.metadata[`${m.EXTENSIONID}/toolStyle`]??Yr).strokeWidth(L.metadata[`${m.EXTENSIONID}/toolWidth`]??Kr).fillOpacity(.5).fillColor("#000000").layer("DRAWING").name("Vision Line (Polygon)").build();Je=await $.interaction.startItemInteraction(n);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Yt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await $.scene.local.addItems([t,o,r,l]),Zt=t.id,Jt=o.id,en=l.id,Qt=r.id,await $.popover.open({id:m.POLYTOOLID,url:"/pages/polygon.html",height:40,width:400,disableClickAway:!0})}}function Jr(i,e){if(!Je||e.transformer)return;const[t]=Je,n=Math.round(L.gridDpi/L.gridSnap),o=Math.round(e.pointerPosition.x/L.gridDpi)*L.gridDpi,r=Math.round(e.pointerPosition.y/L.gridDpi)*L.gridDpi,l=Math.abs(o-e.pointerPosition.x),f=Math.abs(r-e.pointerPosition.y);let I,y;l<=n?I=o:I=e.pointerPosition.x,f<=n?y=r:y=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=L.snap?{x:I,y}:e.pointerPosition})}function Qr(i,e){Je&&(e.key=="Escape"?Hi():e.key=="Enter"&&Wi())}const On={onToolClick:Zr,onToolMove:Jr,onKeyDown:Qr};let Qe=null,Nt="",kt="",tn="",nn="";const eo="#000000",to=8,no=[];async function Gi(){await $.scene.local.deleteItems([nn,Nt,kt,tn]),Nt="",kt="",nn="",tn="",await $.popover.close(m.LINETOOLID)}async function qi(){if(!Qe)return;const[i,e]=Qe;e(),Qe=null,await Gi()}async function zi(){if(!Qe)return;const[i,e]=Qe,t=i(n=>{n.visible=!1,n.metadata[`${m.EXTENSIONID}/isVisionLine`]=!0,n.points.pop()});t.points.length>=2&&await $.scene.items.addItems([t]),e(),Qe=null,await Gi()}async function io(i,e){if(!e.transformer)if(Qe)if(e.target&&(e.target.id===Nt||e.target.id===kt))await zi();else if(e.target&&(e.target.id===nn||e.target.id===tn))await qi();else{const[t]=Qe;t(n=>{n.points.push(e.pointerPosition)}),await $.scene.local.updateItems(n=>n.id==kt||n.id==Nt,n=>{for(const o of n)o.position=e.pointerPosition})}else{const t=Yt().plainText("Finish [Enter]").position({x:e.pointerPosition.x,y:e.pointerPosition.y-50}).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").build(),n=Gn().tension(0).points([e.pointerPosition,e.pointerPosition]).strokeColor(L.metadata[`${m.EXTENSIONID}/toolColor`]??eo).strokeDash(L.metadata[`${m.EXTENSIONID}/toolStyle`]??no).strokeWidth(L.metadata[`${m.EXTENSIONID}/toolWidth`]??to).fillOpacity(0).fillColor("#000000").layer("DRAWING").name("Vision Line (Line)").closed(!1).build();Qe=await $.interaction.startItemInteraction(n);const o=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").build(),r=vt().shapeType("CIRCLE").strokeColor("#FFFFFF").width(8).height(8).strokeWidth(2).position(e.pointerPosition).layer("POPOVER").visible(!1).build(),l=Yt().plainText("Cancel [Escape]").position(e.pointerPosition).fillOpacity(.95).backgroundOpacity(.5).layer("POPOVER").pointerDirection("UP").build();await $.scene.local.addItems([t,o,r,l]),Nt=t.id,kt=o.id,nn=l.id,tn=r.id,await $.popover.open({id:m.LINETOOLID,url:"/pages/line.html",height:40,width:400,disableClickAway:!0})}}function ro(i,e){if(!Qe||e.transformer)return;const[t]=Qe,n=Math.round(L.gridDpi/L.gridSnap),o=Math.round(e.pointerPosition.x/L.gridDpi)*L.gridDpi,r=Math.round(e.pointerPosition.y/L.gridDpi)*L.gridDpi,l=Math.abs(o-e.pointerPosition.x),f=Math.abs(r-e.pointerPosition.y);let I,y;l<=n?I=o:I=e.pointerPosition.x,f<=n?y=r:y=e.pointerPosition.y,t(_=>{_.points[_.points.length-1]=L.snap?{x:I,y}:e.pointerPosition})}function oo(i,e){Qe&&(e.key=="Escape"?qi():e.key=="Enter"&&zi())}const Nn={onToolClick:io,onToolMove:ro,onKeyDown:oo};class Xn{startTime;accumulatedTime;constructor(){this.startTime=-1,this.accumulatedTime=-1}start(){this.startTime=performance.now(),this.accumulatedTime=0}resume(){this.startTime=performance.now()}pause(){return this.accumulatedTime+=performance.now()-this.startTime,this.startTime=-1,this.accumulatedTime}stop(){if(this.startTime!=-1){const e=performance.now()-this.startTime+this.accumulatedTime;return this.accumulatedTime=0,e}else{const e=this.accumulatedTime;return this.accumulatedTime=0,e}}}function Rt(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ki={exports:{}};(function(i,e){(function(t){i.exports=t()})(function(){return function t(n,o,r){function l(y,_){if(!o[y]){if(!n[y]){var x=typeof Rt=="function"&&Rt;if(!_&&x)return x(y,!0);if(f)return f(y,!0);throw new Error("Cannot find module '"+y+"'")}_=o[y]={exports:{}},n[y][0].call(_.exports,function(A){var H=n[y][1][A];return l(H||A)},_,_.exports,t,n,o,r)}return o[y].exports}for(var f=typeof Rt=="function"&&Rt,I=0;I<r.length;I++)l(r[I]);return l}({1:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){var N=t("crypto");function R(O,h){h=C(O,h);var p;return(p=h.algorithm!=="passthrough"?N.createHash(h.algorithm):new Q).write===void 0&&(p.write=p.update,p.end=p.update),F(h,p).dispatch(O),p.update||p.end(""),p.digest?p.digest(h.encoding==="buffer"?void 0:h.encoding):(O=p.read(),h.encoding!=="buffer"?O.toString(h.encoding):O)}(o=n.exports=R).sha1=function(O){return R(O)},o.keys=function(O){return R(O,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},o.MD5=function(O){return R(O,{algorithm:"md5",encoding:"hex"})},o.keysMD5=function(O){return R(O,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var S=N.getHashes?N.getHashes().slice():["sha1","md5"],D=(S.push("passthrough"),["buffer","hex","binary","base64"]);function C(O,h){var p={};if(p.algorithm=(h=h||{}).algorithm||"sha1",p.encoding=h.encoding||"hex",p.excludeValues=!!h.excludeValues,p.algorithm=p.algorithm.toLowerCase(),p.encoding=p.encoding.toLowerCase(),p.ignoreUnknown=h.ignoreUnknown===!0,p.respectType=h.respectType!==!1,p.respectFunctionNames=h.respectFunctionNames!==!1,p.respectFunctionProperties=h.respectFunctionProperties!==!1,p.unorderedArrays=h.unorderedArrays===!0,p.unorderedSets=h.unorderedSets!==!1,p.unorderedObjects=h.unorderedObjects!==!1,p.replacer=h.replacer||void 0,p.excludeKeys=h.excludeKeys||void 0,O===void 0)throw new Error("Object argument required.");for(var E=0;E<S.length;++E)S[E].toLowerCase()===p.algorithm.toLowerCase()&&(p.algorithm=S[E]);if(S.indexOf(p.algorithm)===-1)throw new Error('Algorithm "'+p.algorithm+'"  not supported. supported values: '+S.join(", "));if(D.indexOf(p.encoding)===-1&&p.algorithm!=="passthrough")throw new Error('Encoding "'+p.encoding+'"  not supported. supported values: '+D.join(", "));return p}function B(O){if(typeof O=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(O))!=null}function F(O,h,p){p=p||[];function E(g){return h.update?h.update(g,"utf8"):h.write(g,"utf8")}return{dispatch:function(g){return this["_"+((g=O.replacer?O.replacer(g):g)===null?"null":typeof g)](g)},_object:function(g){var T,P=Object.prototype.toString.call(g),ne=/\[object (.*)\]/i.exec(P);if(ne=(ne=ne?ne[1]:"unknown:["+P+"]").toLowerCase(),0<=(P=p.indexOf(g)))return this.dispatch("[CIRCULAR:"+P+"]");if(p.push(g),f!==void 0&&f.isBuffer&&f.isBuffer(g))return E("buffer:"),E(g);if(ne==="object"||ne==="function"||ne==="asyncfunction")return P=Object.keys(g),O.unorderedObjects&&(P=P.sort()),O.respectType===!1||B(g)||P.splice(0,0,"prototype","__proto__","constructor"),O.excludeKeys&&(P=P.filter(function(te){return!O.excludeKeys(te)})),E("object:"+P.length+":"),T=this,P.forEach(function(te){T.dispatch(te),E(":"),O.excludeValues||T.dispatch(g[te]),E(",")});if(!this["_"+ne]){if(O.ignoreUnknown)return E("["+ne+"]");throw new Error('Unknown object type "'+ne+'"')}this["_"+ne](g)},_array:function(g,te){te=te!==void 0?te:O.unorderedArrays!==!1;var P=this;if(E("array:"+g.length+":"),!te||g.length<=1)return g.forEach(function(re){return P.dispatch(re)});var ne=[],te=g.map(function(re){var Y=new Q,ge=p.slice();return F(O,Y,ge).dispatch(re),ne=ne.concat(ge.slice(p.length)),Y.read().toString()});return p=p.concat(ne),te.sort(),this._array(te,!1)},_date:function(g){return E("date:"+g.toJSON())},_symbol:function(g){return E("symbol:"+g.toString())},_error:function(g){return E("error:"+g.toString())},_boolean:function(g){return E("bool:"+g.toString())},_string:function(g){E("string:"+g.length+":"),E(g.toString())},_function:function(g){E("fn:"),B(g)?this.dispatch("[native]"):this.dispatch(g.toString()),O.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(g.name)),O.respectFunctionProperties&&this._object(g)},_number:function(g){return E("number:"+g.toString())},_xml:function(g){return E("xml:"+g.toString())},_null:function(){return E("Null")},_undefined:function(){return E("Undefined")},_regexp:function(g){return E("regex:"+g.toString())},_uint8array:function(g){return E("uint8array:"),this.dispatch(Array.prototype.slice.call(g))},_uint8clampedarray:function(g){return E("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(g))},_int8array:function(g){return E("int8array:"),this.dispatch(Array.prototype.slice.call(g))},_uint16array:function(g){return E("uint16array:"),this.dispatch(Array.prototype.slice.call(g))},_int16array:function(g){return E("int16array:"),this.dispatch(Array.prototype.slice.call(g))},_uint32array:function(g){return E("uint32array:"),this.dispatch(Array.prototype.slice.call(g))},_int32array:function(g){return E("int32array:"),this.dispatch(Array.prototype.slice.call(g))},_float32array:function(g){return E("float32array:"),this.dispatch(Array.prototype.slice.call(g))},_float64array:function(g){return E("float64array:"),this.dispatch(Array.prototype.slice.call(g))},_arraybuffer:function(g){return E("arraybuffer:"),this.dispatch(new Uint8Array(g))},_url:function(g){return E("url:"+g.toString())},_map:function(g){return E("map:"),g=Array.from(g),this._array(g,O.unorderedSets!==!1)},_set:function(g){return E("set:"),g=Array.from(g),this._array(g,O.unorderedSets!==!1)},_file:function(g){return E("file:"),this.dispatch([g.name,g.size,g.type,g.lastModfied])},_blob:function(){if(O.ignoreUnknown)return E("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return E("domwindow")},_bigint:function(g){return E("bigint:"+g.toString())},_process:function(){return E("process")},_timer:function(){return E("timer")},_pipe:function(){return E("pipe")},_tcp:function(){return E("tcp")},_udp:function(){return E("udp")},_tty:function(){return E("tty")},_statwatcher:function(){return E("statwatcher")},_securecontext:function(){return E("securecontext")},_connection:function(){return E("connection")},_zlib:function(){return E("zlib")},_context:function(){return E("context")},_nodescript:function(){return E("nodescript")},_httpparser:function(){return E("httpparser")},_dataview:function(){return E("dataview")},_signal:function(){return E("signal")},_fsevent:function(){return E("fsevent")},_tlswrap:function(){return E("tlswrap")}}}function Q(){return{buf:"",write:function(O){this.buf+=O},end:function(O){this.buf+=O},read:function(){return this.buf}}}o.writeToStream=function(O,h,p){return p===void 0&&(p=h,h={}),F(h=C(O,h),p).dispatch(O)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_9a5aa49d.js","/")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){(function(N){var R=typeof Uint8Array<"u"?Uint8Array:Array,S="+".charCodeAt(0),D="/".charCodeAt(0),C="0".charCodeAt(0),B="a".charCodeAt(0),F="A".charCodeAt(0),Q="-".charCodeAt(0),O="_".charCodeAt(0);function h(p){return p=p.charCodeAt(0),p===S||p===Q?62:p===D||p===O?63:p<C?-1:p<C+10?p-C+26+26:p<F+26?p-F:p<B+26?p-B+26:void 0}N.toByteArray=function(p){var E,g;if(0<p.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var T=p.length,T=p.charAt(T-2)==="="?2:p.charAt(T-1)==="="?1:0,P=new R(3*p.length/4-T),ne=0<T?p.length-4:p.length,te=0;function re(Y){P[te++]=Y}for(E=0;E<ne;E+=4,0)re((16711680&(g=h(p.charAt(E))<<18|h(p.charAt(E+1))<<12|h(p.charAt(E+2))<<6|h(p.charAt(E+3))))>>16),re((65280&g)>>8),re(255&g);return T==2?re(255&(g=h(p.charAt(E))<<2|h(p.charAt(E+1))>>4)):T==1&&(re((g=h(p.charAt(E))<<10|h(p.charAt(E+1))<<4|h(p.charAt(E+2))>>2)>>8&255),re(255&g)),P},N.fromByteArray=function(p){var E,g,T,P,ne=p.length%3,te="";function re(Y){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(Y)}for(E=0,T=p.length-ne;E<T;E+=3)g=(p[E]<<16)+(p[E+1]<<8)+p[E+2],te+=re((P=g)>>18&63)+re(P>>12&63)+re(P>>6&63)+re(63&P);switch(ne){case 1:te=(te+=re((g=p[p.length-1])>>2))+re(g<<4&63)+"==";break;case 2:te=(te=(te+=re((g=(p[p.length-2]<<8)+p[p.length-1])>>10))+re(g>>4&63))+re(g<<2&63)+"="}return te}})(o===void 0?this.base64js={}:o)}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:11}],3:[function(t,n,o){(function(r,l,S,I,y,_,x,A,H){var N=t("base64-js"),R=t("ieee754");function S(d,u,w){if(!(this instanceof S))return new S(d,u,w);var X,V,G,ae,ce=typeof d;if(u==="base64"&&ce=="string")for(d=(ae=d).trim?ae.trim():ae.replace(/^\s+|\s+$/g,"");d.length%4!=0;)d+="=";if(ce=="number")X=ve(d);else if(ce=="string")X=S.byteLength(d,u);else{if(ce!="object")throw new Error("First argument needs to be a number, array or string.");X=ve(d.length)}if(S._useTypedArrays?V=S._augment(new Uint8Array(X)):((V=this).length=X,V._isBuffer=!0),S._useTypedArrays&&typeof d.byteLength=="number")V._set(d);else if(fe(ae=d)||S.isBuffer(ae)||ae&&typeof ae=="object"&&typeof ae.length=="number")for(G=0;G<X;G++)S.isBuffer(d)?V[G]=d.readUInt8(G):V[G]=d[G];else if(ce=="string")V.write(d,0,u);else if(ce=="number"&&!S._useTypedArrays&&!w)for(G=0;G<X;G++)V[G]=0;return V}function D(d,u,w,X){return S._charsWritten=le(function(V){for(var G=[],ae=0;ae<V.length;ae++)G.push(255&V.charCodeAt(ae));return G}(u),d,w,X)}function C(d,u,w,X){return S._charsWritten=le(function(V){for(var G,ae,ce=[],se=0;se<V.length;se++)ae=V.charCodeAt(se),G=ae>>8,ae=ae%256,ce.push(ae),ce.push(G);return ce}(u),d,w,X)}function B(d,u,w){var X="";w=Math.min(d.length,w);for(var V=u;V<w;V++)X+=String.fromCharCode(d[V]);return X}function F(d,u,w,G){G||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+1<d.length,"Trying to read beyond buffer length"));var V,G=d.length;if(!(G<=u))return w?(V=d[u],u+1<G&&(V|=d[u+1]<<8)):(V=d[u]<<8,u+1<G&&(V|=d[u+1])),V}function Q(d,u,w,G){G||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+3<d.length,"Trying to read beyond buffer length"));var V,G=d.length;if(!(G<=u))return w?(u+2<G&&(V=d[u+2]<<16),u+1<G&&(V|=d[u+1]<<8),V|=d[u],u+3<G&&(V+=d[u+3]<<24>>>0)):(u+1<G&&(V=d[u+1]<<16),u+2<G&&(V|=d[u+2]<<8),u+3<G&&(V|=d[u+3]),V+=d[u]<<24>>>0),V}function O(d,u,w,X){if(X||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+1<d.length,"Trying to read beyond buffer length")),!(d.length<=u))return X=F(d,u,w,!0),32768&X?-1*(65535-X+1):X}function h(d,u,w,X){if(X||(K(typeof w=="boolean","missing or invalid endian"),K(u!=null,"missing offset"),K(u+3<d.length,"Trying to read beyond buffer length")),!(d.length<=u))return X=Q(d,u,w,!0),2147483648&X?-1*(4294967295-X+1):X}function p(d,u,w,X){return X||(K(typeof w=="boolean","missing or invalid endian"),K(u+3<d.length,"Trying to read beyond buffer length")),R.read(d,u,w,23,4)}function E(d,u,w,X){return X||(K(typeof w=="boolean","missing or invalid endian"),K(u+7<d.length,"Trying to read beyond buffer length")),R.read(d,u,w,52,8)}function g(d,u,w,X,V){if(V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+1<d.length,"trying to write beyond buffer length"),Ke(u,65535)),V=d.length,!(V<=w))for(var G=0,ae=Math.min(V-w,2);G<ae;G++)d[w+G]=(u&255<<8*(X?G:1-G))>>>8*(X?G:1-G)}function T(d,u,w,X,V){if(V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"trying to write beyond buffer length"),Ke(u,4294967295)),V=d.length,!(V<=w))for(var G=0,ae=Math.min(V-w,4);G<ae;G++)d[w+G]=u>>>8*(X?G:3-G)&255}function P(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+1<d.length,"Trying to write beyond buffer length"),qe(u,32767,-32768)),d.length<=w||g(d,0<=u?u:65535+u+1,w,X,V)}function ne(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"Trying to write beyond buffer length"),qe(u,2147483647,-2147483648)),d.length<=w||T(d,0<=u?u:4294967295+u+1,w,X,V)}function te(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+3<d.length,"Trying to write beyond buffer length"),Fe(u,34028234663852886e22,-34028234663852886e22)),d.length<=w||R.write(d,u,w,X,23,4)}function re(d,u,w,X,V){V||(K(u!=null,"missing value"),K(typeof X=="boolean","missing or invalid endian"),K(w!=null,"missing offset"),K(w+7<d.length,"Trying to write beyond buffer length"),Fe(u,17976931348623157e292,-17976931348623157e292)),d.length<=w||R.write(d,u,w,X,52,8)}o.Buffer=S,o.SlowBuffer=S,o.INSPECT_MAX_BYTES=50,S.poolSize=8192,S._useTypedArrays=function(){try{var d=new ArrayBuffer(0),u=new Uint8Array(d);return u.foo=function(){return 42},u.foo()===42&&typeof u.subarray=="function"}catch{return!1}}(),S.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},S.isBuffer=function(d){return!(d==null||!d._isBuffer)},S.byteLength=function(d,u){var w;switch(d+="",u||"utf8"){case"hex":w=d.length/2;break;case"utf8":case"utf-8":w=we(d).length;break;case"ascii":case"binary":case"raw":w=d.length;break;case"base64":w=Re(d).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":w=2*d.length;break;default:throw new Error("Unknown encoding")}return w},S.concat=function(d,u){if(K(fe(d),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),d.length===0)return new S(0);if(d.length===1)return d[0];if(typeof u!="number")for(V=u=0;V<d.length;V++)u+=d[V].length;for(var w=new S(u),X=0,V=0;V<d.length;V++){var G=d[V];G.copy(w,X),X+=G.length}return w},S.prototype.write=function(d,u,w,X){isFinite(u)?isFinite(w)||(X=w,w=void 0):(se=X,X=u,u=w,w=se),u=Number(u)||0;var V,G,ae,ce,se=this.length-u;switch((!w||se<(w=Number(w)))&&(w=se),X=String(X||"utf8").toLowerCase()){case"hex":V=function(Ie,Oe,Ae,Te){Ae=Number(Ae)||0;var pe=Ie.length-Ae;(!Te||pe<(Te=Number(Te)))&&(Te=pe),K((pe=Oe.length)%2==0,"Invalid hex string"),pe/2<Te&&(Te=pe/2);for(var Ee=0;Ee<Te;Ee++){var ze=parseInt(Oe.substr(2*Ee,2),16);K(!isNaN(ze),"Invalid hex string"),Ie[Ae+Ee]=ze}return S._charsWritten=2*Ee,Ee}(this,d,u,w);break;case"utf8":case"utf-8":G=this,ae=u,ce=w,V=S._charsWritten=le(we(d),G,ae,ce);break;case"ascii":case"binary":V=D(this,d,u,w);break;case"base64":G=this,ae=u,ce=w,V=S._charsWritten=le(Re(d),G,ae,ce);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":V=C(this,d,u,w);break;default:throw new Error("Unknown encoding")}return V},S.prototype.toString=function(d,u,w){var X,V,G,ae,ce=this;if(d=String(d||"utf8").toLowerCase(),u=Number(u)||0,(w=w!==void 0?Number(w):ce.length)===u)return"";switch(d){case"hex":X=function(se,Ie,Oe){var Ae=se.length;(!Ie||Ie<0)&&(Ie=0),(!Oe||Oe<0||Ae<Oe)&&(Oe=Ae);for(var Te="",pe=Ie;pe<Oe;pe++)Te+=oe(se[pe]);return Te}(ce,u,w);break;case"utf8":case"utf-8":X=function(se,Ie,Oe){var Ae="",Te="";Oe=Math.min(se.length,Oe);for(var pe=Ie;pe<Oe;pe++)se[pe]<=127?(Ae+=xe(Te)+String.fromCharCode(se[pe]),Te=""):Te+="%"+se[pe].toString(16);return Ae+xe(Te)}(ce,u,w);break;case"ascii":case"binary":X=B(ce,u,w);break;case"base64":V=ce,ae=w,X=(G=u)===0&&ae===V.length?N.fromByteArray(V):N.fromByteArray(V.slice(G,ae));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":X=function(se,Ie,Oe){for(var Ae=se.slice(Ie,Oe),Te="",pe=0;pe<Ae.length;pe+=2)Te+=String.fromCharCode(Ae[pe]+256*Ae[pe+1]);return Te}(ce,u,w);break;default:throw new Error("Unknown encoding")}return X},S.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},S.prototype.copy=function(d,u,w,X){if(u=u||0,(X=X||X===0?X:this.length)!==(w=w||0)&&d.length!==0&&this.length!==0){K(w<=X,"sourceEnd < sourceStart"),K(0<=u&&u<d.length,"targetStart out of bounds"),K(0<=w&&w<this.length,"sourceStart out of bounds"),K(0<=X&&X<=this.length,"sourceEnd out of bounds"),X>this.length&&(X=this.length);var V=(X=d.length-u<X-w?d.length-u+w:X)-w;if(V<100||!S._useTypedArrays)for(var G=0;G<V;G++)d[G+u]=this[G+w];else d._set(this.subarray(w,w+V),u)}},S.prototype.slice=function(d,u){var w=this.length;if(d=ge(d,w,0),u=ge(u,w,w),S._useTypedArrays)return S._augment(this.subarray(d,u));for(var X=u-d,V=new S(X,void 0,!0),G=0;G<X;G++)V[G]=this[G+d];return V},S.prototype.get=function(d){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(d)},S.prototype.set=function(d,u){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(d,u)},S.prototype.readUInt8=function(d,u){if(u||(K(d!=null,"missing offset"),K(d<this.length,"Trying to read beyond buffer length")),!(d>=this.length))return this[d]},S.prototype.readUInt16LE=function(d,u){return F(this,d,!0,u)},S.prototype.readUInt16BE=function(d,u){return F(this,d,!1,u)},S.prototype.readUInt32LE=function(d,u){return Q(this,d,!0,u)},S.prototype.readUInt32BE=function(d,u){return Q(this,d,!1,u)},S.prototype.readInt8=function(d,u){if(u||(K(d!=null,"missing offset"),K(d<this.length,"Trying to read beyond buffer length")),!(d>=this.length))return 128&this[d]?-1*(255-this[d]+1):this[d]},S.prototype.readInt16LE=function(d,u){return O(this,d,!0,u)},S.prototype.readInt16BE=function(d,u){return O(this,d,!1,u)},S.prototype.readInt32LE=function(d,u){return h(this,d,!0,u)},S.prototype.readInt32BE=function(d,u){return h(this,d,!1,u)},S.prototype.readFloatLE=function(d,u){return p(this,d,!0,u)},S.prototype.readFloatBE=function(d,u){return p(this,d,!1,u)},S.prototype.readDoubleLE=function(d,u){return E(this,d,!0,u)},S.prototype.readDoubleBE=function(d,u){return E(this,d,!1,u)},S.prototype.writeUInt8=function(d,u,w){w||(K(d!=null,"missing value"),K(u!=null,"missing offset"),K(u<this.length,"trying to write beyond buffer length"),Ke(d,255)),u>=this.length||(this[u]=d)},S.prototype.writeUInt16LE=function(d,u,w){g(this,d,u,!0,w)},S.prototype.writeUInt16BE=function(d,u,w){g(this,d,u,!1,w)},S.prototype.writeUInt32LE=function(d,u,w){T(this,d,u,!0,w)},S.prototype.writeUInt32BE=function(d,u,w){T(this,d,u,!1,w)},S.prototype.writeInt8=function(d,u,w){w||(K(d!=null,"missing value"),K(u!=null,"missing offset"),K(u<this.length,"Trying to write beyond buffer length"),qe(d,127,-128)),u>=this.length||(0<=d?this.writeUInt8(d,u,w):this.writeUInt8(255+d+1,u,w))},S.prototype.writeInt16LE=function(d,u,w){P(this,d,u,!0,w)},S.prototype.writeInt16BE=function(d,u,w){P(this,d,u,!1,w)},S.prototype.writeInt32LE=function(d,u,w){ne(this,d,u,!0,w)},S.prototype.writeInt32BE=function(d,u,w){ne(this,d,u,!1,w)},S.prototype.writeFloatLE=function(d,u,w){te(this,d,u,!0,w)},S.prototype.writeFloatBE=function(d,u,w){te(this,d,u,!1,w)},S.prototype.writeDoubleLE=function(d,u,w){re(this,d,u,!0,w)},S.prototype.writeDoubleBE=function(d,u,w){re(this,d,u,!1,w)},S.prototype.fill=function(d,u,w){if(u=u||0,w=w||this.length,K(typeof(d=typeof(d=d||0)=="string"?d.charCodeAt(0):d)=="number"&&!isNaN(d),"value is not a number"),K(u<=w,"end < start"),w!==u&&this.length!==0){K(0<=u&&u<this.length,"start out of bounds"),K(0<=w&&w<=this.length,"end out of bounds");for(var X=u;X<w;X++)this[X]=d}},S.prototype.inspect=function(){for(var d=[],u=this.length,w=0;w<u;w++)if(d[w]=oe(this[w]),w===o.INSPECT_MAX_BYTES){d[w+1]="...";break}return"<Buffer "+d.join(" ")+">"},S.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(S._useTypedArrays)return new S(this).buffer;for(var d=new Uint8Array(this.length),u=0,w=d.length;u<w;u+=1)d[u]=this[u];return d.buffer};var Y=S.prototype;function ge(d,u,w){return typeof d!="number"?w:u<=(d=~~d)?u:0<=d||0<=(d+=u)?d:0}function ve(d){return(d=~~Math.ceil(+d))<0?0:d}function fe(d){return(Array.isArray||function(u){return Object.prototype.toString.call(u)==="[object Array]"})(d)}function oe(d){return d<16?"0"+d.toString(16):d.toString(16)}function we(d){for(var u=[],w=0;w<d.length;w++){var X=d.charCodeAt(w);if(X<=127)u.push(d.charCodeAt(w));else for(var V=w,G=(55296<=X&&X<=57343&&w++,encodeURIComponent(d.slice(V,w+1)).substr(1).split("%")),ae=0;ae<G.length;ae++)u.push(parseInt(G[ae],16))}return u}function Re(d){return N.toByteArray(d)}function le(d,u,w,X){for(var V=0;V<X&&!(V+w>=u.length||V>=d.length);V++)u[V+w]=d[V];return V}function xe(d){try{return decodeURIComponent(d)}catch{return String.fromCharCode(65533)}}function Ke(d,u){K(typeof d=="number","cannot write a non-number as a number"),K(0<=d,"specified a negative value for writing an unsigned value"),K(d<=u,"value is larger than maximum value for type"),K(Math.floor(d)===d,"value has a fractional component")}function qe(d,u,w){K(typeof d=="number","cannot write a non-number as a number"),K(d<=u,"value larger than maximum allowed value"),K(w<=d,"value smaller than minimum allowed value"),K(Math.floor(d)===d,"value has a fractional component")}function Fe(d,u,w){K(typeof d=="number","cannot write a non-number as a number"),K(d<=u,"value larger than maximum allowed value"),K(w<=d,"value smaller than minimum allowed value")}function K(d,u){if(!d)throw new Error(u||"Failed assertion")}S._augment=function(d){return d._isBuffer=!0,d._get=d.get,d._set=d.set,d.get=Y.get,d.set=Y.set,d.write=Y.write,d.toString=Y.toString,d.toLocaleString=Y.toString,d.toJSON=Y.toJSON,d.copy=Y.copy,d.slice=Y.slice,d.readUInt8=Y.readUInt8,d.readUInt16LE=Y.readUInt16LE,d.readUInt16BE=Y.readUInt16BE,d.readUInt32LE=Y.readUInt32LE,d.readUInt32BE=Y.readUInt32BE,d.readInt8=Y.readInt8,d.readInt16LE=Y.readInt16LE,d.readInt16BE=Y.readInt16BE,d.readInt32LE=Y.readInt32LE,d.readInt32BE=Y.readInt32BE,d.readFloatLE=Y.readFloatLE,d.readFloatBE=Y.readFloatBE,d.readDoubleLE=Y.readDoubleLE,d.readDoubleBE=Y.readDoubleBE,d.writeUInt8=Y.writeUInt8,d.writeUInt16LE=Y.writeUInt16LE,d.writeUInt16BE=Y.writeUInt16BE,d.writeUInt32LE=Y.writeUInt32LE,d.writeUInt32BE=Y.writeUInt32BE,d.writeInt8=Y.writeInt8,d.writeInt16LE=Y.writeInt16LE,d.writeInt16BE=Y.writeInt16BE,d.writeInt32LE=Y.writeInt32LE,d.writeInt32BE=Y.writeInt32BE,d.writeFloatLE=Y.writeFloatLE,d.writeFloatBE=Y.writeFloatBE,d.writeDoubleLE=Y.writeDoubleLE,d.writeDoubleBE=Y.writeDoubleBE,d.fill=Y.fill,d.inspect=Y.inspect,d.toArrayBuffer=Y.toArrayBuffer,d}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(t,n,o){(function(r,l,N,I,y,_,x,A,H){var N=t("buffer").Buffer,R=4,S=new N(R);S.fill(0),n.exports={hash:function(D,C,B,F){for(var Q=C(function(g,T){g.length%R!=0&&(P=g.length+(R-g.length%R),g=N.concat([g,S],P));for(var P,ne=[],te=T?g.readInt32BE:g.readInt32LE,re=0;re<g.length;re+=R)ne.push(te.call(g,re));return ne}(D=N.isBuffer(D)?D:new N(D),F),8*D.length),C=F,O=new N(B),h=C?O.writeInt32BE:O.writeInt32LE,p=0;p<Q.length;p++)h.call(O,Q[p],4*p,!0);return O}}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],5:[function(t,n,o){(function(r,l,N,I,y,_,x,A,H){var N=t("buffer").Buffer,R=t("./sha"),S=t("./sha256"),D=t("./rng"),C={sha1:R,sha256:S,md5:t("./md5")},B=64,F=new N(B);function Q(g,T){var P=C[g=g||"sha1"],ne=[];return P||O("algorithm:",g,"is not yet supported"),{update:function(te){return N.isBuffer(te)||(te=new N(te)),ne.push(te),te.length,this},digest:function(te){var re=N.concat(ne),re=T?function(Y,ge,ve){N.isBuffer(ge)||(ge=new N(ge)),N.isBuffer(ve)||(ve=new N(ve)),ge.length>B?ge=Y(ge):ge.length<B&&(ge=N.concat([ge,F],B));for(var fe=new N(B),oe=new N(B),we=0;we<B;we++)fe[we]=54^ge[we],oe[we]=92^ge[we];return ve=Y(N.concat([fe,ve])),Y(N.concat([oe,ve]))}(P,T,re):P(re);return ne=null,te?re.toString(te):re}}}function O(){var g=[].slice.call(arguments).join(" ");throw new Error([g,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}F.fill(0),o.createHash=function(g){return Q(g)},o.createHmac=Q,o.randomBytes=function(g,T){if(!T||!T.call)return new N(D(g));try{T.call(this,void 0,new N(D(g)))}catch(P){T(P)}};var h,p=["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],E=function(g){o[g]=function(){O("sorry,",g,"is not implemented yet")}};for(h in p)E(p[h])}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:11}],6:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){var N=t("./helpers");function R(O,h){O[h>>5]|=128<<h%32,O[14+(h+64>>>9<<4)]=h;for(var p=1732584193,E=-271733879,g=-1732584194,T=271733878,P=0;P<O.length;P+=16){var ne=p,te=E,re=g,Y=T,p=D(p,E,g,T,O[P+0],7,-680876936),T=D(T,p,E,g,O[P+1],12,-389564586),g=D(g,T,p,E,O[P+2],17,606105819),E=D(E,g,T,p,O[P+3],22,-1044525330);p=D(p,E,g,T,O[P+4],7,-176418897),T=D(T,p,E,g,O[P+5],12,1200080426),g=D(g,T,p,E,O[P+6],17,-1473231341),E=D(E,g,T,p,O[P+7],22,-45705983),p=D(p,E,g,T,O[P+8],7,1770035416),T=D(T,p,E,g,O[P+9],12,-1958414417),g=D(g,T,p,E,O[P+10],17,-42063),E=D(E,g,T,p,O[P+11],22,-1990404162),p=D(p,E,g,T,O[P+12],7,1804603682),T=D(T,p,E,g,O[P+13],12,-40341101),g=D(g,T,p,E,O[P+14],17,-1502002290),p=C(p,E=D(E,g,T,p,O[P+15],22,1236535329),g,T,O[P+1],5,-165796510),T=C(T,p,E,g,O[P+6],9,-1069501632),g=C(g,T,p,E,O[P+11],14,643717713),E=C(E,g,T,p,O[P+0],20,-373897302),p=C(p,E,g,T,O[P+5],5,-701558691),T=C(T,p,E,g,O[P+10],9,38016083),g=C(g,T,p,E,O[P+15],14,-660478335),E=C(E,g,T,p,O[P+4],20,-405537848),p=C(p,E,g,T,O[P+9],5,568446438),T=C(T,p,E,g,O[P+14],9,-1019803690),g=C(g,T,p,E,O[P+3],14,-187363961),E=C(E,g,T,p,O[P+8],20,1163531501),p=C(p,E,g,T,O[P+13],5,-1444681467),T=C(T,p,E,g,O[P+2],9,-51403784),g=C(g,T,p,E,O[P+7],14,1735328473),p=B(p,E=C(E,g,T,p,O[P+12],20,-1926607734),g,T,O[P+5],4,-378558),T=B(T,p,E,g,O[P+8],11,-2022574463),g=B(g,T,p,E,O[P+11],16,1839030562),E=B(E,g,T,p,O[P+14],23,-35309556),p=B(p,E,g,T,O[P+1],4,-1530992060),T=B(T,p,E,g,O[P+4],11,1272893353),g=B(g,T,p,E,O[P+7],16,-155497632),E=B(E,g,T,p,O[P+10],23,-1094730640),p=B(p,E,g,T,O[P+13],4,681279174),T=B(T,p,E,g,O[P+0],11,-358537222),g=B(g,T,p,E,O[P+3],16,-722521979),E=B(E,g,T,p,O[P+6],23,76029189),p=B(p,E,g,T,O[P+9],4,-640364487),T=B(T,p,E,g,O[P+12],11,-421815835),g=B(g,T,p,E,O[P+15],16,530742520),p=F(p,E=B(E,g,T,p,O[P+2],23,-995338651),g,T,O[P+0],6,-198630844),T=F(T,p,E,g,O[P+7],10,1126891415),g=F(g,T,p,E,O[P+14],15,-1416354905),E=F(E,g,T,p,O[P+5],21,-57434055),p=F(p,E,g,T,O[P+12],6,1700485571),T=F(T,p,E,g,O[P+3],10,-1894986606),g=F(g,T,p,E,O[P+10],15,-1051523),E=F(E,g,T,p,O[P+1],21,-2054922799),p=F(p,E,g,T,O[P+8],6,1873313359),T=F(T,p,E,g,O[P+15],10,-30611744),g=F(g,T,p,E,O[P+6],15,-1560198380),E=F(E,g,T,p,O[P+13],21,1309151649),p=F(p,E,g,T,O[P+4],6,-145523070),T=F(T,p,E,g,O[P+11],10,-1120210379),g=F(g,T,p,E,O[P+2],15,718787259),E=F(E,g,T,p,O[P+9],21,-343485551),p=Q(p,ne),E=Q(E,te),g=Q(g,re),T=Q(T,Y)}return Array(p,E,g,T)}function S(O,h,p,E,g,T){return Q((h=Q(Q(h,O),Q(E,T)))<<g|h>>>32-g,p)}function D(O,h,p,E,g,T,P){return S(h&p|~h&E,O,h,g,T,P)}function C(O,h,p,E,g,T,P){return S(h&E|p&~E,O,h,g,T,P)}function B(O,h,p,E,g,T,P){return S(h^p^E,O,h,g,T,P)}function F(O,h,p,E,g,T,P){return S(p^(h|~E),O,h,g,T,P)}function Q(O,h){var p=(65535&O)+(65535&h);return(O>>16)+(h>>16)+(p>>16)<<16|65535&p}n.exports=function(O){return N.hash(O,R,16)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],7:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){n.exports=function(N){for(var R,S=new Array(N),D=0;D<N;D++)!(3&D)&&(R=4294967296*Math.random()),S[D]=R>>>((3&D)<<3)&255;return S}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:11}],8:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){var N=t("./helpers");function R(C,B){C[B>>5]|=128<<24-B%32,C[15+(B+64>>9<<4)]=B;for(var F,Q,O,h=Array(80),p=1732584193,E=-271733879,g=-1732584194,T=271733878,P=-1009589776,ne=0;ne<C.length;ne+=16){for(var te=p,re=E,Y=g,ge=T,ve=P,fe=0;fe<80;fe++){h[fe]=fe<16?C[ne+fe]:D(h[fe-3]^h[fe-8]^h[fe-14]^h[fe-16],1);var oe=S(S(D(p,5),(oe=E,Q=g,O=T,(F=fe)<20?oe&Q|~oe&O:!(F<40)&&F<60?oe&Q|oe&O|Q&O:oe^Q^O)),S(S(P,h[fe]),(F=fe)<20?1518500249:F<40?1859775393:F<60?-1894007588:-899497514)),P=T,T=g,g=D(E,30),E=p,p=oe}p=S(p,te),E=S(E,re),g=S(g,Y),T=S(T,ge),P=S(P,ve)}return Array(p,E,g,T,P)}function S(C,B){var F=(65535&C)+(65535&B);return(C>>16)+(B>>16)+(F>>16)<<16|65535&F}function D(C,B){return C<<B|C>>>32-B}n.exports=function(C){return N.hash(C,R,20,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],9:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){function N(B,F){var Q=(65535&B)+(65535&F);return(B>>16)+(F>>16)+(Q>>16)<<16|65535&Q}function R(B,F){var Q,O=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),h=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),p=new Array(64);B[F>>5]|=128<<24-F%32,B[15+(F+64>>9<<4)]=F;for(var E,g,T=0;T<B.length;T+=16){for(var P=h[0],ne=h[1],te=h[2],re=h[3],Y=h[4],ge=h[5],ve=h[6],fe=h[7],oe=0;oe<64;oe++)p[oe]=oe<16?B[oe+T]:N(N(N((g=p[oe-2],D(g,17)^D(g,19)^C(g,10)),p[oe-7]),(g=p[oe-15],D(g,7)^D(g,18)^C(g,3))),p[oe-16]),Q=N(N(N(N(fe,D(g=Y,6)^D(g,11)^D(g,25)),Y&ge^~Y&ve),O[oe]),p[oe]),E=N(D(E=P,2)^D(E,13)^D(E,22),P&ne^P&te^ne&te),fe=ve,ve=ge,ge=Y,Y=N(re,Q),re=te,te=ne,ne=P,P=N(Q,E);h[0]=N(P,h[0]),h[1]=N(ne,h[1]),h[2]=N(te,h[2]),h[3]=N(re,h[3]),h[4]=N(Y,h[4]),h[5]=N(ge,h[5]),h[6]=N(ve,h[6]),h[7]=N(fe,h[7])}return h}var S=t("./helpers"),D=function(B,F){return B>>>F|B<<32-F},C=function(B,F){return B>>>F};n.exports=function(B){return S.hash(B,R,32,!0)}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:11}],10:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){o.read=function(N,R,S,D,T){var B,F,Q=8*T-D-1,O=(1<<Q)-1,h=O>>1,p=-7,E=S?T-1:0,g=S?-1:1,T=N[R+E];for(E+=g,B=T&(1<<-p)-1,T>>=-p,p+=Q;0<p;B=256*B+N[R+E],E+=g,p-=8);for(F=B&(1<<-p)-1,B>>=-p,p+=D;0<p;F=256*F+N[R+E],E+=g,p-=8);if(B===0)B=1-h;else{if(B===O)return F?NaN:1/0*(T?-1:1);F+=Math.pow(2,D),B-=h}return(T?-1:1)*F*Math.pow(2,B-D)},o.write=function(N,R,S,D,C,P){var F,Q,O=8*P-C-1,h=(1<<O)-1,p=h>>1,E=C===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=D?0:P-1,T=D?1:-1,P=R<0||R===0&&1/R<0?1:0;for(R=Math.abs(R),isNaN(R)||R===1/0?(Q=isNaN(R)?1:0,F=h):(F=Math.floor(Math.log(R)/Math.LN2),R*(D=Math.pow(2,-F))<1&&(F--,D*=2),2<=(R+=1<=F+p?E/D:E*Math.pow(2,1-p))*D&&(F++,D/=2),h<=F+p?(Q=0,F=h):1<=F+p?(Q=(R*D-1)*Math.pow(2,C),F+=p):(Q=R*Math.pow(2,p-1)*Math.pow(2,C),F=0));8<=C;N[S+g]=255&Q,g+=T,Q/=256,C-=8);for(F=F<<C|Q,O+=C;0<O;N[S+g]=255&F,g+=T,F/=256,O-=8);N[S+g-T]|=128*P}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/ieee754/index.js","/node_modules/gulp-browserify/node_modules/ieee754")},{buffer:3,lYpoI2:11}],11:[function(t,n,o){(function(r,l,f,I,y,_,x,A,H){var N,R,S;function D(){}(r=n.exports={}).nextTick=(R=typeof window<"u"&&window.setImmediate,S=typeof window<"u"&&window.postMessage&&window.addEventListener,R?function(C){return window.setImmediate(C)}:S?(N=[],window.addEventListener("message",function(C){var B=C.source;B!==window&&B!==null||C.data!=="process-tick"||(C.stopPropagation(),0<N.length&&N.shift()())},!0),function(C){N.push(C),window.postMessage("process-tick","*")}):function(C){setTimeout(C,0)}),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=D,r.addListener=D,r.once=D,r.off=D,r.removeListener=D,r.removeAllListeners=D,r.emit=D,r.binding=function(C){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(C){throw new Error("process.chdir is not supported")}}).call(this,t("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:11}]},{},[1])(1)})})(Ki);var ao=Ki.exports;const Ft=qn(ao);class so{cache;useHash;constructor(e){this.cache={},this.useHash=e}cacheValue(e,t){this.cache[this.useHash?Ft(e):String(e)]=t}deleteValue(e){delete this.cache[this.useHash?Ft(e):String(e)]}getValue(e){return this.cache[this.useHash?Ft(e):String(e)]}isCached(e){return(this.useHash?Ft(e):String(e))in this.cache}invalidate(e){e&&Object.entries(this.cache).forEach(([t,n])=>e(t,n)),this.cache={}}}function Bt(i,e){return(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)}function Yi(i,e){return i.x==e.x&&i.y==e.y}function Xt(i,e,t){return t===void 0&&(t=.01),Math.abs(i-e)<=t}function kn(i,e){return(i%e+e)%e}async function lo(){await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-door`,icons:[{icon:"/opendoor.svg",label:"Enable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${m.EXTENSIONID}/isDoor`],value:void 0},{key:["metadata",`${m.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}},{icon:"/closedoor.svg",label:"Disable Door",filter:{every:[{key:"layer",value:"DRAWING"},{key:["metadata",`${m.EXTENSIONID}/doorId`],value:void 0}],roles:["GM"]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${m.EXTENSIONID}/isDoor`]===void 0);await $.scene.items.updateItems(i.items,t=>{for(const n of t)e?n.metadata[`${m.EXTENSIONID}/isDoor`]=!0:delete n.metadata[`${m.EXTENSIONID}/isDoor`]}),e?await rn(i.items):await co(i.items)}})}async function co(i){const e=await $.scene.local.getItems(n=>n.metadata[`${m.EXTENSIONID}/doorId`]!==void 0),t=[];for(let n of e){let o=!1;for(const r of i)n.metadata[`${m.EXTENSIONID}/doorId`]==r.id&&(o=!0);o&&t.push(n.id)}await $.scene.local.deleteItems(t)}async function rn(i){const e=[],t=await $.scene.local.getItems(n=>n.metadata[`${m.EXTENSIONID}/doorId`]!==void 0);for(const n of i){if(!Lr(n)||t.some(l=>l.metadata[`${m.EXTENSIONID}/doorId`]===n.id))continue;const o=Xe.fromItem(n),r=[];for(let l=0;l<n.points.length;l++){const f=Xe.fromPosition(n.points[l]);r.push(Xe.decompose(Xe.multiply(o,f)).position)}e.push(Ot().locked(!0).commands(Zi(n.metadata[`${m.EXTENSIONID}/disabled`]===!0)).scale({x:.2,y:.2}).name("Door").position(Ut.centroid(r)).metadata({[`${m.EXTENSIONID}/doorId`]:n.id}).build())}e.length>0&&$.scene.local.addItems(e)}async function uo(i){const e=await $.scene.local.getItems(t=>t.id===i&&t.metadata[`${m.EXTENSIONID}/doorId`]!==void 0);if(e.length===1){const t=e[0].metadata[`${m.EXTENSIONID}/doorId`],n=L.items.filter(o=>o.id===t);await $.scene.items.updateItems(n,o=>{const r=o[0];r.metadata[`${m.EXTENSIONID}/isVisionLine`]&&r.metadata[`${m.EXTENSIONID}/disabled`]?(delete r.metadata[`${m.EXTENSIONID}/disabled`],delete r.metadata[`${m.EXTENSIONID}/doorOpen`]):r.metadata[`${m.EXTENSIONID}/isVisionLine`]&&(r.metadata[`${m.EXTENSIONID}/disabled`]=!0,r.metadata[`${m.EXTENSIONID}/doorOpen`]=!0)}),await $.player.deselect([i])}}async function fo(){const i=await $.scene.items.getItems(e=>e.metadata[`${m.EXTENSIONID}/isDoor`]===!0);rn(i)}function Zi(i){return i?m.DOOROPEN:m.DOORCLOSED}async function po(i){i?await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-autohide-menu`,icons:[{icon:"/autohide-off.svg",label:"Enable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${m.EXTENSIONID}/hasAutohide`],value:void 0}],roles:["GM"]}},{icon:"/autohide-on.svg",label:"Disable Autohide",filter:{every:[{key:"layer",value:"CHARACTER"}],roles:["GM"]}}],async onClick(e){const t=e.items.every(n=>n.metadata[`${m.EXTENSIONID}/hasAutohide`]===void 0);await $.scene.items.updateItems(e.items,n=>{for(const o of n)t?o.metadata[`${m.EXTENSIONID}/hasAutohide`]=!0:delete o.metadata[`${m.EXTENSIONID}/hasAutohide`]})}}):await $.contextMenu.remove(`${m.EXTENSIONID}/toggle-autohide-menu`)}async function ho(){await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-vision-menu`,icons:[{icon:"/no-vision.svg",label:"Enable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"&&"},{key:["metadata",`${m.EXTENSIONID}/hasVision`],value:void 0}]}},{icon:"/icon.svg",label:"Disable Vision",filter:{every:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"ATTACHMENT",coordinator:"||"}]}}],async onClick(i){const e=i.items.every(t=>t.metadata[`${m.EXTENSIONID}/hasVision`]===void 0);await $.scene.items.updateItems(i.items,t=>{for(const n of t)e?(n.metadata[`${m.EXTENSIONID}/hasVision`]=!0,n.metadata[`${m.EXTENSIONID}/visionRange`]===void 0&&(n.metadata[`${m.EXTENSIONID}/visionRange`]=m.VISIONDEFAULT)):delete n.metadata[`${m.EXTENSIONID}/hasVision`]})}}),await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-groupvision-menu`,icons:[{icon:"/no-vision.svg",label:"Toggle Attachments Vision",filter:{every:[{key:"layer",value:"NOTE"},{key:["metadata",`${m.EXTENSIONID}/hasVision`],value:void 0}]}}],async onClick(i){if(i.items.length>0){const e=i.items.map(n=>n.id),t=await $.scene.items.getItemAttachments(e);await $.scene.items.updateItems(t,n=>{for(const o of n)e.includes(o.attachedTo)&&(o.metadata[`${m.EXTENSIONID}/hasVision`]&&(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")?delete o.metadata[`${m.EXTENSIONID}/hasVision`]:(o.layer=="CHARACTER"||o.layer=="ATTACHMENT")&&(o.metadata[`${m.EXTENSIONID}/hasVision`]=!0,o.metadata[`${m.EXTENSIONID}/visionRange`]===void 0&&(o.metadata[`${m.EXTENSIONID}/visionRange`]=m.VISIONDEFAULT)))})}}}),await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-vision-line`,icons:[{icon:"/icon.svg",label:"Disable Vision Line",filter:{some:[{key:["metadata",`${m.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.EXTENSIONID}/disabled`],value:void 0,coordinator:"||"},{key:["metadata",`${m.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.ARMINDOID}/disabled`],value:void 0}]}},{icon:"/no-vision.svg",label:"Enable Vision Line",filter:{some:[{key:["metadata",`${m.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${m.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await $.scene.items.updateItems(i.items,e=>{for(const t of e)t.metadata[`${m.EXTENSIONID}/isVisionLine`]&&t.metadata[`${m.EXTENSIONID}/disabled`]?delete t.metadata[`${m.EXTENSIONID}/disabled`]:t.metadata[`${m.EXTENSIONID}/isVisionLine`]&&(t.metadata[`${m.EXTENSIONID}/disabled`]=!0)})}}),await $.contextMenu.create({id:`${m.EXTENSIONID}/switch-one-sided-type`,icons:[{icon:"/two-sided.svg",label:"Two-sided",filter:{some:[{key:["metadata",`${m.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.EXTENSIONID}/oneSided`],value:void 0,coordinator:"||"},{key:["metadata",`${m.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.ARMINDOID}/oneSided`],value:void 0}]}},{icon:"/left-sided.svg",label:"One-sided left",filter:{some:[{key:["metadata",`${m.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.EXTENSIONID}/oneSided`],value:"left",coordinator:"||"},{key:["metadata",`${m.ARMINDOID}/isVisionLine`],value:!0,coordinator:"&&"},{key:["metadata",`${m.ARMINDOID}/oneSided`],value:"left"}]}},{icon:"/right-sided.svg",label:"One-sided right",filter:{some:[{key:["metadata",`${m.EXTENSIONID}/isVisionLine`],value:!0,coordinator:"||"},{key:["metadata",`${m.ARMINDOID}/isVisionLine`],value:!0}]}}],async onClick(i){await $.scene.items.updateItems(i.items,e=>{for(const t of e)(t.metadata[`${m.EXTENSIONID}/isVisionLine`]||t.metadata[`${m.ARMINDOID}/isVisionLine`])&&(t.metadata[`${m.EXTENSIONID}/oneSided`]=="right"||t.metadata[`${m.ARMINDOID}/oneSided`]=="right")?(delete t.metadata[`${m.EXTENSIONID}/oneSided`],delete t.metadata[`${m.ARMINDOID}/oneSided`]):(t.metadata[`${m.EXTENSIONID}/isVisionLine`]||t.metadata[`${m.ARMINDOID}/isVisionLine`])&&(t.metadata[`${m.EXTENSIONID}/oneSided`]=="left"||t.metadata[`${m.ARMINDOID}/oneSided`]=="left")?(t.metadata[`${m.EXTENSIONID}/oneSided`]="right",t.metadata[`${m.ARMINDOID}/oneSided`]="right"):(t.metadata[`${m.EXTENSIONID}/isVisionLine`]||t.metadata[`${m.ARMINDOID}/isVisionLine`])&&(t.metadata[`${m.EXTENSIONID}/oneSided`]="left",t.metadata[`${m.ARMINDOID}/oneSided`]="left")})}}),await $.contextMenu.create({id:`${m.EXTENSIONID}/toggle-fog-background`,icons:[{icon:"/fog-background.svg",label:"Convert To Fog Background",filter:{every:[{key:"layer",value:"MAP"}]}}],async onClick(i){i.items.length>0&&await $.scene.items.updateItems(i.items,e=>{for(let t=0;t<e.length;t++)e[t].zIndex=1,e[t].layer="FOG",e[t].disableHit=!0,e[t].locked=!1,e[t].visible=!1,e[t].metadata[`${m.EXTENSIONID}/isBackgroundMap`]=!0})}})}async function go(){await $.tool.create({id:`${m.EXTENSIONID}/vision-tool`,icons:[{icon:"/icon.svg",label:"Setup Vision"}],async onClick(){await $.tool.activateTool(`${m.EXTENSIONID}/vision-tool`)}})}async function mo(){await $.tool.createMode({id:`${m.EXTENSIONID}/add-vision-polygon-mode`,icons:[{icon:"/object.svg",label:"Add Obstruction Object",filter:{activeTools:[`${m.EXTENSIONID}/vision-tool`]}}],onToolClick:On.onToolClick,onToolMove:On.onToolMove,onKeyDown:On.onKeyDown}),await $.tool.createMode({id:`${m.EXTENSIONID}/add-vision-line-mode`,icons:[{icon:"/line.svg",label:"Add Obstruction Line",filter:{activeTools:[`${m.EXTENSIONID}/vision-tool`]}}],onToolClick:Nn.onToolClick,onToolMove:Nn.onToolMove,onKeyDown:Nn.onKeyDown})}function yo(i){for(const[e,t]of Object.entries(i)){const n=document.getElementById(e);e=="compute_time"||e=="communication_time"||e[0]=="s"?n&&(n.innerText=Number.parseFloat(t).toFixed(1)+"ms"):n&&(n.innerText=t)}}function vo(i){let e=[];for(const t of i)if(!(!t.points||t.points.length<=1))for(let n=0;n<t.points.length-1;n++){let o,r;const l=Xe.fromItem(t),f=Xe.fromPosition(t.points[n]),I=Xe.fromPosition(t.points[n+1]);o=Xe.decompose(Xe.multiply(l,f)).position,r=Xe.decompose(Xe.multiply(l,I)).position,e.push({startPosition:o,endPosition:r,originalShape:t,oneSided:t.metadata[`${m.EXTENSIONID}/oneSided`]})}return e}function Io(i,e,t,n,o,r){let l=[],f=[t,n];const I=L.players.filter(D=>D.role=="GM"),y=L.metadata[`${m.EXTENSIONID}/quality`]!="accurate",_=e.some(At);for(const D of e){const C=L.userId===D.createdUserId,B=I.some(h=>h.id==D.createdUserId);if(!C&&L.role!=="GM"&&!B)continue;const F=D.metadata[`${m.EXTENSIONID}/visionRange`],Q=mt.getValue(D.id);if(l.push([]),Q!==void 0&&Yi(Q.player.position,D.position)&&Q.player.metadata[`${m.EXTENSIONID}/visionRange`]===F)continue;let O=1e3*L.gridDpi;F&&(O=L.gridDpi*(F/L.gridScale+.5));for(const h of i){const p=(D.position.x-h.startPosition.x)*(h.endPosition.y-h.startPosition.y)-(D.position.y-h.startPosition.y)*(h.endPosition.x-h.startPosition.x);if(h.oneSided!==void 0&&(h.oneSided=="right"&&p>0||h.oneSided=="left"&&p<0))continue;let E=h.startPosition.x,g=h.startPosition.y,T=h.endPosition.x,P=h.endPosition.y;if(E<o[0]||g<o[1]||E>o[0]+f[0]||g>o[1]+f[1]||T<o[0]||P<o[1]||T>o[0]+f[0]||P>o[1]+f[1])continue;if(y&&(!_||At(D))){const le=[h.startPosition,h.endPosition],xe=Ut.distance(h.startPosition,h.endPosition),qe=Math.floor(xe/(O/3));for(let K=1;K<qe;K++)le.push(Ut.lerp(h.startPosition,h.endPosition,K/qe));let Fe=!0;for(const K of le)Ut.compare(D.position,K,O)&&(Fe=!1);if(Fe)continue}const ne={x:h.startPosition.x-D.position.x,y:h.startPosition.y-D.position.y},te={x:h.endPosition.x-D.position.x,y:h.endPosition.y-D.position.y};var x={x:0,y:0},A={x:0,y:0},H=0,N=0,R=0,S=0;//! This is probably not required if we later compute the intersection
//! (using PathKit) of these polygons with a base rectangle the size of
//! our background image
ne.x<0?H=o[0]*r[0]:H=(t+o[0])*r[0],ne.y<0?N=o[1]*r[1]:N=(n+o[1])*r[1],te.x<0?R=o[0]*r[0]:R=(t+o[0])*r[0],te.y<0?S=o[1]*r[1]:S=(n+o[1])*r[1];const re=[],Y=[];if(ne.x!=0){const le=ne.y/ne.x,xe=h.startPosition.y-le*h.startPosition.x;re.push({x:H,y:le*H+xe})}if(ne.y!=0){const le=ne.x/ne.y,xe=le*h.startPosition.y-h.startPosition.x;re.push({x:le*N-xe,y:N})}if(te.x!=0){const le=te.y/te.x,xe=h.endPosition.y-le*h.endPosition.x;Y.push({x:R,y:le*R+xe})}if(te.y!=0){const le=te.x/te.y,xe=le*h.endPosition.y-h.endPosition.x;Y.push({x:le*S-xe,y:S})}re.length==1||Bt(re[0],h.startPosition)<Bt(re[1],h.startPosition)?x=re[0]:x=re[1],Y.length==1||Bt(Y[0],h.endPosition)<Bt(Y[1],h.endPosition)?A=Y[0]:A=Y[1];const ge=[{x:h.startPosition.x,y:h.startPosition.y},x,A,{x:h.endPosition.x,y:h.endPosition.y}],ve=[{x:(t+o[0])*r[0],y:o[1]*r[1]},{x:(t+o[0])*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:(n+o[1])*r[1]},{x:o[0]*r[0],y:o[1]*r[1]}],fe=[0,0];let oe=0;for(const le of[x,A])Xt(le.y,o[1]*r[1])?fe[oe]=0:Xt(le.y,(n+o[1])*r[1])?fe[oe]=2:Xt(le.x,o[0]*r[0])?fe[oe]=3:Xt(le.x,(t+o[0])*r[0])&&(fe[oe]=1),oe++;let we=Math.sign(p);we=we==0?1:-we;const Re=we==1?fe[1]:kn(fe[1]-1,4);for(let le=fe[0]+(we==1?0:-1);kn(le,4)!=Re;le+=we)ge.splice(ge.length-2,0,ve[kn(le,4)]);l[l.length-1].push({pointset:ge,fromShape:h.originalShape})}}return l}var $e,ut=!1;const mt=new so(!1);async function Eo(i){if(await $.player.setMetadata({[`${m.EXTENSIONID}/processed`]:!1}),ut=!0,$e||($e=await Gr({locateFile:()=>qr})),!await $.scene.isReady()){mt.invalidate((u,w)=>w.shadowPath.delete()),ut=!1;return}const e=[];for(let u=0;u<=6;u++)e.push(new Xn);e[1].start();const{awaitTimer:t,computeTimer:n,metadata:o,visionShapes:r,tokensWithVision:l,invalidateCache:f}=i.detail;let I=i.detail.size,y=i.detail.offset,_=i.detail.scale,[x,A]=I;if(L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]===!0){const u=await $.scene.items.getItems(X=>X.layer==="MAP"&&zn(X));let w=[];for(let X of u){let V=L.gridDpi/X.grid.dpi,G=X.position.x-V*X.grid.offset.x*X.scale.x,ae=X.position.y-V*X.grid.offset.y*X.scale.y,ce=G+V*X.image.width*X.scale.x,se=ae+V*X.image.height*X.scale.y;w.length?(G<w[0]&&(w[0]=G),ae<w[1]&&(w[1]=ae),ce>w[2]&&(w[2]=ce),se>w[3]&&(w[3]=se)):(w[0]=G,w[1]=ae,w[2]=ce,w[3]=se)}y=[w[0],w[1]],I=[w[2]-w[0],w[3]-w[1]],_=[1,1],[x,A]=I}let N=0,R=0;if(f&&mt.invalidate((u,w)=>w.shadowPath.delete()),n.resume(),!(o[`${m.EXTENSIONID}/visionEnabled`]===!0)||l.length==0){const u=await $.scene.local.getItems(Bn);await $.scene.local.deleteItems(u.map(w=>w.id)),ut=!1;return}const D=vo(r),C=Io(D,l,x,A,y,_);if(C.length==0){ut=!1;return}const B=[];e[1].pause(),e[2].start();const F={};for(let u=0;u<C.length;u++){const w=l[u];let X=mt.getValue(w.id);if(X!==void 0&&Yi(X.player.position,w.position)&&X.player.metadata[`${m.EXTENSIONID}/visionRange`]===w.metadata[`${m.EXTENSIONID}/visionRange`]){F[u]=X.shadowPath.copy(),N++;continue}R++;const V=C[u],G=new $e.SkOpBuilder,ae=$e.NewPath().rect(y[0],y[1],I[0],I[1]);G.add(ae,$e.PathOp.UNION),ae.delete();for(const se of V){const Ie=se.fromShape,Oe=$e.NewPath();Oe.moveTo(se.pointset[0].x,se.pointset[0].y);for(let Ae=1;Ae<se.pointset.length;Ae++)Oe.lineTo(se.pointset[Ae].x,se.pointset[Ae].y);if(Ie.style.closed!=!1){const Ae=$e.NewPath();Ae.moveTo(Ie.points[0].x*Ie.scale.x+Ie.position.x,Ie.points[0].y*Ie.scale.y+Ie.position.y);for(let Te=1;Te<Ie.points.length-1;Te++)Ae.lineTo(Ie.points[Te].x*Ie.scale.x+Ie.position.x,Ie.points[Te].y*Ie.scale.y+Ie.position.y);Oe.op(Ae,$e.PathOp.DIFFERENCE),Ae.delete()}G.add(Oe,$e.PathOp.DIFFERENCE),Oe.delete()}const ce=G.resolve();if(!ce){console.error("Couldn't compute fog"),ut=!1;return}if(G.delete(),ce!==void 0){ce.simplify(),F[u]=ce;let se=mt.getValue(w.id);se!==void 0&&se.shadowPath.delete(),mt.cacheValue(w.id,{shadowPath:ce.copy(),player:w})}}e[2].pause(),e[3].start();const Q=[],O=$e.NewPath();for(let u=0;u<l.length;u++){const w=l[u],X=w.metadata[`${m.EXTENSIONID}/visionRange`],V=L.players.filter(ce=>ce.role=="GM"),G=L.userId===l[u].createdUserId,ae=V.some(ce=>ce.id==l[u].createdUserId);if(At(w)?Q[u]=!0:O.op(F[u],$e.PathOp.UNION),X){if(!G&&L.role!=="GM"&&!ae)continue;const ce=L.gridDpi*(X/L.gridScale+.5),se=$e.NewPath().ellipse(w.position.x,w.position.y,ce,ce,0,0,2*Math.PI);F[u]?.op(se,$e.PathOp.INTERSECT),se.delete();const Ie=L.players.find(Oe=>Oe.id===w.createdUserId);if(Ie&&L.role==="GM"&&!At(w)){const Oe=vt().strokeColor(Ie.color).fillOpacity(0).position({x:w.position.x,y:w.position.y}).width(ce*2).height(ce*2).shapeType("CIRCLE").metadata({[`${m.EXTENSIONID}/isIndicatorRing`]:!0}).build();B.push(Oe)}}}O.simplify();for(let u=0;u<Q.length;u++)Q[u]===!0&&(F[u].op(O,$e.PathOp.INTERSECT),F[u].simplify());O.delete(),e[3].pause(),e[4].start();const h=[],p=[],E=L.metadata[`${m.EXTENSIONID}/persistenceEnabled`]===!0,g=L.metadata[`${m.EXTENSIONID}/fowEnabled`]===!0,T=L.metadata[`${m.EXTENSIONID}/playerDoors`]===!0,P=$e.NewPath(),ne={},te=await $.scene.local.getItems(Bn),re=await $.scene.local.getItems(Br);g&&P.rect(y[0],y[1],I[0],I[1]);let Y=E&&L.metadata[`${m.EXTENSIONID}/quality`]=="fast",ge=[],ve;if(Y)if(ge=await $.scene.local.getItems(gt),ve=new $e.SkOpBuilder,ne.reuse=!0,ge.length===0){const u=Ot().commands([]).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${m.EXTENSIONID}/isVisionFog`]:!0,[`${m.EXTENSIONID}/digest`]:"reuse"}).build();u.zIndex=3,await $.scene.local.addItems([u]),ge=await $.scene.local.getItems(gt)}else{let u=$e.FromCmds(ge[0].commands);ve.add(u,$e.PathOp.UNION),u.delete()}const fe=new $e.SkOpBuilder;let oe=!1;for(const u of Object.keys(F)){const w=F[u],V=new TextEncoder().encode(w.toCmds().toString()),G=await crypto.subtle.digest("SHA-1",V).then(ce=>[...new Uint8Array(ce)].map(se=>se.toString(16).padStart(2,"0")).join(""));te.filter(ce=>gt(ce)&&ce.metadata[`${m.EXTENSIONID}/digest`]===G).length===0?Y?ve.add(w,$e.PathOp.UNION):h.push({cmds:w.toCmds(),visible:!1,zIndex:3,playerId:l[u].id,digest:G}):ne[G]=!0,g&&(P.op(w,$e.PathOp.DIFFERENCE),L.role==="GM"&&(oe=!0,fe.add(w,$e.PathOp.UNION))),w.delete()}const we=L.metadata[`${m.EXTENSIONID}/sceneId`];if(Y){const u=ve.resolve();u.setFillType($e.FillType.EVENODD);const w=u.toCmds();await $.scene.local.updateItems([ge[0].id],X=>{X[0].commands=w});try{localStorage.setItem(`${m.EXTENSIONID}/fogCache/${L.userId}/${we}`,JSON.stringify([{digest:"reuse",commands:w}]))}catch{}u.delete(),ve.delete()}else if(E){const u=te.filter(gt);try{localStorage.setItem(`${m.EXTENSIONID}/fogCache/${L.userId}/${we}`,JSON.stringify(u.map(w=>({digest:w.metadata[`${m.EXTENSIONID}/digest`],commands:w.commands}))))}catch{}}let Re;oe&&(Re=fe.resolve()),fe.delete();const le=te.filter(Ht),xe=te.filter(u=>{const w=u.metadata[`${m.EXTENSIONID}/digest`];return gt(u)&&ne[w]===void 0});if(g){let u=L.metadata[`${m.EXTENSIONID}/fowColor`]?L.metadata[`${m.EXTENSIONID}/fowColor`]:"#00000088",w=.5;u.length==9&&(w=Number.parseInt(u.substring(7),16)/255,u=u.substring(0,7));const X=Ot().commands(P.toCmds()).locked(!0).fillRule("evenodd").visible(!0).fillColor(u).fillOpacity(w).strokeWidth(0).strokeColor("#000000").layer("DRAWING").metadata({[`${m.EXTENSIONID}/isTrailingFog`]:!0}).name("Trailing Fog").build();X.disableHit=!0,le.length>0?$.scene.local.updateItems(Ht,V=>{for(const G of V)G.commands=X.commands},!1):p.push($.scene.local.addItems([X]))}else p.push($.scene.local.deleteItems(te.filter(Ht).map(u=>u.id)));if(P.delete(),e[4].pause(),e[5].start(),T||L.role=="GM")fo();else{const u=await $.scene.local.getItems(w=>w.metadata[`${m.EXTENSIONID}/doorId`]!==void 0);u.length>0&&await $.scene.local.deleteItems(u.map(w=>w.id))}const Ke=await $.scene.local.getItems(u=>u.metadata[`${m.EXTENSIONID}/doorId`]!==void 0);for(const u of Ke){const w=u.metadata[`${m.EXTENSIONID}/doorId`],X=L.items.find(V=>V.id===w);if(X){const G=u.commands.length==m.DOOROPEN.length,ae=!!X.metadata[`${m.EXTENSIONID}/doorOpen`];if(G===ae)continue;p.push($.scene.local.updateItems([u.id],ce=>{const se=ce[0];$r(se)&&(se.commands=Zi(ae))}))}}n.pause(),t.resume(),p.push($.scene.local.deleteItems(re.map(u=>u.id))),p.push($.scene.local.addItems(h.map(u=>{const w=Ot().commands(u.cmds).locked(!0).visible(u.visible).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${m.EXTENSIONID}/isVisionFog`]:!0,[`${m.EXTENSIONID}/digest`]:u.digest}).build();return w.zIndex=u.zIndex,w}))),E||p.push($.scene.local.deleteItems(xe.map(u=>u.id))),B.length>0&&p.push($.scene.local.addItems(B)),L.fog.filled||p.push($.scene.fog.setFilled(!0)),await Promise.all(p);let qe=0;e[5].pause(),e[6].start(),oe&&(wo(Re),Re.delete()),e[6].pause();const[Fe,K]=[t.stop(),n.stop()],d={compute_time:`${K} ms`,communication_time:`${Fe} ms`,cache_hits:N.toString(),cache_misses:R.toString(),item_counter:qe.toString()};for(let u=1;u<=6;u++){const w=e[u].stop();d["stage"+u]=`${w} ms`}yo(d),ut=!1,await $.player.setMetadata({[`${m.EXTENSIONID}/processed`]:!0})}document.addEventListener("updateVision",Eo);async function wo(i){const e=[],t=L.items.filter(n=>Vi(n)&&zn(n));i.simplify();for(const n of t){const o=new $e.SkOpBuilder,r=$e.NewPath(),l=L.gridDpi/n.grid.dpi*(n.image.width/2)*n.scale.x;for(let y=0;y<6;y++){const _=y*60*Math.PI/180,x=n.position.x+l*Math.cos(_),A=n.position.y+l*Math.sin(_);y==0?r.moveTo(x,A):r.lineTo(x,A)}r.closePath(),o.add(r,$e.PathOp.UNION),o.add(i,$e.PathOp.INTERSECT);const f=o.resolve(),I=!f.toCmds().length;n.visible==I&&e.push(n),r.delete(),o.delete(),f.delete()}await $.scene.items.updateItems(e.map(n=>n.id),n=>{for(let o=0;o<n.length;o++)n[o].visible=!n[o].visible})}let xn,bo,yi,St=[],vi,An,Ii,Ei,wi,bi;async function ht(i){if(ut||!await $.scene.isReady())return;document.querySelector("#debug_div");const[e,t]=[new Xn,new Xn];e.start(),e.pause(),t.start();const n=L.players.filter(p=>p.role=="GM"),o=L.items.filter(p=>(p.layer=="CHARACTER"||p.layer=="ATTACHMENT")&&n.some(E=>p.createdUserId===E.id)&&(p.metadata[`${m.EXTENSIONID}/hasVision`]||p.metadata[`${m.ARMINDOID}/hasVision`])&&!p.metadata[`${m.EXTENSIONID}/visionBlind`]),l=(L.role=="GM"?L.items.filter(Vr):L.items.filter(jr).concat(o)).filter(p=>!At(p)||p.visible===!0),f=L.items.filter(Xr),I=L.items.filter(Vi),y=L.items.filter(Xi)?.[0],_=L.metadata[`${m.EXTENSIONID}/visionEnabled`]===!0,x=L.metadata[`${m.EXTENSIONID}/persistenceEnabled`]===!0,A=L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]===!0,H=L.metadata[`${m.EXTENSIONID}/fowEnabled`]===!0,N=L.metadata[`${m.EXTENSIONID}/fowColor`],R=[],S=[],D=[];if(y===void 0?(R[0]=0,R[1]=0,S[0]=1,S[1]=1,D[0]=0,D[1]=0):(R[0]=y.width*y.scale.x,R[1]=y.height*y.scale.y,S[0]=y.scale.x,S[1]=y.scale.y,D[0]=y.position.x,D[1]=y.position.y),L.role=="GM"){const p=document.getElementById("mapHeight"),E=document.getElementById("mapWidth");E.value=(Math.round(R[0])/L.gridDpi).toString(),p.value=(Math.round(R[1])/L.gridDpi).toString()}const C=JSON.stringify(f),B=JSON.stringify(I),F=JSON.stringify(l),Q=JSON.stringify(y);if(Q==An&&_==vi&&bi==N&&Ii==A&&Ei==H&&wi==x&&xn==C&&bo==B&&yi==F&&R[0]==St[0]&&R[1]==St[1]&&i!==!0)return;let O=!1;(Q!=An||xn!=C||R[0]!=St[0]||R[1]!=St[1])&&(O=!0),An=Q,yi=F,xn=C,St=R,vi=_,Ii=A,Ei=H,bi=N,wi=x,t.pause();const h=new CustomEvent("updateVision",{detail:{awaitTimer:e,computeTimer:t,allItems:L.items,metadata:L.metadata,size:R,offset:D,scale:S,tokensWithVision:l,visionShapes:f,invalidateCache:O}});ut||document.dispatchEvent(h)}function Cn(i,e){i.split(/\s+/).forEach(t=>{e(t)})}class So{constructor(){this._events=void 0,this._events={}}on(e,t){Cn(e,n=>{const o=this._events[n]||[];o.push(t),this._events[n]=o})}off(e,t){var n=arguments.length;if(n===0){this._events={};return}Cn(e,o=>{if(n===1){delete this._events[o];return}const r=this._events[o];r!==void 0&&(r.splice(r.indexOf(t),1),this._events[o]=r)})}trigger(e,...t){var n=this;Cn(e,o=>{const r=n._events[o];r!==void 0&&r.forEach(l=>{l.apply(n,t)})})}}function _o(i){return i.plugins={},class extends i{constructor(...e){super(...e),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(e,t){i.plugins[e]={name:e,fn:t}}initializePlugins(e){var t,n;const o=this,r=[];if(Array.isArray(e))e.forEach(l=>{typeof l=="string"?r.push(l):(o.plugins.settings[l.name]=l.options,r.push(l.name))});else if(e)for(t in e)e.hasOwnProperty(t)&&(o.plugins.settings[t]=e[t],r.push(t));for(;n=r.shift();)o.require(n)}loadPlugin(e){var t=this,n=t.plugins,o=i.plugins[e];if(!i.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');n.requested[e]=!0,n.loaded[e]=o.fn.apply(t,[t.plugins.settings[e]||{}]),n.names.push(e)}require(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]}}}/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const cn=i=>(i=i.filter(Boolean),i.length<2?i[0]||"":Oo(i)==1?"["+i.join("")+"]":"(?:"+i.join("|")+")"),Ji=i=>{if(!To(i))return i.join("");let e="",t=0;const n=()=>{t>1&&(e+="{"+t+"}")};return i.forEach((o,r)=>{if(o===i[r-1]){t++;return}n(),e+=o,t=1}),n(),e},Qi=i=>{let e=Kn(i);return cn(e)},To=i=>new Set(i).size!==i.length,Ct=i=>(i+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),Oo=i=>i.reduce((e,t)=>Math.max(e,No(t)),0),No=i=>Kn(i).length,Kn=i=>Array.from(i);/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const er=i=>{if(i.length===1)return[[i]];let e=[];const t=i.substring(1);return er(t).forEach(function(o){let r=o.slice(0);r[0]=i.charAt(0)+r[0],e.push(r),r=o.slice(0),r.unshift(i.charAt(0)),e.push(r)}),e};/*! @orchidjs/unicode-variants | https://github.com/orchidjs/unicode-variants | Apache License (v2) */const ko=[[0,65535]],xo="[̀-ͯ·ʾʼ]";let on,tr;const Ao=3,Yn={},Si={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let i in Si){let e=Si[i]||"";for(let t=0;t<e.length;t++){let n=e.substring(t,t+1);Yn[n]=i}}const Co=new RegExp(Object.keys(Yn).join("|")+"|"+xo,"gu"),Do=i=>{on===void 0&&(on=Mo(i||ko))},_i=(i,e="NFKD")=>i.normalize(e),an=i=>Kn(i).reduce((e,t)=>e+$o(t),""),$o=i=>(i=_i(i).toLowerCase().replace(Co,e=>Yn[e]||""),_i(i,"NFC"));function*Po(i){for(const[e,t]of i)for(let n=e;n<=t;n++){let o=String.fromCharCode(n),r=an(o);r!=o.toLowerCase()&&(r.length>Ao||r.length!=0&&(yield{folded:r,composed:o,code_point:n}))}}const Lo=i=>{const e={},t=(n,o)=>{const r=e[n]||new Set,l=new RegExp("^"+Qi(r)+"$","iu");o.match(l)||(r.add(Ct(o)),e[n]=r)};for(let n of Po(i))t(n.folded,n.folded),t(n.folded,n.composed);return e},Mo=i=>{const e=Lo(i),t={};let n=[];for(let r in e){let l=e[r];l&&(t[r]=Qi(l)),r.length>1&&n.push(Ct(r))}n.sort((r,l)=>l.length-r.length);const o=cn(n);return tr=new RegExp("^"+o,"u"),t},Ro=(i,e=1)=>{let t=0;return i=i.map(n=>(on[n]&&(t+=n.length),on[n]||n)),t>=e?Ji(i):""},Fo=(i,e=1)=>(e=Math.max(e,i.length-1),cn(er(i).map(t=>Ro(t,e)))),Ti=(i,e=!0)=>{let t=i.length>1?1:0;return cn(i.map(n=>{let o=[];const r=e?n.length():n.length()-1;for(let l=0;l<r;l++)o.push(Fo(n.substrs[l]||"",t));return Ji(o)}))},Bo=(i,e)=>{for(const t of e){if(t.start!=i.start||t.end!=i.end||t.substrs.join("")!==i.substrs.join(""))continue;let n=i.parts;const o=l=>{for(const f of n){if(f.start===l.start&&f.substr===l.substr)return!1;if(!(l.length==1||f.length==1)&&(l.start<f.start&&l.end>f.start||f.start<l.start&&f.end>l.start))return!0}return!1};if(!(t.parts.filter(o).length>0))return!0}return!1};class sn{constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(e){e&&(this.parts.push(e),this.substrs.push(e.substr),this.start=Math.min(e.start,this.start),this.end=Math.max(e.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(e,t){let n=new sn,o=JSON.parse(JSON.stringify(this.parts)),r=o.pop();for(const I of o)n.add(I);let l=t.substr.substring(0,e-r.start),f=l.length;return n.add({start:r.start,end:r.start+f,length:f,substr:l}),n}}const Xo=i=>{Do(),i=an(i);let e="",t=[new sn];for(let n=0;n<i.length;n++){let r=i.substring(n).match(tr);const l=i.substring(n,n+1),f=r?r[0]:null;let I=[],y=new Set;for(const _ of t){const x=_.last();if(!x||x.length==1||x.end<=n)if(f){const A=f.length;_.add({start:n,end:n+A,length:A,substr:f}),y.add("1")}else _.add({start:n,end:n+1,length:1,substr:l}),y.add("2");else if(f){let A=_.clone(n,x);const H=f.length;A.add({start:n,end:n+H,length:H,substr:f}),I.push(A)}else y.add("3")}if(I.length>0){I=I.sort((_,x)=>_.length()-x.length());for(let _ of I)Bo(_,t)||t.push(_);continue}if(n>0&&y.size==1&&!y.has("3")){e+=Ti(t,!1);let _=new sn;const x=t[0];x&&_.add(x.last()),t=[_]}}return e+=Ti(t,!0),e};/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */const Vo=(i,e)=>{if(i)return i[e]},jo=(i,e)=>{if(i){for(var t,n=e.split(".");(t=n.shift())&&(i=i[t]););return i}},Dn=(i,e,t)=>{var n,o;return!i||(i=i+"",e.regex==null)||(o=i.search(e.regex),o===-1)?0:(n=e.string.length/i.length,o===0&&(n+=.5),n*t)},$n=(i,e)=>{var t=i[e];if(typeof t=="function")return t;t&&!Array.isArray(t)&&(i[e]=[t])},We=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Uo=(i,e)=>typeof i=="number"&&typeof e=="number"?i>e?1:i<e?-1:0:(i=an(i+"").toLowerCase(),e=an(e+"").toLowerCase(),i>e?1:e>i?-1:0);/*! sifter.js | https://github.com/orchidjs/sifter.js | Apache License (v2) */class Ho{constructor(e,t){this.items=void 0,this.settings=void 0,this.items=e,this.settings=t||{diacritics:!0}}tokenize(e,t,n){if(!e||!e.length)return[];const o=[],r=e.split(/\s+/);var l;return n&&(l=new RegExp("^("+Object.keys(n).map(Ct).join("|")+"):(.*)$")),r.forEach(f=>{let I,y=null,_=null;l&&(I=f.match(l))&&(y=I[1],f=I[2]),f.length>0&&(this.settings.diacritics?_=Xo(f)||null:_=Ct(f),_&&t&&(_="\\b"+_)),o.push({string:f,regex:_?new RegExp(_,"iu"):null,field:y})}),o}getScoreFunction(e,t){var n=this.prepareSearch(e,t);return this._getScoreFunction(n)}_getScoreFunction(e){const t=e.tokens,n=t.length;if(!n)return function(){return 0};const o=e.options.fields,r=e.weights,l=o.length,f=e.getAttrFn;if(!l)return function(){return 1};const I=function(){return l===1?function(y,_){const x=o[0].field;return Dn(f(_,x),y,r[x]||1)}:function(y,_){var x=0;if(y.field){const A=f(_,y.field);!y.regex&&A?x+=1/l:x+=Dn(A,y,1)}else We(r,(A,H)=>{x+=Dn(f(_,H),y,A)});return x/l}}();return n===1?function(y){return I(t[0],y)}:e.options.conjunction==="and"?function(y){var _,x=0;for(let A of t){if(_=I(A,y),_<=0)return 0;x+=_}return x/n}:function(y){var _=0;return We(t,x=>{_+=I(x,y)}),_/n}}getSortFunction(e,t){var n=this.prepareSearch(e,t);return this._getSortFunction(n)}_getSortFunction(e){var t,n=[];const o=this,r=e.options,l=!e.query&&r.sort_empty?r.sort_empty:r.sort;if(typeof l=="function")return l.bind(this);const f=function(_,x){return _==="$score"?x.score:e.getAttrFn(o.items[x.id],_)};if(l)for(let y of l)(e.query||y.field!=="$score")&&n.push(y);if(e.query){t=!0;for(let y of n)if(y.field==="$score"){t=!1;break}t&&n.unshift({field:"$score",direction:"desc"})}else n=n.filter(y=>y.field!=="$score");return n.length?function(y,_){var x,A;for(let H of n)if(A=H.field,x=(H.direction==="desc"?-1:1)*Uo(f(A,y),f(A,_)),x)return x;return 0}:null}prepareSearch(e,t){const n={};var o=Object.assign({},t);if($n(o,"sort"),$n(o,"sort_empty"),o.fields){$n(o,"fields");const r=[];o.fields.forEach(l=>{typeof l=="string"&&(l={field:l,weight:1}),r.push(l),n[l.field]="weight"in l?l.weight:1}),o.fields=r}return{options:o,query:e.toLowerCase().trim(),tokens:this.tokenize(e,o.respect_word_boundaries,n),total:0,items:[],weights:n,getAttrFn:o.nesting?jo:Vo}}search(e,t){var n=this,o,r;r=this.prepareSearch(e,t),t=r.options,e=r.query;const l=t.score||n._getScoreFunction(r);e.length?We(n.items,(I,y)=>{o=l(I),(t.filter===!1||o>0)&&r.items.push({score:o,id:y})}):We(n.items,(I,y)=>{r.items.push({score:1,id:y})});const f=n._getSortFunction(r);return f&&r.items.sort(f),r.total=r.items.length,typeof t.limit=="number"&&(r.items=r.items.slice(0,t.limit)),r}}const yt=(i,e)=>{if(Array.isArray(i))i.forEach(e);else for(var t in i)i.hasOwnProperty(t)&&e(i[t],t)},Be=i=>{if(i.jquery)return i[0];if(i instanceof HTMLElement)return i;if(nr(i)){var e=document.createElement("template");return e.innerHTML=i.trim(),e.content.firstChild}return document.querySelector(i)},nr=i=>typeof i=="string"&&i.indexOf("<")>-1,Wo=i=>i.replace(/['"\\]/g,"\\$&"),Pn=(i,e)=>{var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!1),i.dispatchEvent(t)},Vt=(i,e)=>{Object.assign(i.style,e)},He=(i,...e)=>{var t=ir(e);i=rr(i),i.map(n=>{t.map(o=>{n.classList.add(o)})})},at=(i,...e)=>{var t=ir(e);i=rr(i),i.map(n=>{t.map(o=>{n.classList.remove(o)})})},ir=i=>{var e=[];return yt(i,t=>{typeof t=="string"&&(t=t.trim().split(/[\11\12\14\15\40]/)),Array.isArray(t)&&(e=e.concat(t))}),e.filter(Boolean)},rr=i=>(Array.isArray(i)||(i=[i]),i),Wt=(i,e,t)=>{if(!(t&&!t.contains(i)))for(;i&&i.matches;){if(i.matches(e))return i;i=i.parentNode}},Oi=(i,e=0)=>e>0?i[i.length-1]:i[0],Go=i=>Object.keys(i).length===0,ln=(i,e)=>{if(!i)return-1;e=e||i.nodeName;for(var t=0;i=i.previousElementSibling;)i.matches(e)&&t++;return t},Pe=(i,e)=>{yt(e,(t,n)=>{t==null?i.removeAttribute(n):i.setAttribute(n,""+t)})},Vn=(i,e)=>{i.parentNode&&i.parentNode.replaceChild(e,i)},qo=(i,e)=>{if(e===null)return;if(typeof e=="string"){if(!e.length)return;e=new RegExp(e,"i")}const t=r=>{var l=r.data.match(e);if(l&&r.data.length>0){var f=document.createElement("span");f.className="highlight";var I=r.splitText(l.index);I.splitText(l[0].length);var y=I.cloneNode(!0);return f.appendChild(y),Vn(I,f),1}return 0},n=r=>{r.nodeType===1&&r.childNodes&&!/(script|style)/i.test(r.tagName)&&(r.className!=="highlight"||r.tagName!=="SPAN")&&Array.from(r.childNodes).forEach(l=>{o(l)})},o=r=>r.nodeType===3?t(r):(n(r),0);o(i)},zo=i=>{var e=i.querySelectorAll("span.highlight");Array.prototype.forEach.call(e,function(t){var n=t.parentNode;n.replaceChild(t.firstChild,t),n.normalize()})},Ko=65,Yo=13,or=27,jn=37,Zo=38,ar=39,Jo=40,Ni=8,Qo=46,Un=9,ea=typeof navigator>"u"?!1:/Mac/.test(navigator.userAgent),jt=ea?"metaKey":"ctrlKey";var ki={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(i){return i.length>0},render:{}};const Ze=i=>typeof i>"u"||i===null?null:Gt(i),Gt=i=>typeof i=="boolean"?i?"1":"0":i+"",qt=i=>(i+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),ta=(i,e)=>e>0?setTimeout(i,e):(i.call(null),null),na=(i,e)=>{var t;return function(n,o){var r=this;t&&(r.loading=Math.max(r.loading-1,0),clearTimeout(t)),t=setTimeout(function(){t=null,r.loadedSearches[n]=!0,i.call(r,n,o)},e)}},xi=(i,e,t)=>{var n,o=i.trigger,r={};i.trigger=function(){var l=arguments[0];if(e.indexOf(l)!==-1)r[l]=arguments;else return o.apply(i,arguments)},t.apply(i,[]),i.trigger=o;for(n of e)n in r&&o.apply(i,r[n])},ia=i=>({start:i.selectionStart||0,length:(i.selectionEnd||0)-(i.selectionStart||0)}),Ne=(i,e=!1)=>{i&&(i.preventDefault(),e&&i.stopPropagation())},ke=(i,e,t,n)=>{i.addEventListener(e,t,n)},ft=(i,e)=>{if(!e||!e[i])return!1;var t=(e.altKey?1:0)+(e.ctrlKey?1:0)+(e.shiftKey?1:0)+(e.metaKey?1:0);return t===1},Ln=(i,e)=>{const t=i.getAttribute("id");return t||(i.setAttribute("id",e),e)},Ai=i=>i.replace(/[\\"']/g,"\\$&"),pt=(i,e)=>{e&&i.append(e)};function Ci(i,e){var t=Object.assign({},ki,e),n=t.dataAttr,o=t.labelField,r=t.valueField,l=t.disabledField,f=t.optgroupField,I=t.optgroupLabelField,y=t.optgroupValueField,_=i.tagName.toLowerCase(),x=i.getAttribute("placeholder")||i.getAttribute("data-placeholder");if(!x&&!t.allowEmptyOption){let R=i.querySelector('option[value=""]');R&&(x=R.textContent)}var A={placeholder:x,options:[],optgroups:[],items:[],maxItems:null},H=()=>{var R,S=A.options,D={},C=1;let B=0;var F=h=>{var p=Object.assign({},h.dataset),E=n&&p[n];return typeof E=="string"&&E.length&&(p=Object.assign(p,JSON.parse(E))),p},Q=(h,p)=>{var E=Ze(h.value);if(E!=null&&!(!E&&!t.allowEmptyOption)){if(D.hasOwnProperty(E)){if(p){var g=D[E][f];g?Array.isArray(g)?g.push(p):D[E][f]=[g,p]:D[E][f]=p}}else{var T=F(h);T[o]=T[o]||h.textContent,T[r]=T[r]||E,T[l]=T[l]||h.disabled,T[f]=T[f]||p,T.$option=h,T.$order=T.$order||++B,D[E]=T,S.push(T)}h.selected&&A.items.push(E)}},O=h=>{var p,E;E=F(h),E[I]=E[I]||h.getAttribute("label")||"",E[y]=E[y]||C++,E[l]=E[l]||h.disabled,E.$order=E.$order||++B,A.optgroups.push(E),p=E[y],yt(h.children,g=>{Q(g,p)})};A.maxItems=i.hasAttribute("multiple")?null:1,yt(i.children,h=>{R=h.tagName.toLowerCase(),R==="optgroup"?O(h):R==="option"&&Q(h)})},N=()=>{const R=i.getAttribute(n);if(R)A.options=JSON.parse(R),yt(A.options,D=>{A.items.push(D[r])});else{var S=i.value.trim()||"";if(!t.allowEmptyOption&&!S.length)return;const D=S.split(t.delimiter);yt(D,C=>{const B={};B[o]=C,B[r]=C,A.options.push(B)}),A.items=D}};return _==="select"?H():N(),Object.assign({},ki,A,e)}var Di=0;class Ge extends _o(So){constructor(e,t){super(),this.control_input=void 0,this.wrapper=void 0,this.dropdown=void 0,this.control=void 0,this.dropdown_content=void 0,this.focus_node=void 0,this.order=0,this.settings=void 0,this.input=void 0,this.tabIndex=void 0,this.is_select_tag=void 0,this.rtl=void 0,this.inputId=void 0,this._destroy=void 0,this.sifter=void 0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isRequired=void 0,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.currentResults=void 0,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,Di++;var n,o=Be(e);if(o.tomselect)throw new Error("Tom Select already initialized on this element");o.tomselect=this;var r=window.getComputedStyle&&window.getComputedStyle(o,null);n=r.getPropertyValue("direction");const l=Ci(o,t);this.settings=l,this.input=o,this.tabIndex=o.tabIndex||0,this.is_select_tag=o.tagName.toLowerCase()==="select",this.rtl=/rtl/i.test(n),this.inputId=Ln(o,"tomselect-"+Di),this.isRequired=o.required,this.sifter=new Ho(this.options,{diacritics:l.diacritics}),l.mode=l.mode||(l.maxItems===1?"single":"multi"),typeof l.hideSelected!="boolean"&&(l.hideSelected=l.mode==="multi"),typeof l.hidePlaceholder!="boolean"&&(l.hidePlaceholder=l.mode!=="multi");var f=l.createFilter;typeof f!="function"&&(typeof f=="string"&&(f=new RegExp(f)),f instanceof RegExp?l.createFilter=S=>f.test(S):l.createFilter=S=>this.settings.duplicates||!this.options[S]),this.initializePlugins(l.plugins),this.setupCallbacks(),this.setupTemplates();const I=Be("<div>"),y=Be("<div>"),_=this._render("dropdown"),x=Be('<div role="listbox" tabindex="-1">'),A=this.input.getAttribute("class")||"",H=l.mode;var N;if(He(I,l.wrapperClass,A,H),He(y,l.controlClass),pt(I,y),He(_,l.dropdownClass,H),l.copyClassesToDropdown&&He(_,A),He(x,l.dropdownContentClass),pt(_,x),Be(l.dropdownParent||I).appendChild(_),nr(l.controlInput)){N=Be(l.controlInput);var R=["autocorrect","autocapitalize","autocomplete","spellcheck"];We(R,S=>{o.getAttribute(S)&&Pe(N,{[S]:o.getAttribute(S)})}),N.tabIndex=-1,y.appendChild(N),this.focus_node=N}else l.controlInput?(N=Be(l.controlInput),this.focus_node=N):(N=Be("<input/>"),this.focus_node=y);this.wrapper=I,this.dropdown=_,this.dropdown_content=x,this.control=y,this.control_input=N,this.setup()}setup(){const e=this,t=e.settings,n=e.control_input,o=e.dropdown,r=e.dropdown_content,l=e.wrapper,f=e.control,I=e.input,y=e.focus_node,_={passive:!0},x=e.inputId+"-ts-dropdown";Pe(r,{id:x}),Pe(y,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":x});const A=Ln(y,e.inputId+"-ts-control"),H="label[for='"+Wo(e.inputId)+"']",N=document.querySelector(H),R=e.focus.bind(e);if(N){ke(N,"click",R),Pe(N,{for:A});const C=Ln(N,e.inputId+"-ts-label");Pe(y,{"aria-labelledby":C}),Pe(r,{"aria-labelledby":C})}if(l.style.width=I.style.width,e.plugins.names.length){const C="plugin-"+e.plugins.names.join(" plugin-");He([l,o],C)}(t.maxItems===null||t.maxItems>1)&&e.is_select_tag&&Pe(I,{multiple:"multiple"}),t.placeholder&&Pe(n,{placeholder:t.placeholder}),!t.splitOn&&t.delimiter&&(t.splitOn=new RegExp("\\s*"+Ct(t.delimiter)+"+\\s*")),t.load&&t.loadThrottle&&(t.load=na(t.load,t.loadThrottle)),ke(o,"mousemove",()=>{e.ignoreHover=!1}),ke(o,"mouseenter",C=>{var B=Wt(C.target,"[data-selectable]",o);B&&e.onOptionHover(C,B)},{capture:!0}),ke(o,"click",C=>{const B=Wt(C.target,"[data-selectable]");B&&(e.onOptionSelect(C,B),Ne(C,!0))}),ke(f,"click",C=>{var B=Wt(C.target,"[data-ts-item]",f);if(B&&e.onItemSelect(C,B)){Ne(C,!0);return}n.value==""&&(e.onClick(),Ne(C,!0))}),ke(y,"keydown",C=>e.onKeyDown(C)),ke(n,"keypress",C=>e.onKeyPress(C)),ke(n,"input",C=>e.onInput(C)),ke(y,"blur",C=>e.onBlur(C)),ke(y,"focus",C=>e.onFocus(C)),ke(n,"paste",C=>e.onPaste(C));const S=C=>{const B=C.composedPath()[0];if(!l.contains(B)&&!o.contains(B)){e.isFocused&&e.blur(),e.inputState();return}B==n&&e.isOpen?C.stopPropagation():Ne(C,!0)},D=()=>{e.isOpen&&e.positionDropdown()};ke(document,"mousedown",S),ke(window,"scroll",D,_),ke(window,"resize",D,_),this._destroy=()=>{document.removeEventListener("mousedown",S),window.removeEventListener("scroll",D),window.removeEventListener("resize",D),N&&N.removeEventListener("click",R)},this.revertSettings={innerHTML:I.innerHTML,tabIndex:I.tabIndex},I.tabIndex=-1,I.insertAdjacentElement("afterend",e.wrapper),e.sync(!1),t.items=[],delete t.optgroups,delete t.options,ke(I,"invalid",()=>{e.isValid&&(e.isValid=!1,e.isInvalid=!0,e.refreshState())}),e.updateOriginalInput(),e.refreshItems(),e.close(!1),e.inputState(),e.isSetup=!0,I.disabled?e.disable():I.readOnly?e.setReadOnly(!0):e.enable(),e.on("change",this.onChange),He(I,"tomselected","ts-hidden-accessible"),e.trigger("initialize"),t.preload===!0&&e.preload()}setupOptions(e=[],t=[]){this.addOptions(e),We(t,n=>{this.registerOptionGroup(n)})}setupTemplates(){var e=this,t=e.settings.labelField,n=e.settings.optgroupLabelField,o={optgroup:r=>{let l=document.createElement("div");return l.className="optgroup",l.appendChild(r.options),l},optgroup_header:(r,l)=>'<div class="optgroup-header">'+l(r[n])+"</div>",option:(r,l)=>"<div>"+l(r[t])+"</div>",item:(r,l)=>"<div>"+l(r[t])+"</div>",option_create:(r,l)=>'<div class="create">Add <strong>'+l(r.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};e.settings.render=Object.assign({},o,e.settings.render)}setupCallbacks(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)t=this.settings[n[e]],t&&this.on(e,t)}sync(e=!0){const t=this,n=e?Ci(t.input,{delimiter:t.settings.delimiter}):t.settings;t.setupOptions(n.options,n.optgroups),t.setValue(n.items||[],!0),t.lastQuery=null}onClick(){var e=this;if(e.activeItems.length>0){e.clearActiveItems(),e.focus();return}e.isFocused&&e.isOpen?e.blur():e.focus()}onMouseDown(){}onChange(){Pn(this.input,"input"),Pn(this.input,"change")}onPaste(e){var t=this;if(t.isInputHidden||t.isLocked){Ne(e);return}t.settings.splitOn&&setTimeout(()=>{var n=t.inputValue();if(n.match(t.settings.splitOn)){var o=n.trim().split(t.settings.splitOn);We(o,r=>{Ze(r)&&(this.options[r]?t.addItem(r):t.createItem(r))})}},0)}onKeyPress(e){var t=this;if(t.isLocked){Ne(e);return}var n=String.fromCharCode(e.keyCode||e.which);if(t.settings.create&&t.settings.mode==="multi"&&n===t.settings.delimiter){t.createItem(),Ne(e);return}}onKeyDown(e){var t=this;if(t.ignoreHover=!0,t.isLocked){e.keyCode!==Un&&Ne(e);return}switch(e.keyCode){case Ko:if(ft(jt,e)&&t.control_input.value==""){Ne(e),t.selectAll();return}break;case or:t.isOpen&&(Ne(e,!0),t.close()),t.clearActiveItems();return;case Jo:if(!t.isOpen&&t.hasOptions)t.open();else if(t.activeOption){let n=t.getAdjacent(t.activeOption,1);n&&t.setActiveOption(n)}Ne(e);return;case Zo:if(t.activeOption){let n=t.getAdjacent(t.activeOption,-1);n&&t.setActiveOption(n)}Ne(e);return;case Yo:t.canSelect(t.activeOption)?(t.onOptionSelect(e,t.activeOption),Ne(e)):(t.settings.create&&t.createItem()||document.activeElement==t.control_input&&t.isOpen)&&Ne(e);return;case jn:t.advanceSelection(-1,e);return;case ar:t.advanceSelection(1,e);return;case Un:t.settings.selectOnTab&&(t.canSelect(t.activeOption)&&(t.onOptionSelect(e,t.activeOption),Ne(e)),t.settings.create&&t.createItem()&&Ne(e));return;case Ni:case Qo:t.deleteSelection(e);return}t.isInputHidden&&!ft(jt,e)&&Ne(e)}onInput(e){if(this.isLocked)return;const t=this.inputValue();if(this.lastValue!==t){if(this.lastValue=t,t==""){this._onInput();return}this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=ta(()=>{this.refreshTimeout=null,this._onInput()},this.settings.refreshThrottle)}}_onInput(){const e=this.lastValue;this.settings.shouldLoad.call(this,e)&&this.load(e),this.refreshOptions(),this.trigger("type",e)}onOptionHover(e,t){this.ignoreHover||this.setActiveOption(t,!1)}onFocus(e){var t=this,n=t.isFocused;if(t.isDisabled||t.isReadOnly){t.blur(),Ne(e);return}t.ignoreFocus||(t.isFocused=!0,t.settings.preload==="focus"&&t.preload(),n||t.trigger("focus"),t.activeItems.length||(t.inputState(),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())}onBlur(e){if(document.hasFocus()!==!1){var t=this;if(t.isFocused){t.isFocused=!1,t.ignoreFocus=!1;var n=()=>{t.close(),t.setActiveItem(),t.setCaret(t.items.length),t.trigger("blur")};t.settings.create&&t.settings.createOnBlur?t.createItem(null,n):n()}}}onOptionSelect(e,t){var n,o=this;t.parentElement&&t.parentElement.matches("[data-disabled]")||(t.classList.contains("create")?o.createItem(null,()=>{o.settings.closeAfterSelect&&o.close()}):(n=t.dataset.value,typeof n<"u"&&(o.lastQuery=null,o.addItem(n),o.settings.closeAfterSelect&&o.close(),!o.settings.hideSelected&&e.type&&/click/.test(e.type)&&o.setActiveOption(t))))}canSelect(e){return!!(this.isOpen&&e&&this.dropdown_content.contains(e))}onItemSelect(e,t){var n=this;return!n.isLocked&&n.settings.mode==="multi"?(Ne(e),n.setActiveItem(t,e),!0):!1}canLoad(e){return!(!this.settings.load||this.loadedSearches.hasOwnProperty(e))}load(e){const t=this;if(!t.canLoad(e))return;He(t.wrapper,t.settings.loadingClass),t.loading++;const n=t.loadCallback.bind(t);t.settings.load.call(t,e,n)}loadCallback(e,t){const n=this;n.loading=Math.max(n.loading-1,0),n.lastQuery=null,n.clearActiveOption(),n.setupOptions(e,t),n.refreshOptions(n.isFocused&&!n.isInputHidden),n.loading||at(n.wrapper,n.settings.loadingClass),n.trigger("load",e,t)}preload(){var e=this.wrapper.classList;e.contains("preloaded")||(e.add("preloaded"),this.load(""))}setTextboxValue(e=""){var t=this.control_input,n=t.value!==e;n&&(t.value=e,Pn(t,"update"),this.lastValue=e)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(e,t){var n=t?[]:["change"];xi(this,n,()=>{this.clear(t),this.addItems(e,t)})}setMaxItems(e){e===0&&(e=null),this.settings.maxItems=e,this.refreshState()}setActiveItem(e,t){var n=this,o,r,l,f,I,y;if(n.settings.mode!=="single"){if(!e){n.clearActiveItems(),n.isFocused&&n.inputState();return}if(o=t&&t.type.toLowerCase(),o==="click"&&ft("shiftKey",t)&&n.activeItems.length){for(y=n.getLastActive(),l=Array.prototype.indexOf.call(n.control.children,y),f=Array.prototype.indexOf.call(n.control.children,e),l>f&&(I=l,l=f,f=I),r=l;r<=f;r++)e=n.control.children[r],n.activeItems.indexOf(e)===-1&&n.setActiveItemClass(e);Ne(t)}else o==="click"&&ft(jt,t)||o==="keydown"&&ft("shiftKey",t)?e.classList.contains("active")?n.removeActiveItem(e):n.setActiveItemClass(e):(n.clearActiveItems(),n.setActiveItemClass(e));n.inputState(),n.isFocused||n.focus()}}setActiveItemClass(e){const t=this,n=t.control.querySelector(".last-active");n&&at(n,"last-active"),He(e,"active last-active"),t.trigger("item_select",e),t.activeItems.indexOf(e)==-1&&t.activeItems.push(e)}removeActiveItem(e){var t=this.activeItems.indexOf(e);this.activeItems.splice(t,1),at(e,"active")}clearActiveItems(){at(this.activeItems,"active"),this.activeItems=[]}setActiveOption(e,t=!0){e!==this.activeOption&&(this.clearActiveOption(),e&&(this.activeOption=e,Pe(this.focus_node,{"aria-activedescendant":e.getAttribute("id")}),Pe(e,{"aria-selected":"true"}),He(e,"active"),t&&this.scrollToOption(e)))}scrollToOption(e,t){if(!e)return;const n=this.dropdown_content,o=n.clientHeight,r=n.scrollTop||0,l=e.offsetHeight,f=e.getBoundingClientRect().top-n.getBoundingClientRect().top+r;f+l>o+r?this.scroll(f-o+l,t):f<r&&this.scroll(f,t)}scroll(e,t){const n=this.dropdown_content;t&&(n.style.scrollBehavior=t),n.scrollTop=e,n.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(at(this.activeOption,"active"),Pe(this.activeOption,{"aria-selected":null})),this.activeOption=null,Pe(this.focus_node,{"aria-activedescendant":null})}selectAll(){const e=this;if(e.settings.mode==="single")return;const t=e.controlChildren();t.length&&(e.inputState(),e.close(),e.activeItems=t,We(t,n=>{e.setActiveItemClass(n)}))}inputState(){var e=this;e.control.contains(e.control_input)&&(Pe(e.control_input,{placeholder:e.settings.placeholder}),e.activeItems.length>0||!e.isFocused&&e.settings.hidePlaceholder&&e.items.length>0?(e.setTextboxValue(),e.isInputHidden=!0):(e.settings.hidePlaceholder&&e.items.length>0&&Pe(e.control_input,{placeholder:""}),e.isInputHidden=!1),e.wrapper.classList.toggle("input-hidden",e.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var e=this;e.isDisabled||e.isReadOnly||(e.ignoreFocus=!0,e.control_input.offsetWidth?e.control_input.focus():e.focus_node.focus(),setTimeout(()=>{e.ignoreFocus=!1,e.onFocus()},0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())}getSearchOptions(){var e=this.settings,t=e.sortField;return typeof e.sortField=="string"&&(t=[{field:e.sortField}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t,nesting:e.nesting}}search(e){var t,n,o=this,r=this.getSearchOptions();if(o.settings.score&&(n=o.settings.score.call(o,e),typeof n!="function"))throw new Error('Tom Select "score" setting must be a function that returns a function');return e!==o.lastQuery?(o.lastQuery=e,t=o.sifter.search(e,Object.assign(r,{score:n})),o.currentResults=t):t=Object.assign({},o.currentResults),o.settings.hideSelected&&(t.items=t.items.filter(l=>{let f=Ze(l.id);return!(f&&o.items.indexOf(f)!==-1)})),t}refreshOptions(e=!0){var t,n,o,r,l,f,I,y,_,x;const A={},H=[];var N=this,R=N.inputValue();const S=R===N.lastQuery||R==""&&N.lastQuery==null;var D=N.search(R),C=null,B=N.settings.shouldOpen||!1,F=N.dropdown_content;S&&(C=N.activeOption,C&&(_=C.closest("[data-group]"))),r=D.items.length,typeof N.settings.maxOptions=="number"&&(r=Math.min(r,N.settings.maxOptions)),r>0&&(B=!0);const Q=(h,p)=>{let E=A[h];if(E!==void 0){let T=H[E];if(T!==void 0)return[E,T.fragment]}let g=document.createDocumentFragment();return E=H.length,H.push({fragment:g,order:p,optgroup:h}),[E,g]};for(t=0;t<r;t++){let h=D.items[t];if(!h)continue;let p=h.id,E=N.options[p];if(E===void 0)continue;let g=Gt(p),T=N.getOption(g,!0);for(N.settings.hideSelected||T.classList.toggle("selected",N.items.includes(g)),l=E[N.settings.optgroupField]||"",f=Array.isArray(l)?l:[l],n=0,o=f&&f.length;n<o;n++){l=f[n];let P=E.$order,ne=N.optgroups[l];ne===void 0?l="":P=ne.$order;const[te,re]=Q(l,P);n>0&&(T=T.cloneNode(!0),Pe(T,{id:E.$id+"-clone-"+n,"aria-selected":null}),T.classList.add("ts-cloned"),at(T,"active"),N.activeOption&&N.activeOption.dataset.value==p&&_&&_.dataset.group===l.toString()&&(C=T)),re.appendChild(T),l!=""&&(A[l]=te)}}N.settings.lockOptgroupOrder&&H.sort((h,p)=>h.order-p.order),I=document.createDocumentFragment(),We(H,h=>{let p=h.fragment,E=h.optgroup;if(!p||!p.children.length)return;let g=N.optgroups[E];if(g!==void 0){let T=document.createDocumentFragment(),P=N.render("optgroup_header",g);pt(T,P),pt(T,p);let ne=N.render("optgroup",{group:g,options:T});pt(I,ne)}else pt(I,p)}),F.innerHTML="",pt(F,I),N.settings.highlight&&(zo(F),D.query.length&&D.tokens.length&&We(D.tokens,h=>{qo(F,h.regex)}));var O=h=>{let p=N.render(h,{input:R});return p&&(B=!0,F.insertBefore(p,F.firstChild)),p};if(N.loading?O("loading"):N.settings.shouldLoad.call(N,R)?D.items.length===0&&O("no_results"):O("not_loading"),y=N.canCreate(R),y&&(x=O("option_create")),N.hasOptions=D.items.length>0||y,B){if(D.items.length>0){if(!C&&N.settings.mode==="single"&&N.items[0]!=null&&(C=N.getOption(N.items[0])),!F.contains(C)){let h=0;x&&!N.settings.addPrecedence&&(h=1),C=N.selectable()[h]}}else x&&(C=x);e&&!N.isOpen&&(N.open(),N.scrollToOption(C,"auto")),N.setActiveOption(C)}else N.clearActiveOption(),e&&N.isOpen&&N.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(e,t=!1){const n=this;if(Array.isArray(e))return n.addOptions(e,t),!1;const o=Ze(e[n.settings.valueField]);return o===null||n.options.hasOwnProperty(o)?!1:(e.$order=e.$order||++n.order,e.$id=n.inputId+"-opt-"+e.$order,n.options[o]=e,n.lastQuery=null,t&&(n.userOptions[o]=t,n.trigger("option_add",o,e)),o)}addOptions(e,t=!1){We(e,n=>{this.addOption(n,t)})}registerOption(e){return this.addOption(e)}registerOptionGroup(e){var t=Ze(e[this.settings.optgroupValueField]);return t===null?!1:(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)}addOptionGroup(e,t){var n;t[this.settings.optgroupValueField]=e,(n=this.registerOptionGroup(t))&&this.trigger("optgroup_add",n,t)}removeOptionGroup(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.clearCache(),this.trigger("optgroup_remove",e))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(e,t){const n=this;var o,r;const l=Ze(e),f=Ze(t[n.settings.valueField]);if(l===null)return;const I=n.options[l];if(I==null)return;if(typeof f!="string")throw new Error("Value must be set in option data");const y=n.getOption(l),_=n.getItem(l);if(t.$order=t.$order||I.$order,delete n.options[l],n.uncacheValue(f),n.options[f]=t,y){if(n.dropdown_content.contains(y)){const x=n._render("option",t);Vn(y,x),n.activeOption===y&&n.setActiveOption(x)}y.remove()}_&&(r=n.items.indexOf(l),r!==-1&&n.items.splice(r,1,f),o=n._render("item",t),_.classList.contains("active")&&He(o,"active"),Vn(_,o)),n.lastQuery=null}removeOption(e,t){const n=this;e=Gt(e),n.uncacheValue(e),delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)}clearOptions(e){const t=(e||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const n={};We(this.options,(o,r)=>{t(o,r)&&(n[r]=o)}),this.options=this.sifter.items=n,this.lastQuery=null,this.trigger("option_clear")}clearFilter(e,t){return this.items.indexOf(t)>=0}getOption(e,t=!1){const n=Ze(e);if(n===null)return null;const o=this.options[n];if(o!=null){if(o.$div)return o.$div;if(t)return this._render("option",o)}return null}getAdjacent(e,t,n="option"){var o=this,r;if(!e)return null;n=="item"?r=o.controlChildren():r=o.dropdown_content.querySelectorAll("[data-selectable]");for(let l=0;l<r.length;l++)if(r[l]==e)return t>0?r[l+1]:r[l-1];return null}getItem(e){if(typeof e=="object")return e;var t=Ze(e);return t!==null?this.control.querySelector(`[data-value="${Ai(t)}"]`):null}addItems(e,t){var n=this,o=Array.isArray(e)?e:[e];o=o.filter(l=>n.items.indexOf(l)===-1);const r=o[o.length-1];o.forEach(l=>{n.isPending=l!==r,n.addItem(l,t)})}addItem(e,t){var n=t?[]:["change","dropdown_close"];xi(this,n,()=>{var o,r;const l=this,f=l.settings.mode,I=Ze(e);if(!(I&&l.items.indexOf(I)!==-1&&(f==="single"&&l.close(),f==="single"||!l.settings.duplicates))&&!(I===null||!l.options.hasOwnProperty(I))&&(f==="single"&&l.clear(t),!(f==="multi"&&l.isFull()))){if(o=l._render("item",l.options[I]),l.control.contains(o)&&(o=o.cloneNode(!0)),r=l.isFull(),l.items.splice(l.caretPos,0,I),l.insertAtCaret(o),l.isSetup){if(!l.isPending&&l.settings.hideSelected){let y=l.getOption(I),_=l.getAdjacent(y,1);_&&l.setActiveOption(_)}!l.isPending&&!l.settings.closeAfterSelect&&l.refreshOptions(l.isFocused&&f!=="single"),l.settings.closeAfterSelect!=!1&&l.isFull()?l.close():l.isPending||l.positionDropdown(),l.trigger("item_add",I,o),l.isPending||l.updateOriginalInput({silent:t})}(!l.isPending||!r&&l.isFull())&&(l.inputState(),l.refreshState())}})}removeItem(e=null,t){const n=this;if(e=n.getItem(e),!e)return;var o,r;const l=e.dataset.value;o=ln(e),e.remove(),e.classList.contains("active")&&(r=n.activeItems.indexOf(e),n.activeItems.splice(r,1),at(e,"active")),n.items.splice(o,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(l)&&n.removeOption(l,t),o<n.caretPos&&n.setCaret(n.caretPos-1),n.updateOriginalInput({silent:t}),n.refreshState(),n.positionDropdown(),n.trigger("item_remove",l,e)}createItem(e=null,t=()=>{}){arguments.length===3&&(t=arguments[2]),typeof t!="function"&&(t=()=>{});var n=this,o=n.caretPos,r;if(e=e||n.inputValue(),!n.canCreate(e))return t(),!1;n.lock();var l=!1,f=I=>{if(n.unlock(),!I||typeof I!="object")return t();var y=Ze(I[n.settings.valueField]);if(typeof y!="string")return t();n.setTextboxValue(),n.addOption(I,!0),n.setCaret(o),n.addItem(y),t(I),l=!0};return typeof n.settings.create=="function"?r=n.settings.create.call(this,e,f):r={[n.settings.labelField]:e,[n.settings.valueField]:e},l||f(r),!0}refreshItems(){var e=this;e.lastQuery=null,e.isSetup&&e.addItems(e.items),e.updateOriginalInput(),e.refreshState()}refreshState(){const e=this;e.refreshValidityState();const t=e.isFull(),n=e.isLocked;e.wrapper.classList.toggle("rtl",e.rtl);const o=e.wrapper.classList;o.toggle("focus",e.isFocused),o.toggle("disabled",e.isDisabled),o.toggle("readonly",e.isReadOnly),o.toggle("required",e.isRequired),o.toggle("invalid",!e.isValid),o.toggle("locked",n),o.toggle("full",t),o.toggle("input-active",e.isFocused&&!e.isInputHidden),o.toggle("dropdown-active",e.isOpen),o.toggle("has-options",Go(e.options)),o.toggle("has-items",e.items.length>0)}refreshValidityState(){var e=this;e.input.validity&&(e.isValid=e.input.validity.valid,e.isInvalid=!e.isValid)}isFull(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems}updateOriginalInput(e={}){const t=this;var n,o;const r=t.input.querySelector('option[value=""]');if(t.is_select_tag){let I=function(y,_,x){return y||(y=Be('<option value="'+qt(_)+'">'+qt(x)+"</option>")),y!=r&&t.input.append(y),l.push(y),(y!=r||f>0)&&(y.selected=!0),y};const l=[],f=t.input.querySelectorAll("option:checked").length;t.input.querySelectorAll("option:checked").forEach(y=>{y.selected=!1}),t.items.length==0&&t.settings.mode=="single"?I(r,"",""):t.items.forEach(y=>{if(n=t.options[y],o=n[t.settings.labelField]||"",l.includes(n.$option)){const _=t.input.querySelector(`option[value="${Ai(y)}"]:not(:checked)`);I(_,y,o)}else n.$option=I(n.$option,y,o)})}else t.input.value=t.getValue();t.isSetup&&(e.silent||t.trigger("change",t.getValue()))}open(){var e=this;e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull()||(e.isOpen=!0,Pe(e.focus_node,{"aria-expanded":"true"}),e.refreshState(),Vt(e.dropdown,{visibility:"hidden",display:"block"}),e.positionDropdown(),Vt(e.dropdown,{visibility:"visible",display:"block"}),e.focus(),e.trigger("dropdown_open",e.dropdown))}close(e=!0){var t=this,n=t.isOpen;e&&(t.setTextboxValue(),t.settings.mode==="single"&&t.items.length&&t.inputState()),t.isOpen=!1,Pe(t.focus_node,{"aria-expanded":"false"}),Vt(t.dropdown,{display:"none"}),t.settings.hideSelected&&t.clearActiveOption(),t.refreshState(),n&&t.trigger("dropdown_close",t.dropdown)}positionDropdown(){if(this.settings.dropdownParent==="body"){var e=this.control,t=e.getBoundingClientRect(),n=e.offsetHeight+t.top+window.scrollY,o=t.left+window.scrollX;Vt(this.dropdown,{width:t.width+"px",top:n+"px",left:o+"px"})}}clear(e){var t=this;if(t.items.length){var n=t.controlChildren();We(n,o=>{t.removeItem(o,!0)}),t.inputState(),e||t.updateOriginalInput(),t.trigger("clear")}}insertAtCaret(e){const t=this,n=t.caretPos,o=t.control;o.insertBefore(e,o.children[n]||null),t.setCaret(n+1)}deleteSelection(e){var t,n,o,r,l=this;t=e&&e.keyCode===Ni?-1:1,n=ia(l.control_input);const f=[];if(l.activeItems.length)r=Oi(l.activeItems,t),o=ln(r),t>0&&o++,We(l.activeItems,I=>f.push(I));else if((l.isFocused||l.settings.mode==="single")&&l.items.length){const I=l.controlChildren();let y;t<0&&n.start===0&&n.length===0?y=I[l.caretPos-1]:t>0&&n.start===l.inputValue().length&&(y=I[l.caretPos]),y!==void 0&&f.push(y)}if(!l.shouldDelete(f,e))return!1;for(Ne(e,!0),typeof o<"u"&&l.setCaret(o);f.length;)l.removeItem(f.pop());return l.inputState(),l.positionDropdown(),l.refreshOptions(!1),!0}shouldDelete(e,t){const n=e.map(o=>o.dataset.value);return!(!n.length||typeof this.settings.onDelete=="function"&&this.settings.onDelete(n,t)===!1)}advanceSelection(e,t){var n,o,r=this;r.rtl&&(e*=-1),!r.inputValue().length&&(ft(jt,t)||ft("shiftKey",t)?(n=r.getLastActive(e),n?n.classList.contains("active")?o=r.getAdjacent(n,e,"item"):o=n:e>0?o=r.control_input.nextElementSibling:o=r.control_input.previousElementSibling,o&&(o.classList.contains("active")&&r.removeActiveItem(n),r.setActiveItemClass(o))):r.moveCaret(e))}moveCaret(e){}getLastActive(e){let t=this.control.querySelector(".last-active");if(t)return t;var n=this.control.querySelectorAll(".active");if(n)return Oi(n,e)}setCaret(e){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(e=this.isReadOnly||this.isDisabled){this.isLocked=e,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(e){this.focus_node.tabIndex=e?-1:this.tabIndex,this.isDisabled=e,this.input.disabled=e,this.control_input.disabled=e,this.setLocked()}setReadOnly(e){this.isReadOnly=e,this.input.readOnly=e,this.control_input.readOnly=e,this.setLocked()}destroy(){var e=this,t=e.revertSettings;e.trigger("destroy"),e.off(),e.wrapper.remove(),e.dropdown.remove(),e.input.innerHTML=t.innerHTML,e.input.tabIndex=t.tabIndex,at(e.input,"tomselected","ts-hidden-accessible"),e._destroy(),delete e.input.tomselect}render(e,t){var n,o;const r=this;if(typeof this.settings.render[e]!="function"||(o=r.settings.render[e].call(this,t,qt),!o))return null;if(o=Be(o),e==="option"||e==="option_create"?t[r.settings.disabledField]?Pe(o,{"aria-disabled":"true"}):Pe(o,{"data-selectable":""}):e==="optgroup"&&(n=t.group[r.settings.optgroupValueField],Pe(o,{"data-group":n}),t.group[r.settings.disabledField]&&Pe(o,{"data-disabled":""})),e==="option"||e==="item"){const l=Gt(t[r.settings.valueField]);Pe(o,{"data-value":l}),e==="item"?(He(o,r.settings.itemClass),Pe(o,{"data-ts-item":""})):(He(o,r.settings.optionClass),Pe(o,{role:"option",id:t.$id}),t.$div=o,r.options[l]=t)}return o}_render(e,t){const n=this.render(e,t);if(n==null)throw"HTMLElement expected";return n}clearCache(){We(this.options,e=>{e.$div&&(e.$div.remove(),delete e.$div)})}uncacheValue(e){const t=this.getOption(e);t&&t.remove()}canCreate(e){return this.settings.create&&e.length>0&&this.settings.createFilter.call(this,e)}hook(e,t,n){var o=this,r=o[t];o[t]=function(){var l,f;return e==="after"&&(l=r.apply(o,arguments)),f=n.apply(o,arguments),e==="instead"?f:(e==="before"&&(l=r.apply(o,arguments)),l)}}}function ra(){ke(this.input,"change",()=>{this.sync()})}function oa(i){var e=this,t=e.onOptionSelect;e.settings.hideSelected=!1;const n=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},i);var o=function(f,I){I?(f.checked=!0,n.uncheckedClassNames&&f.classList.remove(...n.uncheckedClassNames),n.checkedClassNames&&f.classList.add(...n.checkedClassNames)):(f.checked=!1,n.checkedClassNames&&f.classList.remove(...n.checkedClassNames),n.uncheckedClassNames&&f.classList.add(...n.uncheckedClassNames))},r=function(f){setTimeout(()=>{var I=f.querySelector("input."+n.className);I instanceof HTMLInputElement&&o(I,f.classList.contains("selected"))},1)};e.hook("after","setupTemplates",()=>{var l=e.settings.render.option;e.settings.render.option=(f,I)=>{var y=Be(l.call(e,f,I)),_=document.createElement("input");n.className&&_.classList.add(n.className),_.addEventListener("click",function(A){Ne(A)}),_.type="checkbox";const x=Ze(f[e.settings.valueField]);return o(_,!!(x&&e.items.indexOf(x)>-1)),y.prepend(_),y}}),e.on("item_remove",l=>{var f=e.getOption(l);f&&(f.classList.remove("selected"),r(f))}),e.on("item_add",l=>{var f=e.getOption(l);f&&r(f)}),e.hook("instead","onOptionSelect",(l,f)=>{if(f.classList.contains("selected")){f.classList.remove("selected"),e.removeItem(f.dataset.value),e.refreshOptions(),Ne(l,!0);return}t.call(e,l,f),r(f)})}function aa(i){const e=this,t=Object.assign({className:"clear-button",title:"Clear All",html:n=>`<div class="${n.className}" title="${n.title}">&#10799;</div>`},i);e.on("initialize",()=>{var n=Be(t.html(t));n.addEventListener("click",o=>{e.isLocked||(e.clear(),e.settings.mode==="single"&&e.settings.allowEmptyOption&&e.addItem(""),o.preventDefault(),o.stopPropagation())}),e.control.appendChild(n)})}const sa=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i.nextSibling)},la=(i,e)=>{var t;(t=i.parentNode)==null||t.insertBefore(e,i)},ca=(i,e)=>{do{var t;if(e=(t=e)==null?void 0:t.previousElementSibling,i==e)return!0}while(e&&e.previousElementSibling);return!1};function ua(){var i=this;if(i.settings.mode!=="multi")return;var e=i.lock,t=i.unlock;let n=!0,o;i.hook("after","setupTemplates",()=>{var r=i.settings.render.item;i.settings.render.item=(l,f)=>{const I=Be(r.call(i,l,f));Pe(I,{draggable:"true"});const y=R=>{n||Ne(R),R.stopPropagation()},_=R=>{o=I,setTimeout(()=>{I.classList.add("ts-dragging")},0)},x=R=>{R.preventDefault(),I.classList.add("ts-drag-over"),H(I,o)},A=()=>{I.classList.remove("ts-drag-over")},H=(R,S)=>{S!==void 0&&(ca(S,I)?sa(R,S):la(R,S))},N=()=>{var R;document.querySelectorAll(".ts-drag-over").forEach(D=>D.classList.remove("ts-drag-over")),(R=o)==null||R.classList.remove("ts-dragging"),o=void 0;var S=[];i.control.querySelectorAll("[data-value]").forEach(D=>{if(D.dataset.value){let C=D.dataset.value;C&&S.push(C)}}),i.setValue(S)};return ke(I,"mousedown",y),ke(I,"dragstart",_),ke(I,"dragenter",x),ke(I,"dragover",x),ke(I,"dragleave",A),ke(I,"dragend",N),I}}),i.hook("instead","lock",()=>(n=!1,e.call(i))),i.hook("instead","unlock",()=>(n=!0,t.call(i)))}function da(i){const e=this,t=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:n=>'<div class="'+n.headerClass+'"><div class="'+n.titleRowClass+'"><span class="'+n.labelClass+'">'+n.title+'</span><a class="'+n.closeClass+'">&times;</a></div></div>'},i);e.on("initialize",()=>{var n=Be(t.html(t)),o=n.querySelector("."+t.closeClass);o&&o.addEventListener("click",r=>{Ne(r,!0),e.close()}),e.dropdown.insertBefore(n,e.dropdown.firstChild)})}function fa(){var i=this;i.hook("instead","setCaret",e=>{i.settings.mode==="single"||!i.control.contains(i.control_input)?e=i.items.length:(e=Math.max(0,Math.min(i.items.length,e)),e!=i.caretPos&&!i.isPending&&i.controlChildren().forEach((t,n)=>{n<e?i.control_input.insertAdjacentElement("beforebegin",t):i.control.appendChild(t)})),i.caretPos=e}),i.hook("instead","moveCaret",e=>{if(!i.isFocused)return;const t=i.getLastActive(e);if(t){const n=ln(t);i.setCaret(e>0?n+1:n),i.setActiveItem(),at(t,"last-active")}else i.setCaret(i.caretPos+e)})}function pa(){const i=this;i.settings.shouldOpen=!0,i.hook("before","setup",()=>{i.focus_node=i.control,He(i.control_input,"dropdown-input");const e=Be('<div class="dropdown-input-wrap">');e.append(i.control_input),i.dropdown.insertBefore(e,i.dropdown.firstChild);const t=Be('<input class="items-placeholder" tabindex="-1" />');t.placeholder=i.settings.placeholder||"",i.control.append(t)}),i.on("initialize",()=>{i.control_input.addEventListener("keydown",t=>{switch(t.keyCode){case or:i.isOpen&&(Ne(t,!0),i.close()),i.clearActiveItems();return;case Un:i.focus_node.tabIndex=-1;break}return i.onKeyDown.call(i,t)}),i.on("blur",()=>{i.focus_node.tabIndex=i.isDisabled?-1:i.tabIndex}),i.on("dropdown_open",()=>{i.control_input.focus()});const e=i.onBlur;i.hook("instead","onBlur",t=>{if(!(t&&t.relatedTarget==i.control_input))return e.call(i)}),ke(i.control_input,"blur",()=>i.onBlur()),i.hook("before","close",()=>{i.isOpen&&i.focus_node.focus({preventScroll:!0})})})}function ha(){var i=this;i.on("initialize",()=>{var e=document.createElement("span"),t=i.control_input;e.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",i.wrapper.appendChild(e);var n=["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"];for(const r of n)e.style[r]=t.style[r];var o=()=>{e.textContent=t.value,t.style.width=e.clientWidth+"px"};o(),i.on("update item_add item_remove",o),ke(t,"input",o),ke(t,"keyup",o),ke(t,"blur",o),ke(t,"update",o)})}function ga(){var i=this,e=i.deleteSelection;this.hook("instead","deleteSelection",t=>i.activeItems.length?e.call(i,t):!1)}function ma(){this.hook("instead","setActiveItem",()=>{}),this.hook("instead","selectAll",()=>{})}function ya(){var i=this,e=i.onKeyDown;i.hook("instead","onKeyDown",t=>{var n,o,r,l;if(!i.isOpen||!(t.keyCode===jn||t.keyCode===ar))return e.call(i,t);i.ignoreHover=!0,l=Wt(i.activeOption,"[data-group]"),n=ln(i.activeOption,"[data-selectable]"),l&&(t.keyCode===jn?l=l.previousSibling:l=l.nextSibling,l&&(r=l.querySelectorAll("[data-selectable]"),o=r[Math.min(r.length-1,n)],o&&i.setActiveOption(o)))})}function va(i){const e=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},i);var t=this;if(e.append){var n='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+qt(e.title)+'">'+e.label+"</a>";t.hook("after","setupTemplates",()=>{var o=t.settings.render.item;t.settings.render.item=(r,l)=>{var f=Be(o.call(t,r,l)),I=Be(n);return f.appendChild(I),ke(I,"mousedown",y=>{Ne(y,!0)}),ke(I,"click",y=>{t.isLocked||(Ne(y,!0),!t.isLocked&&t.shouldDelete([f],y)&&(t.removeItem(f),t.refreshOptions(!1),t.inputState()))}),f}})}}function Ia(i){const e=this,t=Object.assign({text:n=>n[e.settings.labelField]},i);e.on("item_remove",function(n){if(e.isFocused&&e.control_input.value.trim()===""){var o=e.options[n];o&&e.setTextboxValue(t.text.call(e,o))}})}function Ea(){const i=this,e=i.canLoad,t=i.clearActiveOption,n=i.loadCallback;var o={},r,l=!1,f,I=[];if(i.settings.shouldLoadMore||(i.settings.shouldLoadMore=()=>{if(r.clientHeight/(r.scrollHeight-r.scrollTop)>.9)return!0;if(i.activeOption){var A=i.selectable(),H=Array.from(A).indexOf(i.activeOption);if(H>=A.length-2)return!0}return!1}),!i.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";i.settings.sortField=[{field:"$order"},{field:"$score"}];const y=x=>typeof i.settings.maxOptions=="number"&&r.children.length>=i.settings.maxOptions?!1:!!(x in o&&o[x]),_=(x,A)=>i.items.indexOf(A)>=0||I.indexOf(A)>=0;i.setNextUrl=(x,A)=>{o[x]=A},i.getUrl=x=>{if(x in o){const A=o[x];return o[x]=!1,A}return i.clearPagination(),i.settings.firstUrl.call(i,x)},i.clearPagination=()=>{o={}},i.hook("instead","clearActiveOption",()=>{if(!l)return t.call(i)}),i.hook("instead","canLoad",x=>x in o?y(x):e.call(i,x)),i.hook("instead","loadCallback",(x,A)=>{if(!l)i.clearOptions(_);else if(f){const H=x[0];H!==void 0&&(f.dataset.value=H[i.settings.valueField])}n.call(i,x,A),l=!1}),i.hook("after","refreshOptions",()=>{const x=i.lastValue;var A;y(x)?(A=i.render("loading_more",{query:x}),A&&(A.setAttribute("data-selectable",""),f=A)):x in o&&!r.querySelector(".no-results")&&(A=i.render("no_more_results",{query:x})),A&&(He(A,i.settings.optionClass),r.append(A))}),i.on("initialize",()=>{I=Object.keys(i.options),r=i.dropdown_content,i.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},i.settings.render),r.addEventListener("scroll",()=>{i.settings.shouldLoadMore.call(i)&&y(i.lastValue)&&(l||(l=!0,i.load.call(i,i.lastValue)))})})}Ge.define("change_listener",ra);Ge.define("checkbox_options",oa);Ge.define("clear_button",aa);Ge.define("drag_drop",ua);Ge.define("dropdown_header",da);Ge.define("caret_position",fa);Ge.define("dropdown_input",pa);Ge.define("input_autogrow",ha);Ge.define("no_backspace_delete",ga);Ge.define("no_active_items",ma);Ge.define("optgroup_columns",ya);Ge.define("remove_button",va);Ge.define("restore_on_backspace",Ia);Ge.define("virtual_scroll",Ea);async function wa(i){if(!await $.scene.isReady())return;const n=(await $.scene.local.getItems(r=>r.layer==="CHARACTER"))?.map(r=>r.id);let o=!1;for(const r of i){const l=r.metadata[`${m.EXTENSIONID}/metadata_ghosts`];if(l?.length>0){o=!0;const f=l.map(y=>y.id);for(const y of l){const _=y.metadata[`${m.EXTENSIONID}/viewers`];_&&(_.includes(L.userId)?await $.scene.local.addItems([y]):n.includes(y.id)&&await $.scene.local.deleteItems([y.id]))}const I=n.filter(y=>!f.includes(y));I?.length>0&&await $.scene.local.deleteItems(I)}}o||await $.scene.local.deleteItems(n)}function ba(){const i=document.querySelectorAll(".tSelects");for(const e of i)if(e&&e.tomselect){const t=e.tomselect,n=[];for(const o of L.players)n.push({value:o.id,text:o.name});t.clearOptions(),t.addOption(n),n.length===0?(t.settings.placeholder="No Players",t.inputState()):(t.settings.placeholder="Choose..",t.inputState())}}async function Sa(){let i=L.metadata[`${m.SPECTREID}/stored`];i&&(await $.scene.local.addItems(i),i.forEach(e=>{lr(e)}))}async function _a(){$.scene.local.onChange(async i=>{const e=i.filter(n=>n.layer=="CHARACTER");if(e.length===0)return;const t={};t[`${m.EXTENSIONID}/metadata_ghosts`]=e,await $.player.setMetadata(t)}),await $.contextMenu.create({id:`${m.EXTENSIONID}/context-menu`,icons:[{icon:"/ghost.svg",label:"Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${m.SPECTREID}/spectred`],value:void 0,operator:"==",coordinator:"&&"}]}},{icon:"/ghost.svg",label:"Un-Spectre",filter:{every:[{key:"layer",value:"CHARACTER"},{key:["metadata",`${m.SPECTREID}/spectred`],value:void 0,operator:"!=",coordinator:"&&"}]}}],async onClick(i){if(i.items.every(t=>t.metadata[`${m.SPECTREID}/spectred`]===void 0)){document.getElementById("spectreWarning").style.display="none";for(const t of i.items)lr(t)}else for(const t of i.items){const n=t;n.metadata[`${m.SPECTREID}/spectred`]=void 0,document.getElementById(`deleteGhost-${n.id}`);const o=L.ghosts.findIndex(l=>l.id===n.id);L.ghosts.splice(o,1),document.getElementById(`tr-${n.id}`)?.remove(),await $.scene.local.updateItems([n.id],l=>{l[0].metadata[`${m.EXTENSIONID}/viewers`]=[]}),await sr(n),await $.scene.items.addItems([n])}}})}async function sr(i){const t=L.metadata[`${m.SPECTREID}/stored`].filter(n=>n.id!==i.id);await $.scene.setMetadata({[`${m.SPECTREID}/stored`]:t}),await $.scene.local.deleteItems([i.id])}async function Ta(i){let e=L.metadata[`${m.SPECTREID}/stored`];if(!e)e=[i];else{if(e.find(n=>n.id===i.id))return;e.push(i)}await $.scene.setMetadata({[`${m.SPECTREID}/stored`]:e})}async function lr(i){const e=i.text?.plainText||i.name;i.metadata[`${m.SPECTREID}/spectred`]=!0,await $.scene.items.deleteItems([i.id]),await $.scene.local.addItems([i]),await Ta(i),L.ghosts.push(i);const t=document.getElementById("ghostList"),n=document.createElement("tr");n.id=`tr-${i.id}`,n.className="ghost-table-entry",n.innerHTML=`<td class="token-name">${e}</td>
<td><select id="select-${i.id}" class="tSelects" multiple autocomplete="off" /></td>
<td><input type="button" class="mysteryButton" id="deleteGhost-${i.id}" value="Delete"/></td>`,t.appendChild(n);const o=document.getElementById(`select-${i.id}`);for(const f of L.players){const I=document.createElement("option");I.value=f.id,I.text=f.name,o.appendChild(I)}const r={plugins:{remove_button:{title:"Remove this item"}},allowEmptyOption:!0,placeholder:L.players.length==0?"No Players":"Choose..",maxItems:null,create:!1,onDelete:async function(f,I){const y=I.currentTarget.parentElement.parentElement.parentElement.parentElement.parentElement.id.slice(3);await $.scene.local.updateItems([y],_=>{const x=_[0].metadata[`${m.EXTENSIONID}/viewers`],A=x.findIndex(H=>H==f);x.splice(A,1),_[0].metadata[`${m.EXTENSIONID}/viewers`]=x})},onItemAdd:async function(f,I){const y=I.parentElement.parentElement.parentElement.parentElement.id.slice(3);await $.scene.local.updateItems([y],_=>{const x=_[0].metadata[`${m.EXTENSIONID}/viewers`];x?(x.push(f),_[0].metadata[`${m.EXTENSIONID}/viewers`]=x):_[0].metadata[`${m.EXTENSIONID}/viewers`]=[f]})}};new Ge(`#select-${i.id}`,r);const l=document.getElementById(`deleteGhost-${i.id}`);l.onclick=async()=>{const f=L.ghosts.findIndex(I=>I.id===i.id);L.ghosts.splice(f,1),n.remove(),await $.scene.local.updateItems([i.id],I=>{I[0].metadata[`${m.EXTENSIONID}/viewers`]=[]}),await sr(i)}}var cr={exports:{}};(function(i){(function(){function e(f,I){var y=f.x-I.x,_=f.y-I.y;return y*y+_*_}function t(f,I,y){var _=I.x,x=I.y,A=y.x-_,H=y.y-x;if(A!==0||H!==0){var N=((f.x-_)*A+(f.y-x)*H)/(A*A+H*H);N>1?(_=y.x,x=y.y):N>0&&(_+=A*N,x+=H*N)}return A=f.x-_,H=f.y-x,A*A+H*H}function n(f,I){for(var y=f[0],_=[y],x,A=1,H=f.length;A<H;A++)x=f[A],e(x,y)>I&&(_.push(x),y=x);return y!==x&&_.push(x),_}function o(f,I,y,_,x){for(var A=_,H,N=I+1;N<y;N++){var R=t(f[N],f[I],f[y]);R>A&&(H=N,A=R)}A>_&&(H-I>1&&o(f,I,H,_,x),x.push(f[H]),y-H>1&&o(f,H,y,_,x))}function r(f,I){var y=f.length-1,_=[f[0]];return o(f,0,y,I,_),_.push(f[y]),_}function l(f,I,y){if(f.length<=2)return f;var _=I!==void 0?I*I:1;return f=y?f:n(f,_),f=r(f,_),f}i.exports=l,i.exports.default=l})()})(cr);var Oa=cr.exports;const Na=qn(Oa);async function $i(i){const e=await $.scene.items.getItems(o=>o.layer==="MAP"),t={};for(let o=0;o<e.length;o++){let r=i.querySelector("#map-"+e[o].id);r===null&&(r=document.createElement("option"),r.id="map-"+e[o].id,r.value=e[o].id,r.innerText=e[o].name,i.appendChild(r)),t[e[o].id]=e[o].name}let n=i.querySelectorAll("option");for(let o=0;o<n.length;o++)t[n[o].value]===void 0&&i.removeChild(n[o])}async function ka(i,e,t,n,o){if(o.innerText="",Number.isNaN(t)||t<0){o.innerText="Invalid DPI";return}let r=L.gridDpi/t,l,f=[];if(f[0]=0,f[1]=0,n!==""){let I=await $.scene.items.getItems([n]);if(I.length>0)l=I[0],t===0&&(t=l.grid.dpi),r=L.gridDpi/t,f[0]=l.position.x-l.grid.offset.x*r,f[1]=l.position.y-l.grid.offset.y*r;else{o.innerText="Unable to find map";return}}else{o.innerText="No map selected";return}i==="foundry"?Aa(e,r,f,o):i==="uvtt"&&xa(e,r,f,o)}function ur(i,e,t,n,o){let r=0,l=0,f=0;const I=[];for(let y=0;y<i.length;y++){let _=[],x=!1;for(let A=0;A<i[y].length-1;A++){let H=i[y][A].x*e,N=i[y][A].y*e,R=i[y][A+1].x*e,S=i[y][A+1].y*e;_.push({x:H*t+n[0],y:N*t+n[1]}),_.push({x:R*t+n[0],y:S*t+n[1]}),l++,!x&&i[y][A].door&&(x=!0)}if(_.length>128){let A=_.length;_=Na(_,8,!1),console.log("simplified points from "+A+" to "+_.length)}for(let A=0;A<_.length;A+=256){const H=_.slice(A>0?A-1:0,A+256),N=Gn().tension(0).points(H).fillColor("#000000").fillOpacity(0).layer("DRAWING").name("Vision Line (Line)").closed(!1).build();if(N.visible=!1,N.metadata[`${m.EXTENSIONID}/isVisionLine`]=!0,x&&(N.metadata[`${m.EXTENSIONID}/isDoor`]=!0),I.push(N),f+=H.length,f>512||I.length>64){r+=I.length,$.scene.items.addItems(I);const R=I.filter(S=>S.metadata[`${m.EXTENSIONID}/isDoor`]===!0);rn(R),I.length=0,f=0}}}if(I.length>0){r+=I.length,$.scene.items.addItems(I);const y=I.filter(_=>_.metadata[`${m.EXTENSIONID}/isDoor`]===!0);rn(y)}o.innerText="Finished importing "+r+" walls, "+l+" points."}function xa(i,e,t,n){if(!i.line_of_sight||i.line_of_sight.length===0){n.innerText="No walls / los found";return}if(i.resolution.map_origin!==void 0&&(t[0]-=i.resolution.map_origin.x*i.resolution.pixels_per_grid,t[1]-=i.resolution.map_origin.y*i.resolution.pixels_per_grid),i.portals&&i.portals.length)for(let o=0;o<i.portals.length;o++){let r=i.portals[o].bounds;r[0].door=!0,r[1].door=!0,i.line_of_sight.push(r)}ur(i.line_of_sight,i.resolution.pixels_per_grid,e,t,n)}function Aa(i,e,t,n){if(!i.walls||i.walls.length===0){n.innerText="No walls found";return}const o=[];for(var r=0;r<i.walls.length;r++)o.push([{x:i.walls[r].c[0],y:i.walls[r].c[1],door:!!i.walls[r].door},{x:i.walls[r].c[2],y:i.walls[r].c[3],door:!!i.walls[r].door}]);ur(o,1,e,t,n)}function Pi(i,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),n=t.matches?"dark":"light",o=t.matches?"light":"dark";for(var r=0;r<e.styleSheets.length;r++)for(var l=0;l<e.styleSheets[r].cssRules.length;l++){let f=e.styleSheets[r].cssRules[l];f&&f.media&&f.media.mediaText.includes("prefers-color-scheme")&&(i.mode=="LIGHT"?(f.media.appendMedium(`(prefers-color-scheme: ${n})`),f.media.mediaText.includes(o)&&f.media.deleteMedium(`(prefers-color-scheme: ${o})`)):i.mode=="DARK"&&(f.media.appendMedium(`(prefers-color-scheme: ${o})`),f.media.mediaText.includes(n)&&f.media.deleteMedium(`(prefers-color-scheme: ${n})`)))}}var nt=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return function(i,e,t,n){var o=e.createElement("canvas").getContext("2d"),r={r:0,g:0,b:0,h:0,s:0,v:0,a:1},l,f,I,y,_,x,A,H,N,R,S,D,C,B,F,Q,O={},h={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){return n},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},p={},E="",g={},T=!1;function P(b){if(typeof b=="object"){var U=function(){switch(W){case"el":ge(b.el),b.wrap!==!1&&fe(b.el);break;case"parent":l=e.querySelector(b.parent),l&&(l.appendChild(f),h.parent=b.parent,l===e.body&&(l=n));break;case"themeMode":h.themeMode=b.themeMode,b.themeMode==="auto"&&i.matchMedia&&i.matchMedia("(prefers-color-scheme: dark)").matches&&(h.themeMode="dark");case"theme":b.theme&&(h.theme=b.theme),f.className="clr-picker clr-"+h.theme+" clr-"+h.themeMode,h.inline&&ve();break;case"rtl":h.rtl=!!b.rtl,e.querySelectorAll(".clr-field").forEach(function(Me){return Me.classList.toggle("clr-rtl",h.rtl)});break;case"margin":b.margin*=1,h.margin=isNaN(b.margin)?h.margin:b.margin;break;case"wrap":b.el&&b.wrap&&fe(b.el);break;case"formatToggle":h.formatToggle=!!b.formatToggle,pe("clr-format").style.display=h.formatToggle?"block":"none",h.formatToggle&&(h.format="auto");break;case"swatches":if(Array.isArray(b.swatches)){var ue=[];b.swatches.forEach(function(Me,ye){ue.push('<button type="button" id="clr-swatch-'+ye+'" aria-labelledby="clr-swatch-label clr-swatch-'+ye+'" style="color: '+Me+';">'+Me+"</button>")}),pe("clr-swatches").innerHTML=ue.length?"<div>"+ue.join("")+"</div>":"",h.swatches=b.swatches.slice()}break;case"swatchesOnly":h.swatchesOnly=!!b.swatchesOnly,f.setAttribute("data-minimal",h.swatchesOnly);break;case"alpha":h.alpha=!!b.alpha,f.setAttribute("data-alpha",h.alpha);break;case"inline":if(h.inline=!!b.inline,f.setAttribute("data-inline",h.inline),h.inline){var he=b.defaultColor||h.defaultColor;B=Re(he),ve(),we(he)}break;case"clearButton":typeof b.clearButton=="object"&&(b.clearButton.label&&(h.clearLabel=b.clearButton.label,A.innerHTML=h.clearLabel),b.clearButton=b.clearButton.show),h.clearButton=!!b.clearButton,A.style.display=h.clearButton?"block":"none";break;case"clearLabel":h.clearLabel=b.clearLabel,A.innerHTML=h.clearLabel;break;case"closeButton":h.closeButton=!!b.closeButton,h.closeButton?f.insertBefore(H,_):_.appendChild(H);break;case"closeLabel":h.closeLabel=b.closeLabel,H.innerHTML=h.closeLabel;break;case"a11y":var de=b.a11y,Ce=!1;if(typeof de=="object")for(var me in de)de[me]&&h.a11y[me]&&(h.a11y[me]=de[me],Ce=!0);if(Ce){var Le=pe("clr-open-label"),be=pe("clr-swatch-label");Le.innerHTML=h.a11y.open,be.innerHTML=h.a11y.swatch,H.setAttribute("aria-label",h.a11y.close),A.setAttribute("aria-label",h.a11y.clear),N.setAttribute("aria-label",h.a11y.hueSlider),S.setAttribute("aria-label",h.a11y.alphaSlider),x.setAttribute("aria-label",h.a11y.input),I.setAttribute("aria-label",h.a11y.instruction)}break;default:h[W]=b[W]}};for(var W in b)U()}}function ne(b,U){typeof b=="string"&&typeof U=="object"&&(p[b]=U,T=!0)}function te(b){delete p[b],Object.keys(p).length===0&&(T=!1,b===E&&Y())}function re(b){if(T){var U=["el","wrap","rtl","inline","defaultColor","a11y"],W=function(){var de=p[ee];if(b.matches(ee)){E=ee,g={},U.forEach(function(me){return delete de[me]});for(var Ce in de)g[Ce]=Array.isArray(h[Ce])?h[Ce].slice():h[Ce];return P(de),"break"}};for(var ee in p){var ue=W();if(ue==="break")break}}}function Y(){Object.keys(g).length>0&&(P(g),E="",g={})}function ge(b){Ee(e,"click",b,function(U){h.inline||(re(U.target),C=U.target,F=C.value,B=Re(F),f.classList.add("clr-open"),ve(),we(F),(h.focusInput||h.selectInput)&&(x.focus({preventScroll:!0}),x.setSelectionRange(C.selectionStart,C.selectionEnd)),h.selectInput&&x.select(),(Q||h.swatchesOnly)&&Te().shift().focus(),C.dispatchEvent(new Event("open",{bubbles:!0})))}),Ee(e,"input",b,function(U){var W=U.target.parentNode;W.classList.contains("clr-field")&&(W.style.color=U.target.value)})}function ve(){if(!(!f||!C&&!h.inline)){var b=l,U=i.scrollY,W=f.offsetWidth,ee=f.offsetHeight,ue={left:!1,top:!1},he,de,Ce,me={x:0,y:0};if(b&&(he=i.getComputedStyle(b),de=parseFloat(he.marginTop),Ce=parseFloat(he.borderTopWidth),me=b.getBoundingClientRect(),me.y+=Ce+U),!h.inline){var Le=C.getBoundingClientRect(),be=Le.x,Me=U+Le.y+Le.height+h.margin;b?(be-=me.x,Me-=me.y,be+W>b.clientWidth&&(be+=Le.width-W,ue.left=!0),Me+ee>b.clientHeight-de&&ee+h.margin<=Le.top-(me.y-U)&&(Me-=Le.height+ee+h.margin*2,ue.top=!0),Me+=b.scrollTop):(be+W>e.documentElement.clientWidth&&(be+=Le.width-W,ue.left=!0),Me+ee-U>e.documentElement.clientHeight&&ee+h.margin<=Le.top&&(Me=U+Le.y-ee-h.margin,ue.top=!0)),f.classList.toggle("clr-left",ue.left),f.classList.toggle("clr-top",ue.top),f.style.left=be+"px",f.style.top=Me+"px",me.x+=f.offsetLeft,me.y+=f.offsetTop}O={width:I.offsetWidth,height:I.offsetHeight,x:I.offsetLeft+me.x,y:I.offsetTop+me.y}}}function fe(b){e.querySelectorAll(b).forEach(function(U){var W=U.parentNode;if(!W.classList.contains("clr-field")){var ee=e.createElement("div"),ue="clr-field";(h.rtl||U.classList.contains("clr-rtl"))&&(ue+=" clr-rtl"),ee.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',W.insertBefore(ee,U),ee.setAttribute("class",ue),ee.style.color=U.value,ee.appendChild(U)}})}function oe(b){if(C&&!h.inline){var U=C;b&&(C=n,F!==U.value&&(U.value=F,U.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){F!==U.value&&U.dispatchEvent(new Event("change",{bubbles:!0}))}),f.classList.remove("clr-open"),T&&Y(),U.dispatchEvent(new Event("close",{bubbles:!0})),h.focusInput&&U.focus({preventScroll:!0}),C=n}}function we(b){var U=ce(b),W=ae(U);Ke(W.s,W.v),u(U,W),N.value=W.h,f.style.color="hsl("+W.h+", 100%, 50%)",R.style.left=W.h/360*100+"%",y.style.left=O.width*W.s/100+"px",y.style.top=O.height-O.height*W.v/100+"px",S.value=W.a*100,D.style.left=W.a*100+"%"}function Re(b){var U=b.substring(0,3).toLowerCase();return U==="rgb"||U==="hsl"?U:"hex"}function le(b){b=b!==n?b:x.value,C&&(C.value=b,C.dispatchEvent(new Event("input",{bubbles:!0}))),h.onChange&&h.onChange.call(i,b,C),e.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:b,currentEl:C}}))}function xe(b,U){var W={h:N.value*1,s:b/O.width*100,v:100-U/O.height*100,a:S.value/100},ee=V(W);Ke(W.s,W.v),u(ee,W),le()}function Ke(b,U){var W=h.a11y.marker;b=b.toFixed(1)*1,U=U.toFixed(1)*1,W=W.replace("{s}",b),W=W.replace("{v}",U),y.setAttribute("aria-label",W)}function qe(b){return{pageX:b.changedTouches?b.changedTouches[0].pageX:b.pageX,pageY:b.changedTouches?b.changedTouches[0].pageY:b.pageY}}function Fe(b){var U=qe(b),W=U.pageX-O.x,ee=U.pageY-O.y;l&&(ee+=l.scrollTop),d(W,ee),b.preventDefault(),b.stopPropagation()}function K(b,U){var W=y.style.left.replace("px","")*1+b,ee=y.style.top.replace("px","")*1+U;d(W,ee)}function d(b,U){b=b<0?0:b>O.width?O.width:b,U=U<0?0:U>O.height?O.height:U,y.style.left=b+"px",y.style.top=U+"px",xe(b,U),y.focus()}function u(b,U){b===void 0&&(b={}),U===void 0&&(U={});var W=h.format;for(var ee in b)r[ee]=b[ee];for(var ue in U)r[ue]=U[ue];var he=se(r),de=he.substring(0,7);switch(y.style.color=de,D.parentNode.style.color=de,D.style.color=he,_.style.color=he,I.style.display="none",I.offsetHeight,I.style.display="",D.nextElementSibling.style.display="none",D.nextElementSibling.offsetHeight,D.nextElementSibling.style.display="",W==="mixed"?W=r.a===1?"hex":"rgb":W==="auto"&&(W=B),W){case"hex":x.value=he;break;case"rgb":x.value=Ie(r);break;case"hsl":x.value=Oe(G(r));break}e.querySelector('.clr-format [value="'+W+'"]').checked=!0}function w(){var b=N.value*1,U=y.style.left.replace("px","")*1,W=y.style.top.replace("px","")*1;f.style.color="hsl("+b+", 100%, 50%)",R.style.left=b/360*100+"%",xe(U,W)}function X(){var b=S.value/100;D.style.left=b*100+"%",u({a:b}),le()}function V(b){var U=b.s/100,W=b.v/100,ee=U*W,ue=b.h/60,he=ee*(1-t.abs(ue%2-1)),de=W-ee;ee=ee+de,he=he+de;var Ce=t.floor(ue)%6,me=[ee,he,de,de,he,ee][Ce],Le=[he,ee,ee,he,de,de][Ce],be=[de,de,he,ee,ee,he][Ce];return{r:t.round(me*255),g:t.round(Le*255),b:t.round(be*255),a:b.a}}function G(b){var U=b.v/100,W=U*(1-b.s/100/2),ee;return W>0&&W<1&&(ee=t.round((U-W)/t.min(W,1-W)*100)),{h:b.h,s:ee||0,l:t.round(W*100),a:b.a}}function ae(b){var U=b.r/255,W=b.g/255,ee=b.b/255,ue=t.max(U,W,ee),he=t.min(U,W,ee),de=ue-he,Ce=ue,me=0,Le=0;return de&&(ue===U&&(me=(W-ee)/de),ue===W&&(me=2+(ee-U)/de),ue===ee&&(me=4+(U-W)/de),ue&&(Le=de/ue)),me=t.floor(me*60),{h:me<0?me+360:me,s:t.round(Le*100),v:t.round(Ce*100),a:b.a}}function ce(b){var U=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,W,ee;return o.fillStyle="#000",o.fillStyle=b,W=U.exec(o.fillStyle),W?(ee={r:W[3]*1,g:W[4]*1,b:W[5]*1,a:W[6]*1},ee.a=+ee.a.toFixed(2)):(W=o.fillStyle.replace("#","").match(/.{2}/g).map(function(ue){return parseInt(ue,16)}),ee={r:W[0],g:W[1],b:W[2],a:1}),ee}function se(b){var U=b.r.toString(16),W=b.g.toString(16),ee=b.b.toString(16),ue="";if(b.r<16&&(U="0"+U),b.g<16&&(W="0"+W),b.b<16&&(ee="0"+ee),h.alpha&&(b.a<1||h.forceAlpha)){var he=b.a*255|0;ue=he.toString(16),he<16&&(ue="0"+ue)}return"#"+U+W+ee+ue}function Ie(b){return!h.alpha||b.a===1&&!h.forceAlpha?"rgb("+b.r+", "+b.g+", "+b.b+")":"rgba("+b.r+", "+b.g+", "+b.b+", "+b.a+")"}function Oe(b){return!h.alpha||b.a===1&&!h.forceAlpha?"hsl("+b.h+", "+b.s+"%, "+b.l+"%)":"hsla("+b.h+", "+b.s+"%, "+b.l+"%, "+b.a+")"}function Ae(){e.getElementById("clr-picker")||(l=n,f=e.createElement("div"),f.setAttribute("id","clr-picker"),f.className="clr-picker",f.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+h.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+h.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+h.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+h.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+h.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+h.a11y.clear+'">'+h.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+h.a11y.close+'">'+h.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+h.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+h.a11y.swatch+"</span>"),e.body.appendChild(f),I=pe("clr-color-area"),y=pe("clr-color-marker"),A=pe("clr-clear"),H=pe("clr-close"),_=pe("clr-color-preview"),x=pe("clr-color-value"),N=pe("clr-hue-slider"),R=pe("clr-hue-marker"),S=pe("clr-alpha-slider"),D=pe("clr-alpha-marker"),ge(h.el),fe(h.el),Ee(f,"mousedown",function(b){f.classList.remove("clr-keyboard-nav"),b.stopPropagation()}),Ee(I,"mousedown",function(b){Ee(e,"mousemove",Fe)}),Ee(I,"touchstart",function(b){e.addEventListener("touchmove",Fe,{passive:!1})}),Ee(y,"mousedown",function(b){Ee(e,"mousemove",Fe)}),Ee(y,"touchstart",function(b){e.addEventListener("touchmove",Fe,{passive:!1})}),Ee(x,"change",function(b){var U=x.value;if(C||h.inline){var W=U===""?U:we(U);le(W)}}),Ee(A,"click",function(b){le(""),oe()}),Ee(H,"click",function(b){le(),oe()}),Ee(pe("clr-format"),"click",".clr-format input",function(b){B=b.target.value,u(),le()}),Ee(f,"click",".clr-swatches button",function(b){we(b.target.textContent),le(),h.swatchesOnly&&oe()}),Ee(e,"mouseup",function(b){e.removeEventListener("mousemove",Fe)}),Ee(e,"touchend",function(b){e.removeEventListener("touchmove",Fe)}),Ee(e,"mousedown",function(b){Q=!1,f.classList.remove("clr-keyboard-nav"),oe()}),Ee(e,"keydown",function(b){var U=b.key,W=b.target,ee=b.shiftKey,ue=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(U==="Escape"?oe(!0):ue.includes(U)&&(Q=!0,f.classList.add("clr-keyboard-nav")),U==="Tab"&&W.matches(".clr-picker *")){var he=Te(),de=he.shift(),Ce=he.pop();ee&&W===de?(Ce.focus(),b.preventDefault()):!ee&&W===Ce&&(de.focus(),b.preventDefault())}}),Ee(e,"click",".clr-field button",function(b){T&&Y(),b.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),Ee(y,"keydown",function(b){var U={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(U).includes(b.key)&&(K.apply(void 0,U[b.key]),b.preventDefault())}),Ee(I,"click",Fe),Ee(N,"input",w),Ee(S,"input",X))}function Te(){var b=Array.from(f.querySelectorAll("input, button")),U=b.filter(function(W){return!!W.offsetWidth});return U}function pe(b){return e.getElementById(b)}function Ee(b,U,W,ee){var ue=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof W=="string"?b.addEventListener(U,function(he){ue.call(he.target,W)&&ee.call(he.target,he)}):(ee=W,b.addEventListener(U,ee))}function ze(b,U){U=U!==n?U:[],e.readyState!=="loading"?b.apply(void 0,U):e.addEventListener("DOMContentLoaded",function(){b.apply(void 0,U)})}NodeList!==n&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function st(b,U){C=U,F=C.value,re(U),B=Re(b),ve(),we(b),le(),F!==b&&C.dispatchEvent(new Event("change",{bubbles:!0}))}var et=function(){var b={init:Ae,set:P,wrap:fe,close:oe,setInstance:ne,setColor:st,removeInstance:te,updatePosition:ve};function U(ue){ze(function(){ue&&(typeof ue=="string"?ge(ue):P(ue))})}var W=function(he){U[he]=function(){for(var de=arguments.length,Ce=new Array(de),me=0;me<de;me++)Ce[me]=arguments[me];ze(b[he],Ce)}};for(var ee in b)W(ee);return ze(function(){i.addEventListener("resize",function(ue){U.updatePosition()}),i.addEventListener("scroll",function(ue){U.updatePosition()})}),U}();return et.coloris=et,et}(window,document,Math)}();nt.coloris;nt.init;nt.set;nt.wrap;nt.close;nt.setInstance;nt.removeInstance;nt.updatePosition;const Zn=document.getElementById("app");Zn.innerHTML=`
<div>
    <div>
        <div id="localStorageWarning"></div>
        <div class="title">
        <button class="circle-button" id="processedIndicator"></button>
            Smoke!
            <input type="checkbox" id="vision_checkbox" class="large" title="Enable Dynamic Fog">
            <div class="tooltip" id="settings_button" title="Settings"><svg class="svgclickable" fill="#fff" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M.63 11.08zm.21.41v-.1zm.23.38L1 11.68zM1 11.68l-.11-.19zm-.21-.29c-.06-.1-.11-.21-.16-.31.05.1.1.21.16.31zm.32.54v-.06z"/><path d="m11.26 12.63 1.83 1.09a7.34 7.34 0 0 0 1-.94 7.48 7.48 0 0 0 1.56-2.86l-1.74-1A5.29 5.29 0 0 0 14 8a5.29 5.29 0 0 0-.08-.9l1.74-1a7.45 7.45 0 0 0-1.33-2.58 7.54 7.54 0 0 0-1.24-1.22l-1.83 1.04a6 6 0 0 0-1.11-.53v-2A8.55 8.55 0 0 0 7.94.53a8.39 8.39 0 0 0-2.26.3v2a7.23 7.23 0 0 0-1.12.54L2.78 2.28A7.46 7.46 0 0 0 .2 6.06l1.72 1a5.29 5.29 0 0 0-.08.9 5.29 5.29 0 0 0 .08.9l-1.73 1a8 8 0 0 0 .43 1.15c.05.1.1.21.16.31v.1l.11.19.12.19v.06a7.69 7.69 0 0 0 1.64 1.78l1.81-1.08a7.23 7.23 0 0 0 1.12.54v2a8.39 8.39 0 0 0 2.26.31 8.56 8.56 0 0 0 2.22-.3v-2a6 6 0 0 0 1.2-.48zm-2.39 1.52a7.57 7.57 0 0 1-.95.06 7.73 7.73 0 0 1-1-.06v-1.69a4.92 4.92 0 0 1-2.53-1.27l-1.54.92a6.22 6.22 0 0 1-1.08-1.61l1.56-.93a4.27 4.27 0 0 1 0-3.17l-1.56-.92a6.11 6.11 0 0 1 1.12-1.62l1.56.93A5 5 0 0 1 7 3.53V1.82a7.73 7.73 0 0 1 1-.06 7.57 7.57 0 0 1 .95.06v1.72a4.9 4.9 0 0 1 2.4 1.26l1.59-.94a6.31 6.31 0 0 1 1.11 1.62l-1.6.94a4.35 4.35 0 0 1 .3 1.58 4.44 4.44 0 0 1-.29 1.55l1.56.93a6.43 6.43 0 0 1-1.11 1.61l-1.58-.93a5 5 0 0 1-2.49 1.28z"/><path d="M7.92 5.49A2.59 2.59 0 0 0 5.25 8a2.59 2.59 0 0 0 2.67 2.51A2.6 2.6 0 0 0 10.6 8a2.6 2.6 0 0 0-2.68-2.51zM8 9.2A1.35 1.35 0 0 1 6.55 8 1.35 1.35 0 0 1 8 6.7 1.35 1.35 0 0 1 9.39 8 1.35 1.35 0 0 1 8 9.2z"/></svg></div>
            <div class="tooltip" id="whatsnewbutton" title="Whats New"><svg class="svgclickable"  fill="#fff" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm8-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1zm.01 8a1 1 0 102 0V9a1 1 0 10-2 0v5z"/></svg></div>
        </div>
        <hr>
        ${m.SETTINGSPAGE}
        ${m.MAINPAGE}
        ${m.DEBUGPAGE}
    </div>
</div>
`;Zn.parentElement.style.placeItems="start";const Li=document.getElementById("main-ui"),Mn=document.getElementById("settings-ui"),dr=document.getElementById("vision_checkbox"),Mi=document.getElementById("snap_checkbox"),Ca=document.getElementById("token_list"),Da=document.getElementById("no_tokens_message"),$a=document.getElementById("mapHeight"),Pa=document.getElementById("mapWidth"),La=document.getElementById("mapSubmit"),Tt=document.getElementById("processedIndicator"),fr=document.getElementById("persistence_checkbox"),xt=document.getElementById("autodetect_checkbox"),Hn=document.getElementById("fow_checkbox"),pr=document.getElementById("door_checkbox"),hr=document.getElementById("fow_color"),gr=document.getElementById("quality"),Ma=document.getElementById("persistence_reset"),Ra=document.getElementById("convert_button"),Fa=document.getElementById("settings_button"),mr=document.getElementById("boundry_options"),zt=document.getElementById("debug_div"),Ba=document.getElementById("debug_button"),Xa=document.getElementById("background_button"),Va=document.getElementById("tool_width"),ja=document.getElementById("tool_color"),Ua=document.getElementById("tool_style"),Rn=document.getElementById("import_button"),Ha=document.getElementById("import_file"),Wn=document.getElementById("map_align"),_t=document.getElementById("import_errors"),Wa=document.getElementById("dpi_autodetect"),Ga=document.getElementById("import_dpi"),qa=document.getElementById("import_format");nt.init();async function za(){Tt.onclick=async()=>{await $.popover.open({id:m.PROCESSEDID,url:"/pages/processed.html",height:300,width:300,disableClickAway:!1})},dr.addEventListener("click",async t=>{if(!L.ready||!t.target){t.preventDefault();return}const n=t.target;await $.scene.setMetadata({[`${m.EXTENSIONID}/visionEnabled`]:n.checked}),n.checked||await $.scene.fog.setFilled(!1)},!1),Mi.checked=!0,Mi.addEventListener("click",async t=>{if(!L.ready||!t.target){t.preventDefault();return}const n=t.target;L.snap=n.checked},!1),Fa.addEventListener("click",async t=>{!t||!t.target||(Mn.style.display==="block"?(Mn.style.display="none",Li.style.display="block"):(Mn.style.display="block",Li.style.display="none"))},!1),fr.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${m.EXTENSIONID}/persistenceEnabled`]:n.checked})},!1),xt.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;if(await $.scene.setMetadata({[`${m.EXTENSIONID}/autodetectEnabled`]:n.checked}),mr.style.display=n.checked?"none":"",!n.checked){let o=yr();o&&await $.scene.items.addItems([o])}},!1),Hn.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${m.EXTENSIONID}/fowEnabled`]:n.checked})},!1),pr.addEventListener("click",async t=>{if(!t||!t.target)return;const n=t.target;await $.scene.setMetadata({[`${m.EXTENSIONID}/playerDoors`]:n.checked})},!1),gr.addEventListener("change",async t=>{if(!t||!t.target)return;const n=t.target;n.value==="fast"&&await $.notification.show("Notice: Issues can occur when using FAST Performance with PERSISTENCE, specifically with revealing inner fogged areas when traveling in a full circle around them. Use both with caution and care.","DEFAULT"),await $.scene.setMetadata({[`${m.EXTENSIONID}/quality`]:n.value})},!1),Ma.addEventListener("click",async t=>{!t||!t.target||($.scene.setMetadata({[`${m.EXTENSIONID}/forceReset`]:!0}),$.scene.setMetadata({[`${m.EXTENSIONID}/forceReset`]:void 0}))},!1),Ba.addEventListener("click",async t=>{!t||!t.target||(t.target,zt.style.display=zt.style.display=="none"?"grid":"none",await $.scene.setMetadata({[`${m.EXTENSIONID}/debug`]:zt.style.display==="grid"}))},!1),Xa.addEventListener("click",async t=>{!t||!t.target||(t.target,await $.scene.items.updateItems(n=>n.layer=="FOG"&&n.metadata[`${m.EXTENSIONID}/isBackgroundMap`]===!0,n=>{for(let o=0;o<n.length;o++)n[o].layer="MAP",n[o].disableHit=!1,n[o].locked=!1,n[o].visible=!0,delete n[o].metadata[`${m.EXTENSIONID}/isBackgroundMap`]}))},!1);let i;hr.addEventListener("input",async t=>{if(!t||!t.target)return;const n=t.target;clearTimeout(i),i=setTimeout(async()=>{if(/#[a-f0-9]{8}/.test(n.value)){await $.scene.setMetadata({[`${m.EXTENSIONID}/fowColor`]:n.value});const r=await $.scene.local.getItems(Ht);await $.scene.local.deleteItems(r.map(l=>l.id))}},500)},!1),Ra.addEventListener("click",async t=>{if(!(!t||!t.target)&&window.confirm(`WARNING: THIS CANNOT BE UNDONE.

This operation will remove all metadata from the original dynamic fog extension, and will break fog lines and other things if you do not continue using Smoke!.

WARNING: THIS CANNOT BE UNDONE.

Are you REALLY sure?`)){const n=await $.scene.getMetadata();for(const r in n)r.substring(0,r.indexOf("/"))==m.ARMINDOID&&$.scene.setMetadata({[`${r}`]:void 0});const o=await $.scene.items.getItems();await $.scene.items.updateItems(o,r=>{for(const l of r)l.metadata[`${m.ARMINDOID}/isVisionLine`]!==void 0&&(l.metadata[`${m.EXTENSIONID}/isVisionLine`]=l.metadata[`${m.ARMINDOID}/isVisionLine`],delete l.metadata[`${m.ARMINDOID}/isVisionLine`]),l.metadata[`${m.ARMINDOID}/disabled`]!==void 0&&(l.metadata[`${m.EXTENSIONID}/disabled`]=l.metadata[`${m.ARMINDOID}/disabled`],delete l.metadata[`${m.ARMINDOID}/disabled`])})}},!1);var e;Ha.addEventListener("change",async t=>{if(Rn.disabled=!0,!t||!t.target)return;const n=t.target;if(!n.files)return;const o=n.files[0];if(o.type!=="text/javascript"&&o.type,o){var r=new FileReader;r.onload=function(l){if(!l||!l.target){_t.innerText="Invalid import event";return}const f=l.target;if(!f.result){_t.innerText="Unable to read imported file";return}const I=f.result;e=JSON.parse(I),e&&(e.walls&&e.walls.length||e.line_of_sight&&e.line_of_sight.length)?Rn.disabled=!1:_t.innerText="Imported file has no walls"},r.readAsText(o)}else _t.innerText="Failed to load file"}),Rn.addEventListener("click",async t=>{!t||!t.target||(t.target,ka(qa.value,e,Wa.checked?0:Number.parseInt(Ga.value),Wn.value,_t))},!1),ja.addEventListener("input",async t=>{if(!t||!t.target)return;const n=t.target;clearTimeout(i),i=setTimeout(async()=>{/#[a-f0-9]{6}/.test(n.value)&&(console.log("toolColor"+n.value),await $.scene.setMetadata({[`${m.EXTENSIONID}/toolColor`]:n.value}))},400)},!1),Ua.onchange=async t=>{const n=t.currentTarget;console.log("toolStyle"+n.value),await $.scene.setMetadata({[`${m.EXTENSIONID}/toolStyle`]:n.value=="solid"?[]:[25,25]})},Va.onchange=t=>{const n=t.currentTarget;clearTimeout(i),i=setTimeout(async()=>{console.log("toolWdith"+n.value),await $.scene.setMetadata({[`${m.EXTENSIONID}/toolWidth`]:n.value})},400)}}function Kt(i){const e=i.filter(Bi);let t=!1;L.metadata&&(dr.checked=L.metadata[`${m.EXTENSIONID}/visionEnabled`]==!0,xt.checked=L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]==!0,fr.checked=L.metadata[`${m.EXTENSIONID}/persistenceEnabled`]==!0,xt.checked=L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]==!0,Hn.checked=L.metadata[`${m.EXTENSIONID}/fowEnabled`]==!0,pr.checked=L.metadata[`${m.EXTENSIONID}/playerDoors`]==!0,hr.value=L.metadata[`${m.EXTENSIONID}/fowColor`]?L.metadata[`${m.EXTENSIONID}/fowColor`]:"#00000088",t=L.metadata[`${m.EXTENSIONID}/debug`]==!0,gr.value=L.metadata[`${m.EXTENSIONID}/quality`]??"accurate"),zt.style.display=t?"grid":"none",mr.style.display=xt.checked?"none":"",Da.style.display=e.length>0?"none":"block",po(Hn.checked),lo();const n=L.items.filter(I=>I.layer==="FOG"&&I.metadata[`${m.EXTENSIONID}/isBackgroundMap`]===!0),o=document.querySelectorAll(".fog-background-entry");for(const I of o){const y=I.id.slice(3);n.find(_=>_.id===y)===void 0&&I.remove()}for(const I of n)if(!document.querySelector(`#bg-${I.id}`)){const _=document.createElement("div");_.id=`bg-${I.id}`,_.className="fog-background-entry grid-3 grid-main",_.style.width="300",_.innerHTML=`<div class="token-name grid-2">${I.name}</div>
                <div><label title="Unlock this fog background and turn it back into a map"><input type="button" value="Unlock"></label></div>`,document.querySelector("#fog_background_list").appendChild(_),_.querySelector("input").addEventListener("click",async A=>{if(!A||!A.target)return;const N=A.target.parentElement.parentElement.parentElement.id.slice(3);await $.scene.items.updateItems(R=>R.id===N&&R.layer=="FOG"&&R.metadata[`${m.EXTENSIONID}/isBackgroundMap`]===!0,R=>{for(let S=0;S<R.length;S++)R[S].layer="MAP",R[S].disableHit=!1,R[S].locked=!1,R[S].visible=!0,delete R[S].metadata[`${m.EXTENSIONID}/isBackgroundMap`]})})}const r=document.querySelector("#fog_backgrounds");n.length==0?r.style.display="none":r.style.display="block";const l=document.getElementsByClassName("token-table-entry"),f=[];for(const I of l){const y=I.id.slice(3);e.find(_=>_.id===y)===void 0&&f.push(I)}for(const I of f)I.remove();for(const I of e){const y=document.getElementById(`tr-${I.id}`);if(y){const _=y.getElementsByClassName("token-name")[0],x=y.getElementsByClassName("token-vision-range")[0],A=y.getElementsByClassName("unlimited-vision")[0],H=y.getElementsByClassName("no-vision")[0];_&&(_.innerText=I.name),x&&!A.checked&&!H.checked&&(x.value=I.metadata[`${m.EXTENSIONID}/visionRange`]?I.metadata[`${m.EXTENSIONID}/visionRange`]:m.VISIONDEFAULT),A&&(A.checked=I.metadata[`${m.EXTENSIONID}/visionRange`]===0),H&&(H.checked=I.metadata[`${m.EXTENSIONID}/visionBlind`]),A.checked||H.checked?x.setAttribute("disabled","disabled"):x.removeAttribute("disabled")}else{const _=L.items.find(S=>S.id===I.id),x=document.createElement("tr");x.id=`tr-${_.id}`,x.className="token-table-entry",x.innerHTML=`<td class="token-name">${_.name}</td>
                               <td><input class="token-vision-range" type="number" value=${m.VISIONDEFAULT}><span class="unit">ft</span></td>
                               <td>
                                <div class="cbutton"><label title="Unlimited vision range"><input type="checkbox" class="unlimited-vision"><span>&infin;</span></label></div>
                                <div class="cbutton"><label title="Turn token into a light source"><input type="checkbox" class="torch-vision"><span>&#128294;</span></label></div>
                                <div class="cbutton"><label title="Disable vision on this token"><input type="checkbox" class="no-vision"><span>None</span></label></div>
                               </td>`,Ca.appendChild(x);const A=x.getElementsByClassName("token-vision-range")[0],H=x.getElementsByClassName("unlimited-vision")[0],N=x.getElementsByClassName("torch-vision")[0],R=x.getElementsByClassName("no-vision")[0];A&&!H.checked&&!R.checked&&(A.value=I.metadata[`${m.EXTENSIONID}/visionRange`]?I.metadata[`${m.EXTENSIONID}/visionRange`]:m.VISIONDEFAULT),H&&(H.checked=I.metadata[`${m.EXTENSIONID}/visionRange`]===0),N&&(N.checked=I.metadata[`${m.EXTENSIONID}/visionTorch`]),R&&(R.checked=I.metadata[`${m.EXTENSIONID}/visionBlind`]),H.checked||R.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),A.addEventListener("change",async S=>{if(!S||!S.target)return;const D=L.items.find(F=>F.id===I.id),C=S.target,B=parseInt(C.value);B<0&&(C.value="0"),B>999&&(C.value="999"),await $.scene.items.updateItems([D],F=>{F[0].metadata[`${m.EXTENSIONID}/visionRange`]=B})},!1),H.addEventListener("click",async S=>{if(!S||!S.target)return;const D=L.items.find(F=>F.id===I.id);let C=0;S.target.checked?(A.setAttribute("disabled","disabled"),R.checked=!1):(C=parseInt(A.value),A.removeAttribute("disabled")),await $.scene.items.updateItems([D],F=>{F[0].metadata[`${m.EXTENSIONID}/visionRange`]=C})},!1),R.addEventListener("click",async S=>{if(!S||!S.target)return;const D=L.items.find(B=>B.id===I.id),C=S.target;C.checked?A.setAttribute("disabled","disabled"):A.removeAttribute("disabled"),await $.scene.items.updateItems([D],B=>{B[0].metadata[`${m.EXTENSIONID}/visionBlind`]=C.checked})},!1),N.addEventListener("click",async S=>{if(!S||!S.target)return;const D=L.items.find(B=>B.id===I.id),C=S.target;await $.scene.items.updateItems([D],B=>{B[0].metadata[`${m.EXTENSIONID}/visionTorch`]=C.checked})},!1),A.addEventListener("mousewheel",async()=>{})}}}function yr(){let i;return L.items.filter(Xi).length==0&&(i=vt().width(L.gridDpi*30).height(L.gridDpi*30).shapeType("RECTANGLE").visible(!0).locked(!1).strokeColor("pink").fillOpacity(0).strokeDash([200,500]).strokeWidth(50).build(),i.metadata[`${m.EXTENSIONID}/isBackgroundImage`]=!0,i.id=m.GRIDID,L.items.push(i)),i}async function Ri(i){let e,t;[L.items,L.metadata,L.gridDpi,L.gridScale,e,t]=await Promise.all([$.scene.items.getItems(),$.scene.getMetadata(),$.scene.grid.getDpi(),$.scene.grid.getScale(),$.scene.fog.getFilled(),$.scene.fog.getColor()]),await $.scene.items.deleteItems(L.items.filter(gt).map(r=>r.id)),L.snap=!0,L.gridScale=L.gridScale.parsed.multiplier,L.fog={filled:e,style:{color:t,strokeWidth:5}};let n;if(L.items.filter(Fr).length==0){const r=L.items.filter(f=>f.layer=="MAP"&&f.type=="IMAGE"),l=r.map(f=>f.image.width*f.image.height/Math.pow(f.grid.dpi,2));n=r[l.indexOf(Math.max(...l))]}let o;if(L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]===void 0?(xt.checked=!0,await $.scene.setMetadata({[`${m.EXTENSIONID}/autodetectEnabled`]:!0})):L.metadata[`${m.EXTENSIONID}/autodetectEnabled`]===!1&&(o=yr()),L.metadata[`${m.EXTENSIONID}/sceneId`]===void 0)await $.scene.setMetadata({[`${m.EXTENSIONID}/sceneId`]:crypto.randomUUID()});else try{const r=L.metadata[`${m.EXTENSIONID}/sceneId`],l=localStorage.getItem(`${m.EXTENSIONID}/fogCache/${L.userId}/${r}`);if(l!==null&&L.metadata[`${m.EXTENSIONID}/persistenceEnabled`]===!0){const f=JSON.parse(l);console.log("unfreezing "+f.length+" fog paths from localStorage");const I=[];for(let y=0;y<f.length;y++){const _=Ot().commands(f[y].commands).fillRule("evenodd").locked(!0).visible(!1).fillColor("#000000").strokeColor("#000000").layer("FOG").name("Fog of War").metadata({[`${m.EXTENSIONID}/isVisionFog`]:!0,[`${m.EXTENSIONID}/digest`]:f[y].digest}).build();_.zIndex=3,I.push($.scene.local.addItems([_]))}await Promise.all(I)}}catch{}if(i=="GM"){await Sa(),o&&await $.scene.items.addItems([o]),La.onclick=async()=>{await $.scene.items.updateItems([m.GRIDID],l=>{for(const f of l){const I=f;I.width=L.gridDpi*+Pa.value,I.height=L.gridDpi*+$a.value,I.scale={x:1,y:1}}})};const r=document.getElementById("whatsnewbutton");r.onclick=async function(){await $.modal.open({id:m.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html",height:500,width:350})},Kt(L.items),nt({themeMode:"dark",alpha:!0,forceAlpha:!0,el:"#fow_color"}),nt({themeMode:"dark",alpha:!1,forceAlpha:!1,el:"#tool_color"}),n!==void 0&&await $.scene.items.updateItems([n],l=>{l[0].metadata[`${m.EXTENSIONID}/isBackgroundImage`]=!0})}}async function Fi(){try{localStorage.setItem("STORAGECHECK","test")}catch{const e=document.getElementById("localStorageWarning");e.innerText="Local Storage disabled. Some features will not function."}}async function Ka(i){const e=document.getElementById("playerOwnedTokens"),t=[];for(const n of i)if(zn(n)&&n.createdUserId===L.userId){const o=n.metadata[`${m.EXTENSIONID}/hasVision`]!==void 0;t.push(`<li>${n.name}${o?"":": <b>Vision Disabled</b>"}</li>`)}t.length===0&&t.push("<li>None found.</li>"),e.innerHTML=`<ul>${t.join("")}</ul>`}$.onReady(async()=>{const i=await $.theme.getTheme();Pi(i,document),await $.player.getRole().then(async e=>{if(e=="GM")L.role="GM",await Fi(),await za(),await ho(),await go(),await mo(),await _a();else{Zn.innerHTML=`<div class="title">Configuration via GM.
            <div class="tooltip" id="helpButton" title="Need Help?"></div>
            </div>
            <hr><sub>You must have ownership of a token to see it.</sub></br></br>Tokens Owned By You:<div id="playerOwnedTokens"></div><div id="localStorageWarning"></div>`,await Fi(),await $.action.setHeight(300),await $.action.setWidth(350);const n=document.getElementById("helpButton"),o=document.createElement("input");o.classList.add("clickable"),o.src="/help.svg",o.height=15,o.width=15,o.type="image",o.title="Need Help?",o.onclick=async function(){await $.modal.open({id:m.EXTENSIONWHATSNEW,url:"/pages/whatsnew.html?gethelp=true",height:500,width:350})},n.appendChild(o)}$.scene.fog.onChange(n=>{L.fog=n}),$.player.onChange(async n=>{const o=document.querySelectorAll(".token-table-entry");for(let r of o){let l=r.id.substring(3);n.selection!==void 0&&n.selection.includes(l)?r.classList.add("token-table-selected"):r.classList.remove("token-table-selected")}n.selection!==void 0&&n.selection.length===1&&uo(n.selection[0])}),$.scene.items.onChange(async n=>{const o=n;L.items=o,L.ready&&(e=="GM"?(Kt(o),await $i(Wn)):Ka(n),await ht())}),L.userId=await $.player.getId(),L.players=await $.party.getPlayers(),e==="GM"&&t(L.players),$.party.onChange(async n=>{L.players=n,e==="PLAYER"?await wa(n):(ba(),t(n))}),$.scene.grid.onChange(async n=>{L.gridDpi=n.dpi,L.gridScale=parseInt(n.scale),L.ready&&await ht()}),$.scene.onMetadataChange(async n=>{if(n[`${m.EXTENSIONID}/forceReset`]===!0){const o=await $.scene.local.getItems(Bn);$.scene.local.deleteItems(o.map(l=>l.id));const r=L.metadata[`${m.EXTENSIONID}/sceneId`];localStorage.removeItem(`${m.EXTENSIONID}/fogCache/${L.userId}/${r}`),ht(!0)}else L.metadata=n,L.ready&&await ht()}),$.scene.onReadyChange(async n=>{L.ready=n,n?(await Ri(e),await ht()):e=="GM"&&Kt([])}),L.ready=await $.scene.isReady(),L.ready?(await Ri(e),await ht(),e=="GM"&&await $i(Wn)):e=="GM"&&Kt([]),$.theme.onChange(n=>{Pi(n,document)});function t(n){n.every(r=>r.metadata[`${m.EXTENSIONID}/processed`]===!0)?(Tt.style.backgroundColor="green",Tt.title="Everything looks good."):(Tt.style.backgroundColor="red",Tt.title="A player is having trouble processing/seeing.")}})});
